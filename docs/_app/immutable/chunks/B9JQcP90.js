const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BfN7rNmm.js","./B2c5_Eok.js","./dv0JZMFe.js","./BLbg0tTC.js","./0QI0w0yl.js","./Cram60i4.js","./AId8NOvR.js","./BAPLZTTh.js","./ByRDRQcx.js"])))=>i.map(i=>d[i]);
var ox=Object.defineProperty;var lx=(a,i,l)=>i in a?ox(a,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[i]=l;var T_=(a,i,l)=>lx(a,typeof i!="symbol"?i+"":i,l);import{f as On,a as dn,w as hx,c as cx}from"./CrWGjkMl.js";import{o as q0,w as ux}from"./DmsrawTt.js";import{O as Sd,P as Td,R as dx,T as Lp,aq as fx,b as Z0,h as xs,x as W0,ar as P_,z as X0,A as Op,B as Fp,C as gc,U as E_,as as gd,at as Pd,M as Bp,a as _c,J as Np,c as El,au as I_,e as px,D as Ed,F as _d,am as mx,j as Me,ad as gx,y as _x,$ as yx,a3 as H0,Q as vx,av as dp,aw as xx,ax as bx,a2 as wx,ay as Mx,d as Sx,az as Tx,aA as Px,X as Ex,aB as Ix,aC as Cx,aD as Ax,I as Rx,aE as Dx,K as zx,p as K0,g as Gp,q as Y0,an as ys,ag as td,N as zr,f as Ml,t as lc,ap as C_,aF as A_,s as Es,v as Is,w as hn}from"./Cc9w7wNK.js";import{d as Gd,a as kx,s as hc}from"./4S82zC7V.js";import{_ as Po,b as Lx,i as fp,s as Ox,a as Fx}from"./DvWEVvgn.js";import{b as jp}from"./HHWxy3nG.js";import"./rtxB1Do3.js";let R_=!1;function J0(){R_||(R_=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var i;if(!a.defaultPrevented)for(const l of a.target.elements)(i=l.__on_r)==null||i.call(l)})},{capture:!0}))}function Bx(a){var i=dx,l=Lp;Sd(null),Td(null);try{return a()}finally{Sd(i),Td(l)}}function Nx(a,i,l,u=l){a.addEventListener(i,()=>Bx(l));const p=a.__on_r;p?a.__on_r=()=>{p(),u(!0)}:a.__on_r=()=>u(!0),J0()}const pp=0,ed=1,mp=2;function Gx(a,i,l,u,p){xs&&W0();var x=a,m=fx(),o=px,P=E_,A,L,z,D=(m?Pd:Bp)(void 0),B=(m?Pd:Bp)(void 0),$=!1;function et(ft,dt){$=!0,dt&&(Td(it),Sd(it),I_(o));try{ft===pp&&l&&(A?Ed(A):A=_c(()=>l(x))),ft===ed&&u&&(L?Ed(L):L=_c(()=>u(x,D))),ft!==pp&&A&&_d(A,()=>A=null),ft!==ed&&L&&_d(L,()=>L=null),ft!==mp&&z&&_d(z,()=>z=null)}finally{dt&&(I_(null),Sd(null),Td(null),mx())}}var it=Z0(()=>{if(P===(P=i()))return;let ft=xs&&P_(P)===(x.data===X0);if(ft&&(x=Op(),Fp(x),gc(!1),ft=!0),P_(P)){var dt=P;$=!1,dt.then(Ot=>{dt===P&&(gd(D,Ot),et(ed,!0))},Ot=>{if(dt===P)throw gd(B,Ot),et(mp,!0),B.v}),xs?l&&(A=_c(()=>l(x))):Np(()=>{$||et(pp,!0)})}else gd(D,P),et(ed,!1);return ft&&gc(!0),()=>P=E_});xs&&(x=El)}function jx(a,i,l,u){for(var p=[],x=i.length,m=0;m<x;m++)bx(i[m].e,p,!0);var o=x>0&&p.length===0&&l!==null;if(o){var P=l.parentNode;wx(P),P.append(l),u.clear(),_a(a,i[0].prev,i[x-1].next)}Mx(p,()=>{for(var A=0;A<x;A++){var L=i[A];o||(u.delete(L.k),_a(a,L.prev,L.next)),Sx(L.e,!o)}})}function Ux(a,i,l,u,p,x=null){var m=a,o={flags:i,items:new Map,first:null};xs&&W0();var P=null,A=!1,L=gx(()=>{var z=l();return vx(z)?z:z==null?[]:H0(z)});Z0(()=>{var z=Me(L),D=z.length;if(A&&D===0)return;A=D===0;let B=!1;if(xs){var $=_x(m)===X0;$!==(D===0)&&(m=Op(),Fp(m),gc(!1),B=!0)}if(xs){for(var et=null,it,ft=0;ft<D;ft++){if(El.nodeType===8&&El.data===yx){m=El,B=!0,gc(!1);break}var dt=z[ft],Ot=u(dt,ft);it=Q0(El,o,et,null,dt,Ot,ft,p,i,l),o.items.set(Ot,it),et=it}D>0&&Fp(Op())}xs||Vx(z,o,m,p,i,u,l),x!==null&&(D===0?P?Ed(P):P=_c(()=>x(m)):P!==null&&_d(P,()=>{P=null})),B&&gc(!0),Me(L)}),xs&&(m=El)}function Vx(a,i,l,u,p,x,m){var o=a.length,P=i.items,A=i.first,L=A,z,D=null,B=[],$=[],et,it,ft,dt;for(dt=0;dt<o;dt+=1){if(et=a[dt],it=x(et,dt),ft=P.get(it),ft===void 0){var Ot=L?L.e.nodes_start:l;D=Q0(Ot,i,D,D===null?i.first:D.next,et,it,dt,u,p,m),P.set(it,D),B=[],$=[],L=D.next;continue}if($x(ft,et,dt),(ft.e.f&dp)!==0&&Ed(ft.e),ft!==L){if(z!==void 0&&z.has(ft)){if(B.length<$.length){var jt=$[0],Gt;D=jt.prev;var re=B[0],Ie=B[B.length-1];for(Gt=0;Gt<B.length;Gt+=1)D_(B[Gt],jt,l);for(Gt=0;Gt<$.length;Gt+=1)z.delete($[Gt]);_a(i,re.prev,Ie.next),_a(i,D,re),_a(i,Ie,jt),L=jt,D=Ie,dt-=1,B=[],$=[]}else z.delete(ft),D_(ft,L,l),_a(i,ft.prev,ft.next),_a(i,ft,D===null?i.first:D.next),_a(i,D,ft),D=ft;continue}for(B=[],$=[];L!==null&&L.k!==it;)(L.e.f&dp)===0&&(z??(z=new Set)).add(L),$.push(L),L=L.next;if(L===null)continue;ft=L}B.push(ft),D=ft,L=ft.next}if(L!==null||z!==void 0){for(var _e=z===void 0?[]:H0(z);L!==null;)(L.e.f&dp)===0&&_e.push(L),L=L.next;var Re=_e.length;if(Re>0){var ri=null;jx(i,_e,ri,P)}}Lp.first=i.first&&i.first.e,Lp.last=D&&D.e}function $x(a,i,l,u){gd(a.v,i),a.i=l}function Q0(a,i,l,u,p,x,m,o,P,A){var L=(P&Tx)!==0,z=(P&Px)===0,D=L?z?Bp(p):Pd(p):p,B=(P&xx)===0?m:Pd(m),$={i:B,v:D,k:x,a:null,e:null,prev:l,next:u};try{return $.e=_c(()=>o(a,D,B,A),xs),$.e.prev=l&&l.e,$.e.next=u&&u.e,l===null?i.first=$:(l.next=$,l.e.next=$.e),u!==null&&(u.prev=$,u.e.prev=$.e),$}finally{}}function D_(a,i,l){for(var u=a.next?a.next.e.nodes_start:l,p=i?i.e.nodes_start:l,x=a.e.nodes_start;x!==u;){var m=Ex(x);p.before(x),x=m}}function _a(a,i,l){i===null?a.first=l:(i.next=l,i.e.next=l&&l.e),l!==null&&(l.prev=i,l.e.prev=i&&i.e)}const qx=Symbol("is custom element"),Zx=Symbol("is html");function Wx(a){if(xs){var i=!1,l=()=>{if(!i){if(i=!0,a.hasAttribute("value")){var u=a.value;z_(a,"value",null),a.value=u}if(a.hasAttribute("checked")){var p=a.checked;z_(a,"checked",null),a.checked=p}}};a.__on_r=l,Ix(l),J0()}}function Xx(a,i){var l=ty(a);l.value===(l.value=i??void 0)||a.value===i&&(i!==0||a.nodeName!=="PROGRESS")||(a.value=i??"")}function z_(a,i,l,u){var p=ty(a);xs&&(p[i]=a.getAttribute(i),i==="src"||i==="srcset"||i==="href"&&a.nodeName==="LINK")||p[i]!==(p[i]=l)&&(i==="loading"&&(a[Ax]=l),a.removeAttribute(i))}function ty(a){return a.__attributes??(a.__attributes={[qx]:a.nodeName.includes("-"),[Zx]:a.namespaceURI===Cx})}const gp=new Set;function Hx(a,i,l,u,p=u){var x=l.getAttribute("type")==="checkbox",m=a;let o=!1;if(i!==null)for(var P of i)m=m[P]??(m[P]=[]);m.push(l),Nx(l,"change",()=>{var A=l.__value;x&&(A=k_(m,A,l.checked)),p(A)},()=>p(x?[]:null)),Rx(()=>{var A=u();if(xs&&l.defaultChecked!==l.checked){o=!0;return}x?(A=A||[],l.checked=A.includes(l.__value)):l.checked=Dx(l.__value,A)}),zx(()=>{var A=m.indexOf(l);A!==-1&&m.splice(A,1)}),gp.has(m)||(gp.add(m),Np(()=>{m.sort((A,L)=>A.compareDocumentPosition(L)===4?-1:1),gp.delete(m)})),Np(()=>{if(o){var A;if(x)A=k_(m,A,l.checked);else{var L=m.find(z=>z.checked);A=L==null?void 0:L.__value}p(A)}})}function k_(a,i,l){for(var u=new Set,p=0;p<a.length;p+=1)a[p].checked&&u.add(a[p].__value);return l||u.delete(i),Array.from(u)}function Or(a){return(i,...l)=>Kx(a,i,l)}function Zl(a,i){return Or(ey(a,i).get)}const{apply:Kx,getOwnPropertyDescriptor:ey,getPrototypeOf:rm,ownKeys:Yx}=Reflect,{iterator:kc,toStringTag:Jx}=Symbol,Qx=Object,{create:sm,defineProperty:tb}=Qx,eb=Array,ib=eb.prototype,iy=ib[kc],rb=Or(iy),ry=ArrayBuffer,sb=ry.prototype;Zl(sb,"byteLength");const L_=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;L_&&Zl(L_.prototype,"byteLength");const sy=rm(Uint8Array);sy.from;const Qr=sy.prototype;Qr[kc];Or(Qr.keys);Or(Qr.values);Or(Qr.entries);Or(Qr.set);Or(Qr.reverse);Or(Qr.fill);Or(Qr.copyWithin);Or(Qr.sort);Or(Qr.slice);Or(Qr.subarray);Zl(Qr,"buffer");Zl(Qr,"byteOffset");Zl(Qr,"length");Zl(Qr,Jx);const nb=Uint8Array,ny=Uint16Array,nm=Uint32Array,ab=Float32Array,Ec=rm([][kc]()),ay=Or(Ec.next),ob=Or(function*(){}().next),lb=rm(Ec),hb=DataView.prototype,cb=Or(hb.getUint16),am=WeakMap,oy=am.prototype,ly=Or(oy.get),ub=Or(oy.set),hy=new am,db=sm(null,{next:{value:function(){const i=ly(hy,this);return ay(i)}},[kc]:{value:function(){return this}}});function fb(a){if(a[kc]===iy&&Ec.next===ay)return a;const i=sm(db);return ub(hy,i,rb(a)),i}const pb=new am,mb=sm(lb,{next:{value:function(){const i=ly(pb,this);return ob(i)},writable:!0,configurable:!0}});for(const a of Yx(Ec))a!=="next"&&tb(mb,a,ey(Ec,a));const cy=new ry(4),gb=new ab(cy),_b=new nm(cy),cn=new ny(512),un=new nb(512);for(let a=0;a<256;++a){const i=a-127;i<-24?(cn[a]=0,cn[a|256]=32768,un[a]=24,un[a|256]=24):i<-14?(cn[a]=1024>>-i-14,cn[a|256]=1024>>-i-14|32768,un[a]=-i-1,un[a|256]=-i-1):i<=15?(cn[a]=i+15<<10,cn[a|256]=i+15<<10|32768,un[a]=13,un[a|256]=13):i<128?(cn[a]=31744,cn[a|256]=64512,un[a]=24,un[a|256]=24):(cn[a]=31744,cn[a|256]=64512,un[a]=13,un[a|256]=13)}const om=new nm(2048);for(let a=1;a<1024;++a){let i=a<<13,l=0;for(;(i&8388608)===0;)i<<=1,l-=8388608;i&=-8388609,l+=947912704,om[a]=i|l}for(let a=1024;a<2048;++a)om[a]=939524096+(a-1024<<13);const Wl=new nm(64);for(let a=1;a<31;++a)Wl[a]=a<<23;Wl[31]=1199570944;Wl[32]=2147483648;for(let a=33;a<63;++a)Wl[a]=2147483648+(a-32<<23);Wl[63]=3347054592;const uy=new ny(64);for(let a=1;a<64;++a)a!==32&&(uy[a]=1024);function yb(a){const i=a>>10;return _b[0]=om[uy[i]+(a&1023)]+Wl[i],gb[0]}function dy(a,i,...l){return yb(cb(a,i,...fb(l)))}function lm(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var id={exports:{}},O_;function vb(){if(O_)return id.exports;O_=1;function a(i,l,u){const p=u&&u.debug||!1;p&&console.log("[xml-utils] getting "+l+" in "+i);const x=typeof i=="object"?i.outer:i,m=x.slice(0,x.indexOf(">")+1),o=['"',"'"];for(let P=0;P<o.length;P++){const A=o[P],L=l+"\\="+A+"([^"+A+"]*)"+A;p&&console.log("[xml-utils] pattern:",L);const D=new RegExp(L).exec(m);if(p&&console.log("[xml-utils] match:",D),D)return D[1]}}return id.exports=a,id.exports.default=a,id.exports}var xb=vb();const _p=lm(xb);var rd={exports:{}},sd={exports:{}},nd={exports:{}},F_;function bb(){if(F_)return nd.exports;F_=1;function a(i,l,u){const x=new RegExp(l).exec(i.slice(u));return x?u+x.index:-1}return nd.exports=a,nd.exports.default=a,nd.exports}var ad={exports:{}},B_;function wb(){if(B_)return ad.exports;B_=1;function a(i,l,u){const x=new RegExp(l).exec(i.slice(u));return x?u+x.index+x[0].length-1:-1}return ad.exports=a,ad.exports.default=a,ad.exports}var od={exports:{}},N_;function Mb(){if(N_)return od.exports;N_=1;function a(i,l){const u=new RegExp(l,"g"),p=i.match(u);return p?p.length:0}return od.exports=a,od.exports.default=a,od.exports}var G_;function Sb(){if(G_)return sd.exports;G_=1;const a=bb(),i=wb(),l=Mb();function u(p,x,m){const o=m&&m.debug||!1,P=!(m&&typeof m.nested===!1),A=m&&m.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",x," and ",m);const L=a(p,`<${x}[ 
>/]`,A);if(o&&console.log("[xml-utils] start:",L),L===-1)return;const z=p.slice(L+x.length);let D=i(z,"^[^<]*[ /]>",0);const B=D!==-1&&z[D-1]==="/";if(o&&console.log("[xml-utils] selfClosing:",B),B===!1)if(P){let ft=0,dt=1,Ot=0;for(;(D=i(z,"[ /]"+x+">",ft))!==-1;){const jt=z.substring(ft,D+1);if(dt+=l(jt,"<"+x+`[ 
	>]`),Ot+=l(jt,"</"+x+">"),Ot>=dt)break;ft=D}}else D=i(z,"[ /]"+x+">",0);const $=L+x.length+D+1;if(o&&console.log("[xml-utils] end:",$),$===-1)return;const et=p.slice(L,$);let it;return B?it=null:it=et.slice(et.indexOf(">")+1,et.lastIndexOf("<")),{inner:it,outer:et,start:L,end:$}}return sd.exports=u,sd.exports.default=u,sd.exports}var j_;function Tb(){if(j_)return rd.exports;j_=1;const a=Sb();function i(l,u,p){const x=[],m=p&&p.debug||!1,o=p&&typeof p.nested=="boolean"?p.nested:!0;let P=p&&p.startIndex||0,A;for(;A=a(l,u,{debug:m,startIndex:P});)o?P=A.start+1+u.length:P=A.end,x.push(A);return m&&console.log("findTagsByName found",x.length,"tags"),x}return rd.exports=i,rd.exports.default=i,rd.exports}var Pb=Tb();const Eb=lm(Pb),yc={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},fn={};for(const a in yc)yc.hasOwnProperty(a)&&(fn[yc[a]]=parseInt(a,10));const Ib=[fn.BitsPerSample,fn.ExtraSamples,fn.SampleFormat,fn.StripByteCounts,fn.StripOffsets,fn.StripRowCounts,fn.TileByteCounts,fn.TileOffsets,fn.SubIFDs],yp={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ii={};for(const a in yp)yp.hasOwnProperty(a)&&(ii[yp[a]]=parseInt(a,10));const vs={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},Cb={Unspecified:0},zC={AddCompression:1},kC={None:0,Deflate:1,Zstandard:2},Ab={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function Rb(a,i){const{width:l,height:u}=a,p=new Uint8Array(l*u*3);let x;for(let m=0,o=0;m<a.length;++m,o+=3)x=256-a[m]/i*256,p[o]=x,p[o+1]=x,p[o+2]=x;return p}function Db(a,i){const{width:l,height:u}=a,p=new Uint8Array(l*u*3);let x;for(let m=0,o=0;m<a.length;++m,o+=3)x=a[m]/i*256,p[o]=x,p[o+1]=x,p[o+2]=x;return p}function zb(a,i){const{width:l,height:u}=a,p=new Uint8Array(l*u*3),x=i.length/3,m=i.length/3*2;for(let o=0,P=0;o<a.length;++o,P+=3){const A=a[o];p[P]=i[A]/65536*256,p[P+1]=i[A+x]/65536*256,p[P+2]=i[A+m]/65536*256}return p}function kb(a){const{width:i,height:l}=a,u=new Uint8Array(i*l*3);for(let p=0,x=0;p<a.length;p+=4,x+=3){const m=a[p],o=a[p+1],P=a[p+2],A=a[p+3];u[x]=255*((255-m)/256)*((255-A)/256),u[x+1]=255*((255-o)/256)*((255-A)/256),u[x+2]=255*((255-P)/256)*((255-A)/256)}return u}function Lb(a){const{width:i,height:l}=a,u=new Uint8ClampedArray(i*l*3);for(let p=0,x=0;p<a.length;p+=3,x+=3){const m=a[p],o=a[p+1],P=a[p+2];u[x]=m+1.402*(P-128),u[x+1]=m-.34414*(o-128)-.71414*(P-128),u[x+2]=m+1.772*(o-128)}return u}const Ob=.95047,Fb=1,Bb=1.08883;function Nb(a){const{width:i,height:l}=a,u=new Uint8Array(i*l*3);for(let p=0,x=0;p<a.length;p+=3,x+=3){const m=a[p+0],o=a[p+1]<<24>>24,P=a[p+2]<<24>>24;let A=(m+16)/116,L=o/500+A,z=A-P/200,D,B,$;L=Ob*(L*L*L>.008856?L*L*L:(L-16/116)/7.787),A=Fb*(A*A*A>.008856?A*A*A:(A-16/116)/7.787),z=Bb*(z*z*z>.008856?z*z*z:(z-16/116)/7.787),D=L*3.2406+A*-1.5372+z*-.4986,B=L*-.9689+A*1.8758+z*.0415,$=L*.0557+A*-.204+z*1.057,D=D>.0031308?1.055*D**(1/2.4)-.055:12.92*D,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,$=$>.0031308?1.055*$**(1/2.4)-.055:12.92*$,u[x]=Math.max(0,Math.min(1,D))*255,u[x+1]=Math.max(0,Math.min(1,B))*255,u[x+2]=Math.max(0,Math.min(1,$))*255}return u}const fy=new Map;function Sa(a,i){Array.isArray(a)||(a=[a]),a.forEach(l=>fy.set(l,i))}async function Gb(a){const i=fy.get(a.Compression);if(!i)throw new Error(`Unknown compression method identifier: ${a.Compression}`);const l=await i();return new l(a)}Sa([void 0,1],()=>Po(()=>import("./BfN7rNmm.js"),__vite__mapDeps([0,1]),import.meta.url).then(a=>a.default));Sa(5,()=>Po(()=>import("./dv0JZMFe.js"),__vite__mapDeps([2,1]),import.meta.url).then(a=>a.default));Sa(6,()=>{throw new Error("old style JPEG compression is not supported.")});Sa(7,()=>Po(()=>import("./BLbg0tTC.js"),__vite__mapDeps([3,1]),import.meta.url).then(a=>a.default));Sa([8,32946],()=>Po(()=>import("./0QI0w0yl.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(a=>a.default));Sa(32773,()=>Po(()=>import("./AId8NOvR.js"),__vite__mapDeps([6,1]),import.meta.url).then(a=>a.default));Sa(34887,()=>Po(()=>import("./BAPLZTTh.js"),__vite__mapDeps([7,5,1]),import.meta.url).then(async a=>(await a.zstd.init(),a)).then(a=>a.default));Sa(50001,()=>Po(()=>import("./ByRDRQcx.js"),__vite__mapDeps([8,1]),import.meta.url).then(a=>a.default));function jd(a,i,l,u=1){return new(Object.getPrototypeOf(a)).constructor(i*l*u)}function jb(a,i,l,u,p){const x=i/u,m=l/p;return a.map(o=>{const P=jd(o,u,p);for(let A=0;A<p;++A){const L=Math.min(Math.round(m*A),l-1);for(let z=0;z<u;++z){const D=Math.min(Math.round(x*z),i-1),B=o[L*i+D];P[A*u+z]=B}}return P})}function Ol(a,i,l){return(1-l)*a+l*i}function Ub(a,i,l,u,p){const x=i/u,m=l/p;return a.map(o=>{const P=jd(o,u,p);for(let A=0;A<p;++A){const L=m*A,z=Math.floor(L),D=Math.min(Math.ceil(L),l-1);for(let B=0;B<u;++B){const $=x*B,et=$%1,it=Math.floor($),ft=Math.min(Math.ceil($),i-1),dt=o[z*i+it],Ot=o[z*i+ft],jt=o[D*i+it],Gt=o[D*i+ft],re=Ol(Ol(dt,Ot,et),Ol(jt,Gt,et),L%1);P[A*u+B]=re}}return P})}function Vb(a,i,l,u,p,x="nearest"){switch(x.toLowerCase()){case"nearest":return jb(a,i,l,u,p);case"bilinear":case"linear":return Ub(a,i,l,u,p);default:throw new Error(`Unsupported resampling method: '${x}'`)}}function $b(a,i,l,u,p,x){const m=i/u,o=l/p,P=jd(a,u,p,x);for(let A=0;A<p;++A){const L=Math.min(Math.round(o*A),l-1);for(let z=0;z<u;++z){const D=Math.min(Math.round(m*z),i-1);for(let B=0;B<x;++B){const $=a[L*i*x+D*x+B];P[A*u*x+z*x+B]=$}}}return P}function qb(a,i,l,u,p,x){const m=i/u,o=l/p,P=jd(a,u,p,x);for(let A=0;A<p;++A){const L=o*A,z=Math.floor(L),D=Math.min(Math.ceil(L),l-1);for(let B=0;B<u;++B){const $=m*B,et=$%1,it=Math.floor($),ft=Math.min(Math.ceil($),i-1);for(let dt=0;dt<x;++dt){const Ot=a[z*i*x+it*x+dt],jt=a[z*i*x+ft*x+dt],Gt=a[D*i*x+it*x+dt],re=a[D*i*x+ft*x+dt],Ie=Ol(Ol(Ot,jt,et),Ol(Gt,re,et),L%1);P[A*u*x+B*x+dt]=Ie}}}return P}function Zb(a,i,l,u,p,x,m="nearest"){switch(m.toLowerCase()){case"nearest":return $b(a,i,l,u,p,x);case"bilinear":case"linear":return qb(a,i,l,u,p,x);default:throw new Error(`Unsupported resampling method: '${m}'`)}}function Wb(a,i,l){let u=0;for(let p=i;p<l;++p)u+=a[p];return u}function Up(a,i,l){switch(a){case 1:if(i<=8)return new Uint8Array(l);if(i<=16)return new Uint16Array(l);if(i<=32)return new Uint32Array(l);break;case 2:if(i===8)return new Int8Array(l);if(i===16)return new Int16Array(l);if(i===32)return new Int32Array(l);break;case 3:switch(i){case 16:case 32:return new Float32Array(l);case 64:return new Float64Array(l)}break}throw Error("Unsupported data format/bitsPerSample")}function Xb(a,i){return(a===1||a===2)&&i<=32&&i%8===0?!1:!(a===3&&(i===16||i===32||i===64))}function Hb(a,i,l,u,p,x,m){const o=new DataView(a),P=l===2?m*x:m*x*u,A=l===2?1:u,L=Up(i,p,P),z=parseInt("1".repeat(p),2);if(i===1){let D;l===1?D=u*p:D=p;let B=x*D;(B&7)!==0&&(B=B+7&-8);for(let $=0;$<m;++$){const et=$*B;for(let it=0;it<x;++it){const ft=et+it*A*p;for(let dt=0;dt<A;++dt){const Ot=ft+dt*p,jt=($*x+it)*A+dt,Gt=Math.floor(Ot/8),re=Ot%8;if(re+p<=8)L[jt]=o.getUint8(Gt)>>8-p-re&z;else if(re+p<=16)L[jt]=o.getUint16(Gt)>>16-p-re&z;else if(re+p<=24){const Ie=o.getUint16(Gt)<<8|o.getUint8(Gt+2);L[jt]=Ie>>24-p-re&z}else L[jt]=o.getUint32(Gt)>>32-p-re&z}}}}return L.buffer}class Kb{constructor(i,l,u,p,x,m){this.fileDirectory=i,this.geoKeys=l,this.dataView=u,this.littleEndian=p,this.tiles=x?{}:null,this.isTiled=!i.StripOffsets;const o=i.PlanarConfiguration;if(this.planarConfiguration=typeof o>"u"?1:o,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=m}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(i){return this.isTiled||(i+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-i*this.getTileHeight()}getBytesPerPixel(){let i=0;for(let l=0;l<this.fileDirectory.BitsPerSample.length;++l)i+=this.getSampleByteSize(l);return i}getSampleByteSize(i){if(i>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${i} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[i]/8)}getReaderForSample(i){const l=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[i]:1,u=this.fileDirectory.BitsPerSample[i];switch(l){case 1:if(u<=8)return DataView.prototype.getUint8;if(u<=16)return DataView.prototype.getUint16;if(u<=32)return DataView.prototype.getUint32;break;case 2:if(u<=8)return DataView.prototype.getInt8;if(u<=16)return DataView.prototype.getInt16;if(u<=32)return DataView.prototype.getInt32;break;case 3:switch(u){case 16:return function(p,x){return dy(this,p,x)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(i=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[i]:1}getBitsPerSample(i=0){return this.fileDirectory.BitsPerSample[i]}getArrayForSample(i,l){const u=this.getSampleFormat(i),p=this.getBitsPerSample(i);return Up(u,p,l)}async getTileOrStrip(i,l,u,p,x){const m=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let P;const{tiles:A}=this;this.planarConfiguration===1?P=l*m+i:this.planarConfiguration===2&&(P=u*m*o+l*m+i);let L,z;this.isTiled?(L=this.fileDirectory.TileOffsets[P],z=this.fileDirectory.TileByteCounts[P]):(L=this.fileDirectory.StripOffsets[P],z=this.fileDirectory.StripByteCounts[P]);const D=(await this.source.fetch([{offset:L,length:z}],x))[0];let B;return A===null||!A[P]?(B=(async()=>{let $=await p.decode(this.fileDirectory,D);const et=this.getSampleFormat(),it=this.getBitsPerSample();return Xb(et,it)&&($=Hb($,et,this.planarConfiguration,this.getSamplesPerPixel(),it,this.getTileWidth(),this.getBlockHeight(l))),$})(),A!==null&&(A[P]=B)):B=A[P],{x:i,y:l,sample:u,data:await B}}async _readRaster(i,l,u,p,x,m,o,P,A){const L=this.getTileWidth(),z=this.getTileHeight(),D=this.getWidth(),B=this.getHeight(),$=Math.max(Math.floor(i[0]/L),0),et=Math.min(Math.ceil(i[2]/L),Math.ceil(D/L)),it=Math.max(Math.floor(i[1]/z),0),ft=Math.min(Math.ceil(i[3]/z),Math.ceil(B/z)),dt=i[2]-i[0];let Ot=this.getBytesPerPixel();const jt=[],Gt=[];for(let _e=0;_e<l.length;++_e)this.planarConfiguration===1?jt.push(Wb(this.fileDirectory.BitsPerSample,0,l[_e])/8):jt.push(0),Gt.push(this.getReaderForSample(l[_e]));const re=[],{littleEndian:Ie}=this;for(let _e=it;_e<ft;++_e)for(let Re=$;Re<et;++Re){let ri;this.planarConfiguration===1&&(ri=this.getTileOrStrip(Re,_e,0,x,A));for(let $e=0;$e<l.length;++$e){const oi=$e,Qe=l[$e];this.planarConfiguration===2&&(Ot=this.getSampleByteSize(Qe),ri=this.getTileOrStrip(Re,_e,Qe,x,A));const wi=ri.then(li=>{const Ii=li.data,Ri=new DataView(Ii),Nt=this.getBlockHeight(li.y),qt=li.y*z,Xt=li.x*L,Dt=qt+Nt,Mt=(li.x+1)*L,Lt=Gt[oi],ee=Math.min(Nt,Nt-(Dt-i[3]),B-qt),de=Math.min(L,L-(Mt-i[2]),D-Xt);for(let Ee=Math.max(0,i[1]-qt);Ee<ee;++Ee)for(let me=Math.max(0,i[0]-Xt);me<de;++me){const Ge=(Ee*L+me)*Ot,ae=Lt.call(Ri,Ge+jt[oi],Ie);let Se;p?(Se=(Ee+qt-i[1])*dt*l.length+(me+Xt-i[0])*l.length+oi,u[Se]=ae):(Se=(Ee+qt-i[1])*dt+me+Xt-i[0],u[oi][Se]=ae)}});re.push(wi)}}if(await Promise.all(re),m&&i[2]-i[0]!==m||o&&i[3]-i[1]!==o){let _e;return p?_e=Zb(u,i[2]-i[0],i[3]-i[1],m,o,l.length,P):_e=Vb(u,i[2]-i[0],i[3]-i[1],m,o,P),_e.width=m,_e.height=o,_e}return u.width=m||i[2]-i[0],u.height=o||i[3]-i[1],u}async readRasters({window:i,samples:l=[],interleave:u,pool:p=null,width:x,height:m,resampleMethod:o,fillValue:P,signal:A}={}){const L=i||[0,0,this.getWidth(),this.getHeight()];if(L[0]>L[2]||L[1]>L[3])throw new Error("Invalid subsets");const z=L[2]-L[0],D=L[3]-L[1],B=z*D,$=this.getSamplesPerPixel();if(!l||!l.length)for(let dt=0;dt<$;++dt)l.push(dt);else for(let dt=0;dt<l.length;++dt)if(l[dt]>=$)return Promise.reject(new RangeError(`Invalid sample index '${l[dt]}'.`));let et;if(u){const dt=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Ot=Math.max.apply(null,this.fileDirectory.BitsPerSample);et=Up(dt,Ot,B*l.length),P&&et.fill(P)}else{et=[];for(let dt=0;dt<l.length;++dt){const Ot=this.getArrayForSample(l[dt],B);Array.isArray(P)&&dt<P.length?Ot.fill(P[dt]):P&&!Array.isArray(P)&&Ot.fill(P),et.push(Ot)}}const it=p||await Gb(this.fileDirectory);return await this._readRaster(L,l,et,u,it,x,m,o,A)}async readRGB({window:i,interleave:l=!0,pool:u=null,width:p,height:x,resampleMethod:m,enableAlpha:o=!1,signal:P}={}){const A=i||[0,0,this.getWidth(),this.getHeight()];if(A[0]>A[2]||A[1]>A[3])throw new Error("Invalid subsets");const L=this.fileDirectory.PhotometricInterpretation;if(L===vs.RGB){let ft=[0,1,2];if(this.fileDirectory.ExtraSamples!==Cb.Unspecified&&o){ft=[];for(let dt=0;dt<this.fileDirectory.BitsPerSample.length;dt+=1)ft.push(dt)}return this.readRasters({window:i,interleave:l,samples:ft,pool:u,width:p,height:x,resampleMethod:m,signal:P})}let z;switch(L){case vs.WhiteIsZero:case vs.BlackIsZero:case vs.Palette:z=[0];break;case vs.CMYK:z=[0,1,2,3];break;case vs.YCbCr:case vs.CIELab:z=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const D={window:A,interleave:!0,samples:z,pool:u,width:p,height:x,resampleMethod:m,signal:P},{fileDirectory:B}=this,$=await this.readRasters(D),et=2**this.fileDirectory.BitsPerSample[0];let it;switch(L){case vs.WhiteIsZero:it=Rb($,et);break;case vs.BlackIsZero:it=Db($,et);break;case vs.Palette:it=zb($,B.ColorMap);break;case vs.CMYK:it=kb($);break;case vs.YCbCr:it=Lb($);break;case vs.CIELab:it=Nb($);break;default:throw new Error("Unsupported photometric interpretation.")}if(!l){const ft=new Uint8Array(it.length/3),dt=new Uint8Array(it.length/3),Ot=new Uint8Array(it.length/3);for(let jt=0,Gt=0;jt<it.length;jt+=3,++Gt)ft[Gt]=it[jt],dt[Gt]=it[jt+1],Ot[Gt]=it[jt+2];it=[ft,dt,Ot]}return it.width=$.width,it.height=$.height,it}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const i=[];for(let l=0;l<this.fileDirectory.ModelTiepoint.length;l+=6)i.push({i:this.fileDirectory.ModelTiepoint[l],j:this.fileDirectory.ModelTiepoint[l+1],k:this.fileDirectory.ModelTiepoint[l+2],x:this.fileDirectory.ModelTiepoint[l+3],y:this.fileDirectory.ModelTiepoint[l+4],z:this.fileDirectory.ModelTiepoint[l+5]});return i}getGDALMetadata(i=null){const l={};if(!this.fileDirectory.GDAL_METADATA)return null;const u=this.fileDirectory.GDAL_METADATA;let p=Eb(u,"Item");i===null?p=p.filter(x=>_p(x,"sample")===void 0):p=p.filter(x=>Number(_p(x,"sample"))===i);for(let x=0;x<p.length;++x){const m=p[x];l[_p(m,"name")]=m.inner}return l}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const i=this.fileDirectory.GDAL_NODATA;return Number(i.substring(0,i.length-1))}getOrigin(){const i=this.fileDirectory.ModelTiepoint,l=this.fileDirectory.ModelTransformation;if(i&&i.length===6)return[i[3],i[4],i[5]];if(l)return[l[3],l[7],l[11]];throw new Error("The image does not have an affine transformation.")}getResolution(i=null){const l=this.fileDirectory.ModelPixelScale,u=this.fileDirectory.ModelTransformation;if(l)return[l[0],-l[1],l[2]];if(u)return u[1]===0&&u[4]===0?[u[0],-u[5],u[10]]:[Math.sqrt(u[0]*u[0]+u[4]*u[4]),-Math.sqrt(u[1]*u[1]+u[5]*u[5]),u[10]];if(i){const[p,x,m]=i.getResolution();return[p*i.getWidth()/this.getWidth(),x*i.getHeight()/this.getHeight(),m*i.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(i=!1){const l=this.getHeight(),u=this.getWidth();if(this.fileDirectory.ModelTransformation&&!i){const[p,x,m,o,P,A,L,z]=this.fileDirectory.ModelTransformation,B=[[0,0],[0,l],[u,0],[u,l]].map(([it,ft])=>[o+p*it+x*ft,z+P*it+A*ft]),$=B.map(it=>it[0]),et=B.map(it=>it[1]);return[Math.min(...$),Math.min(...et),Math.max(...$),Math.max(...et)]}else{const p=this.getOrigin(),x=this.getResolution(),m=p[0],o=p[1],P=m+x[0]*u,A=o+x[1]*l;return[Math.min(m,P),Math.min(o,A),Math.max(m,P),Math.max(o,A)]}}}class Yb{constructor(i){this._dataView=new DataView(i)}get buffer(){return this._dataView.buffer}getUint64(i,l){const u=this.getUint32(i,l),p=this.getUint32(i+4,l);let x;if(l){if(x=u+2**32*p,!Number.isSafeInteger(x))throw new Error(`${x} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return x}if(x=2**32*u+p,!Number.isSafeInteger(x))throw new Error(`${x} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return x}getInt64(i,l){let u=0;const p=(this._dataView.getUint8(i+(l?7:0))&128)>0;let x=!0;for(let m=0;m<8;m++){let o=this._dataView.getUint8(i+(l?m:7-m));p&&(x?o!==0&&(o=~(o-1)&255,x=!1):o=~o&255),u+=o*256**m}return p&&(u=-u),u}getUint8(i,l){return this._dataView.getUint8(i,l)}getInt8(i,l){return this._dataView.getInt8(i,l)}getUint16(i,l){return this._dataView.getUint16(i,l)}getInt16(i,l){return this._dataView.getInt16(i,l)}getUint32(i,l){return this._dataView.getUint32(i,l)}getInt32(i,l){return this._dataView.getInt32(i,l)}getFloat16(i,l){return dy(this._dataView,i,l)}getFloat32(i,l){return this._dataView.getFloat32(i,l)}getFloat64(i,l){return this._dataView.getFloat64(i,l)}}class Jb{constructor(i,l,u,p){this._dataView=new DataView(i),this._sliceOffset=l,this._littleEndian=u,this._bigTiff=p}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(i,l){return this.sliceOffset<=i&&this.sliceTop>=i+l}readUint8(i){return this._dataView.getUint8(i-this._sliceOffset,this._littleEndian)}readInt8(i){return this._dataView.getInt8(i-this._sliceOffset,this._littleEndian)}readUint16(i){return this._dataView.getUint16(i-this._sliceOffset,this._littleEndian)}readInt16(i){return this._dataView.getInt16(i-this._sliceOffset,this._littleEndian)}readUint32(i){return this._dataView.getUint32(i-this._sliceOffset,this._littleEndian)}readInt32(i){return this._dataView.getInt32(i-this._sliceOffset,this._littleEndian)}readFloat32(i){return this._dataView.getFloat32(i-this._sliceOffset,this._littleEndian)}readFloat64(i){return this._dataView.getFloat64(i-this._sliceOffset,this._littleEndian)}readUint64(i){const l=this.readUint32(i),u=this.readUint32(i+4);let p;if(this._littleEndian){if(p=l+2**32*u,!Number.isSafeInteger(p))throw new Error(`${p} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return p}if(p=2**32*l+u,!Number.isSafeInteger(p))throw new Error(`${p} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return p}readInt64(i){let l=0;const u=(this._dataView.getUint8(i+(this._littleEndian?7:0))&128)>0;let p=!0;for(let x=0;x<8;x++){let m=this._dataView.getUint8(i+(this._littleEndian?x:7-x));u&&(p?m!==0&&(m=~(m-1)&255,p=!1):m=~m&255),l+=m*256**x}return u&&(l=-l),l}readOffset(i){return this._bigTiff?this.readUint64(i):this.readUint32(i)}}const U_=`\r
\r
`;function py(a){if(typeof Object.fromEntries<"u")return Object.fromEntries(a);const i={};for(const[l,u]of a)i[l.toLowerCase()]=u;return i}function Qb(a){const i=a.split(`\r
`).map(l=>{const u=l.split(":").map(p=>p.trim());return u[0]=u[0].toLowerCase(),u});return py(i)}function tw(a){const[i,...l]=a.split(";").map(p=>p.trim()),u=l.map(p=>p.split("="));return{type:i,params:py(u)}}function Vp(a){let i,l,u;return a&&([,i,l,u]=a.match(/bytes (\d+)-(\d+)\/(\d+)/),i=parseInt(i,10),l=parseInt(l,10),u=parseInt(u,10)),{start:i,end:l,total:u}}function ew(a,i){let l=null;const u=new TextDecoder("ascii"),p=[],x=`--${i}`,m=`${x}--`;for(let o=0;o<10;++o)u.decode(new Uint8Array(a,o,x.length))===x&&(l=o);if(l===null)throw new Error("Could not find initial boundary");for(;l<a.byteLength;){const o=u.decode(new Uint8Array(a,l,Math.min(x.length+1024,a.byteLength-l)));if(o.length===0||o.startsWith(m))break;if(!o.startsWith(x))throw new Error("Part does not start with boundary");const P=o.substr(x.length+2);if(P.length===0)break;const A=P.indexOf(U_),L=Qb(P.substr(0,A)),{start:z,end:D,total:B}=Vp(L["content-range"]),$=l+x.length+A+U_.length,et=parseInt(D,10)+1-parseInt(z,10);p.push({headers:L,data:a.slice($,$+et),offset:z,length:et,fileSize:B}),l=$+et+4}return p}class my{async fetch(i,l=void 0){return Promise.all(i.map(u=>this.fetchSlice(u,l)))}async fetchSlice(i){throw new Error(`fetching of slice ${i} not possible, not implemented`)}get fileSize(){return null}async close(){}}class iw extends Map{constructor(i={}){if(super(),!(i.maxSize&&i.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof i.maxAge=="number"&&i.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=i.maxSize,this.maxAge=i.maxAge||Number.POSITIVE_INFINITY,this.onEviction=i.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(i){if(typeof this.onEviction=="function")for(const[l,u]of i)this.onEviction(l,u.value)}_deleteIfExpired(i,l){return typeof l.expiry=="number"&&l.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(i,l.value),this.delete(i)):!1}_getOrDeleteIfExpired(i,l){if(this._deleteIfExpired(i,l)===!1)return l.value}_getItemValue(i,l){return l.expiry?this._getOrDeleteIfExpired(i,l):l.value}_peek(i,l){const u=l.get(i);return this._getItemValue(i,u)}_set(i,l){this.cache.set(i,l),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(i,l){this.oldCache.delete(i),this._set(i,l)}*_entriesAscending(){for(const i of this.oldCache){const[l,u]=i;this.cache.has(l)||this._deleteIfExpired(l,u)===!1&&(yield i)}for(const i of this.cache){const[l,u]=i;this._deleteIfExpired(l,u)===!1&&(yield i)}}get(i){if(this.cache.has(i)){const l=this.cache.get(i);return this._getItemValue(i,l)}if(this.oldCache.has(i)){const l=this.oldCache.get(i);if(this._deleteIfExpired(i,l)===!1)return this._moveToRecent(i,l),l.value}}set(i,l,{maxAge:u=this.maxAge}={}){const p=typeof u=="number"&&u!==Number.POSITIVE_INFINITY?Date.now()+u:void 0;return this.cache.has(i)?this.cache.set(i,{value:l,expiry:p}):this._set(i,{value:l,expiry:p}),this}has(i){return this.cache.has(i)?!this._deleteIfExpired(i,this.cache.get(i)):this.oldCache.has(i)?!this._deleteIfExpired(i,this.oldCache.get(i)):!1}peek(i){if(this.cache.has(i))return this._peek(i,this.cache);if(this.oldCache.has(i))return this._peek(i,this.oldCache)}delete(i){const l=this.cache.delete(i);return l&&this._size--,this.oldCache.delete(i)||l}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(i){if(!(i&&i>0))throw new TypeError("`maxSize` must be a number greater than 0");const l=[...this._entriesAscending()],u=l.length-i;u<0?(this.cache=new Map(l),this.oldCache=new Map,this._size=l.length):(u>0&&this._emitEvictions(l.slice(0,u)),this.oldCache=new Map(l.slice(u)),this.cache=new Map,this._size=0),this.maxSize=i}*keys(){for(const[i]of this)yield i}*values(){for(const[,i]of this)yield i}*[Symbol.iterator](){for(const i of this.cache){const[l,u]=i;this._deleteIfExpired(l,u)===!1&&(yield[l,u.value])}for(const i of this.oldCache){const[l,u]=i;this.cache.has(l)||this._deleteIfExpired(l,u)===!1&&(yield[l,u.value])}}*entriesDescending(){let i=[...this.cache];for(let l=i.length-1;l>=0;--l){const u=i[l],[p,x]=u;this._deleteIfExpired(p,x)===!1&&(yield[p,x.value])}i=[...this.oldCache];for(let l=i.length-1;l>=0;--l){const u=i[l],[p,x]=u;this.cache.has(p)||this._deleteIfExpired(p,x)===!1&&(yield[p,x.value])}}*entriesAscending(){for(const[i,l]of this._entriesAscending())yield[i,l.value]}get size(){if(!this._size)return this.oldCache.size;let i=0;for(const l of this.oldCache.keys())this.cache.has(l)||i++;return Math.min(this._size+i,this.maxSize)}entries(){return this.entriesAscending()}forEach(i,l=this){for(const[u,p]of this.entriesAscending())i.call(l,p,u,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function rw(a){return new Promise(i=>setTimeout(i,a))}function sw(a,i){const l=Array.isArray(a)?a:Array.from(a),u=Array.isArray(i)?i:Array.from(i);return l.map((p,x)=>[p,u[x]])}class Ul extends Error{constructor(i){super(i),Error.captureStackTrace&&Error.captureStackTrace(this,Ul),this.name="AbortError"}}class nw extends Error{constructor(i,l){super(l),this.errors=i,this.message=l,this.name="AggregateError"}}const aw=nw;class ow{constructor(i,l,u=null){this.offset=i,this.length=l,this.data=u}get top(){return this.offset+this.length}}class V_{constructor(i,l,u){this.offset=i,this.length=l,this.blockIds=u}}class lw extends my{constructor(i,{blockSize:l=65536,cacheSize:u=100}={}){super(),this.source=i,this.blockSize=l,this.blockCache=new iw({maxSize:u,onEviction:(p,x)=>{this.evictedBlocks.set(p,x)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(i,l){const u=[],p=[],x=[];this.evictedBlocks.clear();for(const{offset:D,length:B}of i){let $=D+B;const{fileSize:et}=this;et!==null&&($=Math.min($,et));const it=Math.floor(D/this.blockSize)*this.blockSize;for(let ft=it;ft<$;ft+=this.blockSize){const dt=Math.floor(ft/this.blockSize);!this.blockCache.has(dt)&&!this.blockRequests.has(dt)&&(this.blockIdsToFetch.add(dt),p.push(dt)),this.blockRequests.has(dt)&&u.push(this.blockRequests.get(dt)),x.push(dt)}}await rw(),this.fetchBlocks(l);const m=[];for(const D of p)this.blockRequests.has(D)&&m.push(this.blockRequests.get(D));await Promise.allSettled(u),await Promise.allSettled(m);const o=[],P=x.filter(D=>this.abortedBlockIds.has(D)||!this.blockCache.has(D));if(P.forEach(D=>this.blockIdsToFetch.add(D)),P.length>0&&l&&!l.aborted){this.fetchBlocks(null);for(const D of P){const B=this.blockRequests.get(D);if(!B)throw new Error(`Block ${D} is not in the block requests`);o.push(B)}await Promise.allSettled(o)}if(l&&l.aborted)throw new Ul("Request was aborted");const A=x.map(D=>this.blockCache.get(D)||this.evictedBlocks.get(D)),L=A.filter(D=>!D);if(L.length)throw new aw(L,"Request failed");const z=new Map(sw(x,A));return this.readSliceData(i,z)}fetchBlocks(i){if(this.blockIdsToFetch.size>0){const l=this.groupBlocks(this.blockIdsToFetch),u=this.source.fetch(l,i);for(let p=0;p<l.length;++p){const x=l[p];for(const m of x.blockIds)this.blockRequests.set(m,(async()=>{try{const o=(await u)[p],P=m*this.blockSize,A=P-o.offset,L=Math.min(A+this.blockSize,o.data.byteLength),z=o.data.slice(A,L),D=new ow(P,z.byteLength,z,m);this.blockCache.set(m,D),this.abortedBlockIds.delete(m)}catch(o){if(o.name==="AbortError")o.signal=i,this.blockCache.delete(m),this.abortedBlockIds.add(m);else throw o}finally{this.blockRequests.delete(m)}})())}this.blockIdsToFetch.clear()}}groupBlocks(i){const l=Array.from(i).sort((m,o)=>m-o);if(l.length===0)return[];let u=[],p=null;const x=[];for(const m of l)p===null||p+1===m?(u.push(m),p=m):(x.push(new V_(u[0]*this.blockSize,u.length*this.blockSize,u)),u=[m],p=m);return x.push(new V_(u[0]*this.blockSize,u.length*this.blockSize,u)),x}readSliceData(i,l){return i.map(u=>{let p=u.offset+u.length;this.fileSize!==null&&(p=Math.min(this.fileSize,p));const x=Math.floor(u.offset/this.blockSize),m=Math.floor(p/this.blockSize),o=new ArrayBuffer(u.length),P=new Uint8Array(o);for(let A=x;A<=m;++A){const L=l.get(A),z=L.offset-u.offset,D=L.top-p;let B=0,$=0,et;z<0?B=-z:z>0&&($=z),D<0?et=L.length-B:et=p-L.offset-B;const it=new Uint8Array(L.data,B,et);P.set(it,$)}return o})}}class hm{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(i){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class cm{constructor(i){this.url=i}async request({headers:i,signal:l}={}){throw new Error("request is not implemented")}}class hw extends hm{constructor(i){super(),this.response=i}get status(){return this.response.status}getHeader(i){return this.response.headers.get(i)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class cw extends cm{constructor(i,l){super(i),this.credentials=l}async request({headers:i,signal:l}={}){const u=await fetch(this.url,{headers:i,credentials:this.credentials,signal:l});return new hw(u)}}class uw extends hm{constructor(i,l){super(),this.xhr=i,this.data=l}get status(){return this.xhr.status}getHeader(i){return this.xhr.getResponseHeader(i)}async getData(){return this.data}}class dw extends cm{constructRequest(i,l){return new Promise((u,p)=>{const x=new XMLHttpRequest;x.open("GET",this.url),x.responseType="arraybuffer";for(const[m,o]of Object.entries(i))x.setRequestHeader(m,o);x.onload=()=>{const m=x.response;u(new uw(x,m))},x.onerror=p,x.onabort=()=>p(new Ul("Request aborted")),x.send(),l&&(l.aborted&&x.abort(),l.addEventListener("abort",()=>x.abort()))})}async request({headers:i,signal:l}={}){return await this.constructRequest(i,l)}}const vp={};class fw extends hm{constructor(i,l){super(),this.response=i,this.dataPromise=l}get status(){return this.response.statusCode}getHeader(i){return this.response.headers[i]}async getData(){return await this.dataPromise}}class pw extends cm{constructor(i){super(i),this.parsedUrl=vp.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",vp)}constructRequest(i,l){return new Promise((u,p)=>{const x=this.httpApi.get({...this.parsedUrl,headers:i},m=>{const o=new Promise(P=>{const A=[];m.on("data",L=>{A.push(L)}),m.on("end",()=>{const L=Buffer.concat(A).buffer;P(L)}),m.on("error",p)});u(new fw(m,o))});x.on("error",p),l&&(l.aborted&&x.destroy(new Ul("Request aborted")),l.addEventListener("abort",()=>x.destroy(new Ul("Request aborted"))))})}async request({headers:i,signal:l}={}){return await this.constructRequest(i,l)}}class um extends my{constructor(i,l,u,p){super(),this.client=i,this.headers=l,this.maxRanges=u,this.allowFullFile=p,this._fileSize=null}async fetch(i,l){return this.maxRanges>=i.length?this.fetchSlices(i,l):(this.maxRanges>0&&i.length>1,Promise.all(i.map(u=>this.fetchSlice(u,l))))}async fetchSlices(i,l){const u=await this.client.request({headers:{...this.headers,Range:`bytes=${i.map(({offset:p,length:x})=>`${p}-${p+x}`).join(",")}`},signal:l});if(u.ok)if(u.status===206){const{type:p,params:x}=tw(u.getHeader("content-type"));if(p==="multipart/byteranges"){const z=ew(await u.getData(),x.boundary);return this._fileSize=z[0].fileSize||null,z}const m=await u.getData(),{start:o,end:P,total:A}=Vp(u.getHeader("content-range"));this._fileSize=A||null;const L=[{data:m,offset:o,length:P-o}];if(i.length>1){const z=await Promise.all(i.slice(1).map(D=>this.fetchSlice(D,l)));return L.concat(z)}return L}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const p=await u.getData();return this._fileSize=p.byteLength,[{data:p,offset:0,length:p.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(i,l){const{offset:u,length:p}=i,x=await this.client.request({headers:{...this.headers,Range:`bytes=${u}-${u+p}`},signal:l});if(x.ok)if(x.status===206){const m=await x.getData(),{total:o}=Vp(x.getHeader("content-range"));return this._fileSize=o||null,{data:m,offset:u,length:p}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const m=await x.getData();return this._fileSize=m.byteLength,{data:m,offset:0,length:m.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function dm(a,{blockSize:i,cacheSize:l}){return i===null?a:new lw(a,{blockSize:i,cacheSize:l})}function mw(a,{headers:i={},credentials:l,maxRanges:u=0,allowFullFile:p=!1,...x}={}){const m=new cw(a,l),o=new um(m,i,u,p);return dm(o,x)}function gw(a,{headers:i={},maxRanges:l=0,allowFullFile:u=!1,...p}={}){const x=new dw(a),m=new um(x,i,l,u);return dm(m,p)}function _w(a,{headers:i={},maxRanges:l=0,allowFullFile:u=!1,...p}={}){const x=new pw(a),m=new um(x,i,l,u);return dm(m,p)}function yw(a,{forceXHR:i=!1,...l}={}){return typeof fetch=="function"&&!i?mw(a,l):typeof XMLHttpRequest<"u"?gw(a,l):_w(a,l)}function $p(a){switch(a){case ii.BYTE:case ii.ASCII:case ii.SBYTE:case ii.UNDEFINED:return 1;case ii.SHORT:case ii.SSHORT:return 2;case ii.LONG:case ii.SLONG:case ii.FLOAT:case ii.IFD:return 4;case ii.RATIONAL:case ii.SRATIONAL:case ii.DOUBLE:case ii.LONG8:case ii.SLONG8:case ii.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${a}`)}}function vw(a){const i=a.GeoKeyDirectory;if(!i)return null;const l={};for(let u=4;u<=i[3]*4;u+=4){const p=Ab[i[u]],x=i[u+1]?yc[i[u+1]]:null,m=i[u+2],o=i[u+3];let P=null;if(!x)P=o;else{if(P=a[x],typeof P>"u"||P===null)throw new Error(`Could not get value of geoKey '${p}'.`);typeof P=="string"?P=P.substring(o,o+m-1):P.subarray&&(P=P.subarray(o,o+m),m===1&&(P=P[0]))}l[p]=P}return l}function Sl(a,i,l,u){let p=null,x=null;const m=$p(i);switch(i){case ii.BYTE:case ii.ASCII:case ii.UNDEFINED:p=new Uint8Array(l),x=a.readUint8;break;case ii.SBYTE:p=new Int8Array(l),x=a.readInt8;break;case ii.SHORT:p=new Uint16Array(l),x=a.readUint16;break;case ii.SSHORT:p=new Int16Array(l),x=a.readInt16;break;case ii.LONG:case ii.IFD:p=new Uint32Array(l),x=a.readUint32;break;case ii.SLONG:p=new Int32Array(l),x=a.readInt32;break;case ii.LONG8:case ii.IFD8:p=new Array(l),x=a.readUint64;break;case ii.SLONG8:p=new Array(l),x=a.readInt64;break;case ii.RATIONAL:p=new Uint32Array(l*2),x=a.readUint32;break;case ii.SRATIONAL:p=new Int32Array(l*2),x=a.readInt32;break;case ii.FLOAT:p=new Float32Array(l),x=a.readFloat32;break;case ii.DOUBLE:p=new Float64Array(l),x=a.readFloat64;break;default:throw new RangeError(`Invalid field type: ${i}`)}if(i===ii.RATIONAL||i===ii.SRATIONAL)for(let o=0;o<l;o+=2)p[o]=x.call(a,u+o*m),p[o+1]=x.call(a,u+(o*m+4));else for(let o=0;o<l;++o)p[o]=x.call(a,u+o*m);return i===ii.ASCII?new TextDecoder("utf-8").decode(p):p}class xw{constructor(i,l,u){this.fileDirectory=i,this.geoKeyDirectory=l,this.nextIFDByteOffset=u}}class ld extends Error{constructor(i){super(`No image at index ${i}`),this.index=i}}class bw{async readRasters(i={}){const{window:l,width:u,height:p}=i;let{resX:x,resY:m,bbox:o}=i;const P=await this.getImage();let A=P;const L=await this.getImageCount(),z=P.getBoundingBox();if(l&&o)throw new Error('Both "bbox" and "window" passed.');if(u||p){if(l){const[$,et]=P.getOrigin(),[it,ft]=P.getResolution();o=[$+l[0]*it,et+l[1]*ft,$+l[2]*it,et+l[3]*ft]}const B=o||z;if(u){if(x)throw new Error("Both width and resX passed");x=(B[2]-B[0])/u}if(p){if(m)throw new Error("Both width and resY passed");m=(B[3]-B[1])/p}}if(x||m){const B=[];for(let $=0;$<L;++$){const et=await this.getImage($),{SubfileType:it,NewSubfileType:ft}=et.fileDirectory;($===0||it===2||ft&1)&&B.push(et)}B.sort(($,et)=>$.getWidth()-et.getWidth());for(let $=0;$<B.length;++$){const et=B[$],it=(z[2]-z[0])/et.getWidth(),ft=(z[3]-z[1])/et.getHeight();if(A=et,x&&x>it||m&&m>ft)break}}let D=l;if(o){const[B,$]=P.getOrigin(),[et,it]=A.getResolution(P);D=[Math.round((o[0]-B)/et),Math.round((o[1]-$)/it),Math.round((o[2]-B)/et),Math.round((o[3]-$)/it)],D=[Math.min(D[0],D[2]),Math.min(D[1],D[3]),Math.max(D[0],D[2]),Math.max(D[1],D[3])]}return A.readRasters({...i,window:D})}}class fm extends bw{constructor(i,l,u,p,x={}){super(),this.source=i,this.littleEndian=l,this.bigTiff=u,this.firstIFDOffset=p,this.cache=x.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(i,l){const u=this.bigTiff?4048:1024;return new Jb((await this.source.fetch([{offset:i,length:typeof l<"u"?l:u}]))[0],i,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(i){const l=this.bigTiff?20:12,u=this.bigTiff?8:2;let p=await this.getSlice(i);const x=this.bigTiff?p.readUint64(i):p.readUint16(i),m=x*l+(this.bigTiff?16:6);p.covers(i,m)||(p=await this.getSlice(i,m));const o={};let P=i+(this.bigTiff?8:2);for(let z=0;z<x;P+=l,++z){const D=p.readUint16(P),B=p.readUint16(P+2),$=this.bigTiff?p.readUint64(P+4):p.readUint32(P+4);let et,it;const ft=$p(B),dt=P+(this.bigTiff?12:8);if(ft*$<=(this.bigTiff?8:4))et=Sl(p,B,$,dt);else{const Ot=p.readOffset(dt),jt=$p(B)*$;if(p.covers(Ot,jt))et=Sl(p,B,$,Ot);else{const Gt=await this.getSlice(Ot,jt);et=Sl(Gt,B,$,Ot)}}$===1&&Ib.indexOf(D)===-1&&!(B===ii.RATIONAL||B===ii.SRATIONAL)?it=et[0]:it=et,o[yc[D]]=it}const A=vw(o),L=p.readOffset(i+u+l*x);return new xw(o,A,L)}async requestIFD(i){if(this.ifdRequests[i])return this.ifdRequests[i];if(i===0)return this.ifdRequests[i]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[i];if(!this.ifdRequests[i-1])try{this.ifdRequests[i-1]=this.requestIFD(i-1)}catch(l){throw l instanceof ld?new ld(i):l}return this.ifdRequests[i]=(async()=>{const l=await this.ifdRequests[i-1];if(l.nextIFDByteOffset===0)throw new ld(i);return this.parseFileDirectoryAt(l.nextIFDByteOffset)})(),this.ifdRequests[i]}async getImage(i=0){const l=await this.requestIFD(i);return new Kb(l.fileDirectory,l.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let i=0,l=!0;for(;l;)try{await this.requestIFD(i),++i}catch(u){if(u instanceof ld)l=!1;else throw u}return i}async getGhostValues(){const i=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const l="GDAL_STRUCTURAL_METADATA_SIZE=",u=l.length+100;let p=await this.getSlice(i,u);if(l===Sl(p,ii.ASCII,l.length,i)){const m=Sl(p,ii.ASCII,u,i).split(`
`)[0],o=Number(m.split("=")[1].split(" ")[0])+m.length;o>u&&(p=await this.getSlice(i,o));const P=Sl(p,ii.ASCII,o,i);this.ghostValues={},P.split(`
`).filter(A=>A.length>0).map(A=>A.split("=")).forEach(([A,L])=>{this.ghostValues[A]=L})}return this.ghostValues}static async fromSource(i,l,u){const p=(await i.fetch([{offset:0,length:1024}],u))[0],x=new Yb(p),m=x.getUint16(0,0);let o;if(m===18761)o=!0;else if(m===19789)o=!1;else throw new TypeError("Invalid byte order value.");const P=x.getUint16(2,o);let A;if(P===42)A=!1;else if(P===43){if(A=!0,x.getUint16(4,o)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const L=A?x.getUint64(8,o):x.getUint32(4,o);return new fm(i,o,A,L,l)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function ww(a,i={},l){return fm.fromSource(yw(a,i),l)}var yd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.0/LICENSE.txt
 */var Mw=yd.exports,$_;function Sw(){return $_||($_=1,function(a,i){(function(l,u){a.exports=u()})(Mw,function(){var l={},u={};function p(m,o,P){if(u[m]=P,m==="index"){var A="var sharedModule = {}; ("+u.shared+")(sharedModule); ("+u.worker+")(sharedModule);",L={};return u.shared(L),u.index(l,L),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([A],{type:"text/javascript"}))),l}}p("shared",["exports"],function(m){function o(n,e,s,h){return new(s||(s=Promise))(function(f,y){function v(E){try{S(h.next(E))}catch(C){y(C)}}function w(E){try{S(h.throw(E))}catch(C){y(C)}}function S(E){var C;E.done?f(E.value):(C=E.value,C instanceof s?C:new s(function(k){k(C)})).then(v,w)}S((h=h.apply(n,e||[])).next())})}function P(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var A,L;function z(){if(L)return A;function n(e,s){this.x=e,this.y=s}return L=1,A=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,s){return this.clone()._rotateAround(e,s)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var s=e.x-this.x,h=e.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,s){return Math.atan2(this.x*s-this.y*e,this.x*e+this.y*s)},_matMult:function(e){var s=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=s,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var s=Math.cos(e),h=Math.sin(e),f=h*this.x+s*this.y;return this.x=s*this.x-h*this.y,this.y=f,this},_rotateAround:function(e,s){var h=Math.cos(e),f=Math.sin(e),y=s.y+f*(this.x-s.x)+h*(this.y-s.y);return this.x=s.x+h*(this.x-s.x)-f*(this.y-s.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},A}typeof SuppressedError=="function"&&SuppressedError;var D,B,$=P(z()),et=function(){if(B)return D;function n(e,s,h,f){this.cx=3*e,this.bx=3*(h-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=h,this.p2y=f}return B=1,D=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var h=e,f=0;f<8;f++){var y=this.sampleCurveX(h)-e;if(Math.abs(y)<s)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=y/v}var w=0,S=1;for(h=e,f=0;f<20&&(y=this.sampleCurveX(h),!(Math.abs(y-e)<s));f++)e>y?w=h:S=h,h=.5*(S-w)+w;return h},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},D}(),it=P(et);let ft,dt;function Ot(){return ft==null&&(ft=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ft}function jt(){if(dt==null&&(dt=!1,Ot())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let h=0;h<5*5;h++){const f=4*h;e.fillStyle=`rgb(${f},${f+1},${f+2})`,e.fillRect(h%5,Math.floor(h/5),1,1)}const s=e.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&s[h]!==h){dt=!0;break}}}return dt||!1}var Gt=1e-6,re=typeof Float32Array<"u"?Float32Array:Array;function Ie(){var n=new re(9);return re!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function _e(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Re(){var n=new re(3);return re!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function ri(n){return Math.hypot(n[0],n[1],n[2])}function $e(n,e,s){var h=new re(3);return h[0]=n,h[1]=e,h[2]=s,h}function oi(n,e,s){return n[0]=e[0]+s[0],n[1]=e[1]+s[1],n[2]=e[2]+s[2],n}function Qe(n,e,s){return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n}function wi(n,e,s){var h=e[0],f=e[1],y=e[2],v=s[0],w=s[1],S=s[2];return n[0]=f*S-y*w,n[1]=y*v-h*S,n[2]=h*w-f*v,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var li,Ii=ri;function Ri(n,e,s){var h=e[0],f=e[1],y=e[2],v=e[3];return n[0]=s[0]*h+s[4]*f+s[8]*y+s[12]*v,n[1]=s[1]*h+s[5]*f+s[9]*y+s[13]*v,n[2]=s[2]*h+s[6]*f+s[10]*y+s[14]*v,n[3]=s[3]*h+s[7]*f+s[11]*y+s[15]*v,n}function Nt(){var n=new re(4);return re!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function qt(n,e,s,h){var f=.5*Math.PI/180;e*=f,s*=f,h*=f;var y=Math.sin(e),v=Math.cos(e),w=Math.sin(s),S=Math.cos(s),E=Math.sin(h),C=Math.cos(h);return n[0]=y*S*C-v*w*E,n[1]=v*w*C+y*S*E,n[2]=v*S*E-y*w*C,n[3]=v*S*C+y*w*E,n}function Xt(){var n=new re(2);return re!=Float32Array&&(n[0]=0,n[1]=0),n}function Dt(n,e){var s=new re(2);return s[0]=n,s[1]=e,s}Re(),li=new re(4),re!=Float32Array&&(li[0]=0,li[1]=0,li[2]=0,li[3]=0),Re(),$e(1,0,0),$e(0,1,0),Nt(),Nt(),Ie(),Xt();const Mt=8192;function Lt(n,e,s){return e*(Mt/(n.tileSize*Math.pow(2,s-n.tileID.overscaledZ)))}function ee(n,e){return(n%e+e)%e}function de(n,e,s){return n*(1-s)+e*s}function Ee(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,s=e*n;return 4*(n<.5?s:3*(n-e)+s-.75)}function me(n,e,s,h){const f=new it(n,e,s,h);return y=>f.solve(y)}const Ge=me(.25,.1,.25,1);function ae(n,e,s){return Math.min(s,Math.max(e,n))}function Se(n,e,s){const h=s-e,f=((n-e)%h+h)%h+e;return f===e?s:f}function ze(n,...e){for(const s of e)for(const h in s)n[h]=s[h];return n}let Wt=1;function oe(n,e,s){const h={};for(const f in n)h[f]=e.call(this,n[f],f,n);return h}function Ce(n,e,s){const h={};for(const f in n)e.call(this,n[f],f,n)&&(h[f]=n[f]);return h}function je(n){return Array.isArray(n)?n.map(je):typeof n=="object"&&n?oe(n,je):n}const Xe={};function De(n){Xe[n]||(typeof console<"u"&&console.warn(n),Xe[n]=!0)}function We(n,e,s){return(s.y-n.y)*(e.x-n.x)>(e.y-n.y)*(s.x-n.x)}function Ze(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let pi=null;function Be(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ae(n,e,s,h,f){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const y=new VideoFrame(n,{timestamp:0});try{const v=y==null?void 0:y.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const w=v.startsWith("BGR"),S=new Uint8ClampedArray(h*f*4);if(yield y.copyTo(S,function(E,C,k,N,U){const V=4*Math.max(1,0),W=(Math.max(0,k)-k)*N*4+V,K=4*N,rt=Math.max(0,C),_t=Math.max(0,k);return{rect:{x:rt,y:_t,width:Math.min(E.width,C+N)-rt,height:Math.min(E.height,k+U)-_t},layout:[{offset:W,stride:K}]}}(n,e,s,h,f)),w)for(let E=0;E<S.length;E+=4){const C=S[E];S[E]=S[E+2],S[E+2]=C}return S}finally{y.close()}})}let ci,Ti;function ir(n,e,s,h){return n.addEventListener(e,s,h),{unsubscribe:()=>{n.removeEventListener(e,s,h)}}}function Vi(n){return n*Math.PI/180}function xr(n){return n/Math.PI*180}const br={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ni={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Di="AbortError";function yt(){return new Error(Di)}const Z={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function X(n){return Z.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Y="global-dispatcher";class at extends Error{constructor(e,s,h,f){super(`AJAXError: ${s} (${e}): ${h}`),this.status=e,this.statusText=s,this.url=h,this.body=f}}const gt=()=>Ze(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,bt=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const h=X(n.url);if(h)return h(n,e);if(Ze(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Y},e)}if(!(/^file:/.test(s=n.url)||/^file:/.test(gt())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(h,f){return o(this,void 0,void 0,function*(){const y=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:gt(),signal:f.signal});let v,w;h.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");try{v=yield fetch(y)}catch(E){throw new at(0,E.message,h.url,new Blob)}if(!v.ok){const E=yield v.blob();throw new at(v.status,v.statusText,h.url,E)}w=h.type==="arrayBuffer"||h.type==="image"?v.arrayBuffer():h.type==="json"?v.json():v.text();const S=yield w;if(f.signal.aborted)throw yt();return{data:S,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}})}(n,e);if(Ze(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Y},e)}var s;return function(h,f){return new Promise((y,v)=>{var w;const S=new XMLHttpRequest;S.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(S.responseType="arraybuffer");for(const E in h.headers)S.setRequestHeader(E,h.headers[E]);h.type==="json"&&(S.responseType="text",!((w=h.headers)===null||w===void 0)&&w.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=h.credentials==="include",S.onerror=()=>{v(new Error(S.statusText))},S.onload=()=>{if(!f.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let E=S.response;if(h.type==="json")try{E=JSON.parse(S.response)}catch(C){return void v(C)}y({data:E,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const E=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});v(new at(S.status,S.statusText,h.url,E))}},f.signal.addEventListener("abort",()=>{S.abort(),v(yt())}),S.send(h.body)})}(n,e)};function Tt(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),s=window.location;return e.protocol===s.protocol&&e.host===s.host}function vt(n,e,s){s[n]&&s[n].indexOf(e)!==-1||(s[n]=s[n]||[],s[n].push(e))}function zt(n,e,s){if(s&&s[n]){const h=s[n].indexOf(e);h!==-1&&s[n].splice(h,1)}}class At{constructor(e,s={}){ze(this,s),this.type=e}}class wt extends At{constructor(e,s={}){super("error",ze({error:e},s))}}class Bt{on(e,s){return this._listeners=this._listeners||{},vt(e,s,this._listeners),{unsubscribe:()=>{this.off(e,s)}}}off(e,s){return zt(e,s,this._listeners),zt(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},vt(e,s,this._oneTimeListeners),this):new Promise(h=>this.once(e,h))}fire(e,s){typeof e=="string"&&(e=new At(e,s||{}));const h=e.type;if(this.listens(h)){e.target=this;const f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of f)w.call(this,e);const y=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of y)zt(h,w,this._oneTimeListeners),w.call(this,e);const v=this._eventedParent;v&&(ze(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(e))}else e instanceof wt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ie=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ve(n,e){const s={};for(const h in n)h!=="ref"&&(s[h]=n[h]);return ie.forEach(h=>{h in e&&(s[h]=e[h])}),s}function se(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let s=0;s<n.length;s++)if(!se(n[s],e[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const s in n)if(!se(n[s],e[s]))return!1;return!0}return n===e}function ge(n,e){n.push(e)}function Te(n,e,s){ge(s,{command:"addSource",args:[n,e[n]]})}function fi(n,e,s){ge(e,{command:"removeSource",args:[n]}),s[n]=!0}function hi(n,e,s,h){fi(n,s,h),Te(n,e,s)}function ti(n,e,s){let h;for(h in n[s])if(Object.prototype.hasOwnProperty.call(n[s],h)&&h!=="data"&&!se(n[s][h],e[s][h]))return!1;for(h in e[s])if(Object.prototype.hasOwnProperty.call(e[s],h)&&h!=="data"&&!se(n[s][h],e[s][h]))return!1;return!0}function be(n,e,s,h,f,y){n=n||{},e=e||{};for(const v in n)Object.prototype.hasOwnProperty.call(n,v)&&(se(n[v],e[v])||s.push({command:y,args:[h,v,e[v],f]}));for(const v in e)Object.prototype.hasOwnProperty.call(e,v)&&!Object.prototype.hasOwnProperty.call(n,v)&&(se(n[v],e[v])||s.push({command:y,args:[h,v,e[v],f]}))}function qe(n){return n.id}function qi(n,e){return n[e.id]=e,n}class Ht{constructor(e,s,h,f){this.message=(e?`${e}: `:"")+h,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function Hi(n,...e){for(const s of e)for(const h in s)n[h]=s[h];return n}class Mi extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class Fr{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[h,f]of s)this.bindings[h]=f}concat(e){return new Fr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ts={kind:"null"},Yt={kind:"number"},ke={kind:"string"},Le={kind:"boolean"},rr={kind:"color"},Ds={kind:"projectionDefinition"},Br={kind:"object"},Oe={kind:"value"},zs={kind:"collator"},vn={kind:"formatted"},Zi={kind:"padding"},Pa={kind:"colorArray"},Ea={kind:"numberArray"},ks={kind:"resolvedImage"},Ia={kind:"variableAnchorOffsetCollection"};function qr(n,e){return{kind:"array",itemType:n,N:e}}function zi(n){if(n.kind==="array"){const e=zi(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Vc=[ts,Yt,ke,Le,rr,Ds,vn,Br,qr(Oe),Zi,Ea,Pa,ks,Ia];function Ca(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ca(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const s of Vc)if(!Ca(s,e))return null}}return`Expected ${zi(n)} but found ${zi(e)} instead.`}function Eo(n,e){return e.some(s=>s.kind===n.kind)}function xn(n,e){return e.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function Hs(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const $c=.96422,qc=.82521,Zc=4/29,Bn=6/29,Wc=3*Bn*Bn,Xc=Bn*Bn*Bn,Aa=Math.PI/180,Hd=180/Math.PI;function Hc(n){return(n%=360)<0&&(n+=360),n}function Nn([n,e,s,h]){let f,y;const v=Jl((.2225045*(n=Yl(n))+.7168786*(e=Yl(e))+.0606169*(s=Yl(s)))/1);n===e&&e===s?f=y=v:(f=Jl((.4360747*n+.3850649*e+.1430804*s)/$c),y=Jl((.0139322*n+.0971045*e+.7141733*s)/qc));const w=116*v-16;return[w<0?0:w,500*(f-v),200*(v-y),h]}function Yl(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Jl(n){return n>Xc?Math.pow(n,1/3):n/Wc+Zc}function Kc([n,e,s,h]){let f=(n+16)/116,y=isNaN(e)?f:f+e/500,v=isNaN(s)?f:f-s/200;return f=1*Co(f),y=$c*Co(y),v=qc*Co(v),[Io(3.1338561*y-1.6168667*f-.4906146*v),Io(-.9787684*y+1.9161415*f+.033454*v),Io(.0719453*y-.2289914*f+1.4052427*v),h]}function Io(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Co(n){return n>Bn?n*n*n:Wc*(n-Zc)}const bs=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function He(n,e){return bs(n,e)?n[e]:void 0}function Ls(n){return parseInt(n.padEnd(2,n),16)/255}function Os(n,e){return bn(e?n/100:n,0,1)}function bn(n,e,s){return Math.min(Math.max(e,n),s)}function Ql(n){return!n.some(Number.isNaN)}const th={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function es(n,e,s){return n+s*(e-n)}function Fs(n,e,s){return n.map((h,f)=>es(h,e[f],s))}class Ke{constructor(e,s,h,f=1,y=!0){this.r=e,this.g=s,this.b=h,this.a=f,y||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[e,s,h,f]))}static parse(e){if(e instanceof Ke)return e;if(typeof e!="string")return;const s=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=He(th,h);if(f){const[v,w,S]=f;return[v/255,w/255,S/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const v=h.length<6?1:2;let w=1;return[Ls(h.slice(w,w+=v)),Ls(h.slice(w,w+=v)),Ls(h.slice(w,w+=v)),Ls(h.slice(w,w+v)||"ff")]}if(h.startsWith("rgb")){const v=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,S,E,C,k,N,U,V,W,K,rt,_t]=v,lt=[C||" ",U||" ",K].join("");if(lt==="  "||lt==="  /"||lt===",,"||lt===",,,"){const j=[E,N,W].join(""),H=j==="%%%"?100:j===""?255:0;if(H){const ct=[bn(+S/H,0,1),bn(+k/H,0,1),bn(+V/H,0,1),rt?Os(+rt,_t):1];if(Ql(ct))return ct}}return}}const y=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,w,S,E,C,k,N,U,V]=y,W=[S||" ",C||" ",N].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const K=[+w,bn(+E,0,100),bn(+k,0,100),U?Os(+U,V):1];if(Ql(K))return function([rt,_t,lt,j]){function H(ct){const Et=(ct+rt/30)%12,Ut=_t*Math.min(lt,1-lt);return lt-Ut*Math.max(-1,Math.min(Et-3,9-Et,1))}return rt=Hc(rt),_t/=100,lt/=100,[H(0),H(8),H(4),j]}(K)}}}(e);return s?new Ke(...s,!1):void 0}get rgb(){const{r:e,g:s,b:h,a:f}=this,y=f||1/0;return this.overwriteGetter("rgb",[e/y,s/y,h/y,f])}get hcl(){return this.overwriteGetter("hcl",function(e){const[s,h,f,y]=Nn(e),v=Math.sqrt(h*h+f*f);return[Math.round(1e4*v)?Hc(Math.atan2(f,h)*Hd):NaN,v,s,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Nn(this.rgb))}overwriteGetter(e,s){return Object.defineProperty(this,e,{value:s}),s}toString(){const[e,s,h,f]=this.rgb;return`rgba(${[e,s,h].map(y=>Math.round(255*y)).join(",")},${f})`}static interpolate(e,s,h,f="rgb"){switch(f){case"rgb":{const[y,v,w,S]=Fs(e.rgb,s.rgb,h);return new Ke(y,v,w,S,!1)}case"hcl":{const[y,v,w,S]=e.hcl,[E,C,k,N]=s.hcl;let U,V;if(isNaN(y)||isNaN(E))isNaN(y)?isNaN(E)?U=NaN:(U=E,w!==1&&w!==0||(V=C)):(U=y,k!==1&&k!==0||(V=v));else{let lt=E-y;E>y&&lt>180?lt-=360:E<y&&y-E>180&&(lt+=360),U=y+h*lt}const[W,K,rt,_t]=function([lt,j,H,ct]){return lt=isNaN(lt)?0:lt*Aa,Kc([H,Math.cos(lt)*j,Math.sin(lt)*j,ct])}([U,V??es(v,C,h),es(w,k,h),es(S,N,h)]);return new Ke(W,K,rt,_t,!1)}case"lab":{const[y,v,w,S]=Kc(Fs(e.lab,s.lab,h));return new Ke(y,v,w,S,!1)}}}}Ke.black=new Ke(0,0,0,1),Ke.white=new Ke(1,1,1,1),Ke.transparent=new Ke(0,0,0,0),Ke.red=new Ke(1,0,0,1);class Ra{constructor(e,s,h){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ao=["bottom","center","top"];class eh{constructor(e,s,h,f,y,v){this.text=e,this.image=s,this.scale=h,this.fontStack=f,this.textColor=y,this.verticalAlign=v}}class wr{constructor(e){this.sections=e}static fromString(e){return new wr([new eh(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof wr?e:wr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Ki{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ki)return e;if(typeof e=="number")return new Ki([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const s of e)if(typeof s!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Ki(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,s,h){return new Ki(Fs(e.values,s.values,h))}}class Mr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Mr)return e;if(typeof e=="number")return new Mr([e]);if(Array.isArray(e)){for(const s of e)if(typeof s!="number")return;return new Mr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,s,h){return new Mr(Fs(e.values,s.values,h))}}class sr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof sr)return e;if(typeof e=="string"){const h=Ke.parse(e);return h?new sr([h]):void 0}if(!Array.isArray(e))return;const s=[];for(const h of e){if(typeof h!="string")return;const f=Ke.parse(h);if(!f)return;s.push(f)}return new sr(s)}toString(){return JSON.stringify(this.values)}static interpolate(e,s,h,f="rgb"){const y=[];if(e.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let v=0;v<e.values.length;v++)y.push(Ke.interpolate(e.values[v],s.values[v],h,f));return new sr(y)}}class ki extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Ro=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class si{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof si)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let s=0;s<e.length;s+=2){const h=e[s],f=e[s+1];if(typeof h!="string"||!Ro.has(h)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new si(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,s,h){const f=e.values,y=s.values;if(f.length!==y.length)throw new ki(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${s.toString()}`);const v=[];for(let w=0;w<f.length;w+=2){if(f[w]!==y[w])throw new ki(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${y[w]}`);v.push(f[w]);const[S,E]=f[w+1],[C,k]=y[w+1];v.push([es(S,C,h),es(E,k,h)])}return new si(v)}}class Nr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Nr({name:e,available:!1}):null}}class Fe{constructor(e,s,h){this.from=e,this.to=s,this.transition=h}static interpolate(e,s,h){return new Fe(e,s,h)}static parse(e){return e instanceof Fe?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Fe(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Fe(e.from,e.to,e.transition):typeof e=="string"?new Fe(e,e,1):void 0}}function Ue(n,e,s,h){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[n,e,s,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[n,e,s,h]:[n,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wn(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Fe||n instanceof Ke||n instanceof Ra||n instanceof wr||n instanceof Ki||n instanceof Mr||n instanceof sr||n instanceof si||n instanceof Nr)return!0;if(Array.isArray(n)){for(const e of n)if(!wn(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!wn(n[e]))return!1;return!0}return!1}function Pe(n){if(n===null)return ts;if(typeof n=="string")return ke;if(typeof n=="boolean")return Le;if(typeof n=="number")return Yt;if(n instanceof Ke)return rr;if(n instanceof Fe)return Ds;if(n instanceof Ra)return zs;if(n instanceof wr)return vn;if(n instanceof Ki)return Zi;if(n instanceof Mr)return Ea;if(n instanceof sr)return Pa;if(n instanceof si)return Ia;if(n instanceof Nr)return ks;if(Array.isArray(n)){const e=n.length;let s;for(const h of n){const f=Pe(h);if(s){if(s===f)continue;s=Oe;break}s=f}return qr(s||Oe,e)}return Br}function Mn(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ke||n instanceof Fe||n instanceof wr||n instanceof Ki||n instanceof Mr||n instanceof sr||n instanceof si||n instanceof Nr?n.toString():JSON.stringify(n)}class Er{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!wn(e[1]))return s.error("invalid value");const h=e[1];let f=Pe(h);const y=s.expectedType;return f.kind!=="array"||f.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(f=y),new Er(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Gn={string:ke,number:Yt,boolean:Le,object:Br};class is{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let h,f=1;const y=e[0];if(y==="array"){let w,S;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in Gn)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=Gn[E],f++}else w=Oe;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);S=e[2],f++}h=qr(w,S)}else{if(!Gn[y])throw new Error(`Types doesn't contain name = ${y}`);h=Gn[y]}const v=[];for(;f<e.length;f++){const w=s.parse(e[f],f,Oe);if(!w)return null;v.push(w)}return new is(h,v)}evaluate(e){for(let s=0;s<this.args.length;s++){const h=this.args[s].evaluate(e);if(!Ca(this.type,Pe(h)))return h;if(s===this.args.length-1)throw new ki(`Expected value to be of type ${zi(this.type)}, but found ${zi(Pe(h))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ih={"to-boolean":Le,"to-color":rr,"to-number":Yt,"to-string":ke};class ws{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const h=e[0];if(!ih[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&e.length!==2)return s.error("Expected one argument.");const f=ih[h],y=[];for(let v=1;v<e.length;v++){const w=s.parse(e[v],v,Oe);if(!w)return null;y.push(w)}return new ws(f,y)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let s,h;for(const f of this.args){if(s=f.evaluate(e),h=null,s instanceof Ke)return s;if(typeof s=="string"){const y=e.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(h=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Ue(s[0],s[1],s[2],s[3]),!h))return new Ke(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new ki(h||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const h of this.args){s=h.evaluate(e);const f=Ki.parse(s);if(f)return f}throw new ki(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const h of this.args){s=h.evaluate(e);const f=Mr.parse(s);if(f)return f}throw new ki(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const h of this.args){s=h.evaluate(e);const f=sr.parse(s);if(f)return f}throw new ki(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const h of this.args){s=h.evaluate(e);const f=si.parse(s);if(f)return f}throw new ki(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const h of this.args){if(s=h.evaluate(e),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new ki(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return wr.fromString(Mn(this.args[0].evaluate(e)));case"resolvedImage":return Nr.fromString(Mn(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Mn(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Yc=["Unknown","Point","LineString","Polygon"];class Jc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Yc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let s=this._parseColorCache.get(e);return s||(s=Ke.parse(e),this._parseColorCache.set(e,s)),s}}class Da{constructor(e,s,h=[],f,y=new Fr,v=[]){this.registry=e,this.path=h,this.key=h.map(w=>`[${w}]`).join(""),this.scope=y,this.errors=v,this.expectedType=f,this._isConstant=s}parse(e,s,h,f,y={}){return s?this.concat(s,h,f)._parse(e,y):this._parse(e,y)}_parse(e,s){function h(f,y,v){return v==="assert"?new is(y,[f]):v==="coerce"?new ws(y,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=e[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[f];if(y){let v=y.parse(e,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,S=v.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||S.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(S.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(S.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(S.kind)||w.kind==="colorArray"&&["value","string","array"].includes(S.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(S.kind))v=h(v,w,s.typeAnnotation||"coerce");else if(this.checkSubtype(w,S))return null}else v=h(v,w,s.typeAnnotation||"assert")}if(!(v instanceof Er)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const w=new Jc;try{v=new Er(v.type,v.evaluate(w))}catch(S){return this.error(S.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,h){const f=typeof e=="number"?this.path.concat(e):this.path,y=h?this.scope.concat(h):this.scope;return new Da(this.registry,this._isConstant,f,s||null,y,this.errors)}error(e,...s){const h=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new Mi(h,e))}checkSubtype(e,s){const h=Ca(e,s);return h&&this.error(h),h}}class za{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const h=[];for(let y=1;y<e.length-1;y+=2){const v=e[y];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,y);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const w=s.parse(e[y+1],y+1);if(!w)return null;h.push([v,w])}const f=s.parse(e[e.length-1],e.length-1,s.expectedType,h);return f?new za(h,f):null}outputDefined(){return this.result.outputDefined()}}class cs{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const h=e[1];return s.scope.has(h)?new cs(h,s.scope.get(h)):s.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class nr{constructor(e,s,h){this.type=e,this.index=s,this.input=h}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,Yt),f=s.parse(e[2],2,qr(s.expectedType||Oe));return h&&f?new nr(f.type.itemType,h,f):null}evaluate(e){const s=this.index.evaluate(e),h=this.input.evaluate(e);if(s<0)throw new ki(`Array index out of bounds: ${s} < 0.`);if(s>=h.length)throw new ki(`Array index out of bounds: ${s} > ${h.length-1}.`);if(s!==Math.floor(s))throw new ki(`Array index must be an integer, but found ${s} instead.`);return h[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class jn{constructor(e,s){this.type=Le,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,Oe),f=s.parse(e[2],2,Oe);return h&&f?Eo(h.type,[Le,ke,Yt,ts,Oe])?new jn(h,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${zi(h.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!h)return!1;if(!xn(s,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${zi(Pe(s))} instead.`);if(!xn(h,["string","array"]))throw new ki(`Expected second argument to be of type array or string, but found ${zi(Pe(h))} instead.`);return h.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ka{constructor(e,s,h){this.type=Yt,this.needle=e,this.haystack=s,this.fromIndex=h}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,Oe),f=s.parse(e[2],2,Oe);if(!h||!f)return null;if(!Eo(h.type,[Le,ke,Yt,ts,Oe]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${zi(h.type)} instead`);if(e.length===4){const y=s.parse(e[3],3,Yt);return y?new ka(h,f,y):null}return new ka(h,f)}evaluate(e){const s=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!xn(s,["boolean","string","number","null"]))throw new ki(`Expected first argument to be of type boolean, string, number or null, but found ${zi(Pe(s))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(e)),xn(h,["string"])){const y=h.indexOf(s,f);return y===-1?-1:[...h.slice(0,y)].length}if(xn(h,["array"]))return h.indexOf(s,f);throw new ki(`Expected second argument to be of type array or string, but found ${zi(Pe(h))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Un{constructor(e,s,h,f,y,v){this.inputType=e,this.type=s,this.input=h,this.cases=f,this.outputs=y,this.otherwise=v}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let h,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const y={},v=[];for(let E=2;E<e.length-1;E+=2){let C=e[E];const k=e[E+1];Array.isArray(C)||(C=[C]);const N=s.concat(E);if(C.length===0)return N.error("Expected at least one branch label.");for(const V of C){if(typeof V!="number"&&typeof V!="string")return N.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return N.error("Numeric branch labels must be integer values.");if(h){if(N.checkSubtype(h,Pe(V)))return null}else h=Pe(V);if(y[String(V)]!==void 0)return N.error("Branch labels must be unique.");y[String(V)]=v.length}const U=s.parse(k,E,f);if(!U)return null;f=f||U.type,v.push(U)}const w=s.parse(e[1],1,Oe);if(!w)return null;const S=s.parse(e[e.length-1],e.length-1,f);return S?w.type.kind!=="value"&&s.concat(1).checkSubtype(h,w.type)?null:new Un(h,f,w,y,v,S):null}evaluate(e){const s=this.input.evaluate(e);return(Pe(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Yi{constructor(e,s,h){this.type=e,this.branches=s,this.otherwise=h}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const f=[];for(let v=1;v<e.length-1;v+=2){const w=s.parse(e[v],v,Le);if(!w)return null;const S=s.parse(e[v+1],v+1,h);if(!S)return null;f.push([w,S]),h=h||S.type}const y=s.parse(e[e.length-1],e.length-1,h);if(!y)return null;if(!h)throw new Error("Can't infer output type");return new Yi(h,f,y)}evaluate(e){for(const[s,h]of this.branches)if(s.evaluate(e))return h.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,h]of this.branches)e(s),e(h);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class La{constructor(e,s,h,f){this.type=e,this.input=s,this.beginIndex=h,this.endIndex=f}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,Oe),f=s.parse(e[2],2,Yt);if(!h||!f)return null;if(!Eo(h.type,[qr(Oe),ke,Oe]))return s.error(`Expected first argument to be of type array or string, but found ${zi(h.type)} instead`);if(e.length===4){const y=s.parse(e[3],3,Yt);return y?new La(h.type,h,f,y):null}return new La(h.type,h,f)}evaluate(e){const s=this.input.evaluate(e),h=this.beginIndex.evaluate(e);let f;if(this.endIndex&&(f=this.endIndex.evaluate(e)),xn(s,["string"]))return[...s].slice(h,f).join("");if(xn(s,["array"]))return s.slice(h,f);throw new ki(`Expected first argument to be of type array or string, but found ${zi(Pe(s))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Vn(n,e){const s=n.length-1;let h,f,y=0,v=s,w=0;for(;y<=v;)if(w=Math.floor((y+v)/2),h=n[w],f=n[w+1],h<=e){if(w===s||e<f)return w;y=w+1}else{if(!(h>e))throw new ki("Input is not a number.");v=w-1}return 0}class $n{constructor(e,s,h){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[f,y]of h)this.labels.push(f),this.outputs.push(y)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const h=s.parse(e[1],1,Yt);if(!h)return null;const f=[];let y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(let v=1;v<e.length;v+=2){const w=v===1?-1/0:e[v],S=e[v+1],E=v,C=v+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const k=s.parse(S,C,y);if(!k)return null;y=y||k.type,f.push([w,k])}return new $n(y,h,f)}evaluate(e){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(e);const f=this.input.evaluate(e);if(f<=s[0])return h[0].evaluate(e);const y=s.length;return f>=s[y-1]?h[y-1].evaluate(e):h[Vn(s,f)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Kd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ks,Oa,rh=function(){if(Oa)return Ks;function n(e,s,h,f){this.cx=3*e,this.bx=3*(h-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=h,this.p2y=f}return Oa=1,Ks=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var h=e,f=0;f<8;f++){var y=this.sampleCurveX(h)-e;if(Math.abs(y)<s)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=y/v}var w=0,S=1;for(h=e,f=0;f<20&&(y=this.sampleCurveX(h),!(Math.abs(y-e)<s));f++)e>y?w=h:S=h,h=.5*(S-w)+w;return h},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},Ks}(),Yd=Kd(rh);class Ir{constructor(e,s,h,f,y){this.type=e,this.operator=s,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(const[v,w]of y)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(e,s,h,f){let y=0;if(e.name==="exponential")y=qn(s,e.base,h,f);else if(e.name==="linear")y=qn(s,1,h,f);else if(e.name==="cubic-bezier"){const v=e.controlPoints;y=new Yd(v[0],v[1],v[2],v[3]).solve(qn(s,1,h,f))}return y}static parse(e,s){let[h,f,y,...v]=e;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const E=f[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const E=f.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,Yt),!y)return null;const w=[];let S=null;h!=="interpolate-hcl"&&h!=="interpolate-lab"||s.expectedType==Pa?s.expectedType&&s.expectedType.kind!=="value"&&(S=s.expectedType):S=rr;for(let E=0;E<v.length;E+=2){const C=v[E],k=v[E+1],N=E+3,U=E+4;if(typeof C!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(w.length&&w[w.length-1][0]>=C)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const V=s.parse(k,U,S);if(!V)return null;S=S||V.type,w.push([C,V])}return Hs(S,Yt)||Hs(S,Ds)||Hs(S,rr)||Hs(S,Zi)||Hs(S,Ea)||Hs(S,Pa)||Hs(S,Ia)||Hs(S,qr(Yt))?new Ir(S,h,f,y,w):s.error(`Type ${zi(S)} is not interpolatable.`)}evaluate(e){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(e);const f=this.input.evaluate(e);if(f<=s[0])return h[0].evaluate(e);const y=s.length;if(f>=s[y-1])return h[y-1].evaluate(e);const v=Vn(s,f),w=Ir.interpolationFactor(this.interpolation,f,s[v],s[v+1]),S=h[v].evaluate(e),E=h[v+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return es(S,E,w);case"color":return Ke.interpolate(S,E,w);case"padding":return Ki.interpolate(S,E,w);case"colorArray":return sr.interpolate(S,E,w);case"numberArray":return Mr.interpolate(S,E,w);case"variableAnchorOffsetCollection":return si.interpolate(S,E,w);case"array":return Fs(S,E,w);case"projectionDefinition":return Fe.interpolate(S,E,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ke.interpolate(S,E,w,"hcl");case"colorArray":return sr.interpolate(S,E,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ke.interpolate(S,E,w,"lab");case"colorArray":return sr.interpolate(S,E,w,"lab")}}}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function qn(n,e,s,h){const f=h-s,y=n-s;return f===0?0:e===1?y/f:(Math.pow(e,y)-1)/(Math.pow(e,f)-1)}const Zr={color:Ke.interpolate,number:es,padding:Ki.interpolate,numberArray:Mr.interpolate,colorArray:sr.interpolate,variableAnchorOffsetCollection:si.interpolate,array:Fs};class Gr{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let h=null;const f=s.expectedType;f&&f.kind!=="value"&&(h=f);const y=[];for(const w of e.slice(1)){const S=s.parse(w,1+y.length,h,void 0,{typeAnnotation:"omit"});if(!S)return null;h=h||S.type,y.push(S)}if(!h)throw new Error("No output type");const v=f&&y.some(w=>Ca(f,w.type));return new Gr(v?Oe:h,y)}evaluate(e){let s,h=null,f=0;for(const y of this.args)if(f++,h=y.evaluate(e),h&&h instanceof Nr&&!h.available&&(s||(s=h.name),h=null,f===this.args.length&&(h=s)),h!==null)break;return h}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function sh(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Fa(n,e,s,h){return h.compare(e,s)===0}function Zn(n,e,s){const h=n!=="=="&&n!=="!=";return class gy{constructor(y,v,w){this.type=Le,this.lhs=y,this.rhs=v,this.collator=w,this.hasUntypedArgument=y.type.kind==="value"||v.type.kind==="value"}static parse(y,v){if(y.length!==3&&y.length!==4)return v.error("Expected two or three arguments.");const w=y[0];let S=v.parse(y[1],1,Oe);if(!S)return null;if(!sh(w,S.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${zi(S.type)}'.`);let E=v.parse(y[2],2,Oe);if(!E)return null;if(!sh(w,E.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${zi(E.type)}'.`);if(S.type.kind!==E.type.kind&&S.type.kind!=="value"&&E.type.kind!=="value")return v.error(`Cannot compare types '${zi(S.type)}' and '${zi(E.type)}'.`);h&&(S.type.kind==="value"&&E.type.kind!=="value"?S=new is(E.type,[S]):S.type.kind!=="value"&&E.type.kind==="value"&&(E=new is(S.type,[E])));let C=null;if(y.length===4){if(S.type.kind!=="string"&&E.type.kind!=="string"&&S.type.kind!=="value"&&E.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(C=v.parse(y[3],3,zs),!C)return null}return new gy(S,E,C)}evaluate(y){const v=this.lhs.evaluate(y),w=this.rhs.evaluate(y);if(h&&this.hasUntypedArgument){const S=Pe(v),E=Pe(w);if(S.kind!==E.kind||S.kind!=="string"&&S.kind!=="number")throw new ki(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${S.kind}, ${E.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const S=Pe(v),E=Pe(w);if(S.kind!=="string"||E.kind!=="string")return e(y,v,w)}return this.collator?s(y,v,w,this.collator.evaluate(y)):e(y,v,w)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const nh=Zn("==",function(n,e,s){return e===s},Fa),Jd=Zn("!=",function(n,e,s){return e!==s},function(n,e,s,h){return!Fa(0,e,s,h)}),Qd=Zn("<",function(n,e,s){return e<s},function(n,e,s,h){return h.compare(e,s)<0}),tf=Zn(">",function(n,e,s){return e>s},function(n,e,s,h){return h.compare(e,s)>0}),ef=Zn("<=",function(n,e,s){return e<=s},function(n,e,s,h){return h.compare(e,s)<=0}),Do=Zn(">=",function(n,e,s){return e>=s},function(n,e,s,h){return h.compare(e,s)>=0});class zo{constructor(e,s,h){this.type=zs,this.locale=h,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const h=e[1];if(typeof h!="object"||Array.isArray(h))return s.error("Collator options argument must be an object.");const f=s.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Le);if(!f)return null;const y=s.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Le);if(!y)return null;let v=null;return h.locale&&(v=s.parse(h.locale,1,ke),!v)?null:new zo(f,y,v)}evaluate(e){return new Ra(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class ko{constructor(e,s,h,f,y){this.type=ke,this.number=e,this.locale=s,this.currency=h,this.minFractionDigits=f,this.maxFractionDigits=y}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const h=s.parse(e[1],1,Yt);if(!h)return null;const f=e[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let y=null;if(f.locale&&(y=s.parse(f.locale,1,ke),!y))return null;let v=null;if(f.currency&&(v=s.parse(f.currency,1,ke),!v))return null;let w=null;if(f["min-fraction-digits"]&&(w=s.parse(f["min-fraction-digits"],1,Yt),!w))return null;let S=null;return f["max-fraction-digits"]&&(S=s.parse(f["max-fraction-digits"],1,Yt),!S)?null:new ko(h,y,v,w,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ba{constructor(e){this.type=vn,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const h=e[1];if(!Array.isArray(h)&&typeof h=="object")return s.error("First argument must be an image or text section.");const f=[];let y=!1;for(let v=1;v<=e.length-1;++v){const w=e[v];if(y&&typeof w=="object"&&!Array.isArray(w)){y=!1;let S=null;if(w["font-scale"]&&(S=s.parse(w["font-scale"],1,Yt),!S))return null;let E=null;if(w["text-font"]&&(E=s.parse(w["text-font"],1,qr(ke)),!E))return null;let C=null;if(w["text-color"]&&(C=s.parse(w["text-color"],1,rr),!C))return null;let k=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!Ao.includes(w["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(k=s.parse(w["vertical-align"],1,ke),!k)return null}const N=f[f.length-1];N.scale=S,N.font=E,N.textColor=C,N.verticalAlign=k}else{const S=s.parse(e[v],1,Oe);if(!S)return null;const E=S.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,f.push({content:S,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ba(f)}evaluate(e){return new wr(this.sections.map(s=>{const h=s.content.evaluate(e);return Pe(h)===ks?new eh("",h,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(e):null):new eh(Mn(h),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null,s.verticalAlign?s.verticalAlign.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor),s.verticalAlign&&e(s.verticalAlign)}outputDefined(){return!1}}class ah{constructor(e){this.type=ks,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");const h=s.parse(e[1],1,ke);return h?new ah(h):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),h=Nr.fromString(s);return h&&e.availableImages&&(h.available=e.availableImages.indexOf(s)>-1),h}eachChild(e){e(this.input)}outputDefined(){return!1}}class Lo{constructor(e){this.type=Yt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const h=s.parse(e[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${zi(h.type)} instead.`):new Lo(h):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new ki(`Expected value to be of type string or array, but found ${zi(Pe(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ms=8192;function rf(n,e){const s=(180+n[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(s*f*Ms),Math.round(h*f*Ms)]}function oh(n,e){const s=Math.pow(2,e.z);return[(f=(n[0]/Ms+e.x)/s,360*f-180),(h=(n[1]/Ms+e.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,f}function Na(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Ga(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Qc(n,e,s){const h=n[0]-e[0],f=n[1]-e[1],y=n[0]-s[0],v=n[1]-s[1];return h*v-y*f==0&&h*y<=0&&f*v<=0}function ja(n,e,s,h){return(f=[h[0]-s[0],h[1]-s[1]])[0]*(y=[e[0]-n[0],e[1]-n[1]])[1]-f[1]*y[0]!=0&&!(!Oo(n,e,s,h)||!Oo(s,h,n,e));var f,y}function tu(n,e,s){for(const h of s)for(let f=0;f<h.length-1;++f)if(ja(n,e,h[f],h[f+1]))return!0;return!1}function Wn(n,e,s=!1){let h=!1;for(const w of e)for(let S=0;S<w.length-1;S++){if(Qc(n,w[S],w[S+1]))return s;(y=w[S])[1]>(f=n)[1]!=(v=w[S+1])[1]>f[1]&&f[0]<(v[0]-y[0])*(f[1]-y[1])/(v[1]-y[1])+y[0]&&(h=!h)}var f,y,v;return h}function sf(n,e){for(const s of e)if(Wn(n,s))return!0;return!1}function eu(n,e){for(const s of n)if(!Wn(s,e))return!1;for(let s=0;s<n.length-1;++s)if(tu(n[s],n[s+1],e))return!1;return!0}function nf(n,e){for(const s of e)if(eu(n,s))return!0;return!1}function Oo(n,e,s,h){const f=h[0]-s[0],y=h[1]-s[1],v=(n[0]-s[0])*y-f*(n[1]-s[1]),w=(e[0]-s[0])*y-f*(e[1]-s[1]);return v>0&&w<0||v<0&&w>0}function lh(n,e,s){const h=[];for(let f=0;f<n.length;f++){const y=[];for(let v=0;v<n[f].length;v++){const w=rf(n[f][v],s);Na(e,w),y.push(w)}h.push(y)}return h}function iu(n,e,s){const h=[];for(let f=0;f<n.length;f++){const y=lh(n[f],e,s);h.push(y)}return h}function ru(n,e,s,h){if(n[0]<s[0]||n[0]>s[2]){const f=.5*h;let y=n[0]-s[0]>f?-h:s[0]-n[0]>f?h:0;y===0&&(y=n[0]-s[2]>f?-h:s[2]-n[0]>f?h:0),n[0]+=y}Na(e,n)}function hh(n,e,s,h){const f=Math.pow(2,h.z)*Ms,y=[h.x*Ms,h.y*Ms],v=[];for(const w of n)for(const S of w){const E=[S.x+y[0],S.y+y[1]];ru(E,e,s,f),v.push(E)}return v}function ch(n,e,s,h){const f=Math.pow(2,h.z)*Ms,y=[h.x*Ms,h.y*Ms],v=[];for(const S of n){const E=[];for(const C of S){const k=[C.x+y[0],C.y+y[1]];Na(e,k),E.push(k)}v.push(E)}if(e[2]-e[0]<=f/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const S of v)for(const E of S)ru(E,e,s,f)}var w;return v}class Sn{constructor(e,s){this.type=Le,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(wn(e[1])){const h=e[1];if(h.type==="FeatureCollection"){const f=[];for(const y of h.features){const{type:v,coordinates:w}=y.geometry;v==="Polygon"&&f.push(w),v==="MultiPolygon"&&f.push(...w)}if(f.length)return new Sn(h,{type:"MultiPolygon",coordinates:f})}else if(h.type==="Feature"){const f=h.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Sn(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Sn(h,h)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,h){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(h.type==="Polygon"){const w=lh(h.coordinates,y,v),S=hh(s.geometry(),f,y,v);if(!Ga(f,y))return!1;for(const E of S)if(!Wn(E,w))return!1}if(h.type==="MultiPolygon"){const w=iu(h.coordinates,y,v),S=hh(s.geometry(),f,y,v);if(!Ga(f,y))return!1;for(const E of S)if(!sf(E,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,h){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(h.type==="Polygon"){const w=lh(h.coordinates,y,v),S=ch(s.geometry(),f,y,v);if(!Ga(f,y))return!1;for(const E of S)if(!eu(E,w))return!1}if(h.type==="MultiPolygon"){const w=iu(h.coordinates,y,v),S=ch(s.geometry(),f,y,v);if(!Ga(f,y))return!1;for(const E of S)if(!nf(E,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let su=class{constructor(n=[],e=(s,h)=>s<h?-1:s>h?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:s}=this,h=e[n];for(;n>0;){const f=n-1>>1,y=e[f];if(s(h,y)>=0)break;e[n]=y,n=f}e[n]=h}_down(n){const{data:e,compare:s}=this,h=this.length>>1,f=e[n];for(;n<h;){let y=1+(n<<1);const v=y+1;if(v<this.length&&s(e[v],e[y])<0&&(y=v),s(e[y],f)>=0)break;e[n]=e[y],n=y}e[n]=f}};function uh(n,e,s=0,h=n.length-1,f=af){for(;h>s;){if(h-s>600){const S=h-s+1,E=e-s+1,C=Math.log(S),k=.5*Math.exp(2*C/3),N=.5*Math.sqrt(C*k*(S-k)/S)*(E-S/2<0?-1:1);uh(n,e,Math.max(s,Math.floor(e-E*k/S+N)),Math.min(h,Math.floor(e+(S-E)*k/S+N)),f)}const y=n[e];let v=s,w=h;for(Xn(n,s,e),f(n[h],y)>0&&Xn(n,s,h);v<w;){for(Xn(n,v,w),v++,w--;f(n[v],y)<0;)v++;for(;f(n[w],y)>0;)w--}f(n[s],y)===0?Xn(n,s,w):(w++,Xn(n,w,h)),w<=e&&(s=w+1),e<=w&&(h=w-1)}}function Xn(n,e,s){const h=n[e];n[e]=n[s],n[s]=h}function af(n,e){return n<e?-1:n>e?1:0}function Fo(n,e){if(n.length<=1)return[n];const s=[];let h,f;for(const y of n){const v=nu(y);v!==0&&(y.area=Math.abs(v),f===void 0&&(f=v<0),f===v<0?(h&&s.push(h),h=[y]):h.push(y))}if(h&&s.push(h),e>1)for(let y=0;y<s.length;y++)s[y].length<=e||(uh(s[y],e,1,s[y].length-1,of),s[y]=s[y].slice(0,e));return s}function of(n,e){return e.area-n.area}function nu(n){let e=0;for(let s,h,f=0,y=n.length,v=y-1;f<y;v=f++)s=n[f],h=n[v],e+=(h.x-s.x)*(s.y+h.y);return e}const au=1/298.257223563,ou=au*(2-au),lu=Math.PI/180;class dh{constructor(e){const s=6378.137*lu*1e3,h=Math.cos(e*lu),f=1/(1-ou*(1-h*h)),y=Math.sqrt(f);this.kx=s*y*h,this.ky=s*y*f*(1-ou)}distance(e,s){const h=this.wrap(e[0]-s[0])*this.kx,f=(e[1]-s[1])*this.ky;return Math.sqrt(h*h+f*f)}pointOnLine(e,s){let h,f,y,v,w=1/0;for(let S=0;S<e.length-1;S++){let E=e[S][0],C=e[S][1],k=this.wrap(e[S+1][0]-E)*this.kx,N=(e[S+1][1]-C)*this.ky,U=0;k===0&&N===0||(U=(this.wrap(s[0]-E)*this.kx*k+(s[1]-C)*this.ky*N)/(k*k+N*N),U>1?(E=e[S+1][0],C=e[S+1][1]):U>0&&(E+=k/this.kx*U,C+=N/this.ky*U)),k=this.wrap(s[0]-E)*this.kx,N=(s[1]-C)*this.ky;const V=k*k+N*N;V<w&&(w=V,h=E,f=C,y=S,v=U)}return{point:[h,f],index:y,t:Math.max(0,Math.min(1,v))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function ui(n,e){return e[0]-n[0]}function Bo(n){return n[1]-n[0]+1}function Bs(n,e){return n[1]>=n[0]&&n[1]<e}function fh(n,e){if(n[0]>n[1])return[null,null];const s=Bo(n);if(e){if(s===2)return[n,null];const f=Math.floor(s/2);return[[n[0],n[0]+f],[n[0]+f,n[1]]]}if(s===1)return[n,null];const h=Math.floor(s/2)-1;return[[n[0],n[0]+h],[n[0]+h+1,n[1]]]}function ph(n,e){if(!Bs(e,n.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let h=e[0];h<=e[1];++h)Na(s,n[h]);return s}function mh(n){const e=[1/0,1/0,-1/0,-1/0];for(const s of n)for(const h of s)Na(e,h);return e}function hu(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function gh(n,e,s){if(!hu(n)||!hu(e))return NaN;let h=0,f=0;return n[2]<e[0]&&(h=e[0]-n[2]),n[0]>e[2]&&(h=n[0]-e[2]),n[1]>e[3]&&(f=n[1]-e[3]),n[3]<e[1]&&(f=e[1]-n[3]),s.distance([0,0],[h,f])}function Tn(n,e,s){const h=s.pointOnLine(e,n);return s.distance(n,h.point)}function _h(n,e,s,h,f){const y=Math.min(Tn(n,[s,h],f),Tn(e,[s,h],f)),v=Math.min(Tn(s,[n,e],f),Tn(h,[n,e],f));return Math.min(y,v)}function lf(n,e,s,h,f){if(!Bs(e,n.length)||!Bs(h,s.length))return 1/0;let y=1/0;for(let v=e[0];v<e[1];++v){const w=n[v],S=n[v+1];for(let E=h[0];E<h[1];++E){const C=s[E],k=s[E+1];if(ja(w,S,C,k))return 0;y=Math.min(y,_h(w,S,C,k,f))}}return y}function hf(n,e,s,h,f){if(!Bs(e,n.length)||!Bs(h,s.length))return NaN;let y=1/0;for(let v=e[0];v<=e[1];++v)for(let w=h[0];w<=h[1];++w)if(y=Math.min(y,f.distance(n[v],s[w])),y===0)return y;return y}function cf(n,e,s){if(Wn(n,e,!0))return 0;let h=1/0;for(const f of e){const y=f[0],v=f[f.length-1];if(y!==v&&(h=Math.min(h,Tn(n,[v,y],s)),h===0))return h;const w=s.pointOnLine(f,n);if(h=Math.min(h,s.distance(n,w.point)),h===0)return h}return h}function uf(n,e,s,h){if(!Bs(e,n.length))return NaN;for(let y=e[0];y<=e[1];++y)if(Wn(n[y],s,!0))return 0;let f=1/0;for(let y=e[0];y<e[1];++y){const v=n[y],w=n[y+1];for(const S of s)for(let E=0,C=S.length,k=C-1;E<C;k=E++){const N=S[k],U=S[E];if(ja(v,w,N,U))return 0;f=Math.min(f,_h(v,w,N,U,h))}}return f}function cu(n,e){for(const s of n)for(const h of s)if(Wn(h,e,!0))return!0;return!1}function df(n,e,s,h=1/0){const f=mh(n),y=mh(e);if(h!==1/0&&gh(f,y,s)>=h)return h;if(Ga(f,y)){if(cu(n,e))return 0}else if(cu(e,n))return 0;let v=1/0;for(const w of n)for(let S=0,E=w.length,C=E-1;S<E;C=S++){const k=w[C],N=w[S];for(const U of e)for(let V=0,W=U.length,K=W-1;V<W;K=V++){const rt=U[K],_t=U[V];if(ja(k,N,rt,_t))return 0;v=Math.min(v,_h(k,N,rt,_t,s))}}return v}function uu(n,e,s,h,f,y){if(!y)return;const v=gh(ph(h,y),f,s);v<e&&n.push([v,y,[0,0]])}function No(n,e,s,h,f,y,v){if(!y||!v)return;const w=gh(ph(h,y),ph(f,v),s);w<e&&n.push([w,y,v])}function Go(n,e,s,h,f=1/0){let y=Math.min(h.distance(n[0],s[0][0]),f);if(y===0)return y;const v=new su([[0,[0,n.length-1],[0,0]]],ui),w=mh(s);for(;v.length>0;){const S=v.pop();if(S[0]>=y)continue;const E=S[1],C=e?50:100;if(Bo(E)<=C){if(!Bs(E,n.length))return NaN;if(e){const k=uf(n,E,s,h);if(isNaN(k)||k===0)return k;y=Math.min(y,k)}else for(let k=E[0];k<=E[1];++k){const N=cf(n[k],s,h);if(y=Math.min(y,N),y===0)return 0}}else{const k=fh(E,e);uu(v,y,h,n,w,k[0]),uu(v,y,h,n,w,k[1])}}return y}function jo(n,e,s,h,f,y=1/0){let v=Math.min(y,f.distance(n[0],s[0]));if(v===0)return v;const w=new su([[0,[0,n.length-1],[0,s.length-1]]],ui);for(;w.length>0;){const S=w.pop();if(S[0]>=v)continue;const E=S[1],C=S[2],k=e?50:100,N=h?50:100;if(Bo(E)<=k&&Bo(C)<=N){if(!Bs(E,n.length)&&Bs(C,s.length))return NaN;let U;if(e&&h)U=lf(n,E,s,C,f),v=Math.min(v,U);else if(e&&!h){const V=n.slice(E[0],E[1]+1);for(let W=C[0];W<=C[1];++W)if(U=Tn(s[W],V,f),v=Math.min(v,U),v===0)return v}else if(!e&&h){const V=s.slice(C[0],C[1]+1);for(let W=E[0];W<=E[1];++W)if(U=Tn(n[W],V,f),v=Math.min(v,U),v===0)return v}else U=hf(n,E,s,C,f),v=Math.min(v,U)}else{const U=fh(E,e),V=fh(C,h);No(w,v,f,n,s,U[0],V[0]),No(w,v,f,n,s,U[0],V[1]),No(w,v,f,n,s,U[1],V[0]),No(w,v,f,n,s,U[1],V[1])}}return v}function yh(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class Pn{constructor(e,s){this.type=Yt,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(wn(e[1])){const h=e[1];if(h.type==="FeatureCollection")return new Pn(h,h.features.map(f=>yh(f.geometry)).flat());if(h.type==="Feature")return new Pn(h,yh(h.geometry));if("type"in h&&"coordinates"in h)return new Pn(h,yh(h))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,h){const f=s.geometry(),y=f.flat().map(S=>oh([S.x,S.y],s.canonical));if(f.length===0)return NaN;const v=new dh(y[0][1]);let w=1/0;for(const S of h){switch(S.type){case"Point":w=Math.min(w,jo(y,!1,[S.coordinates],!1,v,w));break;case"LineString":w=Math.min(w,jo(y,!1,S.coordinates,!0,v,w));break;case"Polygon":w=Math.min(w,Go(y,!1,S.coordinates,v,w))}if(w===0)return w}return w}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,h){const f=s.geometry(),y=f.flat().map(S=>oh([S.x,S.y],s.canonical));if(f.length===0)return NaN;const v=new dh(y[0][1]);let w=1/0;for(const S of h){switch(S.type){case"Point":w=Math.min(w,jo(y,!0,[S.coordinates],!1,v,w));break;case"LineString":w=Math.min(w,jo(y,!0,S.coordinates,!0,v,w));break;case"Polygon":w=Math.min(w,Go(y,!0,S.coordinates,v,w))}if(w===0)return w}return w}(e,this.geometries);if(e.geometryType()==="Polygon")return function(s,h){const f=s.geometry();if(f.length===0||f[0].length===0)return NaN;const y=Fo(f,0).map(S=>S.map(E=>E.map(C=>oh([C.x,C.y],s.canonical)))),v=new dh(y[0][0][0][1]);let w=1/0;for(const S of h)for(const E of y){switch(S.type){case"Point":w=Math.min(w,Go([S.coordinates],!1,E,v,w));break;case"LineString":w=Math.min(w,Go(S.coordinates,!0,E,v,w));break;case"Polygon":w=Math.min(w,df(E,S.coordinates,v,w))}if(w===0)return w}return w}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ua{constructor(e){this.type=Oe,this.key=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const h=e[1];return h==null?s.error("Global state property must be defined."):typeof h!="string"?s.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ua(h)}evaluate(e){var s;const h=(s=e.globals)===null||s===void 0?void 0:s.globalState;return h&&Object.keys(h).length!==0?He(h,this.key):null}eachChild(){}outputDefined(){return!1}}const Hn={"==":nh,"!=":Jd,">":tf,"<":Qd,">=":Do,"<=":ef,array:is,at:nr,boolean:is,case:Yi,coalesce:Gr,collator:zo,format:Ba,image:ah,in:jn,"index-of":ka,interpolate:Ir,"interpolate-hcl":Ir,"interpolate-lab":Ir,length:Lo,let:za,literal:Er,match:Un,number:is,"number-format":ko,object:is,slice:La,step:$n,string:is,"to-boolean":ws,"to-color":ws,"to-number":ws,"to-string":ws,var:cs,within:Sn,distance:Pn,"global-state":Ua};class rs{constructor(e,s,h,f){this.name=e,this.type=s,this._evaluate=h,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,s){const h=e[0],f=rs.definitions[h];if(!f)return s.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=v.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let S=null;for(const[E,C]of w){S=new Da(s.registry,Uo,s.path,null,s.scope);const k=[];let N=!1;for(let U=1;U<e.length;U++){const V=e[U],W=Array.isArray(E)?E[U-1]:E.type,K=S.parse(V,1+k.length,W);if(!K){N=!0;break}k.push(K)}if(!N)if(Array.isArray(E)&&E.length!==k.length)S.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let U=0;U<k.length;U++){const V=Array.isArray(E)?E[U]:E.type,W=k[U];S.concat(U+1).checkSubtype(V,W.type)}if(S.errors.length===0)return new rs(h,y,C,k)}}if(w.length===1)s.errors.push(...S.errors);else{const E=(w.length?w:v).map(([k])=>{return N=k,Array.isArray(N)?`(${N.map(zi).join(", ")})`:`(${zi(N.type)}...)`;var N}).join(" | "),C=[];for(let k=1;k<e.length;k++){const N=s.parse(e[k],1+C.length);if(!N)return null;C.push(zi(N.type))}s.error(`Expected arguments of type ${E}, but found (${C.join(", ")}) instead.`)}return null}static register(e,s){rs.definitions=s;for(const h in s)e[h]=rs}}function du(n,[e,s,h,f]){e=e.evaluate(n),s=s.evaluate(n),h=h.evaluate(n);const y=f?f.evaluate(n):1,v=Ue(e,s,h,y);if(v)throw new ki(v);return new Ke(e/255,s/255,h/255,y,!1)}function fu(n,e){return n in e}function vh(n,e){const s=e[n];return s===void 0?null:s}function En(n){return{type:n}}function Uo(n){if(n instanceof cs)return Uo(n.boundExpression);if(n instanceof rs&&n.name==="error"||n instanceof zo||n instanceof Sn||n instanceof Pn||n instanceof Ua)return!1;const e=n instanceof ws||n instanceof is;let s=!0;return n.eachChild(h=>{s=e?s&&Uo(h):s&&h instanceof Er}),!!s&&Vo(n)&&Kn(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Vo(n){if(n instanceof rs&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Sn||n instanceof Pn)return!1;let e=!0;return n.eachChild(s=>{e&&!Vo(s)&&(e=!1)}),e}function Va(n){if(n instanceof rs&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(s=>{e&&!Va(s)&&(e=!1)}),e}function Kn(n,e){if(n instanceof rs&&e.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(h=>{s&&!Kn(h,e)&&(s=!1)}),s}function pu(n){return{result:"success",value:n}}function Yn(n){return{result:"error",value:n}}function Jn(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function xh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function bh(n){return!!n.expression&&n.expression.interpolated}function Ye(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function In(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Pe(n)===Br}function mu(n){return n}function gu(n,e){const s=n.stops&&typeof n.stops[0][0]=="object",h=s||!(s||n.property!==void 0),f=n.type||(bh(e)?"exponential":"interval"),y=function(C){switch(C.type){case"color":return Ke.parse;case"padding":return Ki.parse;case"numberArray":return Mr.parse;case"colorArray":return sr.parse;default:return null}}(e);if(y&&((n=Hi({},n)).stops&&(n.stops=n.stops.map(C=>[C[0],y(C[1])])),n.default=y(n.default?n.default:e.default)),n.colorSpace&&(v=n.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var v;const w=function(C){switch(C){case"exponential":return _u;case"interval":return pf;case"categorical":return ff;case"identity":return yu;default:throw new Error(`Unknown function type "${C}"`)}}(f);let S,E;if(f==="categorical"){S=Object.create(null);for(const C of n.stops)S[C[0]]=C[1];E=typeof n.stops[0][0]}if(s){const C={},k=[];for(let V=0;V<n.stops.length;V++){const W=n.stops[V],K=W[0].zoom;C[K]===void 0&&(C[K]={zoom:K,type:n.type,property:n.property,default:n.default,stops:[]},k.push(K)),C[K].stops.push([W[0].value,W[1]])}const N=[];for(const V of k)N.push([C[V].zoom,gu(C[V],e)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:Ir.interpolationFactor.bind(void 0,U),zoomStops:N.map(V=>V[0]),evaluate:({zoom:V},W)=>_u({stops:N,base:n.base},e,V).evaluate(V,W)}}if(h){const C=f==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Ir.interpolationFactor.bind(void 0,C),zoomStops:n.stops.map(k=>k[0]),evaluate:({zoom:k})=>w(n,e,k,S,E)}}return{kind:"source",evaluate(C,k){const N=k&&k.properties?k.properties[n.property]:void 0;return N===void 0?$a(n.default,e.default):w(n,e,N,S,E)}}}function $a(n,e,s){return n!==void 0?n:e!==void 0?e:s!==void 0?s:void 0}function ff(n,e,s,h,f){return $a(typeof s===f?h[s]:void 0,n.default,e.default)}function pf(n,e,s){if(Ye(s)!=="number")return $a(n.default,e.default);const h=n.stops.length;if(h===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[h-1][0])return n.stops[h-1][1];const f=Vn(n.stops.map(y=>y[0]),s);return n.stops[f][1]}function _u(n,e,s){const h=n.base!==void 0?n.base:1;if(Ye(s)!=="number")return $a(n.default,e.default);const f=n.stops.length;if(f===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[f-1][0])return n.stops[f-1][1];const y=Vn(n.stops.map(C=>C[0]),s),v=function(C,k,N,U){const V=U-N,W=C-N;return V===0?0:k===1?W/V:(Math.pow(k,W)-1)/(Math.pow(k,V)-1)}(s,h,n.stops[y][0],n.stops[y+1][0]),w=n.stops[y][1],S=n.stops[y+1][1],E=Zr[e.type]||mu;return typeof w.evaluate=="function"?{evaluate(...C){const k=w.evaluate.apply(void 0,C),N=S.evaluate.apply(void 0,C);if(k!==void 0&&N!==void 0)return E(k,N,v,n.colorSpace)}}:E(w,S,v,n.colorSpace)}function yu(n,e,s){switch(e.type){case"color":s=Ke.parse(s);break;case"formatted":s=wr.fromString(s.toString());break;case"resolvedImage":s=Nr.fromString(s.toString());break;case"padding":s=Ki.parse(s);break;case"colorArray":s=sr.parse(s);break;case"numberArray":s=Mr.parse(s);break;default:Ye(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0)}return $a(s,n.default,e.default)}rs.register(Hn,{error:[{kind:"error"},[ke],(n,[e])=>{throw new ki(e.evaluate(n))}],typeof:[ke,[Oe],(n,[e])=>zi(Pe(e.evaluate(n)))],"to-rgba":[qr(Yt,4),[rr],(n,[e])=>{const[s,h,f,y]=e.evaluate(n).rgb;return[255*s,255*h,255*f,y]}],rgb:[rr,[Yt,Yt,Yt],du],rgba:[rr,[Yt,Yt,Yt,Yt],du],has:{type:Le,overloads:[[[ke],(n,[e])=>fu(e.evaluate(n),n.properties())],[[ke,Br],(n,[e,s])=>fu(e.evaluate(n),s.evaluate(n))]]},get:{type:Oe,overloads:[[[ke],(n,[e])=>vh(e.evaluate(n),n.properties())],[[ke,Br],(n,[e,s])=>vh(e.evaluate(n),s.evaluate(n))]]},"feature-state":[Oe,[ke],(n,[e])=>vh(e.evaluate(n),n.featureState||{})],properties:[Br,[],n=>n.properties()],"geometry-type":[ke,[],n=>n.geometryType()],id:[Oe,[],n=>n.id()],zoom:[Yt,[],n=>n.globals.zoom],"heatmap-density":[Yt,[],n=>n.globals.heatmapDensity||0],elevation:[Yt,[],n=>n.globals.elevation||0],"line-progress":[Yt,[],n=>n.globals.lineProgress||0],accumulated:[Oe,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Yt,En(Yt),(n,e)=>{let s=0;for(const h of e)s+=h.evaluate(n);return s}],"*":[Yt,En(Yt),(n,e)=>{let s=1;for(const h of e)s*=h.evaluate(n);return s}],"-":{type:Yt,overloads:[[[Yt,Yt],(n,[e,s])=>e.evaluate(n)-s.evaluate(n)],[[Yt],(n,[e])=>-e.evaluate(n)]]},"/":[Yt,[Yt,Yt],(n,[e,s])=>e.evaluate(n)/s.evaluate(n)],"%":[Yt,[Yt,Yt],(n,[e,s])=>e.evaluate(n)%s.evaluate(n)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(n,[e,s])=>Math.pow(e.evaluate(n),s.evaluate(n))],sqrt:[Yt,[Yt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Yt,[Yt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Yt,[Yt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Yt,[Yt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Yt,[Yt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Yt,[Yt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Yt,[Yt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Yt,[Yt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Yt,[Yt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Yt,[Yt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Yt,En(Yt),(n,e)=>Math.min(...e.map(s=>s.evaluate(n)))],max:[Yt,En(Yt),(n,e)=>Math.max(...e.map(s=>s.evaluate(n)))],abs:[Yt,[Yt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Yt,[Yt],(n,[e])=>{const s=e.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[Yt,[Yt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Yt,[Yt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Le,[ke,Oe],(n,[e,s])=>n.properties()[e.value]===s.value],"filter-id-==":[Le,[Oe],(n,[e])=>n.id()===e.value],"filter-type-==":[Le,[ke],(n,[e])=>n.geometryType()===e.value],"filter-<":[Le,[ke,Oe],(n,[e,s])=>{const h=n.properties()[e.value],f=s.value;return typeof h==typeof f&&h<f}],"filter-id-<":[Le,[Oe],(n,[e])=>{const s=n.id(),h=e.value;return typeof s==typeof h&&s<h}],"filter->":[Le,[ke,Oe],(n,[e,s])=>{const h=n.properties()[e.value],f=s.value;return typeof h==typeof f&&h>f}],"filter-id->":[Le,[Oe],(n,[e])=>{const s=n.id(),h=e.value;return typeof s==typeof h&&s>h}],"filter-<=":[Le,[ke,Oe],(n,[e,s])=>{const h=n.properties()[e.value],f=s.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[Le,[Oe],(n,[e])=>{const s=n.id(),h=e.value;return typeof s==typeof h&&s<=h}],"filter->=":[Le,[ke,Oe],(n,[e,s])=>{const h=n.properties()[e.value],f=s.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[Le,[Oe],(n,[e])=>{const s=n.id(),h=e.value;return typeof s==typeof h&&s>=h}],"filter-has":[Le,[Oe],(n,[e])=>e.value in n.properties()],"filter-has-id":[Le,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Le,[qr(ke)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Le,[qr(Oe)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Le,[ke,qr(Oe)],(n,[e,s])=>s.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Le,[ke,qr(Oe)],(n,[e,s])=>function(h,f,y,v){for(;y<=v;){const w=y+v>>1;if(f[w]===h)return!0;f[w]>h?v=w-1:y=w+1}return!1}(n.properties()[e.value],s.value,0,s.value.length-1)],all:{type:Le,overloads:[[[Le,Le],(n,[e,s])=>e.evaluate(n)&&s.evaluate(n)],[En(Le),(n,e)=>{for(const s of e)if(!s.evaluate(n))return!1;return!0}]]},any:{type:Le,overloads:[[[Le,Le],(n,[e,s])=>e.evaluate(n)||s.evaluate(n)],[En(Le),(n,e)=>{for(const s of e)if(s.evaluate(n))return!0;return!1}]]},"!":[Le,[Le],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Le,[ke],(n,[e])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(e.evaluate(n))}],upcase:[ke,[ke],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[ke,[ke],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[ke,En(Oe),(n,e)=>e.map(s=>Mn(s.evaluate(n))).join("")],"resolved-locale":[ke,[zs],(n,[e])=>e.evaluate(n).resolvedLocale()]});class $o{constructor(e,s){this.expression=e,this._warningHistory={},this._evaluator=new Jc,this._defaultValue=s?function(h){if(h.type==="color"&&In(h.default))return new Ke(0,0,0,0);switch(h.type){case"color":return Ke.parse(h.default)||null;case"padding":return Ki.parse(h.default)||null;case"numberArray":return Mr.parse(h.default)||null;case"colorArray":return sr.parse(h.default)||null;case"variableAnchorOffsetCollection":return si.parse(h.default)||null;case"projectionDefinition":return Fe.parse(h.default)||null;default:return h.default===void 0?null:h.default}}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(e,s,h,f,y,v){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=h,this._evaluator.canonical=f,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(e,s,h,f,y,v){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new ki(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function qo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Hn}function Zo(n,e){const s=new Da(Hn,Uo,[],e?function(f){const y={color:rr,string:ke,number:Yt,enum:ke,boolean:Le,formatted:vn,padding:Zi,numberArray:Ea,colorArray:Pa,projectionDefinition:Ds,resolvedImage:ks,variableAnchorOffsetCollection:Ia};return f.type==="array"?qr(y[f.value]||Oe,f.length):y[f.type]}(e):void 0),h=s.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?pu(new $o(h,e)):Yn(s.errors)}class qa{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!Va(s.expression),this.globalStateRefs=ta(s.expression)}evaluateWithoutErrorHandling(e,s,h,f,y,v){return this._styleExpression.evaluateWithoutErrorHandling(e,s,h,f,y,v)}evaluate(e,s,h,f,y,v){return this._styleExpression.evaluate(e,s,h,f,y,v)}}class Wo{constructor(e,s,h,f){this.kind=e,this.zoomStops=h,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!Va(s.expression),this.globalStateRefs=ta(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,s,h,f,y,v){return this._styleExpression.evaluateWithoutErrorHandling(e,s,h,f,y,v)}evaluate(e,s,h,f,y,v){return this._styleExpression.evaluate(e,s,h,f,y,v)}interpolationFactor(e,s,h){return this.interpolationType?Ir.interpolationFactor(this.interpolationType,e,s,h):0}}function wh(n,e){const s=Zo(n,e);if(s.result==="error")return s;const h=s.value.expression,f=Vo(h);if(!f&&!Jn(e))return Yn([new Mi("","data expressions not supported")]);const y=Kn(h,["zoom"]);if(!y&&!xh(e))return Yn([new Mi("","zoom expressions not supported")]);const v=Qn(h);return v||y?v instanceof Mi?Yn([v]):v instanceof Ir&&!bh(e)?Yn([new Mi("",'"interpolate" expressions cannot be used with this property')]):pu(v?new Wo(f?"camera":"composite",s.value,v.labels,v instanceof Ir?v.interpolation:void 0):new qa(f?"constant":"source",s.value)):Yn([new Mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Za{constructor(e,s){this._parameters=e,this._specification=s,Hi(this,gu(this._parameters,this._specification))}static deserialize(e){return new Za(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Qn(n){let e=null;if(n instanceof za)e=Qn(n.result);else if(n instanceof Gr){for(const s of n.args)if(e=Qn(s),e)break}else(n instanceof $n||n instanceof Ir)&&n.input instanceof rs&&n.input.name==="zoom"&&(e=n);return e instanceof Mi||n.eachChild(s=>{const h=Qn(s);h instanceof Mi?e=h:!e&&h?e=new Mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&h&&e!==h&&(e=new Mi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ta(n,e=new Set){return n instanceof Ua&&e.add(n.key),n.eachChild(s=>{ta(s,e)}),e}function Wa(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Wa(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Mh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ys(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Wa(n)||(n=Xo(n));const e=Zo(n,Mh);if(e.result==="error")throw new Error(e.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,h,f)=>e.value.evaluate(s,h,{},f),needGeometry:vu(n),getGlobalStateRefs:()=>ta(e.value.expression)}}function mf(n,e){return n<e?-1:n>e?1:0}function vu(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(vu(n[e]))return!0;return!1}function Xo(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Sh(n[1],n[2],"=="):e==="!="?Xa(Sh(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Sh(n[1],n[2],e):e==="any"?(s=n.slice(1),["any"].concat(s.map(Xo))):e==="all"?["all"].concat(n.slice(1).map(Xo)):e==="none"?["all"].concat(n.slice(1).map(Xo).map(Xa)):e==="in"?xu(n[1],n.slice(2)):e==="!in"?Xa(xu(n[1],n.slice(2))):e==="has"?bu(n[1]):e!=="!has"||Xa(bu(n[1]));var s}function Sh(n,e,s){switch(n){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,n,e]}}function xu(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",n,["literal",e.sort(mf)]]:["filter-in-small",n,["literal",e]]}}function bu(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Xa(n){return["!",n]}function Ho(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let f="[";for(const y of n)f+=`${Ho(y)},`;return`${f}]`}const s=Object.keys(n).sort();let h="{";for(let f=0;f<s.length;f++)h+=`${JSON.stringify(s[f])}:${Ho(n[s[f]])},`;return`${h}}`}function Ko(n){let e="";for(const s of ie)e+=`/${Ho(n[s])}`;return e}function wu(n){const e=n.value;return e?[new Ht(n.key,e,"constants have been deprecated as of v8")]:[]}function Ni(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Js(n){if(Array.isArray(n))return n.map(Js);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const s in n)e[s]=Js(n[s]);return e}return Ni(n)}function ss(n){const e=n.key,s=n.value,h=n.valueSpec||{},f=n.objectElementValidators||{},y=n.style,v=n.styleSpec,w=n.validateSpec;let S=[];const E=Ye(s);if(E!=="object")return[new Ht(e,s,`object expected, ${E} found`)];for(const C in s){const k=C.split(".")[0],N=He(h,k)||h["*"];let U;if(He(f,k))U=f[k];else if(He(h,k))U=w;else if(f["*"])U=f["*"];else{if(!h["*"]){S.push(new Ht(e,s[C],`unknown property "${C}"`));continue}U=w}S=S.concat(U({key:(e&&`${e}.`)+C,value:s[C],valueSpec:N,style:y,styleSpec:v,object:s,objectKey:C,validateSpec:w},s))}for(const C in h)f[C]||h[C].required&&h[C].default===void 0&&s[C]===void 0&&S.push(new Ht(e,s,`missing required property "${C}"`));return S}function Yo(n){const e=n.value,s=n.valueSpec,h=n.style,f=n.styleSpec,y=n.key,v=n.arrayElementValidator||n.validateSpec;if(Ye(e)!=="array")return[new Ht(y,e,`array expected, ${Ye(e)} found`)];if(s.length&&e.length!==s.length)return[new Ht(y,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new Ht(y,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let w={type:s.value,values:s.values};f.$version<7&&(w.function=s.function),Ye(s.value)==="object"&&(w=s.value);let S=[];for(let E=0;E<e.length;E++)S=S.concat(v({array:e,arrayIndex:E,value:e[E],valueSpec:w,validateSpec:n.validateSpec,style:h,styleSpec:f,key:`${y}[${E}]`}));return S}function Ha(n){const e=n.key,s=n.value,h=n.valueSpec;let f=Ye(s);return f==="number"&&s!=s&&(f="NaN"),f!=="number"?[new Ht(e,s,`number expected, ${f} found`)]:"minimum"in h&&s<h.minimum?[new Ht(e,s,`${s} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&s>h.maximum?[new Ht(e,s,`${s} is greater than the maximum value ${h.maximum}`)]:[]}function ea(n){const e=n.valueSpec,s=Ni(n.value.type);let h,f,y,v={};const w=s!=="categorical"&&n.value.property===void 0,S=!w,E=Ye(n.value.stops)==="array"&&Ye(n.value.stops[0])==="array"&&Ye(n.value.stops[0][0])==="object",C=ss({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(U){if(s==="identity")return[new Ht(U.key,U.value,'identity function may not have a "stops" property')];let V=[];const W=U.value;return V=V.concat(Yo({key:U.key,value:W,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:k})),Ye(W)==="array"&&W.length===0&&V.push(new Ht(U.key,W,"array must have at least one stop")),V},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:e,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return s==="identity"&&w&&C.push(new Ht(n.key,n.value,'missing required property "property"')),s==="identity"||n.value.stops||C.push(new Ht(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!bh(n.valueSpec)&&C.push(new Ht(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(S&&!Jn(n.valueSpec)?C.push(new Ht(n.key,n.value,"property functions not supported")):w&&!xh(n.valueSpec)&&C.push(new Ht(n.key,n.value,"zoom functions not supported"))),s!=="categorical"&&!E||n.value.property!==void 0||C.push(new Ht(n.key,n.value,'"property" property is required')),C;function k(U){let V=[];const W=U.value,K=U.key;if(Ye(W)!=="array")return[new Ht(K,W,`array expected, ${Ye(W)} found`)];if(W.length!==2)return[new Ht(K,W,`array length 2 expected, length ${W.length} found`)];if(E){if(Ye(W[0])!=="object")return[new Ht(K,W,`object expected, ${Ye(W[0])} found`)];if(W[0].zoom===void 0)return[new Ht(K,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new Ht(K,W,"object stop key must have value")];if(y&&y>Ni(W[0].zoom))return[new Ht(K,W[0].zoom,"stop zoom values must appear in ascending order")];Ni(W[0].zoom)!==y&&(y=Ni(W[0].zoom),f=void 0,v={}),V=V.concat(ss({key:`${K}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Ha,value:N}}))}else V=V.concat(N({key:`${K}[0]`,value:W[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},W));return qo(Js(W[1]))?V.concat([new Ht(`${K}[1]`,W[1],"expressions are not allowed in function stops.")]):V.concat(U.validateSpec({key:`${K}[1]`,value:W[1],valueSpec:e,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function N(U,V){const W=Ye(U.value),K=Ni(U.value),rt=U.value!==null?U.value:V;if(h){if(W!==h)return[new Ht(U.key,rt,`${W} stop domain type must match previous stop domain type ${h}`)]}else h=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new Ht(U.key,rt,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&s!=="categorical"){let _t=`number expected, ${W} found`;return Jn(e)&&s===void 0&&(_t+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ht(U.key,rt,_t)]}return s!=="categorical"||W!=="number"||isFinite(K)&&Math.floor(K)===K?s!=="categorical"&&W==="number"&&f!==void 0&&K<f?[new Ht(U.key,rt,"stop domain values must appear in ascending order")]:(f=K,s==="categorical"&&K in v?[new Ht(U.key,rt,"stop domain values must be unique")]:(v[K]=!0,[])):[new Ht(U.key,rt,`integer expected, found ${K}`)]}}function ia(n){const e=(n.expressionContext==="property"?wh:Zo)(Js(n.value),n.valueSpec);if(e.result==="error")return e.value.map(h=>new Ht(`${n.key}${h.key}`,n.value,h.message));const s=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new Ht(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Va(s))return[new Ht(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Va(s))return[new Ht(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Kn(s,["zoom","feature-state"]))return[new Ht(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Vo(s))return[new Ht(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Th(n){const e=n.key,s=n.value,h=Ye(s);return h!=="string"?[new Ht(e,s,`color expected, ${h} found`)]:Ke.parse(String(s))?[]:[new Ht(e,s,`color expected, "${s}" found`)]}function Ka(n){const e=n.key,s=n.value,h=n.valueSpec,f=[];return Array.isArray(h.values)?h.values.indexOf(Ni(s))===-1&&f.push(new Ht(e,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(Ni(s))===-1&&f.push(new Ht(e,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function Ph(n){return Wa(Js(n.value))?ia(Hi({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mu(n)}function Mu(n){const e=n.value,s=n.key;if(Ye(e)!=="array")return[new Ht(s,e,`array expected, ${Ye(e)} found`)];const h=n.styleSpec;let f,y=[];if(e.length<1)return[new Ht(s,e,"filter array must have at least 1 element")];switch(y=y.concat(Ka({key:`${s}[0]`,value:e[0],valueSpec:h.filter_operator,style:n.style,styleSpec:n.styleSpec})),Ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ni(e[1])==="$type"&&y.push(new Ht(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&y.push(new Ht(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=Ye(e[1]),f!=="string"&&y.push(new Ht(`${s}[1]`,e[1],`string expected, ${f} found`)));for(let v=2;v<e.length;v++)f=Ye(e[v]),Ni(e[1])==="$type"?y=y.concat(Ka({key:`${s}[${v}]`,value:e[v],valueSpec:h.geometry_type,style:n.style,styleSpec:n.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&y.push(new Ht(`${s}[${v}]`,e[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<e.length;v++)y=y.concat(Mu({key:`${s}[${v}]`,value:e[v],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":f=Ye(e[1]),e.length!==2?y.push(new Ht(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="string"&&y.push(new Ht(`${s}[1]`,e[1],`string expected, ${f} found`))}return y}function Su(n,e){const s=n.key,h=n.validateSpec,f=n.style,y=n.styleSpec,v=n.value,w=n.objectKey,S=y[`${e}_${n.layerType}`];if(!S)return[];const E=w.match(/^(.*)-transition$/);if(e==="paint"&&E&&S[E[1]]&&S[E[1]].transition)return h({key:s,value:v,valueSpec:y.transition,style:f,styleSpec:y});const C=n.valueSpec||S[w];if(!C)return[new Ht(s,v,`unknown property "${w}"`)];let k;if(Ye(v)==="string"&&Jn(C)&&!C.tokens&&(k=/^{([^}]+)}$/.exec(v)))return[new Ht(s,v,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const N=[];return n.layerType==="symbol"&&(w==="text-field"&&f&&!f.glyphs&&N.push(new Ht(s,v,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&In(Js(v))&&Ni(v.type)==="identity"&&N.push(new Ht(s,v,'"text-font" does not support identity functions'))),N.concat(h({key:n.key,value:v,valueSpec:C,style:f,styleSpec:y,expressionContext:"property",propertyType:e,propertyKey:w}))}function ra(n){return Su(n,"paint")}function sa(n){return Su(n,"layout")}function jr(n){let e=[];const s=n.value,h=n.key,f=n.style,y=n.styleSpec;if(Ye(s)!=="object")return[new Ht(h,s,`object expected, ${Ye(s)} found`)];s.type||s.ref||e.push(new Ht(h,s,'either "type" or "ref" is required'));let v=Ni(s.type);const w=Ni(s.ref);if(s.id){const S=Ni(s.id);for(let E=0;E<n.arrayIndex;E++){const C=f.layers[E];Ni(C.id)===S&&e.push(new Ht(h,s.id,`duplicate layer id "${s.id}", previously used at line ${C.id.__line__}`))}}if("ref"in s){let S;["type","source","source-layer","filter","layout"].forEach(E=>{E in s&&e.push(new Ht(h,s[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{Ni(E.id)===w&&(S=E)}),S?S.ref?e.push(new Ht(h,s.ref,"ref cannot reference another ref layer")):v=Ni(S.type):e.push(new Ht(h,s.ref,`ref layer "${w}" not found`))}else if(v!=="background")if(s.source){const S=f.sources&&f.sources[s.source],E=S&&Ni(S.type);S?E==="vector"&&v==="raster"?e.push(new Ht(h,s.source,`layer "${s.id}" requires a raster source`)):E!=="raster-dem"&&v==="hillshade"||E!=="raster-dem"&&v==="color-relief"?e.push(new Ht(h,s.source,`layer "${s.id}" requires a raster-dem source`)):E==="raster"&&v!=="raster"?e.push(new Ht(h,s.source,`layer "${s.id}" requires a vector source`)):E!=="vector"||s["source-layer"]?E==="raster-dem"&&v!=="hillshade"&&v!=="color-relief"?e.push(new Ht(h,s.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]||E==="geojson"&&S.lineMetrics||e.push(new Ht(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ht(h,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new Ht(h,s.source,`source "${s.source}" not found`))}else e.push(new Ht(h,s,'missing required property "source"'));return e=e.concat(ss({key:h,value:s,valueSpec:y.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${h}.type`,value:s.type,valueSpec:y.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:s,objectKey:"type"}),filter:Ph,layout:S=>ss({layer:s,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":E=>sa(Hi({layerType:v},E))}}),paint:S=>ss({layer:s,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":E=>ra(Hi({layerType:v},E))}})}})),e}function us(n){const e=n.value,s=n.key,h=Ye(e);return h!=="string"?[new Ht(s,e,`string expected, ${h} found`)]:[]}const Eh={promoteId:function({key:n,value:e}){if(Ye(e)==="string")return us({key:n,value:e});{const s=[];for(const h in e)s.push(...us({key:`${n}.${h}`,value:e[h]}));return s}}};function Tu(n){const e=n.value,s=n.key,h=n.styleSpec,f=n.style,y=n.validateSpec;if(!e.type)return[new Ht(s,e,'"type" is required')];const v=Ni(e.type);let w;switch(v){case"vector":case"raster":return w=ss({key:s,value:e,valueSpec:h[`source_${v.replace("-","_")}`],style:n.style,styleSpec:h,objectElementValidators:Eh,validateSpec:y}),w;case"raster-dem":return w=function(S){var E;const C=(E=S.sourceName)!==null&&E!==void 0?E:"",k=S.value,N=S.styleSpec,U=N.source_raster_dem,V=S.style;let W=[];const K=Ye(k);if(k===void 0)return W;if(K!=="object")return W.push(new Ht("source_raster_dem",k,`object expected, ${K} found`)),W;const rt=Ni(k.encoding)==="custom",_t=["redFactor","greenFactor","blueFactor","baseShift"],lt=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const j in k)!rt&&_t.includes(j)?W.push(new Ht(j,k[j],`In "${C}": "${j}" is only valid when "encoding" is set to "custom". ${lt} encoding found`)):U[j]?W=W.concat(S.validateSpec({key:j,value:k[j],valueSpec:U[j],validateSpec:S.validateSpec,style:V,styleSpec:N})):W.push(new Ht(j,k[j],`unknown property "${j}"`));return W}({sourceName:s,value:e,style:n.style,styleSpec:h,validateSpec:y}),w;case"geojson":if(w=ss({key:s,value:e,valueSpec:h.source_geojson,style:f,styleSpec:h,validateSpec:y,objectElementValidators:Eh}),e.cluster)for(const S in e.clusterProperties){const[E,C]=e.clusterProperties[S],k=typeof E=="string"?[E,["accumulated"],["get",S]]:E;w.push(...ia({key:`${s}.${S}.map`,value:C,expressionContext:"cluster-map"})),w.push(...ia({key:`${s}.${S}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return w;case"video":return ss({key:s,value:e,valueSpec:h.source_video,style:f,validateSpec:y,styleSpec:h});case"image":return ss({key:s,value:e,valueSpec:h.source_image,style:f,validateSpec:y,styleSpec:h});case"canvas":return[new Ht(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ka({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Pu(n){const e=n.value,s=n.styleSpec,h=s.light,f=n.style;let y=[];const v=Ye(e);if(e===void 0)return y;if(v!=="object")return y=y.concat([new Ht("light",e,`object expected, ${v} found`)]),y;for(const w in e){const S=w.match(/^(.*)-transition$/);y=y.concat(S&&h[S[1]]&&h[S[1]].transition?n.validateSpec({key:w,value:e[w],valueSpec:s.transition,validateSpec:n.validateSpec,style:f,styleSpec:s}):h[w]?n.validateSpec({key:w,value:e[w],valueSpec:h[w],validateSpec:n.validateSpec,style:f,styleSpec:s}):[new Ht(w,e[w],`unknown property "${w}"`)])}return y}function na(n){const e=n.value,s=n.styleSpec,h=s.sky,f=n.style,y=Ye(e);if(e===void 0)return[];if(y!=="object")return[new Ht("sky",e,`object expected, ${y} found`)];let v=[];for(const w in e)v=v.concat(h[w]?n.validateSpec({key:w,value:e[w],valueSpec:h[w],style:f,styleSpec:s}):[new Ht(w,e[w],`unknown property "${w}"`)]);return v}function Ih(n){const e=n.value,s=n.styleSpec,h=s.terrain,f=n.style;let y=[];const v=Ye(e);if(e===void 0)return y;if(v!=="object")return y=y.concat([new Ht("terrain",e,`object expected, ${v} found`)]),y;for(const w in e)y=y.concat(h[w]?n.validateSpec({key:w,value:e[w],valueSpec:h[w],validateSpec:n.validateSpec,style:f,styleSpec:s}):[new Ht(w,e[w],`unknown property "${w}"`)]);return y}function Jo(n){let e=[];const s=n.value,h=n.key;if(Array.isArray(s)){const f=[],y=[];for(const v in s)s[v].id&&f.includes(s[v].id)&&e.push(new Ht(h,s,`all the sprites' ids must be unique, but ${s[v].id} is duplicated`)),f.push(s[v].id),s[v].url&&y.includes(s[v].url)&&e.push(new Ht(h,s,`all the sprites' URLs must be unique, but ${s[v].url} is duplicated`)),y.push(s[v].url),e=e.concat(ss({key:`${h}[${v}]`,value:s[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return us({key:h,value:s})}function Eu(n){return e=n.value,e&&e.constructor===Object?[]:[new Ht(n.key,n.value,`object expected, ${Ye(n.value)} found`)];var e}const Qo={"*":()=>[],array:Yo,boolean:function(n){const e=n.value,s=n.key,h=Ye(e);return h!=="boolean"?[new Ht(s,e,`boolean expected, ${h} found`)]:[]},number:Ha,color:Th,constants:wu,enum:Ka,filter:Ph,function:ea,layer:jr,object:ss,source:Tu,light:Pu,sky:na,terrain:Ih,projection:function(n){const e=n.value,s=n.styleSpec,h=s.projection,f=n.style,y=Ye(e);if(e===void 0)return[];if(y!=="object")return[new Ht("projection",e,`object expected, ${y} found`)];let v=[];for(const w in e)v=v.concat(h[w]?n.validateSpec({key:w,value:e[w],valueSpec:h[w],style:f,styleSpec:s}):[new Ht(w,e[w],`unknown property "${w}"`)]);return v},projectionDefinition:function(n){const e=n.key;let s=n.value;s=s instanceof String?s.valueOf():s;const h=Ye(s);return h!=="array"||function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"}(s)||function(f){return!!["interpolate","step","literal"].includes(f[0])}(s)?["array","string"].includes(h)?[]:[new Ht(e,s,`projection expected, invalid type "${h}" found`)]:[new Ht(e,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:us,formatted:function(n){return us(n).length===0?[]:ia(n)},resolvedImage:function(n){return us(n).length===0?[]:ia(n)},padding:function(n){const e=n.key,s=n.value;if(Ye(s)==="array"){if(s.length<1||s.length>4)return[new Ht(e,s,`padding requires 1 to 4 values; ${s.length} values found`)];const h={type:"number"};let f=[];for(let y=0;y<s.length;y++)f=f.concat(n.validateSpec({key:`${e}[${y}]`,value:s[y],validateSpec:n.validateSpec,valueSpec:h}));return f}return Ha({key:e,value:s,valueSpec:{}})},numberArray:function(n){const e=n.key,s=n.value;if(Ye(s)==="array"){const h={type:"number"};if(s.length<1)return[new Ht(e,s,"array length at least 1 expected, length 0 found")];let f=[];for(let y=0;y<s.length;y++)f=f.concat(n.validateSpec({key:`${e}[${y}]`,value:s[y],validateSpec:n.validateSpec,valueSpec:h}));return f}return Ha({key:e,value:s,valueSpec:{}})},colorArray:function(n){const e=n.key,s=n.value;if(Ye(s)==="array"){if(s.length<1)return[new Ht(e,s,"array length at least 1 expected, length 0 found")];let h=[];for(let f=0;f<s.length;f++)h=h.concat(Th({key:`${e}[${f}]`,value:s[f]}));return h}return Th({key:e,value:s})},variableAnchorOffsetCollection:function(n){const e=n.key,s=n.value,h=Ye(s),f=n.styleSpec;if(h!=="array"||s.length<1||s.length%2!=0)return[new Ht(e,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let v=0;v<s.length;v+=2)y=y.concat(Ka({key:`${e}[${v}]`,value:s[v],valueSpec:f.layout_symbol["text-anchor"]})),y=y.concat(Yo({key:`${e}[${v+1}]`,value:s[v+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:f}));return y},sprite:Jo,state:Eu};function tl(n){const e=n.value,s=n.valueSpec,h=n.styleSpec;return n.validateSpec=tl,s.expression&&In(Ni(e))?ea(n):s.expression&&qo(Js(e))?ia(n):s.type&&Qo[s.type]?Qo[s.type](n):ss(Hi({},n,{valueSpec:s.type?h[s.type]:s}))}function aa(n){const e=n.value,s=n.key,h=us(n);return h.length||(e.indexOf("{fontstack}")===-1&&h.push(new Ht(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&h.push(new Ht(s,e,'"glyphs" url must include a "{range}" token'))),h}function ns(n,e=pt){let s=[];return s=s.concat(tl({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:tl,objectElementValidators:{glyphs:aa,"*":()=>[]}})),n.constants&&(s=s.concat(wu({key:"constants",value:n.constants}))),Iu(s)}function ds(n){return function(e){return n({...e,validateSpec:tl})}}function Iu(n){return[].concat(n).sort((e,s)=>e.line-s.line)}function Cr(n){return function(...e){return Iu(n.apply(this,e))}}ns.source=Cr(ds(Tu)),ns.sprite=Cr(ds(Jo)),ns.glyphs=Cr(ds(aa)),ns.light=Cr(ds(Pu)),ns.sky=Cr(ds(na)),ns.terrain=Cr(ds(Ih)),ns.state=Cr(ds(Eu)),ns.layer=Cr(ds(jr)),ns.filter=Cr(ds(Ph)),ns.paintProperty=Cr(ds(ra)),ns.layoutProperty=Cr(ds(sa));const oa=ns,gf=oa.light,el=oa.sky,_f=oa.paintProperty,Ch=oa.layoutProperty;function Ya(n,e){let s=!1;if(e&&e.length)for(const h of e)n.fire(new wt(new Error(h.message))),s=!0;return s}class la{constructor(e,s,h){const f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(s=v[1])+2*(h=v[2]);for(let S=0;S<this.d*this.d;S++){const E=v[3+S],C=v[3+S+1];f.push(E===C?null:v.subarray(E,C))}const w=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],w),this.bboxes=v.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*h;for(let v=0;v<this.d*this.d;v++)f.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=e,this.padding=h,this.scale=s/e,this.uid=0;const y=h/s*e;this.min=-y,this.max=e+y}insert(e,s,h,f,y){this._forEachCell(s,h,f,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,s,h,f,y,v){this.cells[y].push(v)}query(e,s,h,f,y){const v=this.min,w=this.max;if(e<=v&&s<=v&&w<=h&&w<=f&&!y)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,s,h,f,this._queryCell,S,{},y),S}}_queryCell(e,s,h,f,y,v,w,S){const E=this.cells[y];if(E!==null){const C=this.keys,k=this.bboxes;for(let N=0;N<E.length;N++){const U=E[N];if(w[U]===void 0){const V=4*U;(S?S(k[V+0],k[V+1],k[V+2],k[V+3]):e<=k[V+2]&&s<=k[V+3]&&h>=k[V+0]&&f>=k[V+1])?(w[U]=!0,v.push(C[U])):w[U]=!1}}}}_forEachCell(e,s,h,f,y,v,w,S){const E=this._convertToCellCoord(e),C=this._convertToCellCoord(s),k=this._convertToCellCoord(h),N=this._convertToCellCoord(f);for(let U=E;U<=k;U++)for(let V=C;V<=N;V++){const W=this.d*V+U;if((!S||S(this._convertFromCellCoord(U),this._convertFromCellCoord(V),this._convertFromCellCoord(U+1),this._convertFromCellCoord(V+1)))&&y.call(this,e,s,h,f,W,v,w,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,s=3+this.cells.length+1+1;let h=0;for(let v=0;v<this.cells.length;v++)h+=this.cells[v].length;const f=new Int32Array(s+h+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let y=s;for(let v=0;v<e.length;v++){const w=e[v];f[3+v]=y,f.set(w,y),y+=w.length}return f[3+e.length]=y,f.set(this.keys,y),y+=this.keys.length,f[3+e.length+1]=y,f.set(this.bboxes,y),y+=this.bboxes.length,f.buffer}static serialize(e,s){const h=e.toArrayBuffer();return s&&s.push(h),{buffer:h}}static deserialize(e){return new la(e.buffer)}}const Ss={};function ne(n,e,s={}){if(Ss[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),Ss[n]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}ne("Object",Object),ne("Set",Set),ne("TransferableGridIndex",la),ne("Color",Ke),ne("Error",Error),ne("AJAXError",at),ne("ResolvedImage",Nr),ne("StylePropertyFunction",Za),ne("StyleExpression",$o,{omit:["_evaluator"]}),ne("ZoomDependentExpression",Wo),ne("ZoomConstantExpression",qa),ne("CompoundExpression",rs,{omit:["_evaluate"]});for(const n in Hn)Hn[n]._classRegistryKey||ne(`Expression_${n}`,Hn[n]);function Ah(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ja(n){return n.$name||n.constructor._classRegistryKey}function Rh(n){return!function(e){if(e===null||typeof e!="object")return!1;const s=Ja(e);return!(!s||s==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Ah(n)||Be(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Qa(n,e){if(Rh(n))return(Ah(n)||Be(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const y=[];for(const v of n)y.push(Qa(v,e));return y}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const s=Ja(n);if(!s)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Ss[s])throw new Error(`${s} is not registered.`);const{klass:h}=Ss[s],f=h.serialize?h.serialize(n,e):{};if(h.serialize){if(e&&f===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in n){if(!n.hasOwnProperty(y)||Ss[s].omit.indexOf(y)>=0)continue;const v=n[y];f[y]=Ss[s].shallow.indexOf(y)>=0?v:Qa(v,e)}n instanceof Error&&(f.message=n.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(f.$name=s),f}function ha(n){if(Rh(n))return n;if(Array.isArray(n))return n.map(ha);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=Ja(n)||"Object";if(!Ss[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:s}=Ss[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(n);const h=Object.create(s.prototype);for(const f of Object.keys(n)){if(f==="$name")continue;const y=n[f];h[f]=Ss[e].shallow.indexOf(f)>=0?y:ha(y)}return h}class Dh{constructor(){this.first=!0}update(e,s){const h=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=h,!0))}}const Je={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function zh(n){for(const e of n)if(rl(e.charCodeAt(0)))return!0;return!1}function Cu(n){for(const e of n)if(!vf(e.charCodeAt(0)))return!1;return!0}function il(n){const e=n.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(e.join("|"),"u")}const yf=il(["Arab","Dupl","Mong","Ougr","Syrc"]);function vf(n){return!yf.test(String.fromCodePoint(n))}const kh=il(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function rl(n){return!(n!==746&&n!==747&&(n<4352||!(Je["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Je["CJK Compatibility"](n)||Je["CJK Strokes"](n)||!(!Je["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Je["Enclosed CJK Letters and Months"](n)||Je["Ideographic Description Characters"](n)||Je.Kanbun(n)||Je.Katakana(n)&&n!==12540||!(!Je["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Je["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Je["Vertical Forms"](n)||Je["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||kh.test(String.fromCodePoint(n)))))}function Lh(n){return!(rl(n)||function(e){return!!(Je["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Je["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Je["Letterlike Symbols"](e)||Je["Number Forms"](e)||Je["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Je["Control Pictures"](e)&&e!==9251||Je["Optical Character Recognition"](e)||Je["Enclosed Alphanumerics"](e)||Je["Geometric Shapes"](e)||Je["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Je["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Je["CJK Symbols and Punctuation"](e)||Je.Katakana(e)||Je["Private Use Area"](e)||Je["CJK Compatibility Forms"](e)||Je["Small Form Variants"](e)||Je["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}const Au=il(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function to(n){return Au.test(String.fromCodePoint(n))}function xf(n,e){return!(!e&&to(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Je.Khmer(n))}function Oh(n){for(const e of n)if(to(e.charCodeAt(0)))return!0;return!1}const Qs=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Qs.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const s=n.pluginURL,h=new Promise(y=>{this.loadScriptResolve=y});e(s);const f=new Promise(y=>setTimeout(()=>y(),this.TIMEOUT));if(yield Promise.race([h,f]),this.isParsed()){const y={pluginStatus:"loaded",pluginURL:s};return this.setState(y),y}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)})}};class Ci{constructor(e,s){this.zoom=e,s?(this.now=s.now||0,this.fadeDuration=s.fadeDuration||0,this.zoomHistory=s.zoomHistory||new Dh,this.transition=s.transition||{},this.globalState=s.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Dh,this.transition={},this.globalState={})}isSupportedScript(e){return function(s,h){for(const f of s)if(!xf(f.charCodeAt(0),h))return!1;return!0}(e,Qs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),h=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*s}}}class eo{constructor(e,s){this.property=e,this.value=s,this.expression=function(h,f){if(In(h))return new Za(h,f);if(qo(h)){const y=wh(h,f);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));return y.value}{let y=h;return f.type==="color"&&typeof h=="string"?y=Ke.parse(h):f.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?f.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?f.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?y=si.parse(h):f.type==="projectionDefinition"&&typeof h=="string"&&(y=Fe.parse(h)):y=sr.parse(h):y=Mr.parse(h):y=Ki.parse(h),{globalStateRefs:new Set,kind:"constant",evaluate:()=>y}}}(s===void 0?e.specification.default:s,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,s,h){return this.property.possiblyEvaluate(this,e,s,h)}}class sl{constructor(e){this.property=e,this.value=new eo(e,void 0)}transitioned(e,s){return new Ru(this.property,this.value,s,ze({},e.transition,this.transition),e.now)}untransitioned(){return new Ru(this.property,this.value,null,{},0)}}class Fh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return je(this._values[e].value.value)}setValue(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new sl(this._values[e].property)),this._values[e].value=new eo(this._values[e].property,s===null?void 0:je(s))}getTransition(e){return je(this._values[e].transition)}setTransition(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new sl(this._values[e].property)),this._values[e].transition=je(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(e[s]=h);const f=this.getTransition(s);f!==void 0&&(e[`${s}-transition`]=f)}return e}transitioned(e,s){const h=new Du(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(e,s._values[f]);return h}untransitioned(){const e=new Du(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class Ru{constructor(e,s,h,f,y){this.property=e,this.value=s,this.begin=y+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(e,s,h){const f=e.now||0,y=this.value.possiblyEvaluate(e,s,h),v=this.prior;if(v){if(f>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(f<this.begin)return v.possiblyEvaluate(e,s,h);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(e,s,h),y,Ee(w))}}return y}}class Du{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,h){const f=new nl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(e,s,h);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class bf{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return je(this._values[e].value)}setValue(e,s){this._values[e]=new eo(this._values[e].property,s===null?void 0:je(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(e[s]=h)}return e}possiblyEvaluate(e,s,h){const f=new nl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(e,s,h);return f}}class Ts{constructor(e,s,h){this.property=e,this.value=s,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,h,f){return this.property.evaluate(this.value,this.parameters,e,s,h,f)}}class nl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ue{constructor(e){this.specification=e}possiblyEvaluate(e,s){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(s)}interpolate(e,s,h){const f=Zr[this.specification.type];return f?f(e,s,h):e}}class we{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,h,f){return new Ts(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},h,f)}:e.expression,s)}interpolate(e,s,h){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new Ts(this,{kind:"constant",value:void 0},e.parameters);const f=Zr[this.specification.type];if(f){const y=f(e.value.value,s.value.value,h);return new Ts(this,{kind:"constant",value:y},e.parameters)}return e}evaluate(e,s,h,f,y,v){return e.kind==="constant"?e.value:e.evaluate(s,h,f,y,v)}}class al extends we{possiblyEvaluate(e,s,h,f){if(e.value===void 0)return new Ts(this,{kind:"constant",value:void 0},s);if(e.expression.kind==="constant"){const y=e.expression.evaluate(s,null,{},h,f),v=e.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,w=this._calculate(v,v,v,s);return new Ts(this,{kind:"constant",value:w},s)}if(e.expression.kind==="camera"){const y=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new Ts(this,{kind:"constant",value:y},s)}return new Ts(this,e.expression,s)}evaluate(e,s,h,f,y,v){if(e.kind==="source"){const w=e.evaluate(s,h,f,y,v);return this._calculate(w,w,w,s)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},h,f),e.evaluate({zoom:Math.floor(s.zoom)},h,f),e.evaluate({zoom:Math.floor(s.zoom)+1},h,f),s):e.value}_calculate(e,s,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:h,to:s}}interpolate(e){return e}}class Bh{constructor(e){this.specification=e}possiblyEvaluate(e,s,h,f){if(e.value!==void 0){if(e.expression.kind==="constant"){const y=e.expression.evaluate(s,null,{},h,f);return this._calculate(y,y,y,s)}return this._calculate(e.expression.evaluate(new Ci(Math.floor(s.zoom-1),s)),e.expression.evaluate(new Ci(Math.floor(s.zoom),s)),e.expression.evaluate(new Ci(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:h,to:s}}interpolate(e){return e}}class io{constructor(e){this.specification=e}possiblyEvaluate(e,s,h,f){return!!e.expression.evaluate(s,null,{},h,f)}interpolate(){return!1}}class Ar{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new eo(h,void 0),y=this.defaultTransitionablePropertyValues[s]=new sl(h);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate({})}}}ne("DataDrivenProperty",we),ne("DataConstantProperty",ue),ne("CrossFadedDataDrivenProperty",al),ne("CrossFadedProperty",Bh),ne("ColorRampProperty",io);const zu="-transition";class dr extends Bt{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Ys(e.filter)),s.layout&&(this._unevaluatedLayout=new bf(s.layout)),s.paint)){this._transitionablePaint=new Fh(s.paint);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new nl(s.paint)}}setFilter(e){this.filter=e,this._featureFilter=Ys(e)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const s in this._unevaluatedLayout._values){const h=this._unevaluatedLayout._values[s];for(const f of h.getGlobalStateRefs())e.add(f)}for(const s of this._featureFilter.getGlobalStateRefs())e.add(s);return e}setLayoutProperty(e,s,h={}){s!=null&&this._validate(Ch,`layers.${this.id}.layout.${e}`,e,s,h)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return e.endsWith(zu)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,h={}){if(s!=null&&this._validate(_f,`layers.${this.id}.paint.${e}`,e,s,h))return!1;if(e.endsWith(zu))return this._transitionablePaint.setTransition(e.slice(0,-11),s||void 0),!1;{const f=this._transitionablePaint._values[e],y=f.property.specification["property-type"]==="cross-faded-data-driven",v=f.value.isDataDriven(),w=f.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||v||y||this._handleOverridablePaintPropertyUpdate(e,w,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,s,h){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ce(e,(s,h)=>!(s===void 0||h==="layout"&&!Object.keys(s).length||h==="paint"&&!Object.keys(s).length))}_validate(e,s,h,f,y={}){return(!y||y.validate!==!1)&&Ya(this,e.call(oa,{key:s,layerType:this.type,objectKey:h,value:f,styleSpec:pt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof Ts&&Jn(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const ku={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cn{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Li{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gi(n,e=1){let s=0,h=0;return{members:n.map(f=>{const y=ku[f.type].BYTES_PER_ELEMENT,v=s=Lu(s,Math.max(e,y)),w=f.components||1;return h=Math.max(h,y),s+=y*w,{name:f.name,type:f.type,components:w,offset:v}}),size:Lu(s,Math.max(h,e)),alignment:e}}function Lu(n,e){return Math.ceil(n/e)*e}class tn extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const f=2*e;return this.int16[f+0]=s,this.int16[f+1]=h,e}}tn.prototype.bytesPerElement=4,ne("StructArrayLayout2i4",tn);class en extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=3*e;return this.int16[y+0]=s,this.int16[y+1]=h,this.int16[y+2]=f,e}}en.prototype.bytesPerElement=6,ne("StructArrayLayout3i6",en);class Nh extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,h,f)}emplace(e,s,h,f,y){const v=4*e;return this.int16[v+0]=s,this.int16[v+1]=h,this.int16[v+2]=f,this.int16[v+3]=y,e}}Nh.prototype.bytesPerElement=8,ne("StructArrayLayout4i8",Nh);class ll extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,h,f,y,v)}emplace(e,s,h,f,y,v,w){const S=6*e;return this.int16[S+0]=s,this.int16[S+1]=h,this.int16[S+2]=f,this.int16[S+3]=y,this.int16[S+4]=v,this.int16[S+5]=w,e}}ll.prototype.bytesPerElement=12,ne("StructArrayLayout2i4i12",ll);class An extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,h,f,y,v)}emplace(e,s,h,f,y,v,w){const S=4*e,E=8*e;return this.int16[S+0]=s,this.int16[S+1]=h,this.uint8[E+4]=f,this.uint8[E+5]=y,this.uint8[E+6]=v,this.uint8[E+7]=w,e}}An.prototype.bytesPerElement=8,ne("StructArrayLayout2i4ub8",An);class ro extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const f=2*e;return this.float32[f+0]=s,this.float32[f+1]=h,e}}ro.prototype.bytesPerElement=8,ne("StructArrayLayout2f8",ro);class Gh extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E,C){const k=this.length;return this.resize(k+1),this.emplace(k,e,s,h,f,y,v,w,S,E,C)}emplace(e,s,h,f,y,v,w,S,E,C,k){const N=10*e;return this.uint16[N+0]=s,this.uint16[N+1]=h,this.uint16[N+2]=f,this.uint16[N+3]=y,this.uint16[N+4]=v,this.uint16[N+5]=w,this.uint16[N+6]=S,this.uint16[N+7]=E,this.uint16[N+8]=C,this.uint16[N+9]=k,e}}Gh.prototype.bytesPerElement=20,ne("StructArrayLayout10ui20",Gh);class hl extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E,C,k,N){const U=this.length;return this.resize(U+1),this.emplace(U,e,s,h,f,y,v,w,S,E,C,k,N)}emplace(e,s,h,f,y,v,w,S,E,C,k,N,U){const V=12*e;return this.int16[V+0]=s,this.int16[V+1]=h,this.int16[V+2]=f,this.int16[V+3]=y,this.uint16[V+4]=v,this.uint16[V+5]=w,this.uint16[V+6]=S,this.uint16[V+7]=E,this.int16[V+8]=C,this.int16[V+9]=k,this.int16[V+10]=N,this.int16[V+11]=U,e}}hl.prototype.bytesPerElement=24,ne("StructArrayLayout4i4ui4i24",hl);class jh extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=3*e;return this.float32[y+0]=s,this.float32[y+1]=h,this.float32[y+2]=f,e}}jh.prototype.bytesPerElement=12,ne("StructArrayLayout3f12",jh);class g extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}g.prototype.bytesPerElement=4,ne("StructArrayLayout1ul4",g);class t extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,s,h,f,y,v,w,S,E)}emplace(e,s,h,f,y,v,w,S,E,C){const k=10*e,N=5*e;return this.int16[k+0]=s,this.int16[k+1]=h,this.int16[k+2]=f,this.int16[k+3]=y,this.int16[k+4]=v,this.int16[k+5]=w,this.uint32[N+3]=S,this.uint16[k+8]=E,this.uint16[k+9]=C,e}}t.prototype.bytesPerElement=20,ne("StructArrayLayout6i1ul2ui20",t);class r extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,h,f,y,v)}emplace(e,s,h,f,y,v,w){const S=6*e;return this.int16[S+0]=s,this.int16[S+1]=h,this.int16[S+2]=f,this.int16[S+3]=y,this.int16[S+4]=v,this.int16[S+5]=w,e}}r.prototype.bytesPerElement=12,ne("StructArrayLayout2i2i2i12",r);class c extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,s,h,f,y)}emplace(e,s,h,f,y,v){const w=4*e,S=8*e;return this.float32[w+0]=s,this.float32[w+1]=h,this.float32[w+2]=f,this.int16[S+6]=y,this.int16[S+7]=v,e}}c.prototype.bytesPerElement=16,ne("StructArrayLayout2f1f2i16",c);class d extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,h,f,y,v)}emplace(e,s,h,f,y,v,w){const S=16*e,E=4*e,C=8*e;return this.uint8[S+0]=s,this.uint8[S+1]=h,this.float32[E+1]=f,this.float32[E+2]=y,this.int16[C+6]=v,this.int16[C+7]=w,e}}d.prototype.bytesPerElement=16,ne("StructArrayLayout2ub2f2i16",d);class _ extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=3*e;return this.uint16[y+0]=s,this.uint16[y+1]=h,this.uint16[y+2]=f,e}}_.prototype.bytesPerElement=6,ne("StructArrayLayout3ui6",_);class b extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E,C,k,N,U,V,W,K,rt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,e,s,h,f,y,v,w,S,E,C,k,N,U,V,W,K,rt)}emplace(e,s,h,f,y,v,w,S,E,C,k,N,U,V,W,K,rt,_t){const lt=24*e,j=12*e,H=48*e;return this.int16[lt+0]=s,this.int16[lt+1]=h,this.uint16[lt+2]=f,this.uint16[lt+3]=y,this.uint32[j+2]=v,this.uint32[j+3]=w,this.uint32[j+4]=S,this.uint16[lt+10]=E,this.uint16[lt+11]=C,this.uint16[lt+12]=k,this.float32[j+7]=N,this.float32[j+8]=U,this.uint8[H+36]=V,this.uint8[H+37]=W,this.uint8[H+38]=K,this.uint32[j+10]=rt,this.int16[lt+22]=_t,e}}b.prototype.bytesPerElement=48,ne("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",b);class M extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E,C,k,N,U,V,W,K,rt,_t,lt,j,H,ct,Et,Ut,Rt,kt,Zt,$t){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,e,s,h,f,y,v,w,S,E,C,k,N,U,V,W,K,rt,_t,lt,j,H,ct,Et,Ut,Rt,kt,Zt,$t)}emplace(e,s,h,f,y,v,w,S,E,C,k,N,U,V,W,K,rt,_t,lt,j,H,ct,Et,Ut,Rt,kt,Zt,$t,Kt){const Ft=32*e,ce=16*e;return this.int16[Ft+0]=s,this.int16[Ft+1]=h,this.int16[Ft+2]=f,this.int16[Ft+3]=y,this.int16[Ft+4]=v,this.int16[Ft+5]=w,this.int16[Ft+6]=S,this.int16[Ft+7]=E,this.uint16[Ft+8]=C,this.uint16[Ft+9]=k,this.uint16[Ft+10]=N,this.uint16[Ft+11]=U,this.uint16[Ft+12]=V,this.uint16[Ft+13]=W,this.uint16[Ft+14]=K,this.uint16[Ft+15]=rt,this.uint16[Ft+16]=_t,this.uint16[Ft+17]=lt,this.uint16[Ft+18]=j,this.uint16[Ft+19]=H,this.uint16[Ft+20]=ct,this.uint16[Ft+21]=Et,this.uint16[Ft+22]=Ut,this.uint32[ce+12]=Rt,this.float32[ce+13]=kt,this.float32[ce+14]=Zt,this.uint16[Ft+30]=$t,this.uint16[Ft+31]=Kt,e}}M.prototype.bytesPerElement=64,ne("StructArrayLayout8i15ui1ul2f2ui64",M);class T extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}T.prototype.bytesPerElement=4,ne("StructArrayLayout1f4",T);class I extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=3*e;return this.uint16[6*e+0]=s,this.float32[y+1]=h,this.float32[y+2]=f,e}}I.prototype.bytesPerElement=12,ne("StructArrayLayout1ui2f12",I);class R extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=4*e;return this.uint32[2*e+0]=s,this.uint16[y+2]=h,this.uint16[y+3]=f,e}}R.prototype.bytesPerElement=8,ne("StructArrayLayout1ul2ui8",R);class F extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const f=2*e;return this.uint16[f+0]=s,this.uint16[f+1]=h,e}}F.prototype.bytesPerElement=4,ne("StructArrayLayout2ui4",F);class O extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}O.prototype.bytesPerElement=2,ne("StructArrayLayout1ui2",O);class G extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,h,f)}emplace(e,s,h,f,y){const v=4*e;return this.float32[v+0]=s,this.float32[v+1]=h,this.float32[v+2]=f,this.float32[v+3]=y,e}}G.prototype.bytesPerElement=16,ne("StructArrayLayout4f16",G);class q extends Cn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new $(this.anchorPointX,this.anchorPointY)}}q.prototype.size=20;class Q extends t{get(e){return new q(this,e)}}ne("CollisionBoxArray",Q);class J extends Cn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}J.prototype.size=48;class tt extends b{get(e){return new J(this,e)}}ne("PlacedSymbolArray",tt);class st extends Cn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}st.prototype.size=64;class ht extends M{get(e){return new st(this,e)}}ne("SymbolInstanceArray",ht);class nt extends T{getoffsetX(e){return this.float32[1*e+0]}}ne("GlyphOffsetArray",nt);class ut extends en{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ne("SymbolLineVertexArray",ut);class mt extends Cn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}mt.prototype.size=12;class ot extends I{get(e){return new mt(this,e)}}ne("TextAnchorOffsetArray",ot);class xt extends Cn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}xt.prototype.size=8;class It extends R{get(e){return new xt(this,e)}}ne("FeatureIndexArray",It);class St extends tn{}class Pt extends tn{}class Ct extends tn{}class te extends ll{}class Jt extends An{}class Vt extends ro{}class he extends Gh{}class Ve extends hl{}class di extends jh{}class Oi extends g{}class mi extends r{}class Fi extends d{}class yi extends _{}class gi extends F{}const vi=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:fr}=vi;class ai{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,s,h,f){const y=this.segments[this.segments.length-1];return e>ai.MAX_VERTEX_ARRAY_LENGTH&&De(`Max vertices per segment is ${ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${ai.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!y||y.vertexLength+e>ai.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==f?this.createNewSegment(s,h,f):y}createNewSegment(e,s,h){const f={vertexOffset:e.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return h!==void 0&&(f.sortKey=h),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(e,s,h){return this.prepareSegment(0,e,s,h)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,h,f){return new ai([{vertexOffset:e,primitiveOffset:s,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}function ar(n,e){return 256*(n=ae(Math.floor(n),0,255))+ae(Math.floor(e),0,255)}ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ne("SegmentVector",ai);const pr=Gi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var rn,sn,nn,Ps={exports:{}},so={exports:{}},no={exports:{}},ca=function(){if(nn)return Ps.exports;nn=1;var n=(rn||(rn=1,so.exports=function(s,h){var f,y,v,w,S,E,C,k;for(y=s.length-(f=3&s.length),v=h,S=3432918353,E=461845907,k=0;k<y;)C=255&s.charCodeAt(k)|(255&s.charCodeAt(++k))<<8|(255&s.charCodeAt(++k))<<16|(255&s.charCodeAt(++k))<<24,++k,v=27492+(65535&(w=5*(65535&(v=(v^=C=(65535&(C=(C=(65535&C)*S+(((C>>>16)*S&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(C=0,f){case 3:C^=(255&s.charCodeAt(k+2))<<16;case 2:C^=(255&s.charCodeAt(k+1))<<8;case 1:v^=C=(65535&(C=(C=(65535&(C^=255&s.charCodeAt(k)))*S+(((C>>>16)*S&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295}return v^=s.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),so.exports),e=(sn||(sn=1,no.exports=function(s,h){for(var f,y=s.length,v=h^y,w=0;y>=4;)f=1540483477*(65535&(f=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(f>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),y-=4,++w;switch(y){case 3:v^=(255&s.charCodeAt(w+2))<<16;case 2:v^=(255&s.charCodeAt(w+1))<<8;case 1:v=1540483477*(65535&(v^=255&s.charCodeAt(w)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),no.exports);return Ps.exports=n,Ps.exports.murmur3=n,Ps.exports.murmur2=e,Ps.exports}(),Ur=P(ca);class fs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,h,f){this.ids.push(an(e)),this.positions.push(s,h,f)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=an(e);let h=0,f=this.ids.length-1;for(;h<f;){const v=h+f>>1;this.ids[v]>=s?f=v:h=v+1}const y=[];for(;this.ids[h]===s;)y.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return y}static serialize(e,s){const h=new Float64Array(e.ids),f=new Uint32Array(e.positions);return Rn(h,f,0,h.length-1),s&&s.push(h.buffer,f.buffer),{ids:h,positions:f}}static deserialize(e){const s=new fs;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function an(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Ur(String(n))}function Rn(n,e,s,h){for(;s<h;){const f=n[s+h>>1];let y=s-1,v=h+1;for(;;){do y++;while(n[y]<f);do v--;while(n[v]>f);if(y>=v)break;$i(n,y,v),$i(e,3*y,3*v),$i(e,3*y+1,3*v+1),$i(e,3*y+2,3*v+2)}v-s<h-v?(Rn(n,e,s,v),s=v+1):(Rn(n,e,v+1,h),h=v)}}function $i(n,e,s){const h=n[e];n[e]=n[s],n[s]=h}ne("FeaturePositionMap",fs);class Pi{constructor(e,s){this.gl=e.gl,this.location=s}}class Rr extends Pi{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Qi extends Pi{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ou extends Pi{constructor(e,s){super(e,s),this.current=Ke.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const wf=new Float32Array(16);function Uh(n){return[ar(255*n.r,255*n.g),ar(255*n.b,255*n.a)]}class ao{constructor(e,s,h){this.value=e,this.uniformNames=s.map(f=>`u_${f}`),this.type=h}setUniform(e,s,h){e.set(h.constantOr(this.value))}getBinding(e,s,h){return this.type==="color"?new Ou(e,s):new Rr(e,s)}}class ua{constructor(e,s){this.uniformNames=s.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=e.tlbr}setUniform(e,s,h,f){const y=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&e.set(y)}getBinding(e,s,h){return h.substr(0,9)==="u_pattern"?new Qi(e,s):new Rr(e,s)}}class Ns{constructor(e,s,h,f){this.expression=e,this.type=h,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,s,h,f,y){const v=this.paintVertexArray.length,w=this.expression.evaluate(new Ci(0),s,{},f,[],y);this.paintVertexArray.resize(e),this._setPaintValue(v,e,w)}updatePaintArray(e,s,h,f){const y=this.expression.evaluate({zoom:0},h,f);this._setPaintValue(e,s,y)}_setPaintValue(e,s,h){if(this.type==="color"){const f=Uh(h);for(let y=e;y<s;y++)this.paintVertexArray.emplace(y,f[0],f[1])}else{for(let f=e;f<s;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mr{constructor(e,s,h,f,y,v){this.expression=e,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=h,this.useIntegerZoom=f,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(e,s,h,f,y){const v=this.expression.evaluate(new Ci(this.zoom),s,{},f,[],y),w=this.expression.evaluate(new Ci(this.zoom+1),s,{},f,[],y),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,v,w)}updatePaintArray(e,s,h,f){const y=this.expression.evaluate({zoom:this.zoom},h,f),v=this.expression.evaluate({zoom:this.zoom+1},h,f);this._setPaintValue(e,s,y,v)}_setPaintValue(e,s,h,f){if(this.type==="color"){const y=Uh(h),v=Uh(f);for(let w=e;w<s;w++)this.paintVertexArray.emplace(w,y[0],y[1],v[0],v[1])}else{for(let y=e;y<s;y++)this.paintVertexArray.emplace(y,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,f=ae(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);e.set(f)}getBinding(e,s,h){return new Rr(e,s)}}class Gs{constructor(e,s,h,f,y,v){this.expression=e,this.type=s,this.useIntegerZoom=h,this.zoom=f,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(e,s,h){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,s.patterns&&s.patterns[this.layerId],h)}updatePaintArray(e,s,h,f,y){this._setPaintValues(e,s,h.patterns&&h.patterns[this.layerId],y)}_setPaintValues(e,s,h,f){if(!f||!h)return;const{min:y,mid:v,max:w}=h,S=f[y],E=f[v],C=f[w];if(S&&E&&C)for(let k=e;k<s;k++)this.zoomInPaintVertexArray.emplace(k,E.tl[0],E.tl[1],E.br[0],E.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],E.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,E.tl[0],E.tl[1],E.br[0],E.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],E.pixelRatio,C.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,pr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,pr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Vh{constructor(e,s,h){this.binders={},this._buffers=[];const f=[];for(const y in e.paint._values){if(!h(y))continue;const v=e.paint.get(y);if(!(v instanceof Ts&&Jn(v.property.specification)))continue;const w=$h(y,e.type),S=v.value,E=v.property.specification.type,C=v.property.useIntegerZoom,k=v.property.specification["property-type"],N=k==="cross-faded"||k==="cross-faded-data-driven";if(S.kind==="constant")this.binders[y]=N?new ua(S.value,w):new ao(S.value,w,E),f.push(`/u_${y}`);else if(S.kind==="source"||N){const U=qh(y,E,"source");this.binders[y]=N?new Gs(S,E,C,s,U,e.id):new Ns(S,w,E,U),f.push(`/a_${y}`)}else{const U=qh(y,E,"composite");this.binders[y]=new mr(S,w,E,C,s,U),f.push(`/z_${y}`)}}this.cacheKey=f.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof Ns||s instanceof mr?s.maxValue:0}populatePaintArrays(e,s,h,f,y){for(const v in this.binders){const w=this.binders[v];(w instanceof Ns||w instanceof mr||w instanceof Gs)&&w.populatePaintArray(e,s,h,f,y)}}setConstantPatternPositions(e,s){for(const h in this.binders){const f=this.binders[h];f instanceof ua&&f.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,h,f,y){let v=!1;for(const w in e){const S=s.getPositions(w);for(const E of S){const C=h.feature(E.index);for(const k in this.binders){const N=this.binders[k];if((N instanceof Ns||N instanceof mr||N instanceof Gs)&&N.expression.isStateDependent===!0){const U=f.paint.get(k);N.expression=U.value,N.updatePaintArray(E.start,E.end,C,e[w],y),v=!0}}}}return v}defines(){const e=[];for(const s in this.binders){const h=this.binders[s];(h instanceof ao||h instanceof ua)&&e.push(...h.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Ns||h instanceof mr)for(let f=0;f<h.paintVertexAttributes.length;f++)e.push(h.paintVertexAttributes[f].name);else if(h instanceof Gs)for(let f=0;f<pr.members.length;f++)e.push(pr.members[f].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof ao||h instanceof ua||h instanceof mr)for(const f of h.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const h=[];for(const f in this.binders){const y=this.binders[f];if(y instanceof ao||y instanceof ua||y instanceof mr){for(const v of y.uniformNames)if(s[v]){const w=y.getBinding(e,s[v],v);h.push({name:v,property:f,binding:w})}}}return h}setUniforms(e,s,h,f){for(const{name:y,property:v,binding:w}of s)this.binders[v].setUniform(w,f,h.get(v),y)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const h=this.binders[s];if(e&&h instanceof Gs){const f=e.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(h instanceof Ns||h instanceof mr)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(e){for(const s in this.binders){const h=this.binders[s];(h instanceof Ns||h instanceof mr||h instanceof Gs)&&h.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof Ns||s instanceof mr||s instanceof Gs)&&s.destroy()}}}class on{constructor(e,s,h=()=>!0){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new Vh(f,s,h);this.needsUpload=!1,this._featureMap=new fs,this._bufferOffset=0}populatePaintArrays(e,s,h,f,y,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,s,f,y,v);s.id!==void 0&&this._featureMap.add(s.id,h,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,h,f){for(const y of h)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,s,y,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function $h(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function qh(n,e,s){const h={color:{source:ro,composite:G},number:{source:T,composite:ro}},f=function(y){return{"line-pattern":{source:he,composite:he},"fill-pattern":{source:he,composite:he},"fill-extrusion-pattern":{source:he,composite:he}}[y]}(n);return f&&f[s]||h[e][s]}ne("ConstantBinder",ao),ne("CrossFadedConstantBinder",ua),ne("SourceExpressionBinder",Ns),ne("CrossFadedCompositeBinder",Gs),ne("CompositeExpressionBinder",mr),ne("ProgramConfiguration",Vh,{omit:["_buffers"]}),ne("ProgramConfigurationSet",on);const oo=Math.pow(2,14)-1,Nm=-oo-1;function lo(n){const e=Mt/n.extent,s=n.loadGeometry();for(let h=0;h<s.length;h++){const f=s[h];for(let y=0;y<f.length;y++){const v=f[y],w=Math.round(v.x*e),S=Math.round(v.y*e);v.x=ae(w,Nm,oo),v.y=ae(S,Nm,oo),(w<v.x||w>v.x+1||S<v.y||S>v.y+1)&&De("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function ho(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?lo(n):[]}}const Gm=-32768;function w1(n,e,s,h,f){n.emplaceBack(Gm+8*e+h,Gm+8*s+f)}class Mf{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Pt,this.indexArray=new yi,this.segments=new ai,this.programConfigurations=new on(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){const f=this.layers[0],y=[];let v=null,w=!1,S=f.type==="heatmap";if(f.type==="circle"){const C=f;v=C.layout.get("circle-sort-key"),w=!v.isConstant(),S=S||C.paint.get("circle-pitch-alignment")==="map"}const E=S?s.subdivisionGranularity.circle:1;for(const{feature:C,id:k,index:N,sourceLayerIndex:U}of e){const V=this.layers[0]._featureFilter.needGeometry,W=ho(C,V);if(!this.layers[0]._featureFilter.filter(new Ci(this.zoom,{globalState:this.globalState}),W,h))continue;const K=w?v.evaluate(W,{},h):void 0,rt={id:k,properties:C.properties,type:C.type,sourceLayerIndex:U,index:N,geometry:V?W.geometry:lo(C),patterns:{},sortKey:K};y.push(rt)}w&&y.sort((C,k)=>C.sortKey-k.sortKey);for(const C of y){const{geometry:k,index:N,sourceLayerIndex:U}=C,V=e[N].feature;this.addFeature(C,k,N,h,E),s.featureIndex.insert(V,k,N,U,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,h,f,y=1){let v;switch(y){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${y}; valid values are 1, 3, 5, 7.`)}const w=v.length;for(const S of s)for(const E of S){const C=E.x,k=E.y;if(C<0||C>=Mt||k<0||k>=Mt)continue;const N=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,e.sortKey),U=N.vertexLength;for(let V=0;V<w;V++)for(let W=0;W<w;W++)w1(this.layoutVertexArray,C,k,v[W],v[V]);for(let V=0;V<w-1;V++)for(let W=0;W<w-1;W++){const K=U+V*w+W,rt=U+(V+1)*w+W;this.indexArray.emplaceBack(K,rt+1,K+1),this.indexArray.emplaceBack(K,rt,rt+1)}N.vertexLength+=w*w,N.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,{},f)}}function jm(n,e){for(let s=0;s<n.length;s++)if(cl(e,n[s]))return!0;for(let s=0;s<e.length;s++)if(cl(n,e[s]))return!0;return!!Sf(n,e)}function M1(n,e,s){return!!cl(n,e)||!!Tf(e,n,s)}function Um(n,e){if(n.length===1)return $m(e,n[0]);for(let s=0;s<e.length;s++){const h=e[s];for(let f=0;f<h.length;f++)if(cl(n,h[f]))return!0}for(let s=0;s<n.length;s++)if($m(e,n[s]))return!0;for(let s=0;s<e.length;s++)if(Sf(n,e[s]))return!0;return!1}function S1(n,e,s){if(n.length>1){if(Sf(n,e))return!0;for(let h=0;h<e.length;h++)if(Tf(e[h],n,s))return!0}for(let h=0;h<n.length;h++)if(Tf(n[h],e,s))return!0;return!1}function Sf(n,e){if(n.length===0||e.length===0)return!1;for(let s=0;s<n.length-1;s++){const h=n[s],f=n[s+1];for(let y=0;y<e.length-1;y++)if(T1(h,f,e[y],e[y+1]))return!0}return!1}function T1(n,e,s,h){return We(n,s,h)!==We(e,s,h)&&We(n,e,s)!==We(n,e,h)}function Tf(n,e,s){const h=s*s;if(e.length===1)return n.distSqr(e[0])<h;for(let f=1;f<e.length;f++)if(Vm(n,e[f-1],e[f])<h)return!0;return!1}function Vm(n,e,s){const h=e.distSqr(s);if(h===0)return n.distSqr(e);const f=((n.x-e.x)*(s.x-e.x)+(n.y-e.y)*(s.y-e.y))/h;return n.distSqr(f<0?e:f>1?s:s.sub(e)._mult(f)._add(e))}function $m(n,e){let s,h,f,y=!1;for(let v=0;v<n.length;v++){s=n[v];for(let w=0,S=s.length-1;w<s.length;S=w++)h=s[w],f=s[S],h.y>e.y!=f.y>e.y&&e.x<(f.x-h.x)*(e.y-h.y)/(f.y-h.y)+h.x&&(y=!y)}return y}function cl(n,e){let s=!1;for(let h=0,f=n.length-1;h<n.length;f=h++){const y=n[h],v=n[f];y.y>e.y!=v.y>e.y&&e.x<(v.x-y.x)*(e.y-y.y)/(v.y-y.y)+y.x&&(s=!s)}return s}function P1(n,e,s){const h=s[0],f=s[2];if(n.x<h.x&&e.x<h.x||n.x>f.x&&e.x>f.x||n.y<h.y&&e.y<h.y||n.y>f.y&&e.y>f.y)return!1;const y=We(n,e,s[0]);return y!==We(n,e,s[1])||y!==We(n,e,s[2])||y!==We(n,e,s[3])}function Zh(n,e,s){const h=e.paint.get(n).value;return h.kind==="constant"?h.value:s.programConfigurations.get(e.id).getMaxValue(n)}function Fu(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Bu(n,e,s,h,f){if(!e[0]&&!e[1])return n;const y=$.convert(e)._mult(f);s==="viewport"&&y._rotate(-h);const v=[];for(let w=0;w<n.length;w++)v.push(n[w].sub(y));return v}let qm,Zm;ne("CircleBucket",Mf,{omit:["layers"]});var E1={get paint(){return Zm=Zm||new Ar({"circle-radius":new we(pt.paint_circle["circle-radius"]),"circle-color":new we(pt.paint_circle["circle-color"]),"circle-blur":new we(pt.paint_circle["circle-blur"]),"circle-opacity":new we(pt.paint_circle["circle-opacity"]),"circle-translate":new ue(pt.paint_circle["circle-translate"]),"circle-translate-anchor":new ue(pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ue(pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ue(pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new we(pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new we(pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new we(pt.paint_circle["circle-stroke-opacity"])})},get layout(){return qm=qm||new Ar({"circle-sort-key":new we(pt.layout_circle["circle-sort-key"])})}};class I1 extends dr{constructor(e){super(e,E1)}createBucket(e){return new Mf(e)}queryRadius(e){const s=e;return Zh("circle-radius",this,s)+Zh("circle-stroke-width",this,s)+Fu(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:h,geometry:f,transform:y,pixelsToTileUnits:v,unwrappedTileID:w,getElevation:S}){const E=Bu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-y.bearingInRadians,v),C=this.paint.get("circle-radius").evaluate(s,h)+this.paint.get("circle-stroke-width").evaluate(s,h),k=this.paint.get("circle-pitch-alignment")==="map",N=k?E:function(V,W,K,rt){return V.map(_t=>Wm(_t,W,K,rt))}(E,y,w,S),U=k?C*v:C;for(const V of f)for(const W of V){const K=k?W:Wm(W,y,w,S);let rt=U;const _t=y.projectTileCoordinates(W.x,W.y,w,S).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?rt*=_t/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(rt*=y.cameraToCenterDistance/_t),M1(N,K,rt))return!0}return!1}}function Wm(n,e,s,h){const f=e.projectTileCoordinates(n.x,n.y,s,h).point;return new $((.5*f.x+.5)*e.width,(.5*-f.y+.5)*e.height)}class Xm extends Mf{}let Hm;ne("HeatmapBucket",Xm,{omit:["layers"]});var C1={get paint(){return Hm=Hm||new Ar({"heatmap-radius":new we(pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new we(pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ue(pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new io(pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ue(pt.paint_heatmap["heatmap-opacity"])})}};function Pf(n,{width:e,height:s},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*s*h)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${e*s*h}`)}else f=new Uint8Array(e*s*h);return n.width=e,n.height=s,n.data=f,n}function Km(n,{width:e,height:s},h){if(e===n.width&&s===n.height)return;const f=Pf({},{width:e,height:s},h);Ef(n,f,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,s)},h),n.width=e,n.height=s,n.data=f.data}function Ef(n,e,s,h,f,y){if(f.width===0||f.height===0)return e;if(f.width>n.width||f.height>n.height||s.x>n.width-f.width||s.y>n.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||h.x>e.width-f.width||h.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=n.data,w=e.data;if(v===w)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<f.height;S++){const E=((s.y+S)*n.width+s.x)*y,C=((h.y+S)*e.width+h.x)*y;for(let k=0;k<f.width*y;k++)w[C+k]=v[E+k]}return e}class Wh{constructor(e,s){Pf(this,e,1,s)}resize(e){Km(this,e,1)}clone(){return new Wh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,h,f,y){Ef(e,s,h,f,y,1)}}class Wr{constructor(e,s){Pf(this,e,4,s)}resize(e){Km(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Wr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,h,f,y){Ef(e,s,h,f,y,4)}setPixel(e,s,h){const f=4*(e*this.width+s);this.data[f+0]=Math.round(255*h.r/h.a),this.data[f+1]=Math.round(255*h.g/h.a),this.data[f+2]=Math.round(255*h.b/h.a),this.data[f+3]=Math.round(255*h.a)}}function Ym(n){const e={},s=n.resolution||256,h=n.clips?n.clips.length:1,f=n.image||new Wr({width:s,height:h});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const y=(v,w,S)=>{e[n.evaluationKey]=S;const E=n.expression.evaluate(e);f.setPixel(v/4/s,w/4,E)};if(n.clips)for(let v=0,w=0;v<h;++v,w+=4*s)for(let S=0,E=0;S<s;S++,E+=4){const C=S/(s-1),{start:k,end:N}=n.clips[v];y(w,E,k*(1-C)+N*C)}else for(let v=0,w=0;v<s;v++,w+=4)y(0,w,v/(s-1));return f}ne("AlphaImage",Wh),ne("RGBAImage",Wr);const If="big-fb";class A1 extends dr{createBucket(e){return new Xm(e)}constructor(e){super(e,C1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ym({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(If)&&this.heatmapFbos.delete(If)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Jm;var R1={get paint(){return Jm=Jm||new Ar({"hillshade-illumination-direction":new ue(pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ue(pt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ue(pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ue(pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ue(pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ue(pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ue(pt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ue(pt.paint_hillshade["hillshade-method"])})}};class D1 extends dr{constructor(e){super(e,R1),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,s=this.paint.get("hillshade-illumination-altitude").values,h=this.paint.get("hillshade-highlight-color").values,f=this.paint.get("hillshade-shadow-color").values;const y=Math.max(e.length,s.length,h.length,f.length);e=e.concat(Array(y-e.length).fill(e.at(-1))),s=s.concat(Array(y-s.length).fill(s.at(-1))),h=h.concat(Array(y-h.length).fill(h.at(-1))),f=f.concat(Array(y-f.length).fill(f.at(-1)));const v=s.map(Vi);return{directionRadians:e.map(Vi),altitudeRadians:v,shadowColor:f,highlightColor:h}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Qm;var z1={get paint(){return Qm=Qm||new Ar({"color-relief-opacity":new ue(pt["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new io(pt["paint_color-relief"]["color-relief-color"])})}};class Cf{constructor(e,s,h,f){this.context=e,this.format=h,this.texture=e.gl.createTexture(),this.update(s,f)}update(e,s,h){const{width:f,height:y}=e,v=!(this.size&&this.size[0]===f&&this.size[1]===y||h),{context:w}=this,{gl:S}=w;if(this.useMipmap=!!(s&&s.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[f,y],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Be(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,f,y,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:E,y:C}=h||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Be(e)?S.texSubImage2D(S.TEXTURE_2D,0,E,C,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,E,C,f,y,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,s,h){const{context:f}=this,{gl:y}=f;y.bindTexture(y.TEXTURE_2D,this.texture),h!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=y.LINEAR),e!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,e),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,h||e),this.filter=e),s!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class tg{constructor(e,s,h,f=1,y=1,v=1,w=0){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void De(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const S=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=y,this.blueFactor=v,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<S;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(S,E)]=this.data[this._idx(S-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,S)]=this.data[this._idx(E,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<S;E++)for(let C=0;C<S;C++){const k=this.get(E,C);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(e,s){const h=new Uint8Array(this.data.buffer),f=4*this._idx(e,s);return this.unpack(h[f],h[f+1],h[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}unpack(e,s,h){return e*this.redFactor+s*this.greenFactor+h*this.blueFactor-this.baseShift}pack(e){return eg(e,this.getUnpackVector())}getPixels(){return new Wr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,h){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,y=s*this.dim+this.dim,v=h*this.dim,w=h*this.dim+this.dim;switch(s){case-1:f=y-1;break;case 1:y=f+1}switch(h){case-1:v=w-1;break;case 1:w=v+1}const S=-s*this.dim,E=-h*this.dim;for(let C=v;C<w;C++)for(let k=f;k<y;k++)this.data[this._idx(k,C)]=e.data[this._idx(k+S,C+E)]}}function eg(n,e){const s=e[0],h=e[1],f=e[2],y=e[3],v=Math.min(s,h,f),w=Math.round((n+y)/v);return{r:Math.floor(w*v/s)%256,g:Math.floor(w*v/h)%256,b:Math.floor(w*v/f)%256}}ne("DEMData",tg);class k1 extends dr{constructor(e){super(e,z1)}_createColorRamp(e){const s={elevationStops:[],colorStops:[]},h=this._transitionablePaint._values["color-relief-color"].value.expression;if(h instanceof qa&&h._styleExpression.expression instanceof Ir){this.colorRampExpression=h;const v=h._styleExpression.expression;s.elevationStops=v.labels,s.colorStops=[];for(const w of s.elevationStops)s.colorStops.push(v.evaluate({globals:{elevation:w}}))}if(s.elevationStops.length<1&&(s.elevationStops=[0],s.colorStops=[Ke.transparent]),s.elevationStops.length<2&&(s.elevationStops.push(s.elevationStops[0]+1),s.colorStops.push(s.colorStops[0])),s.elevationStops.length<=e)return s;const f={elevationStops:[],colorStops:[]},y=(s.elevationStops.length-1)/(e-1);for(let v=0;v<s.elevationStops.length-.5;v+=y)f.elevationStops.push(s.elevationStops[Math.round(v)]),f.colorStops.push(s.colorStops[Math.round(v)]);return De(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),f}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,s,h){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const f=this._createColorRamp(s),y=new Wr({width:f.colorStops.length,height:1}),v=new Wr({width:f.colorStops.length,height:1});for(let w=0;w<f.elevationStops.length;w++){const S=eg(f.elevationStops[w],h);v.setPixel(0,w,new Ke(S.r/255,S.g/255,S.b/255,1)),y.setPixel(0,w,f.colorStops[w])}return this.colorRampTextures={elevationTexture:new Cf(e,v,e.gl.RGBA),colorTexture:new Cf(e,y,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const L1=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:O1}=L1;function Af(n,e,s){const h=s.patternDependencies;let f=!1;for(const y of e){const v=y.paint.get(`${n}-pattern`);v.isConstant()||(f=!0);const w=v.constantOr(null);w&&(f=!0,h[w.to]=!0,h[w.from]=!0)}return f}function Rf(n,e,s,h,f){const y=f.patternDependencies;for(const v of e){const w=v.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let S=w.evaluate({zoom:h-1},s,{},f.availableImages),E=w.evaluate({zoom:h},s,{},f.availableImages),C=w.evaluate({zoom:h+1},s,{},f.availableImages);S=S&&S.name?S.name:S,E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,y[S]=!0,y[E]=!0,y[C]=!0,s.patterns[v.id]={min:S,mid:E,max:C}}}return s}function ig(n,e,s,h,f){let y;if(f===function(v,w,S,E){let C=0;for(let k=w,N=S-E;k<S;k+=E)C+=(v[N]-v[k])*(v[k+1]+v[N+1]),N=k;return C}(n,e,s,h)>0)for(let v=e;v<s;v+=h)y=ag(v/h|0,n[v],n[v+1],y);else for(let v=s-h;v>=e;v-=h)y=ag(v/h|0,n[v],n[v+1],y);return y&&ul(y,y.next)&&(Yh(y),y=y.next),y}function co(n,e){if(!n)return n;e||(e=n);let s,h=n;do if(s=!1,h.steiner||!ul(h,h.next)&&Wi(h.prev,h,h.next)!==0)h=h.next;else{if(Yh(h),h=e=h.prev,h===h.next)break;s=!0}while(s||h!==e);return e}function Xh(n,e,s,h,f,y,v){if(!n)return;!v&&y&&function(S,E,C,k){let N=S;do N.z===0&&(N.z=Df(N.x,N.y,E,C,k)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==S);N.prevZ.nextZ=null,N.prevZ=null,function(U){let V,W=1;do{let K,rt=U;U=null;let _t=null;for(V=0;rt;){V++;let lt=rt,j=0;for(let ct=0;ct<W&&(j++,lt=lt.nextZ,lt);ct++);let H=W;for(;j>0||H>0&&lt;)j!==0&&(H===0||!lt||rt.z<=lt.z)?(K=rt,rt=rt.nextZ,j--):(K=lt,lt=lt.nextZ,H--),_t?_t.nextZ=K:U=K,K.prevZ=_t,_t=K;rt=lt}_t.nextZ=null,W*=2}while(V>1)}(N)}(n,h,f,y);let w=n;for(;n.prev!==n.next;){const S=n.prev,E=n.next;if(y?B1(n,h,f,y):F1(n))e.push(S.i,n.i,E.i),Yh(n),n=E.next,w=E.next;else if((n=E)===w){v?v===1?Xh(n=N1(co(n),e),e,s,h,f,y,2):v===2&&G1(n,e,s,h,f,y):Xh(co(n),e,s,h,f,y,1);break}}}function F1(n){const e=n.prev,s=n,h=n.next;if(Wi(e,s,h)>=0)return!1;const f=e.x,y=s.x,v=h.x,w=e.y,S=s.y,E=h.y,C=Math.min(f,y,v),k=Math.min(w,S,E),N=Math.max(f,y,v),U=Math.max(w,S,E);let V=h.next;for(;V!==e;){if(V.x>=C&&V.x<=N&&V.y>=k&&V.y<=U&&Hh(f,w,y,S,v,E,V.x,V.y)&&Wi(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function B1(n,e,s,h){const f=n.prev,y=n,v=n.next;if(Wi(f,y,v)>=0)return!1;const w=f.x,S=y.x,E=v.x,C=f.y,k=y.y,N=v.y,U=Math.min(w,S,E),V=Math.min(C,k,N),W=Math.max(w,S,E),K=Math.max(C,k,N),rt=Df(U,V,e,s,h),_t=Df(W,K,e,s,h);let lt=n.prevZ,j=n.nextZ;for(;lt&&lt.z>=rt&&j&&j.z<=_t;){if(lt.x>=U&&lt.x<=W&&lt.y>=V&&lt.y<=K&&lt!==f&&lt!==v&&Hh(w,C,S,k,E,N,lt.x,lt.y)&&Wi(lt.prev,lt,lt.next)>=0||(lt=lt.prevZ,j.x>=U&&j.x<=W&&j.y>=V&&j.y<=K&&j!==f&&j!==v&&Hh(w,C,S,k,E,N,j.x,j.y)&&Wi(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;lt&&lt.z>=rt;){if(lt.x>=U&&lt.x<=W&&lt.y>=V&&lt.y<=K&&lt!==f&&lt!==v&&Hh(w,C,S,k,E,N,lt.x,lt.y)&&Wi(lt.prev,lt,lt.next)>=0)return!1;lt=lt.prevZ}for(;j&&j.z<=_t;){if(j.x>=U&&j.x<=W&&j.y>=V&&j.y<=K&&j!==f&&j!==v&&Hh(w,C,S,k,E,N,j.x,j.y)&&Wi(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function N1(n,e){let s=n;do{const h=s.prev,f=s.next.next;!ul(h,f)&&sg(h,s,s.next,f)&&Kh(h,f)&&Kh(f,h)&&(e.push(h.i,s.i,f.i),Yh(s),Yh(s.next),s=n=f),s=s.next}while(s!==n);return co(s)}function G1(n,e,s,h,f,y){let v=n;do{let w=v.next.next;for(;w!==v.prev;){if(v.i!==w.i&&q1(v,w)){let S=ng(v,w);return v=co(v,v.next),S=co(S,S.next),Xh(v,e,s,h,f,y,0),void Xh(S,e,s,h,f,y,0)}w=w.next}v=v.next}while(v!==n)}function j1(n,e){let s=n.x-e.x;return s===0&&(s=n.y-e.y,s===0)&&(s=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),s}function U1(n,e){const s=function(f,y){let v=y;const w=f.x,S=f.y;let E,C=-1/0;if(ul(f,v))return v;do{if(ul(f,v.next))return v.next;if(S<=v.y&&S>=v.next.y&&v.next.y!==v.y){const W=v.x+(S-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(W<=w&&W>C&&(C=W,E=v.x<v.next.x?v:v.next,W===w))return E}v=v.next}while(v!==y);if(!E)return null;const k=E,N=E.x,U=E.y;let V=1/0;v=E;do{if(w>=v.x&&v.x>=N&&w!==v.x&&rg(S<U?w:C,S,N,U,S<U?C:w,S,v.x,v.y)){const W=Math.abs(S-v.y)/(w-v.x);Kh(v,f)&&(W<V||W===V&&(v.x>E.x||v.x===E.x&&V1(E,v)))&&(E=v,V=W)}v=v.next}while(v!==k);return E}(n,e);if(!s)return e;const h=ng(s,n);return co(h,h.next),co(s,s.next)}function V1(n,e){return Wi(n.prev,n,e.prev)<0&&Wi(e.next,n,n.next)<0}function Df(n,e,s,h,f){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-h)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $1(n){let e=n,s=n;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==n);return s}function rg(n,e,s,h,f,y,v,w){return(f-v)*(e-w)>=(n-v)*(y-w)&&(n-v)*(h-w)>=(s-v)*(e-w)&&(s-v)*(y-w)>=(f-v)*(h-w)}function Hh(n,e,s,h,f,y,v,w){return!(n===v&&e===w)&&rg(n,e,s,h,f,y,v,w)}function q1(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(s,h){let f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==h.i&&f.next.i!==h.i&&sg(f,f.next,s,h))return!0;f=f.next}while(f!==s);return!1}(n,e)&&(Kh(n,e)&&Kh(e,n)&&function(s,h){let f=s,y=!1;const v=(s.x+h.x)/2,w=(s.y+h.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&v<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(y=!y),f=f.next;while(f!==s);return y}(n,e)&&(Wi(n.prev,n,e.prev)||Wi(n,e.prev,e))||ul(n,e)&&Wi(n.prev,n,n.next)>0&&Wi(e.prev,e,e.next)>0)}function Wi(n,e,s){return(e.y-n.y)*(s.x-e.x)-(e.x-n.x)*(s.y-e.y)}function ul(n,e){return n.x===e.x&&n.y===e.y}function sg(n,e,s,h){const f=Gu(Wi(n,e,s)),y=Gu(Wi(n,e,h)),v=Gu(Wi(s,h,n)),w=Gu(Wi(s,h,e));return f!==y&&v!==w||!(f!==0||!Nu(n,s,e))||!(y!==0||!Nu(n,h,e))||!(v!==0||!Nu(s,n,h))||!(w!==0||!Nu(s,e,h))}function Nu(n,e,s){return e.x<=Math.max(n.x,s.x)&&e.x>=Math.min(n.x,s.x)&&e.y<=Math.max(n.y,s.y)&&e.y>=Math.min(n.y,s.y)}function Gu(n){return n>0?1:n<0?-1:0}function Kh(n,e){return Wi(n.prev,n,n.next)<0?Wi(n,e,n.next)>=0&&Wi(n,n.prev,e)>=0:Wi(n,e,n.prev)<0||Wi(n,n.next,e)<0}function ng(n,e){const s=zf(n.i,n.x,n.y),h=zf(e.i,e.x,e.y),f=n.next,y=e.prev;return n.next=e,e.prev=n,s.next=f,f.prev=s,h.next=s,s.prev=h,y.next=h,h.prev=y,h}function ag(n,e,s,h){const f=zf(n,e,s);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function Yh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function zf(n,e,s){return{i:n,x:e,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class dl{constructor(e,s){if(s>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=s}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class ju{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}ju.noSubdivision=new ju({fill:new dl(0,0),line:new dl(0,0),tile:new dl(0,0),stencil:new dl(0,0),circle:1}),ne("SubdivisionGranularityExpression",dl),ne("SubdivisionGranularitySetting",ju);const fl=-32768,Jh=32767;class Z1{constructor(e,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Mt/e,this._canonical=s}_getKey(e,s){return(e+=32768)<<16|s+32768}_vertexToIndex(e,s){if(e<-32768||s<-32768||e>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const h=0|Math.round(e),f=0|Math.round(s),y=this._getKey(h,f);if(this._vertexDictionary.has(y))return this._vertexDictionary.get(y);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(y,v),this._vertexBuffer.push(h,f),v}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(f,y){const v=[];for(let w=0;w<y.length;w+=3){const S=y[w],E=y[w+1],C=y[w+2],k=f[2*S],N=f[2*S+1];(f[2*E]-k)*(f[2*C+1]-N)-(f[2*E+1]-N)*(f[2*C]-k)>0?(v.push(S),v.push(C),v.push(E)):(v.push(S),v.push(E),v.push(C))}return v}(this._vertexBuffer,e);const s=[],h=e.length;for(let f=0;f<h;f+=3){const y=[e[f+0],e[f+1],e[f+2]],v=[this._vertexBuffer[2*e[f+0]+0],this._vertexBuffer[2*e[f+0]+1],this._vertexBuffer[2*e[f+1]+0],this._vertexBuffer[2*e[f+1]+1],this._vertexBuffer[2*e[f+2]+0],this._vertexBuffer[2*e[f+2]+1]];let w=1/0,S=1/0,E=-1/0,C=-1/0;for(let W=0;W<3;W++){const K=v[2*W],rt=v[2*W+1];w=Math.min(w,K),E=Math.max(E,K),S=Math.min(S,rt),C=Math.max(C,rt)}if(w===E||S===C)continue;const k=Math.floor(w/this._granularityCellSize),N=Math.ceil(E/this._granularityCellSize),U=Math.floor(S/this._granularityCellSize),V=Math.ceil(C/this._granularityCellSize);if(k!==N||U!==V)for(let W=U;W<V;W++){const K=this._scanlineGenerateVertexRingForCellRow(W,v,y);W1(this._vertexBuffer,K,s)}else s.push(...y)}return s}_scanlineGenerateVertexRingForCellRow(e,s,h){const f=e*this._granularityCellSize,y=f+this._granularityCellSize,v=[];for(let w=0;w<3;w++){const S=s[2*w],E=s[2*w+1],C=s[2*(w+1)%6],k=s[(2*(w+1)+1)%6],N=s[2*(w+2)%6],U=s[(2*(w+2)+1)%6],V=C-S,W=k-E,K=V===0,rt=W===0,_t=(f-E)/W,lt=(y-E)/W,j=Math.min(_t,lt),H=Math.max(_t,lt);if(!rt&&(j>=1||H<=0)||rt&&(E<f||E>y)){k>=f&&k<=y&&v.push(h[(w+1)%3]);continue}!rt&&j>0&&v.push(this._vertexToIndex(S+V*j,E+W*j));const ct=S+V*Math.max(j,0),Et=S+V*Math.min(H,1);K||this._generateIntraEdgeVertices(v,S,E,C,k,ct,Et),!rt&&H<1&&v.push(this._vertexToIndex(S+V*H,E+W*H)),(rt||k>=f&&k<=y)&&v.push(h[(w+1)%3]),!rt&&(k<=f||k>=y)&&this._generateInterEdgeVertices(v,S,E,C,k,N,U,Et,f,y)}return v}_generateIntraEdgeVertices(e,s,h,f,y,v,w){const S=f-s,E=y-h,C=E===0,k=C?Math.min(s,f):Math.min(v,w),N=C?Math.max(s,f):Math.max(v,w),U=Math.floor(k/this._granularityCellSize)+1,V=Math.ceil(N/this._granularityCellSize)-1;if(C?s<f:v<w)for(let W=U;W<=V;W++){const K=W*this._granularityCellSize;e.push(this._vertexToIndex(K,h+E*(K-s)/S))}else for(let W=V;W>=U;W--){const K=W*this._granularityCellSize;e.push(this._vertexToIndex(K,h+E*(K-s)/S))}}_generateInterEdgeVertices(e,s,h,f,y,v,w,S,E,C){const k=y-h,N=v-f,U=w-y,V=(E-y)/U,W=(C-y)/U,K=Math.min(V,W),rt=Math.max(V,W),_t=f+N*K;let lt=Math.floor(Math.min(_t,S)/this._granularityCellSize)+1,j=Math.ceil(Math.max(_t,S)/this._granularityCellSize)-1,H=S<_t;const ct=U===0;if(ct&&(w===E||w===C))return;if(ct||K>=1||rt<=0){const Ut=h-w,Rt=v+(s-v)*Math.min((E-w)/Ut,(C-w)/Ut);lt=Math.floor(Math.min(Rt,S)/this._granularityCellSize)+1,j=Math.ceil(Math.max(Rt,S)/this._granularityCellSize)-1,H=S<Rt}const Et=k>0?C:E;if(H)for(let Ut=lt;Ut<=j;Ut++)e.push(this._vertexToIndex(Ut*this._granularityCellSize,Et));else for(let Ut=j;Ut>=lt;Ut--)e.push(this._vertexToIndex(Ut*this._granularityCellSize,Et))}_generateOutline(e){const s=[];for(const h of e){const f=uo(h,this._granularity,!0),y=this._pointArrayToIndices(f),v=[];for(let w=1;w<y.length;w++)v.push(y[w-1]),v.push(y[w]);s.push(v)}return s}_handlePoles(e){let s=!1,h=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(h=!0)),(s||h)&&this._fillPoles(e,s,h)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let s=0;s<e.length;s+=2){const h=e[s+1];h===fl&&(e[s+1]=-32767),h===Jh&&(e[s+1]=32766)}}_generatePoleQuad(e,s,h,f,y,v){f>y!=(v===fl)?(e.push(s),e.push(h),e.push(this._vertexToIndex(f,v)),e.push(h),e.push(this._vertexToIndex(y,v)),e.push(this._vertexToIndex(f,v))):(e.push(h),e.push(s),e.push(this._vertexToIndex(f,v)),e.push(this._vertexToIndex(y,v)),e.push(h),e.push(this._vertexToIndex(f,v)))}_fillPoles(e,s,h){const f=this._vertexBuffer,y=Mt,v=e.length;for(let w=2;w<v;w+=3){const S=e[w-2],E=e[w-1],C=e[w],k=f[2*S],N=f[2*S+1],U=f[2*E],V=f[2*E+1],W=f[2*C],K=f[2*C+1];s&&(N===0&&V===0&&this._generatePoleQuad(e,S,E,k,U,fl),V===0&&K===0&&this._generatePoleQuad(e,E,C,U,W,fl),K===0&&N===0&&this._generatePoleQuad(e,C,S,W,k,fl)),h&&(N===y&&V===y&&this._generatePoleQuad(e,S,E,k,U,Jh),V===y&&K===y&&this._generatePoleQuad(e,E,C,U,W,Jh),K===y&&N===y&&this._generatePoleQuad(e,C,S,W,k,Jh))}}_initializeVertices(e){for(let s=0;s<e.length;s+=2)this._vertexToIndex(e[s],e[s+1])}subdividePolygonInternal(e,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:h,holeIndices:f}=function(w){const S=[],E=[];for(const C of w)if(C.length!==0){C!==w[0]&&S.push(E.length/2);for(let k=0;k<C.length;k++)E.push(C[k].x),E.push(C[k].y)}return{flattened:E,holeIndices:S}}(e);let y;this._initializeVertices(h);try{const w=function(E,C,k=2){const N=C&&C.length,U=N?C[0]*k:E.length;let V=ig(E,0,U,k,!0);const W=[];if(!V||V.next===V.prev)return W;let K,rt,_t;if(N&&(V=function(lt,j,H,ct){const Et=[];for(let Ut=0,Rt=j.length;Ut<Rt;Ut++){const kt=ig(lt,j[Ut]*ct,Ut<Rt-1?j[Ut+1]*ct:lt.length,ct,!1);kt===kt.next&&(kt.steiner=!0),Et.push($1(kt))}Et.sort(j1);for(let Ut=0;Ut<Et.length;Ut++)H=U1(Et[Ut],H);return H}(E,C,V,k)),E.length>80*k){K=1/0,rt=1/0;let lt=-1/0,j=-1/0;for(let H=k;H<U;H+=k){const ct=E[H],Et=E[H+1];ct<K&&(K=ct),Et<rt&&(rt=Et),ct>lt&&(lt=ct),Et>j&&(j=Et)}_t=Math.max(lt-K,j-rt),_t=_t!==0?32767/_t:0}return Xh(V,W,k,K,rt,_t,0),W}(h,f),S=this._convertIndices(h,w);y=this._subdivideTrianglesScanline(S)}catch(w){console.error(w)}let v=[];return s&&(v=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(y),{verticesFlattened:this._vertexBuffer,indicesTriangles:y,indicesLineList:v}}_convertIndices(e,s){const h=[];for(let f=0;f<s.length;f++)h.push(this._vertexToIndex(e[2*s[f]],e[2*s[f]+1]));return h}_pointArrayToIndices(e){const s=[];for(let h=0;h<e.length;h++){const f=e[h];s.push(this._vertexToIndex(f.x,f.y))}return s}}function og(n,e,s,h=!0){return new Z1(s,e).subdividePolygonInternal(n,h)}function uo(n,e,s=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const h=n[0],f=n[n.length-1],y=s&&(h.x!==f.x||h.y!==f.y);if(e<2)return y?[...n,n[0]]:[...n];const v=Math.floor(Mt/e),w=[];w.push(new $(n[0].x,n[0].y));const S=n.length,E=y?S:S-1;for(let C=0;C<E;C++){const k=n[C],N=C<S-1?n[C+1]:n[0],U=k.x,V=k.y,W=N.x,K=N.y,rt=U!==W,_t=V!==K;if(!rt&&!_t)continue;const lt=W-U,j=K-V,H=Math.abs(lt),ct=Math.abs(j);let Et=U,Ut=V;for(;;){const kt=lt>0?(Math.floor(Et/v)+1)*v:(Math.ceil(Et/v)-1)*v,Zt=j>0?(Math.floor(Ut/v)+1)*v:(Math.ceil(Ut/v)-1)*v,$t=Math.abs(Et-kt),Kt=Math.abs(Ut-Zt),Ft=Math.abs(Et-W),ce=Math.abs(Ut-K),xe=rt?$t/H:Number.POSITIVE_INFINITY,ye=_t?Kt/ct:Number.POSITIVE_INFINITY;if((Ft<=$t||!rt)&&(ce<=Kt||!_t))break;if(xe<ye&&rt||!_t){Et=kt,Ut+=j*xe;const pe=new $(Et,Math.round(Ut));w[w.length-1].x===pe.x&&w[w.length-1].y===pe.y||w.push(pe)}else{Et+=lt*ye,Ut=Zt;const pe=new $(Math.round(Et),Ut);w[w.length-1].x===pe.x&&w[w.length-1].y===pe.y||w.push(pe)}}const Rt=new $(W,K);w[w.length-1].x===Rt.x&&w[w.length-1].y===Rt.y||w.push(Rt)}return w}function W1(n,e,s){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let h=0,f=n[2*e[0]];for(let S=1;S<e.length;S++){const E=n[2*e[S]];E<f&&(f=E,h=S)}const y=e.length;let v=h,w=(v+1)%y;for(;;){const S=v-1>=0?v-1:y-1,E=(w+1)%y,C=n[2*e[S]],k=n[2*e[E]],N=n[2*e[v]],U=n[2*e[v]+1],V=n[2*e[w]+1];let W=!1;if(C<k)W=!0;else if(C>k)W=!1;else{const K=V-U,rt=-(n[2*e[w]]-N),_t=U<V?1:-1;((C-N)*K+(n[2*e[S]+1]-U)*rt)*_t>((k-N)*K+(n[2*e[E]+1]-U)*rt)*_t&&(W=!0)}if(W){const K=e[S],rt=e[v],_t=e[w];K!==rt&&K!==_t&&rt!==_t&&s.push(_t,rt,K),v--,v<0&&(v=y-1)}else{const K=e[E],rt=e[v],_t=e[w];K!==rt&&K!==_t&&rt!==_t&&s.push(_t,rt,K),w++,w>=y&&(w=0)}if(S===E)break}}function lg(n,e,s,h,f,y,v,w,S){const E=f.length/2,C=v&&w&&S;if(E<ai.MAX_VERTEX_ARRAY_LENGTH){const k=e.prepareSegment(E,s,h),N=k.vertexLength;for(let W=0;W<y.length;W+=3)h.emplaceBack(N+y[W],N+y[W+1],N+y[W+2]);let U,V;k.vertexLength+=E,k.primitiveLength+=y.length/3,C&&(V=v.prepareSegment(E,s,w),U=V.vertexLength,V.vertexLength+=E);for(let W=0;W<f.length;W+=2)n(f[W],f[W+1]);if(C)for(let W=0;W<S.length;W++){const K=S[W];for(let rt=1;rt<K.length;rt+=2)w.emplaceBack(U+K[rt-1],U+K[rt]);V.primitiveLength+=K.length/2}}else(function(k,N,U,V,W,K){const rt=[];for(let ct=0;ct<V.length/2;ct++)rt.push(-1);const _t={count:0};let lt=0,j=k.getOrCreateLatestSegment(N,U),H=j.vertexLength;for(let ct=2;ct<W.length;ct+=3){const Et=W[ct-2],Ut=W[ct-1],Rt=W[ct];let kt=rt[Et]<lt,Zt=rt[Ut]<lt,$t=rt[Rt]<lt;j.vertexLength+((kt?1:0)+(Zt?1:0)+($t?1:0))>ai.MAX_VERTEX_ARRAY_LENGTH&&(j=k.createNewSegment(N,U),lt=_t.count,kt=!0,Zt=!0,$t=!0,H=0);const Kt=Qh(rt,V,K,_t,Et,kt,j),Ft=Qh(rt,V,K,_t,Ut,Zt,j),ce=Qh(rt,V,K,_t,Rt,$t,j);U.emplaceBack(H+Kt-lt,H+Ft-lt,H+ce-lt),j.primitiveLength++}})(e,s,h,f,y,n),C&&function(k,N,U,V,W,K){const rt=[];for(let ct=0;ct<V.length/2;ct++)rt.push(-1);const _t={count:0};let lt=0,j=k.getOrCreateLatestSegment(N,U),H=j.vertexLength;for(let ct=0;ct<W.length;ct++){const Et=W[ct];for(let Ut=1;Ut<W[ct].length;Ut+=2){const Rt=Et[Ut-1],kt=Et[Ut];let Zt=rt[Rt]<lt,$t=rt[kt]<lt;j.vertexLength+((Zt?1:0)+($t?1:0))>ai.MAX_VERTEX_ARRAY_LENGTH&&(j=k.createNewSegment(N,U),lt=_t.count,Zt=!0,$t=!0,H=0);const Kt=Qh(rt,V,K,_t,Rt,Zt,j),Ft=Qh(rt,V,K,_t,kt,$t,j);U.emplaceBack(H+Kt-lt,H+Ft-lt),j.primitiveLength++}}}(v,s,w,f,S,n),e.forceNewSegmentOnNextPrepare(),v==null||v.forceNewSegmentOnNextPrepare()}function Qh(n,e,s,h,f,y,v){if(y){const w=h.count;return s(e[2*f],e[2*f+1]),n[f]=h.count,h.count++,v.vertexLength++,w}return n[f]}class kf{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ct,this.indexArray=new yi,this.indexArray2=new gi,this.programConfigurations=new on(e.layers,e.zoom),this.segments=new ai,this.segments2=new ai,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.hasPattern=Af("fill",this.layers,s);const f=this.layers[0].layout.get("fill-sort-key"),y=!f.isConstant(),v=[];for(const{feature:w,id:S,index:E,sourceLayerIndex:C}of e){const k=this.layers[0]._featureFilter.needGeometry,N=ho(w,k);if(!this.layers[0]._featureFilter.filter(new Ci(this.zoom,{globalState:this.globalState}),N,h))continue;const U=y?f.evaluate(N,{},h,s.availableImages):void 0,V={id:S,properties:w.properties,type:w.type,sourceLayerIndex:C,index:E,geometry:k?N.geometry:lo(w),patterns:{},sortKey:U};v.push(V)}y&&v.sort((w,S)=>w.sortKey-S.sortKey);for(const w of v){const{geometry:S,index:E,sourceLayerIndex:C}=w;if(this.hasPattern){const k=Rf("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(k)}else this.addFeature(w,S,E,h,{},s.subdivisionGranularity);s.featureIndex.insert(e[E].feature,S,E,C,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}addFeatures(e,s,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,h,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,O1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,h,f,y,v){for(const w of Fo(s,500)){const S=og(w,f,v.fill.getGranularityForZoomLevel(f.z)),E=this.layoutVertexArray;lg((C,k)=>{E.emplaceBack(C,k)},this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles,this.segments2,this.indexArray2,S.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,y,f)}}let hg,cg;ne("FillBucket",kf,{omit:["layers","patternFeatures"]});var X1={get paint(){return cg=cg||new Ar({"fill-antialias":new ue(pt.paint_fill["fill-antialias"]),"fill-opacity":new we(pt.paint_fill["fill-opacity"]),"fill-color":new we(pt.paint_fill["fill-color"]),"fill-outline-color":new we(pt.paint_fill["fill-outline-color"]),"fill-translate":new ue(pt.paint_fill["fill-translate"]),"fill-translate-anchor":new ue(pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new al(pt.paint_fill["fill-pattern"])})},get layout(){return hg=hg||new Ar({"fill-sort-key":new we(pt.layout_fill["fill-sort-key"])})}};class H1 extends dr{constructor(e){super(e,X1)}recalculate(e,s){super.recalculate(e,s);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new kf(e)}queryRadius(){return Fu(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:s,transform:h,pixelsToTileUnits:f}){return Um(Bu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-h.bearingInRadians,f),s)}isTileClipped(){return!0}}const K1=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Y1=Gi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:J1}=K1;var Lf,ug,Of,dg,Ff,fg,pg,Uu={};function mg(){if(ug)return Lf;ug=1;var n=z();function e(f,y,v,w,S){this.properties={},this.extent=v,this.type=0,this._pbf=f,this._geometry=-1,this._keys=w,this._values=S,f.readFields(s,this,y)}function s(f,y,v){f==1?y.id=v.readVarint():f==2?function(w,S){for(var E=w.readVarint()+w.pos;w.pos<E;){var C=S._keys[w.readVarint()],k=S._values[w.readVarint()];S.properties[C]=k}}(v,y):f==3?y.type=v.readVarint():f==4&&(y._geometry=v.pos)}function h(f){for(var y,v,w=0,S=0,E=f.length,C=E-1;S<E;C=S++)w+=((v=f[C]).x-(y=f[S]).x)*(y.y+v.y);return w}return Lf=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var y,v=f.readVarint()+f.pos,w=1,S=0,E=0,C=0,k=[];f.pos<v;){if(S<=0){var N=f.readVarint();w=7&N,S=N>>3}if(S--,w===1||w===2)E+=f.readSVarint(),C+=f.readSVarint(),w===1&&(y&&k.push(y),y=[]),y.push(new n(E,C));else{if(w!==7)throw new Error("unknown command "+w);y&&y.push(y[0].clone())}}return y&&k.push(y),k},e.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var y=f.readVarint()+f.pos,v=1,w=0,S=0,E=0,C=1/0,k=-1/0,N=1/0,U=-1/0;f.pos<y;){if(w<=0){var V=f.readVarint();v=7&V,w=V>>3}if(w--,v===1||v===2)(S+=f.readSVarint())<C&&(C=S),S>k&&(k=S),(E+=f.readSVarint())<N&&(N=E),E>U&&(U=E);else if(v!==7)throw new Error("unknown command "+v)}return[C,N,k,U]},e.prototype.toGeoJSON=function(f,y,v){var w,S,E=this.extent*Math.pow(2,v),C=this.extent*f,k=this.extent*y,N=this.loadGeometry(),U=e.types[this.type];function V(rt){for(var _t=0;_t<rt.length;_t++){var lt=rt[_t];rt[_t]=[360*(lt.x+C)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(lt.y+k)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(w=0;w<N.length;w++)W[w]=N[w][0];V(N=W);break;case 2:for(w=0;w<N.length;w++)V(N[w]);break;case 3:for(N=function(rt){var _t=rt.length;if(_t<=1)return[rt];for(var lt,j,H=[],ct=0;ct<_t;ct++){var Et=h(rt[ct]);Et!==0&&(j===void 0&&(j=Et<0),j===Et<0?(lt&&H.push(lt),lt=[rt[ct]]):lt.push(rt[ct]))}return lt&&H.push(lt),H}(N),w=0;w<N.length;w++)for(S=0;S<N[w].length;S++)V(N[w][S])}N.length===1?N=N[0]:U="Multi"+U;var K={type:"Feature",geometry:{type:U,coordinates:N},properties:this.properties};return"id"in this&&(K.id=this.id),K},Lf}function gg(){if(dg)return Of;dg=1;var n=mg();function e(h,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(s,this,f),this.length=this._features.length}function s(h,f,y){h===15?f.version=y.readVarint():h===1?f.name=y.readString():h===5?f.extent=y.readVarint():h===2?f._features.push(y.pos):h===3?f._keys.push(y.readString()):h===4&&f._values.push(function(v){for(var w=null,S=v.readVarint()+v.pos;v.pos<S;){var E=v.readVarint()>>3;w=E===1?v.readString():E===2?v.readFloat():E===3?v.readDouble():E===4?v.readVarint64():E===5?v.readVarint():E===6?v.readSVarint():E===7?v.readBoolean():null}return w}(y))}return Of=e,e.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var f=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,f,this.extent,this._keys,this._values)},Of}function _g(){return pg||(pg=1,Uu.VectorTile=function(){if(fg)return Ff;fg=1;var n=gg();function e(s,h,f){if(s===3){var y=new n(f,f.readVarint()+f.pos);y.length&&(h[y.name]=y)}}return Ff=function(s,h){this.layers=s.readFields(e,{},h)},Ff}(),Uu.VectorTileFeature=mg(),Uu.VectorTileLayer=gg()),Uu}var tc=P(_g());const Q1=tc.VectorTileFeature.types,Bf=Math.pow(2,13);function ec(n,e,s,h,f,y,v,w){n.emplaceBack(e,s,2*Math.floor(h*Bf)+v,f*Bf*2,y*Bf*2,Math.round(w))}class Nf{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new te,this.centroidVertexArray=new St,this.indexArray=new yi,this.programConfigurations=new on(e.layers,e.zoom),this.segments=new ai,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.features=[],this.hasPattern=Af("fill-extrusion",this.layers,s);for(const{feature:f,id:y,index:v,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,E=ho(f,S);if(!this.layers[0]._featureFilter.filter(new Ci(this.zoom,{globalState:this.globalState}),E,h))continue;const C={id:y,sourceLayerIndex:w,index:v,geometry:S?E.geometry:lo(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Rf("fill-extrusion",this.layers,C,this.zoom,s)):this.addFeature(C,C.geometry,v,h,{},s.subdivisionGranularity),s.featureIndex.insert(f,C.geometry,v,w,this.index,!0)}}addFeatures(e,s,h){for(const f of this.features){const{geometry:y}=f;this.addFeature(f,y,f.index,s,h,e.subdivisionGranularity)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,J1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Y1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,s,h,f,y,v){for(const w of Fo(s,500)){const S={x:0,y:0,sampleCount:0},E=this.layoutVertexArray.length;this.processPolygon(S,f,e,w,v);const C=this.layoutVertexArray.length-E,k=Math.floor(S.x/S.sampleCount),N=Math.floor(S.y/S.sampleCount);for(let U=0;U<C;U++)this.centroidVertexArray.emplaceBack(k,N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,y,f)}processPolygon(e,s,h,f,y){if(f.length<1||yg(f[0]))return;for(const k of f)k.length!==0&&tv(e,k);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=y.fill.getGranularityForZoomLevel(s.z),S=Q1[h.type]==="Polygon";for(const k of f){if(k.length===0||yg(k))continue;const N=uo(k,w,S);this._generateSideFaces(N,v)}if(!S)return;const E=og(f,s,w,!1),C=this.layoutVertexArray;lg((k,N)=>{ec(C,k,N,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles)}_generateSideFaces(e,s){let h=0;for(let f=1;f<e.length;f++){const y=e[f],v=e[f-1];if(ev(y,v))continue;s.segment.vertexLength+4>ai.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=y.sub(v)._perp()._unit(),S=v.dist(y);h+S>32768&&(h=0),ec(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,0,h),ec(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,1,h),h+=S,ec(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,0,h),ec(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,1,h);const E=s.segment.vertexLength;this.indexArray.emplaceBack(E,E+2,E+1),this.indexArray.emplaceBack(E+1,E+2,E+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function tv(n,e){for(let s=0;s<e.length;s++){const h=e[s];s===e.length-1&&e[0].x===h.x&&e[0].y===h.y||(n.x+=h.x,n.y+=h.y,n.sampleCount++)}}function ev(n,e){return n.x===e.x&&(n.x<0||n.x>Mt)||n.y===e.y&&(n.y<0||n.y>Mt)}function yg(n){return n.every(e=>e.x<0)||n.every(e=>e.x>Mt)||n.every(e=>e.y<0)||n.every(e=>e.y>Mt)}let vg;ne("FillExtrusionBucket",Nf,{omit:["layers","features"]});var iv={get paint(){return vg=vg||new Ar({"fill-extrusion-opacity":new ue(pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new we(pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ue(pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ue(pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new al(pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new we(pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new we(pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ue(pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class rv extends dr{constructor(e){super(e,iv)}createBucket(e){return new Nf(e)}queryRadius(){return Fu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:h,geometry:f,transform:y,pixelsToTileUnits:v,pixelPosMatrix:w}){const S=Bu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-y.bearingInRadians,v),E=this.paint.get("fill-extrusion-height").evaluate(s,h),C=this.paint.get("fill-extrusion-base").evaluate(s,h),k=function(U,V){const W=[];for(const K of U){const rt=[K.x,K.y,0,1];Ri(rt,rt,V),W.push(new $(rt[0]/rt[3],rt[1]/rt[3]))}return W}(S,w),N=function(U,V,W,K){const rt=[],_t=[],lt=K[8]*V,j=K[9]*V,H=K[10]*V,ct=K[11]*V,Et=K[8]*W,Ut=K[9]*W,Rt=K[10]*W,kt=K[11]*W;for(const Zt of U){const $t=[],Kt=[];for(const Ft of Zt){const ce=Ft.x,xe=Ft.y,ye=K[0]*ce+K[4]*xe+K[12],pe=K[1]*ce+K[5]*xe+K[13],ei=K[2]*ce+K[6]*xe+K[14],ji=K[3]*ce+K[7]*xe+K[15],tr=ei+H,Tr=ji+ct,ms=ye+Et,Xr=pe+Ut,gr=ei+Rt,Bi=ji+kt,lr=new $((ye+lt)/Tr,(pe+j)/Tr);lr.z=tr/Tr,$t.push(lr);const _r=new $(ms/Bi,Xr/Bi);_r.z=gr/Bi,Kt.push(_r)}rt.push($t),_t.push(Kt)}return[rt,_t]}(f,C,E,w);return function(U,V,W){let K=1/0;Um(W,V)&&(K=xg(W,V[0]));for(let rt=0;rt<V.length;rt++){const _t=V[rt],lt=U[rt];for(let j=0;j<_t.length-1;j++){const H=_t[j],ct=[H,_t[j+1],lt[j+1],lt[j],H];jm(W,ct)&&(K=Math.min(K,xg(W,ct)))}}return K!==1/0&&K}(N[0],N[1],k)}}function ic(n,e){return n.x*e.x+n.y*e.y}function xg(n,e){if(n.length===1){let s=0;const h=e[s++];let f;for(;!f||h.equals(f);)if(f=e[s++],!f)return 1/0;for(;s<e.length;s++){const y=e[s],v=n[0],w=f.sub(h),S=y.sub(h),E=v.sub(h),C=ic(w,w),k=ic(w,S),N=ic(S,S),U=ic(E,w),V=ic(E,S),W=C*N-k*k,K=(N*U-k*V)/W,rt=(C*V-k*U)/W,_t=h.z*(1-K-rt)+f.z*K+y.z*rt;if(isFinite(_t))return _t}return 1/0}{let s=1/0;for(const h of e)s=Math.min(s,h.z);return s}}const sv=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:nv}=sv,av=Gi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ov}=av,lv=tc.VectorTileFeature.types,hv=Math.cos(Math.PI/180*37.5),bg=Math.pow(2,14)/.5;class Gf{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Jt,this.layoutVertexArray2=new Vt,this.indexArray=new yi,this.programConfigurations=new on(e.layers,e.zoom),this.segments=new ai,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.hasPattern=Af("line",this.layers,s);const f=this.layers[0].layout.get("line-sort-key"),y=!f.isConstant(),v=[];for(const{feature:w,id:S,index:E,sourceLayerIndex:C}of e){const k=this.layers[0]._featureFilter.needGeometry,N=ho(w,k);if(!this.layers[0]._featureFilter.filter(new Ci(this.zoom,{globalState:this.globalState}),N,h))continue;const U=y?f.evaluate(N,{},h):void 0,V={id:S,properties:w.properties,type:w.type,sourceLayerIndex:C,index:E,geometry:k?N.geometry:lo(w),patterns:{},sortKey:U};v.push(V)}y&&v.sort((w,S)=>w.sortKey-S.sortKey);for(const w of v){const{geometry:S,index:E,sourceLayerIndex:C}=w;if(this.hasPattern){const k=Rf("line",this.layers,w,this.zoom,s);this.patternFeatures.push(k)}else this.addFeature(w,S,E,h,{},s.subdivisionGranularity);s.featureIndex.insert(e[E].feature,S,E,C,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}addFeatures(e,s,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,h,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ov)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,h,f,y,v){const w=this.layers[0].layout,S=w.get("line-join").evaluate(e,{}),E=w.get("line-cap"),C=w.get("line-miter-limit"),k=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const N of s)this.addLine(N,e,S,E,C,k,f,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,y,f)}addLine(e,s,h,f,y,v,w,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=uo(e,w?S.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let lt=0;lt<e.length-1;lt++)this.totalDistance+=e[lt].dist(e[lt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=lv[s.type]==="Polygon";let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let k=0;for(;k<C-1&&e[k].equals(e[k+1]);)k++;if(C<(E?3:2))return;h==="bevel"&&(y=1.05);const N=this.overscaling<=16?122880/(512*this.overscaling):0,U=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let V,W,K,rt,_t;this.e1=this.e2=-1,E&&(V=e[C-2],_t=e[k].sub(V)._unit()._perp());for(let lt=k;lt<C;lt++){if(K=lt===C-1?E?e[k+1]:void 0:e[lt+1],K&&e[lt].equals(K))continue;_t&&(rt=_t),V&&(W=V),V=e[lt],_t=K?K.sub(V)._unit()._perp():rt,rt=rt||_t;let j=rt.add(_t);j.x===0&&j.y===0||j._unit();const H=rt.x*_t.x+rt.y*_t.y,ct=j.x*_t.x+j.y*_t.y,Et=ct!==0?1/ct:1/0,Ut=2*Math.sqrt(2-2*ct),Rt=ct<hv&&W&&K,kt=rt.x*_t.y-rt.y*_t.x>0;if(Rt&&lt>k){const Kt=V.dist(W);if(Kt>2*N){const Ft=V.sub(V.sub(W)._mult(N/Kt)._round());this.updateDistance(W,Ft),this.addCurrentVertex(Ft,rt,0,0,U),W=Ft}}const Zt=W&&K;let $t=Zt?h:E?"butt":f;if(Zt&&$t==="round"&&(Et<v?$t="miter":Et<=2&&($t="fakeround")),$t==="miter"&&Et>y&&($t="bevel"),$t==="bevel"&&(Et>2&&($t="flipbevel"),Et<y&&($t="miter")),W&&this.updateDistance(W,V),$t==="miter")j._mult(Et),this.addCurrentVertex(V,j,0,0,U);else if($t==="flipbevel"){if(Et>100)j=_t.mult(-1);else{const Kt=Et*rt.add(_t).mag()/rt.sub(_t).mag();j._perp()._mult(Kt*(kt?-1:1))}this.addCurrentVertex(V,j,0,0,U),this.addCurrentVertex(V,j.mult(-1),0,0,U)}else if($t==="bevel"||$t==="fakeround"){const Kt=-Math.sqrt(Et*Et-1),Ft=kt?Kt:0,ce=kt?0:Kt;if(W&&this.addCurrentVertex(V,rt,Ft,ce,U),$t==="fakeround"){const xe=Math.round(180*Ut/Math.PI/20);for(let ye=1;ye<xe;ye++){let pe=ye/xe;if(pe!==.5){const ji=pe-.5;pe+=pe*ji*(pe-1)*((1.0904+H*(H*(3.55645-1.43519*H)-3.2452))*ji*ji+(.848013+H*(.215638*H-1.06021)))}const ei=_t.sub(rt)._mult(pe)._add(rt)._unit()._mult(kt?-1:1);this.addHalfVertex(V,ei.x,ei.y,!1,kt,0,U)}}K&&this.addCurrentVertex(V,_t,-Ft,-ce,U)}else if($t==="butt")this.addCurrentVertex(V,j,0,0,U);else if($t==="square"){const Kt=W?1:-1;this.addCurrentVertex(V,j,Kt,Kt,U)}else $t==="round"&&(W&&(this.addCurrentVertex(V,rt,0,0,U),this.addCurrentVertex(V,rt,1,1,U,!0)),K&&(this.addCurrentVertex(V,_t,-1,-1,U,!0),this.addCurrentVertex(V,_t,0,0,U)));if(Rt&&lt<C-1){const Kt=V.dist(K);if(Kt>2*N){const Ft=V.add(K.sub(V)._mult(N/Kt)._round());this.updateDistance(V,Ft),this.addCurrentVertex(Ft,_t,0,0,U),V=Ft}}}}addCurrentVertex(e,s,h,f,y,v=!1){const w=s.y*f-s.x,S=-s.y-s.x*f;this.addHalfVertex(e,s.x+s.y*h,s.y-s.x*h,v,!1,h,y),this.addHalfVertex(e,w,S,v,!0,-f,y),this.distance>bg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,s,h,f,y,v))}addHalfVertex({x:e,y:s},h,f,y,v,w,S){const E=.5*(this.lineClips?this.scaledDistance*(bg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(y?1:0),(s<<1)+(v?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(w===0?0:w<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,C,this.e2),S.primitiveLength++),v?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}let wg,Mg;ne("LineBucket",Gf,{omit:["layers","patternFeatures"]});var Sg={get paint(){return Mg=Mg||new Ar({"line-opacity":new we(pt.paint_line["line-opacity"]),"line-color":new we(pt.paint_line["line-color"]),"line-translate":new ue(pt.paint_line["line-translate"]),"line-translate-anchor":new ue(pt.paint_line["line-translate-anchor"]),"line-width":new we(pt.paint_line["line-width"]),"line-gap-width":new we(pt.paint_line["line-gap-width"]),"line-offset":new we(pt.paint_line["line-offset"]),"line-blur":new we(pt.paint_line["line-blur"]),"line-dasharray":new Bh(pt.paint_line["line-dasharray"]),"line-pattern":new al(pt.paint_line["line-pattern"]),"line-gradient":new io(pt.paint_line["line-gradient"])})},get layout(){return wg=wg||new Ar({"line-cap":new ue(pt.layout_line["line-cap"]),"line-join":new we(pt.layout_line["line-join"]),"line-miter-limit":new ue(pt.layout_line["line-miter-limit"]),"line-round-limit":new ue(pt.layout_line["line-round-limit"]),"line-sort-key":new we(pt.layout_line["line-sort-key"])})}};class cv extends we{possiblyEvaluate(e,s){return s=new Ci(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(e,s)}evaluate(e,s,h,f){return s=ze({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(e,s,h,f)}}let Vu;class uv extends dr{constructor(e){super(e,Sg),this.gradientVersion=0,Vu||(Vu=new cv(Sg.paint.properties["line-width"].specification),Vu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof $n,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,s){super.recalculate(e,s),this.paint._values["line-floorwidth"]=Vu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Gf(e)}queryRadius(e){const s=e,h=Tg(Zh("line-width",this,s),Zh("line-gap-width",this,s)),f=Zh("line-offset",this,s);return h/2+Math.abs(f)+Fu(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:h,geometry:f,transform:y,pixelsToTileUnits:v}){const w=Bu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-y.bearingInRadians,v),S=v/2*Tg(this.paint.get("line-width").evaluate(s,h),this.paint.get("line-gap-width").evaluate(s,h)),E=this.paint.get("line-offset").evaluate(s,h);return E&&(f=function(C,k){const N=[];for(let U=0;U<C.length;U++){const V=C[U],W=[];for(let K=0;K<V.length;K++){const rt=V[K-1],_t=V[K],lt=V[K+1],j=K===0?new $(0,0):_t.sub(rt)._unit()._perp(),H=K===V.length-1?new $(0,0):lt.sub(_t)._unit()._perp(),ct=j._add(H)._unit(),Et=ct.x*H.x+ct.y*H.y;Et!==0&&ct._mult(1/Et),W.push(ct._mult(k)._add(_t))}N.push(W)}return N}(f,E*v)),function(C,k,N){for(let U=0;U<k.length;U++){const V=k[U];if(C.length>=3){for(let W=0;W<V.length;W++)if(cl(C,V[W]))return!0}if(S1(C,V,N))return!0}return!1}(w,f,S)}isTileClipped(){return!0}}function Tg(n,e){return e>0?e+2*n:n}const dv=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fv=Gi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pv=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Pg=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mv=Gi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function gv(n,e,s){return n.sections.forEach(h=>{h.text=function(f,y,v){const w=y.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?f=f.toLocaleUpperCase():w==="lowercase"&&(f=f.toLocaleLowerCase()),Qs.applyArabicShaping&&(f=Qs.applyArabicShaping(f)),f}(h.text,e,s)}),n}Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const rc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Eg,jf,Ig,or=24,Uf={};function _v(){return Eg||(Eg=1,Uf.read=function(n,e,s,h,f){var y,v,w=8*f-h-1,S=(1<<w)-1,E=S>>1,C=-7,k=s?f-1:0,N=s?-1:1,U=n[e+k];for(k+=N,y=U&(1<<-C)-1,U>>=-C,C+=w;C>0;y=256*y+n[e+k],k+=N,C-=8);for(v=y&(1<<-C)-1,y>>=-C,C+=h;C>0;v=256*v+n[e+k],k+=N,C-=8);if(y===0)y=1-E;else{if(y===S)return v?NaN:1/0*(U?-1:1);v+=Math.pow(2,h),y-=E}return(U?-1:1)*v*Math.pow(2,y-h)},Uf.write=function(n,e,s,h,f,y){var v,w,S,E=8*y-f-1,C=(1<<E)-1,k=C>>1,N=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=h?0:y-1,V=h?1:-1,W=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,v=C):(v=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-v))<1&&(v--,S*=2),(e+=v+k>=1?N/S:N*Math.pow(2,1-k))*S>=2&&(v++,S/=2),v+k>=C?(w=0,v=C):v+k>=1?(w=(e*S-1)*Math.pow(2,f),v+=k):(w=e*Math.pow(2,k-1)*Math.pow(2,f),v=0));f>=8;n[s+U]=255&w,U+=V,w/=256,f-=8);for(v=v<<f|w,E+=f;E>0;n[s+U]=255&v,U+=V,v/=256,E-=8);n[s+U-V]|=128*W}),Uf}function Cg(){if(Ig)return jf;Ig=1,jf=e;var n=_v();function e(j){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(j)?j:new Uint8Array(j||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var s=4294967296,h=1/s,f=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function y(j){return j.type===e.Bytes?j.readVarint()+j.pos:j.pos+1}function v(j,H,ct){return ct?4294967296*H+(j>>>0):4294967296*(H>>>0)+(j>>>0)}function w(j,H,ct){var Et=H<=16383?1:H<=2097151?2:H<=268435455?3:Math.floor(Math.log(H)/(7*Math.LN2));ct.realloc(Et);for(var Ut=ct.pos-1;Ut>=j;Ut--)ct.buf[Ut+Et]=ct.buf[Ut]}function S(j,H){for(var ct=0;ct<j.length;ct++)H.writeVarint(j[ct])}function E(j,H){for(var ct=0;ct<j.length;ct++)H.writeSVarint(j[ct])}function C(j,H){for(var ct=0;ct<j.length;ct++)H.writeFloat(j[ct])}function k(j,H){for(var ct=0;ct<j.length;ct++)H.writeDouble(j[ct])}function N(j,H){for(var ct=0;ct<j.length;ct++)H.writeBoolean(j[ct])}function U(j,H){for(var ct=0;ct<j.length;ct++)H.writeFixed32(j[ct])}function V(j,H){for(var ct=0;ct<j.length;ct++)H.writeSFixed32(j[ct])}function W(j,H){for(var ct=0;ct<j.length;ct++)H.writeFixed64(j[ct])}function K(j,H){for(var ct=0;ct<j.length;ct++)H.writeSFixed64(j[ct])}function rt(j,H){return(j[H]|j[H+1]<<8|j[H+2]<<16)+16777216*j[H+3]}function _t(j,H,ct){j[ct]=H,j[ct+1]=H>>>8,j[ct+2]=H>>>16,j[ct+3]=H>>>24}function lt(j,H){return(j[H]|j[H+1]<<8|j[H+2]<<16)+(j[H+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(j,H,ct){for(ct=ct||this.length;this.pos<ct;){var Et=this.readVarint(),Ut=Et>>3,Rt=this.pos;this.type=7&Et,j(Ut,H,this),this.pos===Rt&&this.skip(Et)}return H},readMessage:function(j,H){return this.readFields(j,H,this.readVarint()+this.pos)},readFixed32:function(){var j=rt(this.buf,this.pos);return this.pos+=4,j},readSFixed32:function(){var j=lt(this.buf,this.pos);return this.pos+=4,j},readFixed64:function(){var j=rt(this.buf,this.pos)+rt(this.buf,this.pos+4)*s;return this.pos+=8,j},readSFixed64:function(){var j=rt(this.buf,this.pos)+lt(this.buf,this.pos+4)*s;return this.pos+=8,j},readFloat:function(){var j=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,j},readDouble:function(){var j=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,j},readVarint:function(j){var H,ct,Et=this.buf;return H=127&(ct=Et[this.pos++]),ct<128?H:(H|=(127&(ct=Et[this.pos++]))<<7,ct<128?H:(H|=(127&(ct=Et[this.pos++]))<<14,ct<128?H:(H|=(127&(ct=Et[this.pos++]))<<21,ct<128?H:function(Ut,Rt,kt){var Zt,$t,Kt=kt.buf;if(Zt=(112&($t=Kt[kt.pos++]))>>4,$t<128||(Zt|=(127&($t=Kt[kt.pos++]))<<3,$t<128)||(Zt|=(127&($t=Kt[kt.pos++]))<<10,$t<128)||(Zt|=(127&($t=Kt[kt.pos++]))<<17,$t<128)||(Zt|=(127&($t=Kt[kt.pos++]))<<24,$t<128)||(Zt|=(1&($t=Kt[kt.pos++]))<<31,$t<128))return v(Ut,Zt,Rt);throw new Error("Expected varint not more than 10 bytes")}(H|=(15&(ct=Et[this.pos]))<<28,j,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var j=this.readVarint();return j%2==1?(j+1)/-2:j/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var j=this.readVarint()+this.pos,H=this.pos;return this.pos=j,j-H>=12&&f?function(ct,Et,Ut){return f.decode(ct.subarray(Et,Ut))}(this.buf,H,j):function(ct,Et,Ut){for(var Rt="",kt=Et;kt<Ut;){var Zt,$t,Kt,Ft=ct[kt],ce=null,xe=Ft>239?4:Ft>223?3:Ft>191?2:1;if(kt+xe>Ut)break;xe===1?Ft<128&&(ce=Ft):xe===2?(192&(Zt=ct[kt+1]))==128&&(ce=(31&Ft)<<6|63&Zt)<=127&&(ce=null):xe===3?($t=ct[kt+2],(192&(Zt=ct[kt+1]))==128&&(192&$t)==128&&((ce=(15&Ft)<<12|(63&Zt)<<6|63&$t)<=2047||ce>=55296&&ce<=57343)&&(ce=null)):xe===4&&($t=ct[kt+2],Kt=ct[kt+3],(192&(Zt=ct[kt+1]))==128&&(192&$t)==128&&(192&Kt)==128&&((ce=(15&Ft)<<18|(63&Zt)<<12|(63&$t)<<6|63&Kt)<=65535||ce>=1114112)&&(ce=null)),ce===null?(ce=65533,xe=1):ce>65535&&(ce-=65536,Rt+=String.fromCharCode(ce>>>10&1023|55296),ce=56320|1023&ce),Rt+=String.fromCharCode(ce),kt+=xe}return Rt}(this.buf,H,j)},readBytes:function(){var j=this.readVarint()+this.pos,H=this.buf.subarray(this.pos,j);return this.pos=j,H},readPackedVarint:function(j,H){if(this.type!==e.Bytes)return j.push(this.readVarint(H));var ct=y(this);for(j=j||[];this.pos<ct;)j.push(this.readVarint(H));return j},readPackedSVarint:function(j){if(this.type!==e.Bytes)return j.push(this.readSVarint());var H=y(this);for(j=j||[];this.pos<H;)j.push(this.readSVarint());return j},readPackedBoolean:function(j){if(this.type!==e.Bytes)return j.push(this.readBoolean());var H=y(this);for(j=j||[];this.pos<H;)j.push(this.readBoolean());return j},readPackedFloat:function(j){if(this.type!==e.Bytes)return j.push(this.readFloat());var H=y(this);for(j=j||[];this.pos<H;)j.push(this.readFloat());return j},readPackedDouble:function(j){if(this.type!==e.Bytes)return j.push(this.readDouble());var H=y(this);for(j=j||[];this.pos<H;)j.push(this.readDouble());return j},readPackedFixed32:function(j){if(this.type!==e.Bytes)return j.push(this.readFixed32());var H=y(this);for(j=j||[];this.pos<H;)j.push(this.readFixed32());return j},readPackedSFixed32:function(j){if(this.type!==e.Bytes)return j.push(this.readSFixed32());var H=y(this);for(j=j||[];this.pos<H;)j.push(this.readSFixed32());return j},readPackedFixed64:function(j){if(this.type!==e.Bytes)return j.push(this.readFixed64());var H=y(this);for(j=j||[];this.pos<H;)j.push(this.readFixed64());return j},readPackedSFixed64:function(j){if(this.type!==e.Bytes)return j.push(this.readSFixed64());var H=y(this);for(j=j||[];this.pos<H;)j.push(this.readSFixed64());return j},skip:function(j){var H=7&j;if(H===e.Varint)for(;this.buf[this.pos++]>127;);else if(H===e.Bytes)this.pos=this.readVarint()+this.pos;else if(H===e.Fixed32)this.pos+=4;else{if(H!==e.Fixed64)throw new Error("Unimplemented type: "+H);this.pos+=8}},writeTag:function(j,H){this.writeVarint(j<<3|H)},realloc:function(j){for(var H=this.length||16;H<this.pos+j;)H*=2;if(H!==this.length){var ct=new Uint8Array(H);ct.set(this.buf),this.buf=ct,this.length=H}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(j){this.realloc(4),_t(this.buf,j,this.pos),this.pos+=4},writeSFixed32:function(j){this.realloc(4),_t(this.buf,j,this.pos),this.pos+=4},writeFixed64:function(j){this.realloc(8),_t(this.buf,-1&j,this.pos),_t(this.buf,Math.floor(j*h),this.pos+4),this.pos+=8},writeSFixed64:function(j){this.realloc(8),_t(this.buf,-1&j,this.pos),_t(this.buf,Math.floor(j*h),this.pos+4),this.pos+=8},writeVarint:function(j){(j=+j||0)>268435455||j<0?function(H,ct){var Et,Ut;if(H>=0?(Et=H%4294967296|0,Ut=H/4294967296|0):(Ut=~(-H/4294967296),4294967295^(Et=~(-H%4294967296))?Et=Et+1|0:(Et=0,Ut=Ut+1|0)),H>=18446744073709552e3||H<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ct.realloc(10),function(Rt,kt,Zt){Zt.buf[Zt.pos++]=127&Rt|128,Rt>>>=7,Zt.buf[Zt.pos++]=127&Rt|128,Rt>>>=7,Zt.buf[Zt.pos++]=127&Rt|128,Rt>>>=7,Zt.buf[Zt.pos++]=127&Rt|128,Zt.buf[Zt.pos]=127&(Rt>>>=7)}(Et,0,ct),function(Rt,kt){var Zt=(7&Rt)<<4;kt.buf[kt.pos++]|=Zt|((Rt>>>=3)?128:0),Rt&&(kt.buf[kt.pos++]=127&Rt|((Rt>>>=7)?128:0),Rt&&(kt.buf[kt.pos++]=127&Rt|((Rt>>>=7)?128:0),Rt&&(kt.buf[kt.pos++]=127&Rt|((Rt>>>=7)?128:0),Rt&&(kt.buf[kt.pos++]=127&Rt|((Rt>>>=7)?128:0),Rt&&(kt.buf[kt.pos++]=127&Rt)))))}(Ut,ct)}(j,this):(this.realloc(4),this.buf[this.pos++]=127&j|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=j>>>7&127))))},writeSVarint:function(j){this.writeVarint(j<0?2*-j-1:2*j)},writeBoolean:function(j){this.writeVarint(!!j)},writeString:function(j){j=String(j),this.realloc(4*j.length),this.pos++;var H=this.pos;this.pos=function(Et,Ut,Rt){for(var kt,Zt,$t=0;$t<Ut.length;$t++){if((kt=Ut.charCodeAt($t))>55295&&kt<57344){if(!Zt){kt>56319||$t+1===Ut.length?(Et[Rt++]=239,Et[Rt++]=191,Et[Rt++]=189):Zt=kt;continue}if(kt<56320){Et[Rt++]=239,Et[Rt++]=191,Et[Rt++]=189,Zt=kt;continue}kt=Zt-55296<<10|kt-56320|65536,Zt=null}else Zt&&(Et[Rt++]=239,Et[Rt++]=191,Et[Rt++]=189,Zt=null);kt<128?Et[Rt++]=kt:(kt<2048?Et[Rt++]=kt>>6|192:(kt<65536?Et[Rt++]=kt>>12|224:(Et[Rt++]=kt>>18|240,Et[Rt++]=kt>>12&63|128),Et[Rt++]=kt>>6&63|128),Et[Rt++]=63&kt|128)}return Rt}(this.buf,j,this.pos);var ct=this.pos-H;ct>=128&&w(H,ct,this),this.pos=H-1,this.writeVarint(ct),this.pos+=ct},writeFloat:function(j){this.realloc(4),n.write(this.buf,j,this.pos,!0,23,4),this.pos+=4},writeDouble:function(j){this.realloc(8),n.write(this.buf,j,this.pos,!0,52,8),this.pos+=8},writeBytes:function(j){var H=j.length;this.writeVarint(H),this.realloc(H);for(var ct=0;ct<H;ct++)this.buf[this.pos++]=j[ct]},writeRawMessage:function(j,H){this.pos++;var ct=this.pos;j(H,this);var Et=this.pos-ct;Et>=128&&w(ct,Et,this),this.pos=ct-1,this.writeVarint(Et),this.pos+=Et},writeMessage:function(j,H,ct){this.writeTag(j,e.Bytes),this.writeRawMessage(H,ct)},writePackedVarint:function(j,H){H.length&&this.writeMessage(j,S,H)},writePackedSVarint:function(j,H){H.length&&this.writeMessage(j,E,H)},writePackedBoolean:function(j,H){H.length&&this.writeMessage(j,N,H)},writePackedFloat:function(j,H){H.length&&this.writeMessage(j,C,H)},writePackedDouble:function(j,H){H.length&&this.writeMessage(j,k,H)},writePackedFixed32:function(j,H){H.length&&this.writeMessage(j,U,H)},writePackedSFixed32:function(j,H){H.length&&this.writeMessage(j,V,H)},writePackedFixed64:function(j,H){H.length&&this.writeMessage(j,W,H)},writePackedSFixed64:function(j,H){H.length&&this.writeMessage(j,K,H)},writeBytesField:function(j,H){this.writeTag(j,e.Bytes),this.writeBytes(H)},writeFixed32Field:function(j,H){this.writeTag(j,e.Fixed32),this.writeFixed32(H)},writeSFixed32Field:function(j,H){this.writeTag(j,e.Fixed32),this.writeSFixed32(H)},writeFixed64Field:function(j,H){this.writeTag(j,e.Fixed64),this.writeFixed64(H)},writeSFixed64Field:function(j,H){this.writeTag(j,e.Fixed64),this.writeSFixed64(H)},writeVarintField:function(j,H){this.writeTag(j,e.Varint),this.writeVarint(H)},writeSVarintField:function(j,H){this.writeTag(j,e.Varint),this.writeSVarint(H)},writeStringField:function(j,H){this.writeTag(j,e.Bytes),this.writeString(H)},writeFloatField:function(j,H){this.writeTag(j,e.Fixed32),this.writeFloat(H)},writeDoubleField:function(j,H){this.writeTag(j,e.Fixed64),this.writeDouble(H)},writeBooleanField:function(j,H){this.writeVarintField(j,!!H)}},jf}var da,Vf=P(Cg());function yv(n,e,s){n===1&&s.readMessage(vv,e)}function vv(n,e,s){if(n===3){const{id:h,bitmap:f,width:y,height:v,left:w,top:S,advance:E}=s.readMessage(xv,{});e.push({id:h,bitmap:new Wh({width:y+6,height:v+6},f),metrics:{width:y,height:v,left:w,top:S,advance:E}})}}function xv(n,e,s){n===1?e.id=s.readVarint():n===2?e.bitmap=s.readBytes():n===3?e.width=s.readVarint():n===4?e.height=s.readVarint():n===5?e.left=s.readSVarint():n===6?e.top=s.readSVarint():n===7&&(e.advance=s.readVarint())}function Ag(n){let e=0,s=0;for(const v of n)e+=v.w*v.h,s=Math.max(s,v.w);n.sort((v,w)=>w.h-v.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let f=0,y=0;for(const v of n)for(let w=h.length-1;w>=0;w--){const S=h[w];if(!(v.w>S.w||v.h>S.h)){if(v.x=S.x,v.y=S.y,y=Math.max(y,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===S.w&&v.h===S.h){const E=h.pop();w<h.length&&(h[w]=E)}else v.h===S.h?(S.x+=v.w,S.w-=v.w):v.w===S.w?(S.y+=v.h,S.h-=v.h):(h.push({x:S.x+v.w,y:S.y,w:S.w-v.w,h:v.h}),S.y+=v.h,S.h-=v.h);break}}return{w:f,h:y,fill:e/(f*y)||0}}class $f{constructor(e,{pixelRatio:s,version:h,stretchX:f,stretchY:y,content:v,textFitWidth:w,textFitHeight:S}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=f,this.stretchY=y,this.content=v,this.version=h,this.textFitWidth=w,this.textFitHeight=S}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Rg{constructor(e,s){const h={},f={};this.haveRenderCallbacks=[];const y=[];this.addImages(e,h,y),this.addImages(s,f,y);const{w:v,h:w}=Ag(y),S=new Wr({width:v||1,height:w||1});for(const E in e){const C=e[E],k=h[E].paddedRect;Wr.copy(C.data,S,{x:0,y:0},{x:k.x+1,y:k.y+1},C.data)}for(const E in s){const C=s[E],k=f[E].paddedRect,N=k.x+1,U=k.y+1,V=C.data.width,W=C.data.height;Wr.copy(C.data,S,{x:0,y:0},{x:N,y:U},C.data),Wr.copy(C.data,S,{x:0,y:W-1},{x:N,y:U-1},{width:V,height:1}),Wr.copy(C.data,S,{x:0,y:0},{x:N,y:U+W},{width:V,height:1}),Wr.copy(C.data,S,{x:V-1,y:0},{x:N-1,y:U},{width:1,height:W}),Wr.copy(C.data,S,{x:0,y:0},{x:N+V,y:U},{width:1,height:W})}this.image=S,this.iconPositions=h,this.patternPositions=f}addImages(e,s,h){for(const f in e){const y=e[f],v={x:0,y:0,w:y.data.width+2,h:y.data.height+2};h.push(v),s[f]=new $f(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in e.updatedImages)this.patchUpdatedImage(this.iconPositions[h],e.getImage(h),s),this.patchUpdatedImage(this.patternPositions[h],e.getImage(h),s)}patchUpdatedImage(e,s,h){if(!e||!s||e.version===s.version)return;e.version=s.version;const[f,y]=e.tl;h.update(s.data,void 0,{x:f,y})}}ne("ImagePosition",$f),ne("ImageAtlas",Rg),m.an=void 0,(da=m.an||(m.an={}))[da.none=0]="none",da[da.horizontal=1]="horizontal",da[da.vertical=2]="vertical",da[da.horizontalOnly=3]="horizontalOnly";class sc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(e,s,h){const f=new sc;return f.scale=e||1,f.fontStack=s,f.verticalAlign=h||"bottom",f}static forImage(e,s){const h=new sc;return h.imageName=e,h.verticalAlign=s||"bottom",h}}class pl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const h=new pl;for(let f=0;f<e.sections.length;f++){const y=e.sections[f];y.image?h.addImageSection(y):h.addTextSection(y,s)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let s="";for(let h=0;h<e.length;h++){const f=e.charCodeAt(h+1)||null,y=e.charCodeAt(h-1)||null;s+=f&&Lh(f)&&!rc[e[h+1]]||y&&Lh(y)&&!rc[e[h-1]]||!rc[e[h]]?e[h]:rc[e[h]]}return s}(this.text)}trim(){let e=0;for(let h=0;h<this.text.length&&qu[this.text.charCodeAt(h)];h++)e++;let s=this.text.length;for(let h=this.text.length-1;h>=0&&h>=e&&qu[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const h=new pl;return h.text=this.text.substring(e,s),h.sectionIndex=this.sectionIndex.slice(e,s),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}getMaxImageSize(e){let s=0,h=0;for(let f=0;f<this.length();f++){const y=this.getSection(f);if(y.imageName){const v=e[y.imageName];if(!v)continue;const w=v.displaySize;s=Math.max(s,w[0]),h=Math.max(h,w[1])}}return{maxImageWidth:s,maxImageHeight:h}}addTextSection(e,s){this.text+=e.text,this.sections.push(sc.forText(e.scale,e.fontStack||s,e.verticalAlign));const h=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(h)}addImageSection(e){const s=e.image?e.image.name:"";if(s.length===0)return void De("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(sc.forImage(s,e.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):De("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $u(n,e,s,h,f,y,v,w,S,E,C,k,N,U,V){const W=pl.fromFeature(n,f);let K;k===m.an.vertical&&W.verticalizePunctuation();const{processBidirectionalText:rt,processStyledBidirectionalText:_t}=Qs;if(rt&&W.sections.length===1){K=[];const H=rt(W.toString(),qf(W,E,y,e,h,U));for(const ct of H){const Et=new pl;Et.text=ct,Et.sections=W.sections;for(let Ut=0;Ut<ct.length;Ut++)Et.sectionIndex.push(0);K.push(Et)}}else if(_t){K=[];const H=_t(W.text,W.sectionIndex,qf(W,E,y,e,h,U));for(const ct of H){const Et=new pl;Et.text=ct[0],Et.sectionIndex=ct[1],Et.sections=W.sections,K.push(Et)}}else K=function(H,ct){const Et=[],Ut=H.text;let Rt=0;for(const kt of ct)Et.push(H.substring(Rt,kt)),Rt=kt;return Rt<Ut.length&&Et.push(H.substring(Rt,Ut.length)),Et}(W,qf(W,E,y,e,h,U));const lt=[],j={positionedLines:lt,text:W.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(H,ct,Et,Ut,Rt,kt,Zt,$t,Kt,Ft,ce,xe){let ye=0,pe=0,ei=0,ji=0;const tr=$t==="right"?1:$t==="left"?0:.5,Tr=or/xe;let ms=0;for(const Bi of Rt){Bi.trim();const lr=Bi.getMaxScale(),_r={positionedGlyphs:[],lineOffset:0};H.positionedLines[ms]=_r;const yr=_r.positionedGlyphs;let Vr=0;if(!Bi.length()){pe+=kt,++ms;continue}const gs=Sv(Ut,Bi,Tr);for(let Hr=0;Hr<Bi.length();Hr++){const er=Bi.getSection(Hr),cr=Bi.getSectionIndex(Hr),ur=Bi.getCharCode(Hr),Ji=Tv(Kt,ce,ur);let Ei;if(er.imageName){if(H.iconsInText=!0,er.scale=er.scale*Tr,Ei=Ev(er,Ji,lr,gs,Ut),!Ei)continue;Vr=Math.max(Vr,Ei.imageOffset)}else if(Ei=Pv(er,ur,Ji,gs,ct,Et),!Ei)continue;const{rect:js,metrics:yl,baselineOffset:Us}=Ei;yr.push({glyph:ur,imageName:er.imageName,x:ye,y:pe+Us+-17,vertical:Ji,scale:er.scale,fontStack:er.fontStack,sectionIndex:cr,metrics:yl,rect:js}),Ji?(H.verticalizable=!0,ye+=(er.imageName?yl.advance:or)*er.scale+Ft):ye+=yl.advance*er.scale+Ft}yr.length!==0&&(ei=Math.max(ye-Ft,ei),Iv(yr,0,yr.length-1,tr)),ye=0,_r.lineOffset=Math.max(Vr,(lr-1)*or);const hr=kt*lr+Vr;pe+=hr,ji=Math.max(hr,ji),++ms}const{horizontalAlign:Xr,verticalAlign:gr}=Zf(Zt);(function(Bi,lr,_r,yr,Vr,gs,hr,Hr,er){const cr=(lr-_r)*Vr;let ur=0;ur=gs!==hr?-Hr*yr- -17:-yr*er*hr+.5*hr;for(const Ji of Bi)for(const Ei of Ji.positionedGlyphs)Ei.x+=cr,Ei.y+=ur})(H.positionedLines,tr,Xr,gr,ei,ji,kt,pe,Rt.length),H.top+=-gr*pe,H.bottom=H.top+pe,H.left+=-Xr*ei,H.right=H.left+ei}(j,e,s,h,K,v,w,S,k,E,N,V),!function(H){for(const ct of H)if(ct.positionedGlyphs.length!==0)return!1;return!0}(lt)&&j}const qu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},wv={40:!0};function Dg(n,e,s,h,f,y){if(e.imageName){const v=h[e.imageName];return v?v.displaySize[0]*e.scale*or/y+f:0}{const v=s[e.fontStack],w=v&&v[n];return w?w.metrics.advance*e.scale+f:0}}function zg(n,e,s,h){const f=Math.pow(n-e,2);return h?n<e?f/2:2*f:f+Math.abs(s)*s}function Mv(n,e,s){let h=0;return n===10&&(h-=1e4),s&&(h+=150),n!==40&&n!==65288||(h+=50),e!==41&&e!==65289||(h+=50),h}function kg(n,e,s,h,f,y){let v=null,w=zg(e,s,f,y);for(const S of h){const E=zg(e-S.x,s,f,y)+S.badness;E<=w&&(v=S,w=E)}return{index:n,x:e,priorBreak:v,badness:w}}function Lg(n){return n?Lg(n.priorBreak).concat(n.index):[]}function qf(n,e,s,h,f,y){if(!n)return[];const v=[],w=function(k,N,U,V,W,K){let rt=0;for(let _t=0;_t<k.length();_t++){const lt=k.getSection(_t);rt+=Dg(k.getCharCode(_t),lt,V,W,N,K)}return rt/Math.max(1,Math.ceil(rt/U))}(n,e,s,h,f,y),S=n.text.indexOf("")>=0;let E=0;for(let k=0;k<n.length();k++){const N=n.getSection(k),U=n.getCharCode(k);if(qu[U]||(E+=Dg(U,N,h,f,e,y)),k<n.length()-1){const V=!((C=U)<11904)&&(!!Je["CJK Compatibility Forms"](C)||!!Je["CJK Compatibility"](C)||!!Je["CJK Strokes"](C)||!!Je["CJK Symbols and Punctuation"](C)||!!Je["Enclosed CJK Letters and Months"](C)||!!Je["Halfwidth and Fullwidth Forms"](C)||!!Je["Ideographic Description Characters"](C)||!!Je["Vertical Forms"](C)||kh.test(String.fromCodePoint(C)));(bv[U]||V||N.imageName||k!==n.length()-2&&wv[n.getCharCode(k+1)])&&v.push(kg(k+1,E,w,v,Mv(U,n.getCharCode(k+1),V&&S),!1))}}var C;return Lg(kg(n.length(),E,w,v,0,!0))}function Zf(n){let e=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function Sv(n,e,s){const h=e.getMaxScale()*or,{maxImageWidth:f,maxImageHeight:y}=e.getMaxImageSize(n),v=Math.max(h,y*s);return{verticalLineContentWidth:Math.max(h,f*s),horizontalLineContentHeight:v}}function Og(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function Tv(n,e,s){return!(n===m.an.horizontal||!e&&!rl(s)||e&&(qu[s]||(h=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(h)))));var h}function Pv(n,e,s,h,f,y){const v=y[n.fontStack],w=function(E,C,k,N){if(E&&E.rect)return E;const U=C[k.fontStack],V=U&&U[N];return V?{rect:null,metrics:V.metrics}:null}(v&&v[e],f,n,e);if(w===null)return null;let S;if(s)S=h.verticalLineContentWidth-n.scale*or;else{const E=Og(n.verticalAlign);S=(h.horizontalLineContentHeight-n.scale*or)*E}return{rect:w.rect,metrics:w.metrics,baselineOffset:S}}function Ev(n,e,s,h,f){const y=f[n.imageName];if(!y)return null;const v=y.paddedRect,w=y.displaySize,S={width:w[0],height:w[1],left:1,top:-3,advance:e?w[1]:w[0]};let E;if(e)E=h.verticalLineContentWidth-w[1]*n.scale;else{const C=Og(n.verticalAlign);E=(h.horizontalLineContentHeight-w[1]*n.scale)*C}return{rect:v,metrics:S,baselineOffset:E,imageOffset:(e?w[0]:w[1])*n.scale-or*s}}function Iv(n,e,s,h){if(h===0)return;const f=n[s],y=(n[s].x+f.metrics.advance*f.scale)*h;for(let v=e;v<=s;v++)n[v].x-=y}function Cv(n,e,s){const{horizontalAlign:h,verticalAlign:f}=Zf(s),y=e[0]-n.displaySize[0]*h,v=e[1]-n.displaySize[1]*f;return{image:n,top:v,bottom:v+n.displaySize[1],left:y,right:y+n.displaySize[0]}}function Fg(n){var e,s;let h=n.left,f=n.top,y=n.right-h,v=n.bottom-f;const w=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",S=(s=n.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",E=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(S==="proportional"){if(w==="stretchOnly"&&y/v<E||w==="proportional"){const C=Math.ceil(v*E);h*=C/y,y=C}}else if(w==="proportional"&&S==="stretchOnly"&&E!==0&&y/v>E){const C=Math.ceil(y/E);f*=C/v,v=C}return{x1:h,y1:f,x2:h+y,y2:f+v}}function Bg(n,e,s,h,f,y){const v=n.image;let w;if(v.content){const K=v.content,rt=v.pixelRatio||1;w=[K[0]/rt,K[1]/rt,v.displaySize[0]-K[2]/rt,v.displaySize[1]-K[3]/rt]}const S=e.left*y,E=e.right*y;let C,k,N,U;s==="width"||s==="both"?(U=f[0]+S-h[3],k=f[0]+E+h[1]):(U=f[0]+(S+E-v.displaySize[0])/2,k=U+v.displaySize[0]);const V=e.top*y,W=e.bottom*y;return s==="height"||s==="both"?(C=f[1]+V-h[0],N=f[1]+W+h[2]):(C=f[1]+(V+W-v.displaySize[1])/2,N=C+v.displaySize[1]),{image:v,top:C,right:k,bottom:N,left:U,collisionPadding:w}}const Dn=128,fa=32640;function Ng(n,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Ci(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:f}=s;let y=0;for(;y<h.length&&h[y]<=n;)y++;y=Math.max(0,y-1);let v=y;for(;v<h.length&&h[v]<n+1;)v++;v=Math.min(h.length-1,v);const w=h[y],S=h[v];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:S,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:S,minSize:s.evaluate(new Ci(w)),maxSize:s.evaluate(new Ci(S)),interpolationType:f}}}function Wf(n,e,s){let h="never";const f=n.get(e);return f?h=f:n.get(s)&&(h="always"),h}const Av=tc.VectorTileFeature.types,Rv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zu(n,e,s,h,f,y,v,w,S,E,C,k,N){const U=w?Math.min(fa,Math.round(w[0])):0,V=w?Math.min(fa,Math.round(w[1])):0;n.emplaceBack(e,s,Math.round(32*h),Math.round(32*f),y,v,(U<<1)+(S?1:0),V,16*E,16*C,256*k,256*N)}function Xf(n,e,s){n.emplaceBack(e.x,e.y,s),n.emplaceBack(e.x,e.y,s),n.emplaceBack(e.x,e.y,s),n.emplaceBack(e.x,e.y,s)}function Dv(n){for(const e of n.sections)if(Oh(e.text))return!0;return!1}class Hf{constructor(e){this.layoutVertexArray=new Ve,this.indexArray=new yi,this.programConfigurations=e,this.segments=new ai,this.dynamicLayoutVertexArray=new di,this.opacityVertexArray=new Oi,this.hasVisibleVertices=!1,this.placedSymbolArray=new tt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,h,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,fv.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Rv,!0),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ne("SymbolBuffers",Hf);class Kf{constructor(e,s,h){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new h,this.segments=new ai,this.collisionVertexArray=new Fi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,pv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ne("CollisionBuffers",Kf);class ml{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(v=>v.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ng(this.zoom,s["text-size"]),this.iconSizeData=Ng(this.zoom,s["icon-size"]);const h=this.layers[0].layout,f=h.get("symbol-sort-key"),y=h.get("symbol-z-order");this.canOverlap=Wf(h,"text-overlap","text-allow-overlap")!=="never"||Wf(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(v=>m.an[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=e.sourceID}createArrays(){this.text=new Hf(new on(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Hf(new on(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new nt,this.lineVertexArray=new ut,this.symbolInstances=new ht,this.textAnchorOffsets=new ot}calculateGlyphDependencies(e,s,h,f,y){for(let v=0;v<e.length;v++)if(s[e.charCodeAt(v)]=!0,(h||f)&&y){const w=rc[e.charAt(v)];w&&(s[w.charCodeAt(0)]=!0)}}populate(e,s,h){const f=this.layers[0],y=f.layout,v=y.get("text-font"),w=y.get("text-field"),S=y.get("icon-image"),E=(w.value.kind!=="constant"||w.value.value instanceof wr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),C=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,k=y.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const N=s.iconDependencies,U=s.glyphDependencies,V=s.availableImages,W=new Ci(this.zoom,{globalState:this.globalState});for(const{feature:K,id:rt,index:_t,sourceLayerIndex:lt}of e){const j=f._featureFilter.needGeometry,H=ho(K,j);if(!f._featureFilter.filter(W,H,h))continue;let ct,Et;if(j||(H.geometry=lo(K)),E){const Rt=f.getValueAndResolveTokens("text-field",H,h,V),kt=wr.factory(Rt),Zt=this.hasRTLText=this.hasRTLText||Dv(kt);(!Zt||Qs.getRTLTextPluginStatus()==="unavailable"||Zt&&Qs.isParsed())&&(ct=gv(kt,f,H))}if(C){const Rt=f.getValueAndResolveTokens("icon-image",H,h,V);Et=Rt instanceof Nr?Rt:Nr.fromString(Rt)}if(!ct&&!Et)continue;const Ut=this.sortFeaturesByKey?k.evaluate(H,{},h):void 0;if(this.features.push({id:rt,text:ct,icon:Et,index:_t,sourceLayerIndex:lt,geometry:H.geometry,properties:K.properties,type:Av[K.type],sortKey:Ut}),Et&&(N[Et.name]=!0),ct){const Rt=v.evaluate(H,{},h).join(","),kt=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.an.vertical)>=0;for(const Zt of ct.sections)if(Zt.image)N[Zt.image.name]=!0;else{const $t=zh(ct.toString()),Kt=Zt.fontStack||Rt,Ft=U[Kt]=U[Kt]||{};this.calculateGlyphDependencies(Zt.text,Ft,kt,this.allowVerticalPlacement,$t)}}}y.get("symbol-placement")==="line"&&(this.features=function(K){const rt={},_t={},lt=[];let j=0;function H(Rt){lt.push(K[Rt]),j++}function ct(Rt,kt,Zt){const $t=_t[Rt];return delete _t[Rt],_t[kt]=$t,lt[$t].geometry[0].pop(),lt[$t].geometry[0]=lt[$t].geometry[0].concat(Zt[0]),$t}function Et(Rt,kt,Zt){const $t=rt[kt];return delete rt[kt],rt[Rt]=$t,lt[$t].geometry[0].shift(),lt[$t].geometry[0]=Zt[0].concat(lt[$t].geometry[0]),$t}function Ut(Rt,kt,Zt){const $t=Zt?kt[0][kt[0].length-1]:kt[0][0];return`${Rt}:${$t.x}:${$t.y}`}for(let Rt=0;Rt<K.length;Rt++){const kt=K[Rt],Zt=kt.geometry,$t=kt.text?kt.text.toString():null;if(!$t){H(Rt);continue}const Kt=Ut($t,Zt),Ft=Ut($t,Zt,!0);if(Kt in _t&&Ft in rt&&_t[Kt]!==rt[Ft]){const ce=Et(Kt,Ft,Zt),xe=ct(Kt,Ft,lt[ce].geometry);delete rt[Kt],delete _t[Ft],_t[Ut($t,lt[xe].geometry,!0)]=xe,lt[ce].geometry=null}else Kt in _t?ct(Kt,Ft,Zt):Ft in rt?Et(Kt,Ft,Zt):(H(Rt),rt[Kt]=j-1,_t[Ft]=j-1)}return lt.filter(Rt=>Rt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,rt)=>K.sortKey-rt.sortKey)}update(e,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,h),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const h=this.lineVertexArray.length;if(e.segment!==void 0){let f=e.dist(s[e.segment+1]),y=e.dist(s[e.segment]);const v={};for(let w=e.segment+1;w<s.length;w++)v[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:f},w<s.length-1&&(f+=s[w+1].dist(s[w]));for(let w=e.segment||0;w>=0;w--)v[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:y},w>0&&(y+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const S=v[w];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(e,s,h,f,y,v,w,S,E,C,k,N){const U=e.indexArray,V=e.layoutVertexArray,W=e.segments.prepareSegment(4*s.length,V,U,this.canOverlap?v.sortKey:void 0),K=this.glyphOffsetArray.length,rt=W.vertexLength,_t=this.allowVerticalPlacement&&w===m.an.vertical?Math.PI/2:0,lt=v.text&&v.text.sections;for(let j=0;j<s.length;j++){const{tl:H,tr:ct,bl:Et,br:Ut,tex:Rt,pixelOffsetTL:kt,pixelOffsetBR:Zt,minFontScaleX:$t,minFontScaleY:Kt,glyphOffset:Ft,isSDF:ce,sectionIndex:xe}=s[j],ye=W.vertexLength,pe=Ft[1];Zu(V,S.x,S.y,H.x,pe+H.y,Rt.x,Rt.y,h,ce,kt.x,kt.y,$t,Kt),Zu(V,S.x,S.y,ct.x,pe+ct.y,Rt.x+Rt.w,Rt.y,h,ce,Zt.x,kt.y,$t,Kt),Zu(V,S.x,S.y,Et.x,pe+Et.y,Rt.x,Rt.y+Rt.h,h,ce,kt.x,Zt.y,$t,Kt),Zu(V,S.x,S.y,Ut.x,pe+Ut.y,Rt.x+Rt.w,Rt.y+Rt.h,h,ce,Zt.x,Zt.y,$t,Kt),Xf(e.dynamicLayoutVertexArray,S,_t),U.emplaceBack(ye,ye+2,ye+1),U.emplaceBack(ye+1,ye+2,ye+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ft[0]),j!==s.length-1&&xe===s[j+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,v,v.index,{},N,lt&&lt[xe])}e.placedSymbolArray.emplaceBack(S.x,S.y,K,this.glyphOffsetArray.length-K,rt,E,C,S.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],w,0,!1,0,k)}_addCollisionDebugVertex(e,s,h,f,y,v){return s.emplaceBack(0,0),e.emplaceBack(h.x,h.y,f,y,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(e,s,h,f,y,v,w){const S=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),E=S.vertexLength,C=y.layoutVertexArray,k=y.collisionVertexArray,N=w.anchorX,U=w.anchorY;this._addCollisionDebugVertex(C,k,v,N,U,new $(e,s)),this._addCollisionDebugVertex(C,k,v,N,U,new $(h,s)),this._addCollisionDebugVertex(C,k,v,N,U,new $(h,f)),this._addCollisionDebugVertex(C,k,v,N,U,new $(e,f)),S.vertexLength+=4;const V=y.indexArray;V.emplaceBack(E,E+1),V.emplaceBack(E+1,E+2),V.emplaceBack(E+2,E+3),V.emplaceBack(E+3,E),S.primitiveLength+=4}addDebugCollisionBoxes(e,s,h,f){for(let y=e;y<s;y++){const v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,f?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kf(mi,Pg.members,gi),this.iconCollisionBox=new Kf(mi,Pg.members,gi);for(let e=0;e<this.symbolInstances.length;e++){const s=this.symbolInstances.get(e);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(e,s,h,f,y,v,w,S,E){const C={};for(let k=s;k<h;k++){const N=e.get(k);C.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},C.textFeatureIndex=N.featureIndex;break}for(let k=f;k<y;k++){const N=e.get(k);C.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},C.verticalTextFeatureIndex=N.featureIndex;break}for(let k=v;k<w;k++){const N=e.get(k);C.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},C.iconFeatureIndex=N.featureIndex;break}for(let k=S;k<E;k++){const N=e.get(k);C.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},C.verticalIconFeatureIndex=N.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const h=e.placedSymbolArray.get(s),f=h.vertexStartIndex+4*h.numGlyphs;for(let y=h.vertexStartIndex;y<f;y+=4)e.indexArray.emplaceBack(y,y+2,y+1),e.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),h=Math.cos(e),f=[],y=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const S=this.symbolInstances.get(w);f.push(0|Math.round(s*S.anchorX+h*S.anchorY)),y.push(S.featureIndex)}return v.sort((w,S)=>f[w]-f[S]||y[S]-y[w]),v}addToSortKeyRanges(e,s){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===s?h.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const h=this.symbolInstances.get(s);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((f,y,v)=>{f>=0&&v.indexOf(f)===y&&this.addIndicesForPlacedSymbol(this.text,f)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Gg,jg;ne("SymbolBucket",ml,{omit:["layers","collisionBoxArray","features","compareText"]}),ml.MAX_GLYPHS=65535,ml.addDynamicAttributes=Xf;var Yf={get paint(){return jg=jg||new Ar({"icon-opacity":new we(pt.paint_symbol["icon-opacity"]),"icon-color":new we(pt.paint_symbol["icon-color"]),"icon-halo-color":new we(pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new we(pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new we(pt.paint_symbol["icon-halo-blur"]),"icon-translate":new ue(pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ue(pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new we(pt.paint_symbol["text-opacity"]),"text-color":new we(pt.paint_symbol["text-color"],{runtimeType:rr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new we(pt.paint_symbol["text-halo-color"]),"text-halo-width":new we(pt.paint_symbol["text-halo-width"]),"text-halo-blur":new we(pt.paint_symbol["text-halo-blur"]),"text-translate":new ue(pt.paint_symbol["text-translate"]),"text-translate-anchor":new ue(pt.paint_symbol["text-translate-anchor"])})},get layout(){return Gg=Gg||new Ar({"symbol-placement":new ue(pt.layout_symbol["symbol-placement"]),"symbol-spacing":new ue(pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ue(pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new we(pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ue(pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ue(pt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ue(pt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ue(pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ue(pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ue(pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new we(pt.layout_symbol["icon-size"]),"icon-text-fit":new ue(pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ue(pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new we(pt.layout_symbol["icon-image"]),"icon-rotate":new we(pt.layout_symbol["icon-rotate"]),"icon-padding":new we(pt.layout_symbol["icon-padding"]),"icon-keep-upright":new ue(pt.layout_symbol["icon-keep-upright"]),"icon-offset":new we(pt.layout_symbol["icon-offset"]),"icon-anchor":new we(pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ue(pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ue(pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ue(pt.layout_symbol["text-rotation-alignment"]),"text-field":new we(pt.layout_symbol["text-field"]),"text-font":new we(pt.layout_symbol["text-font"]),"text-size":new we(pt.layout_symbol["text-size"]),"text-max-width":new we(pt.layout_symbol["text-max-width"]),"text-line-height":new ue(pt.layout_symbol["text-line-height"]),"text-letter-spacing":new we(pt.layout_symbol["text-letter-spacing"]),"text-justify":new we(pt.layout_symbol["text-justify"]),"text-radial-offset":new we(pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ue(pt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new we(pt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new we(pt.layout_symbol["text-anchor"]),"text-max-angle":new ue(pt.layout_symbol["text-max-angle"]),"text-writing-mode":new ue(pt.layout_symbol["text-writing-mode"]),"text-rotate":new we(pt.layout_symbol["text-rotate"]),"text-padding":new ue(pt.layout_symbol["text-padding"]),"text-keep-upright":new ue(pt.layout_symbol["text-keep-upright"]),"text-transform":new we(pt.layout_symbol["text-transform"]),"text-offset":new we(pt.layout_symbol["text-offset"]),"text-allow-overlap":new ue(pt.layout_symbol["text-allow-overlap"]),"text-overlap":new ue(pt.layout_symbol["text-overlap"]),"text-ignore-placement":new ue(pt.layout_symbol["text-ignore-placement"]),"text-optional":new ue(pt.layout_symbol["text-optional"])})}};class Ug{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ts,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ne("FormatSectionOverride",Ug,{omit:["defaultValue"]});class Wu extends dr{constructor(e){super(e,Yf)}recalculate(e,s){if(super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const f=[];for(const y of h)f.indexOf(y)<0&&f.push(y);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,s,h,f){const y=this.layout.get(e).evaluate(s,{},h,f),v=this._unevaluatedLayout._values[e];return v.isDataDriven()||qo(v.value)||!y?y:function(w,S){return S.replace(/{([^{}]+)}/g,(E,C)=>w&&C in w?String(w[C]):"")}(s.properties,y)}createBucket(e){return new ml(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Yf.paint.overridableProperties){if(!Wu.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),h=new Ug(s),f=new $o(h,s.property.specification);let y=null;y=s.value.kind==="constant"||s.value.kind==="source"?new qa("source",f):new Wo("composite",f,s.value.zoomStops),this.paint._values[e]=new Ts(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,h){return!(!this.layout||s.isDataDriven()||h.isDataDriven())&&Wu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const h=e.get("text-field"),f=Yf.paint.properties[s];let y=!1;const v=w=>{for(const S of w)if(f.overrides&&f.overrides.hasOverride(S))return void(y=!0)};if(h.value.kind==="constant"&&h.value.value instanceof wr)v(h.value.value.sections);else if(h.value.kind==="source"){const w=E=>{y||(E instanceof Er&&Pe(E.value)===vn?v(E.value.sections):E instanceof Ba?v(E.sections):E.eachChild(w))},S=h.value;S._styleExpression&&w(S._styleExpression.expression)}return y}}let Vg;var zv={get paint(){return Vg=Vg||new Ar({"background-color":new ue(pt.paint_background["background-color"]),"background-pattern":new Bh(pt.paint_background["background-pattern"]),"background-opacity":new ue(pt.paint_background["background-opacity"])})}};class kv extends dr{constructor(e){super(e,zv)}}let $g;var Lv={get paint(){return $g=$g||new Ar({"raster-opacity":new ue(pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new ue(pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ue(pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ue(pt.paint_raster["raster-brightness-max"]),"raster-saturation":new ue(pt.paint_raster["raster-saturation"]),"raster-contrast":new ue(pt.paint_raster["raster-contrast"]),"raster-resampling":new ue(pt.paint_raster["raster-resampling"]),"raster-fade-duration":new ue(pt.paint_raster["raster-fade-duration"])})}};class Ov extends dr{constructor(e){super(e,Lv)}}class Fv extends dr{constructor(e){super(e,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Bv{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Nv={once:!0},Jf=63710088e-1;class pa{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new pa(Se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,h=this.lat*s,f=e.lat*s,y=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((e.lng-this.lng)*s);return Jf*Math.acos(Math.min(y,1))}static convert(e){if(e instanceof pa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new pa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new pa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const qg=2*Math.PI*Jf;function Zg(n){return qg*Math.cos(n*Math.PI/180)}function Wg(n){return(180+n)/360}function Xg(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Hg(n,e){return n/Zg(e)}function Qf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Kg(n,e){return n*Zg(Qf(e))}class nc{constructor(e,s,h=0){this.x=+e,this.y=+s,this.z=+h}static fromLngLat(e,s=0){const h=pa.convert(e);return new nc(Wg(h.lng),Xg(h.lat),Hg(s,h.lat))}toLngLat(){return new pa(360*this.x-180,Qf(this.y))}toAltitude(){return Kg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/qg*(e=Qf(this.y),1/Math.cos(e*Math.PI/180));var e}}function Yg(n,e,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[n*h-2*Math.PI*6378137/2,e*h-2*Math.PI*6378137/2]}class tp{constructor(e,s,h){if(!function(f,y,v){return!(f<0||f>25||v<0||v>=Math.pow(2,f)||y<0||y>=Math.pow(2,f))}(e,s,h))throw new Error(`x=${s}, y=${h}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=s,this.y=h,this.key=gl(0,e,e,s,h)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s,h){const f=(v=this.y,w=this.z,S=Yg(256*(y=this.x),256*(v=Math.pow(2,w)-v-1),w),E=Yg(256*(y+1),256*(v+1),w),S[0]+","+S[1]+","+E[0]+","+E[1]);var y,v,w,S,E;const C=function(k,N,U){let V,W="";for(let K=k;K>0;K--)V=1<<K-1,W+=(N&V?1:0)+(U&V?2:0);return W}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,f)}isChildOf(e){const s=this.z-e.z;return s>0&&e.x===this.x>>s&&e.y===this.y>>s}getTilePoint(e){const s=Math.pow(2,this.z);return new $((e.x*s-this.x)*Mt,(e.y*s-this.y)*Mt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Jg{constructor(e,s){this.wrap=e,this.canonical=s,this.key=gl(e,s.z,s.z,s.x,s.y)}}class ps{constructor(e,s,h,f,y){if(this.terrainRttPosMatrix32f=null,e<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${h}`);this.overscaledZ=e,this.wrap=s,this.canonical=new tp(h,+f,+y),this.key=gl(s,e,h,f,y)}clone(){return new ps(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?new ps(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ps(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-e;return e>this.canonical.z?gl(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y):gl(this.wrap*+s,e,e,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new ps(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new ps(s,this.wrap,s,h,f),new ps(s,this.wrap,s,h+1,f),new ps(s,this.wrap,s,h,f+1),new ps(s,this.wrap,s,h+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ps(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ps(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Jg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new nc(e.x-this.wrap,e.y))}}function gl(n,e,s,h,f){(n*=2)<0&&(n=-1*n-1);const y=1<<s;return(y*y*n+y*f+h).toString(36)+s.toString(36)+e.toString(36)}ne("CanonicalTileID",tp),ne("OverscaledTileID",ps,{omit:["terrainRttPosMatrix32f"]});class fo{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const s=new fo;return s.extend(e(new $(this.minX,this.minY))),s.extend(e(new $(this.maxX,this.minY))),s.extend(e(new $(this.minX,this.maxY))),s.extend(e(new $(this.maxX,this.maxY))),s}static fromPoints(e){const s=new fo;for(const h of e)s.extend(h);return s}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Qg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const h=e[s];this._stringToNumber[h]=s,this._numberToString[s]=h}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class t_{constructor(e,s,h,f,y){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=h,e._y=f,this.properties=e.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(e[s]=this[s]);return e}}class e_{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new la(Mt,16,0),this.grid3D=new la(Mt,16,0),this.featureIndexArray=new It,this.promoteId=s}insert(e,s,h,f,y,v){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,y);const S=v?this.grid3D:this.grid;for(let E=0;E<s.length;E++){const C=s[E],k=[1/0,1/0,-1/0,-1/0];for(let N=0;N<C.length;N++){const U=C[N];k[0]=Math.min(k[0],U.x),k[1]=Math.min(k[1],U.y),k[2]=Math.max(k[2],U.x),k[3]=Math.max(k[3],U.y)}k[0]<Mt&&k[1]<Mt&&k[2]>=0&&k[3]>=0&&S.insert(w,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new tc.VectorTile(new Vf(this.rawTileData)).layers,this.sourceLayerCoder=new Qg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,s,h,f){this.loadVTLayers();const y=e.params,v=Mt/e.tileSize/e.scale,w=Ys(y.filter),S=e.queryGeometry,E=e.queryPadding*v,C=fo.fromPoints(S),k=this.grid.query(C.minX-E,C.minY-E,C.maxX+E,C.maxY+E),N=fo.fromPoints(e.cameraQueryGeometry).expandBy(E),U=this.grid3D.query(N.minX,N.minY,N.maxX,N.maxY,(K,rt,_t,lt)=>function(j,H,ct,Et,Ut){for(const kt of j)if(H<=kt.x&&ct<=kt.y&&Et>=kt.x&&Ut>=kt.y)return!0;const Rt=[new $(H,ct),new $(H,Ut),new $(Et,Ut),new $(Et,ct)];if(j.length>2){for(const kt of Rt)if(cl(j,kt))return!0}for(let kt=0;kt<j.length-1;kt++)if(P1(j[kt],j[kt+1],Rt))return!0;return!1}(e.cameraQueryGeometry,K-E,rt-E,_t+E,lt+E));for(const K of U)k.push(K);k.sort(Gv);const V={};let W;for(let K=0;K<k.length;K++){const rt=k[K];if(rt===W)continue;W=rt;const _t=this.featureIndexArray.get(rt);let lt=null;this.loadMatchingFeature(V,_t.bucketIndex,_t.sourceLayerIndex,_t.featureIndex,w,y.layers,y.availableImages,s,h,f,(j,H,ct)=>(lt||(lt=lo(j)),H.queryIntersectsFeature({queryGeometry:S,feature:j,featureState:ct,geometry:lt,zoom:this.z,transform:e.transform,pixelsToTileUnits:v,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation})))}return V}loadMatchingFeature(e,s,h,f,y,v,w,S,E,C,k){const N=this.bucketLayerIDs[s];if(v&&!N.some(K=>v.has(K)))return;const U=this.sourceLayerCoder.decode(h),V=this.vtLayers[U].feature(f);if(y.needGeometry){const K=ho(V,!0);if(!y.filter(new Ci(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!y.filter(new Ci(this.tileID.overscaledZ),V))return;const W=this.getId(V,U);for(let K=0;K<N.length;K++){const rt=N[K];if(v&&!v.has(rt))continue;const _t=S[rt];if(!_t)continue;let lt={};W&&C&&(lt=C.getState(_t.sourceLayer||"_geojsonTileLayer",W));const j=ze({},E[rt]);j.paint=i_(j.paint,_t.paint,V,lt,w),j.layout=i_(j.layout,_t.layout,V,lt,w);const H=!k||k(V,_t,lt);if(!H)continue;const ct=new t_(V,this.z,this.x,this.y,W);ct.layer=j;let Et=e[rt];Et===void 0&&(Et=e[rt]=[]),Et.push({featureIndex:f,feature:ct,intersectionZ:H})}}lookupSymbolFeatures(e,s,h,f,y,v,w,S){const E={};this.loadVTLayers();const C=Ys(y);for(const k of e)this.loadMatchingFeature(E,h,f,k,C,v,w,S,s);return E}hasLayer(e){for(const s of this.bucketLayerIDs)for(const h of s)if(e===h)return!0;return!1}getId(e,s){var h;let f=e.id;return this.promoteId&&(f=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((h=e.properties)===null||h===void 0)&&h.cluster)&&this.promoteId&&(f=Number(e.properties.cluster_id))),f}}function i_(n,e,s,h,f){return oe(n,(y,v)=>{const w=e instanceof nl?e.get(v):null;return w&&w.evaluate?w.evaluate(s,h,f):w})}function Gv(n,e){return e-n}function r_(n,e,s,h,f){const y=[];for(let v=0;v<n.length;v++){const w=n[v];let S;for(let E=0;E<w.length-1;E++){let C=w[E],k=w[E+1];C.x<e&&k.x<e||(C.x<e?C=new $(e,C.y+(e-C.x)/(k.x-C.x)*(k.y-C.y))._round():k.x<e&&(k=new $(e,C.y+(e-C.x)/(k.x-C.x)*(k.y-C.y))._round()),C.y<s&&k.y<s||(C.y<s?C=new $(C.x+(s-C.y)/(k.y-C.y)*(k.x-C.x),s)._round():k.y<s&&(k=new $(C.x+(s-C.y)/(k.y-C.y)*(k.x-C.x),s)._round()),C.x>=h&&k.x>=h||(C.x>=h?C=new $(h,C.y+(h-C.x)/(k.x-C.x)*(k.y-C.y))._round():k.x>=h&&(k=new $(h,C.y+(h-C.x)/(k.x-C.x)*(k.y-C.y))._round()),C.y>=f&&k.y>=f||(C.y>=f?C=new $(C.x+(f-C.y)/(k.y-C.y)*(k.x-C.x),f)._round():k.y>=f&&(k=new $(C.x+(f-C.y)/(k.y-C.y)*(k.x-C.x),f)._round()),S&&C.equals(S[S.length-1])||(S=[C],y.push(S)),S.push(k)))))}}return y}ne("FeatureIndex",e_,{omit:["rawTileData","sourceLayerCoder"]});class ma extends ${constructor(e,s,h,f){super(e,s),this.angle=h,f!==void 0&&(this.segment=f)}clone(){return new ma(this.x,this.y,this.angle,this.segment)}}function s_(n,e,s,h,f){if(e.segment===void 0||s===0)return!0;let y=e,v=e.segment+1,w=0;for(;w>-s/2;){if(v--,v<0)return!1;w-=n[v].dist(y),y=n[v]}w+=n[v].dist(n[v+1]),v++;const S=[];let E=0;for(;w<s/2;){const C=n[v],k=n[v+1];if(!k)return!1;let N=n[v-1].angleTo(C)-C.angleTo(k);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:w,angleDelta:N}),E+=N;w-S[0].distance>h;)E-=S.shift().angleDelta;if(E>f)return!1;v++,w+=C.dist(k)}return!0}function n_(n){let e=0;for(let s=0;s<n.length-1;s++)e+=n[s].dist(n[s+1]);return e}function a_(n,e,s){return n?.6*e*s:0}function o_(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function jv(n,e,s,h,f,y){const v=a_(s,f,y),w=o_(s,h)*y;let S=0;const E=n_(n)/2;for(let C=0;C<n.length-1;C++){const k=n[C],N=n[C+1],U=k.dist(N);if(S+U>E){const V=(E-S)/U,W=Zr.number(k.x,N.x,V),K=Zr.number(k.y,N.y,V),rt=new ma(W,K,N.angleTo(k),C);return rt._round(),!v||s_(n,rt,w,v,e)?rt:void 0}S+=U}}function Uv(n,e,s,h,f,y,v,w,S){const E=a_(h,y,v),C=o_(h,f),k=C*v,N=n[0].x===0||n[0].x===S||n[0].y===0||n[0].y===S;return e-k<e/4&&(e=k+e/4),l_(n,N?e/2*w%e:(C/2+2*y)*v*w%e,e,E,s,k,N,!1,S)}function l_(n,e,s,h,f,y,v,w,S){const E=y/2,C=n_(n);let k=0,N=e-s,U=[];for(let V=0;V<n.length-1;V++){const W=n[V],K=n[V+1],rt=W.dist(K),_t=K.angleTo(W);for(;N+s<k+rt;){N+=s;const lt=(N-k)/rt,j=Zr.number(W.x,K.x,lt),H=Zr.number(W.y,K.y,lt);if(j>=0&&j<S&&H>=0&&H<S&&N-E>=0&&N+E<=C){const ct=new ma(j,H,_t,V);ct._round(),h&&!s_(n,ct,y,h,f)||U.push(ct)}}k+=rt}return w||U.length||v||(U=l_(n,k/2,s,h,f,y,v,!0,S)),U}function h_(n,e,s,h){const f=[],y=n.image,v=y.pixelRatio,w=y.paddedRect.w-2,S=y.paddedRect.h-2;let E={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const C=y.stretchX||[[0,w]],k=y.stretchY||[[0,S]],N=(Ft,ce)=>Ft+ce[1]-ce[0],U=C.reduce(N,0),V=k.reduce(N,0),W=w-U,K=S-V;let rt=0,_t=U,lt=0,j=V,H=0,ct=W,Et=0,Ut=K;if(y.content&&h){const Ft=y.content,ce=Ft[2]-Ft[0],xe=Ft[3]-Ft[1];(y.textFitWidth||y.textFitHeight)&&(E=Fg(n)),rt=Xu(C,0,Ft[0]),lt=Xu(k,0,Ft[1]),_t=Xu(C,Ft[0],Ft[2]),j=Xu(k,Ft[1],Ft[3]),H=Ft[0]-rt,Et=Ft[1]-lt,ct=ce-_t,Ut=xe-j}const Rt=E.x1,kt=E.y1,Zt=E.x2-Rt,$t=E.y2-kt,Kt=(Ft,ce,xe,ye)=>{const pe=Hu(Ft.stretch-rt,_t,Zt,Rt),ei=Ku(Ft.fixed-H,ct,Ft.stretch,U),ji=Hu(ce.stretch-lt,j,$t,kt),tr=Ku(ce.fixed-Et,Ut,ce.stretch,V),Tr=Hu(xe.stretch-rt,_t,Zt,Rt),ms=Ku(xe.fixed-H,ct,xe.stretch,U),Xr=Hu(ye.stretch-lt,j,$t,kt),gr=Ku(ye.fixed-Et,Ut,ye.stretch,V),Bi=new $(pe,ji),lr=new $(Tr,ji),_r=new $(Tr,Xr),yr=new $(pe,Xr),Vr=new $(ei/v,tr/v),gs=new $(ms/v,gr/v),hr=e*Math.PI/180;if(hr){const cr=Math.sin(hr),ur=Math.cos(hr),Ji=[ur,-cr,cr,ur];Bi._matMult(Ji),lr._matMult(Ji),yr._matMult(Ji),_r._matMult(Ji)}const Hr=Ft.stretch+Ft.fixed,er=ce.stretch+ce.fixed;return{tl:Bi,tr:lr,bl:yr,br:_r,tex:{x:y.paddedRect.x+1+Hr,y:y.paddedRect.y+1+er,w:xe.stretch+xe.fixed-Hr,h:ye.stretch+ye.fixed-er},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vr,pixelOffsetBR:gs,minFontScaleX:ct/v/Zt,minFontScaleY:Ut/v/$t,isSDF:s}};if(h&&(y.stretchX||y.stretchY)){const Ft=c_(C,W,U),ce=c_(k,K,V);for(let xe=0;xe<Ft.length-1;xe++){const ye=Ft[xe],pe=Ft[xe+1];for(let ei=0;ei<ce.length-1;ei++)f.push(Kt(ye,ce[ei],pe,ce[ei+1]))}}else f.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:S+1}));return f}function Xu(n,e,s){let h=0;for(const f of n)h+=Math.max(e,Math.min(s,f[1]))-Math.max(e,Math.min(s,f[0]));return h}function c_(n,e,s){const h=[{fixed:-1,stretch:0}];for(const[f,y]of n){const v=h[h.length-1];h.push({fixed:f-v.stretch,stretch:v.stretch}),h.push({fixed:f-v.stretch,stretch:v.stretch+(y-f)})}return h.push({fixed:e+1,stretch:s}),h}function Hu(n,e,s,h){return n/e*s+h}function Ku(n,e,s,h){return n-e*s/h}ne("Anchor",ma);class Yu{constructor(e,s,h,f,y,v,w,S,E,C){var k;if(this.boxStartIndex=e.length,E){let N=v.top,U=v.bottom;const V=v.collisionPadding;V&&(N-=V[1],U+=V[3]);let W=U-N;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{const N=!((k=v.image)===null||k===void 0)&&k.content&&(v.image.textFitWidth||v.image.textFitHeight)?Fg(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};N.y1=N.y1*w-S[0],N.y2=N.y2*w+S[2],N.x1=N.x1*w-S[3],N.x2=N.x2*w+S[1];const U=v.collisionPadding;if(U&&(N.x1-=U[0]*w,N.y1-=U[1]*w,N.x2+=U[2]*w,N.y2+=U[3]*w),C){const V=new $(N.x1,N.y1),W=new $(N.x2,N.y1),K=new $(N.x1,N.y2),rt=new $(N.x2,N.y2),_t=C*Math.PI/180;V._rotate(_t),W._rotate(_t),K._rotate(_t),rt._rotate(_t),N.x1=Math.min(V.x,W.x,K.x,rt.x),N.x2=Math.max(V.x,W.x,K.x,rt.x),N.y1=Math.min(V.y,W.y,K.y,rt.y),N.y2=Math.max(V.y,W.y,K.y,rt.y)}e.emplaceBack(s.x,s.y,N.x1,N.y1,N.x2,N.y2,h,f,y)}this.boxEndIndex=e.length}}class Vv{constructor(e=[],s=(h,f)=>h<f?-1:h>f?1:0){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:h}=this,f=s[e];for(;e>0;){const y=e-1>>1,v=s[y];if(h(f,v)>=0)break;s[e]=v,e=y}s[e]=f}_down(e){const{data:s,compare:h}=this,f=this.length>>1,y=s[e];for(;e<f;){let v=1+(e<<1);const w=v+1;if(w<this.length&&h(s[w],s[v])<0&&(v=w),h(s[v],y)>=0)break;s[e]=s[v],e=v}s[e]=y}}function $v(n,e=1,s=!1){const h=fo.fromPoints(n[0]),f=Math.min(h.width(),h.height());let y=f/2;const v=new Vv([],qv),{minX:w,minY:S,maxX:E,maxY:C}=h;if(f===0)return new $(w,S);for(let U=w;U<E;U+=f)for(let V=S;V<C;V+=f)v.push(new _l(U+y,V+y,y,n));let k=function(U){let V=0,W=0,K=0;const rt=U[0];for(let _t=0,lt=rt.length,j=lt-1;_t<lt;j=_t++){const H=rt[_t],ct=rt[j],Et=H.x*ct.y-ct.x*H.y;W+=(H.x+ct.x)*Et,K+=(H.y+ct.y)*Et,V+=3*Et}return new _l(W/V,K/V,0,U)}(n),N=v.length;for(;v.length;){const U=v.pop();(U.d>k.d||!k.d)&&(k=U,s&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,N)),U.max-k.d<=e||(y=U.h/2,v.push(new _l(U.p.x-y,U.p.y-y,y,n)),v.push(new _l(U.p.x+y,U.p.y-y,y,n)),v.push(new _l(U.p.x-y,U.p.y+y,y,n)),v.push(new _l(U.p.x+y,U.p.y+y,y,n)),N+=4)}return s&&(console.log(`num probes: ${N}`),console.log(`best distance: ${k.d}`)),k.p}function qv(n,e){return e.max-n.max}function _l(n,e,s,h){this.p=new $(n,e),this.h=s,this.d=function(f,y){let v=!1,w=1/0;for(let S=0;S<y.length;S++){const E=y[S];for(let C=0,k=E.length,N=k-1;C<k;N=C++){const U=E[C],V=E[N];U.y>f.y!=V.y>f.y&&f.x<(V.x-U.x)*(f.y-U.y)/(V.y-U.y)+U.x&&(v=!v),w=Math.min(w,Vm(f,U,V))}}return(v?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Sr;m.aD=void 0,(Sr=m.aD||(m.aD={}))[Sr.center=1]="center",Sr[Sr.left=2]="left",Sr[Sr.right=3]="right",Sr[Sr.top=4]="top",Sr[Sr.bottom=5]="bottom",Sr[Sr["top-left"]=6]="top-left",Sr[Sr["top-right"]=7]="top-right",Sr[Sr["bottom-left"]=8]="bottom-left",Sr[Sr["bottom-right"]=9]="bottom-right";const ep=Number.POSITIVE_INFINITY;function u_(n,e){return e[1]!==ep?function(s,h,f){let y=0,v=0;switch(h=Math.abs(h),f=Math.abs(f),s){case"top-right":case"top-left":case"top":v=f-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-f}switch(s){case"top-right":case"bottom-right":case"right":y=-h;break;case"top-left":case"bottom-left":case"left":y=h}return[y,v]}(n,e[0],e[1]):function(s,h){let f=0,y=0;h<0&&(h=0);const v=h/Math.SQRT2;switch(s){case"top-right":case"top-left":y=v-7;break;case"bottom-right":case"bottom-left":y=7-v;break;case"bottom":y=7-h;break;case"top":y=h-7}switch(s){case"top-right":case"bottom-right":f=-v;break;case"top-left":case"bottom-left":f=v;break;case"left":f=h;break;case"right":f=-h}return[f,y]}(n,e[0])}function d_(n,e,s){var h;const f=n.layout,y=(h=f.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(e,{},s);if(y){const w=y.values,S=[];for(let E=0;E<w.length;E+=2){const C=S[E]=w[E],k=w[E+1].map(N=>N*or);C.startsWith("top")?k[1]-=7:C.startsWith("bottom")&&(k[1]+=7),S[E+1]=k}return new si(S)}const v=f.get("text-variable-anchor");if(v){let w;w=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(e,{},s)*or,ep]:f.get("text-offset").evaluate(e,{},s).map(E=>E*or);const S=[];for(const E of v)S.push(E,u_(E,w));return new si(S)}return null}function ip(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zv(n,e,s,h,f,y,v,w,S,E,C,k){let N=y.textMaxSize.evaluate(e,{});N===void 0&&(N=v);const U=n.layers[0].layout,V=U.get("icon-offset").evaluate(e,{},C),W=p_(s.horizontal),K=v/24,rt=n.tilePixelRatio*K,_t=n.tilePixelRatio*N/24,lt=n.tilePixelRatio*w,j=n.tilePixelRatio*U.get("symbol-spacing"),H=U.get("text-padding")*n.tilePixelRatio,ct=function(xe,ye,pe,ei=1){const ji=xe.get("icon-padding").evaluate(ye,{},pe),tr=ji&&ji.values;return[tr[0]*ei,tr[1]*ei,tr[2]*ei,tr[3]*ei]}(U,e,C,n.tilePixelRatio),Et=U.get("text-max-angle")/180*Math.PI,Ut=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",Rt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",kt=U.get("symbol-placement"),Zt=j/2,$t=U.get("icon-text-fit");let Kt;h&&$t!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(Kt=Bg(h,s.vertical,$t,U.get("icon-text-fit-padding"),V,K)),W&&(h=Bg(h,W,$t,U.get("icon-text-fit-padding"),V,K)));const Ft=C?k.line.getGranularityForZoomLevel(C.z):1,ce=(xe,ye)=>{ye.x<0||ye.x>=Mt||ye.y<0||ye.y>=Mt||function(pe,ei,ji,tr,Tr,ms,Xr,gr,Bi,lr,_r,yr,Vr,gs,hr,Hr,er,cr,ur,Ji,Ei,js,yl,Us,Hv){const vl=pe.addToLineVertexArray(ei,ji);let po,xl,bl,wl,y_=0,v_=0,x_=0,b_=0,cp=-1,up=-1;const zn={};let w_=Ur("");if(pe.allowVerticalPlacement&&tr.vertical){const Dr=gr.layout.get("text-rotate").evaluate(Ei,{},Us)+90;bl=new Yu(Bi,ei,lr,_r,yr,tr.vertical,Vr,gs,hr,Dr),Xr&&(wl=new Yu(Bi,ei,lr,_r,yr,Xr,er,cr,hr,Dr))}if(Tr){const Dr=gr.layout.get("icon-rotate").evaluate(Ei,{}),_s=gr.layout.get("icon-text-fit")!=="none",mo=h_(Tr,Dr,yl,_s),$s=Xr?h_(Xr,Dr,yl,_s):void 0;xl=new Yu(Bi,ei,lr,_r,yr,Tr,er,cr,!1,Dr),y_=4*mo.length;const go=pe.iconSizeData;let ln=null;go.kind==="source"?(ln=[Dn*gr.layout.get("icon-size").evaluate(Ei,{})],ln[0]>fa&&De(`${pe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):go.kind==="composite"&&(ln=[Dn*js.compositeIconSizes[0].evaluate(Ei,{},Us),Dn*js.compositeIconSizes[1].evaluate(Ei,{},Us)],(ln[0]>fa||ln[1]>fa)&&De(`${pe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),pe.addSymbols(pe.icon,mo,ln,Ji,ur,Ei,m.an.none,ei,vl.lineStartIndex,vl.lineLength,-1,Us),cp=pe.icon.placedSymbolArray.length-1,$s&&(v_=4*$s.length,pe.addSymbols(pe.icon,$s,ln,Ji,ur,Ei,m.an.vertical,ei,vl.lineStartIndex,vl.lineLength,-1,Us),up=pe.icon.placedSymbolArray.length-1)}const M_=Object.keys(tr.horizontal);for(const Dr of M_){const _s=tr.horizontal[Dr];if(!po){w_=Ur(_s.text);const $s=gr.layout.get("text-rotate").evaluate(Ei,{},Us);po=new Yu(Bi,ei,lr,_r,yr,_s,Vr,gs,hr,$s)}const mo=_s.positionedLines.length===1;if(x_+=f_(pe,ei,_s,ms,gr,hr,Ei,Hr,vl,tr.vertical?m.an.horizontal:m.an.horizontalOnly,mo?M_:[Dr],zn,cp,js,Us),mo)break}tr.vertical&&(b_+=f_(pe,ei,tr.vertical,ms,gr,hr,Ei,Hr,vl,m.an.vertical,["vertical"],zn,up,js,Us));const Kv=po?po.boxStartIndex:pe.collisionBoxArray.length,Yv=po?po.boxEndIndex:pe.collisionBoxArray.length,Jv=bl?bl.boxStartIndex:pe.collisionBoxArray.length,Qv=bl?bl.boxEndIndex:pe.collisionBoxArray.length,tx=xl?xl.boxStartIndex:pe.collisionBoxArray.length,ex=xl?xl.boxEndIndex:pe.collisionBoxArray.length,ix=wl?wl.boxStartIndex:pe.collisionBoxArray.length,rx=wl?wl.boxEndIndex:pe.collisionBoxArray.length;let Vs=-1;const Qu=(Dr,_s)=>Dr&&Dr.circleDiameter?Math.max(Dr.circleDiameter,_s):_s;Vs=Qu(po,Vs),Vs=Qu(bl,Vs),Vs=Qu(xl,Vs),Vs=Qu(wl,Vs);const S_=Vs>-1?1:0;S_&&(Vs*=Hv/or),pe.glyphOffsetArray.length>=ml.MAX_GLYPHS&&De("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ei.sortKey!==void 0&&pe.addToSortKeyRanges(pe.symbolInstances.length,Ei.sortKey);const sx=d_(gr,Ei,Us),[nx,ax]=function(Dr,_s){const mo=Dr.length,$s=_s==null?void 0:_s.values;if(($s==null?void 0:$s.length)>0)for(let go=0;go<$s.length;go+=2){const ln=$s[go+1];Dr.emplaceBack(m.aD[$s[go]],ln[0],ln[1])}return[mo,Dr.length]}(pe.textAnchorOffsets,sx);pe.symbolInstances.emplaceBack(ei.x,ei.y,zn.right>=0?zn.right:-1,zn.center>=0?zn.center:-1,zn.left>=0?zn.left:-1,zn.vertical||-1,cp,up,w_,Kv,Yv,Jv,Qv,tx,ex,ix,rx,lr,x_,b_,y_,v_,S_,0,Vr,Vs,nx,ax)}(n,ye,xe,s,h,f,Kt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,rt,[H,H,H,H],Ut,S,lt,ct,Rt,V,e,y,E,C,v)};if(kt==="line")for(const xe of r_(e.geometry,0,0,Mt,Mt)){const ye=uo(xe,Ft),pe=Uv(ye,j,Et,s.vertical||W,h,24,_t,n.overscaling,Mt);for(const ei of pe)W&&Wv(n,W.text,Zt,ei)||ce(ye,ei)}else if(kt==="line-center"){for(const xe of e.geometry)if(xe.length>1){const ye=uo(xe,Ft),pe=jv(ye,Et,s.vertical||W,h,24,_t);pe&&ce(ye,pe)}}else if(e.type==="Polygon")for(const xe of Fo(e.geometry,0)){const ye=$v(xe,16);ce(uo(xe[0],Ft,!0),new ma(ye.x,ye.y,0))}else if(e.type==="LineString")for(const xe of e.geometry){const ye=uo(xe,Ft);ce(ye,new ma(ye[0].x,ye[0].y,0))}else if(e.type==="Point")for(const xe of e.geometry)for(const ye of xe)ce([ye],new ma(ye.x,ye.y,0))}function f_(n,e,s,h,f,y,v,w,S,E,C,k,N,U,V){const W=function(_t,lt,j,H,ct,Et,Ut,Rt){const kt=H.layout.get("text-rotate").evaluate(Et,{})*Math.PI/180,Zt=[];for(const $t of lt.positionedLines)for(const Kt of $t.positionedGlyphs){if(!Kt.rect)continue;const Ft=Kt.rect||{};let ce=4,xe=!0,ye=1,pe=0;const ei=(ct||Rt)&&Kt.vertical,ji=Kt.metrics.advance*Kt.scale/2;if(Rt&&lt.verticalizable&&(pe=$t.lineOffset/2-(Kt.imageName?-(or-Kt.metrics.width*Kt.scale)/2:(Kt.scale-1)*or)),Kt.imageName){const cr=Ut[Kt.imageName];xe=cr.sdf,ye=cr.pixelRatio,ce=1/ye}const tr=ct?[Kt.x+ji,Kt.y]:[0,0];let Tr=ct?[0,0]:[Kt.x+ji+j[0],Kt.y+j[1]-pe],ms=[0,0];ei&&(ms=Tr,Tr=[0,0]);const Xr=Kt.metrics.isDoubleResolution?2:1,gr=(Kt.metrics.left-ce)*Kt.scale-ji+Tr[0],Bi=(-Kt.metrics.top-ce)*Kt.scale+Tr[1],lr=gr+Ft.w/Xr*Kt.scale/ye,_r=Bi+Ft.h/Xr*Kt.scale/ye,yr=new $(gr,Bi),Vr=new $(lr,Bi),gs=new $(gr,_r),hr=new $(lr,_r);if(ei){const cr=new $(-ji,ji- -17),ur=-Math.PI/2,Ji=12-ji,Ei=new $(22-Ji,-(Kt.imageName?Ji:0)),js=new $(...ms);yr._rotateAround(ur,cr)._add(Ei)._add(js),Vr._rotateAround(ur,cr)._add(Ei)._add(js),gs._rotateAround(ur,cr)._add(Ei)._add(js),hr._rotateAround(ur,cr)._add(Ei)._add(js)}if(kt){const cr=Math.sin(kt),ur=Math.cos(kt),Ji=[ur,-cr,cr,ur];yr._matMult(Ji),Vr._matMult(Ji),gs._matMult(Ji),hr._matMult(Ji)}const Hr=new $(0,0),er=new $(0,0);Zt.push({tl:yr,tr:Vr,bl:gs,br:hr,tex:Ft,writingMode:lt.writingMode,glyphOffset:tr,sectionIndex:Kt.sectionIndex,isSDF:xe,pixelOffsetTL:Hr,pixelOffsetBR:er,minFontScaleX:0,minFontScaleY:0})}return Zt}(0,s,w,f,y,v,h,n.allowVerticalPlacement),K=n.textSizeData;let rt=null;K.kind==="source"?(rt=[Dn*f.layout.get("text-size").evaluate(v,{})],rt[0]>fa&&De(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):K.kind==="composite"&&(rt=[Dn*U.compositeTextSizes[0].evaluate(v,{},V),Dn*U.compositeTextSizes[1].evaluate(v,{},V)],(rt[0]>fa||rt[1]>fa)&&De(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,W,rt,w,y,v,E,e,S.lineStartIndex,S.lineLength,N,V);for(const _t of C)k[_t]=n.text.placedSymbolArray.length-1;return 4*W.length}function p_(n){for(const e in n)return n[e];return null}function Wv(n,e,s,h){const f=n.compareText;if(e in f){const y=f[e];for(let v=y.length-1;v>=0;v--)if(h.dist(y[v])<s)return!0}else f[e]=[];return f[e].push(h),!1}const m_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class rp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,h]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=h>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const y=m_[15&h];if(!y)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new rp(w,v,y,e)}constructor(e,s=64,h=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=h,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const y=m_.indexOf(this.ArrayType),v=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-w%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${h}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=e,this.coords[this._pos++]=s,h}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return sp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:v,nodeSize:w}=this,S=[0,y.length-1,0],E=[];for(;S.length;){const C=S.pop()||0,k=S.pop()||0,N=S.pop()||0;if(k-N<=w){for(let K=N;K<=k;K++){const rt=v[2*K],_t=v[2*K+1];rt>=e&&rt<=h&&_t>=s&&_t<=f&&E.push(y[K])}continue}const U=N+k>>1,V=v[2*U],W=v[2*U+1];V>=e&&V<=h&&W>=s&&W<=f&&E.push(y[U]),(C===0?e<=V:s<=W)&&(S.push(N),S.push(U-1),S.push(1-C)),(C===0?h>=V:f>=W)&&(S.push(U+1),S.push(k),S.push(1-C))}return E}within(e,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:v}=this,w=[0,f.length-1,0],S=[],E=h*h;for(;w.length;){const C=w.pop()||0,k=w.pop()||0,N=w.pop()||0;if(k-N<=v){for(let K=N;K<=k;K++)__(y[2*K],y[2*K+1],e,s)<=E&&S.push(f[K]);continue}const U=N+k>>1,V=y[2*U],W=y[2*U+1];__(V,W,e,s)<=E&&S.push(f[U]),(C===0?e-h<=V:s-h<=W)&&(w.push(N),w.push(U-1),w.push(1-C)),(C===0?e+h>=V:s+h>=W)&&(w.push(U+1),w.push(k),w.push(1-C))}return S}}function sp(n,e,s,h,f,y){if(f-h<=s)return;const v=h+f>>1;g_(n,e,v,h,f,y),sp(n,e,s,h,v-1,1-y),sp(n,e,s,v+1,f,1-y)}function g_(n,e,s,h,f,y){for(;f>h;){if(f-h>600){const E=f-h+1,C=s-h+1,k=Math.log(E),N=.5*Math.exp(2*k/3),U=.5*Math.sqrt(k*N*(E-N)/E)*(C-E/2<0?-1:1);g_(n,e,s,Math.max(h,Math.floor(s-C*N/E+U)),Math.min(f,Math.floor(s+(E-C)*N/E+U)),y)}const v=e[2*s+y];let w=h,S=f;for(ac(n,e,h,s),e[2*f+y]>v&&ac(n,e,h,f);w<S;){for(ac(n,e,w,S),w++,S--;e[2*w+y]<v;)w++;for(;e[2*S+y]>v;)S--}e[2*h+y]===v?ac(n,e,h,S):(S++,ac(n,e,S,f)),S<=s&&(h=S+1),s<=S&&(f=S-1)}}function ac(n,e,s,h){np(n,s,h),np(e,2*s,2*h),np(e,2*s+1,2*h+1)}function np(n,e,s){const h=n[e];n[e]=n[s],n[s]=h}function __(n,e,s,h){const f=n-s,y=e-h;return f*f+y*y}var ap;m.cw=void 0,(ap=m.cw||(m.cw={})).create="create",ap.load="load",ap.fullLoad="fullLoad";let Ju=null,oc=[];const op=1e3/60,lp="loadTime",hp="fullLoadTime",Xv={mark(n){performance.mark(n)},frame(n){const e=n;Ju!=null&&oc.push(e-Ju),Ju=e},clearMetrics(){Ju=null,oc=[],performance.clearMeasures(lp),performance.clearMeasures(hp);for(const n in m.cw)performance.clearMarks(m.cw[n])},getPerformanceMetrics(){performance.measure(lp,m.cw.create,m.cw.load),performance.measure(hp,m.cw.create,m.cw.fullLoad);const n=performance.getEntriesByName(lp)[0].duration,e=performance.getEntriesByName(hp)[0].duration,s=oc.length,h=1/(oc.reduce((y,v)=>y+v,0)/s/1e3),f=oc.filter(y=>y>op).reduce((y,v)=>y+(v-op)/op,0);return{loadTime:n,fullLoadTime:e,fps:h,percentDroppedFrames:f/(s+f)*100,totalFrames:s}}};m.$=Mt,m.A=re,m.B=function([n,e,s]){return e+=90,e*=Math.PI/180,s*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(s),y:n*Math.sin(e)*Math.sin(s),z:n*Math.cos(s)}},m.C=Zr,m.D=ue,m.E=Bt,m.F=Ci,m.G=el,m.H=function(n){if(pi==null){const e=n.navigator?n.navigator.userAgent:null;pi=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return pi},m.I=$f,m.J=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Bv(()=>this.process()),this.subscription=ir(this.target,"message",s=>this.receive(s),!1),this.globalScope=Ze(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}sendAsync(n,e){return new Promise((s,h)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10),y=e?ir(e.signal,"abort",()=>{y==null||y.unsubscribe(),delete this.resolveRejects[f];const S={id:f,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(S)},Nv):null;this.resolveRejects[f]={resolve:S=>{y==null||y.unsubscribe(),s(S)},reject:S=>{y==null||y.unsubscribe(),h(S)}};const v=[],w=Object.assign(Object.assign({},n),{id:f,sourceMapId:this.mapId,origin:location.origin,data:Qa(n.data,v)});this.target.postMessage(w,{transfer:v})})}receive(n){const e=n.data,s=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[s];const h=this.abortControllers[s];return delete this.abortControllers[s],void(h&&h.abort())}if(Ze(self)||e.mustQueue)return this.tasks[s]=e,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return o(this,void 0,void 0,function*(){if(e.type==="<response>"){const f=this.resolveRejects[n];return delete this.resolveRejects[n],f?void(e.error?f.reject(ha(e.error)):f.resolve(ha(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=ha(e.data),h=new AbortController;this.abortControllers[n]=h;try{const f=yield this.messageHandlers[e.type](e.sourceMapId,s,h);this.completeTask(n,null,f)}catch(f){this.completeTask(n,f)}})}completeTask(n,e,s){const h=[];delete this.abortControllers[n];const f={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Qa(e):null,data:Qa(s,h)};this.target.postMessage(f,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.K=Y,m.L=function(){var n=new re(16);return re!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},m.M=function(n,e,s){var h,f,y,v,w,S,E,C,k,N,U,V,W=s[0],K=s[1],rt=s[2];return e===n?(n[12]=e[0]*W+e[4]*K+e[8]*rt+e[12],n[13]=e[1]*W+e[5]*K+e[9]*rt+e[13],n[14]=e[2]*W+e[6]*K+e[10]*rt+e[14],n[15]=e[3]*W+e[7]*K+e[11]*rt+e[15]):(f=e[1],y=e[2],v=e[3],w=e[4],S=e[5],E=e[6],C=e[7],k=e[8],N=e[9],U=e[10],V=e[11],n[0]=h=e[0],n[1]=f,n[2]=y,n[3]=v,n[4]=w,n[5]=S,n[6]=E,n[7]=C,n[8]=k,n[9]=N,n[10]=U,n[11]=V,n[12]=h*W+w*K+k*rt+e[12],n[13]=f*W+S*K+N*rt+e[13],n[14]=y*W+E*K+U*rt+e[14],n[15]=v*W+C*K+V*rt+e[15]),n},m.N=function(n,e,s){var h=s[0],f=s[1],y=s[2];return n[0]=e[0]*h,n[1]=e[1]*h,n[2]=e[2]*h,n[3]=e[3]*h,n[4]=e[4]*f,n[5]=e[5]*f,n[6]=e[6]*f,n[7]=e[7]*f,n[8]=e[8]*y,n[9]=e[9]*y,n[10]=e[10]*y,n[11]=e[11]*y,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},m.O=function(n,e,s){var h=e[0],f=e[1],y=e[2],v=e[3],w=e[4],S=e[5],E=e[6],C=e[7],k=e[8],N=e[9],U=e[10],V=e[11],W=e[12],K=e[13],rt=e[14],_t=e[15],lt=s[0],j=s[1],H=s[2],ct=s[3];return n[0]=lt*h+j*w+H*k+ct*W,n[1]=lt*f+j*S+H*N+ct*K,n[2]=lt*y+j*E+H*U+ct*rt,n[3]=lt*v+j*C+H*V+ct*_t,n[4]=(lt=s[4])*h+(j=s[5])*w+(H=s[6])*k+(ct=s[7])*W,n[5]=lt*f+j*S+H*N+ct*K,n[6]=lt*y+j*E+H*U+ct*rt,n[7]=lt*v+j*C+H*V+ct*_t,n[8]=(lt=s[8])*h+(j=s[9])*w+(H=s[10])*k+(ct=s[11])*W,n[9]=lt*f+j*S+H*N+ct*K,n[10]=lt*y+j*E+H*U+ct*rt,n[11]=lt*v+j*C+H*V+ct*_t,n[12]=(lt=s[12])*h+(j=s[13])*w+(H=s[14])*k+(ct=s[15])*W,n[13]=lt*f+j*S+H*N+ct*K,n[14]=lt*y+j*E+H*U+ct*rt,n[15]=lt*v+j*C+H*V+ct*_t,n},m.P=$,m.Q=function(n,e){const s={};for(let h=0;h<e.length;h++){const f=e[h];f in n&&(s[f]=n[f])}return s},m.R=Wr,m.S=pa,m.T=Cf,m.U=Xg,m.V=Wg,m.W=Ot,m.X=jt,m.Y=Ae,m.Z=ps,m._=o,m.a=Z,m.a$=function(n,e,s){return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n},m.a0=nc,m.a1=fo,m.a2=25,m.a3=tp,m.a4=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(s=>{e.onloadstart=()=>{s(e)};for(const h of n){const f=window.document.createElement("source");Tt(h)||(e.crossOrigin="Anonymous"),f.src=h,e.appendChild(f)}})},m.a5=Ht,m.a6=function(){return Wt++},m.a7=Q,m.a8=ml,m.a9=Ys,m.aA=or,m.aB=Lt,m.aC=function(n,e,s,h,f=!1){if(!s[0]&&!s[1])return[0,0];const y=f?h==="map"?-n.bearingInRadians:0:h==="viewport"?n.bearingInRadians:0;if(y){const v=Math.sin(y),w=Math.cos(y);s=[s[0]*w-s[1]*v,s[0]*v+s[1]*w]}return[f?s[0]:Lt(e,s[0],n.zoom),f?s[1]:Lt(e,s[1],n.zoom)]},m.aE=Wf,m.aF=ip,m.aG=Zf,m.aH=rp,m.aI=Gi,m.aJ=ju,m.aK=St,m.aL=ai,m.aM=yi,m.aN=Se,m.aO=xr,m.aP=Kg,m.aQ=Qe,m.aR=oi,m.aS=function(n){var e=new re(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},m.aT=function(n,e,s){return n[0]=e[0]-s[0],n[1]=e[1]-s[1],n[2]=e[2]-s[2],n},m.aU=function(n,e){var s=e[0],h=e[1],f=e[2],y=s*s+h*h+f*f;return y>0&&(y=1/Math.sqrt(y)),n[0]=e[0]*y,n[1]=e[1]*y,n[2]=e[2]*y,n},m.aV=wi,m.aW=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},m.aX=function(n,e,s){return n[0]=e[0]*s[0],n[1]=e[1]*s[1],n[2]=e[2]*s[2],n[3]=e[3]*s[3],n},m.aY=ri,m.aZ=function(n,e,s){const h=e[0]*s[0]+e[1]*s[1]+e[2]*s[2];return h===0?null:(-(n[0]*s[0]+n[1]*s[1]+n[2]*s[2])-s[3])/h},m.a_=Ii,m.aa=ho,m.ab=t_,m.ac=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,h,f,y)=>{const v=f||y;return e[h]=!v||v.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e},m.ad=Vi,m.ae=function(n){return Math.pow(2,n)},m.af=_e,m.ag=ae,m.ah=85.051129,m.ai=Hg,m.aj=function(n){return Math.log(n)/Math.LN2},m.ak=function(n){var e=n[0],s=n[1];return e*e+s*s},m.al=function(n,e){const s=[];for(const h in n)h in e||s.push(h);return s},m.am=function(n,e){let s=0,h=0;if(n.kind==="constant")h=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:f,minZoom:y,maxZoom:v}=n,w=f?ae(Ir.interpolationFactor(f,e,y,v),0,1):0;n.kind==="camera"?h=Zr.number(n.minSize,n.maxSize,w):s=w}return{uSizeT:s,uSize:h}},m.ao=function(n,{uSize:e,uSizeT:s},{lowerSize:h,upperSize:f}){return n.kind==="source"?h/Dn:n.kind==="composite"?Zr.number(h/Dn,f/Dn,s):e},m.ap=function(n,e){var s=e[0],h=e[1],f=e[2],y=e[3],v=e[4],w=e[5],S=e[6],E=e[7],C=e[8],k=e[9],N=e[10],U=e[11],V=e[12],W=e[13],K=e[14],rt=e[15],_t=s*w-h*v,lt=s*S-f*v,j=s*E-y*v,H=h*S-f*w,ct=h*E-y*w,Et=f*E-y*S,Ut=C*W-k*V,Rt=C*K-N*V,kt=C*rt-U*V,Zt=k*K-N*W,$t=k*rt-U*W,Kt=N*rt-U*K,Ft=_t*Kt-lt*$t+j*Zt+H*kt-ct*Rt+Et*Ut;return Ft?(n[0]=(w*Kt-S*$t+E*Zt)*(Ft=1/Ft),n[1]=(f*$t-h*Kt-y*Zt)*Ft,n[2]=(W*Et-K*ct+rt*H)*Ft,n[3]=(N*ct-k*Et-U*H)*Ft,n[4]=(S*kt-v*Kt-E*Rt)*Ft,n[5]=(s*Kt-f*kt+y*Rt)*Ft,n[6]=(K*j-V*Et-rt*lt)*Ft,n[7]=(C*Et-N*j+U*lt)*Ft,n[8]=(v*$t-w*kt+E*Ut)*Ft,n[9]=(h*kt-s*$t-y*Ut)*Ft,n[10]=(V*ct-W*j+rt*_t)*Ft,n[11]=(k*j-C*ct-U*_t)*Ft,n[12]=(w*Rt-v*Zt-S*Ut)*Ft,n[13]=(s*Zt-h*Rt+f*Ut)*Ft,n[14]=(W*lt-V*H-K*_t)*Ft,n[15]=(C*H-k*lt+N*_t)*Ft,n):null},m.aq=Xt,m.ar=function(n){return Math.hypot(n[0],n[1])},m.as=function(n){return n[0]=0,n[1]=0,n},m.at=function(n,e,s){return n[0]=e[0]*s,n[1]=e[1]*s,n},m.au=Xf,m.av=Ri,m.aw=function(n,e,s,h){const f=e.y-n.y,y=e.x-n.x,v=h.y-s.y,w=h.x-s.x,S=v*y-w*f;if(S===0)return null;const E=(w*(n.y-s.y)-v*(n.x-s.x))/S;return new $(n.x+E*y,n.y+E*f)},m.ax=r_,m.ay=jm,m.az=function(n){let e=1/0,s=1/0,h=-1/0,f=-1/0;for(const y of n)e=Math.min(e,y.x),s=Math.min(s,y.y),h=Math.max(h,y.x),f=Math.max(f,y.y);return[e,s,h,f]},m.b=Be,m.b$=mv,m.b0=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},m.b1=Jg,m.b2=gl,m.b3=function(n,e,s,h,f){var y,v=1/Math.tan(e/2);return n[0]=v/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,f!=null&&f!==1/0?(n[10]=(f+h)*(y=1/(h-f)),n[14]=2*f*h*y):(n[10]=-1,n[14]=-2*h),n},m.b4=function(n){var e=new re(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},m.b5=function(n,e,s){var h=Math.sin(s),f=Math.cos(s),y=e[0],v=e[1],w=e[2],S=e[3],E=e[4],C=e[5],k=e[6],N=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=y*f+E*h,n[1]=v*f+C*h,n[2]=w*f+k*h,n[3]=S*f+N*h,n[4]=E*f-y*h,n[5]=C*f-v*h,n[6]=k*f-w*h,n[7]=N*f-S*h,n},m.b6=function(n,e,s){var h=Math.sin(s),f=Math.cos(s),y=e[4],v=e[5],w=e[6],S=e[7],E=e[8],C=e[9],k=e[10],N=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=y*f+E*h,n[5]=v*f+C*h,n[6]=w*f+k*h,n[7]=S*f+N*h,n[8]=E*f-y*h,n[9]=C*f-v*h,n[10]=k*f-w*h,n[11]=N*f-S*h,n},m.b7=function(){const n=new Float32Array(16);return _e(n),n},m.b8=function(){const n=new Float64Array(16);return _e(n),n},m.b9=function(){return new Float64Array(16)},m.bA=function(n){return n[0]=0,n[1]=0,n[2]=0,n},m.bB=function(n,e,s,h){const f=Math.sqrt(n*n+e*e),y=Math.sqrt(s*s+h*h);n/=f,e/=f,s/=y,h/=y;const v=Math.acos(n*s+e*h);return-e*s+n*h>0?v:-v},m.bC=function(n,e){const s=ee(n,2*Math.PI),h=ee(e,2*Math.PI);return Math.min(Math.abs(s-h),Math.abs(s-h+2*Math.PI),Math.abs(s-h-2*Math.PI))},m.bD=function(){const n={},e=pt.$version;for(const s in pt.$root){const h=pt.$root[s];if(h.required){let f=null;f=s==="version"?e:h.type==="array"?[]:{},f!=null&&(n[s]=f)}}return n},m.bE=Dh,m.bF=gt,m.bG=function n(e,s){if(Array.isArray(e)){if(!Array.isArray(s)||e.length!==s.length)return!1;for(let h=0;h<e.length;h++)if(!n(e[h],s[h]))return!1;return!0}if(typeof e=="object"&&e!==null&&s!==null){if(typeof s!="object"||Object.keys(e).length!==Object.keys(s).length)return!1;for(const h in e)if(!n(e[h],s[h]))return!1;return!0}return e===s},m.bH=function(n){n=n.slice();const e=Object.create(null);for(let s=0;s<n.length;s++)e[n[s].id]=n[s];for(let s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=ve(n[s],e[n[s].ref]));return n},m.bI=function(n){if(n.type==="custom")return new Fv(n);switch(n.type){case"background":return new kv(n);case"circle":return new I1(n);case"color-relief":return new k1(n);case"fill":return new H1(n);case"fill-extrusion":return new rv(n);case"heatmap":return new A1(n);case"hillshade":return new D1(n);case"line":return new uv(n);case"raster":return new Ov(n);case"symbol":return new Wu(n)}},m.bJ=je,m.bK=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let s=[];try{if(!se(n.version,e.version))return[{command:"setStyle",args:[e]}];se(n.center,e.center)||s.push({command:"setCenter",args:[e.center]}),se(n.state,e.state)||s.push({command:"setGlobalState",args:[e.state]}),se(n.centerAltitude,e.centerAltitude)||s.push({command:"setCenterAltitude",args:[e.centerAltitude]}),se(n.zoom,e.zoom)||s.push({command:"setZoom",args:[e.zoom]}),se(n.bearing,e.bearing)||s.push({command:"setBearing",args:[e.bearing]}),se(n.pitch,e.pitch)||s.push({command:"setPitch",args:[e.pitch]}),se(n.roll,e.roll)||s.push({command:"setRoll",args:[e.roll]}),se(n.sprite,e.sprite)||s.push({command:"setSprite",args:[e.sprite]}),se(n.glyphs,e.glyphs)||s.push({command:"setGlyphs",args:[e.glyphs]}),se(n.transition,e.transition)||s.push({command:"setTransition",args:[e.transition]}),se(n.light,e.light)||s.push({command:"setLight",args:[e.light]}),se(n.terrain,e.terrain)||s.push({command:"setTerrain",args:[e.terrain]}),se(n.sky,e.sky)||s.push({command:"setSky",args:[e.sky]}),se(n.projection,e.projection)||s.push({command:"setProjection",args:[e.projection]});const h={},f=[];(function(v,w,S,E){let C;for(C in w=w||{},v=v||{})Object.prototype.hasOwnProperty.call(v,C)&&(Object.prototype.hasOwnProperty.call(w,C)||fi(C,S,E));for(C in w)Object.prototype.hasOwnProperty.call(w,C)&&(Object.prototype.hasOwnProperty.call(v,C)?se(v[C],w[C])||(v[C].type==="geojson"&&w[C].type==="geojson"&&ti(v,w,C)?ge(S,{command:"setGeoJSONSourceData",args:[C,w[C].data]}):hi(C,w,S,E)):Te(C,w,S))})(n.sources,e.sources,f,h);const y=[];n.layers&&n.layers.forEach(v=>{"source"in v&&h[v.source]?s.push({command:"removeLayer",args:[v.id]}):y.push(v)}),s=s.concat(f),function(v,w,S){w=w||[];const E=(v=v||[]).map(qe),C=w.map(qe),k=v.reduce(qi,{}),N=w.reduce(qi,{}),U=E.slice(),V=Object.create(null);let W,K,rt,_t,lt;for(let j=0,H=0;j<E.length;j++)W=E[j],Object.prototype.hasOwnProperty.call(N,W)?H++:(ge(S,{command:"removeLayer",args:[W]}),U.splice(U.indexOf(W,H),1));for(let j=0,H=0;j<C.length;j++)W=C[C.length-1-j],U[U.length-1-j]!==W&&(Object.prototype.hasOwnProperty.call(k,W)?(ge(S,{command:"removeLayer",args:[W]}),U.splice(U.lastIndexOf(W,U.length-H),1)):H++,_t=U[U.length-j],ge(S,{command:"addLayer",args:[N[W],_t]}),U.splice(U.length-j,0,W),V[W]=!0);for(let j=0;j<C.length;j++)if(W=C[j],K=k[W],rt=N[W],!V[W]&&!se(K,rt))if(se(K.source,rt.source)&&se(K["source-layer"],rt["source-layer"])&&se(K.type,rt.type)){for(lt in be(K.layout,rt.layout,S,W,null,"setLayoutProperty"),be(K.paint,rt.paint,S,W,null,"setPaintProperty"),se(K.filter,rt.filter)||ge(S,{command:"setFilter",args:[W,rt.filter]}),se(K.minzoom,rt.minzoom)&&se(K.maxzoom,rt.maxzoom)||ge(S,{command:"setLayerZoomRange",args:[W,rt.minzoom,rt.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?be(K[lt],rt[lt],S,W,lt.slice(6),"setPaintProperty"):se(K[lt],rt[lt])||ge(S,{command:"setLayerProperty",args:[W,lt,rt[lt]]}));for(lt in rt)Object.prototype.hasOwnProperty.call(rt,lt)&&!Object.prototype.hasOwnProperty.call(K,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?be(K[lt],rt[lt],S,W,lt.slice(6),"setPaintProperty"):se(K[lt],rt[lt])||ge(S,{command:"setLayerProperty",args:[W,lt,rt[lt]]}))}else ge(S,{command:"removeLayer",args:[W]}),_t=U[U.lastIndexOf(W)+1],ge(S,{command:"addLayer",args:[rt,_t]})}(y,e.layers,s)}catch(h){console.warn("Unable to compute style diff:",h),s=[{command:"setStyle",args:[e]}]}return s},m.bL=function(n){const e=[],s=n.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},m.bM=oe,m.bN=Ce,m.bO=class extends Pi{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},m.bP=Ou,m.bQ=class extends Pi{constructor(n,e){super(n,e),this.current=wf}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},m.bR=Qi,m.bS=class extends Pi{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},m.bT=class extends Pi{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},m.bU=Ie,m.bV=function(n,e){var s=Math.sin(e),h=Math.cos(e);return n[0]=h,n[1]=s,n[2]=0,n[3]=-s,n[4]=h,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},m.bW=function(n,e,s){var h=e[0],f=e[1],y=e[2];return n[0]=h*s[0]+f*s[3]+y*s[6],n[1]=h*s[1]+f*s[4]+y*s[7],n[2]=h*s[2]+f*s[5]+y*s[8],n},m.bX=function(n,e,s,h,f,y,v){var w=1/(e-s),S=1/(h-f),E=1/(y-v);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*S,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(e+s)*w,n[13]=(f+h)*S,n[14]=(v+y)*E,n[15]=1,n},m.bY=class extends Pi{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let s=0;s<n.length;s++)e[4*s]=n[s].r,e[4*s+1]=n[s].g,e[4*s+2]=n[s].b,e[4*s+3]=n[s].a;this.gl.uniform4fv(this.location,e)}}},m.bZ=class extends Pi{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},m.b_=class extends c{},m.ba=function(n,e,s){const h=new Float64Array(4);return qt(h,n,e-90,s),h},m.bb=function(n,e,s,h){var f,y,v,w,S,E=e[0],C=e[1],k=e[2],N=e[3],U=s[0],V=s[1],W=s[2],K=s[3];return(y=E*U+C*V+k*W+N*K)<0&&(y=-y,U=-U,V=-V,W=-W,K=-K),1-y>Gt?(f=Math.acos(y),v=Math.sin(f),w=Math.sin((1-h)*f)/v,S=Math.sin(h*f)/v):(w=1-h,S=h),n[0]=w*E+S*U,n[1]=w*C+S*V,n[2]=w*k+S*W,n[3]=w*N+S*K,n},m.bc=function(n){const e=new Float64Array(9);var s,h,f,y,v,w,S,E,C,k,N,U,V,W,K,rt,_t,lt;k=(f=(h=n)[0])*(S=f+f),N=(y=h[1])*S,V=(v=h[2])*S,W=v*(E=y+y),rt=(w=h[3])*S,_t=w*E,lt=w*(C=v+v),(s=e)[0]=1-(U=y*E)-(K=v*C),s[3]=N-lt,s[6]=V+_t,s[1]=N+lt,s[4]=1-k-K,s[7]=W-rt,s[2]=V-_t,s[5]=W+rt,s[8]=1-k-U;const j=xr(-Math.asin(ae(e[2],-1,1)));let H,ct;return Math.hypot(e[5],e[8])<.001?(H=0,ct=-xr(Math.atan2(e[3],e[4]))):(H=xr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),ct=xr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:H,pitch:j+90,bearing:ct}},m.bd=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},m.be=Ke,m.bf=Rr,m.bg=fl,m.bh=Jh,m.bi=dl,m.bj=de,m.bk=Ee,m.bl=Fe,m.bm=function(n,e,s,h,f){return de(h,f,ae((n-e)/(s-e),0,1))},m.bn=ee,m.bo=function(){return new Float64Array(3)},m.bp=function(n,e,s,h){return n[0]=e[0]+s[0]*h,n[1]=e[1]+s[1]*h,n[2]=e[2]+s[2]*h,n},m.bq=qt,m.br=function(n,e,s){var h=s[0],f=s[1],y=s[2],v=e[0],w=e[1],S=e[2],E=f*S-y*w,C=y*v-h*S,k=h*w-f*v,N=f*k-y*C,U=y*E-h*k,V=h*C-f*E,W=2*s[3];return C*=W,k*=W,U*=2,V*=2,n[0]=v+(E*=W)+(N*=2),n[1]=w+C+U,n[2]=S+k+V,n},m.bs=function(n,e,s){const h=(f=[n[0],n[1],n[2],e[0],e[1],e[2],s[0],s[1],s[2]])[0]*((C=f[8])*(v=f[4])-(w=f[5])*(E=f[7]))+f[1]*(-C*(y=f[3])+w*(S=f[6]))+f[2]*(E*y-v*S);var f,y,v,w,S,E,C;if(h===0)return null;const k=wi([],[e[0],e[1],e[2]],[s[0],s[1],s[2]]),N=wi([],[s[0],s[1],s[2]],[n[0],n[1],n[2]]),U=wi([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),V=Qe([],k,-n[3]);return oi(V,V,Qe([],N,-e[3])),oi(V,V,Qe([],U,-s[3])),Qe(V,V,1/h),V},m.bt=Jf,m.bu=function(){return new Float64Array(4)},m.bv=function(n,e,s,h){var f=[],y=[];return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],y[0]=f[0]*Math.cos(h)-f[1]*Math.sin(h),y[1]=f[0]*Math.sin(h)+f[1]*Math.cos(h),y[2]=f[2],n[0]=y[0]+s[0],n[1]=y[1]+s[1],n[2]=y[2]+s[2],n},m.bw=function(n,e,s,h){var f=[],y=[];return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],y[0]=f[0],y[1]=f[1]*Math.cos(h)-f[2]*Math.sin(h),y[2]=f[1]*Math.sin(h)+f[2]*Math.cos(h),n[0]=y[0]+s[0],n[1]=y[1]+s[1],n[2]=y[2]+s[2],n},m.bx=function(n,e,s,h){var f=[],y=[];return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],y[0]=f[2]*Math.sin(h)+f[0]*Math.cos(h),y[1]=f[1],y[2]=f[2]*Math.cos(h)-f[0]*Math.sin(h),n[0]=y[0]+s[0],n[1]=y[1]+s[1],n[2]=y[2]+s[2],n},m.by=function(n,e,s){var h=Math.sin(s),f=Math.cos(s),y=e[0],v=e[1],w=e[2],S=e[3],E=e[8],C=e[9],k=e[10],N=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=y*f-E*h,n[1]=v*f-C*h,n[2]=w*f-k*h,n[3]=S*f-N*h,n[8]=y*h+E*f,n[9]=v*h+C*f,n[10]=w*h+k*f,n[11]=S*h+N*f,n},m.bz=function(n,e){const s=ee(n,360),h=ee(e,360),f=h-s,y=h>s?f-360:f+360;return Math.abs(f)<Math.abs(y)?f:y},m.c=yt,m.c0=class extends _{},m.c1=If,m.c2=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},m.c3=Ym,m.c4=function(n,e,s){var h=e[0],f=e[1],y=e[2],v=s[3]*h+s[7]*f+s[11]*y+s[15];return n[0]=(s[0]*h+s[4]*f+s[8]*y+s[12])/(v=v||1),n[1]=(s[1]*h+s[5]*f+s[9]*y+s[13])/v,n[2]=(s[2]*h+s[6]*f+s[10]*y+s[14])/v,n},m.c5=class extends Nh{},m.c6=class extends O{},m.c7=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},m.c8=function(n,e){var s=n[0],h=n[1],f=n[2],y=n[3],v=n[4],w=n[5],S=n[6],E=n[7],C=n[8],k=n[9],N=n[10],U=n[11],V=n[12],W=n[13],K=n[14],rt=n[15],_t=e[0],lt=e[1],j=e[2],H=e[3],ct=e[4],Et=e[5],Ut=e[6],Rt=e[7],kt=e[8],Zt=e[9],$t=e[10],Kt=e[11],Ft=e[12],ce=e[13],xe=e[14],ye=e[15];return Math.abs(s-_t)<=Gt*Math.max(1,Math.abs(s),Math.abs(_t))&&Math.abs(h-lt)<=Gt*Math.max(1,Math.abs(h),Math.abs(lt))&&Math.abs(f-j)<=Gt*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(y-H)<=Gt*Math.max(1,Math.abs(y),Math.abs(H))&&Math.abs(v-ct)<=Gt*Math.max(1,Math.abs(v),Math.abs(ct))&&Math.abs(w-Et)<=Gt*Math.max(1,Math.abs(w),Math.abs(Et))&&Math.abs(S-Ut)<=Gt*Math.max(1,Math.abs(S),Math.abs(Ut))&&Math.abs(E-Rt)<=Gt*Math.max(1,Math.abs(E),Math.abs(Rt))&&Math.abs(C-kt)<=Gt*Math.max(1,Math.abs(C),Math.abs(kt))&&Math.abs(k-Zt)<=Gt*Math.max(1,Math.abs(k),Math.abs(Zt))&&Math.abs(N-$t)<=Gt*Math.max(1,Math.abs(N),Math.abs($t))&&Math.abs(U-Kt)<=Gt*Math.max(1,Math.abs(U),Math.abs(Kt))&&Math.abs(V-Ft)<=Gt*Math.max(1,Math.abs(V),Math.abs(Ft))&&Math.abs(W-ce)<=Gt*Math.max(1,Math.abs(W),Math.abs(ce))&&Math.abs(K-xe)<=Gt*Math.max(1,Math.abs(K),Math.abs(xe))&&Math.abs(rt-ye)<=Gt*Math.max(1,Math.abs(rt),Math.abs(ye))},m.c9=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},m.cA=function(n){delete Z.REGISTERED_PROTOCOLS[n]},m.cB=function(n,e){const s={};for(let f=0;f<n.length;f++){const y=e&&e[n[f].id]||Ko(n[f]);e&&(e[n[f].id]=y);let v=s[y];v||(v=s[y]=[]),v.push(n[f])}const h=[];for(const f in s)h.push(s[f]);return h},m.cC=ne,m.cD=Qg,m.cE=e_,m.cF=Rg,m.cG=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Mt/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],s=e.layout,h=e._unevaluatedLayout._values,f={layoutIconSize:h["icon-size"].possiblyEvaluate(new Ci(n.bucket.zoom+1),n.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new Ci(n.bucket.zoom+1),n.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new Ci(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:C}=n.bucket.textSizeData;f.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Ci(E),n.canonical),h["text-size"].possiblyEvaluate(new Ci(C),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:C}=n.bucket.iconSizeData;f.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Ci(E),n.canonical),h["icon-size"].possiblyEvaluate(new Ci(C),n.canonical)]}const y=s.get("text-line-height")*or,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),S=s.get("text-size");for(const E of n.bucket.features){const C=s.get("text-font").evaluate(E,{},n.canonical).join(","),k=S.evaluate(E,{},n.canonical),N=f.layoutTextSize.evaluate(E,{},n.canonical),U=f.layoutIconSize.evaluate(E,{},n.canonical),V={horizontal:{},vertical:void 0},W=E.text;let K,rt=[0,0];if(W){const j=W.toString(),H=s.get("text-letter-spacing").evaluate(E,{},n.canonical)*or,ct=Cu(j)?H:0,Et=s.get("text-anchor").evaluate(E,{},n.canonical),Ut=d_(e,E,n.canonical);if(!Ut){const $t=s.get("text-radial-offset").evaluate(E,{},n.canonical);rt=$t?u_(Et,[$t*or,ep]):s.get("text-offset").evaluate(E,{},n.canonical).map(Kt=>Kt*or)}let Rt=v?"center":s.get("text-justify").evaluate(E,{},n.canonical);const kt=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(E,{},n.canonical)*or:1/0,Zt=()=>{n.bucket.allowVerticalPlacement&&zh(j)&&(V.vertical=$u(W,n.glyphMap,n.glyphPositions,n.imagePositions,C,kt,y,Et,"left",ct,rt,m.an.vertical,!0,N,k))};if(!v&&Ut){const $t=new Set;if(Rt==="auto")for(let Ft=0;Ft<Ut.values.length;Ft+=2)$t.add(ip(Ut.values[Ft]));else $t.add(Rt);let Kt=!1;for(const Ft of $t)if(!V.horizontal[Ft])if(Kt)V.horizontal[Ft]=V.horizontal[0];else{const ce=$u(W,n.glyphMap,n.glyphPositions,n.imagePositions,C,kt,y,"center",Ft,ct,rt,m.an.horizontal,!1,N,k);ce&&(V.horizontal[Ft]=ce,Kt=ce.positionedLines.length===1)}Zt()}else{Rt==="auto"&&(Rt=ip(Et));const $t=$u(W,n.glyphMap,n.glyphPositions,n.imagePositions,C,kt,y,Et,Rt,ct,rt,m.an.horizontal,!1,N,k);$t&&(V.horizontal[Rt]=$t),Zt(),zh(j)&&v&&w&&(V.vertical=$u(W,n.glyphMap,n.glyphPositions,n.imagePositions,C,kt,y,Et,Rt,ct,rt,m.an.vertical,!1,N,k))}}let _t=!1;if(E.icon&&E.icon.name){const j=n.imageMap[E.icon.name];j&&(K=Cv(n.imagePositions[E.icon.name],s.get("icon-offset").evaluate(E,{},n.canonical),s.get("icon-anchor").evaluate(E,{},n.canonical)),_t=!!j.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=_t:n.bucket.sdfIcons!==_t&&De("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==n.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const lt=p_(V.horizontal)||V.vertical;n.bucket.iconsInText=!!lt&&lt.iconsInText,(lt||K)&&Zv(n.bucket,E,V,K,n.imageMap,f,N,U,rt,_t,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},m.cH=Gf,m.cI=kf,m.cJ=Nf,m.cK=tc,m.cL=Vf,m.cM=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},m.cN=function(n,e,s,h,f){return o(this,void 0,void 0,function*(){if(jt())try{return yield Ae(n,e,s,h,f)}catch{}return function(y,v,w,S,E){const C=y.width,k=y.height;ci&&Ti||(ci=new OffscreenCanvas(C,k),Ti=ci.getContext("2d",{willReadFrequently:!0})),ci.width=C,ci.height=k,Ti.drawImage(y,0,0,C,k);const N=Ti.getImageData(v,w,S,E);return Ti.clearRect(0,0,C,k),N.data}(n,e,s,h,f)})},m.cO=tg,m.cP=P,m.cQ=z,m.cR=_g,m.cS=Cg,m.cT=Zo,m.cU=Qs,m.ca=n=>n.type==="symbol",m.cb=n=>n.type==="circle",m.cc=n=>n.type==="heatmap",m.cd=n=>n.type==="line",m.ce=n=>n.type==="fill",m.cf=n=>n.type==="fill-extrusion",m.cg=n=>n.type==="hillshade",m.ch=n=>n.type==="color-relief",m.ci=n=>n.type==="raster",m.cj=n=>n.type==="background",m.ck=n=>n.type==="custom",m.cl=me,m.cm=function(n,e,s){const h=Dt(e.x-s.x,e.y-s.y),f=Dt(n.x-s.x,n.y-s.y);var y,v;return xr(Math.atan2(h[0]*f[1]-h[1]*f[0],(y=h)[0]*(v=f)[0]+y[1]*v[1]))},m.cn=Ge,m.co=function(n,e){return ni[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},m.cp=function(n,e){return br[e]&&"touches"in n},m.cq=function(n){return br[n]||ni[n]},m.cr=function(n,e,s){var h=e[0],f=e[1];return n[0]=s[0]*h+s[4]*f+s[12],n[1]=s[1]*h+s[5]*f+s[13],n},m.cs=function(n,e){const{x:s,y:h}=nc.fromLngLat(e);return!(n<0||n>25||h<0||h>=1||s<0||s>=1)},m.ct=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},m.cu=class extends en{},m.cv=Xv,m.cx=function(n){return n.message===Di},m.cy=at,m.cz=function(n,e){Z.REGISTERED_PROTOCOLS[n]=e},m.d=Tt,m.e=ze,m.f=n=>o(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.g=X,m.h=n=>new Promise((e,s)=>{const h=new Image;h.onload=()=>{e(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=Ne})},h.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(n)],{type:"image/png"});h.src=n.byteLength?URL.createObjectURL(f):Ne}),m.i=Ze,m.j=(n,e)=>bt(ze(n,{type:"json"}),e),m.k=wt,m.l=At,m.m=bt,m.n=(n,e)=>bt(ze(n,{type:"arrayBuffer"}),e),m.o=function(n){return new Vf(n).readFields(yv,[])},m.p=Ag,m.q=Wh,m.r=Ar,m.s=ir,m.t=Fh,m.u=Je,m.v=pt,m.w=De,m.x=gf,m.y=Ya,m.z=oa}),p("worker",["./shared"],function(m){class o{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,X){for(const at of Z){this._layerConfigs[at.id]=at;const gt=this._layers[at.id]=m.bI(at);gt._featureFilter=m.a9(gt.filter),this.keyCache[at.id]&&delete this.keyCache[at.id]}for(const at of X)delete this.keyCache[at],delete this._layerConfigs[at],delete this._layers[at];this.familiesBySource={};const Y=m.cB(Object.values(this._layerConfigs),this.keyCache);for(const at of Y){const gt=at.map(wt=>this._layers[wt.id]),bt=gt[0];if(bt.visibility==="none")continue;const Tt=bt.source||"";let vt=this.familiesBySource[Tt];vt||(vt=this.familiesBySource[Tt]={});const zt=bt.sourceLayer||"_geojsonTileLayer";let At=vt[zt];At||(At=vt[zt]=[]),At.push(gt)}}}class P{constructor(Z){const X={},Y=[];for(const Tt in Z){const vt=Z[Tt],zt=X[Tt]={};for(const At in vt){const wt=vt[+At];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;const Bt={x:0,y:0,w:wt.bitmap.width+2,h:wt.bitmap.height+2};Y.push(Bt),zt[At]={rect:Bt,metrics:wt.metrics}}}const{w:at,h:gt}=m.p(Y),bt=new m.q({width:at||1,height:gt||1});for(const Tt in Z){const vt=Z[Tt];for(const zt in vt){const At=vt[+zt];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const wt=X[Tt][zt].rect;m.q.copy(At.bitmap,bt,{x:0,y:0},{x:wt.x+1,y:wt.y+1},At.bitmap)}}this.image=bt,this.positions=X}}m.cC("GlyphAtlas",P);class A{constructor(Z){this.tileID=new m.Z(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId,this.inFlightDependencies=[],this.globalState=Z.globalState}parse(Z,X,Y,at,gt){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=Z,this.collisionBoxArray=new m.a7;const bt=new m.cD(Object.keys(Z.layers).sort()),Tt=new m.cE(this.tileID,this.promoteId);Tt.bucketLayerIDs=[];const vt={},zt={featureIndex:Tt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y,subdivisionGranularity:gt},At=X.familiesBySource[this.source];for(const be in At){const qe=Z.layers[be];if(!qe)continue;qe.version===1&&m.w(`Vector tile source "${this.source}" layer "${be}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const qi=bt.encode(be),Ht=[];for(let Hi=0;Hi<qe.length;Hi++){const Mi=qe.feature(Hi),Fr=Tt.getId(Mi,be);Ht.push({feature:Mi,id:Fr,index:Hi,sourceLayerIndex:qi})}for(const Hi of At[be]){const Mi=Hi[0];Mi.source!==this.source&&m.w(`layer.source = ${Mi.source} does not equal this.source = ${this.source}`),Mi.minzoom&&this.zoom<Math.floor(Mi.minzoom)||Mi.maxzoom&&this.zoom>=Mi.maxzoom||Mi.visibility!=="none"&&(L(Hi,this.zoom,Y),(vt[Mi.id]=Mi.createBucket({index:Tt.bucketLayerIDs.length,layers:Hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qi,sourceID:this.source,globalState:this.globalState})).populate(Ht,zt,this.tileID.canonical),Tt.bucketLayerIDs.push(Hi.map(Fr=>Fr.id)))}}const wt=m.bM(zt.glyphDependencies,be=>Object.keys(be).map(Number));this.inFlightDependencies.forEach(be=>be==null?void 0:be.abort()),this.inFlightDependencies=[];let Bt=Promise.resolve({});if(Object.keys(wt).length){const be=new AbortController;this.inFlightDependencies.push(be),Bt=at.sendAsync({type:"GG",data:{stacks:wt,source:this.source,tileID:this.tileID,type:"glyphs"}},be)}const pt=Object.keys(zt.iconDependencies);let ie=Promise.resolve({});if(pt.length){const be=new AbortController;this.inFlightDependencies.push(be),ie=at.sendAsync({type:"GI",data:{icons:pt,source:this.source,tileID:this.tileID,type:"icons"}},be)}const ve=Object.keys(zt.patternDependencies);let se=Promise.resolve({});if(ve.length){const be=new AbortController;this.inFlightDependencies.push(be),se=at.sendAsync({type:"GI",data:{icons:ve,source:this.source,tileID:this.tileID,type:"patterns"}},be)}const[ge,Te,fi]=yield Promise.all([Bt,ie,se]),hi=new P(ge),ti=new m.cF(Te,fi);for(const be in vt){const qe=vt[be];qe instanceof m.a8?(L(qe.layers,this.zoom,Y),m.cG({bucket:qe,glyphMap:ge,glyphPositions:hi.positions,imageMap:Te,imagePositions:ti.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:zt.subdivisionGranularity})):qe.hasPattern&&(qe instanceof m.cH||qe instanceof m.cI||qe instanceof m.cJ)&&(L(qe.layers,this.zoom,Y),qe.addFeatures(zt,this.tileID.canonical,ti.patternPositions))}return this.status="done",{buckets:Object.values(vt).filter(be=>!be.isEmpty()),featureIndex:Tt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hi.image,imageAtlas:ti,glyphMap:this.returnDependencies?ge:null,iconMap:this.returnDependencies?Te:null,glyphPositions:this.returnDependencies?hi.positions:null}})}}function L(yt,Z,X){const Y=new m.F(Z);for(const at of yt)at.recalculate(Y,X)}class z{constructor(Z,X,Y){this.actor=Z,this.layerIndex=X,this.availableImages=Y,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Z,X){return m._(this,void 0,void 0,function*(){const Y=yield m.n(Z.request,X);try{return{vectorTile:new m.cK.VectorTile(new m.cL(Y.data)),rawData:Y.data,cacheControl:Y.cacheControl,expires:Y.expires}}catch(at){const gt=new Uint8Array(Y.data);let bt=`Unable to parse the tile at ${Z.request.url}, `;throw bt+=gt[0]===31&&gt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${at.message}`,new Error(bt)}})}loadTile(Z){return m._(this,void 0,void 0,function*(){const X=Z.uid,Y=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new m.cM(Z.request),at=new A(Z);this.loading[X]=at;const gt=new AbortController;at.abort=gt;try{const bt=yield this.loadVectorTile(Z,gt);if(delete this.loading[X],!bt)return null;const Tt=bt.rawData,vt={};bt.expires&&(vt.expires=bt.expires),bt.cacheControl&&(vt.cacheControl=bt.cacheControl);const zt={};if(Y){const wt=Y.finish();wt&&(zt.resourceTiming=JSON.parse(JSON.stringify(wt)))}at.vectorTile=bt.vectorTile;const At=at.parse(bt.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);this.loaded[X]=at,this.fetching[X]={rawTileData:Tt,cacheControl:vt,resourceTiming:zt};try{const wt=yield At;return m.e({rawTileData:Tt.slice(0)},wt,vt,zt)}finally{delete this.fetching[X]}}catch(bt){throw delete this.loading[X],at.status="done",this.loaded[X]=at,bt}})}reloadTile(Z){return m._(this,void 0,void 0,function*(){const X=Z.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Y=this.loaded[X];if(Y.showCollisionBoxes=Z.showCollisionBoxes,Y.globalState=Z.globalState,Y.status==="parsing"){const at=yield Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity);let gt;if(this.fetching[X]){const{rawTileData:bt,cacheControl:Tt,resourceTiming:vt}=this.fetching[X];delete this.fetching[X],gt=m.e({rawTileData:bt.slice(0)},at,Tt,vt)}else gt=at;return gt}if(Y.status==="done"&&Y.vectorTile)return Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,Z.subdivisionGranularity)})}abortTile(Z){return m._(this,void 0,void 0,function*(){const X=this.loading,Y=Z.uid;X&&X[Y]&&X[Y].abort&&(X[Y].abort.abort(),delete X[Y])})}removeTile(Z){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Z.uid]&&delete this.loaded[Z.uid]})}}class D{constructor(){this.loaded={}}loadTile(Z){return m._(this,void 0,void 0,function*(){const{uid:X,encoding:Y,rawImageData:at,redFactor:gt,greenFactor:bt,blueFactor:Tt,baseShift:vt}=Z,zt=at.width+2,At=at.height+2,wt=m.b(at)?new m.R({width:zt,height:At},yield m.cN(at,-1,-1,zt,At)):at,Bt=new m.cO(X,wt,Y,gt,bt,Tt,vt);return this.loaded=this.loaded||{},this.loaded[X]=Bt,Bt})}removeTile(Z){const X=this.loaded,Y=Z.uid;X&&X[Y]&&delete X[Y]}}var B,$,et=function(){if($)return B;function yt(X,Y){if(X.length!==0){Z(X[0],Y);for(var at=1;at<X.length;at++)Z(X[at],!Y)}}function Z(X,Y){for(var at=0,gt=0,bt=0,Tt=X.length,vt=Tt-1;bt<Tt;vt=bt++){var zt=(X[bt][0]-X[vt][0])*(X[vt][1]+X[bt][1]),At=at+zt;gt+=Math.abs(at)>=Math.abs(zt)?at-At+zt:zt-At+at,at=At}at+gt>=0!=!!Y&&X.reverse()}return $=1,B=function X(Y,at){var gt,bt=Y&&Y.type;if(bt==="FeatureCollection")for(gt=0;gt<Y.features.length;gt++)X(Y.features[gt],at);else if(bt==="GeometryCollection")for(gt=0;gt<Y.geometries.length;gt++)X(Y.geometries[gt],at);else if(bt==="Feature")X(Y.geometry,at);else if(bt==="Polygon")yt(Y.coordinates,at);else if(bt==="MultiPolygon")for(gt=0;gt<Y.coordinates.length;gt++)yt(Y.coordinates[gt],at);return Y}}(),it=m.cP(et);const ft=m.cK.VectorTileFeature.prototype.toGeoJSON;class dt{constructor(Z){this._feature=Z,this.extent=m.$,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(this._feature.type===1){const Z=[];for(const X of this._feature.geometry)Z.push([new m.P(X[0],X[1])]);return Z}{const Z=[];for(const X of this._feature.geometry){const Y=[];for(const at of X)Y.push(new m.P(at[0],at[1]));Z.push(Y)}return Z}}toGeoJSON(Z,X,Y){return ft.call(this,Z,X,Y)}}class Ot{constructor(Z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.$,this.length=Z.length,this._features=Z}feature(Z){return new dt(this._features[Z])}}var jt,Gt,re,Ie={exports:{}},_e=function(){if(re)return Ie.exports;re=1;var yt=m.cS(),Z=function(){if(Gt)return jt;Gt=1;var At=m.cQ(),wt=m.cR().VectorTileFeature;function Bt(ie,ve){this.options=ve||{},this.features=ie,this.length=ie.length}function pt(ie,ve){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=ve||4096}return jt=Bt,Bt.prototype.feature=function(ie){return new pt(this.features[ie],this.options.extent)},pt.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var ve=0;ve<ie.length;ve++){for(var se=ie[ve],ge=[],Te=0;Te<se.length;Te++)ge.push(new At(se[Te][0],se[Te][1]));this.geometry.push(ge)}return this.geometry},pt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,ve=1/0,se=-1/0,ge=1/0,Te=-1/0,fi=0;fi<ie.length;fi++)for(var hi=ie[fi],ti=0;ti<hi.length;ti++){var be=hi[ti];ve=Math.min(ve,be.x),se=Math.max(se,be.x),ge=Math.min(ge,be.y),Te=Math.max(Te,be.y)}return[ve,ge,se,Te]},pt.prototype.toGeoJSON=wt.prototype.toGeoJSON,jt}();function X(At){var wt=new yt;return function(Bt,pt){for(var ie in Bt.layers)pt.writeMessage(3,Y,Bt.layers[ie])}(At,wt),wt.finish()}function Y(At,wt){var Bt;wt.writeVarintField(15,At.version||1),wt.writeStringField(1,At.name||""),wt.writeVarintField(5,At.extent||4096);var pt={keys:[],values:[],keycache:{},valuecache:{}};for(Bt=0;Bt<At.length;Bt++)pt.feature=At.feature(Bt),wt.writeMessage(2,at,pt);var ie=pt.keys;for(Bt=0;Bt<ie.length;Bt++)wt.writeStringField(3,ie[Bt]);var ve=pt.values;for(Bt=0;Bt<ve.length;Bt++)wt.writeMessage(4,zt,ve[Bt])}function at(At,wt){var Bt=At.feature;Bt.id!==void 0&&wt.writeVarintField(1,Bt.id),wt.writeMessage(2,gt,At),wt.writeVarintField(3,Bt.type),wt.writeMessage(4,vt,Bt)}function gt(At,wt){var Bt=At.feature,pt=At.keys,ie=At.values,ve=At.keycache,se=At.valuecache;for(var ge in Bt.properties){var Te=Bt.properties[ge],fi=ve[ge];if(Te!==null){fi===void 0&&(pt.push(ge),ve[ge]=fi=pt.length-1),wt.writeVarint(fi);var hi=typeof Te;hi!=="string"&&hi!=="boolean"&&hi!=="number"&&(Te=JSON.stringify(Te));var ti=hi+":"+Te,be=se[ti];be===void 0&&(ie.push(Te),se[ti]=be=ie.length-1),wt.writeVarint(be)}}}function bt(At,wt){return(wt<<3)+(7&At)}function Tt(At){return At<<1^At>>31}function vt(At,wt){for(var Bt=At.loadGeometry(),pt=At.type,ie=0,ve=0,se=Bt.length,ge=0;ge<se;ge++){var Te=Bt[ge],fi=1;pt===1&&(fi=Te.length),wt.writeVarint(bt(1,fi));for(var hi=pt===3?Te.length-1:Te.length,ti=0;ti<hi;ti++){ti===1&&pt!==1&&wt.writeVarint(bt(2,hi-1));var be=Te[ti].x-ie,qe=Te[ti].y-ve;wt.writeVarint(Tt(be)),wt.writeVarint(Tt(qe)),ie+=be,ve+=qe}pt===3&&wt.writeVarint(bt(7,1))}}function zt(At,wt){var Bt=typeof At;Bt==="string"?wt.writeStringField(1,At):Bt==="boolean"?wt.writeBooleanField(7,At):Bt==="number"&&(At%1!=0?wt.writeDoubleField(3,At):At<0?wt.writeSVarintField(6,At):wt.writeVarintField(5,At))}return Ie.exports=X,Ie.exports.fromVectorTileJs=X,Ie.exports.fromGeojsonVt=function(At,wt){wt=wt||{};var Bt={};for(var pt in At)Bt[pt]=new Z(At[pt].features,wt),Bt[pt].name=pt,Bt[pt].version=wt.version,Bt[pt].extent=wt.extent;return X({layers:Bt})},Ie.exports.GeoJSONWrapper=Z,Ie.exports}(),Re=m.cP(_e);const ri={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:yt=>yt},$e=Math.fround||(oi=new Float32Array(1),yt=>(oi[0]=+yt,oi[0]));var oi;class Qe{constructor(Z){this.options=Object.assign(Object.create(ri),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:X,minZoom:Y,maxZoom:at}=this.options;X&&console.time("total time");const gt=`prepare ${Z.length} points`;X&&console.time(gt),this.points=Z;const bt=[];for(let vt=0;vt<Z.length;vt++){const zt=Z[vt];if(!zt.geometry)continue;const[At,wt]=zt.geometry.coordinates,Bt=$e(Ii(At)),pt=$e(Ri(wt));bt.push(Bt,pt,1/0,vt,-1,1),this.options.reduce&&bt.push(0)}let Tt=this.trees[at+1]=this._createTree(bt);X&&console.timeEnd(gt);for(let vt=at;vt>=Y;vt--){const zt=+Date.now();Tt=this.trees[vt]=this._createTree(this._cluster(Tt,vt)),X&&console.log("z%d: %d clusters in %dms",vt,Tt.numItems,+Date.now()-zt)}return X&&console.timeEnd("total time"),this}getClusters(Z,X){let Y=((Z[0]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,Z[1]));let gt=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const bt=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)Y=-180,gt=180;else if(Y>gt){const wt=this.getClusters([Y,at,180,bt],X),Bt=this.getClusters([-180,at,gt,bt],X);return wt.concat(Bt)}const Tt=this.trees[this._limitZoom(X)],vt=Tt.range(Ii(Y),Ri(bt),Ii(gt),Ri(at)),zt=Tt.data,At=[];for(const wt of vt){const Bt=this.stride*wt;At.push(zt[Bt+5]>1?wi(zt,Bt,this.clusterProps):this.points[zt[Bt+3]])}return At}getChildren(Z){const X=this._getOriginId(Z),Y=this._getOriginZoom(Z),at="No cluster with the specified id.",gt=this.trees[Y];if(!gt)throw new Error(at);const bt=gt.data;if(X*this.stride>=bt.length)throw new Error(at);const Tt=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),vt=gt.within(bt[X*this.stride],bt[X*this.stride+1],Tt),zt=[];for(const At of vt){const wt=At*this.stride;bt[wt+4]===Z&&zt.push(bt[wt+5]>1?wi(bt,wt,this.clusterProps):this.points[bt[wt+3]])}if(zt.length===0)throw new Error(at);return zt}getLeaves(Z,X,Y){const at=[];return this._appendLeaves(at,Z,X=X||10,Y=Y||0,0),at}getTile(Z,X,Y){const at=this.trees[this._limitZoom(Z)],gt=Math.pow(2,Z),{extent:bt,radius:Tt}=this.options,vt=Tt/bt,zt=(Y-vt)/gt,At=(Y+1+vt)/gt,wt={features:[]};return this._addTileFeatures(at.range((X-vt)/gt,zt,(X+1+vt)/gt,At),at.data,X,Y,gt,wt),X===0&&this._addTileFeatures(at.range(1-vt/gt,zt,1,At),at.data,gt,Y,gt,wt),X===gt-1&&this._addTileFeatures(at.range(0,zt,vt/gt,At),at.data,-1,Y,gt,wt),wt.features.length?wt:null}getClusterExpansionZoom(Z){let X=this._getOriginZoom(Z)-1;for(;X<=this.options.maxZoom;){const Y=this.getChildren(Z);if(X++,Y.length!==1)break;Z=Y[0].properties.cluster_id}return X}_appendLeaves(Z,X,Y,at,gt){const bt=this.getChildren(X);for(const Tt of bt){const vt=Tt.properties;if(vt&&vt.cluster?gt+vt.point_count<=at?gt+=vt.point_count:gt=this._appendLeaves(Z,vt.cluster_id,Y,at,gt):gt<at?gt++:Z.push(Tt),Z.length===Y)break}return gt}_createTree(Z){const X=new m.aH(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<Z.length;Y+=this.stride)X.add(Z[Y],Z[Y+1]);return X.finish(),X.data=Z,X}_addTileFeatures(Z,X,Y,at,gt,bt){for(const Tt of Z){const vt=Tt*this.stride,zt=X[vt+5]>1;let At,wt,Bt;if(zt)At=li(X,vt,this.clusterProps),wt=X[vt],Bt=X[vt+1];else{const ve=this.points[X[vt+3]];At=ve.properties;const[se,ge]=ve.geometry.coordinates;wt=Ii(se),Bt=Ri(ge)}const pt={type:1,geometry:[[Math.round(this.options.extent*(wt*gt-Y)),Math.round(this.options.extent*(Bt*gt-at))]],tags:At};let ie;ie=zt||this.options.generateId?X[vt+3]:this.points[X[vt+3]].id,ie!==void 0&&(pt.id=ie),bt.features.push(pt)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,X){const{radius:Y,extent:at,reduce:gt,minPoints:bt}=this.options,Tt=Y/(at*Math.pow(2,X)),vt=Z.data,zt=[],At=this.stride;for(let wt=0;wt<vt.length;wt+=At){if(vt[wt+2]<=X)continue;vt[wt+2]=X;const Bt=vt[wt],pt=vt[wt+1],ie=Z.within(vt[wt],vt[wt+1],Tt),ve=vt[wt+5];let se=ve;for(const ge of ie){const Te=ge*At;vt[Te+2]>X&&(se+=vt[Te+5])}if(se>ve&&se>=bt){let ge,Te=Bt*ve,fi=pt*ve,hi=-1;const ti=(wt/At<<5)+(X+1)+this.points.length;for(const be of ie){const qe=be*At;if(vt[qe+2]<=X)continue;vt[qe+2]=X;const qi=vt[qe+5];Te+=vt[qe]*qi,fi+=vt[qe+1]*qi,vt[qe+4]=ti,gt&&(ge||(ge=this._map(vt,wt,!0),hi=this.clusterProps.length,this.clusterProps.push(ge)),gt(ge,this._map(vt,qe)))}vt[wt+4]=ti,zt.push(Te/se,fi/se,1/0,ti,-1,se),gt&&zt.push(hi)}else{for(let ge=0;ge<At;ge++)zt.push(vt[wt+ge]);if(se>1)for(const ge of ie){const Te=ge*At;if(!(vt[Te+2]<=X)){vt[Te+2]=X;for(let fi=0;fi<At;fi++)zt.push(vt[Te+fi])}}}}return zt}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,X,Y){if(Z[X+5]>1){const bt=this.clusterProps[Z[X+6]];return Y?Object.assign({},bt):bt}const at=this.points[Z[X+3]].properties,gt=this.options.map(at);return Y&&gt===at?Object.assign({},gt):gt}}function wi(yt,Z,X){return{type:"Feature",id:yt[Z+3],properties:li(yt,Z,X),geometry:{type:"Point",coordinates:[(Y=yt[Z],360*(Y-.5)),Nt(yt[Z+1])]}};var Y}function li(yt,Z,X){const Y=yt[Z+5],at=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,gt=yt[Z+6],bt=gt===-1?{}:Object.assign({},X[gt]);return Object.assign(bt,{cluster:!0,cluster_id:yt[Z+3],point_count:Y,point_count_abbreviated:at})}function Ii(yt){return yt/360+.5}function Ri(yt){const Z=Math.sin(yt*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function Nt(yt){const Z=(180-360*yt)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function qt(yt,Z,X,Y){let at=Y;const gt=Z+(X-Z>>1);let bt,Tt=X-Z;const vt=yt[Z],zt=yt[Z+1],At=yt[X],wt=yt[X+1];for(let Bt=Z+3;Bt<X;Bt+=3){const pt=Xt(yt[Bt],yt[Bt+1],vt,zt,At,wt);if(pt>at)bt=Bt,at=pt;else if(pt===at){const ie=Math.abs(Bt-gt);ie<Tt&&(bt=Bt,Tt=ie)}}at>Y&&(bt-Z>3&&qt(yt,Z,bt,Y),yt[bt+2]=at,X-bt>3&&qt(yt,bt,X,Y))}function Xt(yt,Z,X,Y,at,gt){let bt=at-X,Tt=gt-Y;if(bt!==0||Tt!==0){const vt=((yt-X)*bt+(Z-Y)*Tt)/(bt*bt+Tt*Tt);vt>1?(X=at,Y=gt):vt>0&&(X+=bt*vt,Y+=Tt*vt)}return bt=yt-X,Tt=Z-Y,bt*bt+Tt*Tt}function Dt(yt,Z,X,Y){const at={id:yt??null,type:Z,geometry:X,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Z==="Point"||Z==="MultiPoint"||Z==="LineString")Mt(at,X);else if(Z==="Polygon")Mt(at,X[0]);else if(Z==="MultiLineString")for(const gt of X)Mt(at,gt);else if(Z==="MultiPolygon")for(const gt of X)Mt(at,gt[0]);return at}function Mt(yt,Z){for(let X=0;X<Z.length;X+=3)yt.minX=Math.min(yt.minX,Z[X]),yt.minY=Math.min(yt.minY,Z[X+1]),yt.maxX=Math.max(yt.maxX,Z[X]),yt.maxY=Math.max(yt.maxY,Z[X+1])}function Lt(yt,Z,X,Y){if(!Z.geometry)return;const at=Z.geometry.coordinates;if(at&&at.length===0)return;const gt=Z.geometry.type,bt=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let Tt=[],vt=Z.id;if(X.promoteId?vt=Z.properties[X.promoteId]:X.generateId&&(vt=Y||0),gt==="Point")ee(at,Tt);else if(gt==="MultiPoint")for(const zt of at)ee(zt,Tt);else if(gt==="LineString")de(at,Tt,bt,!1);else if(gt==="MultiLineString"){if(X.lineMetrics){for(const zt of at)Tt=[],de(zt,Tt,bt,!1),yt.push(Dt(vt,"LineString",Tt,Z.properties));return}Ee(at,Tt,bt,!1)}else if(gt==="Polygon")Ee(at,Tt,bt,!0);else{if(gt!=="MultiPolygon"){if(gt==="GeometryCollection"){for(const zt of Z.geometry.geometries)Lt(yt,{id:vt,geometry:zt,properties:Z.properties},X,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const zt of at){const At=[];Ee(zt,At,bt,!0),Tt.push(At)}}yt.push(Dt(vt,gt,Tt,Z.properties))}function ee(yt,Z){Z.push(me(yt[0]),Ge(yt[1]),0)}function de(yt,Z,X,Y){let at,gt,bt=0;for(let vt=0;vt<yt.length;vt++){const zt=me(yt[vt][0]),At=Ge(yt[vt][1]);Z.push(zt,At,0),vt>0&&(bt+=Y?(at*At-zt*gt)/2:Math.sqrt(Math.pow(zt-at,2)+Math.pow(At-gt,2))),at=zt,gt=At}const Tt=Z.length-3;Z[2]=1,qt(Z,0,Tt,X),Z[Tt+2]=1,Z.size=Math.abs(bt),Z.start=0,Z.end=Z.size}function Ee(yt,Z,X,Y){for(let at=0;at<yt.length;at++){const gt=[];de(yt[at],gt,X,Y),Z.push(gt)}}function me(yt){return yt/360+.5}function Ge(yt){const Z=Math.sin(yt*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function ae(yt,Z,X,Y,at,gt,bt,Tt){if(Y/=Z,gt>=(X/=Z)&&bt<Y)return yt;if(bt<X||gt>=Y)return null;const vt=[];for(const zt of yt){const At=zt.geometry;let wt=zt.type;const Bt=at===0?zt.minX:zt.minY,pt=at===0?zt.maxX:zt.maxY;if(Bt>=X&&pt<Y){vt.push(zt);continue}if(pt<X||Bt>=Y)continue;let ie=[];if(wt==="Point"||wt==="MultiPoint")Se(At,ie,X,Y,at);else if(wt==="LineString")ze(At,ie,X,Y,at,!1,Tt.lineMetrics);else if(wt==="MultiLineString")oe(At,ie,X,Y,at,!1);else if(wt==="Polygon")oe(At,ie,X,Y,at,!0);else if(wt==="MultiPolygon")for(const ve of At){const se=[];oe(ve,se,X,Y,at,!0),se.length&&ie.push(se)}if(ie.length){if(Tt.lineMetrics&&wt==="LineString"){for(const ve of ie)vt.push(Dt(zt.id,wt,ve,zt.tags));continue}wt!=="LineString"&&wt!=="MultiLineString"||(ie.length===1?(wt="LineString",ie=ie[0]):wt="MultiLineString"),wt!=="Point"&&wt!=="MultiPoint"||(wt=ie.length===3?"Point":"MultiPoint"),vt.push(Dt(zt.id,wt,ie,zt.tags))}}return vt.length?vt:null}function Se(yt,Z,X,Y,at){for(let gt=0;gt<yt.length;gt+=3){const bt=yt[gt+at];bt>=X&&bt<=Y&&Ce(Z,yt[gt],yt[gt+1],yt[gt+2])}}function ze(yt,Z,X,Y,at,gt,bt){let Tt=Wt(yt);const vt=at===0?je:Xe;let zt,At,wt=yt.start;for(let se=0;se<yt.length-3;se+=3){const ge=yt[se],Te=yt[se+1],fi=yt[se+2],hi=yt[se+3],ti=yt[se+4],be=at===0?ge:Te,qe=at===0?hi:ti;let qi=!1;bt&&(zt=Math.sqrt(Math.pow(ge-hi,2)+Math.pow(Te-ti,2))),be<X?qe>X&&(At=vt(Tt,ge,Te,hi,ti,X),bt&&(Tt.start=wt+zt*At)):be>Y?qe<Y&&(At=vt(Tt,ge,Te,hi,ti,Y),bt&&(Tt.start=wt+zt*At)):Ce(Tt,ge,Te,fi),qe<X&&be>=X&&(At=vt(Tt,ge,Te,hi,ti,X),qi=!0),qe>Y&&be<=Y&&(At=vt(Tt,ge,Te,hi,ti,Y),qi=!0),!gt&&qi&&(bt&&(Tt.end=wt+zt*At),Z.push(Tt),Tt=Wt(yt)),bt&&(wt+=zt)}let Bt=yt.length-3;const pt=yt[Bt],ie=yt[Bt+1],ve=at===0?pt:ie;ve>=X&&ve<=Y&&Ce(Tt,pt,ie,yt[Bt+2]),Bt=Tt.length-3,gt&&Bt>=3&&(Tt[Bt]!==Tt[0]||Tt[Bt+1]!==Tt[1])&&Ce(Tt,Tt[0],Tt[1],Tt[2]),Tt.length&&Z.push(Tt)}function Wt(yt){const Z=[];return Z.size=yt.size,Z.start=yt.start,Z.end=yt.end,Z}function oe(yt,Z,X,Y,at,gt){for(const bt of yt)ze(bt,Z,X,Y,at,gt,!1)}function Ce(yt,Z,X,Y){yt.push(Z,X,Y)}function je(yt,Z,X,Y,at,gt){const bt=(gt-Z)/(Y-Z);return Ce(yt,gt,X+(at-X)*bt,1),bt}function Xe(yt,Z,X,Y,at,gt){const bt=(gt-X)/(at-X);return Ce(yt,Z+(Y-Z)*bt,gt,1),bt}function De(yt,Z){const X=[];for(let Y=0;Y<yt.length;Y++){const at=yt[Y],gt=at.type;let bt;if(gt==="Point"||gt==="MultiPoint"||gt==="LineString")bt=We(at.geometry,Z);else if(gt==="MultiLineString"||gt==="Polygon"){bt=[];for(const Tt of at.geometry)bt.push(We(Tt,Z))}else if(gt==="MultiPolygon"){bt=[];for(const Tt of at.geometry){const vt=[];for(const zt of Tt)vt.push(We(zt,Z));bt.push(vt)}}X.push(Dt(at.id,gt,bt,at.tags))}return X}function We(yt,Z){const X=[];X.size=yt.size,yt.start!==void 0&&(X.start=yt.start,X.end=yt.end);for(let Y=0;Y<yt.length;Y+=3)X.push(yt[Y]+Z,yt[Y+1],yt[Y+2]);return X}function Ze(yt,Z){if(yt.transformed)return yt;const X=1<<yt.z,Y=yt.x,at=yt.y;for(const gt of yt.features){const bt=gt.geometry,Tt=gt.type;if(gt.geometry=[],Tt===1)for(let vt=0;vt<bt.length;vt+=2)gt.geometry.push(pi(bt[vt],bt[vt+1],Z,X,Y,at));else for(let vt=0;vt<bt.length;vt++){const zt=[];for(let At=0;At<bt[vt].length;At+=2)zt.push(pi(bt[vt][At],bt[vt][At+1],Z,X,Y,at));gt.geometry.push(zt)}}return yt.transformed=!0,yt}function pi(yt,Z,X,Y,at,gt){return[Math.round(X*(yt*Y-at)),Math.round(X*(Z*Y-gt))]}function Be(yt,Z,X,Y,at){const gt=Z===at.maxZoom?0:at.tolerance/((1<<Z)*at.extent),bt={features:[],numPoints:0,numSimplified:0,numFeatures:yt.length,source:null,x:X,y:Y,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Tt of yt)Ne(bt,Tt,gt,at);return bt}function Ne(yt,Z,X,Y){const at=Z.geometry,gt=Z.type,bt=[];if(yt.minX=Math.min(yt.minX,Z.minX),yt.minY=Math.min(yt.minY,Z.minY),yt.maxX=Math.max(yt.maxX,Z.maxX),yt.maxY=Math.max(yt.maxY,Z.maxY),gt==="Point"||gt==="MultiPoint")for(let Tt=0;Tt<at.length;Tt+=3)bt.push(at[Tt],at[Tt+1]),yt.numPoints++,yt.numSimplified++;else if(gt==="LineString")Ae(bt,at,yt,X,!1,!1);else if(gt==="MultiLineString"||gt==="Polygon")for(let Tt=0;Tt<at.length;Tt++)Ae(bt,at[Tt],yt,X,gt==="Polygon",Tt===0);else if(gt==="MultiPolygon")for(let Tt=0;Tt<at.length;Tt++){const vt=at[Tt];for(let zt=0;zt<vt.length;zt++)Ae(bt,vt[zt],yt,X,!0,zt===0)}if(bt.length){let Tt=Z.tags||null;if(gt==="LineString"&&Y.lineMetrics){Tt={};for(const zt in Z.tags)Tt[zt]=Z.tags[zt];Tt.mapbox_clip_start=at.start/at.size,Tt.mapbox_clip_end=at.end/at.size}const vt={geometry:bt,type:gt==="Polygon"||gt==="MultiPolygon"?3:gt==="LineString"||gt==="MultiLineString"?2:1,tags:Tt};Z.id!==null&&(vt.id=Z.id),yt.features.push(vt)}}function Ae(yt,Z,X,Y,at,gt){const bt=Y*Y;if(Y>0&&Z.size<(at?bt:Y))return void(X.numPoints+=Z.length/3);const Tt=[];for(let vt=0;vt<Z.length;vt+=3)(Y===0||Z[vt+2]>bt)&&(X.numSimplified++,Tt.push(Z[vt],Z[vt+1])),X.numPoints++;at&&function(vt,zt){let At=0;for(let wt=0,Bt=vt.length,pt=Bt-2;wt<Bt;pt=wt,wt+=2)At+=(vt[wt]-vt[pt])*(vt[wt+1]+vt[pt+1]);if(At>0===zt)for(let wt=0,Bt=vt.length;wt<Bt/2;wt+=2){const pt=vt[wt],ie=vt[wt+1];vt[wt]=vt[Bt-2-wt],vt[wt+1]=vt[Bt-1-wt],vt[Bt-2-wt]=pt,vt[Bt-1-wt]=ie}}(Tt,gt),yt.push(Tt)}const ci={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ti{constructor(Z,X){const Y=(X=this.options=function(gt,bt){for(const Tt in bt)gt[Tt]=bt[Tt];return gt}(Object.create(ci),X)).debug;if(Y&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let at=function(gt,bt){const Tt=[];if(gt.type==="FeatureCollection")for(let vt=0;vt<gt.features.length;vt++)Lt(Tt,gt.features[vt],bt,vt);else Lt(Tt,gt.type==="Feature"?gt:{geometry:gt},bt);return Tt}(Z,X);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),at=function(gt,bt){const Tt=bt.buffer/bt.extent;let vt=gt;const zt=ae(gt,1,-1-Tt,Tt,0,-1,2,bt),At=ae(gt,1,1-Tt,2+Tt,0,-1,2,bt);return(zt||At)&&(vt=ae(gt,1,-Tt,1+Tt,0,-1,2,bt)||[],zt&&(vt=De(zt,1).concat(vt)),At&&(vt=vt.concat(De(At,-1)))),vt}(at,X),at.length&&this.splitTile(at,0,0,0),Y&&(at.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,X,Y,at,gt,bt,Tt){const vt=[Z,X,Y,at],zt=this.options,At=zt.debug;for(;vt.length;){at=vt.pop(),Y=vt.pop(),X=vt.pop(),Z=vt.pop();const wt=1<<X,Bt=ir(X,Y,at);let pt=this.tiles[Bt];if(!pt&&(At>1&&console.time("creation"),pt=this.tiles[Bt]=Be(Z,X,Y,at,zt),this.tileCoords.push({z:X,x:Y,y:at}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Y,at,pt.numFeatures,pt.numPoints,pt.numSimplified),console.timeEnd("creation"));const qi=`z${X}`;this.stats[qi]=(this.stats[qi]||0)+1,this.total++}if(pt.source=Z,gt==null){if(X===zt.indexMaxZoom||pt.numPoints<=zt.indexMaxPoints)continue}else{if(X===zt.maxZoom||X===gt)continue;if(gt!=null){const qi=gt-X;if(Y!==bt>>qi||at!==Tt>>qi)continue}}if(pt.source=null,Z.length===0)continue;At>1&&console.time("clipping");const ie=.5*zt.buffer/zt.extent,ve=.5-ie,se=.5+ie,ge=1+ie;let Te=null,fi=null,hi=null,ti=null,be=ae(Z,wt,Y-ie,Y+se,0,pt.minX,pt.maxX,zt),qe=ae(Z,wt,Y+ve,Y+ge,0,pt.minX,pt.maxX,zt);Z=null,be&&(Te=ae(be,wt,at-ie,at+se,1,pt.minY,pt.maxY,zt),fi=ae(be,wt,at+ve,at+ge,1,pt.minY,pt.maxY,zt),be=null),qe&&(hi=ae(qe,wt,at-ie,at+se,1,pt.minY,pt.maxY,zt),ti=ae(qe,wt,at+ve,at+ge,1,pt.minY,pt.maxY,zt),qe=null),At>1&&console.timeEnd("clipping"),vt.push(Te||[],X+1,2*Y,2*at),vt.push(fi||[],X+1,2*Y,2*at+1),vt.push(hi||[],X+1,2*Y+1,2*at),vt.push(ti||[],X+1,2*Y+1,2*at+1)}}getTile(Z,X,Y){Z=+Z,X=+X,Y=+Y;const at=this.options,{extent:gt,debug:bt}=at;if(Z<0||Z>24)return null;const Tt=1<<Z,vt=ir(Z,X=X+Tt&Tt-1,Y);if(this.tiles[vt])return Ze(this.tiles[vt],gt);bt>1&&console.log("drilling down to z%d-%d-%d",Z,X,Y);let zt,At=Z,wt=X,Bt=Y;for(;!zt&&At>0;)At--,wt>>=1,Bt>>=1,zt=this.tiles[ir(At,wt,Bt)];return zt&&zt.source?(bt>1&&(console.log("found parent tile z%d-%d-%d",At,wt,Bt),console.time("drilling down")),this.splitTile(zt.source,At,wt,Bt,Z,X,Y),bt>1&&console.timeEnd("drilling down"),this.tiles[vt]?Ze(this.tiles[vt],gt):null):null}}function ir(yt,Z,X){return 32*((1<<yt)*X+Z)+yt}function Vi(yt,Z){return Z?yt.properties[Z]:yt.id}function xr(yt,Z){if(yt==null)return!0;if(yt.type==="Feature")return Vi(yt,Z)!=null;if(yt.type==="FeatureCollection"){const X=new Set;for(const Y of yt.features){const at=Vi(Y,Z);if(at==null||X.has(at))return!1;X.add(at)}return!0}return!1}function br(yt,Z){const X=new Map;if(yt!=null)if(yt.type==="Feature")X.set(Vi(yt,Z),yt);else for(const Y of yt.features)X.set(Vi(Y,Z),Y);return X}class ni extends z{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Z,X){return m._(this,void 0,void 0,function*(){const Y=Z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const at=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!at)return null;const gt=new Ot(at.features);let bt=Re(gt);return bt.byteOffset===0&&bt.byteLength===bt.buffer.byteLength||(bt=new Uint8Array(bt)),{vectorTile:gt,rawData:bt.buffer}})}loadData(Z){return m._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const Y=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new m.cM(Z.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Z,this._pendingRequest),this._geoJSONIndex=Z.cluster?new Qe(function({superclusterOptions:bt,clusterProperties:Tt}){if(!Tt||!bt)return bt;const vt={},zt={},At={accumulated:null,zoom:0},wt={properties:null},Bt=Object.keys(Tt);for(const pt of Bt){const[ie,ve]=Tt[pt],se=m.cT(ve),ge=m.cT(typeof ie=="string"?[ie,["accumulated"],["get",pt]]:ie);vt[pt]=se.value,zt[pt]=ge.value}return bt.map=pt=>{wt.properties=pt;const ie={};for(const ve of Bt)ie[ve]=vt[ve].evaluate(At,wt);return ie},bt.reduce=(pt,ie)=>{wt.properties=ie;for(const ve of Bt)At.accumulated=pt[ve],pt[ve]=zt[ve].evaluate(At,wt)},bt}(Z)).load((yield this._pendingData).features):(at=yield this._pendingData,new Ti(at,Z.geojsonVtOptions)),this.loaded={};const gt={};if(Y){const bt=Y.finish();bt&&(gt.resourceTiming={},gt.resourceTiming[Z.source]=JSON.parse(JSON.stringify(bt)))}return gt}catch(gt){if(delete this._pendingRequest,m.cx(gt))return{abandoned:!0};throw gt}var at})}getData(){return m._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Z){const X=this.loaded;return X&&X[Z.uid]?super.reloadTile(Z):this.loadTile(Z)}loadAndProcessGeoJSON(Z,X){return m._(this,void 0,void 0,function*(){let Y=yield this.loadGeoJSON(Z,X);if(delete this._pendingRequest,typeof Y!="object")throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(it(Y,!0),Z.filter){const at=m.cT(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(at.result==="error")throw new Error(at.value.map(bt=>`${bt.key}: ${bt.message}`).join(", "));Y={type:"FeatureCollection",features:Y.features.filter(bt=>at.value.evaluate({zoom:0},bt))}}return Y})}loadGeoJSON(Z,X){return m._(this,void 0,void 0,function*(){const{promoteId:Y}=Z;if(Z.request){const at=yield m.j(Z.request,X);return this._dataUpdateable=xr(at.data,Y)?br(at.data,Y):void 0,at.data}if(typeof Z.data=="string")try{const at=JSON.parse(Z.data);return this._dataUpdateable=xr(at,Y)?br(at,Y):void 0,at}catch{throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`)}if(!Z.dataDiff)throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Z.source}`);return function(at,gt,bt){var Tt,vt,zt,At;if(gt.removeAll&&at.clear(),gt.remove)for(const wt of gt.remove)at.delete(wt);if(gt.add)for(const wt of gt.add){const Bt=Vi(wt,bt);Bt!=null&&at.set(Bt,wt)}if(gt.update)for(const wt of gt.update){let Bt=at.get(wt.id);if(Bt==null)continue;const pt=!wt.removeAllProperties&&(((Tt=wt.removeProperties)===null||Tt===void 0?void 0:Tt.length)>0||((vt=wt.addOrUpdateProperties)===null||vt===void 0?void 0:vt.length)>0);if((wt.newGeometry||wt.removeAllProperties||pt)&&(Bt=Object.assign({},Bt),at.set(wt.id,Bt),pt&&(Bt.properties=Object.assign({},Bt.properties))),wt.newGeometry&&(Bt.geometry=wt.newGeometry),wt.removeAllProperties)Bt.properties={};else if(((zt=wt.removeProperties)===null||zt===void 0?void 0:zt.length)>0)for(const ie of wt.removeProperties)Object.prototype.hasOwnProperty.call(Bt.properties,ie)&&delete Bt.properties[ie];if(((At=wt.addOrUpdateProperties)===null||At===void 0?void 0:At.length)>0)for(const{key:ie,value:ve}of wt.addOrUpdateProperties)Bt.properties[ie]=ve}}(this._dataUpdateable,Z.dataDiff,Y),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Z){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Z){return this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId)}getClusterChildren(Z){return this._geoJSONIndex.getChildren(Z.clusterId)}getClusterLeaves(Z){return this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset)}}class Di{constructor(Z){this.self=Z,this.actor=new m.J(Z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,Y)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=Y},this.self.addProtocol=m.cz,this.self.removeProtocol=m.cA,this.self.registerRTLTextPlugin=X=>{m.cU.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,Y)=>this._getDEMWorkerSource(X,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RDT",(X,Y)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,Y.source).removeTile(Y)})),this.actor.registerMessageHandler("GCEZ",(X,Y)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(X,Y.type,Y.source).getClusterExpansionZoom(Y)})),this.actor.registerMessageHandler("GCC",(X,Y)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(X,Y.type,Y.source).getClusterChildren(Y)})),this.actor.registerMessageHandler("GCL",(X,Y)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(X,Y.type,Y.source).getClusterLeaves(Y)})),this.actor.registerMessageHandler("LD",(X,Y)=>this._getWorkerSource(X,Y.type,Y.source).loadData(Y)),this.actor.registerMessageHandler("GD",(X,Y)=>this._getWorkerSource(X,Y.type,Y.source).getData()),this.actor.registerMessageHandler("LT",(X,Y)=>this._getWorkerSource(X,Y.type,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RT",(X,Y)=>this._getWorkerSource(X,Y.type,Y.source).reloadTile(Y)),this.actor.registerMessageHandler("AT",(X,Y)=>this._getWorkerSource(X,Y.type,Y.source).abortTile(Y)),this.actor.registerMessageHandler("RMT",(X,Y)=>this._getWorkerSource(X,Y.type,Y.source).removeTile(Y)),this.actor.registerMessageHandler("RS",(X,Y)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][Y.type]||!this.workerSources[X][Y.type][Y.source])return;const at=this.workerSources[X][Y.type][Y.source];delete this.workerSources[X][Y.type][Y.source],at.removeSource!==void 0&&at.removeSource(Y)})),this.actor.registerMessageHandler("RM",X=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,Y)=>m._(this,void 0,void 0,function*(){this.referrer=Y})),this.actor.registerMessageHandler("SRPS",(X,Y)=>this._syncRTLPluginState(X,Y)),this.actor.registerMessageHandler("IS",(X,Y)=>m._(this,void 0,void 0,function*(){this.self.importScripts(Y)})),this.actor.registerMessageHandler("SI",(X,Y)=>this._setImages(X,Y)),this.actor.registerMessageHandler("UL",(X,Y)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(Y.layers,Y.removedIds)})),this.actor.registerMessageHandler("SL",(X,Y)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(Y)}))}_setImages(Z,X){return m._(this,void 0,void 0,function*(){this.availableImages[Z]=X;for(const Y in this.workerSources[Z]){const at=this.workerSources[Z][Y];for(const gt in at)at[gt].availableImages=X}})}_syncRTLPluginState(Z,X){return m._(this,void 0,void 0,function*(){return yield m.cU.syncState(X,this.self.importScripts)})}_getAvailableImages(Z){let X=this.availableImages[Z];return X||(X=[]),X}_getLayerIndex(Z){let X=this.layerIndexes[Z];return X||(X=this.layerIndexes[Z]=new o),X}_getWorkerSource(Z,X,Y){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][X]||(this.workerSources[Z][X]={}),!this.workerSources[Z][X][Y]){const at={sendAsync:(gt,bt)=>(gt.targetMapId=Z,this.actor.sendAsync(gt,bt))};switch(X){case"vector":this.workerSources[Z][X][Y]=new z(at,this._getLayerIndex(Z),this._getAvailableImages(Z));break;case"geojson":this.workerSources[Z][X][Y]=new ni(at,this._getLayerIndex(Z),this._getAvailableImages(Z));break;default:this.workerSources[Z][X][Y]=new this.externalWorkerSourceTypes[X](at,this._getLayerIndex(Z),this._getAvailableImages(Z))}}return this.workerSources[Z][X][Y]}_getDEMWorkerSource(Z,X){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][X]||(this.demWorkerSources[Z][X]=new D),this.demWorkerSources[Z][X]}}return m.i(self)&&(self.worker=new Di(self)),Di}),p("index",["exports","./shared"],function(m,o){var P="5.6.0";function A(){var g=new o.A(4);return o.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let L,z;const D={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(g,t,r){const c=requestAnimationFrame(_=>{d(),t(_)}),{unsubscribe:d}=o.s(g.signal,"abort",()=>{d(),cancelAnimationFrame(c),r(o.c())},!1)},frameAsync(g){return new Promise((t,r)=>{this.frame(g,t,r)})},getImageData(g,t=0){return this.getImageCanvasContext(g).getImageData(-t,-t,g.width+2*t,g.height+2*t)},getImageCanvasContext(g){const t=window.document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return t.width=g.width,t.height=g.height,r.drawImage(g,0,0,g.width,g.height),r},resolveURL:g=>(L||(L=document.createElement("a")),L.href=g,L.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(z==null&&(z=matchMedia("(prefers-reduced-motion: reduce)")),z.matches)}};class B{static testProp(t){if(!B.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in B.docStyle)return t[r];return t[0]}static create(t,r,c){const d=window.document.createElement(t);return r!==void 0&&(d.className=r),c&&c.appendChild(d),d}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){B.docStyle&&B.selectProp&&(B.userSelect=B.docStyle[B.selectProp],B.docStyle[B.selectProp]="none")}static enableDrag(){B.docStyle&&B.selectProp&&(B.docStyle[B.selectProp]=B.userSelect)}static setTransform(t,r){t.style[B.transformProp]=r}static addEventListener(t,r,c,d={}){t.addEventListener(r,c,"passive"in d?d:d.capture)}static removeEventListener(t,r,c,d={}){t.removeEventListener(r,c,"passive"in d?d:d.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",B.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",B.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",B.suppressClickInternal,!0)},0)}static getScale(t){const r=t.getBoundingClientRect();return{x:r.width/t.offsetWidth||1,y:r.height/t.offsetHeight||1,boundingClientRect:r}}static getPoint(t,r,c){const d=r.boundingClientRect;return new o.P((c.clientX-d.left)/r.x-t.clientLeft,(c.clientY-d.top)/r.y-t.clientTop)}static mousePos(t,r){const c=B.getScale(t);return B.getPoint(t,c,r)}static touchPos(t,r){const c=[],d=B.getScale(t);for(let _=0;_<r.length;_++)c.push(B.getPoint(t,d,r[_]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const r=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),c=r.querySelectorAll("script");for(const d of c)d.remove();return B.clean(r),r.innerHTML}static isPossiblyDangerous(t,r){const c=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!c.includes("javascript:")&&!c.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const r=t.children;for(const c of r)B.removeAttributes(c),B.clean(c)}static removeAttributes(t){for(const{name:r,value:c}of t.attributes)B.isPossiblyDangerous(r,c)&&t.removeAttribute(r)}}B.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,B.selectProp=B.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),B.transformProp=B.testProp(["transform","WebkitTransform"]);const $={supported:!1,testSupport:function(g){!ft&&it&&(dt?Ot(g):et=g)}};let et,it,ft=!1,dt=!1;function Ot(g){const t=g.createTexture();g.bindTexture(g.TEXTURE_2D,t);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,it),g.isContextLost())return;$.supported=!0}catch{}g.deleteTexture(t),ft=!0}var jt;typeof document<"u"&&(it=document.createElement("img"),it.onload=()=>{et&&Ot(et),et=null,dt=!0},it.onerror=()=>{ft=!0,et=null},it.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let t,r,c,d;g.resetRequestQueue=()=>{t=[],r=0,c=0,d={}},g.addThrottleControl=T=>{const I=c++;return d[I]=T,I},g.removeThrottleControl=T=>{delete d[T],b()},g.getImage=(T,I,R=!0)=>new Promise((F,O)=>{$.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),o.e(T,{type:"image"}),t.push({abortController:I,requestParameters:T,supportImageRefresh:R,state:"queued",onError:G=>{O(G)},onSuccess:G=>{F(G)}}),b()});const _=T=>o._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:I,supportImageRefresh:R,onError:F,onSuccess:O,abortController:G}=T,q=R===!1&&!o.i(self)&&!o.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce((tt,st)=>tt&&st==="accept",!0));r++;const Q=q?M(I,G):o.m(I,G);try{const tt=yield Q;delete T.abortController,T.state="completed",tt.data instanceof HTMLImageElement||o.b(tt.data)?O(tt):tt.data&&O({data:yield(J=tt.data,typeof createImageBitmap=="function"?o.f(J):o.h(J)),cacheControl:tt.cacheControl,expires:tt.expires})}catch(tt){delete T.abortController,F(tt)}finally{r--,b()}var J}),b=()=>{const T=(()=>{for(const I of Object.keys(d))if(d[I]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=r;I<T&&t.length>0;I++){const R=t.shift();R.abortController.signal.aborted?I--:_(R)}},M=(T,I)=>new Promise((R,F)=>{const O=new Image,G=T.url,q=T.credentials;q&&q==="include"?O.crossOrigin="use-credentials":(q&&q==="same-origin"||!o.d(G))&&(O.crossOrigin="anonymous"),I.signal.addEventListener("abort",()=>{O.src="",F(o.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,R({data:O})},O.onerror=()=>{O.onerror=O.onload=null,I.signal.aborted||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=G})}(jt||(jt={})),jt.resetRequestQueue();class Gt{constructor(t){this._transformRequestFn=t}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function re(g){const t=[];if(typeof g=="string")t.push({id:"default",url:g});else if(g&&g.length>0){const r=[];for(const{id:c,url:d}of g){const _=`${c}${d}`;r.indexOf(_)===-1&&(r.push(_),t.push({id:c,url:d}))}}return t}function Ie(g,t,r){try{const c=new URL(g);return c.pathname+=`${t}${r}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function _e(g){const{userImage:t}=g;return!!(t&&t.render&&t.render())&&(g.data.replace(new Uint8Array(t.data.buffer)),!0)}class Re extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,promiseResolve:c}of this.requestors)c(this._getImagesForIds(r));this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const c=r.spriteData;r.data=new o.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let c=!0;const d=r.data||r.spriteData;return this._validateStretch(r.stretchX,d&&d.width)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,d&&d.height)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,r){if(!t)return!0;let c=0;for(const d of t){if(d[0]<c||d[1]<d[0]||r<d[1])return!1;c=d[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const c=r.spriteData,d=c&&c.width||r.data.width,_=c&&c.height||r.data.height;return!(t[0]<0||d<t[0]||t[1]<0||_<t[1]||t[2]<0||d<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,c=!0){const d=this.getImage(t);if(c&&(d.data.width!==r.data.width||d.data.height!==r.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=d.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((r,c)=>{let d=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(d=!1);this.isLoaded()||d?r(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:r})})}_getImagesForIds(t){const r={};for(const c of t){let d=this.getImage(c);d||(this.fire(new o.l("styleimagemissing",{id:c})),d=this.getImage(c)),d?r[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:o.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],c=this.getImage(t);if(!c)return null;if(r&&r.position.version===c.version)return r.position;if(r)r.position.version=c.version;else{const d={w:c.data.width+2,h:c.data.height+2,x:0,y:0},_=new o.I(d,c);this.patterns[t]={bin:d,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:r,h:c}=o.p(t),d=this.atlasImage;d.resize({width:r||1,height:c||1});for(const _ in this.patterns){const{bin:b}=this.patterns[_],M=b.x+1,T=b.y+1,I=this.getImage(_).data,R=I.width,F=I.height;o.R.copy(I,d,{x:0,y:0},{x:M,y:T},{width:R,height:F}),o.R.copy(I,d,{x:0,y:F-1},{x:M,y:T-1},{width:R,height:1}),o.R.copy(I,d,{x:0,y:0},{x:M,y:T+F},{width:R,height:1}),o.R.copy(I,d,{x:R-1,y:0},{x:M-1,y:T},{width:1,height:F}),o.R.copy(I,d,{x:0,y:0},{x:M+R,y:T},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const c=this.getImage(r);c||o.w(`Image with ID: "${r}" was not found`),_e(c)&&this.updateImage(r,c)}}}const ri=1e20;function $e(g,t,r,c,d,_,b,M,T){for(let I=t;I<t+c;I++)oi(g,r*_+I,_,d,b,M,T);for(let I=r;I<r+d;I++)oi(g,I*_+t,1,c,b,M,T)}function oi(g,t,r,c,d,_,b){_[0]=0,b[0]=-1e20,b[1]=ri,d[0]=g[t];for(let M=1,T=0,I=0;M<c;M++){d[M]=g[t+M*r];const R=M*M;do{const F=_[T];I=(d[M]-d[F]+R-F*F)/(M-F)/2}while(I<=b[T]&&--T>-1);T++,_[T]=M,b[T]=I,b[T+1]=ri}for(let M=0,T=0;M<c;M++){for(;b[T+1]<M;)T++;const I=_[T],R=M-I;g[t+M*r]=d[I]+R*R}}class Qe{constructor(t,r){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return o._(this,void 0,void 0,function*(){const r=[];for(const _ in t)for(const b of t[_])r.push(this._getAndCacheGlyphsPromise(_,b));const c=yield Promise.all(r),d={};for(const{stack:_,id:b,glyph:M}of c)d[_]||(d[_]={}),d[_][b]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return d})}_getAndCacheGlyphsPromise(t,r){return o._(this,void 0,void 0,function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let d=c.glyphs[r];if(d!==void 0)return{stack:t,id:r,glyph:d};if(d=this._tinySDF(c,t,r),d)return c.glyphs[r]=d,{stack:t,id:r,glyph:d};const _=Math.floor(r/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(c.ranges[_])return{stack:t,id:r,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!c.requests[_]){const M=Qe.loadGlyphRange(t,_,this.url,this.requestManager);c.requests[_]=M}const b=yield c.requests[_];for(const M in b)this._doesCharSupportLocalGlyph(+M)||(c.glyphs[+M]=b[+M]);return c.ranges[_]=!0,{stack:t,id:r,glyph:b[r]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))||o.u["CJK Unified Ideographs"](t)||o.u["Hangul Syllables"](t)||o.u.Hiragana(t)||o.u.Katakana(t)||o.u["CJK Symbols and Punctuation"](t)||o.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,r,c){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let _=t.tinySDF;if(!_){let M="400";/bold/i.test(r)?M="900":/medium/i.test(r)?M="500":/light/i.test(r)&&(M="200"),_=t.tinySDF=new Qe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:M})}const b=_.draw(String.fromCharCode(c));return{id:c,bitmap:new o.q({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}}Qe.loadGlyphRange=function(g,t,r,c){return o._(this,void 0,void 0,function*(){const d=256*t,_=d+255,b=c.transformRequest(r.replace("{fontstack}",g).replace("{range}",`${d}-${_}`),"Glyphs"),M=yield o.n(b,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${t}, ${d}-${_}`);const T={};for(const I of o.o(M.data))T[I.id]=I;return T})},Qe.TinySDF=class{constructor({fontSize:g=24,buffer:t=3,radius:r=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:b="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=r;const M=this.size=g+4*t,T=this._createCanvas(M),I=this.ctx=T.getContext("2d",{willReadFrequently:!0});I.font=`${b} ${_} ${g}px ${d}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(g){const t=document.createElement("canvas");return t.width=t.height=g,t}draw(g){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(g),b=Math.ceil(r),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),T=Math.min(this.size-this.buffer,b+Math.ceil(c)),I=M+2*this.buffer,R=T+2*this.buffer,F=Math.max(I*R,0),O=new Uint8ClampedArray(F),G={data:O,width:I,height:R,glyphWidth:M,glyphHeight:T,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(M===0||T===0)return G;const{ctx:q,buffer:Q,gridInner:J,gridOuter:tt}=this;q.clearRect(Q,Q,M,T),q.fillText(g,Q,Q+b);const st=q.getImageData(Q,Q,M,T);tt.fill(ri,0,F),J.fill(0,0,F);for(let ht=0;ht<T;ht++)for(let nt=0;nt<M;nt++){const ut=st.data[4*(ht*M+nt)+3]/255;if(ut===0)continue;const mt=(ht+Q)*I+nt+Q;if(ut===1)tt[mt]=0,J[mt]=ri;else{const ot=.5-ut;tt[mt]=ot>0?ot*ot:0,J[mt]=ot<0?ot*ot:0}}$e(tt,0,0,I,R,I,this.f,this.v,this.z),$e(J,Q,Q,M,T,I,this.f,this.v,this.z);for(let ht=0;ht<F;ht++){const nt=Math.sqrt(tt[ht])-Math.sqrt(J[ht]);O[ht]=Math.round(255-255*(nt/this.radius+this.cutoff))}return G}};class wi{constructor(){this.specification=o.v.light.position}possiblyEvaluate(t,r){return o.B(t.expression.evaluate(r))}interpolate(t,r,c){return{x:o.C.number(t.x,r.x,c),y:o.C.number(t.y,r.y,c),z:o.C.number(t.z,r.z,c)}}}let li;class Ii extends o.E{constructor(t){super(),li=li||new o.r({anchor:new o.D(o.v.light.anchor),position:new wi,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(li),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(o.x,t,r))for(const c in t){const d=t[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&o.y(this,t.call(o.z,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Ri=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class Nt extends o.E{constructor(t){super(),this._transitionable=new o.t(Ri),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(t,r={}){if(!this._validate(o.G,t,r)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const d=t[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c={}){return(c==null?void 0:c.validate)!==!1&&o.y(this,t.call(o.z,o.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class qt{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const c=t.join(",")+String(r);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,r)),this.dashEntry[c]}getDashRanges(t,r,c){const d=[];let _=t.length%2==1?-t[t.length-1]*c:0,b=t[0]*c,M=!0;d.push({left:_,right:b,isDash:M,zeroLength:t[0]===0});let T=t[0];for(let I=1;I<t.length;I++){M=!M;const R=t[I];_=T*c,T+=R,b=T*c,d.push({left:_,right:b,isDash:M,zeroLength:R===0})}return d}addRoundDash(t,r,c){const d=r/2;for(let _=-c;_<=c;_++){const b=this.width*(this.nextRow+c+_);let M=0,T=t[M];for(let I=0;I<this.width;I++){I/T.right>1&&(T=t[++M]);const R=Math.abs(I-T.left),F=Math.abs(I-T.right),O=Math.min(R,F);let G;const q=_/c*(d+1);if(T.isDash){const Q=d-Math.abs(q);G=Math.sqrt(O*O+Q*Q)}else G=d-Math.sqrt(O*O+q*q);this.data[b+I]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(t){for(let M=t.length-1;M>=0;--M){const T=t[M],I=t[M+1];T.zeroLength?t.splice(M,1):I&&I.isDash===T.isDash&&(I.left=T.left,t.splice(M,1))}const r=t[0],c=t[t.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const d=this.width*this.nextRow;let _=0,b=t[_];for(let M=0;M<this.width;M++){M/b.right>1&&(b=t[++_]);const T=Math.abs(M-b.left),I=Math.abs(M-b.right),R=Math.min(T,I);this.data[d+M]=Math.max(0,Math.min(255,(b.isDash?R:-R)+128))}}addDash(t,r){const c=r?7:0,d=2*c+1;if(this.nextRow+d>this.height)return o.w("LineAtlas out of space"),null;let _=0;for(let M=0;M<t.length;M++)_+=t[M];if(_!==0){const M=this.width/_,T=this.getDashRanges(t,this.width,M);r?this.addRoundDash(T,M,c):this.addRegularDash(T)}const b={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:_};return this.nextRow+=d,this.dirty=!0,b}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const Xt="maplibre_preloaded_worker_pool";class Dt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xt]}numActive(){return Object.keys(this.active).length}}const Mt=Math.floor(D.hardwareConcurrency/2);let Lt,ee;function de(){return Lt||(Lt=new Dt),Lt}Dt.workerCount=o.H(globalThis)?Math.max(Math.min(Mt,3),1):1;class Ee{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=r;const c=this.workerPool.acquire(r);for(let d=0;d<c.length;d++){const _=new o.J(c[d],r);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r){const c=[];for(const d of this.actors)c.push(d.sendAsync({type:t,data:r}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,r){for(const c of this.actors)c.registerMessageHandler(t,r)}}function me(){return ee||(ee=new Ee(de(),o.K),ee.registerMessageHandler("GR",(g,t,r)=>o.m(t,r))),ee}function Ge(g,t){const r=o.L();return o.M(r,r,[1,1,0]),o.N(r,r,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?o.O(r,r,g.calculatePosMatrix(t.toUnwrapped())):r}function ae(g,t,r,c,d,_,b){var M;const T=function(O,G,q){if(O)for(const Q of O){const J=G[Q];if(J&&J.source===q&&J.type==="fill-extrusion")return!0}else for(const Q in G){const J=G[Q];if(J.source===q&&J.type==="fill-extrusion")return!0}return!1}((M=d==null?void 0:d.layers)!==null&&M!==void 0?M:null,t,g.id),I=_.maxPitchScaleFactor(),R=g.tilesIn(c,I,T);R.sort(Se);const F=[];for(const O of R)F.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(t,r,g._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,d,_,I,Ge(g.transform,O.tileID),b?(G,q)=>b(O.tileID,G,q):void 0)});return function(O,G){for(const q in O)for(const Q of O[q])ze(Q,G);return O}(function(O){const G={},q={};for(const Q of O){const J=Q.queryResults,tt=Q.wrappedTileID,st=q[tt]=q[tt]||{};for(const ht in J){const nt=J[ht],ut=st[ht]=st[ht]||{},mt=G[ht]=G[ht]||[];for(const ot of nt)ut[ot.featureIndex]||(ut[ot.featureIndex]=!0,mt.push(ot))}}return G}(F),g)}function Se(g,t){const r=g.tileID,c=t.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function ze(g,t){const r=g.feature,c=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=c}function Wt(g,t,r){return o._(this,void 0,void 0,function*(){let c=g;if(g.url?c=(yield o.j(t.transformRequest(g.url,"Source"),r)).data:yield D.frameAsync(r),!c)return null;const d=o.Q(o.e(c,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(d.vectorLayerIds=c.vector_layers.map(_=>_.id)),d})}class oe{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.S?new o.S(t.lng,t.lat):o.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.S?new o.S(t.lng,t.lat):o.S.convert(t),this}extend(t){const r=this._sw,c=this._ne;let d,_;if(t instanceof o.S)d=t,_=t;else{if(!(t instanceof oe))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(oe.convert(t)):this.extend(o.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.S.convert(t)):this;if(d=t._sw,_=t._ne,!d||!_)return this}return r||c?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),c.lng=Math.max(_.lng,c.lng),c.lat=Math.max(_.lat,c.lat)):(this._sw=new o.S(d.lng,d.lat),this._ne=new o.S(_.lng,_.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:c}=o.S.convert(t);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(t){return t instanceof oe?t:t&&new oe(t)}static fromLngLat(t,r=0){const c=360*r/40075017,d=c/Math.cos(Math.PI/180*t.lat);return new oe(new o.S(t.lng-d,t.lat-c),new o.S(t.lng+d,t.lat+c))}adjustAntiMeridian(){const t=new o.S(this._sw.lng,this._sw.lat),r=new o.S(this._ne.lng,this._ne.lat);return new oe(t,t.lng>r.lng?new o.S(r.lng+360,r.lat):r)}}class Ce{constructor(t,r,c){this.bounds=oe.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),c=Math.floor(o.V(this.bounds.getWest())*r),d=Math.floor(o.U(this.bounds.getNorth())*r),_=Math.ceil(o.V(this.bounds.getEast())*r),b=Math.ceil(o.U(this.bounds.getSouth())*r);return t.x>=c&&t.x<_&&t.y>=d&&t.y<b}}class je extends o.E{constructor(t,r,c,d){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(r,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Wt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(o.e(this,t),t.bounds&&(this.tileBounds=new Ce(t.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new o.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(t){return o._(this,void 0,void 0,function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(r,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};c.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((_,b)=>{t.reloadPromise={resolve:_,reject:b}})}else t.actor=this.dispatcher.getActor(),d="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:d,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,r){if(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return o._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return o._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Xe extends o.E{constructor(t,r,c,d){super(),this.id=t,this.dispatcher=c,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},r),o.e(this,o.Q(r,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Wt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(o.e(this,r),r.bounds&&(this.tileBounds=new Ce(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(r){this._tileJSONRequest=null,this.fire(new o.k(r))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return o.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return o._(this,void 0,void 0,function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield jt.getImage(this.map._requestManager.transformRequest(r,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const d=this.map.painter.context,_=d.gl,b=c.data;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new o.T(d,b,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}})}abortTile(t){return o._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return o._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class De extends Xe{constructor(t,r,c,d){super(t,r,c,d),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(t){return o._(this,void 0,void 0,function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(r,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const d=yield jt.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(d&&d.data){const _=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&t.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const b=o.b(_)&&o.W()?_:yield this.readImageNow(_),M={type:this.type,uid:t.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const T=yield t.actor.sendAsync({type:"LDT",data:M});t.dem=T,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(d){if(delete t.abortController,t.aborted)t.state="unloaded";else if(d)throw t.state="errored",d}})}readImageNow(t){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.X()){const r=t.width+2,c=t.height+2;try{return new o.R({width:r,height:c},yield o.Y(t,-1,-1,r,c))}catch{}}return D.getImageData(t,1)})}_getNeighboringTiles(t){const r=t.canonical,c=Math.pow(2,r.z),d=(r.x-1+c)%c,_=r.x===0?t.wrap-1:t.wrap,b=(r.x+1+c)%c,M=r.x+1===c?t.wrap+1:t.wrap,T={};return T[new o.Z(t.overscaledZ,_,r.z,d,r.y).key]={backfilled:!1},T[new o.Z(t.overscaledZ,M,r.z,b,r.y).key]={backfilled:!1},r.y>0&&(T[new o.Z(t.overscaledZ,_,r.z,d,r.y-1).key]={backfilled:!1},T[new o.Z(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new o.Z(t.overscaledZ,M,r.z,b,r.y-1).key]={backfilled:!1}),r.y+1<c&&(T[new o.Z(t.overscaledZ,_,r.z,d,r.y+1).key]={backfilled:!1},T[new o.Z(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new o.Z(t.overscaledZ,M,r.z,b,r.y+1).key]={backfilled:!1}),T}unloadTile(t){return o._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class We extends o.E{constructor(t,r,c,d){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(d),this._data=r.data,this._options=o.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(o.$/this.tileSize)}_getClusterMaxZoom(t){const r=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${r}"`),r}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return o._(this,void 0,void 0,function*(){const t=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getCoordinatesFromGeometry(t){return t.type==="GeometryCollection"?t.geometries.map(r=>r.coordinates).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,function*(){const t=new oe,r=yield this.getData();let c;switch(r.type){case"FeatureCollection":c=r.features.map(d=>this.getCoordinatesFromGeometry(d.geometry)).flat(1/0);break;case"Feature":c=this.getCoordinatesFromGeometry(r.geometry);break;default:c=this.getCoordinatesFromGeometry(r)}if(c.length==0)return t;for(let d=0;d<c.length-1;d+=2)t.extend([c[d],c[d+1]]);return t})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,r,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:r,offset:c}})}_updateWorkerData(t){return o._(this,void 0,void 0,function*(){const r=o.e({type:this.type},this.workerOptions);t?r.dataDiff=t:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(D.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.l("dataloading",{dataType:"source"}));try{const c=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||c.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));let d=null;c.resourceTiming&&c.resourceTiming[this.id]&&(d=c.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&o.e(_,{resourceTiming:d}),this.fire(new o.l("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(c){if(this._pendingLoads--,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(c))}})}loaded(){return this._pendingLoads===0}loadTile(t){return o._(this,void 0,void 0,function*(){const r=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};t.abortController=new AbortController;const d=yield this.actor.sendAsync({type:r,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(d,this.map.painter,r==="RT")})}abortTile(t){return o._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return o._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Ze extends o.E{constructor(t,r,c,d){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=r}load(t){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield jt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,t&&(this.coordinates=t),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new o.k(r))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(o.a0.fromLngLat);var c;return this.tileID=function(d){const _=o.a1.fromPoints(d),b=_.width(),M=_.height(),T=Math.max(b,M),I=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),R=Math.pow(2,I);return new o.a3(I,Math.floor((_.minX+_.maxX)/2*R),Math.floor((_.minY+_.maxY)/2*R))}(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(d=>this.tileID.getTilePoint(d)._round()),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,r=t.gl;this.texture||(this.texture=new o.T(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:r,minY:c,maxX:d,maxY:_}=o.a1.fromPoints(t),b={};for(let M=0;M<=o.a2;M++){const T=Math.pow(2,M),I=Math.floor(r*T),R=Math.floor(c*T),F=Math.floor(d*T),O=Math.floor(_*T);b[M]={minTileX:I,minTileY:R,maxTileX:F,maxTileY:O}}return b}}class pi extends Ze{constructor(t,r,c,d){super(t,r,c,d),this.roundZoom=!0,this.type="video",this.options=r}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield o.a4(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new o.k(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new o.k(new o.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Be extends Ze{constructor(t,r,c,d){super(t,r,c,d),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(b=>typeof b!="number"))||this.fire(new o.k(new o.a5(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a5(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.k(new o.a5(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a5(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a5(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,c=r.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,c.RGBA,{premultiply:!0});let d=!1;for(const _ in this.tiles){const b=this.tiles[_];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,d=!0)}d&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ne={},Ae=g=>{switch(g){case"geojson":return We;case"image":return Ze;case"raster":return Xe;case"raster-dem":return De;case"vector":return je;case"video":return pi;case"canvas":return Be}return Ne[g]},ci="RTLPluginLoaded";class Ti extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=me()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return o._(this,arguments,void 0,function*(r,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=D.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(ci))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ir=null;function Vi(){return ir||(ir=new Ti),ir}class xr{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=o.a6(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const r=t+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(d,_){const b={};if(!_)return b;for(const M of d){const T=M.layerIds.map(I=>_.getLayer(I)).filter(Boolean);if(T.length!==0){M.layers=T,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(I=>T.filter(R=>R.id===I)[0]));for(const I of T)b[I.id]=M}}return b}(t.buckets,r==null?void 0:r.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof o.a8){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof o.a8&&_.hasRTLText){this.hasRTLText=!0,Vi().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(d).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.a7}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,c,d,_,b,M,T,I,R,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:b,tileSize:this.tileSize,pixelPosMatrix:R,transform:T,params:M,queryPadding:this.queryPadding*I,getElevation:F},t,r,c):{}}querySourceFeatures(t,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),_=r&&r.sourceLayer?r.sourceLayer:"",b=d._geojsonTileLayer||d[_];if(!b)return;const M=o.a9(r&&r.filter),{z:T,x:I,y:R}=this.tileID.canonical,F={z:T,x:I,y:R};for(let O=0;O<b.length;O++){const G=b.feature(O);if(M.needGeometry){const J=o.aa(G,!0);if(!M.filter(new o.F(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!M.filter(new o.F(this.tileID.overscaledZ),G))continue;const q=c.getId(G,_),Q=new o.ab(G,T,I,R,q);Q.tile=F,t.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const c=o.ac(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(r)if(this.expirationTime<r)d=!0;else{const _=this.expirationTime-r;_?this.expirationTime=c+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const _=this.buckets[d],b=_.layers[0].sourceLayer||"_geojsonTileLayer",M=c[b],T=t[b];if(!M||!T||Object.keys(T).length===0)continue;_.update(T,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=r&&r.style&&r.style.getLayer(d);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<D.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=D.now()+t}setDependencies(t,r){const c={};for(const d of r)c[d]=!0;this.dependencies[t]=c}hasDependency(t,r){for(const c of t){const d=this.dependencies[c];if(d){for(const _ of r)if(d[_])return!0}}return!1}}class br{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,c){const d=t.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const _={value:r,timeout:void 0};if(c!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},c)),this.data[d].push(_),this.order.push(d),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const c=t.wrapped().key,d=r===void 0?0:this.data[c].indexOf(r),_=this.data[c][d];return this.data[c].splice(d,1),_.timeout&&clearTimeout(_.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const c in this.data)for(const d of this.data[c])t(d.value)||r.push(d);for(const c of r)this.remove(c.value.tileID,c)}}class ni{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,c){const d=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},o.e(this.stateChanges[t][d],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==d&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][d]===null){this.deletedStates[t][d]={};for(const _ in this.state[t][d])c[_]||(this.deletedStates[t][d][_]=null)}else for(const _ in c)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][_]===null&&delete this.deletedStates[t][d][_]}removeFeatureState(t,r,c){if(this.deletedStates[t]===null)return;const d=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&r!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][c]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(c in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][c]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}getState(t,r){const c=String(r),d=o.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][r];if(_===null)return{};for(const b in _)delete d[b]}return d}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const b in this.stateChanges[d])this.state[d][b]||(this.state[d][b]={}),o.e(this.state[d][b],this.stateChanges[d][b]),_[b]=this.state[d][b];c[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const b in this.state[d])_[b]={},this.state[d][b]={};else for(const b in this.deletedStates[d]){if(this.deletedStates[d][b]===null)this.state[d][b]={};else for(const M of Object.keys(this.deletedStates[d][b]))delete this.state[d][b][M];_[b]=this.state[d][b]}c[d]=c[d]||{},o.e(c[d],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in t)t[d].setFeatureState(c,r)}}const Di=89.25;function yt(g,t){const r=o.ag(t.lat,-85.051129,o.ah);return new o.P(o.V(t.lng)*g,o.U(r)*g)}function Z(g,t){return new o.a0(t.x/g,t.y/g).toLngLat()}function X(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(o.ad(90-g.pitch)),Math.tan(o.ad(Di-g.pitch)))}function Y(g,t){const r=g.canonical,c=t/o.ae(r.z),d=r.x+Math.pow(2,r.z)*g.wrap,_=o.af(new Float64Array(16));return o.M(_,_,[d*c,r.y*c,0]),o.N(_,_,[c/o.$,c/o.$,1]),_}function at(g,t,r,c,d){const _=o.a0.fromLngLat(g,t),b=d*o.ai(1,g.lat),M=b*Math.cos(o.ad(r)),T=Math.sqrt(b*b-M*M),I=T*Math.sin(o.ad(-c)),R=T*Math.cos(o.ad(-c));return new o.a0(_.x+I,_.y+R,_.z+M)}function gt(g,t,r){const c=t.intersectsFrustum(g);if(!r||c===0)return c;const d=t.intersectsPlane(r);return d===0?0:c===2&&d===2?2:1}function bt(g,t,r){let c=0;const d=(r-t)/10;for(let _=0;_<10;_++)c+=d*Math.pow(Math.cos(t+(_+.5)/10*(r-t)),g);return c}function Tt(g,t){return function(r,c,d,_,b){const M=2*((g-1)/o.aj(Math.cos(o.ad(Di-b))/Math.cos(o.ad(Di)))-1),T=Math.acos(d/_),I=2*bt(M-1,0,o.ad(b/2)),R=Math.min(o.ad(Di),T+o.ad(b/2)),F=bt(M-1,Math.min(R,T-o.ad(b/2)),R),O=Math.atan(c/d),G=Math.hypot(c,d);let q=r;return q+=o.aj(_/G/Math.max(.5,Math.cos(o.ad(b/2)))),q+=M*o.aj(Math.cos(O))/2,q-=o.aj(Math.max(1,F/I/t))/2,q}}const vt=Tt(9.314,3);function zt(g,t){const r=(t.roundZoom?Math.round:Math.floor)(g.zoom+o.aj(g.tileSize/t.tileSize));return Math.max(0,r)}function At(g,t){const r=g.getCameraFrustum(),c=g.getClippingPlane(),d=g.screenPointToMercatorCoordinate(g.getCameraPoint()),_=o.a0.fromLngLat(g.center,g.elevation);d.z=_.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const b=g.getCoveringTilesDetailsProvider(),M=b.allowVariableZoom(g,t),T=zt(g,t),I=t.minzoom||0,R=t.maxzoom!==void 0?t.maxzoom:g.maxZoom,F=Math.min(Math.max(0,T),R),O=Math.pow(2,F),G=[O*d.x,O*d.y,0],q=[O*_.x,O*_.y,0],Q=Math.hypot(_.x-d.x,_.y-d.y),J=Math.abs(_.z-d.z),tt=Math.hypot(Q,J),st=ut=>({zoom:0,x:0,y:0,wrap:ut,fullyVisible:!1}),ht=[],nt=[];if(g.renderWorldCopies&&b.allowWorldCopies())for(let ut=1;ut<=3;ut++)ht.push(st(-ut)),ht.push(st(ut));for(ht.push(st(0));ht.length>0;){const ut=ht.pop(),mt=ut.x,ot=ut.y;let xt=ut.fullyVisible;const It={x:mt,y:ot,z:ut.zoom},St=b.getTileBoundingVolume(It,ut.wrap,g.elevation,t);if(!xt){const Jt=gt(r,St,c);if(Jt===0)continue;xt=Jt===2}const Pt=b.distanceToTile2d(d.x,d.y,It,St);let Ct=T;M&&(Ct=(t.calculateTileZoom||vt)(g.zoom+o.aj(g.tileSize/t.tileSize),Pt,J,tt,g.fov)),Ct=(t.roundZoom?Math.round:Math.floor)(Ct),Ct=Math.max(0,Ct);const te=Math.min(Ct,R);if(ut.wrap=b.getWrap(_,It,ut.wrap),ut.zoom>=te){if(ut.zoom<I)continue;const Jt=F-ut.zoom,Vt=G[0]-.5-(mt<<Jt),he=G[1]-.5-(ot<<Jt),Ve=t.reparseOverscaled?Math.max(ut.zoom,Ct):ut.zoom;nt.push({tileID:new o.Z(ut.zoom===R?Ve:ut.zoom,ut.wrap,ut.zoom,mt,ot),distanceSq:o.ak([q[0]-.5-mt,q[1]-.5-ot]),tileDistanceToCamera:Math.sqrt(Vt*Vt+he*he)})}else for(let Jt=0;Jt<4;Jt++)ht.push({zoom:ut.zoom+1,x:(mt<<1)+Jt%2,y:(ot<<1)+(Jt>>1),wrap:ut.wrap,fullyVisible:xt})}return nt.sort((ut,mt)=>ut.distanceSq-mt.distanceSq).map(ut=>ut.tileID)}const wt=o.a1.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class Bt extends o.E{constructor(t,r,c){super(),this.id=t,this.dispatcher=c,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,_,b,M)=>{const T=new(Ae(_.type))(d,_,b,M);if(T.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${T.id}`);return T})(t,r,c,this),this._tiles={},this._cache=new br(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ni,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r,c){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,r,c)}catch(d){t.state="errored",d.status!==404?this._source.fire(new o.k(d,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new o.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(pt).map(t=>t.key)}getRenderableIds(t){const r=[];for(const c in this._tiles)this._isIdRenderable(c,t)&&r.push(this._tiles[c]);return t?r.sort((c,d)=>{const _=c.tileID,b=d.tileID,M=new o.P(_.canonical.x,_.canonical.y)._rotate(-this.transform.bearingInRadians),T=new o.P(b.canonical.x,b.canonical.y)._rotate(-this.transform.bearingInRadians);return _.overscaledZ-b.overscaledZ||T.y-M.y||T.x-M.x}).map(c=>c.tileID.key):r.map(c=>c.tileID).sort(pt).map(c=>c.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)t?this._reloadTile(r,"expired"):this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(t,r){return o._(this,void 0,void 0,function*(){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=r),yield this._loadTile(c,t,r))})}_tileLoaded(t,r,c){t.timeAdded=D.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const r=this.getRenderableIds();for(let d=0;d<r.length;d++){const _=r[d];if(t.neighboringTiles&&t.neighboringTiles[_]){const b=this.getTileByID(_);c(t,b),c(b,t)}}function c(d,_){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let b=_.tileID.canonical.x-d.tileID.canonical.x;const M=_.tileID.canonical.y-d.tileID.canonical.y,T=Math.pow(2,d.tileID.canonical.z),I=_.tileID.key;b===0&&M===0||Math.abs(M)>1||(Math.abs(b)>1&&(Math.abs(b+T)===1?b+=T:Math.abs(b-T)===1&&(b-=T)),_.dem&&d.dem&&(d.dem.backfillBorder(_.dem,b,M),d.neighboringTiles&&d.neighboringTiles[I]&&(d.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,c,d){for(const _ in this._tiles){let b=this._tiles[_];if(d[_]||!b.hasData()||b.tileID.overscaledZ<=r||b.tileID.overscaledZ>c)continue;let M=b.tileID;for(;b&&b.tileID.overscaledZ>r+1;){const I=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[I.key],b&&b.hasData()&&(M=I)}let T=M;for(;T.overscaledZ>r;)if(T=T.scaledTo(T.overscaledZ-1),t[T.key]||t[T.canonical.key]){d[M.key]=M;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=r?c:null}for(let c=t.overscaledZ-1;c>=r;c--){const d=t.scaledTo(c),_=this._getLoadedTile(d);if(_)return _}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,d=Math.floor(r*c*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(_)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const c={};for(const d in this._tiles){const _=this._tiles[d];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),c[_.tileID.key]=_}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(t,r,c,d,_,b){const M={},T={},I=Object.keys(t),R=D.now();for(const F of I){const O=t[F],G=this._tiles[F];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=R)continue;const q=this.findLoadedParent(O,r),Q=this.findLoadedSibling(O),J=q||Q||null;J&&(this._addTile(J.tileID),M[J.tileID.key]=J.tileID),T[F]=O}this._retainLoadedChildren(T,d,c,t);for(const F in M)t[F]||(this._coveredTiles[F]=!0,t[F]=M[F]);if(b){const F={},O={};for(const G of _)this._tiles[G.key].hasData()?F[G.key]=G:O[G.key]=G;for(const G in O){const q=O[G].children(this._source.maxzoom);this._tiles[q[0].key]&&this._tiles[q[1].key]&&this._tiles[q[2].key]&&this._tiles[q[3].key]&&(F[q[0].key]=t[q[0].key]=q[0],F[q[1].key]=t[q[1].key]=q[1],F[q[2].key]=t[q[2].key]=q[2],F[q[3].key]=t[q[3].key]=q[3],delete O[G])}for(const G in O){const q=O[G],Q=this.findLoadedParent(q,this._source.minzoom),J=this.findLoadedSibling(q),tt=Q||J||null;if(tt){F[tt.tileID.key]=t[tt.tileID.key]=tt.tileID;for(const st in F)F[st].isChildOf(tt.tileID)&&delete F[st]}}for(const G in this._tiles)F[G]||(this._coveredTiles[G]=!0)}}update(t,r){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=r,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new o.Z(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(c=At(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter(R=>this._source.hasTile(R)))):c=[];const d=zt(t,this._source),_=Math.max(d-Bt.maxOverzooming,this._source.minzoom),b=Math.max(d+Bt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const F of c)if(F.canonical.z>this._source.minzoom){const O=F.scaledTo(F.canonical.z-1);R[O.key]=O;const G=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));R[G.key]=G}c=c.concat(Object.values(R))}const M=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(c,d);ie(this._source.type)&&this._updateCoveredAndRetainedTiles(T,_,b,d,c,r);for(const R in T)this._tiles[R].clearFadeHold();const I=o.al(this._tiles,T);for(const R of I){const F=this._tiles[R];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){var c;const d={},_={},b=Math.max(r-Bt.maxOverzooming,this._source.minzoom),M=Math.max(r+Bt.maxUnderzooming,this._source.minzoom),T={};for(const I of t){const R=this._addTile(I);d[I.key]=I,R.hasData()||r<this._source.maxzoom&&(T[I.key]=I)}this._retainLoadedChildren(T,r,M,d);for(const I of t){let R=this._tiles[I.key];if(R.hasData())continue;if(r+1>this._source.maxzoom){const O=I.children(this._source.maxzoom)[0],G=this.getTile(O);if(G&&G.hasData()){d[O.key]=O;continue}}else{const O=I.children(this._source.maxzoom);if(d[O[0].key]&&d[O[1].key]&&d[O[2].key]&&d[O[3].key])continue}let F=R.wasRequested();for(let O=I.overscaledZ-1;O>=b;--O){const G=I.scaledTo(O);if(_[G.key])break;if(_[G.key]=!0,R=this.getTile(G),!R&&F&&(R=this._addTile(G)),R){const q=R.hasData();if((q||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||F)&&(d[G.key]=G),F=R.wasRequested(),q)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let c,d=this._tiles[t].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}r.push(d.key);const _=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;d=_}for(const _ of r)this._loadedParentTiles[_]=c}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const r=this._tiles[t].tileID,c=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=c}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const c=r;return r||(r=new xr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,t.key,r.state)),r.uses++,this._tiles[t.key]=r,c||this._source.fire(new o.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=r.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}refreshTiles(t){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&t.some(c=>c.equals(this._tiles[r].tileID.canonical))&&this._reloadTile(r,"expired")}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(t){const r=t.sourceDataType;t.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&r==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,r,c){const d=[],_=this.transform;if(!_)return d;const b=_.getCoveringTilesDetailsProvider().allowWorldCopies(),M=c?_.getCameraQueryGeometry(t):t,T=G=>_.screenPointToMercatorCoordinate(G,this.terrain),I=this.transformBbox(t,T,!b),R=this.transformBbox(M,T,!b),F=this.getIds(),O=o.a1.fromPoints(R);for(let G=0;G<F.length;G++){const q=this._tiles[F[G]];if(q.holdingForFade())continue;const Q=b?[q.tileID]:[q.tileID.unwrapTo(-1),q.tileID.unwrapTo(0)],J=Math.pow(2,_.zoom-q.tileID.overscaledZ),tt=r*q.queryPadding*o.$/q.tileSize/J;for(const st of Q){const ht=O.map(nt=>st.getTilePoint(new o.a0(nt.x,nt.y)));if(ht.expandBy(tt),ht.intersects(wt)){const nt=I.map(mt=>st.getTilePoint(mt)),ut=R.map(mt=>st.getTilePoint(mt));d.push({tile:q,tileID:b?st:st.unwrapTo(0),queryGeometry:nt,cameraQueryGeometry:ut,scale:J})}}}return d}transformBbox(t,r,c){let d=t.map(r);if(c){const _=o.a1.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const b=_.map(r);o.a1.fromPoints(d).covers(b)||(d=d.map(M=>M.x>.5?new o.a0(M.x-1,M.y,M.z):M))}return d}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(ie(this._source.type)){const t=D.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=t)return!0}return!1}setFeatureState(t,r,c){this._state.updateState(t=t||"_geojsonTileLayer",r,c)}removeFeatureState(t,r,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,c)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,c){const d=this._tiles[t];d&&d.setDependencies(r,c)}reloadTilesForDependencies(t,r){for(const c in this._tiles)this._tiles[c].hasDependency(t,r)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(t,r))}}function pt(g,t){const r=Math.abs(2*g.wrap)-+(g.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return g.overscaledZ-t.overscaledZ||c-r||t.canonical.y-g.canonical.y||t.canonical.x-g.canonical.x}function ie(g){return g==="raster"||g==="image"||g==="video"}Bt.maxOverzooming=10,Bt.maxUnderzooming=3;class ve{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.ag(t,0,1);let r=1,c=this._distances[r];const d=t*this.paddedLength+this.padding;for(;c<d&&r<this._distances.length;)c=this._distances[++r];const _=r-1,b=this._distances[_],M=c-b,T=M>0?(d-b)/M:0;return this.points[_].mult(1-T).add(this.points[r].mult(T))}}function se(g,t){let r=!0;return g==="always"||g!=="never"&&t!=="never"||(r=!1),r}class ge{constructor(t,r,c){const d=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(r/c);for(let b=0;b<this.xCellCount*this.yCellCount;b++)d.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,c,d,_){this._forEachCell(r,c,d,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(_)}insertCircle(t,r,c,d){this._forEachCell(r-d,c-d,r+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(c),this.circles.push(d)}_insertBoxCell(t,r,c,d,_,b){this.boxCells[_].push(b)}_insertCircleCell(t,r,c,d,_,b){this.circleCells[_].push(b)}_query(t,r,c,d,_,b,M){if(c<0||t>this.width||d<0||r>this.height)return[];const T=[];if(t<=0&&r<=0&&this.width<=c&&this.height<=d){if(_)return[{key:null,x1:t,y1:r,x2:c,y2:d}];for(let I=0;I<this.boxKeys.length;I++)T.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const R=this.circles[3*I],F=this.circles[3*I+1],O=this.circles[3*I+2];T.push({key:this.circleKeys[I],x1:R-O,y1:F-O,x2:R+O,y2:F+O})}}else this._forEachCell(t,r,c,d,this._queryCell,T,{hitTest:_,overlapMode:b,seenUids:{box:{},circle:{}}},M);return T}query(t,r,c,d){return this._query(t,r,c,d,!1,null)}hitTest(t,r,c,d,_,b){return this._query(t,r,c,d,!0,_,b).length>0}hitTestCircle(t,r,c,d,_){const b=t-c,M=t+c,T=r-c,I=r+c;if(M<0||b>this.width||I<0||T>this.height)return!1;const R=[];return this._forEachCell(b,T,M,I,this._queryCellCircle,R,{hitTest:!0,overlapMode:d,circle:{x:t,y:r,radius:c},seenUids:{box:{},circle:{}}},_),R.length>0}_queryCell(t,r,c,d,_,b,M,T){const{seenUids:I,hitTest:R,overlapMode:F}=M,O=this.boxCells[_];if(O!==null){const q=this.bboxes;for(const Q of O)if(!I.box[Q]){I.box[Q]=!0;const J=4*Q,tt=this.boxKeys[Q];if(t<=q[J+2]&&r<=q[J+3]&&c>=q[J+0]&&d>=q[J+1]&&(!T||T(tt))&&(!R||!se(F,tt.overlapMode))&&(b.push({key:tt,x1:q[J],y1:q[J+1],x2:q[J+2],y2:q[J+3]}),R))return!0}}const G=this.circleCells[_];if(G!==null){const q=this.circles;for(const Q of G)if(!I.circle[Q]){I.circle[Q]=!0;const J=3*Q,tt=this.circleKeys[Q];if(this._circleAndRectCollide(q[J],q[J+1],q[J+2],t,r,c,d)&&(!T||T(tt))&&(!R||!se(F,tt.overlapMode))){const st=q[J],ht=q[J+1],nt=q[J+2];if(b.push({key:tt,x1:st-nt,y1:ht-nt,x2:st+nt,y2:ht+nt}),R)return!0}}}return!1}_queryCellCircle(t,r,c,d,_,b,M,T){const{circle:I,seenUids:R,overlapMode:F}=M,O=this.boxCells[_];if(O!==null){const q=this.bboxes;for(const Q of O)if(!R.box[Q]){R.box[Q]=!0;const J=4*Q,tt=this.boxKeys[Q];if(this._circleAndRectCollide(I.x,I.y,I.radius,q[J+0],q[J+1],q[J+2],q[J+3])&&(!T||T(tt))&&!se(F,tt.overlapMode))return b.push(!0),!0}}const G=this.circleCells[_];if(G!==null){const q=this.circles;for(const Q of G)if(!R.circle[Q]){R.circle[Q]=!0;const J=3*Q,tt=this.circleKeys[Q];if(this._circlesCollide(q[J],q[J+1],q[J+2],I.x,I.y,I.radius)&&(!T||T(tt))&&!se(F,tt.overlapMode))return b.push(!0),!0}}}_forEachCell(t,r,c,d,_,b,M,T){const I=this._convertToXCellCoord(t),R=this._convertToYCellCoord(r),F=this._convertToXCellCoord(c),O=this._convertToYCellCoord(d);for(let G=I;G<=F;G++)for(let q=R;q<=O;q++)if(_.call(this,t,r,c,d,this.xCellCount*q+G,b,M,T))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,c,d,_,b){const M=d-t,T=_-r,I=c+b;return I*I>M*M+T*T}_circleAndRectCollide(t,r,c,d,_,b,M){const T=(b-d)/2,I=Math.abs(t-(d+T));if(I>T+c)return!1;const R=(M-_)/2,F=Math.abs(r-(_+R));if(F>R+c)return!1;if(I<=T||F<=R)return!0;const O=I-T,G=F-R;return O*O+G*G<=c*c}}function Te(g,t,r){const c=o.L();if(!g){const{vecSouth:F,vecEast:O}=hi(t),G=A();G[0]=O[0],G[1]=O[1],G[2]=F[0],G[3]=F[1],d=G,(R=(b=(_=G)[0])*(I=_[3])-(T=_[2])*(M=_[1]))&&(d[0]=I*(R=1/R),d[1]=-M*R,d[2]=-T*R,d[3]=b*R),c[0]=G[0],c[1]=G[1],c[4]=G[2],c[5]=G[3]}var d,_,b,M,T,I,R;return o.N(c,c,[1/r,1/r,1]),c}function fi(g,t,r,c){if(g){const d=o.L();if(!t){const{vecSouth:_,vecEast:b}=hi(r);d[0]=b[0],d[1]=b[1],d[4]=_[0],d[5]=_[1]}return o.N(d,d,[c,c,1]),d}return r.pixelsToClipSpaceMatrix}function hi(g){const t=Math.cos(g.rollInRadians),r=Math.sin(g.rollInRadians),c=Math.cos(g.pitchInRadians),d=Math.cos(g.bearingInRadians),_=Math.sin(g.bearingInRadians),b=o.aq();b[0]=-d*c*r-_*t,b[1]=-_*c*r+d*t;const M=o.ar(b);M<1e-9?o.as(b):o.at(b,b,1/M);const T=o.aq();T[0]=d*c*t-_*r,T[1]=_*c*t+d*r;const I=o.ar(T);return I<1e-9?o.as(T):o.at(T,T,1/I),{vecEast:T,vecSouth:b}}function ti(g,t,r,c){let d;c?(d=[g,t,c(g,t),1],o.av(d,d,r)):(d=[g,t,0,1],vn(d,d,r));const _=d[3];return{point:new o.P(d[0]/_,d[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function be(g,t){return .5+g/t*.5}function qe(g,t){return g.x>=-t[0]&&g.x<=t[0]&&g.y>=-t[1]&&g.y<=t[1]}function qi(g,t,r,c,d,_,b,M,T,I,R,F,O){const G=r?g.textSizeData:g.iconSizeData,q=o.am(G,t.transform.zoom),Q=[256/t.width*2+1,256/t.height*2+1],J=r?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;J.clear();const tt=g.lineVertexArray,st=r?g.text.placedSymbolArray:g.icon.placedSymbolArray,ht=t.transform.width/t.transform.height;let nt=!1;for(let ut=0;ut<st.length;ut++){const mt=st.get(ut);if(mt.hidden||mt.writingMode===o.an.vertical&&!nt){zs(mt.numGlyphs,J);continue}nt=!1;const ot=new o.P(mt.anchorX,mt.anchorY),xt={getElevation:O,pitchedLabelPlaneMatrix:c,lineVertexArray:tt,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:ot,unwrappedTileID:T,width:I,height:R,translation:F},It=Le(mt.anchorX,mt.anchorY,xt);if(!qe(It.point,Q)){zs(mt.numGlyphs,J);continue}const St=be(t.transform.cameraToCenterDistance,It.signedDistanceFromCamera),Pt=o.ao(G,q,mt),Ct=_?Pt*t.transform.getPitchedTextCorrection(mt.anchorX,mt.anchorY,T)/St:Pt*St,te=Mi({projectionContext:xt,pitchedLabelPlaneMatrixInverse:d,symbol:mt,fontSize:Ct,flip:!1,keepUpright:b,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:J,aspectRatio:ht,rotateToLine:M});nt=te.useVertical,(te.notEnoughRoom||nt||te.needsFlipping&&Mi({projectionContext:xt,pitchedLabelPlaneMatrixInverse:d,symbol:mt,fontSize:Ct,flip:!0,keepUpright:b,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:J,aspectRatio:ht,rotateToLine:M}).notEnoughRoom)&&zs(mt.numGlyphs,J)}r?g.text.dynamicLayoutVertexBuffer.updateData(J):g.icon.dynamicLayoutVertexBuffer.updateData(J)}function Ht(g,t,r,c,d,_,b,M){const T=_.glyphStartIndex+_.numGlyphs,I=_.lineStartIndex,R=_.lineStartIndex+_.lineLength,F=t.getoffsetX(_.glyphStartIndex),O=t.getoffsetX(T-1),G=Br(g*F,r,c,d,_.segment,I,R,M,b);if(!G)return null;const q=Br(g*O,r,c,d,_.segment,I,R,M,b);return q?M.projectionCache.anyProjectionOccluded?null:{first:G,last:q}:null}function Hi(g,t,r,c){return g===o.an.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*c?{useVertical:!0}:(g===o.an.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function Mi(g){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:r,symbol:c,fontSize:d,flip:_,keepUpright:b,glyphOffsetArray:M,dynamicLayoutVertexArray:T,aspectRatio:I,rotateToLine:R}=g,F=d/24,O=c.lineOffsetX*F,G=c.lineOffsetY*F;let q;if(c.numGlyphs>1){const Q=c.glyphStartIndex+c.numGlyphs,J=c.lineStartIndex,tt=c.lineStartIndex+c.lineLength,st=Ht(F,M,O,G,_,c,R,t);if(!st)return{notEnoughRoom:!0};const ht=ke(st.first.point.x,st.first.point.y,t,r),nt=ke(st.last.point.x,st.last.point.y,t,r);if(b&&!_){const ut=Hi(c.writingMode,ht,nt,I);if(ut)return ut}q=[st.first];for(let ut=c.glyphStartIndex+1;ut<Q-1;ut++){const mt=Br(F*M.getoffsetX(ut),O,G,_,c.segment,J,tt,t,R);if(!mt)return{notEnoughRoom:!0};q.push(mt)}q.push(st.last)}else{if(b&&!_){const J=Yt(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,tt=c.lineStartIndex+c.segment+1,st=new o.P(t.lineVertexArray.getx(tt),t.lineVertexArray.gety(tt)),ht=Yt(st.x,st.y,t),nt=ht.signedDistanceFromCamera>0?ht.point:Fr(t.tileAnchorPoint,st,J,1,t),ut=ke(J.x,J.y,t,r),mt=ke(nt.x,nt.y,t,r),ot=Hi(c.writingMode,ut,mt,I);if(ot)return ot}const Q=Br(F*M.getoffsetX(c.glyphStartIndex),O,G,_,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,t,R);if(!Q||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};q=[Q]}for(const Q of q)o.au(T,Q.point,Q.angle);return{}}function Fr(g,t,r,c,d){const _=g.add(g.sub(t)._unit()),b=Yt(_.x,_.y,d).point,M=r.sub(b);return r.add(M._mult(c/M.mag()))}function ts(g,t,r){const c=t.projectionCache;if(c.projections[g])return c.projections[g];const d=new o.P(t.lineVertexArray.getx(g),t.lineVertexArray.gety(g)),_=Yt(d.x,d.y,t);if(_.signedDistanceFromCamera>0)return c.projections[g]=_.point,c.anyProjectionOccluded=c.anyProjectionOccluded||_.isOccluded,_.point;const b=g-r.direction;return Fr(r.distanceFromAnchor===0?t.tileAnchorPoint:new o.P(t.lineVertexArray.getx(b),t.lineVertexArray.gety(b)),d,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,t)}function Yt(g,t,r){const c=g+r.translation[0],d=t+r.translation[1];let _;return r.pitchWithMap?(_=ti(c,d,r.pitchedLabelPlaneMatrix,r.getElevation),_.isOccluded=!1):(_=r.transform.projectTileCoordinates(c,d,r.unwrappedTileID,r.getElevation),_.point.x=(.5*_.point.x+.5)*r.width,_.point.y=(.5*-_.point.y+.5)*r.height),_}function ke(g,t,r,c){if(r.pitchWithMap){const d=[g,t,0,1];return o.av(d,d,c),r.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],r.unwrappedTileID,r.getElevation).point}return{x:g/r.width*2-1,y:t/r.height*2-1}}function Le(g,t,r){return r.transform.projectTileCoordinates(g,t,r.unwrappedTileID,r.getElevation)}function rr(g,t,r){return g._unit()._perp()._mult(t*r)}function Ds(g,t,r,c,d,_,b,M,T){if(M.projectionCache.offsets[g])return M.projectionCache.offsets[g];const I=r.add(t);if(g+T.direction<c||g+T.direction>=d)return M.projectionCache.offsets[g]=I,I;const R=ts(g+T.direction,M,T),F=rr(R.sub(r),b,T.direction),O=r.add(F),G=R.add(F);return M.projectionCache.offsets[g]=o.aw(_,I,O,G)||I,M.projectionCache.offsets[g]}function Br(g,t,r,c,d,_,b,M,T){const I=c?g-t:g+t;let R=I>0?1:-1,F=0;c&&(R*=-1,F=Math.PI),R<0&&(F+=Math.PI);let O,G=R>0?_+d:_+d+1;M.projectionCache.cachedAnchorPoint?O=M.projectionCache.cachedAnchorPoint:(O=Yt(M.tileAnchorPoint.x,M.tileAnchorPoint.y,M).point,M.projectionCache.cachedAnchorPoint=O);let q,Q,J=O,tt=O,st=0,ht=0;const nt=Math.abs(I),ut=[];let mt;for(;st+ht<=nt;){if(G+=R,G<_||G>=b)return null;st+=ht,tt=J,Q=q;const It={absOffsetX:nt,direction:R,distanceFromAnchor:st,previousVertex:tt};if(J=ts(G,M,It),r===0)ut.push(tt),mt=J.sub(tt);else{let St;const Pt=J.sub(tt);St=Pt.mag()===0?rr(ts(G+R,M,It).sub(J),r,R):rr(Pt,r,R),Q||(Q=tt.add(St)),q=Ds(G,St,J,_,b,Q,r,M,It),ut.push(Q),mt=q.sub(Q)}ht=mt.mag()}const ot=mt._mult((nt-st)/ht)._add(Q||tt),xt=F+Math.atan2(J.y-tt.y,J.x-tt.x);return ut.push(ot),{point:ot,angle:T?xt:0,path:ut}}const Oe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function zs(g,t){for(let r=0;r<g;r++){const c=t.length;t.resize(c+4),t.float32.set(Oe,3*c)}}function vn(g,t,r){const c=t[0],d=t[1];return g[0]=r[0]*c+r[4]*d+r[12],g[1]=r[1]*c+r[5]*d+r[13],g[3]=r[3]*c+r[7]*d+r[15],g}const Zi=100;class Pa{constructor(t,r=new ge(t.width+200,t.height+200,25),c=new ge(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=c,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Zi,this.screenBottomBoundary=t.height+Zi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,c,d,_,b,M,T,I,R,F,O){const G=this.projectAndGetPerspectiveRatio(t.anchorPointX+T[0],t.anchorPointY+T[1],_,R,O),q=c*G.perspectiveRatio;let Q;if(b||M)Q=this._projectCollisionBox(t,q,d,_,b,M,T,G,R,F,O);else{const mt=G.x+(F?F.x*q:0),ot=G.y+(F?F.y*q:0);Q={allPointsOccluded:!1,box:[mt+t.x1*q,ot+t.y1*q,mt+t.x2*q,ot+t.y2*q]}}const[J,tt,st,ht]=Q.box,nt=b?Q.allPointsOccluded:G.isOccluded;let ut=nt;return ut||(ut=G.perspectiveRatio<this.perspectiveRatioCutoff),ut||(ut=!this.isInsideGrid(J,tt,st,ht)),ut||r!=="always"&&this.grid.hitTest(J,tt,st,ht,r,I)?{box:[J,tt,st,ht],placeable:!1,offscreen:!1,occluded:nt}:{box:[J,tt,st,ht],placeable:!0,offscreen:this.isOffscreen(J,tt,st,ht),occluded:nt}}placeCollisionCircles(t,r,c,d,_,b,M,T,I,R,F,O,G,q){const Q=[],J=new o.P(r.anchorX,r.anchorY),tt=this.getPerspectiveRatio(J.x,J.y,b,q),st=(I?_*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,b)/tt:_*tt)/o.aA,ht={getElevation:q,pitchedLabelPlaneMatrix:M,lineVertexArray:c,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:J,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:G},nt=Ht(st,d,r.lineOffsetX*st,r.lineOffsetY*st,!1,r,!1,ht);let ut=!1,mt=!1,ot=!0;if(nt){const xt=.5*F*tt+O,It=new o.P(-100,-100),St=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Pt=new ve,Ct=nt.first,te=nt.last;let Jt=[];for(let Ve=Ct.path.length-1;Ve>=1;Ve--)Jt.push(Ct.path[Ve]);for(let Ve=1;Ve<te.path.length;Ve++)Jt.push(te.path[Ve]);const Vt=2.5*xt;if(I){const Ve=this.projectPathToScreenSpace(Jt,ht);Jt=Ve.some(di=>di.signedDistanceFromCamera<=0)?[]:Ve.map(di=>di.point)}let he=[];if(Jt.length>0){const Ve=Jt[0].clone(),di=Jt[0].clone();for(let Oi=1;Oi<Jt.length;Oi++)Ve.x=Math.min(Ve.x,Jt[Oi].x),Ve.y=Math.min(Ve.y,Jt[Oi].y),di.x=Math.max(di.x,Jt[Oi].x),di.y=Math.max(di.y,Jt[Oi].y);he=Ve.x>=It.x&&di.x<=St.x&&Ve.y>=It.y&&di.y<=St.y?[Jt]:di.x<It.x||Ve.x>St.x||di.y<It.y||Ve.y>St.y?[]:o.ax([Jt],It.x,It.y,St.x,St.y)}for(const Ve of he){Pt.reset(Ve,.25*xt);let di=0;di=Pt.length<=.5*xt?1:Math.ceil(Pt.paddedLength/Vt)+1;for(let Oi=0;Oi<di;Oi++){const mi=Oi/Math.max(di-1,1),Fi=Pt.lerp(mi),yi=Fi.x+Zi,gi=Fi.y+Zi;Q.push(yi,gi,xt,0);const vi=yi-xt,fr=gi-xt,ai=yi+xt,ar=gi+xt;if(ot=ot&&this.isOffscreen(vi,fr,ai,ar),mt=mt||this.isInsideGrid(vi,fr,ai,ar),t!=="always"&&this.grid.hitTestCircle(yi,gi,xt,t,R)&&(ut=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ut}}}}return{circles:!T&&ut||!mt||tt<this.perspectiveRatioCutoff?[]:Q,offscreen:ot,collisionDetected:ut}}projectPathToScreenSpace(t,r){const c=function(d,_){const b=o.L();return o.ap(b,_.pitchedLabelPlaneMatrix),d.map(M=>{const T=ti(M.x,M.y,b,_.getElevation),I=_.transform.projectTileCoordinates(T.point.x,T.point.y,_.unwrappedTileID,_.getElevation);return I.point.x=(.5*I.point.x+.5)*_.width,I.point.y=(.5*-I.point.y+.5)*_.height,I})}(t,r);return function(d){let _=0,b=0,M=0,T=0;for(let I=0;I<d.length;I++)d[I].isOccluded?(M=I+1,T=0):(T++,T>b&&(b=T,_=M));return d.slice(_,_+b)}(c)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],c=new o.a1;for(const F of t){const O=new o.P(F.x+Zi,F.y+Zi);c.extend(O),r.push(O)}const{minX:d,minY:_,maxX:b,maxY:M}=c,T=this.grid.query(d,_,b,M).concat(this.ignoredGrid.query(d,_,b,M)),I={},R={};for(const F of T){const O=F.key;if(I[O.bucketInstanceId]===void 0&&(I[O.bucketInstanceId]={}),I[O.bucketInstanceId][O.featureIndex])continue;const G=[new o.P(F.x1,F.y1),new o.P(F.x2,F.y1),new o.P(F.x2,F.y2),new o.P(F.x1,F.y2)];o.ay(r,G)&&(I[O.bucketInstanceId][O.featureIndex]=!0,R[O.bucketInstanceId]===void 0&&(R[O.bucketInstanceId]=[]),R[O.bucketInstanceId].push(O.featureIndex))}return R}insertCollisionBox(t,r,c,d,_,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:b,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,c,d,_,b){const M=c?this.ignoredGrid:this.grid,T={bucketInstanceId:d,featureIndex:_,collisionGroupID:b,overlapMode:r};for(let I=0;I<t.length;I+=4)M.insertCircle(T,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,r,c,d,_){if(_){let b;d?(b=[t,r,d(t,r),1],o.av(b,b,_)):(b=[t,r,0,1],vn(b,b,_));const M=b[3];return{x:(b[0]/M+1)/2*this.transform.width+Zi,y:(-b[1]/M+1)/2*this.transform.height+Zi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M*.5,isOccluded:!1,signedDistanceFromCamera:M}}{const b=this.transform.projectTileCoordinates(t,r,c,d);return{x:(b.point.x+1)/2*this.transform.width+Zi,y:(1-b.point.y)/2*this.transform.height+Zi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5,isOccluded:b.isOccluded,signedDistanceFromCamera:b.signedDistanceFromCamera}}}getPerspectiveRatio(t,r,c,d){const _=this.transform.projectTileCoordinates(t,r,c,d);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,r,c,d){return c<Zi||t>=this.screenRightBoundary||d<Zi||r>this.screenBottomBoundary}isInsideGrid(t,r,c,d){return c>=0&&t<this.gridRightBoundary&&d>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=o.af([]);return o.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,r,c,d,_,b,M,T,I,R,F){let O=1,G=0,q=0,Q=1;const J=t.anchorPointX+M[0],tt=t.anchorPointY+M[1];if(b&&!_){const Jt=this.projectAndGetPerspectiveRatio(J+1,tt,d,I,F),Vt=Jt.x-T.x,he=Math.atan((Jt.y-T.y)/Vt)+(Vt<0?Math.PI:0),Ve=Math.sin(he),di=Math.cos(he);O=di,G=Ve,q=-Ve,Q=di}else if(!b&&_){const Jt=hi(this.transform);O=Jt.vecEast[0],G=Jt.vecEast[1],q=Jt.vecSouth[0],Q=Jt.vecSouth[1]}let st=T.x,ht=T.y,nt=r;_&&(st=J,ht=tt,nt=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),nt*=this.transform.getPitchedTextCorrection(J,tt,d),R||(nt*=o.ag(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),R&&(st+=O*R.x*nt+q*R.y*nt,ht+=G*R.x*nt+Q*R.y*nt);const ut=t.x1*nt,mt=t.x2*nt,ot=(ut+mt)/2,xt=t.y1*nt,It=t.y2*nt,St=(xt+It)/2,Pt=[{offsetX:ut,offsetY:xt},{offsetX:ot,offsetY:xt},{offsetX:mt,offsetY:xt},{offsetX:mt,offsetY:St},{offsetX:mt,offsetY:It},{offsetX:ot,offsetY:It},{offsetX:ut,offsetY:It},{offsetX:ut,offsetY:St}];let Ct=[];for(const{offsetX:Jt,offsetY:Vt}of Pt)Ct.push(new o.P(st+O*Jt+q*Vt,ht+G*Jt+Q*Vt));let te=!1;if(_){const Jt=Ct.map(Vt=>this.projectAndGetPerspectiveRatio(Vt.x,Vt.y,d,I,F));te=Jt.some(Vt=>!Vt.isOccluded),Ct=Jt.map(Vt=>new o.P(Vt.x,Vt.y))}else te=!0;return{box:o.az(Ct),allPointsOccluded:!te}}}class Ea{constructor(t,r,c,d){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):d&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class ks{constructor(t,r,c,d,_){this.text=new Ea(t?t.text:null,r,c,_),this.icon=new Ea(t?t.icon:null,r,d,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ia{constructor(t,r,c){this.text=t,this.icon=r,this.skipFade=c}}class qr{constructor(t,r,c,d,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=_}}class zi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[t]}}function Vc(g,t,r,c,d){const{horizontalAlign:_,verticalAlign:b}=o.aG(g);return new o.P(-(_-.5)*t+c[0]*d,-(b-.5)*r+c[1]*d)}class Ca{constructor(t,r,c,d,_){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new Pa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new zi(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const r=this.terrain;return r?(c,d)=>r.getElevation(t,c,d):null}getBucketParts(t,r,c,d){const _=c.getBucket(r),b=c.latestFeatureIndex;if(!_||!b||r.id!==_.layerIds[0])return;const M=c.collisionBoxArray,T=_.layers[0].layout,I=_.layers[0].paint,R=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),F=c.tileSize/o.$,O=c.tileID.toUnwrapped(),G=T.get("text-rotation-alignment")==="map",q=o.aB(c,1,this.transform.zoom),Q=o.aC(this.collisionIndex.transform,c,I.get("text-translate"),I.get("text-translate-anchor")),J=o.aC(this.collisionIndex.transform,c,I.get("icon-translate"),I.get("icon-translate-anchor")),tt=Te(G,this.transform,q);this.retainedQueryData[_.bucketInstanceId]=new qr(_.bucketInstanceId,b,_.sourceLayerIndex,_.index,c.tileID);const st={bucket:_,layout:T,translationText:Q,translationIcon:J,unwrappedTileID:O,pitchedLabelPlaneMatrix:tt,scale:R,textPixelRatio:F,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.am(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(d)for(const ht of _.sortKeyRanges){const{sortKey:nt,symbolInstanceStart:ut,symbolInstanceEnd:mt}=ht;t.push({sortKey:nt,symbolInstanceStart:ut,symbolInstanceEnd:mt,parameters:st})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:st})}attemptAnchorPlacement(t,r,c,d,_,b,M,T,I,R,F,O,G,q,Q,J,tt,st,ht,nt){const ut=o.aD[t.textAnchor],mt=[t.textOffset0,t.textOffset1],ot=Vc(ut,c,d,mt,_),xt=this.collisionIndex.placeCollisionBox(r,O,T,I,R,M,b,J,F.predicate,ht,ot,nt);if((!st||this.collisionIndex.placeCollisionBox(st,O,T,I,R,M,b,tt,F.predicate,ht,ot,nt).placeable)&&xt.placeable){let It;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(It=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:mt,width:c,height:d,anchor:ut,textBoxScale:_,prevAnchor:It},this.markUsedJustification(q,ut,G,Q),q.allowVerticalPlacement&&(this.markUsedOrientation(q,Q,G),this.placedOrientations[G.crossTileID]=Q),{shift:ot,placedGlyphBoxes:xt}}}placeLayerBucketPart(t,r,c){const{bucket:d,layout:_,translationText:b,translationIcon:M,unwrappedTileID:T,pitchedLabelPlaneMatrix:I,textPixelRatio:R,holdingForFade:F,collisionBoxArray:O,partiallyEvaluatedTextSize:G,collisionGroup:q}=t.parameters,Q=_.get("text-optional"),J=_.get("icon-optional"),tt=o.aE(_,"text-overlap","text-allow-overlap"),st=tt==="always",ht=o.aE(_,"icon-overlap","icon-allow-overlap"),nt=ht==="always",ut=_.get("text-rotation-alignment")==="map",mt=_.get("text-pitch-alignment")==="map",ot=_.get("icon-text-fit")!=="none",xt=_.get("symbol-z-order")==="viewport-y",It=st&&(nt||!d.hasIconData()||J),St=nt&&(st||!d.hasTextData()||Q);!d.collisionArrays&&O&&d.deserializeCollisionBoxes(O);const Pt=this.retainedQueryData[d.bucketInstanceId].tileID,Ct=this._getTerrainElevationFunc(Pt),te=this.transform.getFastPathSimpleProjectionMatrix(Pt),Jt=(Vt,he,Ve)=>{var di,Oi;if(r[Vt.crossTileID])return;if(F)return void(this.placements[Vt.crossTileID]=new Ia(!1,!1,!1));let mi=!1,Fi=!1,yi=!0,gi=null,vi={box:null,placeable:!1,offscreen:null,occluded:!1},fr={placeable:!1},ai=null,ar=null,pr=null,rn=0,sn=0,nn=0;he.textFeatureIndex?rn=he.textFeatureIndex:Vt.useRuntimeCollisionCircles&&(rn=Vt.featureIndex),he.verticalTextFeatureIndex&&(sn=he.verticalTextFeatureIndex);const Ps=he.textBox;if(Ps){const Ur=$i=>{let Pi=o.an.horizontal;if(d.allowVerticalPlacement&&!$i&&this.prevPlacement){const Rr=this.prevPlacement.placedOrientations[Vt.crossTileID];Rr&&(this.placedOrientations[Vt.crossTileID]=Rr,Pi=Rr,this.markUsedOrientation(d,Pi,Vt))}return Pi},fs=($i,Pi)=>{if(d.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&he.verticalTextBox){for(const Rr of d.writingModes)if(Rr===o.an.vertical?(vi=Pi(),fr=vi):vi=$i(),vi&&vi.placeable)break}else vi=$i()},an=Vt.textAnchorOffsetStartIndex,Rn=Vt.textAnchorOffsetEndIndex;if(Rn===an){const $i=(Pi,Rr)=>{const Qi=this.collisionIndex.placeCollisionBox(Pi,tt,R,Pt,T,mt,ut,b,q.predicate,Ct,void 0,te);return Qi&&Qi.placeable&&(this.markUsedOrientation(d,Rr,Vt),this.placedOrientations[Vt.crossTileID]=Rr),Qi};fs(()=>$i(Ps,o.an.horizontal),()=>{const Pi=he.verticalTextBox;return d.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&Pi?$i(Pi,o.an.vertical):{box:null,offscreen:null}}),Ur(vi&&vi.placeable)}else{let $i=o.aD[(Oi=(di=this.prevPlacement)===null||di===void 0?void 0:di.variableOffsets[Vt.crossTileID])===null||Oi===void 0?void 0:Oi.anchor];const Pi=(Qi,Ou,wf)=>{const Uh=Qi.x2-Qi.x1,ao=Qi.y2-Qi.y1,ua=Vt.textBoxScale,Ns=ot&&ht==="never"?Ou:null;let mr=null,Gs=tt==="never"?1:2,Vh="never";$i&&Gs++;for(let on=0;on<Gs;on++){for(let $h=an;$h<Rn;$h++){const qh=d.textAnchorOffsets.get($h);if($i&&qh.textAnchor!==$i)continue;const oo=this.attemptAnchorPlacement(qh,Qi,Uh,ao,ua,ut,mt,R,Pt,T,q,Vh,Vt,d,wf,b,M,Ns,Ct);if(oo&&(mr=oo.placedGlyphBoxes,mr&&mr.placeable))return mi=!0,gi=oo.shift,mr}$i?$i=null:Vh=tt}return c&&!mr&&(mr={box:this.collisionIndex.placeCollisionBox(Ps,"always",R,Pt,T,mt,ut,b,q.predicate,Ct,void 0,te).box,offscreen:!1,placeable:!1,occluded:!1}),mr};fs(()=>Pi(Ps,he.iconBox,o.an.horizontal),()=>{const Qi=he.verticalTextBox;return d.allowVerticalPlacement&&(!vi||!vi.placeable)&&Vt.numVerticalGlyphVertices>0&&Qi?Pi(Qi,he.verticalIconBox,o.an.vertical):{box:null,occluded:!0,offscreen:null}}),vi&&(mi=vi.placeable,yi=vi.offscreen);const Rr=Ur(vi&&vi.placeable);if(!mi&&this.prevPlacement){const Qi=this.prevPlacement.variableOffsets[Vt.crossTileID];Qi&&(this.variableOffsets[Vt.crossTileID]=Qi,this.markUsedJustification(d,Qi.anchor,Vt,Rr))}}}if(ai=vi,mi=ai&&ai.placeable,yi=ai&&ai.offscreen,Vt.useRuntimeCollisionCircles){const Ur=d.text.placedSymbolArray.get(Vt.centerJustifiedTextSymbolIndex),fs=o.ao(d.textSizeData,G,Ur),an=_.get("text-padding");ar=this.collisionIndex.placeCollisionCircles(tt,Ur,d.lineVertexArray,d.glyphOffsetArray,fs,T,I,c,mt,q.predicate,Vt.collisionCircleDiameter,an,b,Ct),ar.circles.length&&ar.collisionDetected&&!c&&o.w("Collisions detected, but collision boxes are not shown"),mi=st||ar.circles.length>0&&!ar.collisionDetected,yi=yi&&ar.offscreen}if(he.iconFeatureIndex&&(nn=he.iconFeatureIndex),he.iconBox){const Ur=fs=>this.collisionIndex.placeCollisionBox(fs,ht,R,Pt,T,mt,ut,M,q.predicate,Ct,ot&&gi?gi:void 0,te);fr&&fr.placeable&&he.verticalIconBox?(pr=Ur(he.verticalIconBox),Fi=pr.placeable):(pr=Ur(he.iconBox),Fi=pr.placeable),yi=yi&&pr.offscreen}const so=Q||Vt.numHorizontalGlyphVertices===0&&Vt.numVerticalGlyphVertices===0,no=J||Vt.numIconVertices===0;so||no?no?so||(Fi=Fi&&mi):mi=Fi&&mi:Fi=mi=Fi&&mi;const ca=Fi&&pr.placeable;if(mi&&ai.placeable&&this.collisionIndex.insertCollisionBox(ai.box,tt,_.get("text-ignore-placement"),d.bucketInstanceId,fr&&fr.placeable&&sn?sn:rn,q.ID),ca&&this.collisionIndex.insertCollisionBox(pr.box,ht,_.get("icon-ignore-placement"),d.bucketInstanceId,nn,q.ID),ar&&mi&&this.collisionIndex.insertCollisionCircles(ar.circles,tt,_.get("text-ignore-placement"),d.bucketInstanceId,rn,q.ID),c&&this.storeCollisionData(d.bucketInstanceId,Ve,he,ai,pr,ar),Vt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Vt.crossTileID]=new Ia((mi||It)&&!(ai!=null&&ai.occluded),(Fi||St)&&!(pr!=null&&pr.occluded),yi||d.justReloaded),r[Vt.crossTileID]=!0};if(xt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Vt=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let he=Vt.length-1;he>=0;--he){const Ve=Vt[he];Jt(d.symbolInstances.get(Ve),d.collisionArrays[Ve],Ve)}}else for(let Vt=t.symbolInstanceStart;Vt<t.symbolInstanceEnd;Vt++)Jt(d.symbolInstances.get(Vt),d.collisionArrays[Vt],Vt);d.justReloaded=!1}storeCollisionData(t,r,c,d,_,b){if(c.textBox||c.iconBox){let M,T;this.collisionBoxArrays.has(t)?M=this.collisionBoxArrays.get(t):(M=new Map,this.collisionBoxArrays.set(t,M)),M.has(r)?T=M.get(r):(T={text:null,icon:null},M.set(r,T)),c.textBox&&(T.text=d.box),c.iconBox&&(T.icon=_.box)}if(b){let M=this.collisionCircleArrays[t];M===void 0&&(M=this.collisionCircleArrays[t]=[]);for(let T=0;T<b.circles.length;T+=4)M.push(b.circles[T+0]-Zi),M.push(b.circles[T+1]-Zi),M.push(b.circles[T+2]),M.push(b.collisionDetected?1:0)}}markUsedJustification(t,r,c,d){let _;_=d===o.an.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[o.aF(r)];const b=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const M of b)M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=_>=0&&M!==_?0:c.crossTileID)}markUsedOrientation(t,r,c){const d=r===o.an.horizontal||r===o.an.horizontalOnly?r:0,_=r===o.an.vertical?r:0,b=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const M of b)t.text.placedSymbolArray.get(M).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const d=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},b=r?r.variableOffsets:{},M=r?r.placedOrientations:{};for(const T in this.placements){const I=this.placements[T],R=_[T];R?(this.opacities[T]=new ks(R,d,I.text,I.icon),c=c||I.text!==R.text.placed||I.icon!==R.icon.placed):(this.opacities[T]=new ks(null,d,I.text,I.icon,I.skipFade),c=c||I.text||I.icon)}for(const T in _){const I=_[T];if(!this.opacities[T]){const R=new ks(I,d,!1,!1);R.isHidden()||(this.opacities[T]=R,c=c||I.text.placed||I.icon.placed)}}for(const T in b)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=b[T]);for(const T in M)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=M[T]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const c={};for(const d of r){const _=d.getBucket(t);_&&d.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,d.tileID,c,d.collisionBoxArray)}}updateBucketOpacities(t,r,c,d){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],b=_.layout,M=new ks(null,0,!1,!1,!0),T=b.get("text-allow-overlap"),I=b.get("icon-allow-overlap"),R=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=b.get("text-rotation-alignment")==="map",O=b.get("text-pitch-alignment")==="map",G=b.get("icon-text-fit")!=="none",q=new ks(null,0,T&&(I||!t.hasIconData()||b.get("icon-optional")),I&&(T||!t.hasTextData()||b.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const Q=(tt,st,ht)=>{for(let nt=0;nt<st/4;nt++)tt.opacityVertexArray.emplaceBack(ht);tt.hasVisibleVertices=tt.hasVisibleVertices||ht!==Aa},J=this.collisionBoxArrays.get(t.bucketInstanceId);for(let tt=0;tt<t.symbolInstances.length;tt++){const st=t.symbolInstances.get(tt),{numHorizontalGlyphVertices:ht,numVerticalGlyphVertices:nt,crossTileID:ut}=st;let mt=this.opacities[ut];c[ut]?mt=M:mt||(mt=q,this.opacities[ut]=mt),c[ut]=!0;const ot=st.numIconVertices>0,xt=this.placedOrientations[st.crossTileID],It=xt===o.an.vertical,St=xt===o.an.horizontal||xt===o.an.horizontalOnly;if(ht>0||nt>0){const Ct=Xc(mt.text);Q(t.text,ht,It?Aa:Ct),Q(t.text,nt,St?Aa:Ct);const te=mt.text.isHidden();[st.rightJustifiedTextSymbolIndex,st.centerJustifiedTextSymbolIndex,st.leftJustifiedTextSymbolIndex].forEach(he=>{he>=0&&(t.text.placedSymbolArray.get(he).hidden=te||It?1:0)}),st.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(st.verticalPlacedTextSymbolIndex).hidden=te||St?1:0);const Jt=this.variableOffsets[st.crossTileID];Jt&&this.markUsedJustification(t,Jt.anchor,st,xt);const Vt=this.placedOrientations[st.crossTileID];Vt&&(this.markUsedJustification(t,"left",st,Vt),this.markUsedOrientation(t,Vt,st))}if(ot){const Ct=Xc(mt.icon),te=!(G&&st.verticalPlacedIconSymbolIndex&&It);st.placedIconSymbolIndex>=0&&(Q(t.icon,st.numIconVertices,te?Ct:Aa),t.icon.placedSymbolArray.get(st.placedIconSymbolIndex).hidden=mt.icon.isHidden()),st.verticalPlacedIconSymbolIndex>=0&&(Q(t.icon,st.numVerticalIconVertices,te?Aa:Ct),t.icon.placedSymbolArray.get(st.verticalPlacedIconSymbolIndex).hidden=mt.icon.isHidden())}const Pt=J&&J.has(tt)?J.get(tt):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ct=t.collisionArrays[tt];if(Ct){let te=new o.P(0,0);if(Ct.textBox||Ct.verticalTextBox){let Jt=!0;if(R){const Vt=this.variableOffsets[ut];Vt?(te=Vc(Vt.anchor,Vt.width,Vt.height,Vt.textOffset,Vt.textBoxScale),F&&te._rotate(O?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Jt=!1}if(Ct.textBox||Ct.verticalTextBox){let Vt;Ct.textBox&&(Vt=It),Ct.verticalTextBox&&(Vt=St),Eo(t.textCollisionBox.collisionVertexArray,mt.text.placed,!Jt||Vt,Pt.text,te.x,te.y)}}if(Ct.iconBox||Ct.verticalIconBox){const Jt=!!(!St&&Ct.verticalIconBox);let Vt;Ct.iconBox&&(Vt=Jt),Ct.verticalIconBox&&(Vt=!Jt),Eo(t.iconCollisionBox.collisionVertexArray,mt.icon.placed,Vt,Pt.icon,G?te.x:0,G?te.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function Eo(g,t,r,c,d,_){c&&c.length!==0||(c=[0,0,0,0]);const b=c[0]-Zi,M=c[1]-Zi,T=c[2]-Zi,I=c[3]-Zi;g.emplaceBack(t?1:0,r?1:0,d||0,_||0,b,M),g.emplaceBack(t?1:0,r?1:0,d||0,_||0,T,M),g.emplaceBack(t?1:0,r?1:0,d||0,_||0,T,I),g.emplaceBack(t?1:0,r?1:0,d||0,_||0,b,I)}const xn=Math.pow(2,25),Hs=Math.pow(2,24),$c=Math.pow(2,17),qc=Math.pow(2,16),Zc=Math.pow(2,9),Bn=Math.pow(2,8),Wc=Math.pow(2,1);function Xc(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const t=g.placed?1:0,r=Math.floor(127*g.opacity);return r*xn+t*Hs+r*$c+t*qc+r*Zc+t*Bn+r*Wc+t}const Aa=0;class Hd{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,c,d,_){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(b,d,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((M,T)=>M.sortKey-T.sortKey));this._currentPartIndex<b.length;)if(r.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,_())return!0;return!1}}class Hc{constructor(t,r,c,d,_,b,M,T){this.placement=new Ca(t,r,b,M,T),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,r,c){const d=D.now(),_=()=>!this._forceFullPlacement&&D.now()-d>2;for(;this._currentPlacementIndex>=0;){const b=r[t[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=M)&&(!b.maxzoom||b.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Hd(b)),this._inProgressLayer.continuePlacement(c[b.source],this.placement,this._showCollisionBoxes,b,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Nn=512/o.$/2;class Yl{constructor(t,r,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const d=new Map;for(let _=0;_<r.length;_++){const b=r.get(_),M=b.key,T=d.get(M);T?T.push(b):d.set(M,[b])}for(const[_,b]of d){const M={positions:b.map(T=>({x:Math.floor(T.anchorX*Nn),y:Math.floor(T.anchorY*Nn)})),crossTileIDs:b.map(T=>T.crossTileID)};if(M.positions.length>128){const T=new o.aH(M.positions.length,16,Uint16Array);for(const{x:I,y:R}of M.positions)T.add(I,R);T.finish(),delete M.positions,M.index=T}this._symbolsByKey[_]=M}}getScaledCoordinates(t,r){const{x:c,y:d,z:_}=this.tileID.canonical,{x:b,y:M,z:T}=r.canonical,I=Nn/Math.pow(2,T-_),R=(M*o.$+t.anchorY)*I,F=d*o.$*Nn;return{x:Math.floor((b*o.$+t.anchorX)*I-c*o.$*Nn),y:Math.floor(R-F)}}findMatches(t,r,c){const d=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let _=0;_<t.length;_++){const b=t.get(_);if(b.crossTileID)continue;const M=this._symbolsByKey[b.key];if(!M)continue;const T=this.getScaledCoordinates(b,r);if(M.index){const I=M.index.range(T.x-d,T.y-d,T.x+d,T.y+d).sort();for(const R of I){const F=M.crossTileIDs[R];if(!c[F]){c[F]=!0,b.crossTileID=F;break}}}else if(M.positions)for(let I=0;I<M.positions.length;I++){const R=M.positions[I],F=M.crossTileIDs[I];if(Math.abs(R.x-T.x)<=d&&Math.abs(R.y-T.y)<=d&&!c[F]){c[F]=!0,b.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Jl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const c in this.indexes){const d=this.indexes[c],_={};for(const b in d){const M=d[b];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+r),_[M.tileID.key]=M}this.indexes[c]=_}this.lng=t}addBucket(t,r,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const d=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const b=this.indexes[_];if(Number(_)>t.overscaledZ)for(const M in b){const T=b[M];T.tileID.isChildOf(t)&&T.findMatches(r.symbolInstances,t,d)}else{const M=b[t.scaledTo(Number(_)).key];M&&M.findMatches(r.symbolInstances,t,d)}}for(let _=0;_<r.symbolInstances.length;_++){const b=r.symbolInstances.get(_);b.crossTileID||(b.crossTileID=c.generate(),d[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Yl(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const c of r.getCrossTileIDsLists())for(const d of c)delete this.usedCrossTileIDs[t][d]}removeStaleBuckets(t){let r=!1;for(const c in this.indexes){const d=this.indexes[c];for(const _ in d)t[d[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[_]),delete d[_],r=!0)}return r}}class Io{constructor(){this.layerIndexes={},this.crossTileIDs=new Jl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,c){let d=this.layerIndexes[t.id];d===void 0&&(d=this.layerIndexes[t.id]=new Kc);let _=!1;const b={};d.handleWrapJump(c);for(const M of r){const T=M.getBucket(t);T&&t.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(M.tileID,T,this.crossTileIDs)&&(_=!0),b[T.bucketInstanceId]=!0)}return d.removeStaleBuckets(b)&&(_=!0),_}pruneUnusedLayers(t){const r={};t.forEach(c=>{r[c]=!0});for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}var Co="void main() {fragColor=vec4(1.0);}";const bs={prelude:He(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:He("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:He("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:He(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:He(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:He(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:He(Co,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:He(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:He(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:He("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:He("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:He(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(textureSize(u_elevation_stops,0)[0]);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int num_elevation_stops=textureSize(u_elevation_stops,0)[0];int r=(num_elevation_stops-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(textureSize(u_color_stops,0)[0]);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:He("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:He(Co,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:He(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:He(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:He(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:He(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:He(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:He(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:He(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:He(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:He(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:He(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:He(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:He(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:He(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:He(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:He(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:He(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:He("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:He("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:He("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:He("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:He(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:He("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function He(g,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/in ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=_?_.concat(d):d,M={};return{fragmentSource:g=g.replace(r,(T,I,R,F,O)=>(M[O]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${R} ${F} ${O};
#else
uniform ${R} ${F} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${R} ${F} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(r,(T,I,R,F,O)=>{const G=F==="float"?"vec2":"vec4",q=O.match(/color/)?"color":G;return M[O]?I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${R} ${G} a_${O};
out ${R} ${F} ${O};
#else
uniform ${R} ${F} u_${O};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${R} ${F} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${q}(a_${O}, u_${O}_t);
#else
    ${R} ${F} ${O} = u_${O};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${R} ${G} a_${O};
#else
uniform ${R} ${F} u_${O};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${R} ${F} ${O} = a_${O};
#else
    ${R} ${F} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${R} ${F} ${O} = unpack_mix_${q}(a_${O}, u_${O}_t);
#else
    ${R} ${F} ${O} = u_${O};
#endif
`}),staticAttributes:c,staticUniforms:b}}class Ls{constructor(t,r,c){this.vertexBuffer=t,this.indexBuffer=r,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Os=o.aI([{name:"a_pos",type:"Int16",components:2}]);const bn="#define PROJECTION_MERCATOR",Ql="mercator";class th{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ql}get shaderDefine(){return bn}get shaderPreludeCode(){return bs.projectionMercator}get vertexShaderPreludeCode(){return bs.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,r,c,d,_){if(this._cachedMesh)return this._cachedMesh;const b=new o.aK;b.emplaceBack(0,0),b.emplaceBack(o.$,0),b.emplaceBack(0,o.$),b.emplaceBack(o.$,o.$);const M=t.createVertexBuffer(b,Os.members),T=o.aL.simpleSegment(0,0,4,2),I=new o.aM;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3);const R=t.createIndexBuffer(I);return this._cachedMesh=new Ls(M,R,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class es{constructor(t=0,r=0,c=0,d=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=c,this.right=d}interpolate(t,r,c){return r.top!=null&&t.top!=null&&(this.top=o.C.number(t.top,r.top,c)),r.bottom!=null&&t.bottom!=null&&(this.bottom=o.C.number(t.bottom,r.bottom,c)),r.left!=null&&t.left!=null&&(this.left=o.C.number(t.left,r.left,c)),r.right!=null&&t.right!=null&&(this.right=o.C.number(t.right,r.right,c)),this}getCenter(t,r){const c=o.ag((this.left+t-this.right)/2,0,t),d=o.ag((this.top+r-this.bottom)/2,0,r);return new o.P(c,d)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new es(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Fs(g,t){if(!g.renderWorldCopies||g.lngRange)return;const r=t.lng-g.center.lng;t.lng+=r>180?-360:r<-180?360:0}function Ke(g){return Math.max(0,Math.floor(g))}class Ra{constructor(t,r,c,d,_,b){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=d??0,this._maxPitch=_??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ke(this._zoom),this._scale=o.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new es,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,r,c){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Ke(this._zoom),this._scale=o.ae(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new es(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!c&&t.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const r=o.aN(t,-180,180)*Math.PI/180;var c,d,_,b,M,T,I,R,F;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=A(),c=this._rotationMatrix,_=-this._bearingInRadians,b=(d=this._rotationMatrix)[0],M=d[1],T=d[2],I=d[3],R=Math.sin(_),F=Math.cos(_),c[0]=b*F+T*R,c[1]=M*F+I*R,c[2]=b*-R+T*F,c[3]=M*-R+I*F)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const r=o.ag(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const r=t/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aO(this._fovInRadians)}setFov(t){t=o.ag(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=o.ad(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const r=this.getConstrained(this._center,t).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=o.ae(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,r){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,c){this._unmodified=!1,this._edgeInsets.interpolate(t,r,c),this._constrain(),this._calcMatrices()}resize(t,r,c=!0){this._width=t,this._height=r,c&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new oe([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,o.ah])}getConstrained(t,r){return this._callbacks.getConstrained(t,r)}getCameraQueryGeometry(t,r){if(r.length===1)return[r[0],t];{const{minX:c,minY:d,maxX:_,maxY:b}=o.a1.fromPoints(r).extend(t);return[new o.P(c,d),new o.P(_,d),new o.P(_,b),new o.P(c,b),new o.P(c,d)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:r,zoom:c}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(c),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=o.af(new Float64Array(16));o.N(t,t,[this._width/2,-this._height/2,1]),o.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=o.af(new Float64Array(16)),o.N(t,t,[1,-1,1]),o.M(t,t,[-1,-1,0]),o.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,r,c,d){const _=c!==void 0?c:this.bearing,b=d=d!==void 0?d:this.pitch,M=o.a0.fromLngLat(t,r),T=-Math.cos(o.ad(b)),I=Math.sin(o.ad(b)),R=I*Math.sin(o.ad(_)),F=-I*Math.cos(o.ad(_));let O=this.elevation;const G=r-O;let q;T*G>=0||Math.abs(T)<.1?(q=1e4,O=r+q*T):q=-G/T;let Q,J,tt=o.aP(1,M.y),st=0;do{if(st+=1,st>10)break;J=q/tt,Q=new o.a0(M.x+R*J,M.y+F*J),tt=1/Q.meterInMercatorCoordinateUnits()}while(Math.abs(q-J*tt)>1e-12);return{center:Q.toLngLat(),elevation:O,zoom:o.aj(this.height/2/Math.tan(this.fovInRadians/2)/J/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const r=o.ai(1,this.center.lat)*this.worldSize,c=this.cameraToCenterDistance/r,d=o.a0.fromLngLat(this.center,this.elevation),_=at(this.center,this.elevation,this.pitch,this.bearing,c);this._elevation=t;const b=this.calculateCenterFromCameraLngLatAlt(_.toLngLat(),o.aP(_.z,d.y),this.bearing,this.pitch);this._elevation=b.elevation,this._center=b.center,this.setZoom(b.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=o.ai(1,this.center.lat)*this.worldSize;return at(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const r=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/r,t.canonical.y/r,1/r/o.$,1/r/o.$]}}class Ao{constructor(t,r){this.min=t,this.max=r,this.center=o.aQ([],o.aR([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],c=o.aS(this.min),d=o.aS(this.max);for(let _=0;_<r.length;_++)c[_]=r[_]?this.min[_]:this.center[_],d[_]=r[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new Ao(c,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let r=!0;for(let c=0;c<t.planes.length;c++){const d=this.intersectsPlane(t.planes[c]);if(d===0)return 0;d===1&&(r=!1)}return r?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let r=t[3],c=t[3];for(let d=0;d<3;d++)t[d]>0?(r+=t[d]*this.min[d],c+=t[d]*this.max[d]):(c+=t[d]*this.min[d],r+=t[d]*this.max[d]);return r>=0?2:c<0?0:1}}class eh{distanceToTile2d(t,r,c,d){const _=d.distanceX([t,r]),b=d.distanceY([t,r]);return Math.hypot(_,b)}getWrap(t,r,c){return c}getTileBoundingVolume(t,r,c,d){var _,b;let M=c,T=c;if(d!=null&&d.terrain){const R=new o.Z(t.z,r,t.z,t.x,t.y),F=d.terrain.getMinMaxElevation(R);M=(_=F.minElevation)!==null&&_!==void 0?_:c,T=(b=F.maxElevation)!==null&&b!==void 0?b:c}const I=1<<t.z;return new Ao([r+t.x/I,t.y/I,M],[r+(t.x+1)/I,(t.y+1)/I,T])}allowVariableZoom(t,r){const c=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,d=o.ag(78.5-c/2,0,60);return!!r.terrain||t.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class wr{constructor(t,r,c){this.points=t,this.planes=r,this.aabb=c}static fromInvProjectionMatrix(t,r=1,c=0,d,_){const b=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],M=Math.pow(2,c),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>function(G,q,Q,J){const tt=o.av([],G,q),st=1/tt[3]/Q*J;return o.aX(tt,tt,[st,st,1/tt[3],st])}(O,t,r,M));d&&function(O,G,q,Q){const J=Q?4:0,tt=Q?0:4;let st=0;const ht=[],nt=[];for(let ot=0;ot<4;ot++){const xt=o.aT([],O[ot+tt],O[ot+J]),It=o.aY(xt);o.aQ(xt,xt,1/It),ht.push(It),nt.push(xt)}for(let ot=0;ot<4;ot++){const xt=o.aZ(O[ot+J],nt[ot],q);st=xt!==null&&xt>=0?Math.max(st,xt):Math.max(st,ht[ot])}const ut=function(ot,xt){const It=o.aT([],ot[xt[0]],ot[xt[1]]),St=o.aT([],ot[xt[2]],ot[xt[1]]),Pt=[0,0,0,0];return o.aU(Pt,o.aV([],It,St)),Pt[3]=-o.aW(Pt,ot[xt[0]]),Pt}(O,G),mt=function(ot,xt){const It=o.a_(ot),St=o.a$([],ot,1/It),Pt=o.aT([],xt,o.aQ([],St,o.aW(xt,St))),Ct=o.a_(Pt);if(Ct>0){const te=Math.sqrt(1-St[3]*St[3]),Jt=o.aQ([],St,-St[3]),Vt=o.aR([],Jt,o.aQ([],Pt,te/Ct));return o.b0(xt,Vt)}return null}(q,ut);if(mt!==null){const ot=mt/o.aW(nt[0],ut);st=Math.min(st,ot)}for(let ot=0;ot<4;ot++){const xt=Math.min(st,ht[ot]);O[ot+tt]=[O[ot+J][0]+nt[ot][0]*xt,O[ot+J][1]+nt[ot][1]*xt,O[ot+J][2]+nt[ot][2]*xt,1]}}(T,b[0],d,_);const I=b.map(O=>{const G=o.aT([],T[O[0]],T[O[1]]),q=o.aT([],T[O[2]],T[O[1]]),Q=o.aU([],o.aV([],G,q)),J=-o.aW(Q,T[O[1]]);return Q.concat(J)}),R=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],F=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const O of T)for(let G=0;G<3;G++)R[G]=Math.min(R[G],O[G]),F[G]=Math.max(F[G],O[G]);return new wr(T,I,new Ao(R,F))}}class Ki{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,c){return this._helper.interpolatePadding(t,r,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,c=!0){this._helper.resize(t,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,r){}constructor(t,r,c,d,_){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ra({calcMatrices:()=>{this._calcMatrices()},getConstrained:(b,M)=>this.getConstrained(b,M)},t,r,c,d,_),this._coveringTilesDetailsProvider=new eh}clone(){const t=new Ki;return t.apply(this),t}apply(t,r,c){this._helper.apply(t,r,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const r=[new o.b1(0,t)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new o.P(0,0)),d=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),b=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),M=Math.floor(Math.min(c.x,d.x,_.x,b.x)),T=Math.floor(Math.max(c.x,d.x,_.x,b.x)),I=1;for(let R=M-I;R<=T+I;R++)R!==0&&r.push(new o.b1(R,t))}return r}getCameraFrustum(){return wr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const r=this.screenPointToLocation(this.centerPoint,t),c=t?t.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(t,r){const c=o.ai(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(r,c),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),b=o.a0.fromLngLat(t),M=new o.a0(b.x-(d.x-_.x),b.y-(d.y-_.y));this.setCenter(M==null?void 0:M.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,r){return r?this.coordinatePoint(o.a0.fromLngLat(t),r.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a0.fromLngLat(t))}screenPointToLocation(t,r){var c;return(c=this.screenPointToMercatorCoordinate(t,r))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(t,r){if(r){const c=r.pointCoordinate(t);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,r){const c=r||0,d=[t.x,t.y,0,1],_=[t.x,t.y,1,1];o.av(d,d,this._pixelMatrixInverse),o.av(_,_,this._pixelMatrixInverse);const b=d[3],M=_[3],T=d[1]/b,I=_[1]/M,R=d[2]/b,F=_[2]/M,O=R===F?0:(c-R)/(F-R);return new o.a0(o.C.number(d[0]/b,_[0]/M,O)/this.worldSize,o.C.number(T,I,O)/this.worldSize,c)}coordinatePoint(t,r=0,c=this._pixelMatrix){const d=[t.x*this.worldSize,t.y*this.worldSize,r,1];return o.av(d,d,c),new o.P(d[0]/d[3],d[1]/d[3])}getBounds(){const t=Math.max(0,this._helper._height/2-X(this));return new oe().extend(this.screenPointToLocation(new o.P(0,t))).extend(this.screenPointToLocation(new o.P(this._helper._width,t))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(t,r){return r?r.pointCoordinate(t)!=null:t.y>this.height/2-X(this)}calculatePosMatrix(t,r=!1,c){var d;const _=(d=t.key)!==null&&d!==void 0?d:o.b2(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),b=r?this._alignedPosMatrixCache:this._posMatrixCache;if(b.has(_)){const I=b.get(_);return c?I.f32:I.f64}const M=Y(t,this.worldSize);o.O(M,r?this._alignedProjMatrix:this._viewProjMatrix,M);const T={f64:M,f32:new Float32Array(M)};return b.set(_,T),c?T.f32:T.f64}calculateFogMatrix(t){const r=t.key,c=this._fogMatrixCacheF32;if(c.has(r))return c.get(r);const d=Y(t,this.worldSize);return o.O(d,this._fogMatrix,d),c.set(r,new Float32Array(d)),c.get(r)}getConstrained(t,r){r=o.ag(+r,this.minZoom,this.maxZoom);const c={center:new o.S(t.lng,t.lat),zoom:r};let d=this._helper._lngRange;this._helper._renderWorldCopies||d!==null||(d=[-179.9999999999,180-1e-10]);const _=this.tileSize*o.ae(c.zoom);let b=0,M=_,T=0,I=_,R=0,F=0;const{x:O,y:G}=this.size;if(this._helper._latRange){const ht=this._helper._latRange;b=o.U(ht[1])*_,M=o.U(ht[0])*_,M-b<G&&(R=G/(M-b))}d&&(T=o.aN(o.V(d[0])*_,0,_),I=o.aN(o.V(d[1])*_,0,_),I<T&&(I+=_),I-T<O&&(F=O/(I-T)));const{x:q,y:Q}=yt(_,t);let J,tt;const st=Math.max(F||0,R||0);if(st){const ht=new o.P(F?(I+T)/2:q,R?(M+b)/2:Q);return c.center=Z(_,ht).wrap(),c.zoom+=o.aj(st),c}if(this._helper._latRange){const ht=G/2;Q-ht<b&&(tt=b+ht),Q+ht>M&&(tt=M-ht)}if(d){const ht=(T+I)/2;let nt=q;this._helper._renderWorldCopies&&(nt=o.aN(q,ht-_/2,ht+_/2));const ut=O/2;nt-ut<T&&(J=T+ut),nt+ut>I&&(J=I-ut)}if(J!==void 0||tt!==void 0){const ht=new o.P(J??q,tt??Q);c.center=Z(_,ht).wrap()}return c}calculateCenterFromCameraLngLatAlt(t,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,c,d)}_calculateNearFarZIfNeeded(t,r,c){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-d*this._helper._pixelPerMeter/Math.cos(r),b=d<0?_:t,M=Math.PI/2+this.pitchInRadians,T=o.ad(this.fov)*(Math.abs(Math.cos(o.ad(this.roll)))*this.height+Math.abs(Math.sin(o.ad(this.roll)))*this.width)/this.height*(.5+c.y/this.height),I=Math.sin(T)*b/Math.sin(o.ag(Math.PI-M-T,.01,Math.PI-.01)),R=X(this),F=Math.atan(R/this._helper.cameraToCenterDistance),O=o.ad(.75),G=F>O?2*F*(.5+c.y/(2*R)):O,q=Math.sin(G)*b/Math.sin(o.ag(Math.PI-M-G,.01,Math.PI-.01)),Q=Math.min(I,q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*Q+b),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,r=yt(this.worldSize,this.center),c=r.x,d=r.y;this._helper._pixelPerMeter=o.ai(1,this.center.lat)*this.worldSize;const _=o.ad(Math.min(this.pitch,Di)),b=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let M;this._calculateNearFarZIfNeeded(b,_,t),M=new Float64Array(16),o.b3(M,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.ap(this._invProjMatrix,M),M[8]=2*-t.x/this._helper._width,M[9]=2*t.y/this._helper._height,this._projectionMatrix=o.b4(M),o.N(M,M,[1,-1,1]),o.M(M,M,[0,0,-this._helper.cameraToCenterDistance]),o.b5(M,M,-this.rollInRadians),o.b6(M,M,this.pitchInRadians),o.b5(M,M,-this.bearingInRadians),o.M(M,M,[-c,-d,0]),this._mercatorMatrix=o.N([],M,[this.worldSize,this.worldSize,this.worldSize]),o.N(M,M,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,M),o.M(M,M,[0,0,-this.elevation]),this._viewProjMatrix=M,this._invViewProjMatrix=o.ap([],M);const T=[0,0,-1,1];o.av(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),o.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,b,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-c,-d,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,M);const I=this._helper._width%2/2,R=this._helper._height%2/2,F=Math.cos(this.bearingInRadians),O=Math.sin(-this.bearingInRadians),G=c-Math.round(c)+F*I+O*R,q=d-Math.round(d)+F*R+O*I,Q=new Float64Array(M);if(o.M(Q,Q,[G>.5?G-1:G,q>.5?q-1:q,0]),this._alignedProjMatrix=Q,M=o.ap(new Float64Array(16),this._pixelMatrix),!M)throw new Error("failed to invert matrix");this._pixelMatrixInverse=M,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new o.P(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.av(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=o.ai(1,this.center.lat)*this.worldSize;return at(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,r){const c=o.a0.fromLngLat(t),d=[c.x*this.worldSize,c.y*this.worldSize,r,1];return o.av(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(t){const{overscaledTileID:r,aligned:c,applyTerrainMatrix:d}=t,_=this._helper.getMercatorTileCoordinates(r),b=r?this.calculatePosMatrix(r,c,!0):null;let M;return M=r&&r.terrainRttPosMatrix32f&&d?r.terrainRttPosMatrix32f:b||o.b7(),{mainMatrix:M,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:M}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,r,c){return 1}transformLightDirection(t){return o.aS(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,r,c,d){const _=this.calculatePosMatrix(c);let b;d?(b=[t,r,d(t,r),1],o.av(b,b,_)):(b=[t,r,0,1],vn(b,b,_));const M=b[3];return{point:new o.P(b[0]/M,b[1]/M),signedDistanceFromCamera:M,isOccluded:!1}}populateCache(t){for(const r of t)this.calculatePosMatrix(r)}getMatrixForModel(t,r){const c=o.a0.fromLngLat(t,r),d=c.meterInMercatorCoordinateUnits(),_=o.b8();return o.M(_,_,[c.x,c.y,c.z]),o.b5(_,_,Math.PI),o.b6(_,_,Math.PI/2),o.N(_,_,[-d,d,d]),_}getProjectionDataForCustomLayer(t=!0){const r=new o.Z(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:t}),d=Y(r,this.worldSize);o.O(d,this._viewProjMatrix,d),c.tileMercatorCoords=[0,0,1,1];const _=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],b=o.b9();return o.N(b,d,_),c.fallbackMatrix=b,c.mainMatrix=b,c}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Mr(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function sr(g){if(g.useSlerp)if(g.k<1){const t=o.ba(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),r=o.ba(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),c=new Float64Array(4);o.bb(c,t,r,g.k);const d=o.bc(c);g.tr.setRoll(d.roll),g.tr.setPitch(d.pitch),g.tr.setBearing(d.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(o.C.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(o.C.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(o.C.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function ki(g,t,r,c,d){const _=d.padding,b=yt(d.worldSize,r.getNorthWest()),M=yt(d.worldSize,r.getNorthEast()),T=yt(d.worldSize,r.getSouthEast()),I=yt(d.worldSize,r.getSouthWest()),R=o.ad(-c),F=b.rotate(R),O=M.rotate(R),G=T.rotate(R),q=I.rotate(R),Q=new o.P(Math.max(F.x,O.x,q.x,G.x),Math.max(F.y,O.y,q.y,G.y)),J=new o.P(Math.min(F.x,O.x,q.x,G.x),Math.min(F.y,O.y,q.y,G.y)),tt=Q.sub(J),st=(d.width-(_.left+_.right+t.left+t.right))/tt.x,ht=(d.height-(_.top+_.bottom+t.top+t.bottom))/tt.y;if(ht<0||st<0)return void Mr();const nt=Math.min(o.aj(d.scale*Math.min(st,ht)),g.maxZoom),ut=o.P.convert(g.offset),mt=new o.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(o.ad(c)),ot=ut.add(mt).mult(d.scale/o.ae(nt));return{center:Z(d.worldSize,b.add(T).div(2).sub(ot)),zoom:nt,bearing:c}}class Ro{get useGlobeControls(){return!1}handlePanInertia(t,r){return{easingOffset:t,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(t,r){t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta),t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta)}handleMapControlsPan(t,r,c){t.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(c,t.around)}cameraForBoxAndBearing(t,r,c,d,_){return ki(t,r,c,d,_)}handleJumpToCenterZoom(t,r){t.zoom!==(r.zoom!==void 0?+r.zoom:t.zoom)&&t.setZoom(+r.zoom),r.center!==void 0&&t.setCenter(o.S.convert(r.center))}handleEaseTo(t,r){const c=t.zoom,d=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},M=r.zoom!==void 0,T=!t.isPaddingEqual(r.padding);let I=!1;const R=M?+r.zoom:t.zoom;let F=t.centerPoint.add(r.offsetAsPoint);const O=t.screenPointToLocation(F),{center:G,zoom:q}=t.getConstrained(o.S.convert(r.center||O),R??c);Fs(t,G);const Q=yt(t.worldSize,O),J=yt(t.worldSize,G).sub(Q),tt=o.ae(q-c);return I=q!==c,{easeFunc:st=>{if(I&&t.setZoom(o.C.number(c,q,st)),o.bd(_,b)||sr({startEulerAngles:_,endEulerAngles:b,tr:t,k:st,useSlerp:_.roll!=b.roll}),T&&(t.interpolatePadding(d,r.padding,st),F=t.centerPoint.add(r.offsetAsPoint)),r.around)t.setLocationAtPoint(r.around,r.aroundPoint);else{const ht=o.ae(t.zoom-c),nt=q>c?Math.min(2,tt):Math.max(.5,tt),ut=Math.pow(nt,1-st),mt=Z(t.worldSize,Q.add(J.mult(st*ut)).mult(ht));t.setLocationAtPoint(t.renderWorldCopies?mt.wrap():mt,F)}},isZooming:I,elevationCenter:G}}handleFlyTo(t,r){const c=r.zoom!==void 0,d=t.zoom,_=t.getConstrained(o.S.convert(r.center||r.locationAtOffset),c?+r.zoom:d),b=_.center,M=_.zoom;Fs(t,b);const T=yt(t.worldSize,r.locationAtOffset),I=yt(t.worldSize,b).sub(T),R=I.mag(),F=o.ae(M-d);let O;if(r.minZoom!==void 0){const G=Math.min(+r.minZoom,d,M),q=t.getConstrained(b,G).zoom;O=o.ae(q-d)}return{easeFunc:(G,q,Q,J)=>{t.setZoom(G===1?M:d+o.aj(q));const tt=G===1?b:Z(t.worldSize,T.add(I.mult(Q)).mult(q));t.setLocationAtPoint(t.renderWorldCopies?tt.wrap():tt,J)},scaleOfZoom:F,targetCenter:b,scaleOfMinZoom:O,pixelPathLength:R}}}class si{constructor(t,r,c){this.blendFunction=t,this.blendColor=r,this.mask=c}}si.Replace=[1,0],si.disabled=new si(si.Replace,o.be.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,o.be.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,771],o.be.transparent,[!0,!0,!0,!0]);const Nr=2305;class Fe{constructor(t,r,c){this.enable=t,this.mode=r,this.frontFace=c}}Fe.disabled=new Fe(!1,1029,Nr),Fe.backCCW=new Fe(!0,1029,Nr),Fe.frontCCW=new Fe(!0,1028,Nr);class Ue{constructor(t,r,c){this.func=t,this.mask=r,this.range=c}}Ue.ReadOnly=!1,Ue.ReadWrite=!0,Ue.disabled=new Ue(519,Ue.ReadOnly,[0,1]);const wn=7680;class Pe{constructor(t,r,c,d,_,b){this.test=t,this.ref=r,this.mask=c,this.fail=d,this.depthFail=_,this.pass=b}}Pe.disabled=new Pe({func:519,mask:0},0,0,wn,wn,wn);const Mn=new WeakMap;function Er(g){var t;if(Mn.has(g))return Mn.get(g);{const r=(t=g.getParameter(g.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Mn.set(g,r),r}}class Gn{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const r=t.context,c=r.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const d=new o.aK;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const _=new o.aM;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Ls(r.createVertexBuffer(d,Os.members),r.createIndexBuffer(_),o.aL.simpleSegment(0,0,d.length,_.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(c.TEXTURE1);const b=c.createTexture();c.bindTexture(c.TEXTURE_2D,b),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(b),Er(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,r){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,r=t.gl;t.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,r){const c=this._cachedRenderContext.context,d=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:o.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,d.TRIANGLES,Ue.disabled,Pe.disabled,si.unblended,Fe.disabled,((_,b)=>({u_input:_,u_output_expected:b}))(t,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Er(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const _=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Er(t)){const r=t.clientWaitSync(this._readbackQueue.sync,0,0);if(r===t.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Gn._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let r=0;return r+=t[0]/256,r+=t[1]/65536,r+=t[2]/16777216,t[3]<127&&(r=-r),r/128}}const is=o.$/128;function ih(g,t){const r=g.granularity!==void 0?Math.max(g.granularity,1):1,c=r+(g.generateBorders?2:0),d=r+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),_=c+1,b=d+1,M=g.generateBorders?-1:0,T=g.generateBorders||g.extendToNorthPole?-1:0,I=r+(g.generateBorders?1:0),R=r+(g.generateBorders||g.extendToSouthPole?1:0),F=_*b,O=c*d*6,G=_*b>65536;if(G&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const q=G||t==="32bit",Q=new Int16Array(2*F);let J=0;for(let ht=T;ht<=R;ht++)for(let nt=M;nt<=I;nt++){let ut=nt/r*o.$;nt===-1&&(ut=-64),nt===r+1&&(ut=o.$+is);let mt=ht/r*o.$;ht===-1&&(mt=g.extendToNorthPole?o.bg:-64),ht===r+1&&(mt=g.extendToSouthPole?o.bh:o.$+is),Q[J++]=ut,Q[J++]=mt}const tt=q?new Uint32Array(O):new Uint16Array(O);let st=0;for(let ht=0;ht<d;ht++)for(let nt=0;nt<c;nt++){const ut=nt+1+ht*_,mt=nt+(ht+1)*_,ot=nt+1+(ht+1)*_;tt[st++]=nt+ht*_,tt[st++]=mt,tt[st++]=ut,tt[st++]=ut,tt[st++]=mt,tt[st++]=ot}return{vertices:Q.buffer.slice(0),indices:tt.buffer.slice(0),uses32bitIndices:q}}const ws=new o.aJ({fill:new o.bi(128,2),line:new o.bi(512,0),tile:new o.bi(128,32),stencil:new o.bi(128,1),circle:3});class Yc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return bs.projectionGlobe}get vertexShaderPreludeCode(){return bs.projectionMercator.vertexSource}get subdivisionGranularity(){return ws}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Gn(t));const r=o.U(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(r,c),_=D.now();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=_);const b=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bk(b))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,r,c,d,_){const b=(_==="stencil"?ws.stencil:ws.tile).getGranularityForZoomLevel(r.z);return this._getMesh(t,{granularity:b,generateBorders:c,extendToNorthPole:r.y===0&&d,extendToSouthPole:r.y===(1<<r.z)-1&&d})}_getMesh(t,r){const c=this._getMeshKey(r);if(c in this._tileMeshCache)return this._tileMeshCache[c];const d=function(_,b){const M=ih(b,"16bit"),T=o.aK.deserialize({arrayBuffer:M.vertices,length:M.vertices.byteLength/2/2}),I=o.aM.deserialize({arrayBuffer:M.indices,length:M.indices.byteLength/2/3});return new Ls(_.createVertexBuffer(T,Os.members),_.createIndexBuffer(I),o.aL.simpleSegment(0,0,T.length,I.length))}(t,r);return this._tileMeshCache[c]=d,d}recalculate(t){}hasTransition(){const t=D.now();let r=!1;return r=r||(t-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Jc=new o.r({type:new o.D(o.v.projection.type)});class Da extends o.E{constructor(t){super(),this._transitionable=new o.t(Jc),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new th,this._verticalPerspectiveProjection=new Yc}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof o.bl){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,r,c,d,_){return this.currentProjection.getMeshFromTileID(t,r,c,d,_)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function za(g){const t=jn(g.worldSize,g.center.lat);return 2*Math.PI*t}function cs(g,t,r,c,d){const _=1/(1<<d),b=t/o.$*_+c*_,M=o.bn((g/o.$*_+r*_)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI,I=Math.cos(T),R=new Float64Array(3);return R[0]=Math.sin(M)*I,R[1]=Math.sin(T),R[2]=Math.cos(M)*I,R}function nr(g){return function(t,r){const c=Math.cos(r),d=new Float64Array(3);return d[0]=Math.sin(t)*c,d[1]=Math.sin(r),d[2]=Math.cos(t)*c,d}(g.lng*Math.PI/180,g.lat*Math.PI/180)}function jn(g,t){return g/(2*Math.PI)/Math.cos(t*Math.PI/180)}function ka(g){const t=Math.asin(g[1])/Math.PI*180,r=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(r>1e-6){const c=g[0]/r,d=Math.acos(g[2]/r),_=(c>0?d:-d)/Math.PI*180;return new o.S(o.aN(_,-180,180),t)}return new o.S(0,t)}function Un(g){return Math.cos(g*Math.PI/180)}function Yi(g,t){const r=Un(g),c=Un(t);return o.aj(c/r)}function La(g,t){const r=g.rotate(t.bearingInRadians),c=t.zoom+Yi(t.center.lat,0),d=o.bj(1/Un(t.center.lat),1/Un(Math.min(Math.abs(t.center.lat),60)),o.bm(c,7,3,0,1)),_=360/za({worldSize:t.worldSize,center:{lat:t.center.lat}});return new o.S(t.center.lng-r.x*_*d,o.ag(t.center.lat+r.y*_,-85.051129,o.ah))}function Vn(g){const t=.5*g,r=Math.sin(t),c=Math.cos(t);return Math.log(r+c)-Math.log(c-r)}function $n(g,t,r,c){const d=g.lat+r*c;if(Math.abs(r)>1){const _=(Math.sign(g.lat+r)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,b=Math.abs(g.lat+r)*Math.PI/180,M=Vn(_+c*(b-_)),T=Vn(_),I=Vn(b);return new o.S(g.lng+t*((M-T)/(I-T)),d)}return new o.S(g.lng+t*c,d)}class Kd{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,r,c,d){const _=`${t.z}_${t.x}_${t.y}_${d!=null&&d.terrain?"t":""}`,b=this._cache.get(_);if(b)return b;const M=this._cachePrevious.get(_);if(M)return this._cache.set(_,M),M;const T=this._boundingVolumeFactory(t,r,c,d);return this._cache.set(_,T),this._hadAnyChanges=!0,T}}class Ks{constructor(t,r,c,d){this.min=c,this.max=d,this.points=t,this.planes=r}static fromAabb(t,r){const c=[];for(let d=0;d<8;d++)c.push([1&~d?t[0]:r[0],(d>>1&1)==1?r[1]:t[1],(d>>2&1)==1?r[2]:t[2]]);return new Ks(c,[[-1,0,0,r[0]],[1,0,0,-t[0]],[0,-1,0,r[1]],[0,1,0,-t[1]],[0,0,-1,r[2]],[0,0,1,-t[2]]],t,r)}static fromCenterSizeAngles(t,r,c){const d=o.bq([],c[0],c[1],c[2]),_=o.br([],[r[0],0,0],d),b=o.br([],[0,r[1],0],d),M=o.br([],[0,0,r[2]],d),T=[...t],I=[...t];for(let F=0;F<8;F++)for(let O=0;O<3;O++){const G=t[O]+_[O]*(1&~F?-1:1)+b[O]*((F>>1&1)==1?1:-1)+M[O]*((F>>2&1)==1?1:-1);T[O]=Math.min(T[O],G),I[O]=Math.max(I[O],G)}const R=[];for(let F=0;F<8;F++){const O=[...t];o.aR(O,O,o.aQ([],_,1&~F?-1:1)),o.aR(O,O,o.aQ([],b,(F>>1&1)==1?1:-1)),o.aR(O,O,o.aQ([],M,(F>>2&1)==1?1:-1)),R.push(O)}return new Ks(R,[[..._,-o.aW(_,R[0])],[...b,-o.aW(b,R[0])],[...M,-o.aW(M,R[0])],[-_[0],-_[1],-_[2],-o.aW(_,R[7])],[-b[0],-b[1],-b[2],-o.aW(b,R[7])],[-M[0],-M[1],-M[2],-o.aW(M,R[7])]],T,I)}intersectsFrustum(t){let r=!0;const c=this.points.length,d=this.planes.length,_=t.planes.length,b=t.points.length;for(let M=0;M<_;M++){const T=t.planes[M];let I=0;for(let R=0;R<c;R++){const F=this.points[R];T[0]*F[0]+T[1]*F[1]+T[2]*F[2]+T[3]>=0&&I++}if(I===0)return 0;I<c&&(r=!1)}if(r)return 2;for(let M=0;M<d;M++){const T=this.planes[M];let I=0;for(let R=0;R<b;R++){const F=t.points[R];T[0]*F[0]+T[1]*F[1]+T[2]*F[2]+T[3]>=0&&I++}if(I===0)return 0}return 1}intersectsPlane(t){const r=this.points.length;let c=0;for(let d=0;d<r;d++){const _=this.points[d];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&c++}return c===r?2:c===0?0:1}}function Oa(g,t,r){const c=g-t;return c<0?-c:Math.max(0,c-r)}function rh(g,t,r,c,d){const _=g-r;let b;return b=_<0?Math.min(-_,1+_-d):_>1?Math.min(Math.max(_-d,0),1-_):0,Math.max(b,Oa(t,c,d))}class Yd{constructor(){this._boundingVolumeCache=new Kd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,r,c,d){const _=1<<c.z,b=1/_,M=c.x/_,T=c.y/_;let I=2;return I=Math.min(I,rh(t,r,M,T,b)),I=Math.min(I,rh(t,r,M+.5,-T-b,b)),I=Math.min(I,rh(t,r,M+.5,2-T-b,b)),I}getWrap(t,r,c){const d=1<<r.z,_=1/d,b=r.x/d,M=Oa(t.x,b,_),T=Oa(t.x,b-1,_),I=Oa(t.x,b+1,_),R=Math.min(M,T,I);return R===I?1:R===T?-1:0}allowVariableZoom(t,r){return zt(t,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,r,c,d){return this._boundingVolumeCache.getTileBoundingVolume(t,r,c,d)}_computeTileBoundingVolume(t,r,c,d){var _,b;let M=c,T=c;if(d!=null&&d.terrain){const I=new o.Z(t.z,r,t.z,t.x,t.y),R=d.terrain.getMinMaxElevation(I);M=(_=R.minElevation)!==null&&_!==void 0?_:c,T=(b=R.maxElevation)!==null&&b!==void 0?b:c}if(M/=o.bt,T/=o.bt,M+=1,T+=1,t.z<=0)return Ks.fromAabb([-T,-T,-T],[T,T,T]);if(t.z===1)return Ks.fromAabb([t.x===0?-T:0,t.y===0?0:-T,-T],[t.x===0?0:T,t.y===0?T:0,T]);{const I=[cs(0,0,t.x,t.y,t.z),cs(o.$,0,t.x,t.y,t.z),cs(o.$,o.$,t.x,t.y,t.z),cs(0,o.$,t.x,t.y,t.z)],R=[];for(const Pt of I)R.push(o.aQ([],Pt,T));if(T!==M)for(const Pt of I)R.push(o.aQ([],Pt,M));t.y===0&&R.push([0,1,0]),t.y===(1<<t.z)-1&&R.push([0,-1,0]);const F=[1,1,1],O=[-1,-1,-1];for(const Pt of R)for(let Ct=0;Ct<3;Ct++)F[Ct]=Math.min(F[Ct],Pt[Ct]),O[Ct]=Math.max(O[Ct],Pt[Ct]);const G=cs(o.$/2,o.$/2,t.x,t.y,t.z),q=o.aV([],[0,1,0],G);o.aU(q,q);const Q=o.aV([],G,q);o.aU(Q,Q);const J=o.aV([],I[2],I[1]);o.aU(J,J);const tt=o.aV([],I[0],I[3]);o.aU(tt,tt),R.push(o.aQ([],G,T)),t.y>=(1<<t.z)/2&&R.push(o.aQ([],cs(o.$/2,0,t.x,t.y,t.z),T)),t.y<(1<<t.z)/2&&R.push(o.aQ([],cs(o.$/2,o.$,t.x,t.y,t.z),T));const st=Ir(G,R),ht=Ir(Q,R),nt=[-G[0],-G[1],-G[2],st.max],ut=[G[0],G[1],G[2],-st.min],mt=[-Q[0],-Q[1],-Q[2],ht.max],ot=[Q[0],Q[1],Q[2],-ht.min],xt=[...J,0],It=[...tt,0],St=[];return t.y===0?St.push(o.bs(It,xt,nt),o.bs(It,xt,ut)):St.push(o.bs(mt,xt,nt),o.bs(mt,xt,ut),o.bs(mt,It,nt),o.bs(mt,It,ut)),t.y===(1<<t.z)-1?St.push(o.bs(It,xt,nt),o.bs(It,xt,ut)):St.push(o.bs(ot,xt,nt),o.bs(ot,xt,ut),o.bs(ot,It,nt),o.bs(ot,It,ut)),new Ks(St,[nt,ut,mt,ot,xt,It],F,O)}}}function Ir(g,t){let r=1/0,c=-1/0;for(const d of t){const _=o.aW(g,d);r=Math.min(r,_),c=Math.max(c,_)}return{min:r,max:c}}class qn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,c){return this._helper.interpolatePadding(t,r,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r){this._helper.resize(t,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=o.bu(),this._projectionMatrix=o.b8(),this._globeViewProjMatrix32f=o.b7(),this._globeViewProjMatrixNoCorrection=o.b8(),this._globeViewProjMatrixNoCorrectionInverted=o.b8(),this._globeProjMatrixInverted=o.b8(),this._cameraPosition=o.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ra({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,r)=>this.getConstrained(t,r)}),this._coveringTilesDetailsProvider=new Yd}clone(){const t=new qn;return t.apply(this),t}apply(t,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=o.bo();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:r,applyGlobeMatrix:c}=t,d=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const r=this.pitchInRadians,c=this.cameraToCenterDistance/t,d=Math.sin(r)*c,_=Math.cos(r)*c+1,b=1/Math.sqrt(d*d+_*_)*1;let M=-d,T=_;const I=Math.sqrt(M*M+T*T);M/=I,T/=I;const R=[0,M,T];o.bv(R,R,[0,0,0],-this.bearingInRadians),o.bw(R,R,[0,0,0],-1*this.center.lat*Math.PI/180),o.bx(R,R,[0,0,0],this.center.lng*Math.PI/180);const F=1/o.aY(R);return o.aQ(R,R,F),[...R,-b*F]}isLocationOccluded(t){return!this.isSurfacePointVisible(nr(t))}transformLightDirection(t){const r=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,d=Math.cos(c),_=[Math.sin(r)*d,Math.sin(c),Math.cos(r)*d],b=[_[2],0,-_[0]],M=[0,0,0];o.aV(M,b,_),o.aU(b,b),o.aU(M,M);const T=[0,0,0];return o.aU(T,[b[0]*t[0]+M[0]*t[1]+_[0]*t[2],b[1]*t[0]+M[1]*t[1]+_[1]*t[2],b[2]*t[0]+M[2]*t[1]+_[2]*t[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,r,c){const d=function(M,T,I){const R=1/(1<<I.z);return new o.a0(M/o.$*R+I.x*R,T/o.$*R+I.y*R)}(t,r,c.canonical),_=(b=d.y,[o.bn(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI]);var b;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,r,c,d){const _=c.canonical,b=cs(t,r,_.x,_.y,_.z),M=1+(d?d(t,r):0)/o.bt,T=[b[0]*M,b[1]*M,b[2]*M,1];o.av(T,T,this._globeViewProjMatrixNoCorrection);const I=this._cachedClippingPlane,R=I[0]*b[0]+I[1]*b[1]+I[2]*b[2]+I[3]<0;return{point:new o.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:R}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=jn(this.worldSize,this.center.lat),r=o.b9(),c=o.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),o.b3(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;r[8]=2*-d.x/this._helper._width,r[9]=2*d.y/this._helper._height,this._projectionMatrix=o.b4(r),this._globeProjMatrixInverted=o.b9(),o.ap(this._globeProjMatrixInverted,r),o.M(r,r,[0,0,-this.cameraToCenterDistance]),o.b5(r,r,this.rollInRadians),o.b6(r,r,-this.pitchInRadians),o.b5(r,r,this.bearingInRadians),o.M(r,r,[0,0,-t]);const _=o.bo();_[0]=t,_[1]=t,_[2]=t,o.b6(c,r,this.center.lat*Math.PI/180),o.by(c,c,-this.center.lng*Math.PI/180),o.N(c,c,_),this._globeViewProjMatrixNoCorrection=c,o.b6(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.by(r,r,-this.center.lng*Math.PI/180),o.N(r,r,_),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),o.ap(this._globeViewProjMatrixNoCorrectionInverted,c);const b=o.bo();this._cameraPosition=o.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/t,o.bv(this._cameraPosition,this._cameraPosition,b,-this.rollInRadians),o.bw(this._cameraPosition,this._cameraPosition,b,this.pitchInRadians),o.bv(this._cameraPosition,this._cameraPosition,b,-this.bearingInRadians),o.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bw(this._cameraPosition,this._cameraPosition,b,-this.center.lat*Math.PI/180),o.bx(this._cameraPosition,this._cameraPosition,b,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const M=o.b4(this._globeViewProjMatrixNoCorrectionInverted);o.N(M,M,[1,1,-1]),this._cachedFrustum=wr.fromInvProjectionMatrix(M,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){o.w("calculateFogMatrix is not supported on globe projection.");const r=o.b9();return o.af(r),r}getVisibleUnwrappedCoordinates(t){return[new o.b1(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=nr(t);o.aQ(c,c,1+r/o.bt);const d=o.bu();return o.av(d,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(t){}getBounds(){const t=.5*this.width,r=.5*this.height,c=[new o.P(0,0),new o.P(t,0),new o.P(this.width,0),new o.P(this.width,r),new o.P(this.width,this.height),new o.P(t,this.height),new o.P(0,this.height),new o.P(0,r)],d=[];for(const F of c)d.push(this.unprojectScreenPoint(F));let _=0,b=0,M=0,T=0;const I=this.center;for(const F of d){const O=o.bz(I.lng,F.lng),G=o.bz(I.lat,F.lat);O<b&&(b=O),O>_&&(_=O),G<T&&(T=G),G>M&&(M=G)}const R=[I.lng+b,I.lat+T,I.lng+_,I.lat+M];return this.isSurfacePointOnScreen([0,1,0])&&(R[3]=90,R[0]=-180,R[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(R[1]=-90,R[0]=-180,R[2]=180),new oe(R)}getConstrained(t,r){const c=o.ag(t.lat,-85.051129,o.ah),d=o.ag(+r,this.minZoom+Yi(0,c),this.maxZoom);return{center:new o.S(t.lng,c),zoom:d}}calculateCenterFromCameraLngLatAlt(t,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,c,d)}setLocationAtPoint(t,r){const c=nr(this.unprojectScreenPoint(r)),d=nr(t),_=o.bo();o.bA(_);const b=o.bo();o.bx(b,c,_,-this.center.lng*Math.PI/180),o.bw(b,b,_,this.center.lat*Math.PI/180);const M=d[0]*d[0]+d[2]*d[2],T=b[0]*b[0];if(M<T)return;const I=Math.sqrt(M-T),R=-I,F=o.bB(d[0],d[2],b[0],I),O=o.bB(d[0],d[2],b[0],R),G=o.bo();o.bx(G,d,_,-F);const q=o.bB(G[1],G[2],b[1],b[2]),Q=o.bo();o.bx(Q,d,_,-O);const J=o.bB(Q[1],Q[2],b[1],b[2]),tt=.5*Math.PI,st=q>=-tt&&q<=tt,ht=J>=-tt&&J<=tt;let nt,ut;if(st&&ht){const It=this.center.lng*Math.PI/180,St=this.center.lat*Math.PI/180;o.bC(F,It)+o.bC(q,St)<o.bC(O,It)+o.bC(J,St)?(nt=F,ut=q):(nt=O,ut=J)}else if(st)nt=F,ut=q;else{if(!ht)return;nt=O,ut=J}const mt=nt/Math.PI*180,ot=ut/Math.PI*180,xt=this.center.lat;this.setCenter(new o.S(mt,o.ag(ot,-90,90))),this.setZoom(this.zoom+Yi(xt,this.center.lat))}locationToScreenPoint(t,r){const c=nr(t);if(r){const d=r.getElevationForLngLatZoom(t,this._helper._tileZoom);o.aQ(c,c,1+d/o.bt)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(t){const r=o.bu();return o.av(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new o.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,r){if(r){const c=r.pointCoordinate(t);if(c)return c}return o.a0.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,r){var c;return(c=this.screenPointToMercatorCoordinate(t,r))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(t,r){const c=this._cameraPosition,d=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(c,d)}getRayDirectionFromPixel(t){const r=o.bu();r[0]=t.x/this.width*2-1,r[1]=-1*(t.y/this.height*2-1),r[2]=1,r[3]=1,o.av(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const c=o.bo();c[0]=r[0]-this._cameraPosition[0],c[1]=r[1]-this._cameraPosition[1],c[2]=r[2]-this._cameraPosition[2];const d=o.bo();return o.aU(d,c),d}isSurfacePointVisible(t){const r=this._cachedClippingPlane;return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const r=o.bu();return o.av(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(t,r){const c=o.aW(t,r),d=o.bo(),_=o.bo();o.aQ(_,r,c),o.aT(d,t,_);const b=1-o.aW(d,d);if(b<0)return null;const M=o.aW(t,t)-1,T=-c+(c<0?1:-1)*Math.sqrt(b),I=M/T,R=T;return{tMin:Math.min(I,R),tMax:Math.max(I,R)}}unprojectScreenPoint(t){const r=this._cameraPosition,c=this.getRayDirectionFromPixel(t),d=this.rayPlanetIntersection(r,c);if(d){const R=o.bo();o.aR(R,r,[c[0]*d.tMin,c[1]*d.tMin,c[2]*d.tMin]);const F=o.bo();return o.aU(F,R),ka(F)}const _=this._cachedClippingPlane,b=_[0]*c[0]+_[1]*c[1]+_[2]*c[2],M=-o.b0(_,r)/b,T=o.bo();if(M>0)o.aR(T,r,[c[0]*M,c[1]*M,c[2]*M]);else{const R=o.bo();o.aR(R,r,[2*c[0],2*c[1],2*c[2]]);const F=o.b0(this._cachedClippingPlane,R);o.aT(T,R,[this._cachedClippingPlane[0]*F,this._cachedClippingPlane[1]*F,this._cachedClippingPlane[2]*F])}const I=function(R){const F=o.bo();return F[0]=R[0]*-R[3],F[1]=R[1]*-R[3],F[2]=R[2]*-R[3],{center:F,radius:Math.sqrt(1-R[3]*R[3])}}(_);return ka(function(R,F,O){const G=o.bo();o.aT(G,O,R);const q=o.bo();return o.bp(q,R,G,F/o.a_(G)),q}(I.center,I.radius,T))}getMatrixForModel(t,r){const c=o.S.convert(t),d=1/o.bt,_=o.b8();return o.by(_,_,c.lng/180*Math.PI),o.b6(_,_,-c.lat/180*Math.PI),o.M(_,_,[0,0,1+r/o.bt]),o.b6(_,_,.5*Math.PI),o.N(_,_,[d,d,d]),_}getProjectionDataForCustomLayer(t=!0){const r=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:t});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(t){}}class Zr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,c){return this._helper.interpolatePadding(t,r,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,c=!0){this._helper.resize(t,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,r){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ra({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,r)=>this.getConstrained(t,r)}),this._globeness=1,this._mercatorTransform=new Ki,this._verticalPerspectiveTransform=new qn}clone(){const t=new Zr;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const r=this._mercatorTransform.getProjectionData(t),c=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:r.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return o.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,r,c){const d=this._mercatorTransform.getPitchedTextCorrection(t,r,c),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,r,c);return o.bj(d,_,this._globeness)}projectTileCoordinates(t,r,c,d){return this.currentTransform.projectTileCoordinates(t,r,c,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){return this.currentTransform.lngLatToCameraDepth(t,r)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,r){return this.currentTransform.getConstrained(t,r)}calculateCenterFromCameraLngLatAlt(t,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,c,d)}setLocationAtPoint(t,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,r){return this.currentTransform.locationToScreenPoint(t,r)}screenPointToMercatorCoordinate(t,r){return this.currentTransform.screenPointToMercatorCoordinate(t,r)}screenPointToLocation(t,r){return this.currentTransform.screenPointToLocation(t,r)}isPointOnMapSurface(t,r){return this.currentTransform.isPointOnMapSurface(t,r)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,r){return this.currentTransform.getMatrixForModel(t,r)}getProjectionDataForCustomLayer(t=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return r;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return c.fallbackMatrix=r.mainMatrix,c}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Gr{get useGlobeControls(){return!0}handlePanInertia(t,r){const c=La(t,r);return Math.abs(c.lng-r.center.lng)>180&&(c.lng=r.center.lng+179.5*Math.sign(c.lng-r.center.lng)),{easingCenter:c,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,r){const c=t.around,d=r.screenPointToLocation(c);t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta);const _=r.zoom;t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta);const b=r.zoom-_;if(b===0)return;const M=o.bz(r.center.lng,d.lng),T=M/(Math.abs(M/180)+1),I=o.bz(r.center.lat,d.lat),R=r.getRayDirectionFromPixel(c),F=r.cameraPosition,O=-1*o.aW(F,R),G=o.bo();o.aR(G,F,[R[0]*O,R[1]*O,R[2]*O]);const q=o.aY(G)-1,Q=Math.exp(.5*-Math.max(q-.3,0)),J=jn(r.worldSize,r.center.lat)/Math.min(r.width,r.height),tt=o.bm(J,.9,.5,1,.25),st=(1-o.ae(-b))*Math.min(Q,tt),ht=r.center.lat,nt=r.zoom,ut=new o.S(r.center.lng+T*st,o.ag(r.center.lat+I*st,-85.051129,o.ah));r.setLocationAtPoint(d,c);const mt=r.center,ot=o.bm(Math.abs(M),45,85,0,1),xt=o.bm(J,.75,.35,0,1),It=Math.pow(Math.max(ot,xt),.25),St=o.bz(mt.lng,ut.lng),Pt=o.bz(mt.lat,ut.lat);r.setCenter(new o.S(mt.lng+St*It,mt.lat+Pt*It).wrap()),r.setZoom(nt+Yi(ht,r.center.lat))}handleMapControlsPan(t,r,c){if(!t.panDelta)return;const d=r.center.lat,_=r.zoom;r.setCenter(La(t.panDelta,r).wrap()),r.setZoom(_+Yi(d,r.center.lat))}cameraForBoxAndBearing(t,r,c,d,_){const b=ki(t,r,c,d,_),M=r.left/_.width*2-1,T=(_.width-r.right)/_.width*2-1,I=r.top/_.height*-2+1,R=(_.height-r.bottom)/_.height*-2+1,F=o.bz(c.getWest(),c.getEast())<0,O=F?c.getEast():c.getWest(),G=F?c.getWest():c.getEast(),q=Math.max(c.getNorth(),c.getSouth()),Q=Math.min(c.getNorth(),c.getSouth()),J=O+.5*o.bz(O,G),tt=q+.5*o.bz(q,Q),st=_.clone();st.setCenter(b.center),st.setBearing(b.bearing),st.setPitch(0),st.setRoll(0),st.setZoom(b.zoom);const ht=st.modelViewProjectionMatrix,nt=[nr(c.getNorthWest()),nr(c.getNorthEast()),nr(c.getSouthWest()),nr(c.getSouthEast()),nr(new o.S(G,tt)),nr(new o.S(O,tt)),nr(new o.S(J,q)),nr(new o.S(J,Q))],ut=nr(b.center);let mt=Number.POSITIVE_INFINITY;for(const ot of nt)M<0&&(mt=Gr.getLesserNonNegativeNonNull(mt,Gr.solveVectorScale(ot,ut,ht,"x",M))),T>0&&(mt=Gr.getLesserNonNegativeNonNull(mt,Gr.solveVectorScale(ot,ut,ht,"x",T))),I>0&&(mt=Gr.getLesserNonNegativeNonNull(mt,Gr.solveVectorScale(ot,ut,ht,"y",I))),R<0&&(mt=Gr.getLesserNonNegativeNonNull(mt,Gr.solveVectorScale(ot,ut,ht,"y",R)));if(Number.isFinite(mt)&&mt!==0)return b.zoom=st.zoom+o.aj(mt),b;Mr()}handleJumpToCenterZoom(t,r){const c=t.center.lat,d=t.getConstrained(r.center?o.S.convert(r.center):t.center,t.zoom).center;t.setCenter(d.wrap());const _=r.zoom!==void 0?+r.zoom:t.zoom+Yi(c,d.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,r){const c=t.zoom,d=t.center,_=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},M={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},T=r.zoom!==void 0,I=!t.isPaddingEqual(r.padding);let R=!1;const F=r.center?o.S.convert(r.center):d,O=t.getConstrained(F,c).center;Fs(t,O);const G=t.clone();G.setCenter(O),G.setZoom(T?+r.zoom:c+Yi(d.lat,F.lat)),G.setBearing(r.bearing);const q=new o.P(o.ag(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),o.ag(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));G.setLocationAtPoint(O,q);const Q=(r.offset&&r.offsetAsPoint.mag())>0?G.center:O,J=T?+r.zoom:c+Yi(d.lat,Q.lat),tt=c+Yi(d.lat,0),st=J+Yi(Q.lat,0),ht=o.bz(d.lng,Q.lng),nt=o.bz(d.lat,Q.lat),ut=o.ae(st-tt);return R=J!==c,{easeFunc:mt=>{if(o.bd(b,M)||sr({startEulerAngles:b,endEulerAngles:M,tr:t,k:mt,useSlerp:b.roll!=M.roll}),I&&t.interpolatePadding(_,r.padding,mt),r.around)o.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(r.around,r.aroundPoint);else{const ot=st>tt?Math.min(2,ut):Math.max(.5,ut),xt=Math.pow(ot,1-mt),It=$n(d,ht,nt,mt*xt);t.setCenter(It.wrap())}if(R){const ot=o.C.number(tt,st,mt)+Yi(0,t.center.lat);t.setZoom(ot)}},isZooming:R,elevationCenter:Q}}handleFlyTo(t,r){const c=r.zoom!==void 0,d=t.center,_=t.zoom,b=t.padding,M=!t.isPaddingEqual(r.padding),T=t.getConstrained(o.S.convert(r.center||r.locationAtOffset),_).center,I=c?+r.zoom:t.zoom+Yi(t.center.lat,T.lat),R=t.clone();R.setCenter(T),R.setZoom(I),R.setBearing(r.bearing);const F=new o.P(o.ag(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),o.ag(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));R.setLocationAtPoint(T,F);const O=R.center;Fs(t,O);const G=function(nt,ut,mt){const ot=nr(ut),xt=nr(mt),It=o.aW(ot,xt),St=Math.acos(It),Pt=za(nt);return St/(2*Math.PI)*Pt}(t,d,O),q=_+Yi(d.lat,0),Q=I+Yi(O.lat,0),J=o.ae(Q-q);let tt;if(typeof r.minZoom=="number"){const nt=+r.minZoom+Yi(O.lat,0),ut=Math.min(nt,q,Q)+Yi(0,O.lat),mt=t.getConstrained(O,ut).zoom+Yi(O.lat,0);tt=o.ae(mt-q)}const st=o.bz(d.lng,O.lng),ht=o.bz(d.lat,O.lat);return{easeFunc:(nt,ut,mt,ot)=>{const xt=$n(d,st,ht,mt);M&&t.interpolatePadding(b,r.padding,nt);const It=nt===1?O:xt;t.setCenter(It.wrap());const St=q+o.aj(ut);t.setZoom(nt===1?I:St+Yi(0,It.lat))},scaleOfZoom:J,targetCenter:O,scaleOfMinZoom:tt,pixelPathLength:G}}static solveVectorScale(t,r,c,d,_){const b=d==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],M=[c[3],c[7],c[11],c[15]],T=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],I=t[0]*M[0]+t[1]*M[1]+t[2]*M[2],R=r[0]*b[0]+r[1]*b[1]+r[2]*b[2],F=r[0]*M[0]+r[1]*M[1]+r[2]*M[2];return R+_*I===T+_*F||M[3]*(T-R)+b[3]*(F-I)+T*F==R*I?null:(R+b[3]-_*F-_*M[3])/(R-T-_*F+_*I)}static getLesserNonNegativeNonNull(t,r){return r!==null&&r>=0&&r<t?r:t}}class sh{constructor(t){this._globe=t,this._mercatorCameraHelper=new Ro,this._verticalPerspectiveCameraHelper=new Gr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,r){return this.currentHelper.handlePanInertia(t,r)}handleMapControlsRollPitchBearingZoom(t,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,r)}handleMapControlsPan(t,r,c){this.currentHelper.handleMapControlsPan(t,r,c)}cameraForBoxAndBearing(t,r,c,d,_){return this.currentHelper.cameraForBoxAndBearing(t,r,c,d,_)}handleJumpToCenterZoom(t,r){this.currentHelper.handleJumpToCenterZoom(t,r)}handleEaseTo(t,r){return this.currentHelper.handleEaseTo(t,r)}handleFlyTo(t,r){return this.currentHelper.handleFlyTo(t,r)}}const Fa=(g,t)=>o.y(g,t&&t.filter(r=>r.identifier!=="source.canvas")),Zn=o.bD();class nh extends o.E{constructor(t,r={}){super(),this._rtlPluginLoaded=()=>{for(const c in this.sourceCaches){const d=this.sourceCaches[c].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[c].reload()}},this.map=t,this.dispatcher=new Ee(de(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(c,d)=>this.getGlyphs(c,d)),this.dispatcher.registerMessageHandler("GI",(c,d)=>this.getImages(c,d)),this.imageManager=new Re,this.imageManager.setEventedParent(this),this.glyphManager=new Qe(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new qt(256,512),this.crossTileSymbolIndex=new Io,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bF()),Vi().on(ci,this._rtlPluginLoaded),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const d=this.sourceCaches[c.sourceId];if(!d)return;const _=d.getSource();if(_&&_.vectorLayerIds)for(const b in this._layers){const M=this._layers[b];M.source===_.id&&this._validateLayer(M)}})}setGlobalStateProperty(t,r){var c,d,_;this._checkLoaded();const b=r===null?(_=(d=(c=this.stylesheet.state)===null||c===void 0?void 0:c[t])===null||d===void 0?void 0:d.default)!==null&&_!==void 0?_:null:r;if(o.bG(b,this._globalState[t]))return this;this._globalState[t]=b;const M=this._findGlobalStateAffectedSources([t]);for(const T in this.sourceCaches)M.has(T)&&(this._reloadSource(T),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const r=[];for(const d in t)!o.bG(this._globalState[d],t[d].default)&&(r.push(d),this._globalState[d]=t[d].default);const c=this._findGlobalStateAffectedSources(r);for(const d in this.sourceCaches)c.has(d)&&(this._reloadSource(d),this._changed=!0)}_findGlobalStateAffectedSources(t){if(t.length===0)return new Set;const r=new Set;for(const c in this._layers){const d=this._layers[c],_=d.getLayoutAffectingGlobalStateRefs();for(const b of t)_.has(b)&&r.add(d.source)}return r}loadURL(t,r={},c){this.fire(new o.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const d=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;o.j(d,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,r,c)}).catch(b=>{this._loadStyleRequest=null,b&&!_.signal.aborted&&this.fire(new o.k(b))})}loadJSON(t,r={},c){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,D.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(t,r,c)}).catch(()=>{})}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Zn,{validate:!1})}_load(t,r,c){var d,_,b;const M=r.transformStyle?r.transformStyle(c,t):t;if(!r.validate||!Fa(this,o.z(M))){this._loaded=!0,this.stylesheet=M;for(const T in M.sources)this.addSource(T,M.sources[T],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new Ii(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new Nt(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.setGlobalState((b=this.stylesheet.state)!==null&&b!==void 0?b:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){const t=o.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of t){const c=o.bI(r);c.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=c}}_loadSprite(t,r=!1,c=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,b,M,T){return o._(this,void 0,void 0,function*(){const I=re(_),R=M>1?"@2x":"",F={},O={};for(const{id:G,url:q}of I){const Q=b.transformRequest(Ie(q,R,".json"),"SpriteJSON");F[G]=o.j(Q,T);const J=b.transformRequest(Ie(q,R,".png"),"SpriteImage");O[G]=jt.getImage(J,T)}return yield Promise.all([...Object.values(F),...Object.values(O)]),function(G,q){return o._(this,void 0,void 0,function*(){const Q={};for(const J in G){Q[J]={};const tt=D.getImageCanvasContext((yield q[J]).data),st=(yield G[J]).data;for(const ht in st){const{width:nt,height:ut,x:mt,y:ot,sdf:xt,pixelRatio:It,stretchX:St,stretchY:Pt,content:Ct,textFitWidth:te,textFitHeight:Jt}=st[ht];Q[J][ht]={data:null,pixelRatio:It,sdf:xt,stretchX:St,stretchY:Pt,content:Ct,textFitWidth:te,textFitHeight:Jt,spriteData:{width:nt,height:ut,x:mt,y:ot,context:tt}}}}return Q})}(F,O)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const b in _){this._spritesImagesIds[b]=[];const M=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(T=>!(T in _)):[];for(const T of M)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in _[b]){const I=b==="default"?T:`${b}:${T}`;this._spritesImagesIds[b].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,_[b][T],!1):this.imageManager.addImage(I,_[b][T]),r&&(this._changedImages[I]=!0)}}}).catch(_=>{this._spriteRequest=null,d=_,this.fire(new o.k(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),c&&c(d)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(t){const r=this.sourceCaches[t.source];if(!r)return;const c=t.sourceLayer;if(!c)return;const d=r.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.k(new Error(`Source layer "${c}" does not exist on source "${d.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,r=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r?o.bJ(c):c);const d=[];for(const _ of t)if(c[_]){const b=r?o.bJ(c[_]):c[_];d.push(b)}return d}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const c of r){const d=this._layers[c];d.type!=="custom"&&(t[c]=d.serialize())}return t}hasTransitions(){var t,r,c;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(r){const d=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(d.length||_.length)&&this._updateWorkerLayers(d,_);for(const b in this._updatedSources){const M=this._updatedSources[b];if(M==="reload")this._reloadSource(b);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const d in this.sourceCaches){const _=this.sourceCaches[d];c[d]=_.used,_.used=!1}for(const d of this._order){const _=this._layers[d];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const d in c){const _=this.sourceCaches[d];!!c[d]!=!!_.used&&_.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,r&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){var c;this._checkLoaded();const d=this.serialize();if(t=r.transformStyle?r.transformStyle(d,t):t,((c=r.validate)===null||c===void 0||c)&&Fa(this,o.z(t)))return!1;(t=o.bJ(t)).layers=o.bH(t.layers);const _=o.bK(d,t),b=this._getOperationsToPerform(_);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const M of b.operations)M();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const r=[],c=[];for(const d of t)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":r.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":r.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,d.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setSky":r.push(()=>this.setSky.apply(this,d.args));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":r.push(()=>this.setGlobalState.apply(this,d.args));break;case"setTransition":r.push(()=>{});break;default:c.push(d.command)}return{operations:r,unimplemented:c}}addImage(t,r){if(this.getImage(t))return this.fire(new o.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,c={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(o.z.source,`sources.${t}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const d=this.sourceCaches[t]=new Bt(t,r,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:t})),d.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new o.k(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.sourceCaches[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(r),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,r,c={}){this._checkLoaded();const d=t.id;if(this.getLayer(d))return void this.fire(new o.k(new Error(`Layer "${d}" already exists on this map.`)));let _;if(t.type==="custom"){if(Fa(this,o.bL(t)))return;_=o.bI(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(d,t.source),t=o.bJ(t),t=o.e(t,{source:d})),this._validate(o.z.layer,`layers.${d}`,t,{arrayIndex:-1},c))return;_=o.bI(t),this._validateLayer(_),_.setEventedParent(this,{layer:{id:d}})}const b=r?this._order.indexOf(r):this._order.length;if(r&&b===-1)this.fire(new o.k(new Error(`Cannot add layer "${d}" before non-existing layer "${r}".`)));else{if(this._order.splice(b,0,d),this._layerOrderChanged=!0,this._layers[d]=_,this._removedLayers[d]&&_.source&&_.type!=="custom"){const M=this._removedLayers[d];delete this._removedLayers[d],M.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const c=this._order.indexOf(t);this._order.splice(c,1);const d=r?this._order.indexOf(r):this._order.length;r&&d===-1?this.fire(new o.k(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(d,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,c){this._checkLoaded();const d=this.getLayer(t);d?d.minzoom===r&&d.maxzoom===c||(r!=null&&(d.minzoom=r),c!=null&&(d.maxzoom=c),this._updateLayer(d)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,c={}){this._checkLoaded();const d=this.getLayer(t);if(d){if(!o.bG(d.filter,r))return r==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(o.z.filter,`layers.${d.id}.filter`,r,null,c)||(d.setFilter(o.bJ(r)),this._updateLayer(d)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.bJ(this.getLayer(t).filter)}setLayoutProperty(t,r,c,d={}){this._checkLoaded();const _=this.getLayer(t);_?o.bG(_.getLayoutProperty(r),c)||(_.setLayoutProperty(r,c,d),this._updateLayer(_)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const c=this.getLayer(t);if(c)return c.getLayoutProperty(r);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,c,d={}){this._checkLoaded();const _=this.getLayer(t);_?o.bG(_.getPaintProperty(r),c)||(_.setPaintProperty(r,c,d)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new o.k(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const c=t.source,d=t.sourceLayer,_=this.sourceCaches[c];if(_===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));const b=_.getSource().type;b==="geojson"&&d?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||d?(t.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(d,t.id,r)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const c=t.source,d=this.sourceCaches[c];if(d===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));const _=d.getSource().type,b=_==="vector"?t.sourceLayer:void 0;_!=="vector"||b?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(b,t.id,r):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,c=t.sourceLayer,d=this.sourceCaches[r];if(d!==void 0)return d.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(c,t.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=o.bM(this.sourceCaches,_=>_.serialize()),r=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,d=this.stylesheet;return o.bN({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:t,layers:r,terrain:c},_=>_!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=b=>this._layers[b].type==="fill-extrusion",c={},d=[];for(let b=this._order.length-1;b>=0;b--){const M=this._order[b];if(r(M)){c[M]=b;for(const T of t){const I=T[M];if(I)for(const R of I)d.push(R)}}}d.sort((b,M)=>M.intersectionZ-b.intersectionZ);const _=[];for(let b=this._order.length-1;b>=0;b--){const M=this._order[b];if(r(M))for(let T=d.length-1;T>=0;T--){const I=d[T].feature;if(c[I.layer.id]<b)break;_.push(I),d.pop()}else for(const T of t){const I=T[M];if(I)for(const R of I)_.push(R.feature)}}return _}queryRenderedFeatures(t,r,c){r&&r.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",r.filter,null,r);const d={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const I of r.layers){const R=this._layers[I];if(!R)return this.fire(new o.k(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];d[R.source]=!0}}const _=[];r.availableImages=this._availableImages;const b=this._serializedAllLayers(),M=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,T=Object.assign(Object.assign({},r),{layers:M});for(const I in this.sourceCaches)r.layers&&!d[I]||_.push(ae(this.sourceCaches[I],this._layers,b,t,T,c,this.map.terrain?(R,F,O)=>this.map.terrain.getElevation(R,F,O):void 0));return this.placement&&_.push(function(I,R,F,O,G,q,Q){const J={},tt=q.queryRenderedSymbols(O),st=[];for(const ht of Object.keys(tt).map(Number))st.push(Q[ht]);st.sort(Se);for(const ht of st){const nt=ht.featureIndex.lookupSymbolFeatures(tt[ht.bucketInstanceId],R,ht.bucketIndex,ht.sourceLayerIndex,G.filter,G.layers,G.availableImages,I);for(const ut in nt){const mt=J[ut]=J[ut]||[],ot=nt[ut];ot.sort((xt,It)=>{const St=ht.featureSortOrder;if(St){const Pt=St.indexOf(xt.featureIndex);return St.indexOf(It.featureIndex)-Pt}return It.featureIndex-xt.featureIndex});for(const xt of ot)mt.push(xt)}}return function(ht,nt,ut){for(const mt in ht)for(const ot of ht[mt])ze(ot,ut[nt[mt].source]);return ht}(J,I,F)}(this._layers,b,this.sourceCaches,t,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,r){r&&r.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",r.filter,null,r);const c=this.sourceCaches[t];return c?function(d,_){const b=d.getRenderableIds().map(I=>d.getTileByID(I)),M=[],T={};for(let I=0;I<b.length;I++){const R=b[I],F=R.tileID.canonical.key;T[F]||(T[F]=!0,R.querySourceFeatures(M,_))}return M}(c,r):[]}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const c=this.light.getLight();let d=!1;for(const b in t)if(!o.bG(t[b],c[b])){d=!0;break}if(!d)return;const _={now:D.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,r={}){this._checkLoaded();const c=this.getSky();let d=!1;if(!t&&!c)return;if(t&&!c)d=!0;else if(!t&&c)d=!0;else for(const b in t)if(!o.bG(t[b],c[b])){d=!0;break}if(!d)return;const _={now:D.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,r),this.sky.updateTransitions(_)}_setProjectionInternal(t){const r=function(c){if(Array.isArray(c)){const d=new Da({type:c});return{projection:d,transform:new Zr,cameraHelper:new sh(d)}}switch(c){case"mercator":return{projection:new th,transform:new Ki,cameraHelper:new Ro};case"globe":{const d=new Da({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:d,transform:new Zr,cameraHelper:new sh(d)}}case"vertical-perspective":return{projection:new Yc,transform:new qn,cameraHelper:new Gr};default:return o.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new th,transform:new Ki,cameraHelper:new Ro}}}(t);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const c in this.sourceCaches)this.sourceCaches[c].reload()}_validate(t,r,c,d,_={}){return(!_||_.validate!==!1)&&Fa(this,t.call(o.z,o.e({key:r,style:this.serialize(),value:c,styleSpec:o.v},d)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Vi().off(ci,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const c=this.sourceCaches[r];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const r in this.sourceCaches)this.sourceCaches[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,r,c,d,_=!1){let b=!1,M=!1;const T={};for(const I of this._order){const R=this._layers[I];if(R.type!=="symbol")continue;if(!T[R.source]){const O=this.sourceCaches[R.source];T[R.source]=O.getRenderableIds(!0).map(G=>O.getTileByID(G)).sort((G,q)=>q.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(q.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(R,T[R.source],t.center.lng);b=b||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(D.now(),t.zoom))&&(this.pauseablePlacement=new Hc(t,this.map.terrain,this._order,_,r,c,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(D.now()),M=!0),b&&this.pauseablePlacement.placement.setStale()),M||b)for(const I of this._order){const R=this._layers[I];R.type==="symbol"&&this.placement.updateLayerOpacities(R,T[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(D.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,r){return o._(this,void 0,void 0,function*(){const c=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[r.source];return d&&d.setDependencies(r.tileID.key,r.type,r.icons),c})}getGlyphs(t,r){return o._(this,void 0,void 0,function*(){const c=yield this.glyphManager.getGlyphs(r.stacks),d=this.sourceCaches[r.source];return d&&d.setDependencies(r.tileID.key,r.type,[""]),c})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(o.z.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,r,c={},d){this._checkLoaded();const _=[{id:t,url:r}],b=[...re(this.stylesheet.sprite),..._];this._validate(o.z.sprite,"sprite",b,null,c)||(this.stylesheet.sprite=b,this._loadSprite(_,!0,d))}removeSprite(t){this._checkLoaded();const r=re(this.stylesheet.sprite);if(r.find(c=>c.id===t)){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;r.splice(r.findIndex(c=>c.id===t),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return re(this.stylesheet.sprite)}setSprite(t,r={},c){this._checkLoaded(),t&&this._validate(o.z.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}}var Jd=o.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,c,d,_,b,M,T,I){this.context=t;let R=this.boundPaintVertexBuffers.length!==d.length;for(let F=0;!R&&F<d.length;F++)this.boundPaintVertexBuffers[F]!==d[F]&&(R=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||R||this.boundIndexBuffer!==_||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==I?this.freshBind(r,c,d,_,b,M,T,I):(t.bindVertexArray.set(this.vao),M&&M.bind(),_&&_.dynamicDraw&&_.bind(),T&&T.bind(),I&&I.bind())}freshBind(t,r,c,d,_,b,M,T){const I=t.numAttributes,R=this.context,F=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=T,r.enableAttributes(F,t);for(const O of c)O.enableAttributes(F,t);b&&b.enableAttributes(F,t),M&&M.enableAttributes(F,t),T&&T.enableAttributes(F,t),r.bind(),r.setVertexAttribPointers(F,t,_);for(const O of c)O.bind(),O.setVertexAttribPointers(F,t,_);b&&(b.bind(),b.setVertexAttribPointers(F,t,_)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(F,t,_)),T&&(T.bind(),T.setVertexAttribPointers(F,t,_)),R.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const tf=(g,t,r,c,d)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:t,u_fog_color:r?r.properties.get("fog-color"):o.be.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:r?r.calculateFogBlendOpacity(c):0,u_horizon_color:r?r.properties.get("horizon-color"):o.be.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),ef={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Do(g){const t=[];for(let r=0;r<g.length;r++){if(g[r]===null)continue;const c=g[r].split(" ");t.push(c.pop())}return t}class zo{constructor(t,r,c,d,_,b,M,T,I=[]){const R=t.gl;this.program=R.createProgram();const F=Do(r.staticAttributes),O=c?c.getBinderAttributes():[],G=F.concat(O),q=bs.prelude.staticUniforms?Do(bs.prelude.staticUniforms):[],Q=M.staticUniforms?Do(M.staticUniforms):[],J=r.staticUniforms?Do(r.staticUniforms):[],tt=c?c.getBinderUniforms():[],st=q.concat(Q).concat(J).concat(tt),ht=[];for(const St of st)ht.indexOf(St)<0&&ht.push(St);const nt=c?c.defines():[];Er(R)&&nt.unshift("#version 300 es"),_&&nt.push("#define OVERDRAW_INSPECTOR;"),b&&nt.push("#define TERRAIN3D;"),T&&nt.push(T),I&&nt.push(...I);let ut=nt.concat(bs.prelude.fragmentSource,M.fragmentSource,r.fragmentSource).join(`
`),mt=nt.concat(bs.prelude.vertexSource,M.vertexSource,r.vertexSource).join(`
`);Er(R)||(ut=function(St){return St.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ut),mt=function(St){return St.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(mt));const ot=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(ot,ut),R.compileShader(ot),!R.getShaderParameter(ot,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(ot)}`);R.attachShader(this.program,ot);const xt=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(xt,mt),R.compileShader(xt),!R.getShaderParameter(xt,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(xt)}`);R.attachShader(this.program,xt),this.attributes={};const It={};this.numAttributes=G.length;for(let St=0;St<this.numAttributes;St++)G[St]&&(R.bindAttribLocation(this.program,St,G[St]),this.attributes[G[St]]=St);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(xt),R.deleteShader(ot);for(let St=0;St<ht.length;St++){const Pt=ht[St];if(Pt&&!It[Pt]){const Ct=R.getUniformLocation(this.program,Pt);Ct&&(It[Pt]=Ct)}}this.fixedUniforms=d(t,It),this.terrainUniforms=((St,Pt)=>({u_depth:new o.bO(St,Pt.u_depth),u_terrain:new o.bO(St,Pt.u_terrain),u_terrain_dim:new o.bf(St,Pt.u_terrain_dim),u_terrain_matrix:new o.bQ(St,Pt.u_terrain_matrix),u_terrain_unpack:new o.bR(St,Pt.u_terrain_unpack),u_terrain_exaggeration:new o.bf(St,Pt.u_terrain_exaggeration)}))(t,It),this.projectionUniforms=((St,Pt)=>({u_projection_matrix:new o.bQ(St,Pt.u_projection_matrix),u_projection_tile_mercator_coords:new o.bR(St,Pt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bR(St,Pt.u_projection_clipping_plane),u_projection_transition:new o.bf(St,Pt.u_projection_transition),u_projection_fallback_matrix:new o.bQ(St,Pt.u_projection_fallback_matrix)}))(t,It),this.binderUniforms=c?c.getUniforms(t,It):[]}draw(t,r,c,d,_,b,M,T,I,R,F,O,G,q,Q,J,tt,st,ht){const nt=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(d),t.setColorMode(_),t.setCullFace(b),T){t.activeTexture.set(nt.TEXTURE2),nt.bindTexture(nt.TEXTURE_2D,T.depthTexture),t.activeTexture.set(nt.TEXTURE3),nt.bindTexture(nt.TEXTURE_2D,T.texture);for(const mt in this.terrainUniforms)this.terrainUniforms[mt].set(T[mt])}if(I)for(const mt in I)this.projectionUniforms[ef[mt]].set(I[mt]);if(M)for(const mt in this.fixedUniforms)this.fixedUniforms[mt].set(M[mt]);J&&J.setUniforms(t,this.binderUniforms,q,{zoom:Q});let ut=0;switch(r){case nt.LINES:ut=2;break;case nt.TRIANGLES:ut=3;break;case nt.LINE_STRIP:ut=1}for(const mt of G.get()){const ot=mt.vaos||(mt.vaos={});(ot[R]||(ot[R]=new Qd)).bind(t,this,F,J?J.getPaintVertexBuffers():[],O,mt.vertexOffset,tt,st,ht),nt.drawElements(r,mt.primitiveLength*ut,nt.UNSIGNED_SHORT,mt.primitiveOffset*ut*2)}}}function ko(g,t,r){const c=1/o.aB(r,1,t.transform.tileZoom),d=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,t.transform.tileZoom)/d,b=_*(r.tileID.canonical.x+r.tileID.wrap*d),M=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[c,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[b>>16,M>>16],u_pixel_coord_lower:[65535&b,65535&M]}}const Ba=(g,t,r,c)=>{const d=g.style.light,_=d.properties.get("position"),b=[_.x,_.y,_.z],M=o.bU();d.properties.get("anchor")==="viewport"&&o.bV(M,g.transform.bearingInRadians),o.bW(b,b,M);const T=g.transform.transformLightDirection(b),I=d.properties.get("color");return{u_lightpos:b,u_lightpos_globe:T,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+t,u_opacity:r,u_fill_translate:c}},ah=(g,t,r,c,d,_,b)=>o.e(Ba(g,t,r,c),ko(_,g,b),{u_height_factor:-Math.pow(2,d.overscaledZ)/b.tileSize/8}),Lo=(g,t,r,c)=>o.e(ko(t,g,r),{u_fill_translate:c}),Ms=(g,t)=>({u_world:g,u_fill_translate:t}),rf=(g,t,r,c,d)=>o.e(Lo(g,t,r,d),{u_world:c}),oh=(g,t,r,c,d)=>{const _=g.transform;let b,M,T=0;if(r.paint.get("circle-pitch-alignment")==="map"){const I=o.aB(t,1,_.zoom);b=!0,M=[I,I],T=I/(o.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*d}else b=!1,M=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+b,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:M,u_globe_extrude_scale:T,u_translate:c}},Na=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),Ga=g=>({u_viewport_size:[g.width,g.height]}),Qc=(g,t=1)=>({u_color:g,u_overlay:0,u_overlay_scale:t}),ja=(g,t,r,c)=>{const d=o.aB(g,1,t)/(o.$*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:o.aB(g,1,t),u_intensity:r,u_globe_extrude_scale:d}},tu=(g,t,r,c)=>{const d=o.L();o.bX(d,0,g.width,g.height,0,0,1);const _=g.context.gl;return{u_matrix:d,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:r,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}},Wn=(g,t,r)=>{const c=r.paint.get("hillshade-accent-color");let d;switch(r.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}const _=r.getIlluminationProperties();for(let b=0;b<_.directionRadians.length;b++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[b]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:eu(0,t.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:c,u_method:d,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},sf=(g,t)=>{const r=t.stride,c=o.L();return o.bX(c,0,o.$,-8192,0,0,1),o.M(c,c,[0,-8192,0]),{u_matrix:c,u_image:1,u_dimension:[r,r],u_zoom:g.overscaledZ,u_unpack:t.getUnpackVector()}};function eu(g,t){const r=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new o.a0(0,c/r).toLngLat().lat,new o.a0(0,(c+1)/r).toLngLat().lat]}const nf=(g,t)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_opacity:g.paint.get("color-relief-opacity")}),Oo=(g,t,r,c)=>{const d=g.transform;return{u_translation:ch(g,t,r),u_ratio:c/o.aB(t,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},lh=(g,t,r,c,d)=>o.e(Oo(g,t,r,c),{u_image:0,u_image_height:d}),iu=(g,t,r,c,d)=>{const _=g.transform,b=hh(t,_);return{u_translation:ch(g,t,r),u_texsize:t.imageAtlasTexture.size,u_ratio:c/o.aB(t,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[b,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},ru=(g,t,r,c,d,_)=>{const b=g.lineAtlas,M=hh(t,g.transform),T=r.layout.get("line-cap")==="round",I=b.getDash(d.from,T),R=b.getDash(d.to,T),F=I.width*_.fromScale,O=R.width*_.toScale;return o.e(Oo(g,t,r,c),{u_patternscale_a:[M/F,-I.height/2],u_patternscale_b:[M/O,-R.height/2],u_sdfgamma:b.width/(256*Math.min(F,O)*g.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:R.y,u_mix:_.t})};function hh(g,t){return 1/o.aB(g,1,t.tileZoom)}function ch(g,t,r){return o.aC(g.transform,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Sn=(g,t,r,c,d)=>{return{u_tl_parent:g,u_scale_parent:t,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(b=c.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(_=c.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:su(c.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var _,b};function su(g){g*=Math.PI/180;const t=Math.sin(g),r=Math.cos(g);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const uh=(g,t,r,c,d,_,b,M,T,I,R,F,O)=>{const G=b.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:G.width/G.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_label_plane_matrix:M,u_coord_matrix:T,u_is_text:+R,u_pitch_with_map:+c,u_is_along_line:d,u_is_variable_anchor:_,u_texsize:F,u_texture:0,u_translation:I,u_pitched_scale:O}},Xn=(g,t,r,c,d,_,b,M,T,I,R,F,O,G)=>{const q=b.transform;return o.e(uh(g,t,r,c,d,_,b,M,T,I,R,F,G),{u_gamma_scale:c?Math.cos(q.pitch*Math.PI/180)*q.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:1})},af=(g,t,r,c,d,_,b,M,T,I,R,F,O)=>o.e(Xn(g,t,r,c,d,_,b,M,T,I,!0,R,0,O),{u_texsize_icon:F,u_texture_icon:1}),Fo=(g,t)=>({u_opacity:g,u_color:t}),of=(g,t,r,c,d)=>o.e(function(_,b,M,T){const I=M.imageManager.getPattern(_.from.toString()),R=M.imageManager.getPattern(_.to.toString()),{width:F,height:O}=M.imageManager.getPixelSize(),G=Math.pow(2,T.tileID.overscaledZ),q=T.tileSize*Math.pow(2,M.transform.tileZoom)/G,Q=q*(T.tileID.canonical.x+T.tileID.wrap*G),J=q*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[F,O],u_mix:b.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/o.aB(T,1,M.transform.tileZoom),u_pixel_coord_upper:[Q>>16,J>>16],u_pixel_coord_lower:[65535&Q,65535&J]}}(r,d,t,c),{u_opacity:g}),nu=(g,t)=>{},au={fillExtrusion:(g,t)=>({u_lightpos:new o.bS(g,t.u_lightpos),u_lightpos_globe:new o.bS(g,t.u_lightpos_globe),u_lightintensity:new o.bf(g,t.u_lightintensity),u_lightcolor:new o.bS(g,t.u_lightcolor),u_vertical_gradient:new o.bf(g,t.u_vertical_gradient),u_opacity:new o.bf(g,t.u_opacity),u_fill_translate:new o.bT(g,t.u_fill_translate)}),fillExtrusionPattern:(g,t)=>({u_lightpos:new o.bS(g,t.u_lightpos),u_lightpos_globe:new o.bS(g,t.u_lightpos_globe),u_lightintensity:new o.bf(g,t.u_lightintensity),u_lightcolor:new o.bS(g,t.u_lightcolor),u_vertical_gradient:new o.bf(g,t.u_vertical_gradient),u_height_factor:new o.bf(g,t.u_height_factor),u_opacity:new o.bf(g,t.u_opacity),u_fill_translate:new o.bT(g,t.u_fill_translate),u_image:new o.bO(g,t.u_image),u_texsize:new o.bT(g,t.u_texsize),u_pixel_coord_upper:new o.bT(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(g,t.u_pixel_coord_lower),u_scale:new o.bS(g,t.u_scale),u_fade:new o.bf(g,t.u_fade)}),fill:(g,t)=>({u_fill_translate:new o.bT(g,t.u_fill_translate)}),fillPattern:(g,t)=>({u_image:new o.bO(g,t.u_image),u_texsize:new o.bT(g,t.u_texsize),u_pixel_coord_upper:new o.bT(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(g,t.u_pixel_coord_lower),u_scale:new o.bS(g,t.u_scale),u_fade:new o.bf(g,t.u_fade),u_fill_translate:new o.bT(g,t.u_fill_translate)}),fillOutline:(g,t)=>({u_world:new o.bT(g,t.u_world),u_fill_translate:new o.bT(g,t.u_fill_translate)}),fillOutlinePattern:(g,t)=>({u_world:new o.bT(g,t.u_world),u_image:new o.bO(g,t.u_image),u_texsize:new o.bT(g,t.u_texsize),u_pixel_coord_upper:new o.bT(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(g,t.u_pixel_coord_lower),u_scale:new o.bS(g,t.u_scale),u_fade:new o.bf(g,t.u_fade),u_fill_translate:new o.bT(g,t.u_fill_translate)}),circle:(g,t)=>({u_camera_to_center_distance:new o.bf(g,t.u_camera_to_center_distance),u_scale_with_map:new o.bO(g,t.u_scale_with_map),u_pitch_with_map:new o.bO(g,t.u_pitch_with_map),u_extrude_scale:new o.bT(g,t.u_extrude_scale),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_globe_extrude_scale:new o.bf(g,t.u_globe_extrude_scale),u_translate:new o.bT(g,t.u_translate)}),collisionBox:(g,t)=>({u_pixel_extrude_scale:new o.bT(g,t.u_pixel_extrude_scale)}),collisionCircle:(g,t)=>({u_viewport_size:new o.bT(g,t.u_viewport_size)}),debug:(g,t)=>({u_color:new o.bP(g,t.u_color),u_overlay:new o.bO(g,t.u_overlay),u_overlay_scale:new o.bf(g,t.u_overlay_scale)}),depth:nu,clippingMask:nu,heatmap:(g,t)=>({u_extrude_scale:new o.bf(g,t.u_extrude_scale),u_intensity:new o.bf(g,t.u_intensity),u_globe_extrude_scale:new o.bf(g,t.u_globe_extrude_scale)}),heatmapTexture:(g,t)=>({u_matrix:new o.bQ(g,t.u_matrix),u_world:new o.bT(g,t.u_world),u_image:new o.bO(g,t.u_image),u_color_ramp:new o.bO(g,t.u_color_ramp),u_opacity:new o.bf(g,t.u_opacity)}),hillshade:(g,t)=>({u_image:new o.bO(g,t.u_image),u_latrange:new o.bT(g,t.u_latrange),u_exaggeration:new o.bf(g,t.u_exaggeration),u_altitudes:new o.bZ(g,t.u_altitudes),u_azimuths:new o.bZ(g,t.u_azimuths),u_accent:new o.bP(g,t.u_accent),u_method:new o.bO(g,t.u_method),u_shadows:new o.bY(g,t.u_shadows),u_highlights:new o.bY(g,t.u_highlights)}),hillshadePrepare:(g,t)=>({u_matrix:new o.bQ(g,t.u_matrix),u_image:new o.bO(g,t.u_image),u_dimension:new o.bT(g,t.u_dimension),u_zoom:new o.bf(g,t.u_zoom),u_unpack:new o.bR(g,t.u_unpack)}),colorRelief:(g,t)=>({u_image:new o.bO(g,t.u_image),u_unpack:new o.bR(g,t.u_unpack),u_dimension:new o.bT(g,t.u_dimension),u_elevation_stops:new o.bO(g,t.u_elevation_stops),u_color_stops:new o.bO(g,t.u_color_stops),u_opacity:new o.bf(g,t.u_opacity)}),line:(g,t)=>({u_translation:new o.bT(g,t.u_translation),u_ratio:new o.bf(g,t.u_ratio),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_units_to_pixels:new o.bT(g,t.u_units_to_pixels)}),lineGradient:(g,t)=>({u_translation:new o.bT(g,t.u_translation),u_ratio:new o.bf(g,t.u_ratio),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_units_to_pixels:new o.bT(g,t.u_units_to_pixels),u_image:new o.bO(g,t.u_image),u_image_height:new o.bf(g,t.u_image_height)}),linePattern:(g,t)=>({u_translation:new o.bT(g,t.u_translation),u_texsize:new o.bT(g,t.u_texsize),u_ratio:new o.bf(g,t.u_ratio),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_image:new o.bO(g,t.u_image),u_units_to_pixels:new o.bT(g,t.u_units_to_pixels),u_scale:new o.bS(g,t.u_scale),u_fade:new o.bf(g,t.u_fade)}),lineSDF:(g,t)=>({u_translation:new o.bT(g,t.u_translation),u_ratio:new o.bf(g,t.u_ratio),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_units_to_pixels:new o.bT(g,t.u_units_to_pixels),u_patternscale_a:new o.bT(g,t.u_patternscale_a),u_patternscale_b:new o.bT(g,t.u_patternscale_b),u_sdfgamma:new o.bf(g,t.u_sdfgamma),u_image:new o.bO(g,t.u_image),u_tex_y_a:new o.bf(g,t.u_tex_y_a),u_tex_y_b:new o.bf(g,t.u_tex_y_b),u_mix:new o.bf(g,t.u_mix)}),raster:(g,t)=>({u_tl_parent:new o.bT(g,t.u_tl_parent),u_scale_parent:new o.bf(g,t.u_scale_parent),u_buffer_scale:new o.bf(g,t.u_buffer_scale),u_fade_t:new o.bf(g,t.u_fade_t),u_opacity:new o.bf(g,t.u_opacity),u_image0:new o.bO(g,t.u_image0),u_image1:new o.bO(g,t.u_image1),u_brightness_low:new o.bf(g,t.u_brightness_low),u_brightness_high:new o.bf(g,t.u_brightness_high),u_saturation_factor:new o.bf(g,t.u_saturation_factor),u_contrast_factor:new o.bf(g,t.u_contrast_factor),u_spin_weights:new o.bS(g,t.u_spin_weights),u_coords_top:new o.bR(g,t.u_coords_top),u_coords_bottom:new o.bR(g,t.u_coords_bottom)}),symbolIcon:(g,t)=>({u_is_size_zoom_constant:new o.bO(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(g,t.u_is_size_feature_constant),u_size_t:new o.bf(g,t.u_size_t),u_size:new o.bf(g,t.u_size),u_camera_to_center_distance:new o.bf(g,t.u_camera_to_center_distance),u_pitch:new o.bf(g,t.u_pitch),u_rotate_symbol:new o.bO(g,t.u_rotate_symbol),u_aspect_ratio:new o.bf(g,t.u_aspect_ratio),u_fade_change:new o.bf(g,t.u_fade_change),u_label_plane_matrix:new o.bQ(g,t.u_label_plane_matrix),u_coord_matrix:new o.bQ(g,t.u_coord_matrix),u_is_text:new o.bO(g,t.u_is_text),u_pitch_with_map:new o.bO(g,t.u_pitch_with_map),u_is_along_line:new o.bO(g,t.u_is_along_line),u_is_variable_anchor:new o.bO(g,t.u_is_variable_anchor),u_texsize:new o.bT(g,t.u_texsize),u_texture:new o.bO(g,t.u_texture),u_translation:new o.bT(g,t.u_translation),u_pitched_scale:new o.bf(g,t.u_pitched_scale)}),symbolSDF:(g,t)=>({u_is_size_zoom_constant:new o.bO(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(g,t.u_is_size_feature_constant),u_size_t:new o.bf(g,t.u_size_t),u_size:new o.bf(g,t.u_size),u_camera_to_center_distance:new o.bf(g,t.u_camera_to_center_distance),u_pitch:new o.bf(g,t.u_pitch),u_rotate_symbol:new o.bO(g,t.u_rotate_symbol),u_aspect_ratio:new o.bf(g,t.u_aspect_ratio),u_fade_change:new o.bf(g,t.u_fade_change),u_label_plane_matrix:new o.bQ(g,t.u_label_plane_matrix),u_coord_matrix:new o.bQ(g,t.u_coord_matrix),u_is_text:new o.bO(g,t.u_is_text),u_pitch_with_map:new o.bO(g,t.u_pitch_with_map),u_is_along_line:new o.bO(g,t.u_is_along_line),u_is_variable_anchor:new o.bO(g,t.u_is_variable_anchor),u_texsize:new o.bT(g,t.u_texsize),u_texture:new o.bO(g,t.u_texture),u_gamma_scale:new o.bf(g,t.u_gamma_scale),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_is_halo:new o.bO(g,t.u_is_halo),u_translation:new o.bT(g,t.u_translation),u_pitched_scale:new o.bf(g,t.u_pitched_scale)}),symbolTextAndIcon:(g,t)=>({u_is_size_zoom_constant:new o.bO(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(g,t.u_is_size_feature_constant),u_size_t:new o.bf(g,t.u_size_t),u_size:new o.bf(g,t.u_size),u_camera_to_center_distance:new o.bf(g,t.u_camera_to_center_distance),u_pitch:new o.bf(g,t.u_pitch),u_rotate_symbol:new o.bO(g,t.u_rotate_symbol),u_aspect_ratio:new o.bf(g,t.u_aspect_ratio),u_fade_change:new o.bf(g,t.u_fade_change),u_label_plane_matrix:new o.bQ(g,t.u_label_plane_matrix),u_coord_matrix:new o.bQ(g,t.u_coord_matrix),u_is_text:new o.bO(g,t.u_is_text),u_pitch_with_map:new o.bO(g,t.u_pitch_with_map),u_is_along_line:new o.bO(g,t.u_is_along_line),u_is_variable_anchor:new o.bO(g,t.u_is_variable_anchor),u_texsize:new o.bT(g,t.u_texsize),u_texsize_icon:new o.bT(g,t.u_texsize_icon),u_texture:new o.bO(g,t.u_texture),u_texture_icon:new o.bO(g,t.u_texture_icon),u_gamma_scale:new o.bf(g,t.u_gamma_scale),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_is_halo:new o.bO(g,t.u_is_halo),u_translation:new o.bT(g,t.u_translation),u_pitched_scale:new o.bf(g,t.u_pitched_scale)}),background:(g,t)=>({u_opacity:new o.bf(g,t.u_opacity),u_color:new o.bP(g,t.u_color)}),backgroundPattern:(g,t)=>({u_opacity:new o.bf(g,t.u_opacity),u_image:new o.bO(g,t.u_image),u_pattern_tl_a:new o.bT(g,t.u_pattern_tl_a),u_pattern_br_a:new o.bT(g,t.u_pattern_br_a),u_pattern_tl_b:new o.bT(g,t.u_pattern_tl_b),u_pattern_br_b:new o.bT(g,t.u_pattern_br_b),u_texsize:new o.bT(g,t.u_texsize),u_mix:new o.bf(g,t.u_mix),u_pattern_size_a:new o.bT(g,t.u_pattern_size_a),u_pattern_size_b:new o.bT(g,t.u_pattern_size_b),u_scale_a:new o.bf(g,t.u_scale_a),u_scale_b:new o.bf(g,t.u_scale_b),u_pixel_coord_upper:new o.bT(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(g,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bf(g,t.u_tile_units_to_pixels)}),terrain:(g,t)=>({u_texture:new o.bO(g,t.u_texture),u_ele_delta:new o.bf(g,t.u_ele_delta),u_fog_matrix:new o.bQ(g,t.u_fog_matrix),u_fog_color:new o.bP(g,t.u_fog_color),u_fog_ground_blend:new o.bf(g,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bf(g,t.u_fog_ground_blend_opacity),u_horizon_color:new o.bP(g,t.u_horizon_color),u_horizon_fog_blend:new o.bf(g,t.u_horizon_fog_blend),u_is_globe_mode:new o.bf(g,t.u_is_globe_mode)}),terrainDepth:(g,t)=>({u_ele_delta:new o.bf(g,t.u_ele_delta)}),terrainCoords:(g,t)=>({u_texture:new o.bO(g,t.u_texture),u_terrain_coords_id:new o.bf(g,t.u_terrain_coords_id),u_ele_delta:new o.bf(g,t.u_ele_delta)}),projectionErrorMeasurement:(g,t)=>({u_input:new o.bf(g,t.u_input),u_output_expected:new o.bf(g,t.u_output_expected)}),atmosphere:(g,t)=>({u_sun_pos:new o.bS(g,t.u_sun_pos),u_atmosphere_blend:new o.bf(g,t.u_atmosphere_blend),u_globe_position:new o.bS(g,t.u_globe_position),u_globe_radius:new o.bf(g,t.u_globe_radius),u_inv_proj_matrix:new o.bQ(g,t.u_inv_proj_matrix)}),sky:(g,t)=>({u_sky_color:new o.bP(g,t.u_sky_color),u_horizon_color:new o.bP(g,t.u_horizon_color),u_horizon:new o.bT(g,t.u_horizon),u_horizon_normal:new o.bT(g,t.u_horizon_normal),u_sky_horizon_blend:new o.bf(g,t.u_sky_horizon_blend),u_sky_blend:new o.bf(g,t.u_sky_blend)})};class ou{constructor(t,r,c){this.context=t;const d=t.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const lu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class dh{constructor(t,r,c,d){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=d,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let c=0;c<this.attributes.length;c++){const d=r.attributes[this.attributes[c].name];d!==void 0&&t.enableVertexAttribArray(d)}}setVertexAttribPointers(t,r,c){for(let d=0;d<this.attributes.length;d++){const _=this.attributes[d],b=r.attributes[_.name];b!==void 0&&t.vertexAttribPointer(b,_.components,t[lu[_.type]],!1,this.itemSize,_.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ui{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bo extends ui{getDefault(){return o.be.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Bs extends ui{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class fh extends ui{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ph extends ui{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class mh extends ui{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class hu extends ui{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class gh extends ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Tn extends ui{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class _h extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class lf extends ui{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class hf extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class cf extends ui{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class uf extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class cu extends ui{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class df extends ui{getDefault(){return o.be.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class uu extends ui{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class No extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Go extends ui{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class jo extends ui{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class yh extends ui{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Pn extends ui{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ua extends ui{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Hn extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class rs extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class du extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class fu extends ui{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class vh extends ui{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class En extends ui{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const c=this.gl;Er(c)?c.bindVertexArray(t):(r=c.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Uo extends ui{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Vo extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Va extends ui{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Kn extends ui{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class pu extends Kn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Yn extends Kn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Jn extends Kn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const xh="Framebuffer is not complete";class bh{constructor(t,r,c,d,_){this.context=t,this.width=r,this.height=c;const b=t.gl,M=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new pu(t,M),d)this.depthAttachment=_?new Jn(t,M):new Yn(t,M);else if(_)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error(xh)}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class Ye{constructor(t){var r,c;if(this.gl=t,this.clearColor=new Bo(this),this.clearDepth=new Bs(this),this.clearStencil=new fh(this),this.colorMask=new ph(this),this.depthMask=new mh(this),this.stencilMask=new hu(this),this.stencilFunc=new gh(this),this.stencilOp=new Tn(this),this.stencilTest=new _h(this),this.depthRange=new lf(this),this.depthTest=new hf(this),this.depthFunc=new cf(this),this.blend=new uf(this),this.blendFunc=new cu(this),this.blendColor=new df(this),this.blendEquation=new uu(this),this.cullFace=new No(this),this.cullFaceSide=new Go(this),this.frontFace=new jo(this),this.program=new yh(this),this.activeTexture=new Pn(this),this.viewport=new Ua(this),this.bindFramebuffer=new Hn(this),this.bindRenderbuffer=new rs(this),this.bindTexture=new du(this),this.bindVertexBuffer=new fu(this),this.bindElementBuffer=new vh(this),this.bindVertexArray=new En(this),this.pixelStoreUnpack=new Uo(this),this.pixelStoreUnpackPremultiplyAlpha=new Vo(this),this.pixelStoreUnpackFlipY=new Va(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Er(t)){this.HALF_FLOAT=t.HALF_FLOAT;const d=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:d==null?void 0:d.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const d=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new ou(this,t,r)}createVertexBuffer(t,r,c){return new dh(this,t,r,c)}createRenderbuffer(t,r,c){const d=this.gl,_=d.createRenderbuffer();return this.bindRenderbuffer.set(_),d.renderbufferStorage(d.RENDERBUFFER,t,r,c),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,c,d){return new bh(this,t,r,c,d)}clear({color:t,depth:r,stencil:c}){const d=this.gl;let _=0;t&&(_|=d.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(_|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(_|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),d.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bG(t.blendFunction,si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Er(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return Er(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let In;function mu(g,t,r,c,d){const _=g.context,b=g.transform,M=_.gl,T=g.useProgram("collisionBox"),I=[];let R=0,F=0;for(let tt=0;tt<c.length;tt++){const st=c[tt],ht=t.getTile(st).getBucket(r);if(!ht)continue;const nt=d?ht.textCollisionBox:ht.iconCollisionBox,ut=ht.collisionCircleArray;ut.length>0&&(I.push({circleArray:ut,circleOffset:F,coord:st}),R+=ut.length/4,F=R),nt&&T.draw(_,M.LINES,Ue.disabled,Pe.disabled,g.colorModeForRenderPass(),Fe.disabled,Na(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(st),b.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,g.transform.zoom,null,null,nt.collisionVertexBuffer)}if(!d||!I.length)return;const O=g.useProgram("collisionCircle"),G=new o.b_;G.resize(4*R),G._trim();let q=0;for(const tt of I)for(let st=0;st<tt.circleArray.length/4;st++){const ht=4*st,nt=tt.circleArray[ht+0],ut=tt.circleArray[ht+1],mt=tt.circleArray[ht+2],ot=tt.circleArray[ht+3];G.emplace(q++,nt,ut,mt,ot,0),G.emplace(q++,nt,ut,mt,ot,1),G.emplace(q++,nt,ut,mt,ot,2),G.emplace(q++,nt,ut,mt,ot,3)}(!In||In.length<2*R)&&(In=function(tt){const st=2*tt,ht=new o.c0;ht.resize(st),ht._trim();for(let nt=0;nt<st;nt++){const ut=6*nt;ht.uint16[ut+0]=4*nt+0,ht.uint16[ut+1]=4*nt+1,ht.uint16[ut+2]=4*nt+2,ht.uint16[ut+3]=4*nt+2,ht.uint16[ut+4]=4*nt+3,ht.uint16[ut+5]=4*nt+0}return ht}(R));const Q=_.createIndexBuffer(In,!0),J=_.createVertexBuffer(G,o.b$.members,!0);for(const tt of I){const st=Ga(g.transform);O.draw(_,M.TRIANGLES,Ue.disabled,Pe.disabled,g.colorModeForRenderPass(),Fe.disabled,st,g.style.map.terrain&&g.style.map.terrain.getTerrainData(tt.coord),null,r.id,J,Q,o.aL.simpleSegment(0,2*tt.circleOffset,tt.circleArray.length,tt.circleArray.length/2),null,g.transform.zoom,null,null,null)}J.destroy(),Q.destroy()}const gu=o.af(new Float32Array(16));function $a(g,t,r,c,d,_){const{horizontalAlign:b,verticalAlign:M}=o.aG(g);return new o.P((-(b-.5)*t/d+c[0])*_,(-(M-.5)*r/d+c[1])*_)}function ff(g,t,r,c,d,_){const b=t.tileAnchorPoint.add(new o.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let M=c.mult(_);r||(M=M.rotate(-d));const T=b.add(M);return ti(T.x,T.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(r){const M=Yt(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(g),T=Math.atan(M.y/M.x)+(M.x<0?Math.PI:0);return g.add(c.rotate(T))}return g.add(c)}function pf(g,t,r,c,d,_,b,M,T,I,R,F){const O=g.text.placedSymbolArray,G=g.text.dynamicLayoutVertexArray,q=g.icon.dynamicLayoutVertexArray,Q={};G.clear();for(let J=0;J<O.length;J++){const tt=O.get(J),st=tt.hidden||!tt.crossTileID||g.allowVerticalPlacement&&!tt.placedOrientation?null:c[tt.crossTileID];if(st){const ht=new o.P(tt.anchorX,tt.anchorY),nt={getElevation:F,width:d.width,height:d.height,pitchedLabelPlaneMatrix:_,pitchWithMap:r,transform:d,tileAnchorPoint:ht,translation:I,unwrappedTileID:R},ut=r?Le(ht.x,ht.y,nt):Yt(ht.x,ht.y,nt),mt=be(d.cameraToCenterDistance,ut.signedDistanceFromCamera);let ot=o.ao(g.textSizeData,M,tt)*mt/o.aA;r&&(ot*=g.tilePixelRatio/b);const{width:xt,height:It,anchor:St,textOffset:Pt,textBoxScale:Ct}=st,te=$a(St,xt,It,Pt,Ct,ot),Jt=d.getPitchedTextCorrection(ht.x+I[0],ht.y+I[1],R),Vt=ff(ut.point,nt,t,te,-d.bearingInRadians,Jt),he=g.allowVerticalPlacement&&tt.placedOrientation===o.an.vertical?Math.PI/2:0;for(let Ve=0;Ve<tt.numGlyphs;Ve++)o.au(G,Vt,he);T&&tt.associatedIconIndex>=0&&(Q[tt.associatedIconIndex]={shiftedAnchor:Vt,angle:he})}else zs(tt.numGlyphs,G)}if(T){q.clear();const J=g.icon.placedSymbolArray;for(let tt=0;tt<J.length;tt++){const st=J.get(tt);if(st.hidden)zs(st.numGlyphs,q);else{const ht=Q[tt];if(ht)for(let nt=0;nt<st.numGlyphs;nt++)o.au(q,ht.shiftedAnchor,ht.angle);else zs(st.numGlyphs,q)}}g.icon.dynamicLayoutVertexBuffer.updateData(q)}g.text.dynamicLayoutVertexBuffer.updateData(G)}function _u(g,t,r){return r.iconsInText&&t?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function yu(g,t,r,c,d,_,b,M,T,I,R,F,O){const G=g.context,q=G.gl,Q=g.transform,J=M==="map",tt=T==="map",st=M!=="viewport"&&r.layout.get("symbol-placement")!=="point",ht=J&&!tt&&!st,nt=!r.layout.get("symbol-sort-key").isConstant();let ut=!1;const mt=g.getDepthModeForSublayer(0,Ue.ReadOnly),ot=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),xt=[],It=Q.getCircleRadiusCorrection();for(const St of c){const Pt=t.getTile(St),Ct=Pt.getBucket(r);if(!Ct)continue;const te=d?Ct.text:Ct.icon;if(!te||!te.segments.get().length||!te.hasVisibleVertices)continue;const Jt=te.programConfigurations.get(r.id),Vt=d||Ct.sdfIcons,he=d?Ct.textSizeData:Ct.iconSizeData,Ve=tt||Q.pitch!==0,di=g.useProgram(_u(Vt,d,Ct),Jt),Oi=o.am(he,Q.zoom),mi=g.style.map.terrain&&g.style.map.terrain.getTerrainData(St);let Fi,yi,gi,vi,fr=[0,0],ai=null;if(d)yi=Pt.glyphAtlasTexture,gi=q.LINEAR,Fi=Pt.glyphAtlasTexture.size,Ct.iconsInText&&(fr=Pt.imageAtlasTexture.size,ai=Pt.imageAtlasTexture,vi=Ve||g.options.rotating||g.options.zooming||he.kind==="composite"||he.kind==="camera"?q.LINEAR:q.NEAREST);else{const $i=r.layout.get("icon-size").constantOr(0)!==1||Ct.iconsNeedLinear;yi=Pt.imageAtlasTexture,gi=Vt||g.options.rotating||g.options.zooming||$i||Ve?q.LINEAR:q.NEAREST,Fi=Pt.imageAtlasTexture.size}const ar=o.aB(Pt,1,g.transform.zoom),pr=Te(J,g.transform,ar),rn=o.L();o.ap(rn,pr);const sn=fi(tt,J,g.transform,ar),nn=o.aC(Q,Pt,_,b),Ps=Q.getProjectionData({overscaledTileID:St,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),so=ot&&Ct.hasTextData(),no=r.layout.get("icon-text-fit")!=="none"&&so&&Ct.hasIconData();if(st){const $i=g.style.map.terrain?(Rr,Qi)=>g.style.map.terrain.getElevation(St,Rr,Qi):null,Pi=r.layout.get("text-rotation-alignment")==="map";qi(Ct,g,d,pr,rn,tt,I,Pi,St.toUnwrapped(),Q.width,Q.height,nn,$i)}const ca=d&&ot||no,Ur=st||ca?gu:tt?pr:g.transform.clipSpaceToPixelsMatrix,fs=Vt&&r.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let an;an=Vt?Ct.iconsInText?af(he.kind,Oi,ht,tt,st,ca,g,Ur,sn,nn,Fi,fr,It):Xn(he.kind,Oi,ht,tt,st,ca,g,Ur,sn,nn,d,Fi,0,It):uh(he.kind,Oi,ht,tt,st,ca,g,Ur,sn,nn,d,Fi,It);const Rn={program:di,buffers:te,uniformValues:an,projectionData:Ps,atlasTexture:yi,atlasTextureIcon:ai,atlasInterpolation:gi,atlasInterpolationIcon:vi,isSDF:Vt,hasHalo:fs};if(nt&&Ct.canOverlap){ut=!0;const $i=te.segments.get();for(const Pi of $i)xt.push({segments:new o.aL([Pi]),sortKey:Pi.sortKey,state:Rn,terrainData:mi})}else xt.push({segments:te.segments,sortKey:0,state:Rn,terrainData:mi})}ut&&xt.sort((St,Pt)=>St.sortKey-Pt.sortKey);for(const St of xt){const Pt=St.state;if(G.activeTexture.set(q.TEXTURE0),Pt.atlasTexture.bind(Pt.atlasInterpolation,q.CLAMP_TO_EDGE),Pt.atlasTextureIcon&&(G.activeTexture.set(q.TEXTURE1),Pt.atlasTextureIcon&&Pt.atlasTextureIcon.bind(Pt.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),Pt.isSDF){const Ct=Pt.uniformValues;Pt.hasHalo&&(Ct.u_is_halo=1,$o(Pt.buffers,St.segments,r,g,Pt.program,mt,R,F,Ct,Pt.projectionData,St.terrainData)),Ct.u_is_halo=0}$o(Pt.buffers,St.segments,r,g,Pt.program,mt,R,F,Pt.uniformValues,Pt.projectionData,St.terrainData)}}function $o(g,t,r,c,d,_,b,M,T,I,R){const F=c.context;d.draw(F,F.gl.TRIANGLES,_,b,M,Fe.backCCW,T,R,I,r.id,g.layoutVertexBuffer,g.indexBuffer,t,r.paint,c.transform.zoom,g.programConfigurations.get(r.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function qo(g,t,r,c,d){const _=g.context,b=_.gl,M=Pe.disabled,T=new si([b.ONE,b.ONE],o.be.transparent,[!0,!0,!0,!0]),I=t.getBucket(r);if(!I)return;const R=c.key;let F=r.heatmapFbos.get(R);F||(F=qa(_,t.tileSize,t.tileSize),r.heatmapFbos.set(R,F)),_.bindFramebuffer.set(F.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:o.be.transparent});const O=I.programConfigurations.get(r.id),G=g.useProgram("heatmap",O,!d),q=g.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Q=g.style.map.terrain.getTerrainData(c);G.draw(_,b.TRIANGLES,Ue.disabled,M,T,Fe.disabled,ja(t,g.transform.zoom,r.paint.get("heatmap-intensity"),1),Q,q,r.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,r.paint,g.transform.zoom,O)}function Zo(g,t,r,c,d){const _=g.context,b=_.gl,M=g.transform;_.setColorMode(g.colorModeForRenderPass());const T=Wo(_,t),I=r.key,R=t.heatmapFbos.get(I);if(!R)return;_.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,R.colorAttachment.get()),_.activeTexture.set(b.TEXTURE1),T.bind(b.LINEAR,b.CLAMP_TO_EDGE);const F=M.getProjectionData({overscaledTileID:r,applyTerrainMatrix:d,applyGlobeMatrix:!c});g.useProgram("heatmapTexture").draw(_,b.TRIANGLES,Ue.disabled,Pe.disabled,g.colorModeForRenderPass(),Fe.disabled,tu(g,t,0,1),null,F,t.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,t.paint,M.zoom),R.destroy(),t.heatmapFbos.delete(I)}function qa(g,t,r){var c,d;const _=g.gl,b=_.createTexture();_.bindTexture(_.TEXTURE_2D,b),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const M=(c=g.HALF_FLOAT)!==null&&c!==void 0?c:_.UNSIGNED_BYTE,T=(d=g.RGBA16F)!==null&&d!==void 0?d:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,T,t,r,0,_.RGBA,M,null);const I=g.createFramebuffer(t,r,!1,!1);return I.colorAttachment.set(b),I}function Wo(g,t){return t.colorRampTexture||(t.colorRampTexture=new o.T(g,t.colorRamp,g.gl.RGBA)),t.colorRampTexture}function wh(g,t,r,c,d){if(!r||!c||!c.imageAtlas)return;const _=c.imageAtlas.patternPositions;let b=_[r.to.toString()],M=_[r.from.toString()];if(!b&&M&&(b=M),!M&&b&&(M=b),!b||!M){const T=d.getPaintProperty(t);b=_[T],M=_[T]}b&&M&&g.setConstantPatternPositions(b,M)}function Za(g,t,r,c,d,_,b,M){const T=g.context.gl,I="fill-pattern",R=r.paint.get(I),F=R&&R.constantOr(1),O=r.getCrossfadeParameters();let G,q,Q,J,tt;const st=g.transform,ht=r.paint.get("fill-translate"),nt=r.paint.get("fill-translate-anchor");b?(q=F&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=T.LINES):(q=F?"fillPattern":"fill",G=T.TRIANGLES);const ut=R.constantOr(null);for(const mt of c){const ot=t.getTile(mt);if(F&&!ot.patternsLoaded())continue;const xt=ot.getBucket(r);if(!xt)continue;const It=xt.programConfigurations.get(r.id),St=g.useProgram(q,It),Pt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(mt);F&&(g.context.activeTexture.set(T.TEXTURE0),ot.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),It.updatePaintBuffers(O)),wh(It,I,ut,ot,r);const Ct=st.getProjectionData({overscaledTileID:mt,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),te=o.aC(st,ot,ht,nt);if(b){J=xt.indexBuffer2,tt=xt.segments2;const Vt=[T.drawingBufferWidth,T.drawingBufferHeight];Q=q==="fillOutlinePattern"&&F?rf(g,O,ot,Vt,te):Ms(Vt,te)}else J=xt.indexBuffer,tt=xt.segments,Q=F?Lo(g,O,ot,te):{u_fill_translate:te};const Jt=g.stencilModeForClipping(mt);St.draw(g.context,G,d,Jt,_,Fe.backCCW,Q,Pt,Ct,r.id,xt.layoutVertexBuffer,J,tt,r.paint,g.transform.zoom,It)}}function Qn(g,t,r,c,d,_,b,M){const T=g.context,I=T.gl,R="fill-extrusion-pattern",F=r.paint.get(R),O=F.constantOr(1),G=r.getCrossfadeParameters(),q=r.paint.get("fill-extrusion-opacity"),Q=F.constantOr(null),J=g.transform;for(const tt of c){const st=t.getTile(tt),ht=st.getBucket(r);if(!ht)continue;const nt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(tt),ut=ht.programConfigurations.get(r.id),mt=g.useProgram(O?"fillExtrusionPattern":"fillExtrusion",ut);O&&(g.context.activeTexture.set(I.TEXTURE0),st.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ut.updatePaintBuffers(G));const ot=J.getProjectionData({overscaledTileID:tt,applyGlobeMatrix:!M,applyTerrainMatrix:!0});wh(ut,R,Q,st,r);const xt=o.aC(J,st,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),It=r.paint.get("fill-extrusion-vertical-gradient"),St=O?ah(g,It,q,xt,tt,G,st):Ba(g,It,q,xt);mt.draw(T,T.gl.TRIANGLES,d,_,b,Fe.backCCW,St,nt,ot,r.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,r.paint,g.transform.zoom,ut,g.style.map.terrain&&ht.centroidVertexBuffer)}}function ta(g,t,r,c,d,_,b,M,T){var I;const R=g.style.projection,F=g.context,O=g.transform,G=F.gl,q=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],Q=g.useProgram("hillshade",null,!1,q),J=!g.options.moving;for(const tt of c){const st=t.getTile(tt),ht=st.fbo;if(!ht)continue;const nt=R.getMeshFromTileID(F,tt.canonical,M,!0,"raster"),ut=(I=g.style.map.terrain)===null||I===void 0?void 0:I.getTerrainData(tt);F.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,ht.colorAttachment.get());const mt=O.getProjectionData({overscaledTileID:tt,aligned:J,applyGlobeMatrix:!T,applyTerrainMatrix:!0});Q.draw(F,G.TRIANGLES,_,d[tt.overscaledZ],b,Fe.backCCW,Wn(g,st,r),ut,mt,r.id,nt.vertexBuffer,nt.indexBuffer,nt.segments)}}function Wa(g,t,r,c,d,_,b,M,T){var I;const R=g.style.projection,F=g.context,O=g.transform,G=F.gl,q=g.useProgram("colorRelief"),Q=!g.options.moving;let J=!0;for(const tt of c){const st=t.getTile(tt),ht=st.dem;if(J){const It=G.getParameter(G.MAX_TEXTURE_SIZE),{elevationTexture:St,colorTexture:Pt}=r.getColorRampTextures(F,It,ht.getUnpackVector());F.activeTexture.set(G.TEXTURE1),St.bind(G.NEAREST,G.CLAMP_TO_EDGE),F.activeTexture.set(G.TEXTURE4),Pt.bind(G.LINEAR,G.CLAMP_TO_EDGE),J=!1}if(!ht||!ht.data)continue;const nt=ht.stride,ut=ht.getPixels();if(F.activeTexture.set(G.TEXTURE0),F.pixelStoreUnpackPremultiplyAlpha.set(!1),st.demTexture=st.demTexture||g.getTileTexture(nt),st.demTexture){const It=st.demTexture;It.update(ut,{premultiply:!1}),It.bind(G.LINEAR,G.CLAMP_TO_EDGE)}else st.demTexture=new o.T(F,ut,G.RGBA,{premultiply:!1}),st.demTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const mt=R.getMeshFromTileID(F,tt.canonical,M,!0,"raster"),ot=(I=g.style.map.terrain)===null||I===void 0?void 0:I.getTerrainData(tt),xt=O.getProjectionData({overscaledTileID:tt,aligned:Q,applyGlobeMatrix:!T,applyTerrainMatrix:!0});q.draw(F,G.TRIANGLES,_,d[tt.overscaledZ],b,Fe.backCCW,nf(r,st.dem),ot,xt,r.id,mt.vertexBuffer,mt.indexBuffer,mt.segments)}}const Mh=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function Ys(g,t,r,c,d,_,b,M,T=!1,I=!1){const R=c[c.length-1].overscaledZ,F=g.context,O=F.gl,G=g.useProgram("raster"),q=g.transform,Q=g.style.projection,J=g.colorModeForRenderPass(),tt=!g.options.moving;for(const st of c){const ht=g.getDepthModeForSublayer(st.overscaledZ-R,r.paint.get("raster-opacity")===1?Ue.ReadWrite:Ue.ReadOnly,O.LESS),nt=t.getTile(st);nt.registerFadeDuration(r.paint.get("raster-fade-duration"));const ut=t.findLoadedParent(st,0),mt=t.findLoadedSibling(st),ot=mf(nt,ut||mt||null,t,r,g.transform,g.style.map.terrain);let xt,It;const St=r.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;F.activeTexture.set(O.TEXTURE0),nt.texture.bind(St,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(O.TEXTURE1),ut?(ut.texture.bind(St,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),xt=Math.pow(2,ut.tileID.overscaledZ-nt.tileID.overscaledZ),It=[nt.tileID.canonical.x*xt%1,nt.tileID.canonical.y*xt%1]):nt.texture.bind(St,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),nt.texture.useMipmap&&F.extTextureFilterAnisotropic&&g.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const Pt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(st),Ct=q.getProjectionData({overscaledTileID:st,aligned:tt,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),te=Sn(It||[0,0],xt||1,ot,r,M),Jt=Q.getMeshFromTileID(F,st.canonical,_,b,"raster");G.draw(F,O.TRIANGLES,ht,d?d[st.overscaledZ]:Pe.disabled,J,T?Fe.frontCCW:Fe.backCCW,te,Pt,Ct,r.id,Jt.vertexBuffer,Jt.indexBuffer,Jt.segments)}}function mf(g,t,r,c,d,_){const b=c.paint.get("raster-fade-duration");if(!_&&b>0){const M=D.now(),T=(M-g.timeAdded)/b,I=t?(M-t.timeAdded)/b:-1,R=r.getSource(),F=zt(d,{tileSize:R.tileSize,roundZoom:R.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-F)>Math.abs(g.tileID.overscaledZ-F),G=O&&g.refreshedUponExpiration?1:o.ag(O?T:1-I,0,1);return g.refreshedUponExpiration&&T>=1&&(g.refreshedUponExpiration=!1),t?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const vu=new o.be(1,0,0,1),Xo=new o.be(0,1,0,1),Sh=new o.be(0,0,1,1),xu=new o.be(1,0,1,1),bu=new o.be(0,1,1,1);function Xa(g,t,r,c){Ko(g,0,t+r/2,g.transform.width,r,c)}function Ho(g,t,r,c){Ko(g,t-r/2,0,r,g.transform.height,c)}function Ko(g,t,r,c,d,_){const b=g.context,M=b.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*g.pixelRatio,r*g.pixelRatio,c*g.pixelRatio,d*g.pixelRatio),b.clear({color:_}),M.disable(M.SCISSOR_TEST)}function wu(g,t,r){const c=g.context,d=c.gl,_=g.useProgram("debug"),b=Ue.disabled,M=Pe.disabled,T=g.colorModeForRenderPass(),I="$debug",R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(r);c.activeTexture.set(d.TEXTURE0);const F=t.getTileByID(r.key).latestRawTileData,O=Math.floor((F&&F.byteLength||0)/1024),G=t.getTile(r).tileSize,q=512/Math.min(G,512)*(r.overscaledZ/g.transform.zoom)*.5;let Q=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Q+=` => ${r.overscaledZ}`),function(tt,st){tt.initDebugOverlayCanvas();const ht=tt.debugOverlayCanvas,nt=tt.context.gl,ut=tt.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,ht.width,ht.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText(st,5,5),ut.strokeText(st,5,5),tt.debugOverlayTexture.update(ht),tt.debugOverlayTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE)}(g,`${Q} ${O}kB`);const J=g.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(c,d.TRIANGLES,b,M,si.alphaBlended,Fe.disabled,Qc(o.be.transparent,q),null,J,I,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),_.draw(c,d.LINE_STRIP,b,M,T,Fe.disabled,Qc(o.be.red),R,J,I,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Ni(g,t,r,c){const{isRenderingGlobe:d}=c,_=g.context,b=_.gl,M=g.transform,T=g.colorModeForRenderPass(),I=g.getDepthModeFor3D(),R=g.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,g.width,g.height]);for(const F of r){const O=t.getTerrainMesh(F.tileID),G=g.renderToTexture.getTexture(F),q=t.getTerrainData(F.tileID);_.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,G.texture);const Q=t.getMeshFrameDelta(M.zoom),J=M.calculateFogMatrix(F.tileID.toUnwrapped()),tt=tf(Q,J,g.style.sky,M.pitch,d),st=M.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});R.draw(_,b.TRIANGLES,I,Pe.disabled,T,Fe.backCCW,tt,q,st,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}function Js(g,t){if(!t.mesh){const r=new o.aK;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const c=new o.aM;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),t.mesh=new Ls(g.createVertexBuffer(r,Os.members),g.createIndexBuffer(c),o.aL.simpleSegment(0,0,r.length,c.length))}return t.mesh}class ss{constructor(t,r){this.context=new Ye(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Bt.maxUnderzooming+Bt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Io}resize(t,r,c){if(this.width=Math.floor(t*c),this.height=Math.floor(r*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const t=this.context,r=new o.aK;r.emplaceBack(0,0),r.emplaceBack(o.$,0),r.emplaceBack(0,o.$),r.emplaceBack(o.$,o.$),this.tileExtentBuffer=t.createVertexBuffer(r,Os.members),this.tileExtentSegments=o.aL.simpleSegment(0,0,4,2);const c=new o.aK;c.emplaceBack(0,0),c.emplaceBack(o.$,0),c.emplaceBack(0,o.$),c.emplaceBack(o.$,o.$),this.debugBuffer=t.createVertexBuffer(c,Os.members),this.debugSegments=o.aL.simpleSegment(0,0,4,5);const d=new o.c5;d.emplaceBack(0,0,0,0),d.emplaceBack(o.$,0,o.$,0),d.emplaceBack(0,o.$,0,o.$),d.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=t.createVertexBuffer(d,Jd.members),this.rasterBoundsSegments=o.aL.simpleSegment(0,0,4,2);const _=new o.aK;_.emplaceBack(0,0),_.emplaceBack(o.$,0),_.emplaceBack(0,o.$),_.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,Os.members),this.rasterBoundsSegmentsPosOnly=o.aL.simpleSegment(0,0,4,5);const b=new o.aK;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,Os.members),this.viewportSegments=o.aL.simpleSegment(0,0,4,2);const M=new o.c6;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(M);const T=new o.aM;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const I=this.context.gl;this.stencilClearMode=new Pe({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.tileExtentMesh=new Ls(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=o.L();o.bX(c,0,this.width,this.height,0,0,1),o.N(c,c,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const d={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(t,r.TRIANGLES,Ue.disabled,this.stencilClearMode,si.disabled,Fe.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r,c){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source,this.nextStencilID+r.length>256&&this.clearStencil();const d=this.context;d.setColorMode(si.disabled),d.setDepthMode(Ue.disabled);const _={};for(const b of r)_[b.key]=this.nextStencilID++;this._renderTileMasks(_,r,c,!0),this._renderTileMasks(_,r,c,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,r,c,d){const _=this.context,b=_.gl,M=this.style.projection,T=this.transform,I=this.useProgram("clippingMask");for(const R of r){const F=t[R.key],O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),G=M.getMeshFromTileID(this.context,R.canonical,d,!0,"stencil"),q=T.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!c,applyTerrainMatrix:!0});I.draw(_,b.TRIANGLES,Ue.disabled,new Pe({func:b.ALWAYS,mask:0},F,255,b.KEEP,b.KEEP,b.REPLACE),si.disabled,c?Fe.disabled:Fe.backCCW,null,O,q,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}_renderTilesDepthBuffer(){const t=this.context,r=t.gl,c=this.style.projection,d=this.transform,_=this.useProgram("depth"),b=this.getDepthModeFor3D(),M=At(d,{tileSize:d.tileSize});for(const T of M){const I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),R=c.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),F=d.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,r.TRIANGLES,b,Pe.disabled,si.disabled,Fe.backCCW,null,I,F,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Pe({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new Pe({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const r=this.context.gl,c=t.sort((b,M)=>M.overscaledZ-b.overscaledZ),d=c[c.length-1].overscaledZ,_=c[0].overscaledZ-d+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const b={};for(let M=0;M<_;M++)b[M+d]=new Pe({func:r.GEQUAL,mask:255},M+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[b,c]}return[{[d]:Pe.disabled},c]}stencilConfigForOverlapTwoPass(t){const r=this.context.gl,c=t.sort((b,M)=>M.overscaledZ-b.overscaledZ),d=c[c.length-1].overscaledZ,_=c[0].overscaledZ-d+1;if(this.clearStencil(),_>1){const b={},M={};for(let T=0;T<_;T++)b[T+d]=new Pe({func:r.GREATER,mask:255},_+1+T,255,r.KEEP,r.KEEP,r.REPLACE),M[T+d]=new Pe({func:r.GREATER,mask:255},1+T,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*_+1,[b,M,c]}return this.nextStencilID=3,[{[d]:new Pe({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[d]:new Pe({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new si([t.CONSTANT_COLOR,t.ONE],new o.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?si.unblended:si.alphaBlended}getDepthModeForSublayer(t,r,c){if(!this.opaquePassEnabledForLayer())return Ue.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ue(c||this.context.gl.LEQUAL,r,[d,d])}getDepthModeFor3D(){return new Ue(this.context.gl.LEQUAL,Ue.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){var c,d;this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(D.now()),this.imageManager.beginFrame();const _=this.style._order,b=this.style.sourceCaches,M={},T={},I={},R={isRenderingToTexture:!1,isRenderingGlobe:((c=t.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const O in b){const G=b[O];G.used&&G.prepare(this.context),M[O]=G.getVisibleCoordinates(!1),T[O]=M[O].slice().reverse(),I[O]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<_.length;O++)if(this.style._layers[_[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const O of _){const G=this.style._layers[O];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const q=T[G.source];(G.type==="custom"||q.length)&&this.renderLayer(this,b[G.source],G,q,R)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:O=>this.useProgram(O)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?o.be.black:o.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(O,G){const q=O.context,Q=q.gl,J=((mt,ot,xt)=>{const It=Math.cos(ot.rollInRadians),St=Math.sin(ot.rollInRadians),Pt=X(ot),Ct=ot.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:mt.properties.get("sky-color"),u_horizon_color:mt.properties.get("horizon-color"),u_horizon:[(ot.width/2-Pt*St)*xt,(ot.height/2+Pt*It)*xt],u_horizon_normal:[-St,It],u_sky_horizon_blend:mt.properties.get("sky-horizon-blend")*ot.height/2*xt,u_sky_blend:Ct}})(G,O.style.map.transform,O.pixelRatio),tt=new Ue(Q.LEQUAL,Ue.ReadWrite,[0,1]),st=Pe.disabled,ht=O.colorModeForRenderPass(),nt=O.useProgram("sky"),ut=Js(q,G);nt.draw(q,Q.TRIANGLES,tt,st,ht,Fe.disabled,J,null,void 0,"sky",ut.vertexBuffer,ut.indexBuffer,ut.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[_[this.currentLayer]],G=b[O.source],q=M[O.source];this._renderTileClippingMasks(O,q,!1),this.renderLayer(this,G,O,q,R)}this.renderPass="translucent";let F=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const O=this.style._layers[_[this.currentLayer]],G=b[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O,R))continue;this.opaquePassEnabledForLayer()||F||(F=!0,R.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const q=(O.type==="symbol"?I:T)[O.source];this._renderTileClippingMasks(O,M[O.source],!!this.renderToTexture),this.renderLayer(this,G,O,q,R)}if(R.isRenderingGlobe&&function(O,G,q){const Q=O.context,J=Q.gl,tt=O.useProgram("atmosphere"),st=new Ue(J.LEQUAL,Ue.ReadOnly,[0,1]),ht=O.transform,nt=function(Ct,te){const Jt=Ct.properties.get("position"),Vt=[-Jt.x,-Jt.y,-Jt.z],he=o.af(new Float64Array(16));return Ct.properties.get("anchor")==="map"&&(o.b5(he,he,te.rollInRadians),o.b6(he,he,-te.pitchInRadians),o.b5(he,he,te.bearingInRadians),o.b6(he,he,te.center.lat*Math.PI/180),o.by(he,he,-te.center.lng*Math.PI/180)),o.c4(Vt,Vt,he),Vt}(q,O.transform),ut=ht.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),mt=G.properties.get("atmosphere-blend")*ut.projectionTransition;if(mt===0)return;const ot=jn(ht.worldSize,ht.center.lat),xt=ht.inverseProjectionMatrix,It=new Float64Array(4);It[3]=1,o.av(It,It,ht.modelViewProjectionMatrix),It[0]/=It[3],It[1]/=It[3],It[2]/=It[3],It[3]=1,o.av(It,It,xt),It[0]/=It[3],It[1]/=It[3],It[2]/=It[3],It[3]=1;const St=((Ct,te,Jt,Vt,he)=>({u_sun_pos:Ct,u_atmosphere_blend:te,u_globe_position:Jt,u_globe_radius:Vt,u_inv_proj_matrix:he}))(nt,mt,[It[0],It[1],It[2]],ot,xt),Pt=Js(Q,G);tt.draw(Q,J.TRIANGLES,st,Pe.disabled,si.alphaBlended,Fe.disabled,St,null,null,"atmosphere",Pt.vertexBuffer,Pt.indexBuffer,Pt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const O=function(G,q){let Q=null;const J=Object.values(G._layers).flatMap(nt=>nt.source&&!nt.isHidden(q)?[G.sourceCaches[nt.source]]:[]),tt=J.filter(nt=>nt.getSource().type==="vector"),st=J.filter(nt=>nt.getSource().type!=="vector"),ht=nt=>{(!Q||Q.getSource().maxzoom<nt.getSource().maxzoom)&&(Q=nt)};return tt.forEach(nt=>ht(nt)),Q||st.forEach(nt=>ht(nt)),Q}(this.style,this.transform.zoom);O&&function(G,q,Q){for(let J=0;J<Q.length;J++)wu(G,q,Q[J])}(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const G=O.transform.padding;Xa(O,O.transform.height-(G.top||0),3,vu),Xa(O,G.bottom||0,3,Xo),Ho(O,G.left||0,3,Sh),Ho(O,O.transform.width-(G.right||0),3,xu);const q=O.transform.centerPoint;(function(Q,J,tt,st){Ko(Q,J-1,tt-10,2,20,st),Ko(Q,J-10,tt-1,20,2,st)})(O,q.x,O.transform.height-q.y,bu)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=t?!o.c7(r,c):!o.c8(r,c)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(o.c9(r,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,b){const M=_.context,T=M.gl,I=_.transform,R=si.unblended,F=new Ue(T.LEQUAL,Ue.ReadWrite,[0,1]),O=b.sourceCache.getRenderableTiles(),G=_.useProgram("terrainDepth");M.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),M.clear({color:o.be.transparent,depth:1});for(const q of O){const Q=b.getTerrainMesh(q.tileID),J=b.getTerrainData(q.tileID),tt=I.getProjectionData({overscaledTileID:q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),st={u_ele_delta:b.getMeshFrameDelta(I.zoom)};G.draw(M,T.TRIANGLES,F,Pe.disabled,R,Fe.backCCW,st,J,tt,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,b){const M=_.context,T=M.gl,I=_.transform,R=si.unblended,F=new Ue(T.LEQUAL,Ue.ReadWrite,[0,1]),O=b.getCoordsTexture(),G=b.sourceCache.getRenderableTiles(),q=_.useProgram("terrainCoords");M.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),M.clear({color:o.be.transparent,depth:1}),b.coordsIndex=[];for(const Q of G){const J=b.getTerrainMesh(Q.tileID),tt=b.getTerrainData(Q.tileID);M.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,O.texture);const st={u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(I.zoom)},ht=I.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});q.draw(M,T.TRIANGLES,F,Pe.disabled,R,Fe.backCCW,st,tt,ht,"terrain",J.vertexBuffer,J.indexBuffer,J.segments),b.coordsIndex.push(Q.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(t,r,c,d,_){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(d||[]).length)&&(this.id=c.id,o.ca(c)?function(b,M,T,I,R,F){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:O}=F,G=Pe.disabled,q=b.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Q,J,tt,st,ht,nt,ut,mt,ot){const xt=J.transform,It=J.style.map.terrain,St=ht==="map",Pt=nt==="map";for(const Ct of Q){const te=st.getTile(Ct),Jt=te.getBucket(tt);if(!Jt||!Jt.text||!Jt.text.segments.get().length)continue;const Vt=o.am(Jt.textSizeData,xt.zoom),he=o.aB(te,1,J.transform.zoom),Ve=Te(St,J.transform,he),di=tt.layout.get("icon-text-fit")!=="none"&&Jt.hasIconData();if(Vt){const Oi=Math.pow(2,xt.zoom-te.tileID.overscaledZ),mi=It?(Fi,yi)=>It.getElevation(Ct,Fi,yi):null;pf(Jt,St,Pt,ot,xt,Ve,Oi,Vt,di,o.aC(xt,te,ut,mt),Ct.toUnwrapped(),mi)}}}(I,b,T,M,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),R),T.paint.get("icon-opacity").constantOr(1)!==0&&yu(b,M,T,I,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),G,q,O),T.paint.get("text-opacity").constantOr(1)!==0&&yu(b,M,T,I,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),G,q,O),M.map.showCollisionBoxes&&(mu(b,M,T,I,!0),mu(b,M,T,I,!1))}(t,r,c,d,this.style.placement.variableOffsets,_):o.cb(c)?function(b,M,T,I,R){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:F}=R,O=T.paint.get("circle-opacity"),G=T.paint.get("circle-stroke-width"),q=T.paint.get("circle-stroke-opacity"),Q=!T.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&(G.constantOr(1)===0||q.constantOr(1)===0))return;const J=b.context,tt=J.gl,st=b.transform,ht=b.getDepthModeForSublayer(0,Ue.ReadOnly),nt=Pe.disabled,ut=b.colorModeForRenderPass(),mt=[],ot=st.getCircleRadiusCorrection();for(let xt=0;xt<I.length;xt++){const It=I[xt],St=M.getTile(It),Pt=St.getBucket(T);if(!Pt)continue;const Ct=T.paint.get("circle-translate"),te=T.paint.get("circle-translate-anchor"),Jt=o.aC(st,St,Ct,te),Vt=Pt.programConfigurations.get(T.id),he=b.useProgram("circle",Vt),Ve=Pt.layoutVertexBuffer,di=Pt.indexBuffer,Oi=b.style.map.terrain&&b.style.map.terrain.getTerrainData(It),mi={programConfiguration:Vt,program:he,layoutVertexBuffer:Ve,indexBuffer:di,uniformValues:oh(b,St,T,Jt,ot),terrainData:Oi,projectionData:st.getProjectionData({overscaledTileID:It,applyGlobeMatrix:!F,applyTerrainMatrix:!0})};if(Q){const Fi=Pt.segments.get();for(const yi of Fi)mt.push({segments:new o.aL([yi]),sortKey:yi.sortKey,state:mi})}else mt.push({segments:Pt.segments,sortKey:0,state:mi})}Q&&mt.sort((xt,It)=>xt.sortKey-It.sortKey);for(const xt of mt){const{programConfiguration:It,program:St,layoutVertexBuffer:Pt,indexBuffer:Ct,uniformValues:te,terrainData:Jt,projectionData:Vt}=xt.state;St.draw(J,tt.TRIANGLES,ht,nt,ut,Fe.backCCW,te,Jt,Vt,T.id,Pt,Ct,xt.segments,T.paint,b.transform.zoom,It)}}(t,r,c,d,_):o.cc(c)?function(b,M,T,I,R){if(T.paint.get("heatmap-opacity")===0)return;const F=b.context,{isRenderingToTexture:O,isRenderingGlobe:G}=R;if(b.style.map.terrain){for(const q of I){const Q=M.getTile(q);M.hasRenderableParent(q)||(b.renderPass==="offscreen"?qo(b,Q,T,q,G):b.renderPass==="translucent"&&Zo(b,T,q,O,G))}F.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(q,Q,J,tt){const st=q.context,ht=st.gl,nt=q.transform,ut=Pe.disabled,mt=new si([ht.ONE,ht.ONE],o.be.transparent,[!0,!0,!0,!0]);(function(ot,xt,It){const St=ot.gl;ot.activeTexture.set(St.TEXTURE1),ot.viewport.set([0,0,xt.width/4,xt.height/4]);let Pt=It.heatmapFbos.get(o.c1);Pt?(St.bindTexture(St.TEXTURE_2D,Pt.colorAttachment.get()),ot.bindFramebuffer.set(Pt.framebuffer)):(Pt=qa(ot,xt.width/4,xt.height/4),It.heatmapFbos.set(o.c1,Pt))})(st,q,J),st.clear({color:o.be.transparent});for(let ot=0;ot<tt.length;ot++){const xt=tt[ot];if(Q.hasRenderableParent(xt))continue;const It=Q.getTile(xt),St=It.getBucket(J);if(!St)continue;const Pt=St.programConfigurations.get(J.id),Ct=q.useProgram("heatmap",Pt),te=nt.getProjectionData({overscaledTileID:xt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Jt=nt.getCircleRadiusCorrection();Ct.draw(st,ht.TRIANGLES,Ue.disabled,ut,mt,Fe.backCCW,ja(It,nt.zoom,J.paint.get("heatmap-intensity"),Jt),null,te,J.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,J.paint,nt.zoom,Pt)}st.viewport.set([0,0,q.width,q.height])}(b,M,T,I):b.renderPass==="translucent"&&function(q,Q){const J=q.context,tt=J.gl;J.setColorMode(q.colorModeForRenderPass());const st=Q.heatmapFbos.get(o.c1);st&&(J.activeTexture.set(tt.TEXTURE0),tt.bindTexture(tt.TEXTURE_2D,st.colorAttachment.get()),J.activeTexture.set(tt.TEXTURE1),Wo(J,Q).bind(tt.LINEAR,tt.CLAMP_TO_EDGE),q.useProgram("heatmapTexture").draw(J,tt.TRIANGLES,Ue.disabled,Pe.disabled,q.colorModeForRenderPass(),Fe.disabled,tu(q,Q,0,1),null,null,Q.id,q.viewportBuffer,q.quadTriangleIndexBuffer,q.viewportSegments,Q.paint,q.transform.zoom))}(b,T)}(t,r,c,d,_):o.cd(c)?function(b,M,T,I,R){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:F}=R,O=T.paint.get("line-opacity"),G=T.paint.get("line-width");if(O.constantOr(1)===0||G.constantOr(1)===0)return;const q=b.getDepthModeForSublayer(0,Ue.ReadOnly),Q=b.colorModeForRenderPass(),J=T.paint.get("line-dasharray"),tt=T.paint.get("line-pattern"),st=tt.constantOr(1),ht=T.paint.get("line-gradient"),nt=T.getCrossfadeParameters(),ut=st?"linePattern":J?"lineSDF":ht?"lineGradient":"line",mt=b.context,ot=mt.gl,xt=b.transform;let It=!0;for(const St of I){const Pt=M.getTile(St);if(st&&!Pt.patternsLoaded())continue;const Ct=Pt.getBucket(T);if(!Ct)continue;const te=Ct.programConfigurations.get(T.id),Jt=b.context.program.get(),Vt=b.useProgram(ut,te),he=It||Vt.program!==Jt,Ve=b.style.map.terrain&&b.style.map.terrain.getTerrainData(St),di=tt.constantOr(null);if(di&&Pt.imageAtlas){const gi=Pt.imageAtlas,vi=gi.patternPositions[di.to.toString()],fr=gi.patternPositions[di.from.toString()];vi&&fr&&te.setConstantPatternPositions(vi,fr)}const Oi=xt.getProjectionData({overscaledTileID:St,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),mi=xt.getPixelScale(),Fi=st?iu(b,Pt,T,mi,nt):J?ru(b,Pt,T,mi,J,nt):ht?lh(b,Pt,T,mi,Ct.lineClipsArray.length):Oo(b,Pt,T,mi);if(st)mt.activeTexture.set(ot.TEXTURE0),Pt.imageAtlasTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE),te.updatePaintBuffers(nt);else if(J&&(he||b.lineAtlas.dirty))mt.activeTexture.set(ot.TEXTURE0),b.lineAtlas.bind(mt);else if(ht){const gi=Ct.gradients[T.id];let vi=gi.texture;if(T.gradientVersion!==gi.version){let fr=256;if(T.stepInterpolant){const ai=M.getSource().maxzoom,ar=St.canonical.z===ai?Math.ceil(1<<b.transform.maxZoom-St.canonical.z):1;fr=o.ag(o.c2(Ct.maxLineLength/o.$*1024*ar),256,mt.maxTextureSize)}gi.gradient=o.c3({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:fr,image:gi.gradient||void 0,clips:Ct.lineClipsArray}),gi.texture?gi.texture.update(gi.gradient):gi.texture=new o.T(mt,gi.gradient,ot.RGBA),gi.version=T.gradientVersion,vi=gi.texture}mt.activeTexture.set(ot.TEXTURE0),vi.bind(T.stepInterpolant?ot.NEAREST:ot.LINEAR,ot.CLAMP_TO_EDGE)}const yi=b.stencilModeForClipping(St);Vt.draw(mt,ot.TRIANGLES,q,yi,Q,Fe.disabled,Fi,Ve,Oi,T.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,T.paint,b.transform.zoom,te,Ct.layoutVertexBuffer2),It=!1}}(t,r,c,d,_):o.ce(c)?function(b,M,T,I,R){const F=T.paint.get("fill-color"),O=T.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const{isRenderingToTexture:G}=R,q=b.colorModeForRenderPass(),Q=T.paint.get("fill-pattern"),J=b.opaquePassEnabledForLayer()&&!Q.constantOr(1)&&F.constantOr(o.be.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===J){const tt=b.getDepthModeForSublayer(1,b.renderPass==="opaque"?Ue.ReadWrite:Ue.ReadOnly);Za(b,M,T,I,tt,q,!1,G)}if(b.renderPass==="translucent"&&T.paint.get("fill-antialias")){const tt=b.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Ue.ReadOnly);Za(b,M,T,I,tt,q,!0,G)}}(t,r,c,d,_):o.cf(c)?function(b,M,T,I,R){const F=T.paint.get("fill-extrusion-opacity");if(F===0)return;const{isRenderingToTexture:O}=R;if(b.renderPass==="translucent"){const G=new Ue(b.context.gl.LEQUAL,Ue.ReadWrite,b.depthRangeFor3D);if(F!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))Qn(b,M,T,I,G,Pe.disabled,si.disabled,O),Qn(b,M,T,I,G,b.stencilModeFor3D(),b.colorModeForRenderPass(),O);else{const q=b.colorModeForRenderPass();Qn(b,M,T,I,G,Pe.disabled,q,O)}}}(t,r,c,d,_):o.cg(c)?function(b,M,T,I,R){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const{isRenderingToTexture:F}=R,O=b.context,G=b.style.projection.useSubdivision,q=b.getDepthModeForSublayer(0,Ue.ReadOnly),Q=b.colorModeForRenderPass();if(b.renderPass==="offscreen")(function(J,tt,st,ht,nt,ut,mt){const ot=J.context,xt=ot.gl;for(const It of st){const St=tt.getTile(It),Pt=St.dem;if(!Pt||!Pt.data||!St.needsHillshadePrepare)continue;const Ct=Pt.dim,te=Pt.stride,Jt=Pt.getPixels();if(ot.activeTexture.set(xt.TEXTURE1),ot.pixelStoreUnpackPremultiplyAlpha.set(!1),St.demTexture=St.demTexture||J.getTileTexture(te),St.demTexture){const he=St.demTexture;he.update(Jt,{premultiply:!1}),he.bind(xt.NEAREST,xt.CLAMP_TO_EDGE)}else St.demTexture=new o.T(ot,Jt,xt.RGBA,{premultiply:!1}),St.demTexture.bind(xt.NEAREST,xt.CLAMP_TO_EDGE);ot.activeTexture.set(xt.TEXTURE0);let Vt=St.fbo;if(!Vt){const he=new o.T(ot,{width:Ct,height:Ct,data:null},xt.RGBA);he.bind(xt.LINEAR,xt.CLAMP_TO_EDGE),Vt=St.fbo=ot.createFramebuffer(Ct,Ct,!0,!1),Vt.colorAttachment.set(he.texture)}ot.bindFramebuffer.set(Vt.framebuffer),ot.viewport.set([0,0,Ct,Ct]),J.useProgram("hillshadePrepare").draw(ot,xt.TRIANGLES,nt,ut,mt,Fe.disabled,sf(St.tileID,Pt),null,null,ht.id,J.rasterBoundsBuffer,J.quadTriangleIndexBuffer,J.rasterBoundsSegments),St.needsHillshadePrepare=!1}})(b,M,I,T,q,Pe.disabled,Q),O.viewport.set([0,0,b.width,b.height]);else if(b.renderPass==="translucent")if(G){const[J,tt,st]=b.stencilConfigForOverlapTwoPass(I);ta(b,M,T,st,J,q,Q,!1,F),ta(b,M,T,st,tt,q,Q,!0,F)}else{const[J,tt]=b.getStencilConfigForOverlapAndUpdateStencilID(I);ta(b,M,T,tt,J,q,Q,!1,F)}}(t,r,c,d,_):o.ch(c)?function(b,M,T,I,R){if(b.renderPass!=="translucent"||!I.length)return;const{isRenderingToTexture:F}=R,O=b.style.projection.useSubdivision,G=b.getDepthModeForSublayer(0,Ue.ReadOnly),q=b.colorModeForRenderPass();if(O){const[Q,J,tt]=b.stencilConfigForOverlapTwoPass(I);Wa(b,M,T,tt,Q,G,q,!1,F),Wa(b,M,T,tt,J,G,q,!0,F)}else{const[Q,J]=b.getStencilConfigForOverlapAndUpdateStencilID(I);Wa(b,M,T,J,Q,G,q,!1,F)}}(t,r,c,d,_):o.ci(c)?function(b,M,T,I,R){if(b.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!I.length)return;const{isRenderingToTexture:F}=R,O=M.getSource(),G=b.style.projection.useSubdivision;if(O instanceof Ze)Ys(b,M,T,I,null,!1,!1,O.tileCoords,O.flippedWindingOrder,F);else if(G){const[q,Q,J]=b.stencilConfigForOverlapTwoPass(I);Ys(b,M,T,J,q,!1,!0,Mh,!1,F),Ys(b,M,T,J,Q,!0,!0,Mh,!1,F)}else{const[q,Q]=b.getStencilConfigForOverlapAndUpdateStencilID(I);Ys(b,M,T,Q,q,!1,!0,Mh,!1,F)}}(t,r,c,d,_):o.cj(c)?function(b,M,T,I,R){const F=T.paint.get("background-color"),O=T.paint.get("background-opacity");if(O===0)return;const{isRenderingToTexture:G}=R,q=b.context,Q=q.gl,J=b.style.projection,tt=b.transform,st=tt.tileSize,ht=T.paint.get("background-pattern");if(b.isPatternMissing(ht))return;const nt=!ht&&F.a===1&&O===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==nt)return;const ut=Pe.disabled,mt=b.getDepthModeForSublayer(0,nt==="opaque"?Ue.ReadWrite:Ue.ReadOnly),ot=b.colorModeForRenderPass(),xt=b.useProgram(ht?"backgroundPattern":"background"),It=I||At(tt,{tileSize:st,terrain:b.style.map.terrain});ht&&(q.activeTexture.set(Q.TEXTURE0),b.imageManager.bind(b.context));const St=T.getCrossfadeParameters();for(const Pt of It){const Ct=tt.getProjectionData({overscaledTileID:Pt,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),te=ht?of(O,b,ht,{tileID:Pt,tileSize:st},St):Fo(O,F),Jt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Pt),Vt=J.getMeshFromTileID(q,Pt.canonical,!1,!0,"raster");xt.draw(q,Q.TRIANGLES,mt,ut,ot,Fe.backCCW,te,Jt,Ct,T.id,Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}}(t,0,c,d,_):o.ck(c)&&function(b,M,T,I){const{isRenderingGlobe:R}=I,F=b.context,O=T.implementation,G=b.style.projection,q=b.transform,Q=q.getProjectionDataForCustomLayer(R),J={farZ:q.farZ,nearZ:q.nearZ,fov:q.fov*Math.PI/180,modelViewProjectionMatrix:q.modelViewProjectionMatrix,projectionMatrix:q.projectionMatrix,shaderData:{variantName:G.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${G.shaderPreludeCode.vertexSource}`,define:G.shaderDefine},defaultProjectionData:Q},tt=O.renderingMode?O.renderingMode:"2d";if(b.renderPass==="offscreen"){const st=O.prerender;st&&(b.setCustomLayerDefaults(),F.setColorMode(b.colorModeForRenderPass()),st.call(O,F.gl,J),F.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),F.setColorMode(b.colorModeForRenderPass()),F.setStencilMode(Pe.disabled);const st=tt==="3d"?b.getDepthModeFor3D():b.getDepthModeForSublayer(0,Ue.ReadOnly);F.setDepthMode(st),O.render(F.gl,J),F.setDirty(),b.setBaseState(),F.bindFramebuffer.set(null)}}(t,0,c,_))}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!r||!c}useProgram(t,r,c=!1,d=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,b=this.style.projection,M=c?bs.projectionMercator:b.shaderPreludeCode,T=c?bn:b.shaderDefine,I=t+(r?r.cacheKey:"")+`/${c?Ql:b.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[I]||(this.cache[I]=new zo(this.context,bs[t],r,au[t],this._showOverdrawInspector,_,M,T,d)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}function Yo(g,t){let r,c=!1,d=null,_=null;const b=()=>{d=null,c&&(g.apply(_,r),d=setTimeout(b,t),c=!1)};return(...M)=>(c=!0,_=this,r=M,d||b(),d)}class Ha{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(c=d)}),(c&&c[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const c=r.join("/");let d=c;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${c}`);let _=window.location.hash.replace(d,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let b=window.location.href.replace(/(#.+)?$/,_);b=b.replace("&&","&"),window.history.replaceState(window.history.state,null,b)},this._updateHash=Yo(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const r=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,d),b=Math.round(r.lng*_)/_,M=Math.round(r.lat*_)/_,T=this._map.getBearing(),I=this._map.getPitch();let R="";if(R+=t?`/${b}/${M}/${c}`:`${c}/${M}/${b}`,(T||I)&&(R+="/"+Math.round(10*T)/10),I&&(R+=`/${Math.round(I)}`),this._hashName){const F=this._hashName;let O=!1;const G=window.location.hash.slice(1).split("&").map(q=>{const Q=q.split("=")[0];return Q===F?(O=!0,`${Q}=${R}`):q}).filter(q=>q);return O||G.push(`${F}=${R}`),`#${G.join("&")}`}return`#${R}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new o.S(+t[2],+t[1])}catch{return!1}const r=+t[0],c=+(t[3]||0),d=+(t[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&c>=-180&&c<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const ea={linearity:.3,easing:o.cl(0,0,.3,1)},ia=o.e({deceleration:2500,maxSpeed:1400},ea),Th=o.e({deceleration:20,maxSpeed:1400},ea),Ka=o.e({deceleration:1e3,maxSpeed:360},ea),Ph=o.e({deceleration:1e3,maxSpeed:90},ea),Mu=o.e({deceleration:1e3,maxSpeed:360},ea);class Su{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:D.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=D.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,r.roll+=_.rollDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(r.pan.mag()){const _=sa(r.pan.mag(),c,o.e({},ia,t||{})),b=r.pan.mult(_.amount/r.pan.mag()),M=this._map.cameraHelper.handlePanInertia(b,this._map.transform);d.center=M.easingCenter,d.offset=M.easingOffset,ra(d,_)}if(r.zoom){const _=sa(r.zoom,c,Th);d.zoom=this._map.transform.zoom+_.amount,ra(d,_)}if(r.bearing){const _=sa(r.bearing,c,Ka);d.bearing=this._map.transform.bearing+o.ag(_.amount,-179,179),ra(d,_)}if(r.pitch){const _=sa(r.pitch,c,Ph);d.pitch=this._map.transform.pitch+_.amount,ra(d,_)}if(r.roll){const _=sa(r.roll,c,Mu);d.roll=this._map.transform.roll+o.ag(_.amount,-179,179),ra(d,_)}if(d.zoom||d.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;d.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),o.e(d,{noMoveStart:!0})}}function ra(g,t){(!g.duration||g.duration<t.duration)&&(g.duration=t.duration,g.easing=t.easing)}function sa(g,t,r){const{maxSpeed:c,linearity:d,deceleration:_}=r,b=o.ag(g*d/(t/1e3),-c,c),M=Math.abs(b)/(_*d);return{easing:r.easing,duration:1e3*M,amount:b*(M/2)}}class jr extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c,d={}){c=c instanceof MouseEvent?c:new MouseEvent(t,c);const _=B.mousePos(r.getCanvas(),c),b=r.unproject(_);super(t,o.e({point:_,lngLat:b,originalEvent:c},d)),this._defaultPrevented=!1,this.target=r}}class us extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c){const d=t==="touchend"?c.changedTouches:c.touches,_=B.touchPos(r.getCanvasContainer(),d),b=_.map(T=>r.unproject(T)),M=_.reduce((T,I,R,F)=>T.add(I.div(F.length)),new o.P(0,0));super(t,{points:_,point:M,lngLats:b,lngLat:r.unproject(M),originalEvent:c}),this._defaultPrevented=!1}}class Eh extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class Tu{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Eh(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new jr(t.type,this._map,t))}mouseup(t){this._map.fire(new jr(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new jr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new jr(t.type,this._map,t))}mouseover(t){this._map.fire(new jr(t.type,this._map,t))}mouseout(t){this._map.fire(new jr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new us(t.type,this._map,t))}touchmove(t){this._map.fire(new us(t.type,this._map,t))}touchend(t){this._map.fire(new us(t.type,this._map,t))}touchcancel(t){this._map.fire(new us(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pu{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new jr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new jr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new jr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class na{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(o.P.convert(t),this._map.terrain)}}class Ih{constructor(t,r){this._map=t,this._tr=new na(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(B.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const c=r;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=c,this._box||(this._box=B.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(d.x,c.x),b=Math.max(d.x,c.x),M=Math.min(d.y,c.y),T=Math.max(d.y,c.y);B.setTransform(this._box,`translate(${_}px,${M}px)`),this._box.style.width=b-_+"px",this._box.style.height=T-M+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const c=this._startPos,d=r;if(this.reset(),B.suppressClick(),c.x!==d.x||c.y!==d.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(c,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(B.remove(this._box),this._box=null),B.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new o.l(t,{originalEvent:r}))}}function Jo(g,t){if(g.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${t.length}`);const r={};for(let c=0;c<g.length;c++)r[g[c].identifier]=t[c];return r}class Eu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){const _=new o.P(0,0);for(const b of d)_._add(b);return _.div(d.length)}(r),this.touches=Jo(c,r)))}touchmove(t,r,c){if(this.aborted||!this.centroid)return;const d=Jo(c,r);for(const _ in this.touches){const b=d[_];(!b||b.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Qo{constructor(t){this.singleTap=new Eu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,c){this.singleTap.touchstart(t,r,c)}touchmove(t,r,c){this.singleTap.touchmove(t,r,c)}touchend(t,r,c){const d=this.singleTap.touchend(t,r,c);if(d){const _=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(d)<30;if(_&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class tl{constructor(t){this._tr=new na(t),this._zoomIn=new Qo({numTouches:1,numTaps:2}),this._zoomOut=new Qo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,c){this._zoomIn.touchstart(t,r,c),this._zoomOut.touchstart(t,r,c)}touchmove(t,r,c){this._zoomIn.touchmove(t,r,c),this._zoomOut.touchmove(t,r,c)}touchend(t,r,c){const d=this._zoomIn.touchend(t,r,c),_=this._zoomOut.touchend(t,r,c),b=this._tr;return d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(d)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class aa{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const d=Array.isArray(r)?r[0]:r;return!this._moved&&d.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(c,d))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&B.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ns=0,ds=2,Iu={[ns]:1,[ds]:2};class Cr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=B.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(r,c){const d=Iu[c];return r.buttons===void 0||(r.buttons&d)!==d}(t,this._eventButton)}isValidEndEvent(t){return B.mouseButton(t)===this._eventButton}}class oa{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class gf{constructor(t=new Cr({checkCorrectEvent:()=>!0}),r=new oa){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(t,r,c){return t instanceof MouseEvent?r(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?c(t):void 0}startMove(t){this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(t){this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(t){return this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(t){return this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(t){return this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}const el=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=t=>{t.preventDefault()}};class _f{constructor(t,r){this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,r,c){return this._calculateTransform(t,r,c)}touchmove(t,r,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,r,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,r,c){this._calculateTransform(t,r,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,c){c.length>0&&(this._active=!0);const d=Jo(c,r),_=new o.P(0,0),b=new o.P(0,0);let M=0;for(const I in d){const R=d[I],F=this._touches[I];F&&(_._add(R),b._add(R.sub(F)),M++,d[I]=R)}if(this._touches=d,this._shouldBePrevented(M)||!b.mag())return;const T=b.div(M);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(M),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ch{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,c){if(!this._firstTwoTouches)return;t.preventDefault();const[d,_]=this._firstTwoTouches,b=Ya(c,r,d),M=Ya(c,r,_);if(!b||!M)return;const T=this._aroundCenter?null:b.add(M).div(2);return this._move([b,M],T,t)}touchend(t,r,c){if(!this._firstTwoTouches)return;const[d,_]=this._firstTwoTouches,b=Ya(c,r,d),M=Ya(c,r,_);b&&M||(this._active&&B.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ya(g,t,r){for(let c=0;c<g.length;c++)if(g[c].identifier===r)return t[c]}function la(g,t){return Math.log(g/t)/Math.LN2}class Ss extends Ch{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(la(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:la(this._distance,c),pinchAround:r}}}function ne(g,t){return 180*g.angleWith(t)/Math.PI}class Ah extends Ch{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r,c){const d=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ne(this._vector,d),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,c=ne(t,this._startVector);return Math.abs(c)<r}}function Ja(g){return Math.abs(g.y)>Math.abs(g.x)}class Rh extends Ch{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,c){super.touchstart(t,r,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Ja(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,_,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(d.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,c){if(this._valid!==void 0)return this._valid;const d=t.mag()>=2,_=r.mag()>=2;if(!d&&!_)return;if(!d||!_)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const b=t.y>0==r.y>0;return Ja(t)&&Ja(r)&&b}}const Qa={panStep:100,bearingStep:15,pitchStep:10};class ha{constructor(t){this._tr=new na(t);const r=Qa;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,c=0,d=0,_=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?d=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?d=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(c=0,d=0),{cameraAnimation:M=>{const T=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Dh,zoom:r?Math.round(T.zoom)+r*(t.shiftKey?2:1):T.zoom,bearing:T.bearing+c*this._bearingStep,pitch:T.pitch+d*this._pitchStep,offset:[-_*this._panStep,-b*this._panStep],center:T.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Dh(g){return g*(2-g)}const Je=4.000244140625,zh=1/450;class Cu{constructor(t,r){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new na(t),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=zh}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=D.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%Je==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(d*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=B.mousePos(this._map.getCanvas(),t),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(o.S.convert(c.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const M=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=M),typeof this._targetZoom=="number"&&(this._targetZoom+=M)}if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Je?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&T!==0&&(T=1/T);const I=typeof this._targetZoom!="number"?t.scale:o.ae(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),o.aj(I*T)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,c=this._startZoom,d=this._easing;let _,b=!1;if(this._type==="wheel"&&c&&d){const M=D.now()-this._lastWheelEventTime,T=Math.min((M+5)/200,1),I=d(T);_=o.C.number(c,r,I),T<1?this._frameId||(this._frameId=!0):b=!0}else _=r,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!b,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=o.cn;if(this._prevEase){const c=this._prevEase,d=(D.now()-c.start)/c.duration,_=c.easing(d+.01)-c.easing(d),b=.27/Math.sqrt(_*_+1e-4)*.01,M=Math.sqrt(.0729-b*b);r=o.cl(b,M,.25,1)}return this._prevEase={start:D.now(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class il{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yf{constructor(t){this._tr=new na(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vf{constructor(){this._tap=new Qo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,c){if(!this._swipePoint)if(this._tapTime){const d=r[0],_=t.timeStamp-this._tapTime<500,b=this._tapPoint.dist(d)<30;_&&b?c.length>0&&(this._swipePoint=d,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,r,c)}touchmove(t,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const d=r[0],_=d.y-this._swipePoint.y;return this._swipePoint=d,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,c)}touchend(t,r,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const d=this._tap.touchend(t,r,c);d&&(this._tapTime=t.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kh{constructor(t,r,c){this._el=t,this._mousePan=r,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rl{constructor(t,r,c,d){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=r,this._mousePitch=c,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Lh{constructor(t,r,c,d){this._el=t,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Au{constructor(t,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=B.create("div","maplibregl-cooperative-gesture-screen",t);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=r,this._container.appendChild(d);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=c,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(B.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,r){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:t,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const to=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class xf extends o.l{}function Oh(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class Qs{constructor(t,r){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,_)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=d.type==="renderFrame"?void 0:d,M={needsRenderFrame:!1},T={},I={};for(const{handlerName:O,handler:G,allowed:q}of this._handlers){if(!G.isEnabled())continue;let Q;if(this._blockedByActive(I,q,O))G.reset();else if(G[_||d.type]){if(o.co(d,_||d.type)){const J=B.mousePos(this._map.getCanvas(),d);Q=G[_||d.type](d,J)}else if(o.cp(d,_||d.type)){const J=this._getMapTouches(d.touches),tt=B.touchPos(this._map.getCanvas(),J);Q=G[_||d.type](d,tt,J)}else o.cq(_||d.type)||(Q=G[_||d.type](d));this.mergeHandlerResult(M,T,Q,O,b),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()}(Q||G.isActive())&&(I[O]=G)}const R={};for(const O in this._previousActiveHandlers)I[O]||(R[O]=b);this._previousActiveHandlers=I,(Object.keys(R).length||Oh(M))&&(this._changes.push([M,T,R]),this._triggerRenderFrame()),(Object.keys(I).length||Oh(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=M;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Su(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,_,b]of this._listeners)B.addEventListener(d,_,d===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,r,c]of this._listeners)B.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new Tu(r,t));const d=r.boxZoom=new Ih(r,t);this._add("boxZoom",d),t.interactive&&t.boxZoom&&d.enable();const _=r.cooperativeGestures=new Au(r,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const b=new tl(r),M=new yf(r);r.doubleClickZoom=new il(M,b),this._add("tapZoom",b),this._add("clickZoom",M),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const T=new vf;this._add("tapDragZoom",T);const I=r.touchPitch=new Rh(r);this._add("touchPitch",I),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const R=()=>r.project(r.getCenter()),F=function({enable:nt,clickTolerance:ut,aroundCenter:mt=!0,minPixelCenterThreshold:ot=100,rotateDegreesPerPixelMoved:xt=.8},It){const St=new Cr({checkCorrectEvent:Pt=>B.mouseButton(Pt)===0&&Pt.ctrlKey||B.mouseButton(Pt)===2&&!Pt.ctrlKey});return new aa({clickTolerance:ut,move:(Pt,Ct)=>{const te=It();if(mt&&Math.abs(te.y-Pt.y)>ot)return{bearingDelta:o.cm(new o.P(Pt.x,Ct.y),Ct,te)};let Jt=(Ct.x-Pt.x)*xt;return mt&&Ct.y<te.y&&(Jt=-Jt),{bearingDelta:Jt}},moveStateManager:St,enable:nt,assignEvents:el})}(t,R),O=function({enable:nt,clickTolerance:ut,pitchDegreesPerPixelMoved:mt=-.5}){const ot=new Cr({checkCorrectEvent:xt=>B.mouseButton(xt)===0&&xt.ctrlKey||B.mouseButton(xt)===2});return new aa({clickTolerance:ut,move:(xt,It)=>({pitchDelta:(It.y-xt.y)*mt}),moveStateManager:ot,enable:nt,assignEvents:el})}(t),G=function({enable:nt,clickTolerance:ut,rollDegreesPerPixelMoved:mt=.3},ot){const xt=new Cr({checkCorrectEvent:It=>B.mouseButton(It)===2&&It.ctrlKey});return new aa({clickTolerance:ut,move:(It,St)=>{const Pt=ot();let Ct=(St.x-It.x)*mt;return St.y<Pt.y&&(Ct=-Ct),{rollDelta:Ct}},moveStateManager:xt,enable:nt,assignEvents:el})}(t,R);r.dragRotate=new rl(t,F,O,G),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",O,["mouseRotate","mouseRoll"]),this._add("mouseRoll",G,["mousePitch"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const q=function({enable:nt,clickTolerance:ut}){const mt=new Cr({checkCorrectEvent:ot=>B.mouseButton(ot)===0&&!ot.ctrlKey});return new aa({clickTolerance:ut,move:(ot,xt)=>({around:xt,panDelta:xt.sub(ot)}),activateOnStart:!0,moveStateManager:mt,enable:nt,assignEvents:el})}(t),Q=new _f(t,r);r.dragPan=new kh(c,q,Q),this._add("mousePan",q),this._add("touchPan",Q,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const J=new Ah,tt=new Ss;r.touchZoomRotate=new Lh(c,tt,J,T),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",tt,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate);const st=r.scrollZoom=new Cu(r,()=>this._triggerRenderFrame());this._add("scrollZoom",st,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const ht=r.keyboard=new ha(r);this._add("keyboard",ht),t.interactive&&t.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Pu(r))}_add(t,r,c){this._handlers.push({handlerName:t,handler:r,allowed:c}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!to(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,c){for(const d in t)if(d!==c&&(!r||r.indexOf(d)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const c of t)this._el.contains(c.target)&&r.push(c);return r}mergeHandlerResult(t,r,c,d,_){if(!c)return;o.e(t,c);const b={handlerName:d,originalEvent:c.originalEvent||_};c.zoomDelta!==void 0&&(r.zoom=b),c.panDelta!==void 0&&(r.drag=b),c.rollDelta!==void 0&&(r.roll=b),c.pitchDelta!==void 0&&(r.pitch=b),c.bearingDelta!==void 0&&(r.rotate=b)}_applyChanges(){const t={},r={},c={};for(const[d,_,b]of this._changes)d.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(d.panDelta)),d.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(t.rollDelta=(t.rollDelta||0)+d.rollDelta),d.around!==void 0&&(t.around=d.around),d.pinchAround!==void 0&&(t.pinchAround=d.pinchAround),d.noInertia&&(t.noInertia=d.noInertia),o.e(r,_),o.e(c,b);this._updateMapTransform(t,r,c),this._changes=[]}_updateMapTransform(t,r,c){const d=this._map,_=d._getTransformForUpdate(),b=d.terrain;if(!(Oh(t)||b&&this._terrainMovement))return this._fireEvents(r,c,!0);d._stop(!0);let{panDelta:M,zoomDelta:T,bearingDelta:I,pitchDelta:R,rollDelta:F,around:O,pinchAround:G}=t;G!==void 0&&(O=G),O=O||d.transform.centerPoint,b&&!_.isPointOnMapSurface(O)&&(O=_.centerPoint);const q={panDelta:M,zoomDelta:T,rollDelta:F,pitchDelta:R,bearingDelta:I,around:O};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(O)&&(O=_.centerPoint);const Q=O.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(M?O.sub(M):O);b?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(q,_),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?_.setCenter(_.screenPointToLocation(_.centerPoint.sub(M))):this._map.cameraHelper.handleMapControlsPan(q,_,Q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(q,_,Q))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(q,_),this._map.cameraHelper.handleMapControlsPan(q,_,Q)),d._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,c,!0)}_fireEvents(t,r,c){const d=to(this._eventsInProgress),_=to(t),b={};for(const F in t){const{originalEvent:O}=t[F];this._eventsInProgress[F]||(b[`${F}start`]=O),this._eventsInProgress[F]=t[F]}!d&&_&&this._fireEvent("movestart",_.originalEvent);for(const F in b)this._fireEvent(F,b[F]);_&&this._fireEvent("move",_.originalEvent);for(const F in t){const{originalEvent:O}=t[F];this._fireEvent(F,O)}const M={};let T;for(const F in this._eventsInProgress){const{handlerName:O,originalEvent:G}=this._eventsInProgress[F];this._handlersById[O].isActive()||(delete this._eventsInProgress[F],T=r[O]||G,M[`${F}end`]=T)}for(const F in M)this._fireEvent(F,M[F]);const I=to(this._eventsInProgress),R=(d||_)&&!I;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const F=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&F.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(F)}if(c&&R){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!F||!F.essential&&D.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:T})),O(this._map.getBearing())&&this._map.resetNorth()):(O(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new o.l(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new xf("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ci extends o.E{constructor(t,r,c){super(),this._renderFrameCallback=()=>{const d=Math.min((D.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,r){t.apply(this.transform),this.transform=t,this.cameraHelper=r}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,r){return this.jumpTo({elevation:t},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,r,c){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.e({offset:t},r),c)}panTo(t,r,c){return this.easeTo(o.e({center:t},r),c)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,c){return this.easeTo(o.e({zoom:t},r),c)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,r){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)).fire(new o.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,c){return this.easeTo(o.e({bearing:t},r),c)}resetNorth(t,r){return this.rotateTo(0,o.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}getRoll(){return this.transform.roll}setRoll(t,r){return this.jumpTo({roll:t},r),this}cameraForBounds(t,r){t=oe.convert(t).adjustAntiMeridian();const c=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,r)}_cameraForBoxAndBearing(t,r,c,d){const _={top:0,bottom:0,right:0,left:0};if(typeof(d=o.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const I=d.padding;d.padding={top:I,bottom:I,right:I,left:I}}const b=o.e(_,d.padding);d.padding=b;const M=this.transform,T=new oe(t,r);return this.cameraHelper.cameraForBoxAndBearing(d,b,T,c,M)}fitBounds(t,r,c){return this._fitInternal(this.cameraForBounds(t,r),r,c)}fitScreenCoordinates(t,r,c,d,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(t)),this.transform.screenPointToLocation(o.P.convert(r)),c,d),d,_)}_fitInternal(t,r,c){return t?(delete(r=o.e(t,r)).padding,r.linear?this.easeTo(r,c):this.flyTo(r,c)):this}jumpTo(t,r){this.stop();const c=this._getTransformForUpdate();let d=!1,_=!1,b=!1;const M=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,t);const T=c.zoom!==M;return"elevation"in t&&c.elevation!==+t.elevation&&c.setElevation(+t.elevation),"bearing"in t&&c.bearing!==+t.bearing&&(d=!0,c.setBearing(+t.bearing)),"pitch"in t&&c.pitch!==+t.pitch&&(_=!0,c.setPitch(+t.pitch)),"roll"in t&&c.roll!==+t.roll&&(b=!0,c.setRoll(+t.roll)),t.padding==null||c.isPaddingEqual(t.padding)||c.setPadding(t.padding),this._applyUpdatedTransform(c),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)),T&&this.fire(new o.l("zoomstart",r)).fire(new o.l("zoom",r)).fire(new o.l("zoomend",r)),d&&this.fire(new o.l("rotatestart",r)).fire(new o.l("rotate",r)).fire(new o.l("rotateend",r)),_&&this.fire(new o.l("pitchstart",r)).fire(new o.l("pitch",r)).fire(new o.l("pitchend",r)),b&&this.fire(new o.l("rollstart",r)).fire(new o.l("roll",r)).fire(new o.l("rollend",r)),this.fire(new o.l("moveend",r))}calculateCameraOptionsFromTo(t,r,c,d=0){const _=o.a0.fromLngLat(t,r),b=o.a0.fromLngLat(c,d),M=b.x-_.x,T=b.y-_.y,I=b.z-_.z,R=Math.hypot(M,T,I);if(R===0)throw new Error("Can't calculate camera options with same From and To");const F=Math.hypot(M,T),O=o.aj(this.transform.cameraToCenterDistance/R/this.transform.tileSize),G=180*Math.atan2(M,-T)/Math.PI;let q=180*Math.acos(F/R)/Math.PI;return q=I<0?90-q:90+q,{center:b.toLngLat(),elevation:d,zoom:O,pitch:q,bearing:G}}calculateCameraOptionsFromCameraLngLatAltRotation(t,r,c,d,_){const b=this.transform.calculateCenterFromCameraLngLatAlt(t,r,c,d);return{center:b.center,elevation:b.elevation,zoom:b.zoom,bearing:c,pitch:d,roll:_}}easeTo(t,r){this._stop(!1,t.easeId),((t=o.e({offset:[0,0],duration:500,easing:o.cn},t)).animate===!1||!t.essential&&D.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),d=this.getBearing(),_=c.pitch,b=c.roll,M="bearing"in t?this._normalizeBearing(t.bearing,d):d,T="pitch"in t?+t.pitch:_,I="roll"in t?this._normalizeBearing(t.roll,b):b,R="padding"in t?t.padding:c.padding,F=o.P.convert(t.offset);let O,G;t.around&&(O=o.S.convert(t.around),G=c.locationToScreenPoint(O));const q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Q=this.cameraHelper.handleEaseTo(c,{bearing:M,pitch:T,roll:I,padding:R,around:O,aroundPoint:G,offsetAsPoint:F,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||d!==M,this._pitching=this._pitching||T!==_,this._rolling=this._rolling||I!==b,this._padding=!c.isPaddingEqual(R),this._zooming=this._zooming||Q.isZooming,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,q),this.terrain&&this._prepareElevation(Q.elevationCenter),this._ease(J=>{Q.easeFunc(J),this.terrain&&!t.freezeElevation&&this._updateElevation(J),this._applyUpdatedTransform(c),this._fireMoveEvents(r)},J=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r,J)},t),this}_prepareEase(t,r,c={}){this._moving=!0,r||c.moving||this.fire(new o.l("movestart",t)),this._zooming&&!c.zooming&&this.fire(new o.l("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new o.l("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new o.l("pitchstart",t)),this._rolling&&!c.rolling&&this.fire(new o.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(r-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const r=t.getCameraLngLat(),c=t.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(r,t.zoom):0;if(c<d){const _=this.calculateCameraOptionsFromTo(r,d,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const r=[];if(r.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&r.push(d=>this.transformCameraUpdate(d)),!r.length)return;const c=t.clone();for(const d of r){const _=c.clone(),{center:b,zoom:M,roll:T,pitch:I,bearing:R,elevation:F}=d(_);b&&_.setCenter(b),F!==void 0&&_.setElevation(F),M!==void 0&&_.setZoom(M),T!==void 0&&_.setRoll(T),I!==void 0&&_.setPitch(I),R!==void 0&&_.setBearing(R),c.apply(_)}this.transform.apply(c)}_fireMoveEvents(t){this.fire(new o.l("move",t)),this._zooming&&this.fire(new o.l("zoom",t)),this._rotating&&this.fire(new o.l("rotate",t)),this._pitching&&this.fire(new o.l("pitch",t)),this._rolling&&this.fire(new o.l("roll",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const c=this._zooming,d=this._rotating,_=this._pitching,b=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new o.l("zoomend",t)),d&&this.fire(new o.l("rotateend",t)),_&&this.fire(new o.l("pitchend",t)),b&&this.fire(new o.l("rollend",t)),this.fire(new o.l("moveend",t))}flyTo(t,r){if(!t.essential&&D.prefersReducedMotion){const Ct=o.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ct,r)}this.stop(),t=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cn},t);const c=this._getTransformForUpdate(),d=c.bearing,_=c.pitch,b=c.roll,M=c.padding,T="bearing"in t?this._normalizeBearing(t.bearing,d):d,I="pitch"in t?+t.pitch:_,R="roll"in t?this._normalizeBearing(t.roll,b):b,F="padding"in t?t.padding:c.padding,O=o.P.convert(t.offset);let G=c.centerPoint.add(O);const q=c.screenPointToLocation(G),Q=this.cameraHelper.handleFlyTo(c,{bearing:T,pitch:I,roll:R,padding:F,locationAtOffset:q,offsetAsPoint:O,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let J=t.curve;const tt=Math.max(c.width,c.height),st=tt/Q.scaleOfZoom,ht=Q.pixelPathLength;typeof Q.scaleOfMinZoom=="number"&&(J=Math.sqrt(tt/Q.scaleOfMinZoom/ht*2));const nt=J*J;function ut(Ct){const te=(st*st-tt*tt+(Ct?-1:1)*nt*nt*ht*ht)/(2*(Ct?st:tt)*nt*ht);return Math.log(Math.sqrt(te*te+1)-te)}function mt(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function ot(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const xt=ut(!1);let It=function(Ct){return ot(xt)/ot(xt+J*Ct)},St=function(Ct){return tt*((ot(xt)*(mt(te=xt+J*Ct)/ot(te))-mt(xt))/nt)/ht;var te},Pt=(ut(!0)-xt)/J;if(Math.abs(ht)<2e-6||!isFinite(Pt)){if(Math.abs(tt-st)<1e-6)return this.easeTo(t,r);const Ct=st<tt?-1:1;Pt=Math.abs(Math.log(st/tt))/J,St=()=>0,It=te=>Math.exp(Ct*J*te)}return t.duration="duration"in t?+t.duration:1e3*Pt/("screenSpeed"in t?+t.screenSpeed/J:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==T,this._pitching=I!==_,this._rolling=R!==b,this._padding=!c.isPaddingEqual(F),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(Q.targetCenter),this._ease(Ct=>{const te=Ct*Pt,Jt=1/It(te),Vt=St(te);this._rotating&&c.setBearing(o.C.number(d,T,Ct)),this._pitching&&c.setPitch(o.C.number(_,I,Ct)),this._rolling&&c.setRoll(o.C.number(b,R,Ct)),this._padding&&(c.interpolatePadding(M,F,Ct),G=c.centerPoint.add(O)),Q.easeFunc(Ct,Jt,Vt,G),this.terrain&&!t.freezeElevation&&this._updateElevation(Ct),this._applyUpdatedTransform(c),this._fireMoveEvents(r)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,r)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,r,c){c.animate===!1||c.duration===0?(t(1),r()):(this._easeStart=D.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=o.aN(t,-180,180);const c=Math.abs(t-r);return Math.abs(t-360-r)<c&&(t-=360),Math.abs(t+360-r)<c&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(t),this.transform.tileZoom):null}}const eo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class sl{constructor(t=eo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=B.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=B.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=B.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){B.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const c=this._map._getUIString(`AttributionControl.${r}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const r=this._map.style.sourceCaches;for(const d in r){const _=r[d];if(_.used||_.usedForTerrain){const b=_.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t=t.filter(d=>String(d).trim()),t.sort((d,_)=>d.length-_.length),t=t.filter((d,_)=>{for(let b=_+1;b<t.length;b++)if(t[b].indexOf(d)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=B.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Fh{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=B.create("div","maplibregl-ctrl");const r=B.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){B.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ru{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const d of c)if(d.id===t)return void(d.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Du=o.aI([{name:"a_pos3d",type:"Int16",components:3}]);class bf extends o.E{constructor(t){super(),this._lastTilesetChange=D.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,r){this.sourceCache.update(t,r),this._renderableTilesKeys=[];const c={};for(const d of At(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))c[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),o.bX(d.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[d.key]=new xr(d,this.tileSize),this._lastTilesetChange=D.now());for(const d in this._tiles)c[d]||delete this._tiles[d]}freeRtt(t){for(const r in this._tiles){const c=this._tiles[r];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,r){return r?this._getTerrainCoordsForTileRanges(t,r):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const r={};for(const c of this._renderableTilesKeys){const d=this._tiles[c].tileID,_=t.clone(),b=o.b9();if(d.canonical.equals(t.canonical))o.bX(b,0,o.$,o.$,0,0,1);else if(d.canonical.isChildOf(t.canonical)){const M=d.canonical.z-t.canonical.z,T=d.canonical.x-(d.canonical.x>>M<<M),I=d.canonical.y-(d.canonical.y>>M<<M),R=o.$>>M;o.bX(b,0,R,R,0,0,1),o.M(b,b,[-T*R,-I*R,0])}else{if(!t.canonical.isChildOf(d.canonical))continue;{const M=t.canonical.z-d.canonical.z,T=t.canonical.x-(t.canonical.x>>M<<M),I=t.canonical.y-(t.canonical.y>>M<<M),R=o.$>>M;o.bX(b,0,o.$,o.$,0,0,1),o.M(b,b,[T*R,I*R,0]),o.N(b,b,[1/2**M,1/2**M,0])}}_.terrainRttPosMatrix32f=new Float32Array(b),r[c]=_}return r}_getTerrainCoordsForTileRanges(t,r){const c={};for(const d of this._renderableTilesKeys){const _=this._tiles[d].tileID;if(!this._isWithinTileRanges(_,r))continue;const b=t.clone(),M=o.b9();if(_.canonical.z===t.canonical.z){const T=t.canonical.x-_.canonical.x,I=t.canonical.y-_.canonical.y;o.bX(M,0,o.$,o.$,0,0,1),o.M(M,M,[T*o.$,I*o.$,0])}else if(_.canonical.z>t.canonical.z){const T=_.canonical.z-t.canonical.z,I=_.canonical.x-(_.canonical.x>>T<<T),R=_.canonical.y-(_.canonical.y>>T<<T),F=t.canonical.x-(_.canonical.x>>T),O=t.canonical.y-(_.canonical.y>>T),G=o.$>>T;o.bX(M,0,G,G,0,0,1),o.M(M,M,[-I*G+F*o.$,-R*G+O*o.$,0])}else{const T=t.canonical.z-_.canonical.z,I=t.canonical.x-(t.canonical.x>>T<<T),R=t.canonical.y-(t.canonical.y>>T<<T),F=(t.canonical.x>>T)-_.canonical.x,O=(t.canonical.y>>T)-_.canonical.y,G=o.$<<T;o.bX(M,0,G,G,0,0,1),o.M(M,M,[I*o.$+F*G,R*o.$+O*G,0])}b.terrainRttPosMatrix32f=new Float32Array(M),c[d]=b}return c}getSourceTile(t,r){const c=this.sourceCache._source;let d=t.overscaledZ-this.deltaZoom;if(d>c.maxzoom&&(d=c.maxzoom),d<c.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(d).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!_||!_.dem)&&r)for(;d>=c.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(t.scaledTo(d--).key);return _}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,r){return r[t.canonical.z]&&t.canonical.x>=r[t.canonical.z].minTileX&&t.canonical.x<=r[t.canonical.z].maxTileX&&t.canonical.y>=r[t.canonical.z].minTileY&&t.canonical.y<=r[t.canonical.z].maxTileY}}class Ts{constructor(t,r,c){this._meshCache={},this.painter=t,this.sourceCache=new bf(r),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,c,d=o.$){var _;if(!(r>=0&&r<d&&c>=0&&c<d))return 0;const b=this.getTerrainData(t),M=(_=b.tile)===null||_===void 0?void 0:_.dem;if(!M)return 0;const T=o.cr([],[r/d*o.$,c/d*o.$],b.u_terrain_matrix),I=[T[0]*M.dim,T[1]*M.dim],R=Math.floor(I[0]),F=Math.floor(I[1]),O=I[0]-R,G=I[1]-F;return M.get(R,F)*(1-O)*(1-G)+M.get(R+1,F)*O*(1-G)+M.get(R,F+1)*(1-O)*G+M.get(R+1,F+1)*O*G}getElevationForLngLatZoom(t,r){if(!o.cs(r,t.wrap()))return 0;const{tileID:c,mercatorX:d,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(c,d%o.$,_%o.$,o.$)}getElevation(t,r,c,d=o.$){return this.getDEMElevation(t,r,c,d)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const d=this.painter.context,_=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(d,_,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(d,new o.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.af([])}const r=this.sourceCache.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const d=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new o.T(d,r.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),r.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const c=r&&r+r.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const d=this.sourceCache.sourceCache._source.maxzoom;let _=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=d?_=t.canonical.z-d:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=t.canonical.x-(t.canonical.x>>_<<_),M=t.canonical.y-(t.canonical.y>>_<<_),T=o.ct(new Float64Array(16),[1/(o.$<<_),1/(o.$<<_),0]);o.M(T,T,[b*o.$,M*o.$,0]),this._demMatrixCache[t.key]={matrix:T,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,c=r.width/devicePixelRatio,d=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(r.context,{width:c,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(r.context,{width:c,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(c,d,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,c,d))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,b=0;_<this._coordsTextureSize;_++)for(let M=0;M<this._coordsTextureSize;M++,b+=4)r[b+0]=255&M,r[b+1]=255&_,r[b+2]=M>>8<<4|_>>8,r[b+3]=0;const c=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),d=new o.T(t,c,t.gl.RGBA,{premultiply:!1});return d.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),c=this.painter.context,d=c.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(_,M-b-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null);const T=r[0]+(r[2]>>4<<8),I=r[1]+((15&r[2])<<8),R=this.coordsIndex[255-r[3]],F=R&&this.sourceCache.getTileByID(R);if(!F)return null;const O=this._coordsTextureSize,G=(1<<F.tileID.canonical.z)*O;return new o.a0((F.tileID.canonical.x*O+T)/G+F.tileID.wrap,(F.tileID.canonical.y*O+I)/G,this.getElevation(F.tileID,T,I,O))}depthAtPoint(t){const r=new Uint8Array(4),c=this.painter.context,d=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(t){var r;const c=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,d=c&&t.canonical.y===0,_=c&&t.canonical.y===(1<<t.canonical.z)-1,b=`m_${d?"n":""}_${_?"s":""}`;if(this._meshCache[b])return this._meshCache[b];const M=this.painter.context,T=new o.cu,I=new o.aM,R=this.meshSize,F=o.$/R,O=R*R;for(let ot=0;ot<=R;ot++)for(let xt=0;xt<=R;xt++)T.emplaceBack(xt*F,ot*F,0);for(let ot=0;ot<O;ot+=R+1)for(let xt=0;xt<R;xt++)I.emplaceBack(xt+ot,R+xt+ot+1,R+xt+ot+2),I.emplaceBack(xt+ot,R+xt+ot+2,xt+ot+1);const G=T.length,q=G+(R+1),Q=(R+1)*R,J=d?o.bg:0,tt=d?0:1,st=_?o.bh:o.$,ht=_?0:1;for(let ot=0;ot<=R;ot++)T.emplaceBack(ot*F,J,tt);for(let ot=0;ot<=R;ot++)T.emplaceBack(ot*F,st,ht);for(let ot=0;ot<R;ot++)I.emplaceBack(Q+ot,q+ot,q+ot+1),I.emplaceBack(Q+ot,q+ot+1,Q+ot+1),I.emplaceBack(0+ot,G+ot+1,G+ot),I.emplaceBack(0+ot,0+ot+1,G+ot+1);const nt=T.length,ut=nt+2*(R+1);for(const ot of[0,1])for(let xt=0;xt<=R;xt++)for(const It of[0,1])T.emplaceBack(ot*o.$,xt*F,It);for(let ot=0;ot<2*R;ot+=2)I.emplaceBack(nt+ot,nt+ot+1,nt+ot+3),I.emplaceBack(nt+ot,nt+ot+3,nt+ot+2),I.emplaceBack(ut+ot,ut+ot+3,ut+ot+1),I.emplaceBack(ut+ot,ut+ot+2,ut+ot+3);const mt=new Ls(M.createVertexBuffer(T,Du.members),M.createIndexBuffer(I),o.aL.simpleSegment(0,0,T.length,I.length));return this._meshCache[b]=mt,mt}getMeshFrameDelta(t){return 2*Math.PI*o.bt/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,r){var c;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(c=this.getMinMaxElevation(d).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return r&&r.dem&&(c.minElevation=r.dem.min*this.exaggeration,c.maxElevation=r.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,r){const c=o.a0.fromLngLat(t.wrap()),d=(1<<r)*o.$,_=c.x*d,b=c.y*d,M=Math.floor(_/o.$),T=Math.floor(b/o.$);return{tileID:new o.Z(r,0,r,M,T),mercatorX:_,mercatorY:b}}}class nl{constructor(t,r,c){this._context=t,this._size=r,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(c.texture),{id:t,fbo:r,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>t.id!==r),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const ue={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class we{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new nl(t.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(c=>!t._layers[c].isHidden(r)),this._coordsAscending={};for(const c in t.sourceCaches){this._coordsAscending[c]={};const d=t.sourceCaches[c].getVisibleCoordinates(),_=t.sourceCaches[c].getSource(),b=_ instanceof Ze?_.terrainTileRanges:null;for(const M of d){const T=this.terrain.sourceCache.getTerrainCoords(M,b);for(const I in T)this._coordsAscending[c][I]||(this._coordsAscending[c][I]=[]),this._coordsAscending[c][I].push(T[I])}}this._coordsAscendingStr={};for(const c of t._order){const d=t._layers[c],_=d.source;if(ue[d.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const b in this._coordsAscending[_])this._coordsAscendingStr[_][b]=this._coordsAscending[_][b].map(M=>M.key).sort().join()}}for(const c of this._renderableTiles)for(const d in this._coordsAscendingStr){const _=this._coordsAscendingStr[d][c.tileID.key];_&&_!==c.rttCoords[d]&&(c.rtt=[])}}renderLayer(t,r){if(t.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),d=t.type,_=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ue[d]&&(this._prevType&&ue[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(t.id),!b))return!0;if(ue[this._prevType]||ue[d]&&b){this._prevType=d;const M=this._stacks.length-1,T=this._stacks[M]||[];for(const I of this._renderableTiles){if(this.pool.isFull()&&(Ni(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[M]){const F=this.pool.getObjectForId(I.rtt[M].id);if(F.stamp===I.rtt[M].stamp){this.pool.useObject(F);continue}}const R=this.pool.getOrCreateFreeObject();this.pool.useObject(R),this.pool.stampObject(R),I.rtt[M]={id:R.id,stamp:R.stamp},_.context.bindFramebuffer.set(R.fbo.framebuffer),_.context.clear({color:o.be.transparent,stencil:0}),_.currentStencilSource=void 0;for(let F=0;F<T.length;F++){const O=_.style._layers[T[F]],G=O.source?this._coordsAscending[O.source][I.tileID.key]:[I.tileID];_.context.viewport.set([0,0,R.fbo.width,R.fbo.height]),_._renderTileClippingMasks(O,G,!0),_.renderLayer(_,_.style.sourceCaches[O.source],O,G,c),O.source&&(I.rttCoords[O.source]=this._coordsAscendingStr[O.source][I.tileID.key])}}return Ni(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),ue[d]}return!1}}const al={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Bh=P,io={hash:!1,interactive:!0,bearingSnap:7,attributionControl:eo,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Ar={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class zu{constructor(t,r,c=!1){this.mousedown=_=>{this.startMove(_,B.mousePos(this.element,_)),B.addEventListener(window,"mousemove",this.mousemove),B.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,B.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHanlder.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=B.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),B.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=B.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const d=new gf;this._rotatePitchHanlder=new aa({clickTolerance:3,move:(_,b)=>{const M=r.getBoundingClientRect(),T=new o.P((M.bottom-M.top)/2,(M.right-M.left)/2);return{bearingDelta:o.cm(new o.P(_.x,b.y),b,T),pitchDelta:c?-.5*(b.y-_.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=t,B.addEventListener(r,"mousedown",this.mousedown),B.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),B.addEventListener(r,"touchcancel",this.reset)}startMove(t,r){this._rotatePitchHanlder.dragStart(t,r),B.disableDrag()}move(t,r){const c=this.map,{bearingDelta:d,pitchDelta:_}=this._rotatePitchHanlder.dragMove(t,r)||{};d&&c.setBearing(c.getBearing()+d),_&&c.setPitch(c.getPitch()+_)}off(){const t=this.element;B.removeEventListener(t,"mousedown",this.mousedown),B.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend),B.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){B.enableDrag(),B.removeEventListener(window,"mousemove",this.mousemove),B.removeEventListener(window,"mouseup",this.mouseup),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend)}}let dr;function ku(g,t,r,c=!1){if(c||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return g==null?void 0:g.wrap();const d=new o.S(g.lng,g.lat);if(g=new o.S(g.lng,g.lat),t){const _=new o.S(g.lng-360,g.lat),b=new o.S(g.lng+360,g.lat),M=r.locationToScreenPoint(g).distSqr(t);r.locationToScreenPoint(_).distSqr(t)<M?g=_:r.locationToScreenPoint(b).distSqr(t)<M&&(g=b)}for(;Math.abs(g.lng-r.center.lng)>180;){const _=r.locationToScreenPoint(g);if(_.x>=0&&_.y>=0&&_.x<=r.width&&_.y<=r.height)break;g.lng>r.center.lng?g.lng-=360:g.lng+=360}return g.lng!==d.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(g))?g:d}const Cn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Li(g,t,r){const c=g.classList;for(const d in Cn)c.remove(`maplibregl-${r}-anchor-${d}`);c.add(`maplibregl-${r}-anchor-${t}`)}class Gi extends o.E{constructor(t){if(super(),this._onKeyPress=r=>{const c=r.code,d=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=r=>{const c=r.originalEvent.target,d=this._element;this._popup&&(c===d||d.contains(c))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=ku(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),B.setTransform(this._element,`${Cn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${d}`),D.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=B.create("div");const r=B.createNS("http://www.w3.org/2000/svg","svg"),c=41,d=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${c}px`),r.setAttributeNS(null,"width",`${d}px`),r.setAttributeNS(null,"viewBox",`0 0 ${d} ${c}`);const _=B.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const b=B.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const M=B.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const tt of T){const st=B.createNS("http://www.w3.org/2000/svg","ellipse");st.setAttributeNS(null,"opacity","0.04"),st.setAttributeNS(null,"cx","10.5"),st.setAttributeNS(null,"cy","5.80029008"),st.setAttributeNS(null,"rx",tt.rx),st.setAttributeNS(null,"ry",tt.ry),M.appendChild(st)}const I=B.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const R=B.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(R);const F=B.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const O=B.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(O);const G=B.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const q=B.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=B.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const J=B.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#FFFFFF"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962"),q.appendChild(Q),q.appendChild(J),b.appendChild(M),b.appendChild(I),b.appendChild(F),b.appendChild(G),b.appendChild(q),r.appendChild(b),r.setAttributeNS(null,"height",c*this._scale+"px"),r.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(r),this._offset=o.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),Li(this._element,this._anchor,"marker"),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),B.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const d=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var r,c;const d=(r=this._map)===null||r===void 0?void 0:r.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!d||_){const G=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==G&&(this._element.style.opacity=G))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,M=b.terrain.depthAtPoint(this._pos),T=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,T)-M<.006)return void(this._element.style.opacity=this._opacity);const I=-this._offset.y/b.transform.pixelsPerMeter,R=Math.sin(b.getPitch()*Math.PI/180)*I,F=b.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),O=b.transform.lngLatToCameraDepth(this._lngLat,T+R)-F>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&O&&this._popup.remove(),this._element.style.opacity=O?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,r){return(this._opacity===void 0||t===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Lu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let tn=0,en=!1;const Nh={maxWidth:100,unit:"metric"};function ll(g,t,r){const c=r&&r.maxWidth||100,d=g._container.clientHeight/2,_=g._container.clientWidth/2,b=g.unproject([_-c/2,d]),M=g.unproject([_+c/2,d]),T=Math.round(g.project(M).x-g.project(b).x),I=Math.min(c,T,g._container.clientWidth),R=b.distanceTo(M);if(r&&r.unit==="imperial"){const F=3.2808*R;F>5280?An(t,I,F/5280,g._getUIString("ScaleControl.Miles")):An(t,I,F,g._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?An(t,I,R/1852,g._getUIString("ScaleControl.NauticalMiles")):R>=1e3?An(t,I,R/1e3,g._getUIString("ScaleControl.Kilometers")):An(t,I,R,g._getUIString("ScaleControl.Meters"))}function An(g,t,r,c){const d=function(_){const b=Math.pow(10,`${Math.floor(_)}`.length-1);let M=_/b;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(T){const I=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*I)/I}(M),b*M}(r);g.style.width=t*(d/r)+"px",g.innerHTML=`${d}&nbsp;${c}`}const ro={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Gh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hl(g){if(g){if(typeof g=="number"){const t=Math.round(Math.abs(g)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,g),"top-left":new o.P(t,t),"top-right":new o.P(-t,t),bottom:new o.P(0,-g),"bottom-left":new o.P(t,-t),"bottom-right":new o.P(-t,-t),left:new o.P(g,0),right:new o.P(-g,0)}}if(g instanceof o.P||Array.isArray(g)){const t=o.P.convert(g);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.P.convert(g.center||[0,0]),top:o.P.convert(g.top||[0,0]),"top-left":o.P.convert(g["top-left"]||[0,0]),"top-right":o.P.convert(g["top-right"]||[0,0]),bottom:o.P.convert(g.bottom||[0,0]),"bottom-left":o.P.convert(g["bottom-left"]||[0,0]),"bottom-right":o.P.convert(g["bottom-right"]||[0,0]),left:o.P.convert(g.left||[0,0]),right:o.P.convert(g.right||[0,0])}}return hl(new o.P(0,0))}const jh=P;m.AJAXError=o.cy,m.Event=o.l,m.Evented=o.E,m.LngLat=o.S,m.MercatorCoordinate=o.a0,m.Point=o.P,m.addProtocol=o.cz,m.config=o.a,m.removeProtocol=o.cA,m.AttributionControl=sl,m.BoxZoomHandler=Ih,m.CanvasSource=Be,m.CooperativeGesturesHandler=Au,m.DoubleClickZoomHandler=il,m.DragPanHandler=kh,m.DragRotateHandler=rl,m.EdgeInsets=es,m.FullscreenControl=class extends o.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var t;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=r==null?void 0:r.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){B.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=B.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);B.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=We,m.GeolocateControl=class extends o.E{constructor(g){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new o.S(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,d=this._map.getBearing(),_=o.e({bearing:d},this.options.fitBoundsOptions),b=oe.fromLngLat(r,c);this._map.fitBounds(b,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new o.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&en)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=B.create("button","maplibregl-ctrl-geolocate",this._container),B.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=B.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gi({element:this._dotElement}),this._circleElement=B.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))})}},this.options=o.e({},Lu,g)}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(t=!1){if(dr!==void 0&&!t)return dr;if(window.navigator.permissions===void 0)return dr=!!window.navigator.geolocation,dr;try{dr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{dr=!!window.navigator.geolocation}return dr})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),B.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,tn=0,en=!1}_isOutOfMapMaxBounds(g){const t=this._map.getMaxBounds(),r=g.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),t=g.getSouthEast(),r=g.getNorthEast(),c=t.distanceTo(r),d=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":tn--,en=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),tn++,tn>1?(g={maximumAge:6e5,timeout:0},en=!0):(g=this.options.positionOptions,en=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const t=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=B.create("button","maplibregl-ctrl-globe",this._container),B.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){B.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},m.Hash=Ha,m.ImageSource=Ze,m.KeyboardHandler=ha,m.LngLatBounds=oe,m.LogoControl=Fh,m.Map=class extends Ci{constructor(g){var t,r;o.cv.mark(o.cw.create);const c=Object.assign(Object.assign(Object.assign({},io),g),{canvasContextAttributes:Object.assign(Object.assign({},io.canvasContextAttributes),g.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new Ki,_=new Ro;if(c.minZoom!==void 0&&d.setMinZoom(c.minZoom),c.maxZoom!==void 0&&d.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&d.setMinPitch(c.minPitch),c.maxPitch!==void 0&&d.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&d.setRenderWorldCopies(c.renderWorldCopies),super(d,_,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ru,this._controls=[],this._mapId=o.a6(),this._contextLost=M=>{M.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:M}))},this._contextRestored=M=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:M}))},this._onMapScroll=M=>{if(M.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},al),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=jt.addThrottleControl(()=>this.isMoving()),this._requestManager=new Gt(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let M=!1;const T=Yo(I=>{this._trackResize&&!this._removed&&(this.resize(I),this.redraw())},50);this._resizeObserver=new ResizeObserver(I=>{M?T(I):M=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Qs(this,c),this._hash=c.hash&&new Ha(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.e({},c.fitBoundsOptions,{duration:0}))));const b=typeof c.style=="string"||((r=(t=c.style)===null||t===void 0?void 0:t.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,b),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new sl(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new Fh,c.logoPosition),this.on("style.load",()=>{if(b||this._resizeTransform(),this.transform.unmodified){const M=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(M)}}),this.on("data",M=>{this._update(M.dataType==="style"),this.fire(new o.l(`${M.dataType}data`,M))}),this.on("dataloading",M=>{this.fire(new o.l(`${M.dataType}dataloading`,M))}),this.on("dataabort",M=>{this.fire(new o.l("sourcedataabort",M))})}_getMapId(){return this._mapId}setGlobalStateProperty(g,t){return this.style.setGlobalStateProperty(g,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,t){if(t===void 0&&(t=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=g.onAdd(this);this._controls.push(g);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(g);return t>-1&&this._controls.splice(t,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,t,r,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,t,r,c)}resize(g,t=!0){const[r,c]=this._containerDimensions(),d=this._getClampedPixelRatio(r,c);if(this._resizeCanvas(r,c,d),this.painter.resize(r,c,d),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const M=this._getClampedPixelRatio(r,c);this._resizeCanvas(r,c,M),this.painter.resize(r,c,M)}this._resizeTransform(t);const _=!this._moving;return _&&(this.stop(),this.fire(new o.l("movestart",g)).fire(new o.l("move",g))),this.fire(new o.l("resize",g)),_&&this.fire(new o.l("moveend",g)),this}_resizeTransform(g=!0){var t;const[r,c]=this._containerDimensions();this.transform.resize(r,c,g),(t=this._requestedCameraState)===null||t===void 0||t.resize(r,c,g)}_getClampedPixelRatio(g,t){const{0:r,1:c}=this._maxCanvasSize,d=this.getPixelRatio(),_=g*d,b=t*d;return Math.min(_>r?r/_:1,b>c?c/b:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(oe.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}project(g){return this.transform.locationToScreenPoint(o.S.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(o.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,t,r){if(g==="mouseenter"||g==="mouseover"){let c=!1;return{layers:t,listener:r,delegates:{mousemove:_=>{const b=t.filter(T=>this.getLayer(T)),M=b.length!==0?this.queryRenderedFeatures(_.point,{layers:b}):[];M.length?c||(c=!0,r.call(this,new jr(g,this,_.originalEvent,{features:M}))):c=!1},mouseout:()=>{c=!1}}}}if(g==="mouseleave"||g==="mouseout"){let c=!1;return{layers:t,listener:r,delegates:{mousemove:b=>{const M=t.filter(T=>this.getLayer(T));(M.length!==0?this.queryRenderedFeatures(b.point,{layers:M}):[]).length?c=!0:c&&(c=!1,r.call(this,new jr(g,this,b.originalEvent)))},mouseout:b=>{c&&(c=!1,r.call(this,new jr(g,this,b.originalEvent)))}}}}{const c=d=>{const _=t.filter(M=>this.getLayer(M)),b=_.length!==0?this.queryRenderedFeatures(d.point,{layers:_}):[];b.length&&(d.features=b,r.call(this,d),delete d.features)};return{layers:t,listener:r,delegates:{[g]:c}}}}_saveDelegatedListener(g,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(t)}_removeDelegatedListener(g,t,r){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const c=this._delegatedListeners[g];for(let d=0;d<c.length;d++){const _=c[d];if(_.listener===r&&_.layers.length===t.length&&_.layers.every(b=>t.includes(b))){for(const b in _.delegates)this.off(b,_.delegates[b]);return void c.splice(d,1)}}}on(g,t,r){if(r===void 0)return super.on(g,t);const c=typeof t=="string"?[t]:t,d=this._createDelegatedListener(g,c,r);this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(g,c,r)}}}once(g,t,r){if(r===void 0)return super.once(g,t);const c=typeof t=="string"?[t]:t,d=this._createDelegatedListener(g,c,r);for(const _ in d.delegates){const b=d.delegates[_];d.delegates[_]=(...M)=>{this._removeDelegatedListener(g,c,r),b(...M)}}this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(g,t,r){return r===void 0?super.off(g,t):(this._removeDelegatedListener(g,typeof t=="string"?[t]:t,r),this)}queryRenderedFeatures(g,t){if(!this.style)return[];let r;const c=g instanceof o.P||Array.isArray(g),d=c?g:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:g)||{},d instanceof o.P||typeof d[0]=="number")r=[o.P.convert(d)];else{const _=o.P.convert(d[0]),b=o.P.convert(d[1]);r=[_,new o.P(b.x,_.y),b,new o.P(_.x,b.y),_]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(g,t){return this.style.querySourceFeatures(g,t)}setStyle(g,t){return(t=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(g,t))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const t=this._locale[g];if(t==null)throw new Error(`Missing UI string '${g}'`);return t}_updateStyle(g,t){var r,c;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,t));const d=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new nh(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,t,d):this.style.loadJSON(g,t,d),this):((c=(r=this.style)===null||r===void 0?void 0:r.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new nh(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,t){if(typeof g=="string"){const r=this._requestManager.transformRequest(g,"Style");o.j(r,new AbortController).then(c=>{this._updateDiff(c.data,t)}).catch(c=>{c&&this.fire(new o.k(c))})}else typeof g=="object"&&this._updateDiff(g,t)}_updateDiff(g,t){try{this.style.setState(g,t)&&this._update(!0)}catch(r){o.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(g,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(g,t){return this._lazyInitEmptyStyle(),this.style.addSource(g,t),this._update(!0)}isSourceLoaded(g){const t=this.style&&this.style.sourceCaches[g];if(t!==void 0)return t.loaded();this.fire(new o.k(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const t=this.style.sourceCaches[g.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&t.reload();for(const r in this.style._layers){const c=this.style._layers[r];c.type==="hillshade"&&c.source===g.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===g.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ts(this.painter,t,g),this.painter.renderToTexture=new we(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var c;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=r.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:g})),this}getTerrain(){var g,t;return(t=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const t in g){const r=g[t]._tiles;for(const c in r){const d=r[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,t,r){if(r){const c=this.getSource(r);if(!c)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);c.calculateTileZoom=Tt(Math.max(1,g),Math.max(1,t))}else for(const c in this.style.sourceCaches)this.style.sourceCaches[c].getSource().calculateTileZoom=Tt(Math.max(1,g),Math.max(1,t));return this._update(!0),this}refreshTiles(g,t){const r=this.style.sourceCaches[g];if(!r)throw new Error(`There is no source cache with ID "${g}", cannot refresh tile`);t===void 0?r.reload(!0):r.refreshTiles(t.map(c=>new o.a3(c.z,c.x,c.y)))}addImage(g,t,r={}){const{pixelRatio:c=1,sdf:d=!1,stretchX:_,stretchY:b,content:M,textFitWidth:T,textFitHeight:I}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||o.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:F,data:O}=t,G=t;return this.style.addImage(g,{data:new o.R({width:R,height:F},new Uint8Array(O)),pixelRatio:c,stretchX:_,stretchY:b,content:M,textFitWidth:T,textFitHeight:I,sdf:d,version:0,userImage:G}),G.onAdd&&G.onAdd(this,g),this}}{const{width:R,height:F,data:O}=D.getImageData(t);this.style.addImage(g,{data:new o.R({width:R,height:F},O),pixelRatio:c,stretchX:_,stretchY:b,content:M,textFitWidth:T,textFitHeight:I,sdf:d,version:0})}}updateImage(g,t){const r=this.style.getImage(g);if(!r)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||o.b(t)?D.getImageData(t):t,{width:d,height:_,data:b}=c;if(d===void 0||_===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==r.data.width||_!==r.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(t instanceof HTMLImageElement||o.b(t));return r.data.replace(b,M),this.style.updateImage(g,r),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return jt.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,t){return this._lazyInitEmptyStyle(),this.style.addLayer(g,t),this._update(!0)}moveLayer(g,t){return this.style.moveLayer(g,t),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,t,r){return this.style.setLayerZoomRange(g,t,r),this._update(!0)}setFilter(g,t,r={}){return this.style.setFilter(g,t,r),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,t,r,c={}){return this.style.setPaintProperty(g,t,r,c),this._update(!0)}getPaintProperty(g,t){return this.style.getPaintProperty(g,t)}setLayoutProperty(g,t,r,c={}){return this.style.setLayoutProperty(g,t,r,c),this._update(!0)}getLayoutProperty(g,t){return this.style.getLayoutProperty(g,t)}setGlyphs(g,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,t,r,c=>{c||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,t,r=>{r||this._update(!0)}),this}setLight(g,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,t){return this.style.setFeatureState(g,t),this._update()}removeFeatureState(g,t){return this.style.removeFeatureState(g,t),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,t=0;return this._container&&(g=this._container.clientWidth||400,t=this._container.clientHeight||300),[g,t]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const t=this._canvasContainer=B.create("div","maplibregl-canvas-container",g);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=B.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),c=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],c);const d=this._controlContainer=B.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=B.create("div",`maplibregl-ctrl-${b} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,t,r){this._canvas.width=Math.floor(r*g),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{t={requestedAttributes:g},c&&(t.statusMessage=c.statusMessage,t.type=c.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!r){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new ss(r,this.transform),$.testSupport(r)}migrateProjection(g,t){super.migrateProjection(g,t),this.painter.transform=g,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var t,r,c,d,_;const b=this._idleTriggered?this._fadeDuration:0,M=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,O=D.now();this.style.zoomHistory.update(F,O);const G=new o.F(F,{now:O,fadeDuration:b,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),q=G.crossFadingFactor();q===1&&q===this._crossFadingFactor||(T=!0,this._crossFadingFactor=q),this.style.update(G)}const I=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==M;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||I)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,I),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cv.mark(o.cw.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const R=this._sourcesDirty||this._styleDirty||this._placementDirty;return R||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,o.cv.mark(o.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),jt.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),B.remove(this._canvasContainer),B.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cv.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,D.frame(this._frameRequest,g=>{o.cv.frame(g),this._frameRequest=null;try{this._render(g)}catch(t){if(!o.cx(t)&&!function(r){return r.message===xh}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return Bh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},m.MapMouseEvent=jr,m.MapTouchEvent=us,m.MapWheelEvent=Eh,m.Marker=Gi,m.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,r)=>{const c=this._map._getUIString(`NavigationControl.${r}`);t.title=c,t.setAttribute("aria-label",c)},this.options=o.e({},Ar,g),this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),B.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),B.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=B.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){B.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,t){const r=B.create("button",g,this._container);return r.type="button",r.addEventListener("click",t),r}},m.Popup=class extends o.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&B.remove(this._content),this._container&&(B.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=B.create("div","maplibregl-popup",this._map.getContainer()),this._tip=B.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ku(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const r=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const d=hl(this.options.offset);if(!c){const b=this._container.offsetWidth,M=this._container.offsetHeight;let T;T=r.y+d.bottom.y<M?["top"]:r.y>this._map.transform.height-M?["bottom"]:[],r.x<b/2?T.push("left"):r.x>this._map.transform.width-b/2&&T.push("right"),c=T.length===0?"bottom":T.join("-")}let _=r.add(d[c]);this.options.subpixelPositioning||(_=_.round()),B.setTransform(this._container,`${Cn[c]} translate(${_.x}px,${_.y}px)`),Li(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(ro),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=o.S.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const t=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=g;c=r.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=B.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=B.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Gh);g&&g.focus()}},m.RasterDEMTileSource=De,m.RasterTileSource=Xe,m.ScaleControl=class{constructor(g){this._onMove=()=>{ll(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ll(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Nh),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){B.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=Cu,m.Style=nh,m.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=B.create("button","maplibregl-ctrl-terrain",this._container),B.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){B.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Rh,m.TwoFingersTouchRotateHandler=Ah,m.TwoFingersTouchZoomHandler=Ss,m.TwoFingersTouchZoomRotateHandler=Lh,m.VectorTileSource=je,m.VideoSource=pi,m.addSourceType=(g,t)=>o._(void 0,void 0,void 0,function*(){if(Ae(g))throw new Error(`A source type called "${g}" already exists.`);((r,c)=>{Ne[r]=c})(g,t)}),m.clearPrewarmedResources=function(){const g=Lt;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Xt),Lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.createTileMesh=ih,m.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return Vi().getRTLTextPluginStatus()},m.getVersion=function(){return jh},m.getWorkerCount=function(){return Dt.workerCount},m.getWorkerUrl=function(){return o.a.WORKER_URL},m.importScriptInWorkers=function(g){return me().broadcast("IS",g)},m.prewarm=function(){de().acquire(Xt)},m.setMaxParallelImageRequests=function(g){o.a.MAX_PARALLEL_IMAGE_REQUESTS=g},m.setRTLTextPlugin=function(g,t){return Vi().setRTLTextPlugin(g,t)},m.setWorkerCount=function(g){Dt.workerCount=g},m.setWorkerUrl=function(g){o.a.WORKER_URL=g}});var x=l;return x})}(yd)),yd.exports}var Tw=Sw();const Pw=lm(Tw);Gd(["click"]);const{LngLatBounds:LC,LngLat:OC}=Pw;Gd(["click","dblclick","contextmenu","mousemove","keydown"]);var Lc=Uint8Array,_y=Uint16Array,Ew=Int32Array,Iw=new Lc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Cw=new Lc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yy=function(a,i){for(var l=new _y(31),u=0;u<31;++u)l[u]=i+=1<<a[u-1];for(var p=new Ew(l[30]),u=1;u<30;++u)for(var x=l[u];x<l[u+1];++x)p[x]=x-l[u]<<5|u;return{b:l,r:p}},vy=yy(Iw,2),Aw=vy.b,Rw=vy.r;Aw[28]=258,Rw[258]=28;yy(Cw,0);var Dw=new _y(32768);for(_i=0;_i<32768;++_i)kn=(_i&43690)>>1|(_i&21845)<<1,kn=(kn&52428)>>2|(kn&13107)<<2,kn=(kn&61680)>>4|(kn&3855)<<4,Dw[_i]=((kn&65280)>>8|(kn&255)<<8)>>1;var kn,_i,Ud=new Lc(288);for(_i=0;_i<144;++_i)Ud[_i]=8;var _i;for(_i=144;_i<256;++_i)Ud[_i]=9;var _i;for(_i=256;_i<280;++_i)Ud[_i]=7;var _i;for(_i=280;_i<288;++_i)Ud[_i]=8;var _i,zw=new Lc(32);for(_i=0;_i<32;++_i)zw[_i]=5;var _i,kw=new Lc(0),Lw=typeof TextDecoder<"u"&&new TextDecoder,Ow=0;try{Lw.decode(kw,{stream:!0}),Ow=1}catch{}Gd(["click"]);function Fw(a,i){return a>i?1:a<i?-1:0}function pm(a,i,l){if(a[0]<=i)return 0;const u=a.length;if(i<=a[u-1])return u-1;if(typeof l=="function"){for(let p=1;p<u;++p){const x=a[p];if(x===i)return p;if(x<i)return l(i,a[p-1],x)>0?p-1:p}return u-1}if(l>0){for(let p=1;p<u;++p)if(a[p]<i)return p-1;return u-1}if(l<0){for(let p=1;p<u;++p)if(a[p]<=i)return p;return u-1}for(let p=1;p<u;++p){if(a[p]==i)return p;if(a[p]<i)return a[p-1]-i<i-a[p]?p-1:p}return u-1}function Bw(a,i){const l=Array.isArray(i)?i:[i],u=l.length;for(let p=0;p<u;p++)a[a.length]=l[p]}function xy(a,i){const l=a.length;if(l!==i.length)return!1;for(let u=0;u<l;u++)if(a[u]!==i[u])return!1;return!0}const wo=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Nw=wo.includes("safari")&&!wo.includes("chrom");Nw&&(wo.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(wo));wo.includes("webkit")&&wo.includes("edge");wo.includes("macintosh");const Gw=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,by=typeof Image<"u"&&Image.prototype.decode,wy=typeof createImageBitmap=="function";(function(){let a=!1;try{const i=Object.defineProperty({},"passive",{get:function(){a=!0}});window.addEventListener("_",null,i),window.removeEventListener("_",null,i)}catch{}return a})();function Mo(a,i,l,u){let p;return l&&l.length?p=l.shift():Gw?p=new OffscreenCanvas(a||300,i||300):p=document.createElement("canvas"),a&&(p.width=a),i&&(p.height=i),p.getContext("2d",u)}let xp;function q_(){return xp||(xp=Mo(1,1)),xp}function My(a){const i=a.canvas;i.width=1,i.height=1,a.clearRect(0,0,1,1)}function ls(a,i,l){return Math.min(Math.max(a,i),l)}function jw(a,i,l,u,p,x){const m=p-l,o=x-u;if(m!==0||o!==0){const P=((a-l)*m+(i-u)*o)/(m*m+o*o);P>1?(l=p,u=x):P>0&&(l+=m*P,u+=o*P)}return Fl(a,i,l,u)}function Fl(a,i,l,u){const p=l-a,x=u-i;return p*p+x*x}function Uw(a){const i=a.length;for(let u=0;u<i;u++){let p=u,x=Math.abs(a[u][u]);for(let o=u+1;o<i;o++){const P=Math.abs(a[o][u]);P>x&&(x=P,p=o)}if(x===0)return null;const m=a[p];a[p]=a[u],a[u]=m;for(let o=u+1;o<i;o++){const P=-a[o][u]/a[u][u];for(let A=u;A<i+1;A++)u==A?a[o][A]=0:a[o][A]+=P*a[u][A]}}const l=new Array(i);for(let u=i-1;u>=0;u--){l[u]=a[u][i]/a[u][u];for(let p=u-1;p>=0;p--)a[p][i]-=a[p][u]*l[u]}return l}function Z_(a){return a*180/Math.PI}function va(a){return a*Math.PI/180}function vc(a,i){const l=a%i;return l*i<0?l+i:l}function Vw(a,i,l){return a+l*(i-a)}function Sy(a,i){const l=Math.pow(10,i);return Math.round(a*l)/l}function hd(a,i){return Math.ceil(Sy(a,i))}function qp(a,i,l){if(a>=i&&a<l)return a;const u=l-i;return((a-i)%u+u)%u+i}const $w=[NaN,NaN,NaN,0];let bp;function qw(){return bp||(bp=Mo(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),bp}const Zw=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Ww=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Xw=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Hw=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function cd(a,i){return a.endsWith("%")?Number(a.substring(0,a.length-1))/i:Number(a)}function xc(a){throw new Error('failed to parse "'+a+'" as color')}function Ty(a){if(a.toLowerCase().startsWith("rgb")){const x=a.match(Ww)||a.match(Zw)||a.match(Xw);if(x){const m=x[4],o=100/255;return[ls(cd(x[1],o)+.5|0,0,255),ls(cd(x[2],o)+.5|0,0,255),ls(cd(x[3],o)+.5|0,0,255),m!==void 0?ls(cd(m,100),0,1):1]}xc(a)}if(a.startsWith("#")){if(Hw.test(a)){const x=a.substring(1),m=x.length<=4?1:2,o=[0,0,0,255];for(let P=0,A=x.length;P<A;P+=m){let L=parseInt(x.substring(P,P+m),16);m===1&&(L+=L<<4),o[P/m]=L}return o[3]=o[3]/255,o}xc(a)}const i=qw();i.fillStyle="#abcdef";let l=i.fillStyle;i.fillStyle=a,i.fillStyle===l&&(i.fillStyle="#fedcba",l=i.fillStyle,i.fillStyle=a,i.fillStyle===l&&xc(a));const u=i.fillStyle;if(u.startsWith("#")||u.startsWith("rgba"))return Ty(u);i.clearRect(0,0,1,1),i.fillRect(0,0,1,1);const p=Array.from(i.getImageData(0,0,1,1).data);return p[3]=Sy(p[3]/255,3),p}const Kw=1024,cc={};let wp=0;function Yw(a){if(a==="none")return $w;if(cc.hasOwnProperty(a))return cc[a];if(wp>=Kw){let l=0;for(const u in cc)(l++&3)===0&&(delete cc[u],--wp)}const i=Ty(a);i.length!==4&&xc(a);for(const l of i)isNaN(l)&&xc(a);return cc[a]=i,++wp,i}function W_(a){return Array.isArray(a)?a:Yw(a)}const kr={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function X_(a){const i=Xl();for(let l=0,u=a.length;l<u;++l)vd(i,a[l]);return i}function Py(a,i,l){let u,p;return i<a[0]?u=a[0]-i:a[2]<i?u=i-a[2]:u=0,l<a[1]?p=a[1]-l:a[3]<l?p=l-a[3]:p=0,u*u+p*p}function Ey(a,i){return Iy(a,i[0],i[1])}function Zp(a,i){return a[0]<=i[0]&&i[2]<=a[2]&&a[1]<=i[1]&&i[3]<=a[3]}function Iy(a,i,l){return a[0]<=i&&i<=a[2]&&a[1]<=l&&l<=a[3]}function H_(a,i){const l=a[0],u=a[1],p=a[2],x=a[3],m=i[0],o=i[1];let P=kr.UNKNOWN;return m<l?P=P|kr.LEFT:m>p&&(P=P|kr.RIGHT),o<u?P=P|kr.BELOW:o>x&&(P=P|kr.ABOVE),P===kr.UNKNOWN&&(P=kr.INTERSECTING),P}function Xl(){return[1/0,1/0,-1/0,-1/0]}function mm(a,i,l,u,p){return p?(p[0]=a,p[1]=i,p[2]=l,p[3]=u,p):[a,i,l,u]}function gm(a){return mm(1/0,1/0,-1/0,-1/0,a)}function Jw(a,i){const l=a[0],u=a[1];return mm(l,u,l,u,i)}function Qw(a,i,l,u,p){const x=gm(p);return Cy(x,a,i,l,u)}function t2(a,i){return a[0]==i[0]&&a[2]==i[2]&&a[1]==i[1]&&a[3]==i[3]}function e2(a,i){return i[0]<a[0]&&(a[0]=i[0]),i[2]>a[2]&&(a[2]=i[2]),i[1]<a[1]&&(a[1]=i[1]),i[3]>a[3]&&(a[3]=i[3]),a}function vd(a,i){i[0]<a[0]&&(a[0]=i[0]),i[0]>a[2]&&(a[2]=i[0]),i[1]<a[1]&&(a[1]=i[1]),i[1]>a[3]&&(a[3]=i[1])}function Cy(a,i,l,u,p){for(;l<u;l+=p)i2(a,i[l],i[l+1]);return a}function i2(a,i,l){a[0]=Math.min(a[0],i),a[1]=Math.min(a[1],l),a[2]=Math.max(a[2],i),a[3]=Math.max(a[3],l)}function r2(a,i){let l;return l=i(_m(a)),l||(l=i(ym(a)),l)||(l=i(vm(a)),l)||(l=i(Vd(a)),l)?l:!1}function s2(a){let i=0;return Oc(a)||(i=vr(a)*Yr(a)),i}function _m(a){return[a[0],a[1]]}function ym(a){return[a[2],a[1]]}function Vl(a){return[(a[0]+a[2])/2,(a[1]+a[3])/2]}function Ay(a,i,l,u,p){const[x,m,o,P,A,L,z,D]=n2(a,i,l,u);return mm(Math.min(x,o,A,z),Math.min(m,P,L,D),Math.max(x,o,A,z),Math.max(m,P,L,D),p)}function n2(a,i,l,u){const p=i*u[0]/2,x=i*u[1]/2,m=Math.cos(l),o=Math.sin(l),P=p*m,A=p*o,L=x*m,z=x*o,D=a[0],B=a[1];return[D-P+z,B-A-L,D-P-z,B-A+L,D+P-z,B+A+L,D+P+z,B+A-L,D-P+z,B-A-L]}function Yr(a){return a[3]-a[1]}function Ry(a,i,l){const u=l||Xl();return Hl(a,i)?(a[0]>i[0]?u[0]=a[0]:u[0]=i[0],a[1]>i[1]?u[1]=a[1]:u[1]=i[1],a[2]<i[2]?u[2]=a[2]:u[2]=i[2],a[3]<i[3]?u[3]=a[3]:u[3]=i[3]):gm(u),u}function Vd(a){return[a[0],a[3]]}function vm(a){return[a[2],a[3]]}function vr(a){return a[2]-a[0]}function Hl(a,i){return a[0]<=i[2]&&a[2]>=i[0]&&a[1]<=i[3]&&a[3]>=i[1]}function Oc(a){return a[2]<a[0]||a[3]<a[1]}function a2(a,i){return i?(i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i):a}function o2(a,i,l){let u=!1;const p=H_(a,i),x=H_(a,l);if(p===kr.INTERSECTING||x===kr.INTERSECTING)u=!0;else{const m=a[0],o=a[1],P=a[2],A=a[3],L=i[0],z=i[1],D=l[0],B=l[1],$=(B-z)/(D-L);let et,it;x&kr.ABOVE&&!(p&kr.ABOVE)&&(et=D-(B-A)/$,u=et>=m&&et<=P),!u&&x&kr.RIGHT&&!(p&kr.RIGHT)&&(it=B-(D-P)*$,u=it>=o&&it<=A),!u&&x&kr.BELOW&&!(p&kr.BELOW)&&(et=D-(B-o)/$,u=et>=m&&et<=P),!u&&x&kr.LEFT&&!(p&kr.LEFT)&&(it=B-(D-m)*$,u=it>=o&&it<=A)}return u}function l2(...a){console.warn(...a)}function h2(a,i){return a[0]+=+i[0],a[1]+=+i[1],a}function Id(a,i){let l=!0;for(let u=a.length-1;u>=0;--u)if(a[u]!=i[u]){l=!1;break}return l}function c2(a,i){const l=Math.cos(i),u=Math.sin(i),p=a[0]*l-a[1]*u,x=a[1]*l+a[0]*u;return a[0]=p,a[1]=x,a}const Dy={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let xm=class{constructor(i){this.code_=i.code,this.units_=i.units,this.extent_=i.extent!==void 0?i.extent:null,this.worldExtent_=i.worldExtent!==void 0?i.worldExtent:null,this.axisOrientation_=i.axisOrientation!==void 0?i.axisOrientation:"enu",this.global_=i.global!==void 0?i.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=i.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=i.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Dy[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(i){this.global_=i,this.canWrapX_=!!(i&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(i){this.defaultTileGrid_=i}setExtent(i){this.extent_=i,this.canWrapX_=!!(this.global_&&i)}setWorldExtent(i){this.worldExtent_=i}setGetPointResolution(i){this.getPointResolutionFunc_=i}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const Fc=6378137,Al=Math.PI*Fc,u2=[-Al,-Al,Al,Al],d2=[-180,-85,180,85],ud=Fc*Math.log(Math.tan(Math.PI/2));class Tl extends xm{constructor(i){super({code:i,units:"m",extent:u2,global:!0,worldExtent:d2,getPointResolution:function(l,u){return l/Math.cosh(u[1]/Fc)}})}}const K_=[new Tl("EPSG:3857"),new Tl("EPSG:102100"),new Tl("EPSG:102113"),new Tl("EPSG:900913"),new Tl("http://www.opengis.net/def/crs/EPSG/0/3857"),new Tl("http://www.opengis.net/gml/srs/epsg.xml#3857")];function f2(a,i,l,u){const p=a.length;l=l>1?l:2,u=u??l,i===void 0&&(l>2?i=a.slice():i=new Array(p));for(let x=0;x<p;x+=u){i[x]=Al*a[x]/180;let m=Fc*Math.log(Math.tan(Math.PI*(+a[x+1]+90)/360));m>ud?m=ud:m<-ud&&(m=-ud),i[x+1]=m}return i}function p2(a,i,l,u){const p=a.length;l=l>1?l:2,u=u??l,i===void 0&&(l>2?i=a.slice():i=new Array(p));for(let x=0;x<p;x+=u)i[x]=180*a[x]/Al,i[x+1]=360*Math.atan(Math.exp(a[x+1]/Fc))/Math.PI-90;return i}const m2=6378137,Y_=[-180,-90,180,90],g2=Math.PI*m2/180;class _o extends xm{constructor(i,l){super({code:i,units:"degrees",extent:Y_,axisOrientation:l,global:!0,metersPerUnit:g2,worldExtent:Y_})}}const J_=[new _o("CRS:84"),new _o("EPSG:4326","neu"),new _o("urn:ogc:def:crs:OGC:1.3:CRS84"),new _o("urn:ogc:def:crs:OGC:2:84"),new _o("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new _o("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new _o("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Wp={};function _2(a){return Wp[a]||Wp[a.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function y2(a,i){Wp[a]=i}function zy(a){for(const i in a)delete a[i]}function v2(a){let i;for(i in a)return!1;return!i}let Bl={};function Ic(a,i,l){const u=a.getCode(),p=i.getCode();u in Bl||(Bl[u]={}),Bl[u][p]=l}function Mp(a,i){return a in Bl&&i in Bl[a]?Bl[a][i]:null}const Cd=.9996,As=.00669438,$d=As*As,qd=$d*As,vo=As/(1-As),Q_=Math.sqrt(1-As),$l=(1-Q_)/(1+Q_),ky=$l*$l,bm=ky*$l,wm=bm*$l,Ly=wm*$l,Oy=1-As/4-3*$d/64-5*qd/256,x2=3*As/8+3*$d/32+45*qd/1024,b2=15*$d/256+45*qd/1024,w2=35*qd/3072,M2=3/2*$l-27/32*bm+269/512*Ly,S2=21/16*ky-55/32*wm,T2=151/96*bm-417/128*Ly,P2=1097/512*wm,Ad=6378137;function E2(a,i,l){const u=a-5e5,m=(l.north?i:i-1e7)/Cd/(Ad*Oy),o=m+M2*Math.sin(2*m)+S2*Math.sin(4*m)+T2*Math.sin(6*m)+P2*Math.sin(8*m),P=Math.sin(o),A=P*P,L=Math.cos(o),z=P/L,D=z*z,B=D*D,$=1-As*A,et=Math.sqrt(1-As*A),it=Ad/et,ft=(1-As)/$,dt=vo*L**2,Ot=dt*dt,jt=u/(it*Cd),Gt=jt*jt,re=Gt*jt,Ie=re*jt,_e=Ie*jt,Re=_e*jt,ri=o-z/ft*(Gt/2-Ie/24*(5+3*D+10*dt-4*Ot-9*vo))+Re/720*(61+90*D+298*dt+45*B-252*vo-3*Ot);let $e=(jt-re/6*(1+2*D+dt)+_e/120*(5-2*dt+28*D-3*Ot+8*vo+24*B))/L;return $e=qp($e+va(Fy(l.number)),-Math.PI,Math.PI),[Z_($e),Z_(ri)]}const t0=-80,e0=84,I2=-180,C2=180;function A2(a,i,l){a=qp(a,I2,C2),i<t0?i=t0:i>e0&&(i=e0);const u=va(i),p=Math.sin(u),x=Math.cos(u),m=p/x,o=m*m,P=o*o,A=va(a),L=Fy(l.number),z=va(L),D=Ad/Math.sqrt(1-As*p**2),B=vo*x**2,$=x*qp(A-z,-Math.PI,Math.PI),et=$*$,it=et*$,ft=it*$,dt=ft*$,Ot=dt*$,jt=Ad*(Oy*u-x2*Math.sin(2*u)+b2*Math.sin(4*u)-w2*Math.sin(6*u)),Gt=Cd*D*($+it/6*(1-o+B)+dt/120*(5-18*o+P+72*B-58*vo))+5e5;let re=Cd*(jt+D*m*(et/2+ft/24*(5-o+9*B+4*B**2)+Ot/720*(61-58*o+P+600*B-330*vo)));return l.north||(re+=1e7),[Gt,re]}function Fy(a){return(a-1)*6-180+3}const R2=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function By(a){let i=0;for(const p of R2){const x=a.match(p);if(x){i=parseInt(x[1]);break}}if(!i)return null;let l=0,u=!1;return i>32700&&i<32761?l=i-32700:i>32600&&i<32661&&(u=!0,l=i-32600),l?{number:l,north:u}:null}function i0(a,i){return function(l,u,p,x){const m=l.length;p=p>1?p:2,x=x??p,u||(p>2?u=l.slice():u=new Array(m));for(let o=0;o<m;o+=x){const P=l[o],A=l[o+1],L=a(P,A,i);u[o]=L[0],u[o+1]=L[1]}return u}}function D2(a){return By(a)?new xm({code:a,units:"m"}):null}function z2(a){const i=By(a.getCode());return i?{forward:i0(A2,i),inverse:i0(E2,i)}:null}const k2=63710088e-1;function r0(a,i,l){l=l||k2;const u=va(a[1]),p=va(i[1]),x=(p-u)/2,m=va(i[0]-a[0])/2,o=Math.sin(x)*Math.sin(x)+Math.sin(m)*Math.sin(m)*Math.cos(u)*Math.cos(p);return 2*l*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}const L2=[z2],O2=[D2];let Xp=!0;function F2(a){Xp=!1}function Mm(a,i){if(i!==void 0){for(let l=0,u=a.length;l<u;++l)i[l]=a[l];i=i}else i=a.slice();return i}function Hp(a){y2(a.getCode(),a),Ic(a,a,Mm)}function B2(a){a.forEach(Hp)}function Xs(a){if(typeof a!="string")return a;const i=_2(a);if(i)return i;for(const l of O2){const u=l(a);if(u)return u}return null}function s0(a,i,l,u){a=Xs(a);let p;const x=a.getPointResolutionFunc();if(x)p=x(i,l);else{const m=a.getUnits();if(m=="degrees"||u=="degrees")p=i;else{const o=Tm(a,Xs("EPSG:4326"));if(!o&&m!=="degrees")p=i*a.getMetersPerUnit();else{let A=[l[0]-i/2,l[1],l[0]+i/2,l[1],l[0],l[1]-i/2,l[0],l[1]+i/2];A=o(A,A,2);const L=r0(A.slice(0,2),A.slice(2,4)),z=r0(A.slice(4,6),A.slice(6,8));p=(L+z)/2}const P=a.getMetersPerUnit();P!==void 0&&(p/=P)}}return p}function n0(a){B2(a),a.forEach(function(i){a.forEach(function(l){i!==l&&Ic(i,l,Mm)})})}function N2(a,i,l,u){a.forEach(function(p){i.forEach(function(x){Ic(p,x,l),Ic(x,p,u)})})}function Sm(a,i){return a?typeof a=="string"?Xs(a):a:Xs(i)}function G2(a){return function(i,l,u,p){const x=i.length;u=u!==void 0?u:2,p=p??u,l=l!==void 0?l:new Array(x);for(let m=0;m<x;m+=p){const o=a(i.slice(m,m+u)),P=o.length;for(let A=0,L=p;A<L;++A)l[m+A]=A>=P?i[m+A]:o[A]}return l}}function a0(a,i){if(a===i)return!0;const l=a.getUnits()===i.getUnits();return(a.getCode()===i.getCode()||Tm(a,i)===Mm)&&l}function Tm(a,i){const l=a.getCode(),u=i.getCode();let p=Mp(l,u);if(p)return p;let x=null,m=null;for(const P of L2)x||(x=P(a)),m||(m=P(i));if(!x&&!m)return null;const o="EPSG:4326";if(m)if(x)p=Sp(x.inverse,m.forward);else{const P=Mp(l,o);P&&(p=Sp(P,m.forward))}else{const P=Mp(o,u);P&&(p=Sp(x.inverse,P))}return p&&(Hp(a),Hp(i),Ic(a,i,p)),p}function Sp(a,i){return function(l,u,p,x){return u=a(l,u,p,x),i(u,u,p,x)}}function Rd(a,i){const l=Xs(a),u=Xs(i);return Tm(l,u)}function Ny(a,i,l){const u=Rd(i,l);if(!u){const p=Xs(i).getCode(),x=Xs(l).getCode();throw new Error(`No transform available between ${p} and ${x}`)}return u(a,void 0,a.length)}function o0(a,i){return a}function ga(a,i){return Xp&&!Id(a,[0,0])&&a[0]>=-180&&a[0]<=180&&a[1]>=-90&&a[1]<=90&&(Xp=!1,l2("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),a}function j2(a,i){return a}function Rl(a,i){return a}function U2(){n0(K_),n0(J_),N2(J_,K_,f2,p2)}U2();function Ln(a,i){if(!a)throw new Error(i)}new Array(6);function xd(){return[1,0,0,1,0,0]}function pn(a,i){const l=i[0],u=i[1];return i[0]=a[0]*l+a[2]*u+a[4],i[1]=a[1]*l+a[3]*u+a[5],i}function Dd(a,i,l,u,p,x,m,o){const P=Math.sin(x),A=Math.cos(x);return a[0]=u*A,a[1]=p*P,a[2]=-u*P,a[3]=p*A,a[4]=m*u*A-o*u*P+i,a[5]=m*p*P+o*p*A+l,a}function V2(a,i){const l=$2(i);Ln(l!==0,"Transformation matrix cannot be inverted");const u=i[0],p=i[1],x=i[2],m=i[3],o=i[4],P=i[5];return a[0]=m/l,a[1]=-p/l,a[2]=-x/l,a[3]=u/l,a[4]=(x*P-m*o)/l,a[5]=-(u*P-p*o)/l,a}function $2(a){return a[0]*a[3]-a[1]*a[2]}const q2=[1e5,1e5,1e5,1e5,2,2];function Z2(a){return"matrix("+a.join(", ")+")"}function l0(a){return a.substring(7,a.length-1).split(",").map(parseFloat)}function W2(a,i){const l=l0(a),u=l0(i);for(let p=0;p<6;++p)if(Math.round((l[p]-u[p])*q2[p])!==0)return!1;return!0}class X2{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Pr(){throw new Error("Unimplemented abstract method.")}let H2=0;function K2(a){return a.ol_uid||(a.ol_uid=String(++H2))}function Y2(a){return Math.pow(a,3)}function J2(a){return 1-Y2(1-a)}function Q2(a){return 3*a*a-2*a*a*a}const ba={CHANGE:"change"};function Kp(){}function tM(a){let i,l,u;return function(){const p=Array.prototype.slice.call(arguments);return(!l||this!==u||!xy(p,l))&&(u=this,l=p,i=a.apply(this,arguments)),i}}function eM(a){function i(){let l;try{l=a()}catch(u){return Promise.reject(u)}return l instanceof Promise?l:Promise.resolve(l)}return i()}class Zd{constructor(i){this.propagationStopped,this.defaultPrevented,this.type=i,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Gy extends X2{constructor(i){super(),this.eventTarget_=i,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(i,l){if(!i||!l)return;const u=this.listeners_||(this.listeners_={}),p=u[i]||(u[i]=[]);p.includes(l)||p.push(l)}dispatchEvent(i){const l=typeof i=="string",u=l?i:i.type,p=this.listeners_&&this.listeners_[u];if(!p)return;const x=l?new Zd(i):i;x.target||(x.target=this.eventTarget_||this);const m=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});u in m||(m[u]=0,o[u]=0),++m[u];let P;for(let A=0,L=p.length;A<L;++A)if("handleEvent"in p[A]?P=p[A].handleEvent(x):P=p[A].call(this,x),P===!1||x.propagationStopped){P=!1;break}if(--m[u]===0){let A=o[u];for(delete o[u];A--;)this.removeEventListener(u,Kp);delete m[u]}return P}disposeInternal(){this.listeners_&&zy(this.listeners_)}getListeners(i){return this.listeners_&&this.listeners_[i]||void 0}hasListener(i){return this.listeners_?i?i in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(i,l){if(!this.listeners_)return;const u=this.listeners_[i];if(!u)return;const p=u.indexOf(l);p!==-1&&(this.pendingRemovals_&&i in this.pendingRemovals_?(u[p]=Kp,++this.pendingRemovals_[i]):(u.splice(p,1),u.length===0&&delete this.listeners_[i]))}}const Ui={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function bo(a,i,l,u,p){if(p){const m=l;l=function(o){return a.removeEventListener(i,l),m.call(u??this,o)}}else u&&u!==a&&(l=l.bind(u));const x={target:a,type:i,listener:l};return a.addEventListener(i,l),x}function h0(a,i,l,u){return bo(a,i,l,u,!0)}function Nl(a){a&&a.target&&(a.target.removeEventListener(a.type,a.listener),zy(a))}class Pm extends Gy{constructor(i,l,u,p){super(),this.extent=i,this.pixelRatio_=u,this.resolution=l,this.state=typeof p=="function"?Ui.IDLE:p,this.image_=null,this.loader=typeof p=="function"?p:null}changed(){this.dispatchEvent(ba.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==Ui.IDLE&&this.loader){this.state=Ui.LOADING,this.changed();const i=this.getResolution(),l=Array.isArray(i)?i[0]:i;eM(()=>this.loader(this.getExtent(),l,this.getPixelRatio())).then(u=>{"image"in u&&(this.image_=u.image),"extent"in u&&(this.extent=u.extent),"resolution"in u&&(this.resolution=u.resolution),"pixelRatio"in u&&(this.pixelRatio_=u.pixelRatio),(u instanceof HTMLImageElement||wy&&u instanceof ImageBitmap||u instanceof HTMLCanvasElement||u instanceof HTMLVideoElement)&&(this.image_=u),this.state=Ui.LOADED}).catch(u=>{this.state=Ui.ERROR,console.error(u)}).finally(()=>this.changed())}}setImage(i){this.image_=i}setResolution(i){this.resolution=i}}function iM(a,i){return new Promise((l,u)=>{function p(){m(),l(a)}function x(){m(),u(new Error("Image load error"))}function m(){a.removeEventListener("load",p),a.removeEventListener("error",x)}a.addEventListener("load",p),a.addEventListener("error",x)})}function rM(a,i){return a.src&&by?new Promise((l,u)=>a.decode().then(()=>l(a)).catch(p=>a.complete&&a.width?l(a):u(p))):iM(a)}function jy(a,i){return i&&(a.src=i),a.src&&by&&wy?a.decode().then(()=>createImageBitmap(a)).catch(l=>{if(a.complete&&a.width)return a;throw l}):rM(a)}let Tp;const bc=[];function c0(a,i,l,u,p){a.beginPath(),a.moveTo(0,0),a.lineTo(i,l),a.lineTo(u,p),a.closePath(),a.save(),a.clip(),a.fillRect(0,0,Math.max(i,u)+1,Math.max(l,p)),a.restore()}function Pp(a,i){return Math.abs(a[i*4]-210)>2||Math.abs(a[i*4+3]-.75*255)>2}function sM(){if(Tp===void 0){const a=Mo(6,6,bc);a.globalCompositeOperation="lighter",a.fillStyle="rgba(210, 0, 0, 0.75)",c0(a,4,5,4,0),c0(a,4,5,0,5);const i=a.getImageData(0,0,3,3).data;Tp=Pp(i,0)||Pp(i,4)||Pp(i,8),My(a),bc.push(a.canvas)}return Tp}function nM(a,i,l,u){const p=Ny(l,i,a);let x=s0(i,u,l);const m=i.getMetersPerUnit();m!==void 0&&(x*=m);const o=a.getMetersPerUnit();o!==void 0&&(x/=o);const P=a.getExtent();if(!P||Ey(P,p)){const A=s0(a,x,p)/x;isFinite(A)&&A>0&&(x/=A)}return x}function aM(a,i,l,u,p,x,m,o,P,A,L,z,D,B){const $=Mo(Math.round(l*a),Math.round(l*i),bc);if(z||($.imageSmoothingEnabled=!1),P.length===0)return $.canvas;$.scale(l,l);function et(Gt){return Math.round(Gt*l)/l}$.globalCompositeOperation="lighter";const it=Xl();P.forEach(function(Gt,re,Ie){e2(it,Gt.extent)});let ft;const dt=l/u,Ot=(z?1:1+Math.pow(2,-24))/dt;(P.length!==1||A!==0)&&(ft=Mo(Math.round(vr(it)*dt),Math.round(Yr(it)*dt),bc),z||(ft.imageSmoothingEnabled=!1),P.forEach(function(Gt,re,Ie){if(Gt.image.width>0&&Gt.image.height>0){if(Gt.clipExtent){ft.save();const oi=(Gt.clipExtent[0]-it[0])*dt,Qe=-(Gt.clipExtent[3]-it[3])*dt,wi=vr(Gt.clipExtent)*dt,li=Yr(Gt.clipExtent)*dt;ft.rect(z?oi:Math.round(oi),z?Qe:Math.round(Qe),z?wi:Math.round(oi+wi)-Math.round(oi),z?li:Math.round(Qe+li)-Math.round(Qe)),ft.clip()}const _e=(Gt.extent[0]-it[0])*dt,Re=-(Gt.extent[3]-it[3])*dt,ri=vr(Gt.extent)*dt,$e=Yr(Gt.extent)*dt;ft.drawImage(Gt.image,A,A,Gt.image.width-2*A,Gt.image.height-2*A,z?_e:Math.round(_e),z?Re:Math.round(Re),z?ri:Math.round(_e+ri)-Math.round(_e),z?$e:Math.round(Re+$e)-Math.round(Re)),Gt.clipExtent&&ft.restore()}}));const jt=Vd(m);return o.getTriangles().forEach(function(Gt,re,Ie){const _e=Gt.source,Re=Gt.target;let ri=_e[0][0],$e=_e[0][1],oi=_e[1][0],Qe=_e[1][1],wi=_e[2][0],li=_e[2][1];const Ii=et((Re[0][0]-jt[0])/x),Ri=et(-(Re[0][1]-jt[1])/x),Nt=et((Re[1][0]-jt[0])/x),qt=et(-(Re[1][1]-jt[1])/x),Xt=et((Re[2][0]-jt[0])/x),Dt=et(-(Re[2][1]-jt[1])/x),Mt=ri,Lt=$e;ri=0,$e=0,oi-=Mt,Qe-=Lt,wi-=Mt,li-=Lt;const ee=[[oi,Qe,0,0,Nt-Ii],[wi,li,0,0,Xt-Ii],[0,0,oi,Qe,qt-Ri],[0,0,wi,li,Dt-Ri]],de=Uw(ee);if(!de)return;if($.save(),$.beginPath(),sM()||!z){$.moveTo(Nt,qt);const me=4,Ge=Ii-Nt,ae=Ri-qt;for(let Se=0;Se<me;Se++)$.lineTo(Nt+et((Se+1)*Ge/me),qt+et(Se*ae/(me-1))),Se!=me-1&&$.lineTo(Nt+et((Se+1)*Ge/me),qt+et((Se+1)*ae/(me-1)));$.lineTo(Xt,Dt)}else $.moveTo(Nt,qt),$.lineTo(Ii,Ri),$.lineTo(Xt,Dt);$.clip(),$.transform(de[0],de[2],de[1],de[3],Ii,Ri),$.translate(it[0]-Mt,it[3]-Lt);let Ee;if(ft)Ee=ft.canvas,$.scale(Ot,-Ot);else{const me=P[0],Ge=me.extent;Ee=me.image,$.scale(vr(Ge)/Ee.width,-Yr(Ge)/Ee.height)}$.drawImage(Ee,0,0),$.restore()}),ft&&(My(ft),bc.push(ft.canvas)),$.canvas}const oM=10,u0=.25;class lM{constructor(i,l,u,p,x,m,o){this.sourceProj_=i,this.targetProj_=l;let P={};const A=o?G2(Ot=>pn(o,Ny(Ot,this.targetProj_,this.sourceProj_))):Rd(this.targetProj_,this.sourceProj_);this.transformInv_=function(Ot){const jt=Ot[0]+"/"+Ot[1];return P[jt]||(P[jt]=A(Ot)),P[jt]},this.maxSourceExtent_=p,this.errorThresholdSquared_=x*x,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!p&&!!this.sourceProj_.getExtent()&&vr(p)>=vr(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?vr(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?vr(this.targetProj_.getExtent()):null;const L=Vd(u),z=vm(u),D=ym(u),B=_m(u),$=this.transformInv_(L),et=this.transformInv_(z),it=this.transformInv_(D),ft=this.transformInv_(B),dt=oM+(m?Math.max(0,Math.ceil(Math.log2(s2(u)/(m*m*256*256)))):0);if(this.addQuad_(L,z,D,B,$,et,it,ft,dt),this.wrapsXInSource_){let Ot=1/0;this.triangles_.forEach(function(jt,Gt,re){Ot=Math.min(Ot,jt.source[0][0],jt.source[1][0],jt.source[2][0])}),this.triangles_.forEach(jt=>{if(Math.max(jt.source[0][0],jt.source[1][0],jt.source[2][0])-Ot>this.sourceWorldWidth_/2){const Gt=[[jt.source[0][0],jt.source[0][1]],[jt.source[1][0],jt.source[1][1]],[jt.source[2][0],jt.source[2][1]]];Gt[0][0]-Ot>this.sourceWorldWidth_/2&&(Gt[0][0]-=this.sourceWorldWidth_),Gt[1][0]-Ot>this.sourceWorldWidth_/2&&(Gt[1][0]-=this.sourceWorldWidth_),Gt[2][0]-Ot>this.sourceWorldWidth_/2&&(Gt[2][0]-=this.sourceWorldWidth_);const re=Math.min(Gt[0][0],Gt[1][0],Gt[2][0]);Math.max(Gt[0][0],Gt[1][0],Gt[2][0])-re<this.sourceWorldWidth_/2&&(jt.source=Gt)}})}P={}}addTriangle_(i,l,u,p,x,m){this.triangles_.push({source:[p,x,m],target:[i,l,u]})}addQuad_(i,l,u,p,x,m,o,P,A){const L=X_([x,m,o,P]),z=this.sourceWorldWidth_?vr(L)/this.sourceWorldWidth_:null,D=this.sourceWorldWidth_,B=this.sourceProj_.canWrapX()&&z>.5&&z<1;let $=!1;if(A>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const it=X_([i,l,u,p]);$=vr(it)/this.targetWorldWidth_>u0||$}!B&&this.sourceProj_.isGlobal()&&z&&($=z>u0||$)}if(!$&&this.maxSourceExtent_&&isFinite(L[0])&&isFinite(L[1])&&isFinite(L[2])&&isFinite(L[3])&&!Hl(L,this.maxSourceExtent_))return;let et=0;if(!$&&(!isFinite(x[0])||!isFinite(x[1])||!isFinite(m[0])||!isFinite(m[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(P[0])||!isFinite(P[1]))){if(A>0)$=!0;else if(et=(!isFinite(x[0])||!isFinite(x[1])?8:0)+(!isFinite(m[0])||!isFinite(m[1])?4:0)+(!isFinite(o[0])||!isFinite(o[1])?2:0)+(!isFinite(P[0])||!isFinite(P[1])?1:0),et!=1&&et!=2&&et!=4&&et!=8)return}if(A>0){if(!$){const it=[(i[0]+u[0])/2,(i[1]+u[1])/2],ft=this.transformInv_(it);let dt;B?dt=(vc(x[0],D)+vc(o[0],D))/2-vc(ft[0],D):dt=(x[0]+o[0])/2-ft[0];const Ot=(x[1]+o[1])/2-ft[1];$=dt*dt+Ot*Ot>this.errorThresholdSquared_}if($){if(Math.abs(i[0]-u[0])<=Math.abs(i[1]-u[1])){const it=[(l[0]+u[0])/2,(l[1]+u[1])/2],ft=this.transformInv_(it),dt=[(p[0]+i[0])/2,(p[1]+i[1])/2],Ot=this.transformInv_(dt);this.addQuad_(i,l,it,dt,x,m,ft,Ot,A-1),this.addQuad_(dt,it,u,p,Ot,ft,o,P,A-1)}else{const it=[(i[0]+l[0])/2,(i[1]+l[1])/2],ft=this.transformInv_(it),dt=[(u[0]+p[0])/2,(u[1]+p[1])/2],Ot=this.transformInv_(dt);this.addQuad_(i,it,dt,p,x,ft,Ot,P,A-1),this.addQuad_(it,l,u,dt,ft,m,o,Ot,A-1)}return}}if(B){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(et&11)==0&&this.addTriangle_(i,u,p,x,o,P),(et&14)==0&&this.addTriangle_(i,u,l,x,o,m),et&&((et&13)==0&&this.addTriangle_(l,p,i,m,P,x),(et&7)==0&&this.addTriangle_(l,p,u,m,P,o))}calculateSourceExtent(){const i=Xl();return this.triangles_.forEach(function(l,u,p){const x=l.source;vd(i,x[0]),vd(i,x[1]),vd(i,x[2])}),i}getTriangles(){return this.triangles_}}const hM=.5,Si={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class cM extends Zd{constructor(i,l,u,p){super(i),this.inversePixelTransform=l,this.frameState=u,this.context=p}}const dc={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose"};class Uy extends Gy{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ba.CHANGE)}getRevision(){return this.revision_}onInternal(i,l){if(Array.isArray(i)){const u=i.length,p=new Array(u);for(let x=0;x<u;++x)p[x]=bo(this,i[x],l);return p}return bo(this,i,l)}onceInternal(i,l){let u;if(Array.isArray(i)){const p=i.length;u=new Array(p);for(let x=0;x<p;++x)u[x]=h0(this,i[x],l)}else u=h0(this,i,l);return l.ol_key=u,u}unInternal(i,l){const u=l.ol_key;if(u)uM(u);else if(Array.isArray(i))for(let p=0,x=i.length;p<x;++p)this.removeEventListener(i[p],l);else this.removeEventListener(i,l)}}function uM(a){if(Array.isArray(a))for(let i=0,l=a.length;i<l;++i)Nl(a[i]);else Nl(a)}const dM=5;class fM extends Uy{constructor(i){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=i,this.staleKeys_=new Array,this.maxStaleKeys=dM}getStaleKeys(){return this.staleKeys_}prependStaleKey(i){this.staleKeys_.unshift(i),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(i){return Pr()}getData(i){return null}prepareFrame(i){return Pr()}renderFrame(i,l){return Pr()}forEachFeatureAtCoordinate(i,l,u,p,x){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(i){const l=i.target;(l.getState()===Ui.LOADED||l.getState()===Ui.ERROR)&&this.renderIfReadyAndVisible()}loadImage(i){let l=i.getState();return l!=Ui.LOADED&&l!=Ui.ERROR&&i.addEventListener(ba.CHANGE,this.boundHandleImageChange_),l==Ui.IDLE&&(i.load(),l=i.getState()),l==Ui.LOADED}renderIfReadyAndVisible(){const i=this.getLayer();i&&i.getVisible()&&i.getSourceState()==="ready"&&i.changed()}renderDeferred(i){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const pM={PROPERTYCHANGE:"propertychange"};class d0 extends Zd{constructor(i,l,u){super(i),this.key=l,this.oldValue=u}}class Wd extends Uy{constructor(i){super(),this.on,this.once,this.un,K2(this),this.values_=null,i!==void 0&&this.setProperties(i)}get(i){let l;return this.values_&&this.values_.hasOwnProperty(i)&&(l=this.values_[i]),l}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(i,l){let u;u=`change:${i}`,this.hasListener(u)&&this.dispatchEvent(new d0(u,i,l)),u=pM.PROPERTYCHANGE,this.hasListener(u)&&this.dispatchEvent(new d0(u,i,l))}addChangeListener(i,l){this.addEventListener(`change:${i}`,l)}removeChangeListener(i,l){this.removeEventListener(`change:${i}`,l)}set(i,l,u){const p=this.values_||(this.values_={});if(u)p[i]=l;else{const x=p[i];p[i]=l,x!==l&&this.notify(i,x)}}setProperties(i,l){for(const u in i)this.set(u,i[u],l)}applyProperties(i){i.values_&&Object.assign(this.values_||(this.values_={}),i.values_)}unset(i,l){if(this.values_&&i in this.values_){const u=this.values_[i];delete this.values_[i],v2(this.values_)&&(this.values_=null),l||this.notify(i,u)}}}const mn={ANIMATING:0,INTERACTING:1},qs={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function f0(a,i,l){return function(u,p,x,m,o){if(!u)return;if(!p&&!i)return u;const P=i?0:x[0]*p,A=i?0:x[1]*p,L=o?o[0]:0,z=o?o[1]:0;let D=a[0]+P/2+L,B=a[2]-P/2+L,$=a[1]+A/2+z,et=a[3]-A/2+z;D>B&&(D=(B+D)/2,B=D),$>et&&($=(et+$)/2,et=$);let it=ls(u[0],D,B),ft=ls(u[1],$,et);if(m&&l&&p){const dt=30*p;it+=-dt*Math.log(1+Math.max(0,D-u[0])/dt)+dt*Math.log(1+Math.max(0,u[0]-B)/dt),ft+=-dt*Math.log(1+Math.max(0,$-u[1])/dt)+dt*Math.log(1+Math.max(0,u[1]-et)/dt)}return[it,ft]}}function mM(a){return a}function gM(a,i,l,u,p,x,m){x=x||[],m=m||2;let o=0;for(let P=i;P<l;P+=u){const A=a[P],L=a[P+1];x[o++]=p[0]*A+p[2]*L+p[4],x[o++]=p[1]*A+p[3]*L+p[5];for(let z=2;z<m;z++)x[o++]=a[P+z]}return x&&x.length!=o&&(x.length=o),x}function _M(a,i,l,u,p,x,m){m=m||[];const o=Math.cos(p),P=Math.sin(p),A=x[0],L=x[1];let z=0;for(let D=i;D<l;D+=u){const B=a[D]-A,$=a[D+1]-L;m[z++]=A+B*o-$*P,m[z++]=L+B*P+$*o;for(let et=D+2;et<D+u;++et)m[z++]=a[et]}return m&&m.length!=z&&(m.length=z),m}function yM(a,i,l,u,p,x,m,o){o=o||[];const P=m[0],A=m[1];let L=0;for(let z=i;z<l;z+=u){const D=a[z]-P,B=a[z+1]-A;o[L++]=P+p*D,o[L++]=A+x*B;for(let $=z+2;$<z+u;++$)o[L++]=a[$]}return o&&o.length!=L&&(o.length=L),o}function vM(a,i,l,u,p,x,m){m=m||[];let o=0;for(let P=i;P<l;P+=u){m[o++]=a[P]+p,m[o++]=a[P+1]+x;for(let A=P+2;A<P+u;++A)m[o++]=a[A]}return m&&m.length!=o&&(m.length=o),m}const p0=xd(),xM=[NaN,NaN];class bM extends Wd{constructor(){super(),this.extent_=Xl(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=tM((i,l,u)=>{if(!u)return this.getSimplifiedGeometry(l);const p=this.clone();return p.applyTransform(u),p.getSimplifiedGeometry(l)})}simplifyTransformed(i,l){return this.simplifyTransformedInternal(this.getRevision(),i,l)}clone(){return Pr()}closestPointXY(i,l,u,p){return Pr()}containsXY(i,l){return this.closestPointXY(i,l,xM,Number.MIN_VALUE)===0}getClosestPoint(i,l){return l=l||[NaN,NaN],this.closestPointXY(i[0],i[1],l,1/0),l}intersectsCoordinate(i){return this.containsXY(i[0],i[1])}computeExtent(i){return Pr()}getExtent(i){if(this.extentRevision_!=this.getRevision()){const l=this.computeExtent(this.extent_);(isNaN(l[0])||isNaN(l[1]))&&gm(l),this.extentRevision_=this.getRevision()}return a2(this.extent_,i)}rotate(i,l){Pr()}scale(i,l,u){Pr()}simplify(i){return this.getSimplifiedGeometry(i*i)}getSimplifiedGeometry(i){return Pr()}getType(){return Pr()}applyTransform(i){Pr()}intersectsExtent(i){return Pr()}translate(i,l){Pr()}transform(i,l){const u=Xs(i),p=u.getUnits()=="tile-pixels"?function(x,m,o){const P=u.getExtent(),A=u.getWorldExtent(),L=Yr(A)/Yr(P);Dd(p0,A[0],A[3],L,-L,0,0,0);const z=gM(x,0,x.length,o,p0,m),D=Rd(u,l);return D?D(z,z,o):z}:Rd(u,l);return this.applyTransform(p),this}}class Em extends bM{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(i){return Qw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i)}getCoordinates(){return Pr()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(i){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),i<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&i<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const l=this.getSimplifiedGeometryInternal(i);return l.getFlatCoordinates().length<this.flatCoordinates.length?l:(this.simplifiedGeometryMaxMinSquaredTolerance=i,this)}getSimplifiedGeometryInternal(i){return this}getStride(){return this.stride}setFlatCoordinates(i,l){this.stride=m0(i),this.layout=i,this.flatCoordinates=l}setCoordinates(i,l){Pr()}setLayout(i,l,u){let p;if(i)p=m0(i);else{for(let x=0;x<u;++x){if(l.length===0){this.layout="XY",this.stride=2;return}l=l[0]}p=l.length,i=wM(p)}this.layout=i,this.stride=p}applyTransform(i){this.flatCoordinates&&(i(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(i,l){const u=this.getFlatCoordinates();if(u){const p=this.getStride();_M(u,0,u.length,p,i,l,u),this.changed()}}scale(i,l,u){l===void 0&&(l=i),u||(u=Vl(this.getExtent()));const p=this.getFlatCoordinates();if(p){const x=this.getStride();yM(p,0,p.length,x,i,l,u,p),this.changed()}}translate(i,l){const u=this.getFlatCoordinates();if(u){const p=this.getStride();vM(u,0,u.length,p,i,l,u),this.changed()}}}function wM(a){let i;return a==2?i="XY":a==3?i="XYZ":a==4&&(i="XYZM"),i}function m0(a){let i;return a=="XY"?i=2:a=="XYZ"||a=="XYM"?i=3:a=="XYZM"&&(i=4),i}function Vy(a,i,l,u){let p=0;const x=a[l-u],m=a[l-u+1];let o=0,P=0;for(;i<l;i+=u){const A=a[i]-x,L=a[i+1]-m;p+=P*A-o*L,o=A,P=L}return p/2}function MM(a,i,l,u){let p=0;for(let x=0,m=l.length;x<m;++x){const o=l[x];p+=Vy(a,i,o,u),i=o}return p}function g0(a,i,l,u,p,x,m){const o=a[i],P=a[i+1],A=a[l]-o,L=a[l+1]-P;let z;if(A===0&&L===0)z=i;else{const D=((p-o)*A+(x-P)*L)/(A*A+L*L);if(D>1)z=l;else if(D>0){for(let B=0;B<u;++B)m[B]=Vw(a[i+B],a[l+B],D);m.length=u;return}else z=i}for(let D=0;D<u;++D)m[D]=a[z+D];m.length=u}function $y(a,i,l,u,p){let x=a[i],m=a[i+1];for(i+=u;i<l;i+=u){const o=a[i],P=a[i+1],A=Fl(x,m,o,P);A>p&&(p=A),x=o,m=P}return p}function SM(a,i,l,u,p){for(let x=0,m=l.length;x<m;++x){const o=l[x];p=$y(a,i,o,u,p),i=o}return p}function qy(a,i,l,u,p,x,m,o,P,A,L){if(i==l)return A;let z,D;if(p===0){if(D=Fl(m,o,a[i],a[i+1]),D<A){for(z=0;z<u;++z)P[z]=a[i+z];return P.length=u,D}return A}L=L||[NaN,NaN];let B=i+u;for(;B<l;)if(g0(a,B-u,B,u,m,o,L),D=Fl(m,o,L[0],L[1]),D<A){for(A=D,z=0;z<u;++z)P[z]=L[z];P.length=u,B+=u}else B+=u*Math.max((Math.sqrt(D)-Math.sqrt(A))/p|0,1);if(g0(a,l-u,i,u,m,o,L),D=Fl(m,o,L[0],L[1]),D<A){for(A=D,z=0;z<u;++z)P[z]=L[z];P.length=u}return A}function TM(a,i,l,u,p,x,m,o,P,A,L){L=L||[NaN,NaN];for(let z=0,D=l.length;z<D;++z){const B=l[z];A=qy(a,i,B,u,p,x,m,o,P,A,L),i=B}return A}function PM(a,i,l,u){for(let p=0,x=l.length;p<x;++p)a[i++]=l[p];return i}function Zy(a,i,l,u){for(let p=0,x=l.length;p<x;++p){const m=l[p];for(let o=0;o<u;++o)a[i++]=m[o]}return i}function EM(a,i,l,u,p){p=p||[];let x=0;for(let m=0,o=l.length;m<o;++m){const P=Zy(a,i,l[m],u);p[x++]=P,i=P}return p.length=x,p}function Wy(a,i,l,u,p){p=p!==void 0?p:[];let x=0;for(let m=i;m<l;m+=u)p[x++]=a.slice(m,m+u);return p.length=x,p}function IM(a,i,l,u,p){p=p!==void 0?p:[];let x=0;for(let m=0,o=l.length;m<o;++m){const P=l[m];p[x++]=Wy(a,i,P,u,p[x]),i=P}return p.length=x,p}function CM(a,i,l,u,p,x,m){const o=(l-i)/u;if(o<3){for(;i<l;i+=u)x[m++]=a[i],x[m++]=a[i+1];return m}const P=new Array(o);P[0]=1,P[o-1]=1;const A=[i,l-u];let L=0;for(;A.length>0;){const z=A.pop(),D=A.pop();let B=0;const $=a[D],et=a[D+1],it=a[z],ft=a[z+1];for(let dt=D+u;dt<z;dt+=u){const Ot=a[dt],jt=a[dt+1],Gt=jw(Ot,jt,$,et,it,ft);Gt>B&&(L=dt,B=Gt)}B>p&&(P[(L-i)/u]=1,D+u<L&&A.push(D,L),L+u<z&&A.push(L,z))}for(let z=0;z<o;++z)P[z]&&(x[m++]=a[i+z*u],x[m++]=a[i+z*u+1]);return m}function Pl(a,i){return i*Math.round(a/i)}function AM(a,i,l,u,p,x,m){if(i==l)return m;let o=Pl(a[i],p),P=Pl(a[i+1],p);i+=u,x[m++]=o,x[m++]=P;let A,L;do if(A=Pl(a[i],p),L=Pl(a[i+1],p),i+=u,i==l)return x[m++]=A,x[m++]=L,m;while(A==o&&L==P);for(;i<l;){const z=Pl(a[i],p),D=Pl(a[i+1],p);if(i+=u,z==A&&D==L)continue;const B=A-o,$=L-P,et=z-o,it=D-P;if(B*it==$*et&&(B<0&&et<B||B==et||B>0&&et>B)&&($<0&&it<$||$==it||$>0&&it>$)){A=z,L=D;continue}x[m++]=A,x[m++]=L,o=A,P=L,A=z,L=D}return x[m++]=A,x[m++]=L,m}function RM(a,i,l,u,p,x,m,o){for(let P=0,A=l.length;P<A;++P){const L=l[P];m=AM(a,i,L,u,p,x,m),o.push(m),i=L}return m}class Cc extends Em{constructor(i,l){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,l!==void 0&&!Array.isArray(i[0])?this.setFlatCoordinates(l,i):this.setCoordinates(i,l)}clone(){return new Cc(this.flatCoordinates.slice(),this.layout)}closestPointXY(i,l,u,p){return p<Py(this.getExtent(),i,l)?p:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($y(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),qy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,i,l,u,p))}getArea(){return Vy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Wy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(i){const l=[];return l.length=CM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i,l,0),new Cc(l,"XY")}getType(){return"LinearRing"}intersectsExtent(i){return!1}setCoordinates(i,l){this.setLayout(l,i,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Zy(this.flatCoordinates,0,i,this.stride),this.changed()}}let DM=class Xy extends Em{constructor(i,l){super(),this.setCoordinates(i,l)}clone(){const i=new Xy(this.flatCoordinates.slice(),this.layout);return i.applyProperties(this),i}closestPointXY(i,l,u,p){const x=this.flatCoordinates,m=Fl(i,l,x[0],x[1]);if(m<p){const o=this.stride;for(let P=0;P<o;++P)u[P]=x[P];return u.length=o,m}return p}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(i){return Jw(this.flatCoordinates,i)}getType(){return"Point"}intersectsExtent(i){return Iy(i,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(i,l){this.setLayout(l,i,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=PM(this.flatCoordinates,0,i,this.stride),this.changed()}};function zM(a,i,l,u,p){return!r2(p,function(m){return!xo(a,i,l,u,m[0],m[1])})}function xo(a,i,l,u,p,x){let m=0,o=a[l-u],P=a[l-u+1];for(;i<l;i+=u){const A=a[i],L=a[i+1];P<=x?L>x&&(A-o)*(x-P)-(p-o)*(L-P)>0&&m++:L<=x&&(A-o)*(x-P)-(p-o)*(L-P)<0&&m--,o=A,P=L}return m!==0}function Hy(a,i,l,u,p,x){if(l.length===0||!xo(a,i,l[0],u,p,x))return!1;for(let m=1,o=l.length;m<o;++m)if(xo(a,l[m-1],l[m],u,p,x))return!1;return!0}function kM(a,i,l,u,p,x,m){let o,P,A,L,z,D,B;const $=p[x+1],et=[];for(let dt=0,Ot=l.length;dt<Ot;++dt){const jt=l[dt];for(L=a[jt-u],D=a[jt-u+1],o=i;o<jt;o+=u)z=a[o],B=a[o+1],($<=D&&B<=$||D<=$&&$<=B)&&(A=($-D)/(B-D)*(z-L)+L,et.push(A)),L=z,D=B}let it=NaN,ft=-1/0;for(et.sort(Fw),L=et[0],o=1,P=et.length;o<P;++o){z=et[o];const dt=Math.abs(z-L);dt>ft&&(A=(L+z)/2,Hy(a,i,l,u,A,$)&&(it=A,ft=dt)),L=z}return isNaN(it)&&(it=p[x]),[it,$,ft]}function LM(a,i,l,u,p){let x;for(i+=u;i<l;i+=u)if(x=p(a.slice(i-u,i),a.slice(i,i+u)),x)return x;return!1}function Ky(a,i,l,u,p,x){return x=x??Cy(Xl(),a,i,l,u),Hl(p,x)?x[0]>=p[0]&&x[2]<=p[2]||x[1]>=p[1]&&x[3]<=p[3]?!0:LM(a,i,l,u,function(m,o){return o2(p,m,o)}):!1}function OM(a,i,l,u,p){return!!(Ky(a,i,l,u,p)||xo(a,i,l,u,p[0],p[1])||xo(a,i,l,u,p[0],p[3])||xo(a,i,l,u,p[2],p[1])||xo(a,i,l,u,p[2],p[3]))}function FM(a,i,l,u,p){if(!OM(a,i,l[0],u,p))return!1;if(l.length===1)return!0;for(let x=1,m=l.length;x<m;++x)if(zM(a,l[x-1],l[x],u,p)&&!Ky(a,l[x-1],l[x],u,p))return!1;return!0}function BM(a,i,l,u){for(;i<l-u;){for(let p=0;p<u;++p){const x=a[i+p];a[i+p]=a[l-u+p],a[l-u+p]=x}i+=u,l-=u}}function Yy(a,i,l,u){let p=0,x=a[l-u],m=a[l-u+1];for(;i<l;i+=u){const o=a[i],P=a[i+1];p+=(o-x)*(P+m),x=o,m=P}return p===0?void 0:p>0}function NM(a,i,l,u,p){p=p!==void 0?p:!1;for(let x=0,m=l.length;x<m;++x){const o=l[x],P=Yy(a,i,o,u);if(x===0){if(p&&P||!p&&!P)return!1}else if(p&&!P||!p&&P)return!1;i=o}return!0}function _0(a,i,l,u,p){p=p!==void 0?p:!1;for(let x=0,m=l.length;x<m;++x){const o=l[x],P=Yy(a,i,o,u);(x===0?p&&P||!p&&!P:p&&!P||!p&&P)&&BM(a,i,o,u),i=o}return i}class zd extends Em{constructor(i,l,u){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,l!==void 0&&u?(this.setFlatCoordinates(l,i),this.ends_=u):this.setCoordinates(i,l)}appendLinearRing(i){this.flatCoordinates?Bw(this.flatCoordinates,i.getFlatCoordinates()):this.flatCoordinates=i.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const i=new zd(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return i.applyProperties(this),i}closestPointXY(i,l,u,p){return p<Py(this.getExtent(),i,l)?p:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(SM(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),TM(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,i,l,u,p))}containsXY(i,l){return Hy(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,i,l)}getArea(){return MM(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(i){let l;return i!==void 0?(l=this.getOrientedFlatCoordinates().slice(),_0(l,0,this.ends_,this.stride,i)):l=this.flatCoordinates,IM(l,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const i=Vl(this.getExtent());this.flatInteriorPoint_=kM(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,i,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new DM(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(i){return i<0||this.ends_.length<=i?null:new Cc(this.flatCoordinates.slice(i===0?0:this.ends_[i-1],this.ends_[i]),this.layout)}getLinearRings(){const i=this.layout,l=this.flatCoordinates,u=this.ends_,p=[];let x=0;for(let m=0,o=u.length;m<o;++m){const P=u[m],A=new Cc(l.slice(x,P),i);p.push(A),x=P}return p}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const i=this.flatCoordinates;NM(i,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=i:(this.orientedFlatCoordinates_=i.slice(),this.orientedFlatCoordinates_.length=_0(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(i){const l=[],u=[];return l.length=RM(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(i),l,0,u),new zd(l,"XY",u)}getType(){return"Polygon"}intersectsExtent(i){return FM(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,i)}setCoordinates(i,l){this.setLayout(l,i,2),this.flatCoordinates||(this.flatCoordinates=[]);const u=EM(this.flatCoordinates,0,i,this.stride,this.ends_);this.flatCoordinates.length=u.length===0?0:u[u.length-1],this.changed()}}function y0(a){if(Oc(a))throw new Error("Cannot create polygon from empty extent");const i=a[0],l=a[1],u=a[2],p=a[3],x=[i,l,i,p,u,p,u,l,i,l];return new zd(x,"XY",[x.length])}function Im(a,i,l,u){const p=vr(i)/l[0],x=Yr(i)/l[1];return u?Math.min(a,Math.max(p,x)):Math.min(a,Math.min(p,x))}function Cm(a,i,l){let u=Math.min(a,i);const p=50;return u*=Math.log(1+p*Math.max(0,a/i-1))/p+1,l&&(u=Math.max(u,l),u/=Math.log(1+p*Math.max(0,l/a-1))/p+1),ls(u,l/2,i*2)}function GM(a,i,l,u){return i=i!==void 0?i:!0,function(p,x,m,o){if(p!==void 0){const P=a[0],A=a[a.length-1],L=l?Im(P,l,m,u):P;if(o)return i?Cm(p,L,A):ls(p,A,L);const z=Math.min(L,p),D=Math.floor(pm(a,z,x));return a[D]>L&&D<a.length-1?a[D+1]:a[D]}}}function jM(a,i,l,u,p,x){return u=u!==void 0?u:!0,l=l!==void 0?l:0,function(m,o,P,A){if(m!==void 0){const L=p?Im(i,p,P,x):i;if(A)return u?Cm(m,L,l):ls(m,l,L);const z=1e-9,D=Math.ceil(Math.log(i/L)/Math.log(a)-z),B=-o*(.5-z)+.5,$=Math.min(L,m),et=Math.floor(Math.log(i/$)/Math.log(a)+B),it=Math.max(D,et),ft=i/Math.pow(a,it);return ls(ft,l,L)}}}function v0(a,i,l,u,p){return l=l!==void 0?l:!0,function(x,m,o,P){if(x!==void 0){const A=u?Im(a,u,o,p):a;return!l||!P?ls(x,i,A):Cm(x,A,i)}}}function UM(a){if(a!==void 0)return 0}function x0(a){if(a!==void 0)return a}function VM(a){const i=2*Math.PI/a;return function(l,u){if(u)return l;if(l!==void 0)return l=Math.floor(l/i+.5)*i,l}}function $M(a){const i=va(5);return function(l,u){return u||l===void 0?l:Math.abs(l)<=i?0:l}}const qM=256,Ep=0;class b0 extends Wd{constructor(i){super(),this.on,this.once,this.un,i=Object.assign({},i),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Sm(i.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,i.projection&&F2(),i.center&&(i.center=ga(i.center,this.projection_)),i.extent&&(i.extent=Rl(i.extent,this.projection_)),this.applyOptions_(i)}applyOptions_(i){const l=Object.assign({},i);for(const o in qs)delete l[o];this.setProperties(l,!0);const u=WM(i);this.maxResolution_=u.maxResolution,this.minResolution_=u.minResolution,this.zoomFactor_=u.zoomFactor,this.resolutions_=i.resolutions,this.padding_=i.padding,this.minZoom_=u.minZoom;const p=ZM(i),x=u.constraint,m=XM(i);this.constraints_={center:p,resolution:x,rotation:m},this.setRotation(i.rotation!==void 0?i.rotation:0),this.setCenterInternal(i.center!==void 0?i.center:null),i.resolution!==void 0?this.setResolution(i.resolution):i.zoom!==void 0&&this.setZoom(i.zoom)}get padding(){return this.padding_}set padding(i){let l=this.padding_;this.padding_=i;const u=this.getCenterInternal();if(u){const p=i||[0,0,0,0];l=l||[0,0,0,0];const x=this.getResolution(),m=x/2*(p[3]-l[3]+l[1]-p[1]),o=x/2*(p[0]-l[0]+l[2]-p[2]);this.setCenterInternal([u[0]+m,u[1]-o])}}getUpdatedOptions_(i){const l=this.getProperties();return l.resolution!==void 0?l.resolution=this.getResolution():l.zoom=this.getZoom(),l.center=this.getCenterInternal(),l.rotation=this.getRotation(),Object.assign({},l,i)}animate(i){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const l=new Array(arguments.length);for(let u=0;u<l.length;++u){let p=arguments[u];p.center&&(p=Object.assign({},p),p.center=ga(p.center,this.getProjection())),p.anchor&&(p=Object.assign({},p),p.anchor=ga(p.anchor,this.getProjection())),l[u]=p}this.animateInternal.apply(this,l)}animateInternal(i){let l=arguments.length,u;l>1&&typeof arguments[l-1]=="function"&&(u=arguments[l-1],--l);let p=0;for(;p<l&&!this.isDef();++p){const L=arguments[p];L.center&&this.setCenterInternal(L.center),L.zoom!==void 0?this.setZoom(L.zoom):L.resolution&&this.setResolution(L.resolution),L.rotation!==void 0&&this.setRotation(L.rotation)}if(p===l){u&&dd(u,!0);return}let x=Date.now(),m=this.targetCenter_.slice(),o=this.targetResolution_,P=this.targetRotation_;const A=[];for(;p<l;++p){const L=arguments[p],z={start:x,complete:!1,anchor:L.anchor,duration:L.duration!==void 0?L.duration:1e3,easing:L.easing||Q2,callback:u};if(L.center&&(z.sourceCenter=m,z.targetCenter=L.center.slice(),m=z.targetCenter),L.zoom!==void 0?(z.sourceResolution=o,z.targetResolution=this.getResolutionForZoom(L.zoom),o=z.targetResolution):L.resolution&&(z.sourceResolution=o,z.targetResolution=L.resolution,o=z.targetResolution),L.rotation!==void 0){z.sourceRotation=P;const D=vc(L.rotation-P+Math.PI,2*Math.PI)-Math.PI;z.targetRotation=P+D,P=z.targetRotation}HM(z)?z.complete=!0:x+=z.duration,A.push(z)}this.animations_.push(A),this.setHint(mn.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[mn.ANIMATING]>0}getInteracting(){return this.hints_[mn.INTERACTING]>0}cancelAnimations(){this.setHint(mn.ANIMATING,-this.hints_[mn.ANIMATING]);let i;for(let l=0,u=this.animations_.length;l<u;++l){const p=this.animations_[l];if(p[0].callback&&dd(p[0].callback,!1),!i)for(let x=0,m=p.length;x<m;++x){const o=p[x];if(!o.complete){i=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=i,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const i=Date.now();let l=!1;for(let u=this.animations_.length-1;u>=0;--u){const p=this.animations_[u];let x=!0;for(let m=0,o=p.length;m<o;++m){const P=p[m];if(P.complete)continue;const A=i-P.start;let L=P.duration>0?A/P.duration:1;L>=1?(P.complete=!0,L=1):x=!1;const z=P.easing(L);if(P.sourceCenter){const D=P.sourceCenter[0],B=P.sourceCenter[1],$=P.targetCenter[0],et=P.targetCenter[1];this.nextCenter_=P.targetCenter;const it=D+z*($-D),ft=B+z*(et-B);this.targetCenter_=[it,ft]}if(P.sourceResolution&&P.targetResolution){const D=z===1?P.targetResolution:P.sourceResolution+z*(P.targetResolution-P.sourceResolution);if(P.anchor){const B=this.getViewportSize_(this.getRotation()),$=this.constraints_.resolution(D,0,B,!0);this.targetCenter_=this.calculateCenterZoom($,P.anchor)}this.nextResolution_=P.targetResolution,this.targetResolution_=D,this.applyTargetState_(!0)}if(P.sourceRotation!==void 0&&P.targetRotation!==void 0){const D=z===1?vc(P.targetRotation+Math.PI,2*Math.PI)-Math.PI:P.sourceRotation+z*(P.targetRotation-P.sourceRotation);if(P.anchor){const B=this.constraints_.rotation(D,!0);this.targetCenter_=this.calculateCenterRotate(B,P.anchor)}this.nextRotation_=P.targetRotation,this.targetRotation_=D}if(this.applyTargetState_(!0),l=!0,!P.complete)break}if(x){this.animations_[u]=null,this.setHint(mn.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const m=p[0].callback;m&&dd(m,!0)}}this.animations_=this.animations_.filter(Boolean),l&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(i,l){let u;const p=this.getCenterInternal();return p!==void 0&&(u=[p[0]-l[0],p[1]-l[1]],c2(u,i-this.getRotation()),h2(u,l)),u}calculateCenterZoom(i,l){let u;const p=this.getCenterInternal(),x=this.getResolution();if(p!==void 0&&x!==void 0){const m=l[0]-i*(l[0]-p[0])/x,o=l[1]-i*(l[1]-p[1])/x;u=[m,o]}return u}getViewportSize_(i){const l=this.viewportSize_;if(i){const u=l[0],p=l[1];return[Math.abs(u*Math.cos(i))+Math.abs(p*Math.sin(i)),Math.abs(u*Math.sin(i))+Math.abs(p*Math.cos(i))]}return l}setViewportSize(i){this.viewportSize_=Array.isArray(i)?i.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const i=this.getCenterInternal();return i&&o0(i,this.getProjection())}getCenterInternal(){return this.get(qs.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(i){return i!==void 0?(i[0]=this.hints_[0],i[1]=this.hints_[1],i):this.hints_.slice()}calculateExtent(i){const l=this.calculateExtentInternal(i);return j2(l,this.getProjection())}calculateExtentInternal(i){i=i||this.getViewportSizeMinusPadding_();const l=this.getCenterInternal();Ln(l,"The view center is not defined");const u=this.getResolution();Ln(u!==void 0,"The view resolution is not defined");const p=this.getRotation();return Ln(p!==void 0,"The view rotation is not defined"),Ay(l,u,p,i)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(i){this.applyOptions_(this.getUpdatedOptions_({maxZoom:i}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(i){this.applyOptions_(this.getUpdatedOptions_({minZoom:i}))}setConstrainResolution(i){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:i}))}getProjection(){return this.projection_}getResolution(){return this.get(qs.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(i,l){return this.getResolutionForExtentInternal(Rl(i,this.getProjection()),l)}getResolutionForExtentInternal(i,l){l=l||this.getViewportSizeMinusPadding_();const u=vr(i)/l[0],p=Yr(i)/l[1];return Math.max(u,p)}getResolutionForValueFunction(i){i=i||2;const l=this.getConstrainedResolution(this.maxResolution_),u=this.minResolution_,p=Math.log(l/u)/Math.log(i);return function(x){return l/Math.pow(i,x*p)}}getRotation(){return this.get(qs.ROTATION)}getValueForResolutionFunction(i){const l=Math.log(i||2),u=this.getConstrainedResolution(this.maxResolution_),p=this.minResolution_,x=Math.log(u/p)/l;return function(m){return Math.log(u/m)/l/x}}getViewportSizeMinusPadding_(i){let l=this.getViewportSize_(i);const u=this.padding_;return u&&(l=[l[0]-u[1]-u[3],l[1]-u[0]-u[2]]),l}getState(){const i=this.getProjection(),l=this.getResolution(),u=this.getRotation();let p=this.getCenterInternal();const x=this.padding_;if(x){const m=this.getViewportSizeMinusPadding_();p=Ip(p,this.getViewportSize_(),[m[0]/2+x[3],m[1]/2+x[0]],l,u)}return{center:p.slice(0),projection:i!==void 0?i:null,resolution:l,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:u,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let i;const l=this.getResolution();return l!==void 0&&(i=this.getZoomForResolution(l)),i}getZoomForResolution(i){let l=this.minZoom_||0,u,p;if(this.resolutions_){const x=pm(this.resolutions_,i,1);l=x,u=this.resolutions_[x],x==this.resolutions_.length-1?p=2:p=u/this.resolutions_[x+1]}else u=this.maxResolution_,p=this.zoomFactor_;return l+Math.log(u/i)/Math.log(p)}getResolutionForZoom(i){var l;if((l=this.resolutions_)!=null&&l.length){if(this.resolutions_.length===1)return this.resolutions_[0];const u=ls(Math.floor(i),0,this.resolutions_.length-2),p=this.resolutions_[u]/this.resolutions_[u+1];return this.resolutions_[u]/Math.pow(p,ls(i-u,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,i-this.minZoom_)}fit(i,l){let u;if(Ln(Array.isArray(i)||typeof i.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(i)){Ln(!Oc(i),"Cannot fit empty extent provided as `geometry`");const p=Rl(i,this.getProjection());u=y0(p)}else if(i.getType()==="Circle"){const p=Rl(i.getExtent(),this.getProjection());u=y0(p),u.rotate(this.getRotation(),Vl(p))}else u=i;this.fitInternal(u,l)}rotatedExtentForGeometry(i){const l=this.getRotation(),u=Math.cos(l),p=Math.sin(-l),x=i.getFlatCoordinates(),m=i.getStride();let o=1/0,P=1/0,A=-1/0,L=-1/0;for(let z=0,D=x.length;z<D;z+=m){const B=x[z]*u-x[z+1]*p,$=x[z]*p+x[z+1]*u;o=Math.min(o,B),P=Math.min(P,$),A=Math.max(A,B),L=Math.max(L,$)}return[o,P,A,L]}fitInternal(i,l){l=l||{};let u=l.size;u||(u=this.getViewportSizeMinusPadding_());const p=l.padding!==void 0?l.padding:[0,0,0,0],x=l.nearest!==void 0?l.nearest:!1;let m;l.minResolution!==void 0?m=l.minResolution:l.maxZoom!==void 0?m=this.getResolutionForZoom(l.maxZoom):m=0;const o=this.rotatedExtentForGeometry(i);let P=this.getResolutionForExtentInternal(o,[u[0]-p[1]-p[3],u[1]-p[0]-p[2]]);P=isNaN(P)?m:Math.max(P,m),P=this.getConstrainedResolution(P,x?0:1);const A=this.getRotation(),L=Math.sin(A),z=Math.cos(A),D=Vl(o);D[0]+=(p[1]-p[3])/2*P,D[1]+=(p[0]-p[2])/2*P;const B=D[0]*z-D[1]*L,$=D[1]*z+D[0]*L,et=this.getConstrainedCenter([B,$],P),it=l.callback?l.callback:Kp;l.duration!==void 0?this.animateInternal({resolution:P,center:et,duration:l.duration,easing:l.easing},it):(this.targetResolution_=P,this.targetCenter_=et,this.applyTargetState_(!1,!0),dd(it,!0))}centerOn(i,l,u){this.centerOnInternal(ga(i,this.getProjection()),l,u)}centerOnInternal(i,l,u){this.setCenterInternal(Ip(i,l,u,this.getResolution(),this.getRotation()))}calculateCenterShift(i,l,u,p){let x;const m=this.padding_;if(m&&i){const o=this.getViewportSizeMinusPadding_(-u),P=Ip(i,p,[o[0]/2+m[3],o[1]/2+m[0]],l,u);x=[i[0]-P[0],i[1]-P[1]]}return x}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(i){const l=o0(this.targetCenter_,this.getProjection());this.setCenter([l[0]+i[0],l[1]+i[1]])}adjustCenterInternal(i){const l=this.targetCenter_;this.setCenterInternal([l[0]+i[0],l[1]+i[1]])}adjustResolution(i,l){l=l&&ga(l,this.getProjection()),this.adjustResolutionInternal(i,l)}adjustResolutionInternal(i,l){const u=this.getAnimating()||this.getInteracting(),p=this.getViewportSize_(this.getRotation()),x=this.constraints_.resolution(this.targetResolution_*i,0,p,u);l&&(this.targetCenter_=this.calculateCenterZoom(x,l)),this.targetResolution_*=i,this.applyTargetState_()}adjustZoom(i,l){this.adjustResolution(Math.pow(this.zoomFactor_,-i),l)}adjustRotation(i,l){l&&(l=ga(l,this.getProjection())),this.adjustRotationInternal(i,l)}adjustRotationInternal(i,l){const u=this.getAnimating()||this.getInteracting(),p=this.constraints_.rotation(this.targetRotation_+i,u);l&&(this.targetCenter_=this.calculateCenterRotate(p,l)),this.targetRotation_+=i,this.applyTargetState_()}setCenter(i){this.setCenterInternal(i&&ga(i,this.getProjection()))}setCenterInternal(i){this.targetCenter_=i,this.applyTargetState_()}setHint(i,l){return this.hints_[i]+=l,this.changed(),this.hints_[i]}setResolution(i){this.targetResolution_=i,this.applyTargetState_()}setRotation(i){this.targetRotation_=i,this.applyTargetState_()}setZoom(i){this.setResolution(this.getResolutionForZoom(i))}applyTargetState_(i,l){const u=this.getAnimating()||this.getInteracting()||l,p=this.constraints_.rotation(this.targetRotation_,u),x=this.getViewportSize_(p),m=this.constraints_.resolution(this.targetResolution_,0,x,u),o=this.constraints_.center(this.targetCenter_,m,x,u,this.calculateCenterShift(this.targetCenter_,m,p,x));this.get(qs.ROTATION)!==p&&this.set(qs.ROTATION,p),this.get(qs.RESOLUTION)!==m&&(this.set(qs.RESOLUTION,m),this.set("zoom",this.getZoom(),!0)),(!o||!this.get(qs.CENTER)||!Id(this.get(qs.CENTER),o))&&this.set(qs.CENTER,o),this.getAnimating()&&!i&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(i,l,u){i=i!==void 0?i:200;const p=l||0,x=this.constraints_.rotation(this.targetRotation_),m=this.getViewportSize_(x),o=this.constraints_.resolution(this.targetResolution_,p,m),P=this.constraints_.center(this.targetCenter_,o,m,!1,this.calculateCenterShift(this.targetCenter_,o,x,m));if(i===0&&!this.cancelAnchor_){this.targetResolution_=o,this.targetRotation_=x,this.targetCenter_=P,this.applyTargetState_();return}u=u||(i===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==o||this.getRotation()!==x||!this.getCenterInternal()||!Id(this.getCenterInternal(),P))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:x,center:P,resolution:o,duration:i,easing:J2,anchor:u}))}beginInteraction(){this.resolveConstraints(0),this.setHint(mn.INTERACTING,1)}endInteraction(i,l,u){u=u&&ga(u,this.getProjection()),this.endInteractionInternal(i,l,u)}endInteractionInternal(i,l,u){this.getInteracting()&&(this.setHint(mn.INTERACTING,-1),this.resolveConstraints(i,l,u))}getConstrainedCenter(i,l){const u=this.getViewportSize_(this.getRotation());return this.constraints_.center(i,l||this.getResolution(),u)}getConstrainedZoom(i,l){const u=this.getResolutionForZoom(i);return this.getZoomForResolution(this.getConstrainedResolution(u,l))}getConstrainedResolution(i,l){l=l||0;const u=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(i,l,u)}}function dd(a,i){setTimeout(function(){a(i)},0)}function ZM(a){if(a.extent!==void 0){const l=a.smoothExtentConstraint!==void 0?a.smoothExtentConstraint:!0;return f0(a.extent,a.constrainOnlyCenter,l)}const i=Sm(a.projection,"EPSG:3857");if(a.multiWorld!==!0&&i.isGlobal()){const l=i.getExtent().slice();return l[0]=-1/0,l[2]=1/0,f0(l,!1,!1)}return mM}function WM(a){let i,l,u,m=a.minZoom!==void 0?a.minZoom:Ep,o=a.maxZoom!==void 0?a.maxZoom:28;const P=a.zoomFactor!==void 0?a.zoomFactor:2,A=a.multiWorld!==void 0?a.multiWorld:!1,L=a.smoothResolutionConstraint!==void 0?a.smoothResolutionConstraint:!0,z=a.showFullExtent!==void 0?a.showFullExtent:!1,D=Sm(a.projection,"EPSG:3857"),B=D.getExtent();let $=a.constrainOnlyCenter,et=a.extent;if(!A&&!et&&D.isGlobal()&&($=!1,et=B),a.resolutions!==void 0){const it=a.resolutions;l=it[m],u=it[o]!==void 0?it[o]:it[it.length-1],a.constrainResolution?i=GM(it,L,!$&&et,z):i=v0(l,u,L,!$&&et,z)}else{const ft=(B?Math.max(vr(B),Yr(B)):360*Dy.degrees/D.getMetersPerUnit())/qM/Math.pow(2,Ep),dt=ft/Math.pow(2,28-Ep);l=a.maxResolution,l!==void 0?m=0:l=ft/Math.pow(P,m),u=a.minResolution,u===void 0&&(a.maxZoom!==void 0?a.maxResolution!==void 0?u=l/Math.pow(P,o):u=ft/Math.pow(P,o):u=dt),o=m+Math.floor(Math.log(l/u)/Math.log(P)),u=l/Math.pow(P,o-m),a.constrainResolution?i=jM(P,l,u,L,!$&&et,z):i=v0(l,u,L,!$&&et,z)}return{constraint:i,maxResolution:l,minResolution:u,minZoom:m,zoomFactor:P}}function XM(a){if(a.enableRotation!==void 0?a.enableRotation:!0){const l=a.constrainRotation;return l===void 0||l===!0?$M():l===!1?x0:typeof l=="number"?VM(l):x0}return UM}function HM(a){return!(a.sourceCenter&&a.targetCenter&&!Id(a.sourceCenter,a.targetCenter)||a.sourceResolution!==a.targetResolution||a.sourceRotation!==a.targetRotation)}function Ip(a,i,l,u,p){const x=Math.cos(-p);let m=Math.sin(-p),o=a[0]*x-a[1]*m,P=a[1]*x+a[0]*m;o+=(i[0]/2-l[0])*u,P+=(l[1]-i[1]/2)*u,m=-m;const A=o*x-P*m,L=P*x+o*m;return[A,L]}class KM extends Wd{constructor(i){super(),this.on,this.once,this.un,this.background_=i.background;const l=Object.assign({},i);typeof i.properties=="object"&&(delete l.properties,Object.assign(l,i.properties)),l[Si.OPACITY]=i.opacity!==void 0?i.opacity:1,Ln(typeof l[Si.OPACITY]=="number","Layer opacity must be a number"),l[Si.VISIBLE]=i.visible!==void 0?i.visible:!0,l[Si.Z_INDEX]=i.zIndex,l[Si.MAX_RESOLUTION]=i.maxResolution!==void 0?i.maxResolution:1/0,l[Si.MIN_RESOLUTION]=i.minResolution!==void 0?i.minResolution:0,l[Si.MIN_ZOOM]=i.minZoom!==void 0?i.minZoom:-1/0,l[Si.MAX_ZOOM]=i.maxZoom!==void 0?i.maxZoom:1/0,this.className_=l.className!==void 0?l.className:"ol-layer",delete l.className,this.setProperties(l),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(i){const l=this.state_||{layer:this,managed:i===void 0?!0:i},u=this.getZIndex();return l.opacity=ls(Math.round(this.getOpacity()*100)/100,0,1),l.visible=this.getVisible(),l.extent=this.getExtent(),l.zIndex=u===void 0&&!l.managed?1/0:u,l.maxResolution=this.getMaxResolution(),l.minResolution=Math.max(this.getMinResolution(),0),l.minZoom=this.getMinZoom(),l.maxZoom=this.getMaxZoom(),this.state_=l,l}getLayersArray(i){return Pr()}getLayerStatesArray(i){return Pr()}getExtent(){return this.get(Si.EXTENT)}getMaxResolution(){return this.get(Si.MAX_RESOLUTION)}getMinResolution(){return this.get(Si.MIN_RESOLUTION)}getMinZoom(){return this.get(Si.MIN_ZOOM)}getMaxZoom(){return this.get(Si.MAX_ZOOM)}getOpacity(){return this.get(Si.OPACITY)}getSourceState(){return Pr()}getVisible(){return this.get(Si.VISIBLE)}getZIndex(){return this.get(Si.Z_INDEX)}setBackground(i){this.background_=i,this.changed()}setExtent(i){this.set(Si.EXTENT,i)}setMaxResolution(i){this.set(Si.MAX_RESOLUTION,i)}setMinResolution(i){this.set(Si.MIN_RESOLUTION,i)}setMaxZoom(i){this.set(Si.MAX_ZOOM,i)}setMinZoom(i){this.set(Si.MIN_ZOOM,i)}setOpacity(i){Ln(typeof i=="number","Layer opacity must be a number"),this.set(Si.OPACITY,i)}setVisible(i){this.set(Si.VISIBLE,i)}setZIndex(i){this.set(Si.Z_INDEX,i)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class YM extends KM{constructor(i){const l=Object.assign({},i);delete l.source,super(l),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,i.render&&(this.render=i.render),i.map&&this.setMap(i.map),this.addChangeListener(Si.SOURCE,this.handleSourcePropertyChange_);const u=i.source?i.source:null;this.setSource(u)}getLayersArray(i){return i=i||[],i.push(this),i}getLayerStatesArray(i){return i=i||[],i.push(this.getLayerState()),i}getSource(){return this.get(Si.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const i=this.getSource();return i?i.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Nl(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const i=this.getSource();i&&(this.sourceChangeKey_=bo(i,ba.CHANGE,this.handleSourceChange_,this),i.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(i){return this.renderer_?this.renderer_.getFeatures(i):Promise.resolve([])}getData(i){return!this.renderer_||!this.rendered?null:this.renderer_.getData(i)}isVisible(i){let l;const u=this.getMapInternal();!i&&u&&(i=u.getView()),i instanceof b0?l={viewState:i.getState(),extent:i.calculateExtent()}:l=i,!l.layerStatesArray&&u&&(l.layerStatesArray=u.getLayerGroup().getLayerStatesArray());let p;if(l.layerStatesArray){if(p=l.layerStatesArray.find(m=>m.layer===this),!p)return!1}else p=this.getLayerState();const x=this.getExtent();return JM(p,l.viewState)&&(!x||Hl(x,l.extent))}getAttributions(i){var x;if(!this.isVisible(i))return[];const l=(x=this.getSource())==null?void 0:x.getAttributions();if(!l)return[];const u=i instanceof b0?i.getViewStateAndExtent():i;let p=l(u);return Array.isArray(p)||(p=[p]),p}render(i,l){const u=this.getRenderer();return u.prepareFrame(i)?(this.rendered=!0,u.renderFrame(i,l)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(i,l){}renderDeferred(i){const l=this.getRenderer();l&&l.renderDeferred(i)}setMapInternal(i){i||this.unrender(),this.set(Si.MAP,i)}getMapInternal(){return this.get(Si.MAP)}setMap(i){this.mapPrecomposeKey_&&(Nl(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),i||this.changed(),this.mapRenderKey_&&(Nl(this.mapRenderKey_),this.mapRenderKey_=null),i&&(this.mapPrecomposeKey_=bo(i,dc.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=bo(this,ba.CHANGE,i.render,i),this.changed())}handlePrecompose_(i){const l=i.frameState.layerStatesArray,u=this.getLayerState(!1);Ln(!l.some(p=>p.layer===u.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),l.push(u)}setSource(i){this.set(Si.SOURCE,i)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function JM(a,i){if(!a.visible)return!1;const l=i.resolution;if(l<a.minResolution||l>=a.maxResolution)return!1;const u=i.zoom;return u>a.minZoom&&u<=a.maxZoom}class QM extends Wd{constructor(i){super(),this.projection=Xs(i.projection),this.attributions_=w0(i.attributions),this.attributionsCollapsible_=i.attributionsCollapsible??!0,this.loading=!1,this.state_=i.state!==void 0?i.state:"ready",this.wrapX_=i.wrapX!==void 0?i.wrapX:!1,this.interpolate_=!!i.interpolate,this.viewResolver=null,this.viewRejector=null;const l=this;this.viewPromise_=new Promise(function(u,p){l.viewResolver=u,l.viewRejector=p})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(i){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(i){this.attributions_=w0(i),this.changed()}setState(i){this.state_=i,this.changed()}}function w0(a){return a?typeof a=="function"?a:(Array.isArray(a)||(a=[a]),i=>a):null}class tS{constructor(){T_(this,"pushMethodArgs_",(...i)=>(this.push_(i),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(q_(),{get:(i,l)=>{if(typeof q_()[l]=="function")return this.push_(l),this.pushMethodArgs_},set:(i,l,u)=>(this.push_(l,u),!0)})}push_(...i){const l=this.instructions_,u=this.zIndex+this.offset_;l[u]||(l[u]=[]),l[u].push(...i)}pushFunction(i){this.push_(i)}getContext(){return this.context_}draw(i){this.instructions_.forEach(l=>{for(let u=0,p=l.length;u<p;++u){const x=l[u];if(typeof x=="function"){x(i);continue}const m=l[++u];if(typeof i[x]=="function")i[x](...m);else{if(typeof m=="function"){i[x]=m(i);continue}i[x]=m}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}let Il=null;function eS(){Il=Mo(1,1,void 0,{willReadFrequently:!0})}class iS extends fM{constructor(i){super(i),this.container=null,this.renderedResolution,this.tempTransform=xd(),this.pixelTransform=xd(),this.inversePixelTransform=xd(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(i,l,u){Il||eS(),Il.clearRect(0,0,1,1);let p;try{Il.drawImage(i,l,u,1,1,0,0,1,1),p=Il.getImageData(0,0,1,1).data}catch{return Il=null,null}return p}getBackground(i){let u=this.getLayer().getBackground();return typeof u=="function"&&(u=u(i.viewState.resolution)),u||void 0}useContainer(i,l,u){const p=this.getLayer().getClassName();let x,m;if(i&&i.className===p&&(!u||i&&i.style.backgroundColor&&xy(W_(i.style.backgroundColor),W_(u)))){const o=i.firstElementChild;o instanceof HTMLCanvasElement&&(m=o.getContext("2d"))}if(m&&W2(m.canvas.style.transform,l)?(this.container=i,this.context=m,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){x=document.createElement("div"),x.className=p;let o=x.style;o.position="absolute",o.width="100%",o.height="100%",m=Mo();const P=m.canvas;x.appendChild(P),o=P.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=x,this.context=m}!this.containerReused&&u&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=u)}clipUnrotated(i,l,u){const p=Vd(u),x=vm(u),m=ym(u),o=_m(u);pn(l.coordinateToPixelTransform,p),pn(l.coordinateToPixelTransform,x),pn(l.coordinateToPixelTransform,m),pn(l.coordinateToPixelTransform,o);const P=this.inversePixelTransform;pn(P,p),pn(P,x),pn(P,m),pn(P,o),i.save(),i.beginPath(),i.moveTo(Math.round(p[0]),Math.round(p[1])),i.lineTo(Math.round(x[0]),Math.round(x[1])),i.lineTo(Math.round(m[0]),Math.round(m[1])),i.lineTo(Math.round(o[0]),Math.round(o[1])),i.clip()}prepareContainer(i,l){const u=i.extent,p=i.viewState.resolution,x=i.viewState.rotation,m=i.pixelRatio,o=Math.round(vr(u)/p*m),P=Math.round(Yr(u)/p*m);Dd(this.pixelTransform,i.size[0]/2,i.size[1]/2,1/m,1/m,x,-o/2,-P/2),V2(this.inversePixelTransform,this.pixelTransform);const A=Z2(this.pixelTransform);if(this.useContainer(l,A,this.getBackground(i)),!this.containerReused){const L=this.context.canvas;L.width!=o||L.height!=P?(L.width=o,L.height=P):this.context.clearRect(0,0,o,P),A!==L.style.transform&&(L.style.transform=A)}}dispatchRenderEvent_(i,l,u){const p=this.getLayer();if(p.hasListener(i)){const x=new cM(i,this.inversePixelTransform,u,l);p.dispatchEvent(x)}}preRender(i,l){this.frameState=l,!l.declutter&&this.dispatchRenderEvent_(dc.PRERENDER,i,l)}postRender(i,l){l.declutter||this.dispatchRenderEvent_(dc.POSTRENDER,i,l)}renderDeferredInternal(i){}getRenderContext(i){return i.declutter&&!this.deferredContext_&&(this.deferredContext_=new tS),i.declutter?this.deferredContext_.getContext():this.context}renderDeferred(i){i.declutter&&(this.dispatchRenderEvent_(dc.PRERENDER,this.context,i),i.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(i),this.dispatchRenderEvent_(dc.POSTRENDER,this.context,i))}getRenderTransform(i,l,u,p,x,m,o){const P=x/2,A=m/2,L=p/l,z=-L,D=-i[0]+o,B=-i[1];return Dd(this.tempTransform,P,A,L,z,-u,D,B)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class rS extends iS{constructor(i){super(i),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(i){const l=i.layerStatesArray[i.layerIndex],u=i.pixelRatio,p=i.viewState,x=p.resolution,m=this.getLayer().getSource(),o=i.viewHints;let P=i.extent;if(l.extent!==void 0&&(P=Ry(P,Rl(l.extent,p.projection))),!o[mn.ANIMATING]&&!o[mn.INTERACTING]&&!Oc(P))if(m){const A=p.projection,L=m.getImage(P,x,u,A);L&&(this.loadImage(L)?this.image=L:L.getState()===Ui.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(i){const l=this.frameState;if(!l)return null;const u=this.getLayer(),p=pn(l.pixelToCoordinateTransform,i.slice()),x=u.getExtent();if(x&&!Ey(x,p))return null;const m=this.image.getExtent(),o=this.image.getImage(),P=vr(m),A=Math.floor(o.width*((p[0]-m[0])/P));if(A<0||A>=o.width)return null;const L=Yr(m),z=Math.floor(o.height*((m[3]-p[1])/L));return z<0||z>=o.height?null:this.getImageData(o,A,z)}renderFrame(i,l){const u=this.image,p=u.getExtent(),x=u.getResolution(),[m,o]=Array.isArray(x)?x:[x,x],P=u.getPixelRatio(),A=i.layerStatesArray[i.layerIndex],L=i.pixelRatio,z=i.viewState,D=z.center,B=z.resolution,$=L*m/(B*P),et=L*o/(B*P);this.prepareContainer(i,l);const it=this.context.canvas.width,ft=this.context.canvas.height,dt=this.getRenderContext(i);let Ot=!1,jt=!0;if(A.extent){const Re=Rl(A.extent,z.projection);jt=Hl(Re,i.extent),Ot=jt&&!Zp(Re,i.extent),Ot&&this.clipUnrotated(dt,i,Re)}const Gt=u.getImage(),re=Dd(this.tempTransform,it/2,ft/2,$,et,0,P*(p[0]-D[0])/m,P*(D[1]-p[3])/o);this.renderedResolution=o*L/P;const Ie=Gt.width*re[0],_e=Gt.height*re[3];if(this.getLayer().getSource().getInterpolate()||(dt.imageSmoothingEnabled=!1),this.preRender(dt,i),jt&&Ie>=.5&&_e>=.5){const Re=re[4],ri=re[5],$e=A.opacity;$e!==1&&(dt.save(),dt.globalAlpha=$e),dt.drawImage(Gt,0,0,+Gt.width,+Gt.height,Re,ri,Ie,_e),$e!==1&&dt.restore()}return this.postRender(this.context,i),Ot&&dt.restore(),dt.imageSmoothingEnabled=!0,this.container}}class sS extends YM{constructor(i){i=i||{},super(i)}}class nS extends sS{constructor(i){super(i)}createRenderer(){return new rS(this)}getData(i){return super.getData(i)}}function Yp(a){return Array.isArray(a)?Math.min(...a):a}function aS(a){return new Worker(""+new URL("../workers/geotiffWorker-l0sNRNKZ.js",import.meta.url).href,{type:"module",name:a==null?void 0:a.name})}class oS extends Pm{constructor(i,l,u,p,x,m,o){let P=i.getExtent();P&&i.canWrapX()&&(P=P.slice(),P[0]=-1/0,P[2]=1/0);let A=l.getExtent();A&&l.canWrapX()&&(A=A.slice(),A[0]=-1/0,A[2]=1/0);const L=A?Ry(u,A):u,z=Vl(L),D=nM(i,l,z,p),B=hM,$=new lM(i,l,L,P,D*B,p),et=$.calculateSourceExtent(),it=Oc(et)?null:m(et,D,x),ft=it?Ui.IDLE:Ui.EMPTY,dt=it?it.getPixelRatio():1;super(u,p,dt,ft),this.targetProj_=l,this.maxSourceExtent_=P,this.triangulation_=$,this.targetResolution_=p,this.targetExtent_=u,this.sourceImage_=it,this.sourcePixelRatio_=dt,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==Ui.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const i=this.sourceImage_.getState();if(i==Ui.LOADED){const l=vr(this.targetExtent_)/this.targetResolution_,u=Yr(this.targetExtent_)/this.targetResolution_;this.canvas_=aM(l,u,this.sourcePixelRatio_,Yp(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=i,this.changed()}load(){if(this.state==Ui.IDLE){this.state=Ui.LOADING,this.changed();const i=this.sourceImage_.getState();i==Ui.LOADED||i==Ui.ERROR?this.reproject_():(this.sourceListenerKey_=bo(this.sourceImage_,ba.CHANGE,l=>{const u=this.sourceImage_.getState();(u==Ui.LOADED||u==Ui.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){Nl(this.sourceListenerKey_),this.sourceListenerKey_=null}}const fd=4,Cp={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class lS extends Zd{constructor(i,l){super(i),this.image=l}}class hS extends QM{constructor(i){super({attributions:i.attributions,projection:i.projection,state:i.state,interpolate:i.interpolate!==void 0?i.interpolate:!0}),this.on,this.once,this.un,this.loader=i.loader||null,this.resolutions_=i.resolutions!==void 0?i.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=i.loader?i.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(i){this.resolutions_=i}findNearestResolution(i){const l=this.getResolutions();if(l){const u=pm(l,i,0);i=l[u]}return i}getImage(i,l,u,p){const x=this.getProjection();if(!x||!p||a0(x,p))return x&&(p=x),this.getImageInternal(i,l,u,p);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&a0(this.reprojectedImage_.getProjection(),p)&&this.reprojectedImage_.getResolution()==l&&t2(this.reprojectedImage_.getExtent(),i))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new oS(x,p,i,l,u,(m,o,P)=>this.getImageInternal(m,o,P,x),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(i,l,u,p){if(this.loader){const x=uS(i,l,u,1),m=this.findNearestResolution(l);if(this.image&&(this.static_||this.wantedProjection_===p&&(this.wantedExtent_&&Zp(this.wantedExtent_,x)||Zp(this.image.getExtent(),x))&&(this.wantedResolution_&&Yp(this.wantedResolution_)===m||Yp(this.image.getResolution())===m)))return this.image;this.wantedProjection_=p,this.wantedExtent_=x,this.wantedResolution_=m,this.image=new Pm(x,m,u,this.loader),this.image.addEventListener(ba.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(i){const l=i.target;let u;switch(l.getState()){case Ui.LOADING:this.loading=!0,u=Cp.IMAGELOADSTART;break;case Ui.LOADED:this.loading=!1,u=Cp.IMAGELOADEND;break;case Ui.ERROR:this.loading=!1,u=Cp.IMAGELOADERROR;break;default:return}this.hasListener(u)&&this.dispatchEvent(new lS(u,l))}}function cS(a,i){a.getImage().src=i}function uS(a,i,l,u){const p=i/l,x=Vl(a),m=hd(vr(a)/p,fd),o=hd(Yr(a)/p,fd),P=hd((u-1)*m/2,fd),A=m+2*P,L=hd((u-1)*o/2,fd),z=o+2*L;return Ay(x,p,0,[A,z])}function dS(a){const i=a.load||jy,l=a.imageExtent,u=a.crossOrigin??null;return()=>{const p=new Image;return p.crossOrigin=u,i(p,a.url).then(x=>{const m=vr(l)/x.width,o=Yr(l)/x.height;return{image:x,extent:l,resolution:m!==o?[m,o]:o,pixelRatio:1}})}}class fS extends hS{constructor(i){const l=i.crossOrigin!==void 0?i.crossOrigin:null,u=i.imageLoadFunction!==void 0?i.imageLoadFunction:cS;super({attributions:i.attributions,interpolate:i.interpolate,projection:Xs(i.projection)}),this.url_=i.url,this.imageExtent_=i.imageExtent,this.image=null,this.image=new Pm(this.imageExtent_,void 0,1,dS({url:i.url,imageExtent:i.imageExtent,crossOrigin:l,load:(p,x)=>(this.image.setImage(p),u(this.image,x),jy(p))})),this.image.addEventListener(ba.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(i,l,u,p){return Hl(i,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}var pS=On('<div class="map-container svelte-11srq4e"></div>');function mS(a,i){K0(i,!0);let l=null,u,p;const x="oCUBI8DjgzTP5J8VptrnOAxYVeZc0cZ2",m="https://api.os.uk/maps/vector/v1/vts";let o;q0(async()=>{o=new aS,o.onmessage=dt=>{if(dt.data.error){console.error("Worker error:",dt.data.error);return}l=dt.data,console.log("Received GeoTIFF data:",l)},o.onerror=dt=>{console.error("Worker error:",dt)},o.postMessage({url:`${jp}/data/output.tif`}),proj4.defs("EPSG:27700","+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs"),ol.proj.proj4.register(proj4);const L=await fetch(`${m}?key=${x}`).then(dt=>dt.json()),z=[L.fullExtent.xmin,L.fullExtent.ymin,L.fullExtent.xmax,L.fullExtent.ymax],D=[L.tileInfo.origin.x,L.tileInfo.origin.y],B=L.tileInfo.lods.map(dt=>dt.resolution).slice(0,16),$=L.tileInfo.rows,et=L.tiles[0],it=new ol.tilegrid.TileGrid({extent:z,origin:D,resolutions:B,tileSize:$}),ft=new ol.layer.VectorTile({declutter:!0});await olms.applyStyle(ft,`${m}/${L.defaultStyles}?key=${x}`,"",{resolutions:B}),ft.setSource(new ol.source.VectorTile({format:new ol.format.MVT,url:et,projection:"EPSG:27700",tileGrid:it})),p=new ol.Map({target:u,layers:[ft],view:new ol.View({projection:"EPSG:27700",extent:[-238375,0,9e5,1376256],resolutions:B,minZoom:2,maxZoom:15,center:[377297,353995],zoom:2})})});let P;Gp(()=>{i.dataURL&&i.bbox&&(P=new nS({source:new fS({url:i.dataURL,imageExtent:i.bbox,projection:"EPSG:27700"}),opacity:.75}),p&&(p.removeLayer(p.getLayers().array_[1]),p.addLayer(P)))});var A=pS();Lx(A,L=>u=L,()=>u),dn(a,A),Y0()}function gS(a){a("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),a("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),a("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var i=1;i<=60;++i)a("EPSG:"+(32600+i),"+proj=utm +zone="+i+" +datum=WGS84 +units=m"),a("EPSG:"+(32700+i),"+proj=utm +zone="+i+" +south +datum=WGS84 +units=m");a.WGS84=a["EPSG:4326"],a["EPSG:3785"]=a["EPSG:3857"],a.GOOGLE=a["EPSG:3857"],a["EPSG:900913"]=a["EPSG:3857"],a["EPSG:102113"]=a["EPSG:3857"]}var So=1,To=2,Gl=3,_S=4,Jp=5,M0=6378137,yS=6356752314e-3,S0=.0066943799901413165,wc=484813681109536e-20,Qt=Math.PI/2,vS=.16666666666666666,xS=.04722222222222222,bS=.022156084656084655,le=1e-10,Ai=.017453292519943295,gn=57.29577951308232,xi=Math.PI/4,Ac=Math.PI*2,Lr=3.14159265359,hs={};hs.greenwich=0;hs.lisbon=-9.131906111111;hs.paris=2.337229166667;hs.bogota=-74.080916666667;hs.madrid=-3.687938888889;hs.rome=12.452333333333;hs.bern=7.439583333333;hs.jakarta=106.807719444444;hs.ferro=-17.666666666667;hs.brussels=4.367975;hs.stockholm=18.058277777778;hs.athens=23.7163375;hs.oslo=10.722916666667;const wS={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var T0=/[\s_\-\/\(\)]/g;function wa(a,i){if(a[i])return a[i];for(var l=Object.keys(a),u=i.toLowerCase().replace(T0,""),p=-1,x,m;++p<l.length;)if(x=l[p],m=x.toLowerCase().replace(T0,""),m===u)return a[x]}function Qp(a){var i={},l=a.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,P){var A=P.split("=");return A.push(!0),o[A[0].toLowerCase()]=A[1],o},{}),u,p,x,m={proj:"projName",datum:"datumCode",rf:function(o){i.rf=parseFloat(o)},lat_0:function(o){i.lat0=o*Ai},lat_1:function(o){i.lat1=o*Ai},lat_2:function(o){i.lat2=o*Ai},lat_ts:function(o){i.lat_ts=o*Ai},lon_0:function(o){i.long0=o*Ai},lon_1:function(o){i.long1=o*Ai},lon_2:function(o){i.long2=o*Ai},alpha:function(o){i.alpha=parseFloat(o)*Ai},gamma:function(o){i.rectified_grid_angle=parseFloat(o)*Ai},lonc:function(o){i.longc=o*Ai},x_0:function(o){i.x0=parseFloat(o)},y_0:function(o){i.y0=parseFloat(o)},k_0:function(o){i.k0=parseFloat(o)},k:function(o){i.k0=parseFloat(o)},a:function(o){i.a=parseFloat(o)},b:function(o){i.b=parseFloat(o)},r:function(o){i.a=i.b=parseFloat(o)},r_a:function(){i.R_A=!0},zone:function(o){i.zone=parseInt(o,10)},south:function(){i.utmSouth=!0},towgs84:function(o){i.datum_params=o.split(",").map(function(P){return parseFloat(P)})},to_meter:function(o){i.to_meter=parseFloat(o)},units:function(o){i.units=o;var P=wa(wS,o);P&&(i.to_meter=P.to_meter)},from_greenwich:function(o){i.from_greenwich=o*Ai},pm:function(o){var P=wa(hs,o);i.from_greenwich=(P||parseFloat(o))*Ai},nadgrids:function(o){o==="@null"?i.datumCode="none":i.nadgrids=o},axis:function(o){var P="ewnsud";o.length===3&&P.indexOf(o.substr(0,1))!==-1&&P.indexOf(o.substr(1,1))!==-1&&P.indexOf(o.substr(2,1))!==-1&&(i.axis=o)},approx:function(){i.approx=!0}};for(u in l)p=l[u],u in m?(x=m[u],typeof x=="function"?x(p):i[x]=p):i[u]=p;return typeof i.datumCode=="string"&&i.datumCode!=="WGS84"&&(i.datumCode=i.datumCode.toLowerCase()),i}class Jy{static getId(i){const l=i.find(u=>Array.isArray(u)&&u[0]==="ID");return l&&l.length>=3?{authority:l[1],code:parseInt(l[2],10)}:null}static convertUnit(i,l="unit"){if(!i||i.length<3)return{type:l,name:"unknown",conversion_factor:null};const u=i[1],p=parseFloat(i[2])||null,x=i.find(o=>Array.isArray(o)&&o[0]==="ID"),m=x?{authority:x[1],code:parseInt(x[2],10)}:null;return{type:l,name:u,conversion_factor:p,id:m}}static convertAxis(i){const l=i[1]||"Unknown";let u;const p=l.match(/^\((.)\)$/);if(p){const A=p[1].toUpperCase();if(A==="E")u="east";else if(A==="N")u="north";else if(A==="U")u="up";else throw new Error(`Unknown axis abbreviation: ${A}`)}else u=i[2]?i[2].toLowerCase():"unknown";const x=i.find(A=>Array.isArray(A)&&A[0]==="ORDER"),m=x?parseInt(x[1],10):null,o=i.find(A=>Array.isArray(A)&&(A[0]==="LENGTHUNIT"||A[0]==="ANGLEUNIT"||A[0]==="SCALEUNIT")),P=this.convertUnit(o);return{name:l,direction:u,unit:P,order:m}}static extractAxes(i){return i.filter(l=>Array.isArray(l)&&l[0]==="AXIS").map(l=>this.convertAxis(l)).sort((l,u)=>(l.order||0)-(u.order||0))}static convert(i,l={}){switch(i[0]){case"PROJCRS":l.type="ProjectedCRS",l.name=i[1],l.base_crs=i.find(D=>Array.isArray(D)&&D[0]==="BASEGEOGCRS")?this.convert(i.find(D=>Array.isArray(D)&&D[0]==="BASEGEOGCRS")):null,l.conversion=i.find(D=>Array.isArray(D)&&D[0]==="CONVERSION")?this.convert(i.find(D=>Array.isArray(D)&&D[0]==="CONVERSION")):null;const u=i.find(D=>Array.isArray(D)&&D[0]==="CS");u&&(l.coordinate_system={type:u[1],axis:this.extractAxes(i)});const p=i.find(D=>Array.isArray(D)&&D[0]==="LENGTHUNIT");if(p){const D=this.convertUnit(p);l.coordinate_system.unit=D}l.id=this.getId(i);break;case"BASEGEOGCRS":case"GEOGCRS":l.type="GeographicCRS",l.name=i[1];const x=i.find(D=>Array.isArray(D)&&(D[0]==="DATUM"||D[0]==="ENSEMBLE"));if(x){const D=this.convert(x);x[0]==="ENSEMBLE"?l.datum_ensemble=D:l.datum=D;const B=i.find($=>Array.isArray($)&&$[0]==="PRIMEM");B&&B[1]!=="Greenwich"&&(D.prime_meridian={name:B[1],longitude:parseFloat(B[2])})}l.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(i)},l.id=this.getId(i);break;case"DATUM":l.type="GeodeticReferenceFrame",l.name=i[1],l.ellipsoid=i.find(D=>Array.isArray(D)&&D[0]==="ELLIPSOID")?this.convert(i.find(D=>Array.isArray(D)&&D[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":l.type="DatumEnsemble",l.name=i[1],l.members=i.filter(D=>Array.isArray(D)&&D[0]==="MEMBER").map(D=>({type:"DatumEnsembleMember",name:D[1],id:this.getId(D)}));const m=i.find(D=>Array.isArray(D)&&D[0]==="ENSEMBLEACCURACY");m&&(l.accuracy=parseFloat(m[1]));const o=i.find(D=>Array.isArray(D)&&D[0]==="ELLIPSOID");o&&(l.ellipsoid=this.convert(o)),l.id=this.getId(i);break;case"ELLIPSOID":l.type="Ellipsoid",l.name=i[1],l.semi_major_axis=parseFloat(i[2]),l.inverse_flattening=parseFloat(i[3]),i.find(D=>Array.isArray(D)&&D[0]==="LENGTHUNIT")&&this.convert(i.find(D=>Array.isArray(D)&&D[0]==="LENGTHUNIT"),l);break;case"CONVERSION":l.type="Conversion",l.name=i[1],l.method=i.find(D=>Array.isArray(D)&&D[0]==="METHOD")?this.convert(i.find(D=>Array.isArray(D)&&D[0]==="METHOD")):null,l.parameters=i.filter(D=>Array.isArray(D)&&D[0]==="PARAMETER").map(D=>this.convert(D));break;case"METHOD":l.type="Method",l.name=i[1],l.id=this.getId(i);break;case"PARAMETER":l.type="Parameter",l.name=i[1],l.value=parseFloat(i[2]),l.unit=this.convertUnit(i.find(D=>Array.isArray(D)&&(D[0]==="LENGTHUNIT"||D[0]==="ANGLEUNIT"||D[0]==="SCALEUNIT"))),l.id=this.getId(i);break;case"BOUNDCRS":l.type="BoundCRS";const P=i.find(D=>Array.isArray(D)&&D[0]==="SOURCECRS");if(P){const D=P.find(B=>Array.isArray(B));l.source_crs=D?this.convert(D):null}const A=i.find(D=>Array.isArray(D)&&D[0]==="TARGETCRS");if(A){const D=A.find(B=>Array.isArray(B));l.target_crs=D?this.convert(D):null}const L=i.find(D=>Array.isArray(D)&&D[0]==="ABRIDGEDTRANSFORMATION");L?l.transformation=this.convert(L):l.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(l.type="Transformation",l.name=i[1],l.method=i.find(D=>Array.isArray(D)&&D[0]==="METHOD")?this.convert(i.find(D=>Array.isArray(D)&&D[0]==="METHOD")):null,l.parameters=i.filter(D=>Array.isArray(D)&&(D[0]==="PARAMETER"||D[0]==="PARAMETERFILE")).map(D=>{if(D[0]==="PARAMETER")return this.convert(D);if(D[0]==="PARAMETERFILE")return{name:D[1],value:D[2],id:{authority:"EPSG",code:8656}}}),l.parameters.length===7){const D=l.parameters[6];D.name==="Scale difference"&&(D.value=Math.round((D.value-1)*1e12)/1e6)}l.id=this.getId(i);break;case"AXIS":l.coordinate_system||(l.coordinate_system={type:"unspecified",axis:[]}),l.coordinate_system.axis.push(this.convertAxis(i));break;case"LENGTHUNIT":const z=this.convertUnit(i,"LinearUnit");l.coordinate_system&&l.coordinate_system.axis&&l.coordinate_system.axis.forEach(D=>{D.unit||(D.unit=z)}),z.conversion_factor&&z.conversion_factor!==1&&l.semi_major_axis&&(l.semi_major_axis={value:l.semi_major_axis,unit:z});break;default:l.keyword=i[0];break}return l}}class MS extends Jy{static convert(i,l={}){return super.convert(i,l),l.coordinate_system&&l.coordinate_system.subtype==="Cartesian"&&delete l.coordinate_system,l.usage&&delete l.usage,l}}class SS extends Jy{static convert(i,l={}){super.convert(i,l);const u=i.find(x=>Array.isArray(x)&&x[0]==="CS");u&&(l.coordinate_system={subtype:u[1],axis:this.extractAxes(i)});const p=i.find(x=>Array.isArray(x)&&x[0]==="USAGE");if(p){const x=p.find(P=>Array.isArray(P)&&P[0]==="SCOPE"),m=p.find(P=>Array.isArray(P)&&P[0]==="AREA"),o=p.find(P=>Array.isArray(P)&&P[0]==="BBOX");l.usage={},x&&(l.usage.scope=x[1]),m&&(l.usage.area=m[1]),o&&(l.usage.bbox=o.slice(1))}return l}}function TS(a){return a.find(i=>Array.isArray(i)&&i[0]==="USAGE")?"2019":(a.find(i=>Array.isArray(i)&&i[0]==="CS")||a[0]==="BOUNDCRS"||a[0]==="PROJCRS"||a[0]==="GEOGCRS","2015")}function PS(a){return(TS(a)==="2019"?SS:MS).convert(a)}function ES(a){const i=a.toUpperCase();return i.includes("PROJCRS")||i.includes("GEOGCRS")||i.includes("BOUNDCRS")||i.includes("VERTCRS")||i.includes("LENGTHUNIT")||i.includes("ANGLEUNIT")||i.includes("SCALEUNIT")?"WKT2":(i.includes("PROJCS")||i.includes("GEOGCS")||i.includes("LOCAL_CS")||i.includes("VERT_CS")||i.includes("UNIT"),"WKT1")}var Rc=1,Qy=2,t1=3,kd=4,e1=5,Am=-1,IS=/\s/,CS=/[A-Za-z]/,AS=/[A-Za-z84_]/,Xd=/[,\]]/,i1=/[\d\.E\-\+]/;function Fn(a){if(typeof a!="string")throw new Error("not a string");this.text=a.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Rc}Fn.prototype.readCharicter=function(){var a=this.text[this.place++];if(this.state!==kd)for(;IS.test(a);){if(this.place>=this.text.length)return;a=this.text[this.place++]}switch(this.state){case Rc:return this.neutral(a);case Qy:return this.keyword(a);case kd:return this.quoted(a);case e1:return this.afterquote(a);case t1:return this.number(a);case Am:return}};Fn.prototype.afterquote=function(a){if(a==='"'){this.word+='"',this.state=kd;return}if(Xd.test(a)){this.word=this.word.trim(),this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in afterquote yet, index '+this.place)};Fn.prototype.afterItem=function(a){if(a===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Rc;return}if(a==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Rc,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Am);return}};Fn.prototype.number=function(a){if(i1.test(a)){this.word+=a;return}if(Xd.test(a)){this.word=parseFloat(this.word),this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in number yet, index '+this.place)};Fn.prototype.quoted=function(a){if(a==='"'){this.state=e1;return}this.word+=a};Fn.prototype.keyword=function(a){if(AS.test(a)){this.word+=a;return}if(a==="["){var i=[];i.push(this.word),this.level++,this.root===null?this.root=i:this.currentObject.push(i),this.stack.push(this.currentObject),this.currentObject=i,this.state=Rc;return}if(Xd.test(a)){this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in keyword yet, index '+this.place)};Fn.prototype.neutral=function(a){if(CS.test(a)){this.word=a,this.state=Qy;return}if(a==='"'){this.word="",this.state=kd;return}if(i1.test(a)){this.word=a,this.state=t1;return}if(Xd.test(a)){this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in neutral yet, index '+this.place)};Fn.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Am)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function RS(a){var i=new Fn(a);return i.output()}function Ap(a,i,l){Array.isArray(i)&&(l.unshift(i),i=null);var u=i?{}:a,p=l.reduce(function(x,m){return Dl(m,x),x},u);i&&(a[i]=p)}function Dl(a,i){if(!Array.isArray(a)){i[a]=!0;return}var l=a.shift();if(l==="PARAMETER"&&(l=a.shift()),a.length===1){if(Array.isArray(a[0])){i[l]={},Dl(a[0],i[l]);return}i[l]=a[0];return}if(!a.length){i[l]=!0;return}if(l==="TOWGS84"){i[l]=a;return}if(l==="AXIS"){l in i||(i[l]=[]),i[l].push(a);return}Array.isArray(l)||(i[l]={});var u;switch(l){case"UNIT":case"PRIMEM":case"VERT_DATUM":i[l]={name:a[0].toLowerCase(),convert:a[1]},a.length===3&&Dl(a[2],i[l]);return;case"SPHEROID":case"ELLIPSOID":i[l]={name:a[0],a:a[1],rf:a[2]},a.length===4&&Dl(a[3],i[l]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":a[0]=["name",a[0]],Ap(i,l,a);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":a[0]=["name",a[0]],Ap(i,l,a),i[l].type=l;return;default:for(u=-1;++u<a.length;)if(!Array.isArray(a[u]))return Dl(a,i[l]);return Ap(i,l,a)}}var DS=.017453292519943295;function Zs(a){return a*DS}function r1(a){const i=(a.projName||"").toLowerCase().replace(/_/g," ");!a.long0&&a.longc&&(i==="albers conic equal area"||i==="lambert azimuthal equal area")&&(a.long0=a.longc),!a.lat_ts&&a.lat1&&(i==="stereographic south pole"||i==="polar stereographic (variant b)")?(a.lat0=Zs(a.lat1>0?90:-90),a.lat_ts=a.lat1,delete a.lat1):!a.lat_ts&&a.lat0&&(i==="polar stereographic"||i==="polar stereographic (variant a)")&&(a.lat_ts=a.lat0,a.lat0=Zs(a.lat0>0?90:-90),delete a.lat1)}function P0(a){let i={units:null,to_meter:void 0};return typeof a=="string"?(i.units=a.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.units==="meter"&&(i.to_meter=1)):a&&a.name&&(i.units=a.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.to_meter=a.conversion_factor),i}function E0(a){return typeof a=="object"?a.value*a.unit.conversion_factor:a}function I0(a,i){a.ellipsoid.radius?(i.a=a.ellipsoid.radius,i.rf=0):(i.a=E0(a.ellipsoid.semi_major_axis),a.ellipsoid.inverse_flattening!==void 0?i.rf=a.ellipsoid.inverse_flattening:a.ellipsoid.semi_major_axis!==void 0&&a.ellipsoid.semi_minor_axis!==void 0&&(i.rf=i.a/(i.a-E0(a.ellipsoid.semi_minor_axis))))}function Ld(a,i={}){return!a||typeof a!="object"?a:a.type==="BoundCRS"?(Ld(a.source_crs,i),a.transformation&&(a.transformation.method&&a.transformation.method.name==="NTv2"?i.nadgrids=a.transformation.parameters[0].value:i.datum_params=a.transformation.parameters.map(l=>l.value)),i):(Object.keys(a).forEach(l=>{const u=a[l];if(u!==null)switch(l){case"name":if(i.srsCode)break;i.name=u,i.srsCode=u;break;case"type":u==="GeographicCRS"?i.projName="longlat":u==="ProjectedCRS"&&a.conversion&&a.conversion.method&&(i.projName=a.conversion.method.name);break;case"datum":case"datum_ensemble":u.ellipsoid&&(i.ellps=u.ellipsoid.name,I0(u,i)),u.prime_meridian&&(i.from_greenwich=u.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":i.ellps=u.name,I0(u,i);break;case"prime_meridian":i.long0=(u.longitude||0)*Math.PI/180;break;case"coordinate_system":if(u.axis){if(i.axis=u.axis.map(p=>{const x=p.direction;if(x==="east")return"e";if(x==="north")return"n";if(x==="west")return"w";if(x==="south")return"s";throw new Error(`Unknown axis direction: ${x}`)}).join("")+"u",u.unit){const{units:p,to_meter:x}=P0(u.unit);i.units=p,i.to_meter=x}else if(u.axis[0]&&u.axis[0].unit){const{units:p,to_meter:x}=P0(u.axis[0].unit);i.units=p,i.to_meter=x}}break;case"id":u.authority&&u.code&&(i.title=u.authority+":"+u.code);break;case"conversion":u.method&&u.method.name&&(i.projName=u.method.name),u.parameters&&u.parameters.forEach(p=>{const x=p.name.toLowerCase().replace(/\s+/g,"_"),m=p.value;p.unit&&p.unit.conversion_factor?i[x]=m*p.unit.conversion_factor:p.unit==="degree"?i[x]=m*Math.PI/180:i[x]=m});break;case"unit":u.name&&(i.units=u.name.toLowerCase(),i.units==="metre"&&(i.units="meter")),u.conversion_factor&&(i.to_meter=u.conversion_factor);break;case"base_crs":Ld(u,i),i.datumCode=u.id?u.id.authority+"_"+u.id.code:u.name;break}}),i.latitude_of_false_origin!==void 0&&(i.lat0=i.latitude_of_false_origin),i.longitude_of_false_origin!==void 0&&(i.long0=i.longitude_of_false_origin),i.latitude_of_standard_parallel!==void 0&&(i.lat0=i.latitude_of_standard_parallel,i.lat1=i.latitude_of_standard_parallel),i.latitude_of_1st_standard_parallel!==void 0&&(i.lat1=i.latitude_of_1st_standard_parallel),i.latitude_of_2nd_standard_parallel!==void 0&&(i.lat2=i.latitude_of_2nd_standard_parallel),i.latitude_of_projection_centre!==void 0&&(i.lat0=i.latitude_of_projection_centre),i.longitude_of_projection_centre!==void 0&&(i.longc=i.longitude_of_projection_centre),i.easting_at_false_origin!==void 0&&(i.x0=i.easting_at_false_origin),i.northing_at_false_origin!==void 0&&(i.y0=i.northing_at_false_origin),i.latitude_of_natural_origin!==void 0&&(i.lat0=i.latitude_of_natural_origin),i.longitude_of_natural_origin!==void 0&&(i.long0=i.longitude_of_natural_origin),i.longitude_of_origin!==void 0&&(i.long0=i.longitude_of_origin),i.false_easting!==void 0&&(i.x0=i.false_easting),i.easting_at_projection_centre&&(i.x0=i.easting_at_projection_centre),i.false_northing!==void 0&&(i.y0=i.false_northing),i.northing_at_projection_centre&&(i.y0=i.northing_at_projection_centre),i.standard_parallel_1!==void 0&&(i.lat1=i.standard_parallel_1),i.standard_parallel_2!==void 0&&(i.lat2=i.standard_parallel_2),i.scale_factor_at_natural_origin!==void 0&&(i.k0=i.scale_factor_at_natural_origin),i.scale_factor_at_projection_centre!==void 0&&(i.k0=i.scale_factor_at_projection_centre),i.scale_factor_on_pseudo_standard_parallel!==void 0&&(i.k0=i.scale_factor_on_pseudo_standard_parallel),i.azimuth!==void 0&&(i.alpha=i.azimuth),i.azimuth_at_projection_centre!==void 0&&(i.alpha=i.azimuth_at_projection_centre),i.angle_from_rectified_to_skew_grid&&(i.rectified_grid_angle=i.angle_from_rectified_to_skew_grid),r1(i),i)}var zS=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function kS(a,i){var l=i[0],u=i[1];!(l in a)&&u in a&&(a[l]=a[u],i.length===3&&(a[l]=i[2](a[l])))}function s1(a){for(var i=Object.keys(a),l=0,u=i.length;l<u;++l){var p=i[l];zS.indexOf(p)!==-1&&LS(a[p]),typeof a[p]=="object"&&s1(a[p])}}function LS(a){if(a.AUTHORITY){var i=Object.keys(a.AUTHORITY)[0];i&&i in a.AUTHORITY&&(a.title=i+":"+a.AUTHORITY[i])}if(a.type==="GEOGCS"?a.projName="longlat":a.type==="LOCAL_CS"?(a.projName="identity",a.local=!0):typeof a.PROJECTION=="object"?a.projName=Object.keys(a.PROJECTION)[0]:a.projName=a.PROJECTION,a.AXIS){for(var l="",u=0,p=a.AXIS.length;u<p;++u){var x=[a.AXIS[u][0].toLowerCase(),a.AXIS[u][1].toLowerCase()];x[0].indexOf("north")!==-1||(x[0]==="y"||x[0]==="lat")&&x[1]==="north"?l+="n":x[0].indexOf("south")!==-1||(x[0]==="y"||x[0]==="lat")&&x[1]==="south"?l+="s":x[0].indexOf("east")!==-1||(x[0]==="x"||x[0]==="lon")&&x[1]==="east"?l+="e":(x[0].indexOf("west")!==-1||(x[0]==="x"||x[0]==="lon")&&x[1]==="west")&&(l+="w")}l.length===2&&(l+="u"),l.length===3&&(a.axis=l)}a.UNIT&&(a.units=a.UNIT.name.toLowerCase(),a.units==="metre"&&(a.units="meter"),a.UNIT.convert&&(a.type==="GEOGCS"?a.DATUM&&a.DATUM.SPHEROID&&(a.to_meter=a.UNIT.convert*a.DATUM.SPHEROID.a):a.to_meter=a.UNIT.convert));var m=a.GEOGCS;a.type==="GEOGCS"&&(m=a),m&&(m.DATUM?a.datumCode=m.DATUM.name.toLowerCase():a.datumCode=m.name.toLowerCase(),a.datumCode.slice(0,2)==="d_"&&(a.datumCode=a.datumCode.slice(2)),a.datumCode==="new_zealand_1949"&&(a.datumCode="nzgd49"),(a.datumCode==="wgs_1984"||a.datumCode==="world_geodetic_system_1984")&&(a.PROJECTION==="Mercator_Auxiliary_Sphere"&&(a.sphere=!0),a.datumCode="wgs84"),a.datumCode==="belge_1972"&&(a.datumCode="rnb72"),m.DATUM&&m.DATUM.SPHEROID&&(a.ellps=m.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),a.ellps.toLowerCase().slice(0,13)==="international"&&(a.ellps="intl"),a.a=m.DATUM.SPHEROID.a,a.rf=parseFloat(m.DATUM.SPHEROID.rf,10)),m.DATUM&&m.DATUM.TOWGS84&&(a.datum_params=m.DATUM.TOWGS84),~a.datumCode.indexOf("osgb_1936")&&(a.datumCode="osgb36"),~a.datumCode.indexOf("osni_1952")&&(a.datumCode="osni52"),(~a.datumCode.indexOf("tm65")||~a.datumCode.indexOf("geodetic_datum_of_1965"))&&(a.datumCode="ire65"),a.datumCode==="ch1903+"&&(a.datumCode="ch1903"),~a.datumCode.indexOf("israel")&&(a.datumCode="isr93")),a.b&&!isFinite(a.b)&&(a.b=a.a),a.rectified_grid_angle&&(a.rectified_grid_angle=Zs(a.rectified_grid_angle));function o(L){var z=a.to_meter||1;return L*z}var P=function(L){return kS(a,L)},A=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Zs],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Zs],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Zs],["lat0","latitude_of_origin",Zs],["lat0","standard_parallel_1",Zs],["lat1","standard_parallel_1",Zs],["lat2","standard_parallel_2",Zs],["azimuth","Azimuth"],["alpha","azimuth",Zs],["srsCode","name"]];A.forEach(P),r1(a)}function tm(a){if(typeof a=="object")return Ld(a);const i=ES(a);var l=RS(a);if(i==="WKT2"){const x=PS(l);return Ld(x)}var u=l[0],p={};return Dl(l,p),s1(p),p[u]}function Kr(a){var i=this;if(arguments.length===2){var l=arguments[1];typeof l=="string"?l.charAt(0)==="+"?Kr[a]=Qp(arguments[1]):Kr[a]=tm(arguments[1]):Kr[a]=l}else if(arguments.length===1){if(Array.isArray(a))return a.map(function(u){Array.isArray(u)?Kr.apply(i,u):Kr(u)});if(typeof a=="string"){if(a in Kr)return Kr[a]}else"EPSG"in a?Kr["EPSG:"+a.EPSG]=a:"ESRI"in a?Kr["ESRI:"+a.ESRI]=a:"IAU2000"in a?Kr["IAU2000:"+a.IAU2000]=a:console.log(a);return}}gS(Kr);function OS(a){return typeof a=="string"}function FS(a){return a in Kr}function BS(a){return a.indexOf("+")!==0&&a.indexOf("[")!==-1||typeof a=="object"&&!("srsCode"in a)}var NS=["3857","900913","3785","102113"];function GS(a){var i=wa(a,"authority");if(i){var l=wa(i,"epsg");return l&&NS.indexOf(l)>-1}}function jS(a){var i=wa(a,"extension");if(i)return wa(i,"proj4")}function US(a){return a[0]==="+"}function VS(a){if(OS(a)){if(FS(a))return Kr[a];if(BS(a)){var i=tm(a);if(GS(i))return Kr["EPSG:3857"];var l=jS(i);return l?Qp(l):i}if(US(a))return Qp(a)}else return a.projName?a:tm(a)}function C0(a,i){a=a||{};var l,u;if(!i)return a;for(u in i)l=i[u],l!==void 0&&(a[u]=l);return a}function yn(a,i,l){var u=a*i;return l/Math.sqrt(1-u*u)}function Bc(a){return a<0?-1:1}function fe(a){return Math.abs(a)<=Lr?a:a-Bc(a)*Ac}function Ws(a,i,l){var u=a*l,p=.5*a;return u=Math.pow((1-u)/(1+u),p),Math.tan(.5*(Qt-i))/u}function Dc(a,i){for(var l=.5*a,u,p,x=Qt-2*Math.atan(i),m=0;m<=15;m++)if(u=a*Math.sin(x),p=Qt-2*Math.atan(i*Math.pow((1-u)/(1+u),l))-x,x+=p,Math.abs(p)<=1e-10)return x;return-9999}function $S(){var a=this.b/this.a;this.es=1-a*a,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=yn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function qS(a){var i=a.x,l=a.y;if(l*gn>90&&l*gn<-90&&i*gn>180&&i*gn<-180)return null;var u,p;if(Math.abs(Math.abs(l)-Qt)<=le)return null;if(this.sphere)u=this.x0+this.a*this.k0*fe(i-this.long0),p=this.y0+this.a*this.k0*Math.log(Math.tan(xi+.5*l));else{var x=Math.sin(l),m=Ws(this.e,l,x);u=this.x0+this.a*this.k0*fe(i-this.long0),p=this.y0-this.a*this.k0*Math.log(m)}return a.x=u,a.y=p,a}function ZS(a){var i=a.x-this.x0,l=a.y-this.y0,u,p;if(this.sphere)p=Qt-2*Math.atan(Math.exp(-l/(this.a*this.k0)));else{var x=Math.exp(-l/(this.a*this.k0));if(p=Dc(this.e,x),p===-9999)return null}return u=fe(this.long0+i/(this.a*this.k0)),a.x=u,a.y=p,a}var WS=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const XS={init:$S,forward:qS,inverse:ZS,names:WS};function HS(){}function A0(a){return a}var KS=["longlat","identity"];const YS={init:HS,forward:A0,inverse:A0,names:KS};var JS=[XS,YS],yo={},zl=[];function n1(a,i){var l=zl.length;return a.names?(zl[l]=a,a.names.forEach(function(u){yo[u.toLowerCase()]=l}),this):(console.log(i),!0)}function a1(a){return a.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function QS(a){if(!a)return!1;var i=a.toLowerCase();if(typeof yo[i]<"u"&&zl[yo[i]]||(i=a1(i),i in yo&&zl[yo[i]]))return zl[yo[i]]}function tT(){JS.forEach(n1)}const eT={start:tT,add:n1,get:QS};var o1={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const iT=o1.WGS84;function rT(a,i,l,u){var p=a*a,x=i*i,m=(p-x)/p,o=0;u?(a*=1-m*(vS+m*(xS+m*bS)),p=a*a,m=0):o=Math.sqrt(m);var P=(p-x)/x;return{es:m,e:o,ep2:P}}function sT(a,i,l,u,p){if(!a){var x=wa(o1,u);x||(x=iT),a=x.a,i=x.b,l=x.rf}return l&&!i&&(i=(1-1/l)*a),(l===0||Math.abs(a-i)<le)&&(p=!0,i=a),{a,b:i,rf:l,sphere:p}}var bd={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var nT in bd){var Rp=bd[nT];Rp.datumName&&(bd[Rp.datumName]=Rp)}function aT(a,i,l,u,p,x,m){var o={};return a===void 0||a==="none"?o.datum_type=Jp:o.datum_type=_S,i&&(o.datum_params=i.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=So),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=To,o.datum_params[3]*=wc,o.datum_params[4]*=wc,o.datum_params[5]*=wc,o.datum_params[6]=o.datum_params[6]/1e6+1)),m&&(o.datum_type=Gl,o.grids=m),o.a=l,o.b=u,o.es=p,o.ep2=x,o}var Rm={};function oT(a,i,l){return i instanceof ArrayBuffer?lT(a,i,l):{ready:hT(a,i)}}function lT(a,i,l){var u=!0;l!==void 0&&l.includeErrorFields===!1&&(u=!1);var p=new DataView(i),x=dT(p),m=fT(p,x),o=pT(p,m,x,u),P={header:m,subgrids:o};return Rm[a]=P,P}async function hT(a,i){for(var l=[],u=await i.getImageCount(),p=u-1;p>=0;p--){var x=await i.getImage(p),m=await x.readRasters(),o=m,P=[x.getWidth(),x.getHeight()],A=x.getBoundingBox().map(R0),L=[x.fileDirectory.ModelPixelScale[0],x.fileDirectory.ModelPixelScale[1]].map(R0),z=A[0]+(P[0]-1)*L[0],D=A[3]-(P[1]-1)*L[1],B=o[0],$=o[1],et=[];for(let dt=P[1]-1;dt>=0;dt--)for(let Ot=P[0]-1;Ot>=0;Ot--){var it=dt*P[0]+Ot;et.push([-ya($[it]),ya(B[it])])}l.push({del:L,lim:P,ll:[-z,D],cvs:et})}var ft={header:{nSubgrids:u},subgrids:l};return Rm[a]=ft,ft}function cT(a){if(a===void 0)return null;var i=a.split(",");return i.map(uT)}function uT(a){if(a.length===0)return null;var i=a[0]==="@";return i&&(a=a.slice(1)),a==="null"?{name:"null",mandatory:!i,grid:null,isNull:!0}:{name:a,mandatory:!i,grid:Rm[a]||null,isNull:!1}}function R0(a){return a*Math.PI/180}function ya(a){return a/3600*Math.PI/180}function dT(a){var i=a.getInt32(8,!1);return i===11?!1:(i=a.getInt32(8,!0),i!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function fT(a,i){return{nFields:a.getInt32(8,i),nSubgridFields:a.getInt32(24,i),nSubgrids:a.getInt32(40,i),shiftType:em(a,56,64).trim(),fromSemiMajorAxis:a.getFloat64(120,i),fromSemiMinorAxis:a.getFloat64(136,i),toSemiMajorAxis:a.getFloat64(152,i),toSemiMinorAxis:a.getFloat64(168,i)}}function em(a,i,l){return String.fromCharCode.apply(null,new Uint8Array(a.buffer.slice(i,l)))}function pT(a,i,l,u){for(var p=176,x=[],m=0;m<i.nSubgrids;m++){var o=gT(a,p,l),P=_T(a,p,o,l,u),A=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),L=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);x.push({ll:[ya(o.lowerLongitude),ya(o.lowerLatitude)],del:[ya(o.longitudeInterval),ya(o.latitudeInterval)],lim:[A,L],count:o.gridNodeCount,cvs:mT(P)});var z=16;u===!1&&(z=8),p+=176+o.gridNodeCount*z}return x}function mT(a){return a.map(function(i){return[ya(i.longitudeShift),ya(i.latitudeShift)]})}function gT(a,i,l){return{name:em(a,i+8,i+16).trim(),parent:em(a,i+24,i+24+8).trim(),lowerLatitude:a.getFloat64(i+72,l),upperLatitude:a.getFloat64(i+88,l),lowerLongitude:a.getFloat64(i+104,l),upperLongitude:a.getFloat64(i+120,l),latitudeInterval:a.getFloat64(i+136,l),longitudeInterval:a.getFloat64(i+152,l),gridNodeCount:a.getInt32(i+168,l)}}function _T(a,i,l,u,p){var x=i+176,m=16;p===!1&&(m=8);for(var o=[],P=0;P<l.gridNodeCount;P++){var A={latitudeShift:a.getFloat32(x+P*m,u),longitudeShift:a.getFloat32(x+P*m+4,u)};p!==!1&&(A.latitudeAccuracy=a.getFloat32(x+P*m+8,u),A.longitudeAccuracy=a.getFloat32(x+P*m+12,u)),o.push(A)}return o}function _n(a,i){if(!(this instanceof _n))return new _n(a);i=i||function(A){if(A)throw A};var l=VS(a);if(typeof l!="object"){i("Could not parse to valid json: "+a);return}var u=_n.projections.get(l.projName);if(!u){i("Could not get projection name from: "+a);return}if(l.datumCode&&l.datumCode!=="none"){var p=wa(bd,l.datumCode);p&&(l.datum_params=l.datum_params||(p.towgs84?p.towgs84.split(","):null),l.ellps=p.ellipse,l.datumName=p.datumName?p.datumName:l.datumCode)}l.k0=l.k0||1,l.axis=l.axis||"enu",l.ellps=l.ellps||"wgs84",l.lat1=l.lat1||l.lat0;var x=sT(l.a,l.b,l.rf,l.ellps,l.sphere),m=rT(x.a,x.b,x.rf,l.R_A),o=cT(l.nadgrids),P=l.datum||aT(l.datumCode,l.datum_params,x.a,x.b,m.es,m.ep2,o);C0(this,l),C0(this,u),this.a=x.a,this.b=x.b,this.rf=x.rf,this.sphere=x.sphere,this.es=m.es,this.e=m.e,this.ep2=m.ep2,this.datum=P,this.init(),i(null,this)}_n.projections=eT;_n.projections.start();function yT(a,i){return a.datum_type!==i.datum_type||a.a!==i.a||Math.abs(a.es-i.es)>5e-11?!1:a.datum_type===So?a.datum_params[0]===i.datum_params[0]&&a.datum_params[1]===i.datum_params[1]&&a.datum_params[2]===i.datum_params[2]:a.datum_type===To?a.datum_params[0]===i.datum_params[0]&&a.datum_params[1]===i.datum_params[1]&&a.datum_params[2]===i.datum_params[2]&&a.datum_params[3]===i.datum_params[3]&&a.datum_params[4]===i.datum_params[4]&&a.datum_params[5]===i.datum_params[5]&&a.datum_params[6]===i.datum_params[6]:!0}function l1(a,i,l){var u=a.x,p=a.y,x=a.z?a.z:0,m,o,P,A;if(p<-Qt&&p>-1.001*Qt)p=-Qt;else if(p>Qt&&p<1.001*Qt)p=Qt;else{if(p<-Qt)return{x:-1/0,y:-1/0,z:a.z};if(p>Qt)return{x:1/0,y:1/0,z:a.z}}return u>Math.PI&&(u-=2*Math.PI),o=Math.sin(p),A=Math.cos(p),P=o*o,m=l/Math.sqrt(1-i*P),{x:(m+x)*A*Math.cos(u),y:(m+x)*A*Math.sin(u),z:(m*(1-i)+x)*o}}function h1(a,i,l,u){var p=1e-12,x=p*p,m=30,o,P,A,L,z,D,B,$,et,it,ft,dt,Ot,jt=a.x,Gt=a.y,re=a.z?a.z:0,Ie,_e,Re;if(o=Math.sqrt(jt*jt+Gt*Gt),P=Math.sqrt(jt*jt+Gt*Gt+re*re),o/l<p){if(Ie=0,P/l<p)return _e=Qt,Re=-u,{x:a.x,y:a.y,z:a.z}}else Ie=Math.atan2(Gt,jt);A=re/P,L=o/P,z=1/Math.sqrt(1-i*(2-i)*L*L),$=L*(1-i)*z,et=A*z,Ot=0;do Ot++,B=l/Math.sqrt(1-i*et*et),Re=o*$+re*et-B*(1-i*et*et),D=i*B/(B+Re),z=1/Math.sqrt(1-D*(2-D)*L*L),it=L*(1-D)*z,ft=A*z,dt=ft*$-it*et,$=it,et=ft;while(dt*dt>x&&Ot<m);return _e=Math.atan(ft/Math.abs(it)),{x:Ie,y:_e,z:Re}}function vT(a,i,l){if(i===So)return{x:a.x+l[0],y:a.y+l[1],z:a.z+l[2]};if(i===To){var u=l[0],p=l[1],x=l[2],m=l[3],o=l[4],P=l[5],A=l[6];return{x:A*(a.x-P*a.y+o*a.z)+u,y:A*(P*a.x+a.y-m*a.z)+p,z:A*(-o*a.x+m*a.y+a.z)+x}}}function xT(a,i,l){if(i===So)return{x:a.x-l[0],y:a.y-l[1],z:a.z-l[2]};if(i===To){var u=l[0],p=l[1],x=l[2],m=l[3],o=l[4],P=l[5],A=l[6],L=(a.x-u)/A,z=(a.y-p)/A,D=(a.z-x)/A;return{x:L+P*z-o*D,y:-P*L+z+m*D,z:o*L-m*z+D}}}function pd(a){return a===So||a===To}function bT(a,i,l){if(yT(a,i)||a.datum_type===Jp||i.datum_type===Jp)return l;var u=a.a,p=a.es;if(a.datum_type===Gl){var x=D0(a,!1,l);if(x!==0)return;u=M0,p=S0}var m=i.a,o=i.b,P=i.es;if(i.datum_type===Gl&&(m=M0,o=yS,P=S0),p===P&&u===m&&!pd(a.datum_type)&&!pd(i.datum_type))return l;if(l=l1(l,p,u),pd(a.datum_type)&&(l=vT(l,a.datum_type,a.datum_params)),pd(i.datum_type)&&(l=xT(l,i.datum_type,i.datum_params)),l=h1(l,P,m,o),i.datum_type===Gl){var A=D0(i,!0,l);if(A!==0)return}return l}function D0(a,i,l){if(a.grids===null||a.grids.length===0)return console.log("Grid shift grids not found"),-1;var u={x:-l.x,y:l.y},p={x:Number.NaN,y:Number.NaN},x=[];t:for(var m=0;m<a.grids.length;m++){var o=a.grids[m];if(x.push(o.name),o.isNull){p=u;break}if(o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var P=o.grid.subgrids,A=0,L=P.length;A<L;A++){var z=P[A],D=(Math.abs(z.del[1])+Math.abs(z.del[0]))/1e4,B=z.ll[0]-D,$=z.ll[1]-D,et=z.ll[0]+(z.lim[0]-1)*z.del[0]+D,it=z.ll[1]+(z.lim[1]-1)*z.del[1]+D;if(!($>u.y||B>u.x||it<u.y||et<u.x)&&(p=wT(u,i,z),!isNaN(p.x)))break t}}return isNaN(p.x)?(console.log("Failed to find a grid shift table for location '"+-u.x*gn+" "+u.y*gn+" tried: '"+x+"'"),-1):(l.x=-p.x,l.y=p.y,0)}function wT(a,i,l){var u={x:Number.NaN,y:Number.NaN};if(isNaN(a.x))return u;var p={x:a.x,y:a.y};p.x-=l.ll[0],p.y-=l.ll[1],p.x=fe(p.x-Math.PI)+Math.PI;var x=z0(p,l);if(i){if(isNaN(x.x))return u;x.x=p.x-x.x,x.y=p.y-x.y;var m=9,o=1e-12,P,A;do{if(A=z0(x,l),isNaN(A.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}P={x:p.x-(A.x+x.x),y:p.y-(A.y+x.y)},x.x+=P.x,x.y+=P.y}while(m--&&Math.abs(P.x)>o&&Math.abs(P.y)>o);if(m<0)return console.log("Inverse grid shift iterator failed to converge."),u;u.x=fe(x.x+l.ll[0]),u.y=x.y+l.ll[1]}else isNaN(x.x)||(u.x=a.x+x.x,u.y=a.y+x.y);return u}function z0(a,i){var l={x:a.x/i.del[0],y:a.y/i.del[1]},u={x:Math.floor(l.x),y:Math.floor(l.y)},p={x:l.x-1*u.x,y:l.y-1*u.y},x={x:Number.NaN,y:Number.NaN},m;if(u.x<0||u.x>=i.lim[0]||u.y<0||u.y>=i.lim[1])return x;m=u.y*i.lim[0]+u.x;var o={x:i.cvs[m][0],y:i.cvs[m][1]};m++;var P={x:i.cvs[m][0],y:i.cvs[m][1]};m+=i.lim[0];var A={x:i.cvs[m][0],y:i.cvs[m][1]};m--;var L={x:i.cvs[m][0],y:i.cvs[m][1]},z=p.x*p.y,D=p.x*(1-p.y),B=(1-p.x)*(1-p.y),$=(1-p.x)*p.y;return x.x=B*o.x+D*P.x+$*L.x+z*A.x,x.y=B*o.y+D*P.y+$*L.y+z*A.y,x}function k0(a,i,l){var u=l.x,p=l.y,x=l.z||0,m,o,P,A={};for(P=0;P<3;P++)if(!(i&&P===2&&l.z===void 0))switch(P===0?(m=u,"ew".indexOf(a.axis[P])!==-1?o="x":o="y"):P===1?(m=p,"ns".indexOf(a.axis[P])!==-1?o="y":o="x"):(m=x,o="z"),a.axis[P]){case"e":A[o]=m;break;case"w":A[o]=-m;break;case"n":A[o]=m;break;case"s":A[o]=-m;break;case"u":l[o]!==void 0&&(A.z=m);break;case"d":l[o]!==void 0&&(A.z=-m);break;default:return null}return A}function c1(a){var i={x:a[0],y:a[1]};return a.length>2&&(i.z=a[2]),a.length>3&&(i.m=a[3]),i}function MT(a){L0(a.x),L0(a.y)}function L0(a){if(typeof Number.isFinite=="function"){if(Number.isFinite(a))return;throw new TypeError("coordinates must be finite numbers")}if(typeof a!="number"||a!==a||!isFinite(a))throw new TypeError("coordinates must be finite numbers")}function ST(a,i){return(a.datum.datum_type===So||a.datum.datum_type===To||a.datum.datum_type===Gl)&&i.datumCode!=="WGS84"||(i.datum.datum_type===So||i.datum.datum_type===To||i.datum.datum_type===Gl)&&a.datumCode!=="WGS84"}function Od(a,i,l,u){var p;Array.isArray(l)?l=c1(l):l={x:l.x,y:l.y,z:l.z,m:l.m};var x=l.z!==void 0;if(MT(l),a.datum&&i.datum&&ST(a,i)&&(p=new _n("WGS84"),l=Od(a,p,l,u),a=p),u&&a.axis!=="enu"&&(l=k0(a,!1,l)),a.projName==="longlat")l={x:l.x*Ai,y:l.y*Ai,z:l.z||0};else if(a.to_meter&&(l={x:l.x*a.to_meter,y:l.y*a.to_meter,z:l.z||0}),l=a.inverse(l),!l)return;if(a.from_greenwich&&(l.x+=a.from_greenwich),l=bT(a.datum,i.datum,l),!!l)return i.from_greenwich&&(l={x:l.x-i.from_greenwich,y:l.y,z:l.z||0}),i.projName==="longlat"?l={x:l.x*gn,y:l.y*gn,z:l.z||0}:(l=i.forward(l),i.to_meter&&(l={x:l.x/i.to_meter,y:l.y/i.to_meter,z:l.z||0})),u&&i.axis!=="enu"?k0(i,!0,l):(l&&!x&&delete l.z,l)}var O0=_n("WGS84");function Dp(a,i,l,u){var p,x,m;return Array.isArray(l)?(p=Od(a,i,l,u)||{x:NaN,y:NaN},l.length>2?typeof a.name<"u"&&a.name==="geocent"||typeof i.name<"u"&&i.name==="geocent"?typeof p.z=="number"?[p.x,p.y,p.z].concat(l.slice(3)):[p.x,p.y,l[2]].concat(l.slice(3)):[p.x,p.y].concat(l.slice(2)):[p.x,p.y]):(x=Od(a,i,l,u),m=Object.keys(l),m.length===2||m.forEach(function(o){if(typeof a.name<"u"&&a.name==="geocent"||typeof i.name<"u"&&i.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;x[o]=l[o]}),x)}function F0(a){return a instanceof _n?a:a.oProj?a.oProj:_n(a)}function Rs(a,i,l){a=F0(a);var u=!1,p;return typeof i>"u"?(i=a,a=O0,u=!0):(typeof i.x<"u"||Array.isArray(i))&&(l=i,i=a,a=O0,u=!0),i=F0(i),l?Dp(a,i,l):(p={forward:function(x,m){return Dp(a,i,x,m)},inverse:function(x,m){return Dp(i,a,x,m)}},u&&(p.oProj=i),p)}var B0=6,u1="AJSAJS",d1="AFAFAF",kl=65,as=73,Cs=79,fc=86,pc=90;const TT={forward:f1,inverse:PT,toPoint:p1};function f1(a,i){return i=i||5,CT(ET({lat:a[1],lon:a[0]}),i)}function PT(a){var i=Dm(g1(a.toUpperCase()));return i.lat&&i.lon?[i.lon,i.lat,i.lon,i.lat]:[i.left,i.bottom,i.right,i.top]}function p1(a){var i=Dm(g1(a.toUpperCase()));return i.lat&&i.lon?[i.lon,i.lat]:[(i.left+i.right)/2,(i.top+i.bottom)/2]}function zp(a){return a*(Math.PI/180)}function N0(a){return 180*(a/Math.PI)}function ET(a){var i=a.lat,l=a.lon,u=6378137,p=.00669438,x=.9996,m,o,P,A,L,z,D,B=zp(i),$=zp(l),et,it;it=Math.floor((l+180)/6)+1,l===180&&(it=60),i>=56&&i<64&&l>=3&&l<12&&(it=32),i>=72&&i<84&&(l>=0&&l<9?it=31:l>=9&&l<21?it=33:l>=21&&l<33?it=35:l>=33&&l<42&&(it=37)),m=(it-1)*6-180+3,et=zp(m),o=p/(1-p),P=u/Math.sqrt(1-p*Math.sin(B)*Math.sin(B)),A=Math.tan(B)*Math.tan(B),L=o*Math.cos(B)*Math.cos(B),z=Math.cos(B)*($-et),D=u*((1-p/4-3*p*p/64-5*p*p*p/256)*B-(3*p/8+3*p*p/32+45*p*p*p/1024)*Math.sin(2*B)+(15*p*p/256+45*p*p*p/1024)*Math.sin(4*B)-35*p*p*p/3072*Math.sin(6*B));var ft=x*P*(z+(1-A+L)*z*z*z/6+(5-18*A+A*A+72*L-58*o)*z*z*z*z*z/120)+5e5,dt=x*(D+P*Math.tan(B)*(z*z/2+(5-A+9*L+4*L*L)*z*z*z*z/24+(61-58*A+A*A+600*L-330*o)*z*z*z*z*z*z/720));return i<0&&(dt+=1e7),{northing:Math.round(dt),easting:Math.round(ft),zoneNumber:it,zoneLetter:IT(i)}}function Dm(a){var i=a.northing,l=a.easting,u=a.zoneLetter,p=a.zoneNumber;if(p<0||p>60)return null;var x=.9996,m=6378137,o=.00669438,P,A=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),L,z,D,B,$,et,it,ft,dt,Ot=l-5e5,jt=i;u<"N"&&(jt-=1e7),it=(p-1)*6-180+3,P=o/(1-o),et=jt/x,ft=et/(m*(1-o/4-3*o*o/64-5*o*o*o/256)),dt=ft+(3*A/2-27*A*A*A/32)*Math.sin(2*ft)+(21*A*A/16-55*A*A*A*A/32)*Math.sin(4*ft)+151*A*A*A/96*Math.sin(6*ft),L=m/Math.sqrt(1-o*Math.sin(dt)*Math.sin(dt)),z=Math.tan(dt)*Math.tan(dt),D=P*Math.cos(dt)*Math.cos(dt),B=m*(1-o)/Math.pow(1-o*Math.sin(dt)*Math.sin(dt),1.5),$=Ot/(L*x);var Gt=dt-L*Math.tan(dt)/B*($*$/2-(5+3*z+10*D-4*D*D-9*P)*$*$*$*$/24+(61+90*z+298*D+45*z*z-252*P-3*D*D)*$*$*$*$*$*$/720);Gt=N0(Gt);var re=($-(1+2*z+D)*$*$*$/6+(5-2*D+28*z-3*D*D+8*P+24*z*z)*$*$*$*$*$/120)/Math.cos(dt);re=it+N0(re);var Ie;if(a.accuracy){var _e=Dm({northing:a.northing+a.accuracy,easting:a.easting+a.accuracy,zoneLetter:a.zoneLetter,zoneNumber:a.zoneNumber});Ie={top:_e.lat,right:_e.lon,bottom:Gt,left:re}}else Ie={lat:Gt,lon:re};return Ie}function IT(a){var i="Z";return 84>=a&&a>=72?i="X":72>a&&a>=64?i="W":64>a&&a>=56?i="V":56>a&&a>=48?i="U":48>a&&a>=40?i="T":40>a&&a>=32?i="S":32>a&&a>=24?i="R":24>a&&a>=16?i="Q":16>a&&a>=8?i="P":8>a&&a>=0?i="N":0>a&&a>=-8?i="M":-8>a&&a>=-16?i="L":-16>a&&a>=-24?i="K":-24>a&&a>=-32?i="J":-32>a&&a>=-40?i="H":-40>a&&a>=-48?i="G":-48>a&&a>=-56?i="F":-56>a&&a>=-64?i="E":-64>a&&a>=-72?i="D":-72>a&&a>=-80&&(i="C"),i}function CT(a,i){var l="00000"+a.easting,u="00000"+a.northing;return a.zoneNumber+a.zoneLetter+AT(a.easting,a.northing,a.zoneNumber)+l.substr(l.length-5,i)+u.substr(u.length-5,i)}function AT(a,i,l){var u=m1(l),p=Math.floor(a/1e5),x=Math.floor(i/1e5)%20;return RT(p,x,u)}function m1(a){var i=a%B0;return i===0&&(i=B0),i}function RT(a,i,l){var u=l-1,p=u1.charCodeAt(u),x=d1.charCodeAt(u),m=p+a-1,o=x+i,P=!1;m>pc&&(m=m-pc+kl-1,P=!0),(m===as||p<as&&m>as||(m>as||p<as)&&P)&&m++,(m===Cs||p<Cs&&m>Cs||(m>Cs||p<Cs)&&P)&&(m++,m===as&&m++),m>pc&&(m=m-pc+kl-1),o>fc?(o=o-fc+kl-1,P=!0):P=!1,(o===as||x<as&&o>as||(o>as||x<as)&&P)&&o++,(o===Cs||x<Cs&&o>Cs||(o>Cs||x<Cs)&&P)&&(o++,o===as&&o++),o>fc&&(o=o-fc+kl-1);var A=String.fromCharCode(m)+String.fromCharCode(o);return A}function g1(a){if(a&&a.length===0)throw"MGRSPoint coverting from nothing";for(var i=a.length,l=null,u="",p,x=0;!/[A-Z]/.test(p=a.charAt(x));){if(x>=2)throw"MGRSPoint bad conversion from: "+a;u+=p,x++}var m=parseInt(u,10);if(x===0||x+3>i)throw"MGRSPoint bad conversion from: "+a;var o=a.charAt(x++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+a;l=a.substring(x,x+=2);for(var P=m1(m),A=DT(l.charAt(0),P),L=zT(l.charAt(1),P);L<kT(o);)L+=2e6;var z=i-x;if(z%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+a;var D=z/2,B=0,$=0,et,it,ft,dt,Ot;return D>0&&(et=1e5/Math.pow(10,D),it=a.substring(x,x+D),B=parseFloat(it)*et,ft=a.substring(x+D),$=parseFloat(ft)*et),dt=B+A,Ot=$+L,{easting:dt,northing:Ot,zoneLetter:o,zoneNumber:m,accuracy:et}}function DT(a,i){for(var l=u1.charCodeAt(i-1),u=1e5,p=!1;l!==a.charCodeAt(0);){if(l++,l===as&&l++,l===Cs&&l++,l>pc){if(p)throw"Bad character: "+a;l=kl,p=!0}u+=1e5}return u}function zT(a,i){if(a>"V")throw"MGRSPoint given invalid Northing "+a;for(var l=d1.charCodeAt(i-1),u=0,p=!1;l!==a.charCodeAt(0);){if(l++,l===as&&l++,l===Cs&&l++,l>fc){if(p)throw"Bad character: "+a;l=kl,p=!0}u+=1e5}return u}function kT(a){var i;switch(a){case"C":i=11e5;break;case"D":i=2e6;break;case"E":i=28e5;break;case"F":i=37e5;break;case"G":i=46e5;break;case"H":i=55e5;break;case"J":i=64e5;break;case"K":i=73e5;break;case"L":i=82e5;break;case"M":i=91e5;break;case"N":i=0;break;case"P":i=8e5;break;case"Q":i=17e5;break;case"R":i=26e5;break;case"S":i=35e5;break;case"T":i=44e5;break;case"U":i=53e5;break;case"V":i=62e5;break;case"W":i=7e6;break;case"X":i=79e5;break;default:i=-1}if(i>=0)return i;throw"Invalid zone letter: "+a}function ql(a,i,l){if(!(this instanceof ql))return new ql(a,i,l);if(Array.isArray(a))this.x=a[0],this.y=a[1],this.z=a[2]||0;else if(typeof a=="object")this.x=a.x,this.y=a.y,this.z=a.z||0;else if(typeof a=="string"&&typeof i>"u"){var u=a.split(",");this.x=parseFloat(u[0],10),this.y=parseFloat(u[1],10),this.z=parseFloat(u[2],10)||0}else this.x=a,this.y=i,this.z=l||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}ql.fromMGRS=function(a){return new ql(p1(a))};ql.prototype.toMGRS=function(a){return f1([this.x,this.y],a)};var LT=1,OT=.25,G0=.046875,j0=.01953125,U0=.01068115234375,FT=.75,BT=.46875,NT=.013020833333333334,GT=.007120768229166667,jT=.3645833333333333,UT=.005696614583333333,VT=.3076171875;function zm(a){var i=[];i[0]=LT-a*(OT+a*(G0+a*(j0+a*U0))),i[1]=a*(FT-a*(G0+a*(j0+a*U0)));var l=a*a;return i[2]=l*(BT-a*(NT+a*GT)),l*=a,i[3]=l*(jT-a*UT),i[4]=l*a*VT,i}function Kl(a,i,l,u){return l*=i,i*=i,u[0]*a-l*(u[1]+i*(u[2]+i*(u[3]+i*u[4])))}var $T=20;function km(a,i,l){for(var u=1/(1-i),p=a,x=$T;x;--x){var m=Math.sin(p),o=1-i*m*m;if(o=(Kl(p,m,Math.cos(p),l)-a)*(o*Math.sqrt(o))*u,p-=o,Math.abs(o)<le)return p}return p}function qT(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=zm(this.es),this.ml0=Kl(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function ZT(a){var i=a.x,l=a.y,u=fe(i-this.long0),p,x,m,o=Math.sin(l),P=Math.cos(l);if(this.es){var L=P*u,z=Math.pow(L,2),D=this.ep2*Math.pow(P,2),B=Math.pow(D,2),$=Math.abs(P)>le?Math.tan(l):0,et=Math.pow($,2),it=Math.pow(et,2);p=1-this.es*Math.pow(o,2),L=L/Math.sqrt(p);var ft=Kl(l,o,P,this.en);x=this.a*(this.k0*L*(1+z/6*(1-et+D+z/20*(5-18*et+it+14*D-58*et*D+z/42*(61+179*it-it*et-479*et)))))+this.x0,m=this.a*(this.k0*(ft-this.ml0+o*u*L/2*(1+z/12*(5-et+9*D+4*B+z/30*(61+it-58*et+270*D-330*et*D+z/56*(1385+543*it-it*et-3111*et))))))+this.y0}else{var A=P*Math.sin(u);if(Math.abs(Math.abs(A)-1)<le)return 93;if(x=.5*this.a*this.k0*Math.log((1+A)/(1-A))+this.x0,m=P*Math.cos(u)/Math.sqrt(1-Math.pow(A,2)),A=Math.abs(m),A>=1){if(A-1>le)return 93;m=0}else m=Math.acos(m);l<0&&(m=-m),m=this.a*this.k0*(m-this.lat0)+this.y0}return a.x=x,a.y=m,a}function WT(a){var i,l,u,p,x=(a.x-this.x0)*(1/this.a),m=(a.y-this.y0)*(1/this.a);if(this.es)if(i=this.ml0+m/this.k0,l=km(i,this.es,this.en),Math.abs(l)<Qt){var z=Math.sin(l),D=Math.cos(l),B=Math.abs(D)>le?Math.tan(l):0,$=this.ep2*Math.pow(D,2),et=Math.pow($,2),it=Math.pow(B,2),ft=Math.pow(it,2);i=1-this.es*Math.pow(z,2);var dt=x*Math.sqrt(i)/this.k0,Ot=Math.pow(dt,2);i=i*B,u=l-i*Ot/(1-this.es)*.5*(1-Ot/12*(5+3*it-9*$*it+$-4*et-Ot/30*(61+90*it-252*$*it+45*ft+46*$-Ot/56*(1385+3633*it+4095*ft+1574*ft*it)))),p=fe(this.long0+dt*(1-Ot/6*(1+2*it+$-Ot/20*(5+28*it+24*ft+8*$*it+6*$-Ot/42*(61+662*it+1320*ft+720*ft*it))))/D)}else u=Qt*Bc(m),p=0;else{var o=Math.exp(x/this.k0),P=.5*(o-1/o),A=this.lat0+m/this.k0,L=Math.cos(A);i=Math.sqrt((1-Math.pow(L,2))/(1+Math.pow(P,2))),u=Math.asin(i),m<0&&(u=-u),P===0&&L===0?p=0:p=fe(Math.atan2(P,L)+this.long0)}return a.x=p,a.y=u,a}var XT=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const wd={init:qT,forward:ZT,inverse:WT,names:XT};function _1(a){var i=Math.exp(a);return i=(i-1/i)/2,i}function os(a,i){a=Math.abs(a),i=Math.abs(i);var l=Math.max(a,i),u=Math.min(a,i)/(l||1);return l*Math.sqrt(1+Math.pow(u,2))}function HT(a){var i=1+a,l=i-1;return l===0?a:a*Math.log(i)/l}function KT(a){var i=Math.abs(a);return i=HT(i*(1+i/(os(1,i)+1))),a<0?-i:i}function Lm(a,i){for(var l=2*Math.cos(2*i),u=a.length-1,p=a[u],x=0,m;--u>=0;)m=-x+l*p+a[u],x=p,p=m;return i+m*Math.sin(2*i)}function YT(a,i){for(var l=2*Math.cos(i),u=a.length-1,p=a[u],x=0,m;--u>=0;)m=-x+l*p+a[u],x=p,p=m;return Math.sin(i)*m}function JT(a){var i=Math.exp(a);return i=(i+1/i)/2,i}function y1(a,i,l){for(var u=Math.sin(i),p=Math.cos(i),x=_1(l),m=JT(l),o=2*p*m,P=-2*u*x,A=a.length-1,L=a[A],z=0,D=0,B=0,$,et;--A>=0;)$=D,et=z,D=L,z=B,L=-$+o*D-P*z+a[A],B=-et+P*D+o*z;return o=u*m,P=p*x,[o*L-P*B,o*B+P*L]}function QT(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(wd.init.apply(this),this.forward=wd.forward,this.inverse=wd.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var a=this.es/(1+Math.sqrt(1-this.es)),i=a/(2-a),l=i;this.cgb[0]=i*(2+i*(-2/3+i*(-2+i*(116/45+i*(26/45+i*(-2854/675)))))),this.cbg[0]=i*(-2+i*(2/3+i*(4/3+i*(-82/45+i*(32/45+i*(4642/4725)))))),l=l*i,this.cgb[1]=l*(7/3+i*(-8/5+i*(-227/45+i*(2704/315+i*(2323/945))))),this.cbg[1]=l*(5/3+i*(-16/15+i*(-13/9+i*(904/315+i*(-1522/945))))),l=l*i,this.cgb[2]=l*(56/15+i*(-136/35+i*(-1262/105+i*(73814/2835)))),this.cbg[2]=l*(-26/15+i*(34/21+i*(8/5+i*(-12686/2835)))),l=l*i,this.cgb[3]=l*(4279/630+i*(-332/35+i*(-399572/14175))),this.cbg[3]=l*(1237/630+i*(-12/5+i*(-24832/14175))),l=l*i,this.cgb[4]=l*(4174/315+i*(-144838/6237)),this.cbg[4]=l*(-734/315+i*(109598/31185)),l=l*i,this.cgb[5]=l*(601676/22275),this.cbg[5]=l*(444337/155925),l=Math.pow(i,2),this.Qn=this.k0/(1+i)*(1+l*(1/4+l*(1/64+l/256))),this.utg[0]=i*(-.5+i*(2/3+i*(-37/96+i*(1/360+i*(81/512+i*(-96199/604800)))))),this.gtu[0]=i*(.5+i*(-2/3+i*(5/16+i*(41/180+i*(-127/288+i*(7891/37800)))))),this.utg[1]=l*(-1/48+i*(-1/15+i*(437/1440+i*(-46/105+i*(1118711/3870720))))),this.gtu[1]=l*(13/48+i*(-3/5+i*(557/1440+i*(281/630+i*(-1983433/1935360))))),l=l*i,this.utg[2]=l*(-17/480+i*(37/840+i*(209/4480+i*(-5569/90720)))),this.gtu[2]=l*(61/240+i*(-103/140+i*(15061/26880+i*(167603/181440)))),l=l*i,this.utg[3]=l*(-4397/161280+i*(11/504+i*(830251/7257600))),this.gtu[3]=l*(49561/161280+i*(-179/168+i*(6601661/7257600))),l=l*i,this.utg[4]=l*(-4583/161280+i*(108847/3991680)),this.gtu[4]=l*(34729/80640+i*(-3418889/1995840)),l=l*i,this.utg[5]=l*(-20648693/638668800),this.gtu[5]=l*(212378941/319334400);var u=Lm(this.cbg,this.lat0);this.Zb=-this.Qn*(u+YT(this.gtu,2*u))}function tP(a){var i=fe(a.x-this.long0),l=a.y;l=Lm(this.cbg,l);var u=Math.sin(l),p=Math.cos(l),x=Math.sin(i),m=Math.cos(i);l=Math.atan2(u,m*p),i=Math.atan2(x*p,os(u,p*m)),i=KT(Math.tan(i));var o=y1(this.gtu,2*l,2*i);l=l+o[0],i=i+o[1];var P,A;return Math.abs(i)<=2.623395162778?(P=this.a*(this.Qn*i)+this.x0,A=this.a*(this.Qn*l+this.Zb)+this.y0):(P=1/0,A=1/0),a.x=P,a.y=A,a}function eP(a){var i=(a.x-this.x0)*(1/this.a),l=(a.y-this.y0)*(1/this.a);l=(l-this.Zb)/this.Qn,i=i/this.Qn;var u,p;if(Math.abs(i)<=2.623395162778){var x=y1(this.utg,2*l,2*i);l=l+x[0],i=i+x[1],i=Math.atan(_1(i));var m=Math.sin(l),o=Math.cos(l),P=Math.sin(i),A=Math.cos(i);l=Math.atan2(m*A,os(P,A*o)),i=Math.atan2(P,A*o),u=fe(i+this.long0),p=Lm(this.cgb,l)}else u=1/0,p=1/0;return a.x=u,a.y=p,a}var iP=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Md={init:QT,forward:tP,inverse:eP,names:iP};function rP(a,i){if(a===void 0){if(a=Math.floor((fe(i)+Math.PI)*30/Math.PI)+1,a<0)return 0;if(a>60)return 60}return a}var sP="etmerc";function nP(){var a=rP(this.zone,this.long0);if(a===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(a)-183)*Ai,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Md.init.apply(this),this.forward=Md.forward,this.inverse=Md.inverse}var aP=["Universal Transverse Mercator System","utm"];const oP={init:nP,names:aP,dependsOn:sP};function Om(a,i){return Math.pow((1-a)/(1+a),i)}var lP=20;function hP(){var a=Math.sin(this.lat0),i=Math.cos(this.lat0);i*=i,this.rc=Math.sqrt(1-this.es)/(1-this.es*a*a),this.C=Math.sqrt(1+this.es*i*i/(1-this.es)),this.phic0=Math.asin(a/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+xi)/(Math.pow(Math.tan(.5*this.lat0+xi),this.C)*Om(this.e*a,this.ratexp))}function cP(a){var i=a.x,l=a.y;return a.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*l+xi),this.C)*Om(this.e*Math.sin(l),this.ratexp))-Qt,a.x=this.C*i,a}function uP(a){for(var i=1e-14,l=a.x/this.C,u=a.y,p=Math.pow(Math.tan(.5*u+xi)/this.K,1/this.C),x=lP;x>0&&(u=2*Math.atan(p*Om(this.e*Math.sin(a.y),-.5*this.e))-Qt,!(Math.abs(u-a.y)<i));--x)a.y=u;return x?(a.x=l,a.y=u,a):null}const Fm={init:hP,forward:cP,inverse:uP};function dP(){Fm.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function fP(a){var i,l,u,p;return a.x=fe(a.x-this.long0),Fm.forward.apply(this,[a]),i=Math.sin(a.y),l=Math.cos(a.y),u=Math.cos(a.x),p=this.k0*this.R2/(1+this.sinc0*i+this.cosc0*l*u),a.x=p*l*Math.sin(a.x),a.y=p*(this.cosc0*i-this.sinc0*l*u),a.x=this.a*a.x+this.x0,a.y=this.a*a.y+this.y0,a}function pP(a){var i,l,u,p,x;if(a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,x=os(a.x,a.y)){var m=2*Math.atan2(x,this.R2);i=Math.sin(m),l=Math.cos(m),p=Math.asin(l*this.sinc0+a.y*i*this.cosc0/x),u=Math.atan2(a.x*i,x*this.cosc0*l-a.y*this.sinc0*i)}else p=this.phic0,u=0;return a.x=u,a.y=p,Fm.inverse.apply(this,[a]),a.x=fe(a.x+this.long0),a}var mP=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const gP={init:dP,forward:fP,inverse:pP,names:mP};function _P(a,i,l){return i*=l,Math.tan(.5*(Qt+a))*Math.pow((1-i)/(1+i),.5*l)}function yP(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=le&&(this.k0=.5*(1+Bc(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=le&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=le&&Math.abs(Math.cos(this.lat_ts))>le&&(this.k0=.5*this.cons*yn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ws(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=yn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Qt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function vP(a){var i=a.x,l=a.y,u=Math.sin(l),p=Math.cos(l),x,m,o,P,A,L,z=fe(i-this.long0);return Math.abs(Math.abs(i-this.long0)-Math.PI)<=le&&Math.abs(l+this.lat0)<=le?(a.x=NaN,a.y=NaN,a):this.sphere?(x=2*this.k0/(1+this.sinlat0*u+this.coslat0*p*Math.cos(z)),a.x=this.a*x*p*Math.sin(z)+this.x0,a.y=this.a*x*(this.coslat0*u-this.sinlat0*p*Math.cos(z))+this.y0,a):(m=2*Math.atan(this.ssfn_(l,u,this.e))-Qt,P=Math.cos(m),o=Math.sin(m),Math.abs(this.coslat0)<=le?(A=Ws(this.e,l*this.con,this.con*u),L=2*this.a*this.k0*A/this.cons,a.x=this.x0+L*Math.sin(i-this.long0),a.y=this.y0-this.con*L*Math.cos(i-this.long0),a):(Math.abs(this.sinlat0)<le?(x=2*this.a*this.k0/(1+P*Math.cos(z)),a.y=x*o):(x=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*P*Math.cos(z))),a.y=x*(this.cosX0*o-this.sinX0*P*Math.cos(z))+this.y0),a.x=x*P*Math.sin(z)+this.x0,a))}function xP(a){a.x-=this.x0,a.y-=this.y0;var i,l,u,p,x,m=Math.sqrt(a.x*a.x+a.y*a.y);if(this.sphere){var o=2*Math.atan(m/(2*this.a*this.k0));return i=this.long0,l=this.lat0,m<=le?(a.x=i,a.y=l,a):(l=Math.asin(Math.cos(o)*this.sinlat0+a.y*Math.sin(o)*this.coslat0/m),Math.abs(this.coslat0)<le?this.lat0>0?i=fe(this.long0+Math.atan2(a.x,-1*a.y)):i=fe(this.long0+Math.atan2(a.x,a.y)):i=fe(this.long0+Math.atan2(a.x*Math.sin(o),m*this.coslat0*Math.cos(o)-a.y*this.sinlat0*Math.sin(o))),a.x=i,a.y=l,a)}else if(Math.abs(this.coslat0)<=le){if(m<=le)return l=this.lat0,i=this.long0,a.x=i,a.y=l,a;a.x*=this.con,a.y*=this.con,u=m*this.cons/(2*this.a*this.k0),l=this.con*Dc(this.e,u),i=this.con*fe(this.con*this.long0+Math.atan2(a.x,-1*a.y))}else p=2*Math.atan(m*this.cosX0/(2*this.a*this.k0*this.ms1)),i=this.long0,m<=le?x=this.X0:(x=Math.asin(Math.cos(p)*this.sinX0+a.y*Math.sin(p)*this.cosX0/m),i=fe(this.long0+Math.atan2(a.x*Math.sin(p),m*this.cosX0*Math.cos(p)-a.y*this.sinX0*Math.sin(p)))),l=-1*Dc(this.e,Math.tan(.5*(Qt+x)));return a.x=i,a.y=l,a}var bP=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const wP={init:yP,forward:vP,inverse:xP,names:bP,ssfn_:_P};function MP(){var a=this.lat0;this.lambda0=this.long0;var i=Math.sin(a),l=this.a,u=this.rf,p=1/u,x=2*p-Math.pow(p,2),m=this.e=Math.sqrt(x);this.R=this.k0*l*Math.sqrt(1-x)/(1-x*Math.pow(i,2)),this.alpha=Math.sqrt(1+x/(1-x)*Math.pow(Math.cos(a),4)),this.b0=Math.asin(i/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),P=Math.log(Math.tan(Math.PI/4+a/2)),A=Math.log((1+m*i)/(1-m*i));this.K=o-this.alpha*P+this.alpha*m/2*A}function SP(a){var i=Math.log(Math.tan(Math.PI/4-a.y/2)),l=this.e/2*Math.log((1+this.e*Math.sin(a.y))/(1-this.e*Math.sin(a.y))),u=-this.alpha*(i+l)+this.K,p=2*(Math.atan(Math.exp(u))-Math.PI/4),x=this.alpha*(a.x-this.lambda0),m=Math.atan(Math.sin(x)/(Math.sin(this.b0)*Math.tan(p)+Math.cos(this.b0)*Math.cos(x))),o=Math.asin(Math.cos(this.b0)*Math.sin(p)-Math.sin(this.b0)*Math.cos(p)*Math.cos(x));return a.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,a.x=this.R*m+this.x0,a}function TP(a){for(var i=a.x-this.x0,l=a.y-this.y0,u=i/this.R,p=2*(Math.atan(Math.exp(l/this.R))-Math.PI/4),x=Math.asin(Math.cos(this.b0)*Math.sin(p)+Math.sin(this.b0)*Math.cos(p)*Math.cos(u)),m=Math.atan(Math.sin(u)/(Math.cos(this.b0)*Math.cos(u)-Math.sin(this.b0)*Math.tan(p))),o=this.lambda0+m/this.alpha,P=0,A=x,L=-1e3,z=0;Math.abs(A-L)>1e-7;){if(++z>20)return;P=1/this.alpha*(Math.log(Math.tan(Math.PI/4+x/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(A))/2)),L=A,A=2*Math.atan(Math.exp(P))-Math.PI/2}return a.x=o,a.y=A,a}var PP=["somerc"];const EP={init:MP,forward:SP,inverse:TP,names:PP};var Cl=1e-7;function IP(a){var i=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],l=typeof a.projName=="object"?Object.keys(a.projName)[0]:a.projName;return"no_uoff"in a||"no_off"in a||i.indexOf(l)!==-1||i.indexOf(a1(l))!==-1}function CP(){var a,i,l,u,p,x,m,o,P,A,L=0,z,D=0,B=0,$=0,et=0,it=0,ft=0;this.no_off=IP(this),this.no_rot="no_rot"in this;var dt=!1;"alpha"in this&&(dt=!0);var Ot=!1;if("rectified_grid_angle"in this&&(Ot=!0),dt&&(ft=this.alpha),Ot&&(L=this.rectified_grid_angle),dt||Ot)D=this.longc;else if(B=this.long1,et=this.lat1,$=this.long2,it=this.lat2,Math.abs(et-it)<=Cl||(a=Math.abs(et))<=Cl||Math.abs(a-Qt)<=Cl||Math.abs(Math.abs(this.lat0)-Qt)<=Cl||Math.abs(Math.abs(it)-Qt)<=Cl)throw new Error;var jt=1-this.es;i=Math.sqrt(jt),Math.abs(this.lat0)>le?(o=Math.sin(this.lat0),l=Math.cos(this.lat0),a=1-this.es*o*o,this.B=l*l,this.B=Math.sqrt(1+this.es*this.B*this.B/jt),this.A=this.B*this.k0*i/a,u=this.B*i/(l*Math.sqrt(a)),p=u*u-1,p<=0?p=0:(p=Math.sqrt(p),this.lat0<0&&(p=-p)),this.E=p+=u,this.E*=Math.pow(Ws(this.e,this.lat0,o),this.B)):(this.B=1/i,this.A=this.k0,this.E=u=p=1),dt||Ot?(dt?(z=Math.asin(Math.sin(ft)/u),Ot||(L=ft)):(z=L,ft=Math.asin(u*Math.sin(z))),this.lam0=D-Math.asin(.5*(p-1/p)*Math.tan(z))/this.B):(x=Math.pow(Ws(this.e,et,Math.sin(et)),this.B),m=Math.pow(Ws(this.e,it,Math.sin(it)),this.B),p=this.E/x,P=(m-x)/(m+x),A=this.E*this.E,A=(A-m*x)/(A+m*x),a=B-$,a<-Math.pi?$-=Ac:a>Math.pi&&($+=Ac),this.lam0=fe(.5*(B+$)-Math.atan(A*Math.tan(.5*this.B*(B-$))/P)/this.B),z=Math.atan(2*Math.sin(this.B*fe(B-this.lam0))/(p-1/p)),L=ft=Math.asin(u*Math.sin(z))),this.singam=Math.sin(z),this.cosgam=Math.cos(z),this.sinrot=Math.sin(L),this.cosrot=Math.cos(L),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(u*u-1)/Math.cos(ft))),this.lat0<0&&(this.u_0=-this.u_0)),p=.5*z,this.v_pole_n=this.ArB*Math.log(Math.tan(xi-p)),this.v_pole_s=this.ArB*Math.log(Math.tan(xi+p))}function AP(a){var i={},l,u,p,x,m,o,P,A;if(a.x=a.x-this.lam0,Math.abs(Math.abs(a.y)-Qt)>le){if(m=this.E/Math.pow(Ws(this.e,a.y,Math.sin(a.y)),this.B),o=1/m,l=.5*(m-o),u=.5*(m+o),x=Math.sin(this.B*a.x),p=(l*this.singam-x*this.cosgam)/u,Math.abs(Math.abs(p)-1)<le)throw new Error;A=.5*this.ArB*Math.log((1-p)/(1+p)),o=Math.cos(this.B*a.x),Math.abs(o)<Cl?P=this.A*a.x:P=this.ArB*Math.atan2(l*this.cosgam+x*this.singam,o)}else A=a.y>0?this.v_pole_n:this.v_pole_s,P=this.ArB*a.y;return this.no_rot?(i.x=P,i.y=A):(P-=this.u_0,i.x=A*this.cosrot+P*this.sinrot,i.y=P*this.cosrot-A*this.sinrot),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function RP(a){var i,l,u,p,x,m,o,P={};if(a.x=(a.x-this.x0)*(1/this.a),a.y=(a.y-this.y0)*(1/this.a),this.no_rot?(l=a.y,i=a.x):(l=a.x*this.cosrot-a.y*this.sinrot,i=a.y*this.cosrot+a.x*this.sinrot+this.u_0),u=Math.exp(-this.BrA*l),p=.5*(u-1/u),x=.5*(u+1/u),m=Math.sin(this.BrA*i),o=(m*this.cosgam+p*this.singam)/x,Math.abs(Math.abs(o)-1)<le)P.x=0,P.y=o<0?-Qt:Qt;else{if(P.y=this.E/Math.sqrt((1+o)/(1-o)),P.y=Dc(this.e,Math.pow(P.y,1/this.B)),P.y===1/0)throw new Error;P.x=-this.rB*Math.atan2(p*this.cosgam-m*this.singam,Math.cos(this.BrA*i))}return P.x+=this.lam0,P}var DP=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const zP={init:CP,forward:AP,inverse:RP,names:DP};function kP(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<le)){var a=this.b/this.a;this.e=Math.sqrt(1-a*a);var i=Math.sin(this.lat1),l=Math.cos(this.lat1),u=yn(this.e,i,l),p=Ws(this.e,this.lat1,i),x=Math.sin(this.lat2),m=Math.cos(this.lat2),o=yn(this.e,x,m),P=Ws(this.e,this.lat2,x),A=Math.abs(Math.abs(this.lat0)-Qt)<le?0:Ws(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>le?this.ns=Math.log(u/o)/Math.log(p/P):this.ns=i,isNaN(this.ns)&&(this.ns=i),this.f0=u/(this.ns*Math.pow(p,this.ns)),this.rh=this.a*this.f0*Math.pow(A,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function LP(a){var i=a.x,l=a.y;Math.abs(2*Math.abs(l)-Math.PI)<=le&&(l=Bc(l)*(Qt-2*le));var u=Math.abs(Math.abs(l)-Qt),p,x;if(u>le)p=Ws(this.e,l,Math.sin(l)),x=this.a*this.f0*Math.pow(p,this.ns);else{if(u=l*this.ns,u<=0)return null;x=0}var m=this.ns*fe(i-this.long0);return a.x=this.k0*(x*Math.sin(m))+this.x0,a.y=this.k0*(this.rh-x*Math.cos(m))+this.y0,a}function OP(a){var i,l,u,p,x,m=(a.x-this.x0)/this.k0,o=this.rh-(a.y-this.y0)/this.k0;this.ns>0?(i=Math.sqrt(m*m+o*o),l=1):(i=-Math.sqrt(m*m+o*o),l=-1);var P=0;if(i!==0&&(P=Math.atan2(l*m,l*o)),i!==0||this.ns>0){if(l=1/this.ns,u=Math.pow(i/(this.a*this.f0),l),p=Dc(this.e,u),p===-9999)return null}else p=-Qt;return x=fe(P/this.ns+this.long0),a.x=x,a.y=p,a}var FP=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const BP={init:kP,forward:LP,inverse:OP,names:FP};function NP(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function GP(a){var i,l,u,p,x,m,o,P=a.x,A=a.y,L=fe(P-this.long0);return i=Math.pow((1+this.e*Math.sin(A))/(1-this.e*Math.sin(A)),this.alfa*this.e/2),l=2*(Math.atan(this.k*Math.pow(Math.tan(A/2+this.s45),this.alfa)/i)-this.s45),u=-L*this.alfa,p=Math.asin(Math.cos(this.ad)*Math.sin(l)+Math.sin(this.ad)*Math.cos(l)*Math.cos(u)),x=Math.asin(Math.cos(l)*Math.sin(u)/Math.cos(p)),m=this.n*x,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(p/2+this.s45),this.n),a.y=o*Math.cos(m)/1,a.x=o*Math.sin(m)/1,this.czech||(a.y*=-1,a.x*=-1),a}function jP(a){var i,l,u,p,x,m,o,P,A=a.x;a.x=a.y,a.y=A,this.czech||(a.y*=-1,a.x*=-1),m=Math.sqrt(a.x*a.x+a.y*a.y),x=Math.atan2(a.y,a.x),p=x/Math.sin(this.s0),u=2*(Math.atan(Math.pow(this.ro0/m,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),i=Math.asin(Math.cos(this.ad)*Math.sin(u)-Math.sin(this.ad)*Math.cos(u)*Math.cos(p)),l=Math.asin(Math.cos(u)*Math.sin(p)/Math.cos(i)),a.x=this.long0-l/this.alfa,o=i,P=0;var L=0;do a.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(i/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-a.y)<1e-10&&(P=1),o=a.y,L+=1;while(P===0&&L<15);return L>=15?null:a}var UP=["Krovak","krovak"];const VP={init:NP,forward:GP,inverse:jP,names:UP};function Jr(a,i,l,u,p){return a*p-i*Math.sin(2*p)+l*Math.sin(4*p)-u*Math.sin(6*p)}function Nc(a){return 1-.25*a*(1+a/16*(3+1.25*a))}function Gc(a){return .375*a*(1+.25*a*(1+.46875*a))}function jc(a){return .05859375*a*a*(1+.75*a)}function Uc(a){return a*a*a*(35/3072)}function Bm(a,i,l){var u=i*l;return a/Math.sqrt(1-u*u)}function Ta(a){return Math.abs(a)<Qt?a:a-Bc(a)*Math.PI}function Fd(a,i,l,u,p){var x,m;x=a/i;for(var o=0;o<15;o++)if(m=(a-(i*x-l*Math.sin(2*x)+u*Math.sin(4*x)-p*Math.sin(6*x)))/(i-2*l*Math.cos(2*x)+4*u*Math.cos(4*x)-6*p*Math.cos(6*x)),x+=m,Math.abs(m)<=1e-10)return x;return NaN}function $P(){this.sphere||(this.e0=Nc(this.es),this.e1=Gc(this.es),this.e2=jc(this.es),this.e3=Uc(this.es),this.ml0=this.a*Jr(this.e0,this.e1,this.e2,this.e3,this.lat0))}function qP(a){var i,l,u=a.x,p=a.y;if(u=fe(u-this.long0),this.sphere)i=this.a*Math.asin(Math.cos(p)*Math.sin(u)),l=this.a*(Math.atan2(Math.tan(p),Math.cos(u))-this.lat0);else{var x=Math.sin(p),m=Math.cos(p),o=Bm(this.a,this.e,x),P=Math.tan(p)*Math.tan(p),A=u*Math.cos(p),L=A*A,z=this.es*m*m/(1-this.es),D=this.a*Jr(this.e0,this.e1,this.e2,this.e3,p);i=o*A*(1-L*P*(1/6-(8-P+8*z)*L/120)),l=D-this.ml0+o*x/m*L*(.5+(5-P+6*z)*L/24)}return a.x=i+this.x0,a.y=l+this.y0,a}function ZP(a){a.x-=this.x0,a.y-=this.y0;var i=a.x/this.a,l=a.y/this.a,u,p;if(this.sphere){var x=l+this.lat0;u=Math.asin(Math.sin(x)*Math.cos(i)),p=Math.atan2(Math.tan(i),Math.cos(x))}else{var m=this.ml0/this.a+l,o=Fd(m,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-Qt)<=le)return a.x=this.long0,a.y=Qt,l<0&&(a.y*=-1),a;var P=Bm(this.a,this.e,Math.sin(o)),A=P*P*P/this.a/this.a*(1-this.es),L=Math.pow(Math.tan(o),2),z=i*this.a/P,D=z*z;u=o-P*Math.tan(o)/A*z*z*(.5-(1+3*L)*z*z/24),p=z*(1-D*(L/3+(1+3*L)*L*D/15))/Math.cos(o)}return a.x=fe(p+this.long0),a.y=Ta(u),a}var WP=["Cassini","Cassini_Soldner","cass"];const XP={init:$P,forward:qP,inverse:ZP,names:WP};function xa(a,i){var l;return a>1e-7?(l=a*i,(1-a*a)*(i/(1-l*l)-.5/a*Math.log((1-l)/(1+l)))):2*i}var HP=1,KP=2,YP=3,JP=4;function QP(){var a=Math.abs(this.lat0);if(Math.abs(a-Qt)<le?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(a)<le?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var i;switch(this.qp=xa(this.e,1),this.mmf=.5/(1-this.es),this.apa=lE(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),i=Math.sin(this.lat0),this.sinb1=xa(this.e,i)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*i*i)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function tE(a){var i,l,u,p,x,m,o,P,A,L,z=a.x,D=a.y;if(z=fe(z-this.long0),this.sphere){if(x=Math.sin(D),L=Math.cos(D),u=Math.cos(z),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l=this.mode===this.EQUIT?1+L*u:1+this.sinph0*x+this.cosph0*L*u,l<=le)return null;l=Math.sqrt(2/l),i=l*L*Math.sin(z),l*=this.mode===this.EQUIT?x:this.cosph0*x-this.sinph0*L*u}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),Math.abs(D+this.lat0)<le)return null;l=xi-D*.5,l=2*(this.mode===this.S_POLE?Math.cos(l):Math.sin(l)),i=l*Math.sin(z),l*=u}}else{switch(o=0,P=0,A=0,u=Math.cos(z),p=Math.sin(z),x=Math.sin(D),m=xa(this.e,x),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=m/this.qp,P=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:A=1+this.sinb1*o+this.cosb1*P*u;break;case this.EQUIT:A=1+P*u;break;case this.N_POLE:A=Qt+D,m=this.qp-m;break;case this.S_POLE:A=D-Qt,m=this.qp+m;break}if(Math.abs(A)<le)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:A=Math.sqrt(2/A),this.mode===this.OBLIQ?l=this.ymf*A*(this.cosb1*o-this.sinb1*P*u):l=(A=Math.sqrt(2/(1+P*u)))*o*this.ymf,i=this.xmf*A*P*p;break;case this.N_POLE:case this.S_POLE:m>=0?(i=(A=Math.sqrt(m))*p,l=u*(this.mode===this.S_POLE?A:-A)):i=l=0;break}}return a.x=this.a*i+this.x0,a.y=this.a*l+this.y0,a}function eE(a){a.x-=this.x0,a.y-=this.y0;var i=a.x/this.a,l=a.y/this.a,u,p,x,m,o,P,A;if(this.sphere){var L=0,z,D=0;if(z=Math.sqrt(i*i+l*l),p=z*.5,p>1)return null;switch(p=2*Math.asin(p),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(D=Math.sin(p),L=Math.cos(p)),this.mode){case this.EQUIT:p=Math.abs(z)<=le?0:Math.asin(l*D/z),i*=D,l=L*z;break;case this.OBLIQ:p=Math.abs(z)<=le?this.lat0:Math.asin(L*this.sinph0+l*D*this.cosph0/z),i*=D*this.cosph0,l=(L-Math.sin(p)*this.sinph0)*z;break;case this.N_POLE:l=-l,p=Qt-p;break;case this.S_POLE:p-=Qt;break}u=l===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(i,l)}else{if(A=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i/=this.dd,l*=this.dd,P=Math.sqrt(i*i+l*l),P<le)return a.x=this.long0,a.y=this.lat0,a;m=2*Math.asin(.5*P/this.rq),x=Math.cos(m),i*=m=Math.sin(m),this.mode===this.OBLIQ?(A=x*this.sinb1+l*m*this.cosb1/P,o=this.qp*A,l=P*this.cosb1*x-l*this.sinb1*m):(A=l*m/P,o=this.qp*A,l=P*x)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(l=-l),o=i*i+l*l,!o)return a.x=this.long0,a.y=this.lat0,a;A=1-o/this.qp,this.mode===this.S_POLE&&(A=-A)}u=Math.atan2(i,l),p=hE(Math.asin(A),this.apa)}return a.x=fe(this.long0+u),a.y=p,a}var iE=.3333333333333333,rE=.17222222222222222,sE=.10257936507936508,nE=.06388888888888888,aE=.0664021164021164,oE=.016415012942191543;function lE(a){var i,l=[];return l[0]=a*iE,i=a*a,l[0]+=i*rE,l[1]=i*nE,i*=a,l[0]+=i*sE,l[1]+=i*aE,l[2]=i*oE,l}function hE(a,i){var l=a+a;return a+i[0]*Math.sin(l)+i[1]*Math.sin(l+l)+i[2]*Math.sin(l+l+l)}var cE=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const uE={init:QP,forward:tE,inverse:eE,names:cE,S_POLE:HP,N_POLE:KP,EQUIT:YP,OBLIQ:JP};function Ma(a){return Math.abs(a)>1&&(a=a>1?1:-1),Math.asin(a)}function dE(){Math.abs(this.lat1+this.lat2)<le||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=yn(this.e3,this.sin_po,this.cos_po),this.qs1=xa(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=yn(this.e3,this.sin_po,this.cos_po),this.qs2=xa(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=xa(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>le?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function fE(a){var i=a.x,l=a.y;this.sin_phi=Math.sin(l),this.cos_phi=Math.cos(l);var u=xa(this.e3,this.sin_phi),p=this.a*Math.sqrt(this.c-this.ns0*u)/this.ns0,x=this.ns0*fe(i-this.long0),m=p*Math.sin(x)+this.x0,o=this.rh-p*Math.cos(x)+this.y0;return a.x=m,a.y=o,a}function pE(a){var i,l,u,p,x,m;return a.x-=this.x0,a.y=this.rh-a.y+this.y0,this.ns0>=0?(i=Math.sqrt(a.x*a.x+a.y*a.y),u=1):(i=-Math.sqrt(a.x*a.x+a.y*a.y),u=-1),p=0,i!==0&&(p=Math.atan2(u*a.x,u*a.y)),u=i*this.ns0/this.a,this.sphere?m=Math.asin((this.c-u*u)/(2*this.ns0)):(l=(this.c-u*u)/this.ns0,m=this.phi1z(this.e3,l)),x=fe(p/this.ns0+this.long0),a.x=x,a.y=m,a}function mE(a,i){var l,u,p,x,m,o=Ma(.5*i);if(a<le)return o;for(var P=a*a,A=1;A<=25;A++)if(l=Math.sin(o),u=Math.cos(o),p=a*l,x=1-p*p,m=.5*x*x/u*(i/(1-P)-l/x+.5/a*Math.log((1-p)/(1+p))),o=o+m,Math.abs(m)<=1e-7)return o;return null}var gE=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const _E={init:dE,forward:fE,inverse:pE,names:gE,phi1z:mE};function yE(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function vE(a){var i,l,u,p,x,m,o,P,A=a.x,L=a.y;return u=fe(A-this.long0),i=Math.sin(L),l=Math.cos(L),p=Math.cos(u),m=this.sin_p14*i+this.cos_p14*l*p,x=1,m>0||Math.abs(m)<=le?(o=this.x0+this.a*x*l*Math.sin(u)/m,P=this.y0+this.a*x*(this.cos_p14*i-this.sin_p14*l*p)/m):(o=this.x0+this.infinity_dist*l*Math.sin(u),P=this.y0+this.infinity_dist*(this.cos_p14*i-this.sin_p14*l*p)),a.x=o,a.y=P,a}function xE(a){var i,l,u,p,x,m;return a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,(i=Math.sqrt(a.x*a.x+a.y*a.y))?(p=Math.atan2(i,this.rc),l=Math.sin(p),u=Math.cos(p),m=Ma(u*this.sin_p14+a.y*l*this.cos_p14/i),x=Math.atan2(a.x*l,i*this.cos_p14*u-a.y*this.sin_p14*l),x=fe(this.long0+x)):(m=this.phic0,x=0),a.x=x,a.y=m,a}var bE=["gnom"];const wE={init:yE,forward:vE,inverse:xE,names:bE};function ME(a,i){var l=1-(1-a*a)/(2*a)*Math.log((1-a)/(1+a));if(Math.abs(Math.abs(i)-l)<1e-6)return i<0?-1*Qt:Qt;for(var u=Math.asin(.5*i),p,x,m,o,P=0;P<30;P++)if(x=Math.sin(u),m=Math.cos(u),o=a*x,p=Math.pow(1-o*o,2)/(2*m)*(i/(1-a*a)-x/(1-o*o)+.5/a*Math.log((1-o)/(1+o))),u+=p,Math.abs(p)<=1e-10)return u;return NaN}function SE(){this.sphere||(this.k0=yn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function TE(a){var i=a.x,l=a.y,u,p,x=fe(i-this.long0);if(this.sphere)u=this.x0+this.a*x*Math.cos(this.lat_ts),p=this.y0+this.a*Math.sin(l)/Math.cos(this.lat_ts);else{var m=xa(this.e,Math.sin(l));u=this.x0+this.a*this.k0*x,p=this.y0+this.a*m*.5/this.k0}return a.x=u,a.y=p,a}function PE(a){a.x-=this.x0,a.y-=this.y0;var i,l;return this.sphere?(i=fe(this.long0+a.x/this.a/Math.cos(this.lat_ts)),l=Math.asin(a.y/this.a*Math.cos(this.lat_ts))):(l=ME(this.e,2*a.y*this.k0/this.a),i=fe(this.long0+a.x/(this.a*this.k0))),a.x=i,a.y=l,a}var EE=["cea"];const IE={init:SE,forward:TE,inverse:PE,names:EE};function CE(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function AE(a){var i=a.x,l=a.y,u=fe(i-this.long0),p=Ta(l-this.lat0);return a.x=this.x0+this.a*u*this.rc,a.y=this.y0+this.a*p,a}function RE(a){var i=a.x,l=a.y;return a.x=fe(this.long0+(i-this.x0)/(this.a*this.rc)),a.y=Ta(this.lat0+(l-this.y0)/this.a),a}var DE=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const zE={init:CE,forward:AE,inverse:RE,names:DE};var V0=20;function kE(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Nc(this.es),this.e1=Gc(this.es),this.e2=jc(this.es),this.e3=Uc(this.es),this.ml0=this.a*Jr(this.e0,this.e1,this.e2,this.e3,this.lat0)}function LE(a){var i=a.x,l=a.y,u,p,x,m=fe(i-this.long0);if(x=m*Math.sin(l),this.sphere)Math.abs(l)<=le?(u=this.a*m,p=-1*this.a*this.lat0):(u=this.a*Math.sin(x)/Math.tan(l),p=this.a*(Ta(l-this.lat0)+(1-Math.cos(x))/Math.tan(l)));else if(Math.abs(l)<=le)u=this.a*m,p=-1*this.ml0;else{var o=Bm(this.a,this.e,Math.sin(l))/Math.tan(l);u=o*Math.sin(x),p=this.a*Jr(this.e0,this.e1,this.e2,this.e3,l)-this.ml0+o*(1-Math.cos(x))}return a.x=u+this.x0,a.y=p+this.y0,a}function OE(a){var i,l,u,p,x,m,o,P,A;if(u=a.x-this.x0,p=a.y-this.y0,this.sphere)if(Math.abs(p+this.a*this.lat0)<=le)i=fe(u/this.a+this.long0),l=0;else{m=this.lat0+p/this.a,o=u*u/this.a/this.a+m*m,P=m;var L;for(x=V0;x;--x)if(L=Math.tan(P),A=-1*(m*(P*L+1)-P-.5*(P*P+o)*L)/((P-m)/L-1),P+=A,Math.abs(A)<=le){l=P;break}i=fe(this.long0+Math.asin(u*Math.tan(P)/this.a)/Math.sin(l))}else if(Math.abs(p+this.ml0)<=le)l=0,i=fe(this.long0+u/this.a);else{m=(this.ml0+p)/this.a,o=u*u/this.a/this.a+m*m,P=m;var z,D,B,$,et;for(x=V0;x;--x)if(et=this.e*Math.sin(P),z=Math.sqrt(1-et*et)*Math.tan(P),D=this.a*Jr(this.e0,this.e1,this.e2,this.e3,P),B=this.e0-2*this.e1*Math.cos(2*P)+4*this.e2*Math.cos(4*P)-6*this.e3*Math.cos(6*P),$=D/this.a,A=(m*(z*$+1)-$-.5*z*($*$+o))/(this.es*Math.sin(2*P)*($*$+o-2*m*$)/(4*z)+(m-$)*(z*B-2/Math.sin(2*P))-B),P-=A,Math.abs(A)<=le){l=P;break}z=Math.sqrt(1-this.es*Math.pow(Math.sin(l),2))*Math.tan(l),i=fe(this.long0+Math.asin(u*z/this.a)/Math.sin(l))}return a.x=i,a.y=l,a}var FE=["Polyconic","American_Polyconic","poly"];const BE={init:kE,forward:LE,inverse:OE,names:FE};function NE(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function GE(a){var i,l=a.x,u=a.y,p=u-this.lat0,x=l-this.long0,m=p/wc*1e-5,o=x,P=1,A=0;for(i=1;i<=10;i++)P=P*m,A=A+this.A[i]*P;var L=A,z=o,D=1,B=0,$,et,it=0,ft=0;for(i=1;i<=6;i++)$=D*L-B*z,et=B*L+D*z,D=$,B=et,it=it+this.B_re[i]*D-this.B_im[i]*B,ft=ft+this.B_im[i]*D+this.B_re[i]*B;return a.x=ft*this.a+this.x0,a.y=it*this.a+this.y0,a}function jE(a){var i,l=a.x,u=a.y,p=l-this.x0,x=u-this.y0,m=x/this.a,o=p/this.a,P=1,A=0,L,z,D=0,B=0;for(i=1;i<=6;i++)L=P*m-A*o,z=A*m+P*o,P=L,A=z,D=D+this.C_re[i]*P-this.C_im[i]*A,B=B+this.C_im[i]*P+this.C_re[i]*A;for(var $=0;$<this.iterations;$++){var et=D,it=B,ft,dt,Ot=m,jt=o;for(i=2;i<=6;i++)ft=et*D-it*B,dt=it*D+et*B,et=ft,it=dt,Ot=Ot+(i-1)*(this.B_re[i]*et-this.B_im[i]*it),jt=jt+(i-1)*(this.B_im[i]*et+this.B_re[i]*it);et=1,it=0;var Gt=this.B_re[1],re=this.B_im[1];for(i=2;i<=6;i++)ft=et*D-it*B,dt=it*D+et*B,et=ft,it=dt,Gt=Gt+i*(this.B_re[i]*et-this.B_im[i]*it),re=re+i*(this.B_im[i]*et+this.B_re[i]*it);var Ie=Gt*Gt+re*re;D=(Ot*Gt+jt*re)/Ie,B=(jt*Gt-Ot*re)/Ie}var _e=D,Re=B,ri=1,$e=0;for(i=1;i<=9;i++)ri=ri*_e,$e=$e+this.D[i]*ri;var oi=this.lat0+$e*wc*1e5,Qe=this.long0+Re;return a.x=Qe,a.y=oi,a}var UE=["New_Zealand_Map_Grid","nzmg"];const VE={init:NE,forward:GE,inverse:jE,names:UE};function $E(){}function qE(a){var i=a.x,l=a.y,u=fe(i-this.long0),p=this.x0+this.a*u,x=this.y0+this.a*Math.log(Math.tan(Math.PI/4+l/2.5))*1.25;return a.x=p,a.y=x,a}function ZE(a){a.x-=this.x0,a.y-=this.y0;var i=fe(this.long0+a.x/this.a),l=2.5*(Math.atan(Math.exp(.8*a.y/this.a))-Math.PI/4);return a.x=i,a.y=l,a}var WE=["Miller_Cylindrical","mill"];const XE={init:$E,forward:qE,inverse:ZE,names:WE};var HE=20;function KE(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=zm(this.es)}function YE(a){var i,l,u=a.x,p=a.y;if(u=fe(u-this.long0),this.sphere){if(!this.m)p=this.n!==1?Math.asin(this.n*Math.sin(p)):p;else for(var x=this.n*Math.sin(p),m=HE;m;--m){var o=(this.m*p+Math.sin(p)-x)/(this.m+Math.cos(p));if(p-=o,Math.abs(o)<le)break}i=this.a*this.C_x*u*(this.m+Math.cos(p)),l=this.a*this.C_y*p}else{var P=Math.sin(p),A=Math.cos(p);l=this.a*Kl(p,P,A,this.en),i=this.a*u*A/Math.sqrt(1-this.es*P*P)}return a.x=i,a.y=l,a}function JE(a){var i,l,u,p;return a.x-=this.x0,u=a.x/this.a,a.y-=this.y0,i=a.y/this.a,this.sphere?(i/=this.C_y,u=u/(this.C_x*(this.m+Math.cos(i))),this.m?i=Ma((this.m*i+Math.sin(i))/this.n):this.n!==1&&(i=Ma(Math.sin(i)/this.n)),u=fe(u+this.long0),i=Ta(i)):(i=km(a.y/this.a,this.es,this.en),p=Math.abs(i),p<Qt?(p=Math.sin(i),l=this.long0+a.x*Math.sqrt(1-this.es*p*p)/(this.a*Math.cos(i)),u=fe(l)):p-le<Qt&&(u=this.long0)),a.x=u,a.y=i,a}var QE=["Sinusoidal","sinu"];const tI={init:KE,forward:YE,inverse:JE,names:QE};function eI(){}function iI(a){for(var i=a.x,l=a.y,u=fe(i-this.long0),p=l,x=Math.PI*Math.sin(l);;){var m=-(p+Math.sin(p)-x)/(1+Math.cos(p));if(p+=m,Math.abs(m)<le)break}p/=2,Math.PI/2-Math.abs(l)<le&&(u=0);var o=.900316316158*this.a*u*Math.cos(p)+this.x0,P=1.4142135623731*this.a*Math.sin(p)+this.y0;return a.x=o,a.y=P,a}function rI(a){var i,l;a.x-=this.x0,a.y-=this.y0,l=a.y/(1.4142135623731*this.a),Math.abs(l)>.999999999999&&(l=.999999999999),i=Math.asin(l);var u=fe(this.long0+a.x/(.900316316158*this.a*Math.cos(i)));u<-Math.PI&&(u=-Math.PI),u>Math.PI&&(u=Math.PI),l=(2*i+Math.sin(2*i))/Math.PI,Math.abs(l)>1&&(l=1);var p=Math.asin(l);return a.x=u,a.y=p,a}var sI=["Mollweide","moll"];const nI={init:eI,forward:iI,inverse:rI,names:sI};function aI(){Math.abs(this.lat1+this.lat2)<le||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Nc(this.es),this.e1=Gc(this.es),this.e2=jc(this.es),this.e3=Uc(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=yn(this.e,this.sinphi,this.cosphi),this.ml1=Jr(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<le?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=yn(this.e,this.sinphi,this.cosphi),this.ml2=Jr(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Jr(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function oI(a){var i=a.x,l=a.y,u;if(this.sphere)u=this.a*(this.g-l);else{var p=Jr(this.e0,this.e1,this.e2,this.e3,l);u=this.a*(this.g-p)}var x=this.ns*fe(i-this.long0),m=this.x0+u*Math.sin(x),o=this.y0+this.rh-u*Math.cos(x);return a.x=m,a.y=o,a}function lI(a){a.x-=this.x0,a.y=this.rh-a.y+this.y0;var i,l,u,p;this.ns>=0?(l=Math.sqrt(a.x*a.x+a.y*a.y),i=1):(l=-Math.sqrt(a.x*a.x+a.y*a.y),i=-1);var x=0;if(l!==0&&(x=Math.atan2(i*a.x,i*a.y)),this.sphere)return p=fe(this.long0+x/this.ns),u=Ta(this.g-l/this.a),a.x=p,a.y=u,a;var m=this.g-l/this.a;return u=Fd(m,this.e0,this.e1,this.e2,this.e3),p=fe(this.long0+x/this.ns),a.x=p,a.y=u,a}var hI=["Equidistant_Conic","eqdc"];const cI={init:aI,forward:oI,inverse:lI,names:hI};function uI(){this.R=this.a}function dI(a){var i=a.x,l=a.y,u=fe(i-this.long0),p,x;Math.abs(l)<=le&&(p=this.x0+this.R*u,x=this.y0);var m=Ma(2*Math.abs(l/Math.PI));(Math.abs(u)<=le||Math.abs(Math.abs(l)-Qt)<=le)&&(p=this.x0,l>=0?x=this.y0+Math.PI*this.R*Math.tan(.5*m):x=this.y0+Math.PI*this.R*-Math.tan(.5*m));var o=.5*Math.abs(Math.PI/u-u/Math.PI),P=o*o,A=Math.sin(m),L=Math.cos(m),z=L/(A+L-1),D=z*z,B=z*(2/A-1),$=B*B,et=Math.PI*this.R*(o*(z-$)+Math.sqrt(P*(z-$)*(z-$)-($+P)*(D-$)))/($+P);u<0&&(et=-et),p=this.x0+et;var it=P+z;return et=Math.PI*this.R*(B*it-o*Math.sqrt(($+P)*(P+1)-it*it))/($+P),l>=0?x=this.y0+et:x=this.y0-et,a.x=p,a.y=x,a}function fI(a){var i,l,u,p,x,m,o,P,A,L,z,D,B;return a.x-=this.x0,a.y-=this.y0,z=Math.PI*this.R,u=a.x/z,p=a.y/z,x=u*u+p*p,m=-Math.abs(p)*(1+x),o=m-2*p*p+u*u,P=-2*m+1+2*p*p+x*x,B=p*p/P+(2*o*o*o/P/P/P-9*m*o/P/P)/27,A=(m-o*o/3/P)/P,L=2*Math.sqrt(-A/3),z=3*B/A/L,Math.abs(z)>1&&(z>=0?z=1:z=-1),D=Math.acos(z)/3,a.y>=0?l=(-L*Math.cos(D+Math.PI/3)-o/3/P)*Math.PI:l=-(-L*Math.cos(D+Math.PI/3)-o/3/P)*Math.PI,Math.abs(u)<le?i=this.long0:i=fe(this.long0+Math.PI*(x-1+Math.sqrt(1+2*(u*u-p*p)+x*x))/2/u),a.x=i,a.y=l,a}var pI=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const mI={init:uI,forward:dI,inverse:fI,names:pI};var kp={exports:{}},$0;function gI(){return $0||($0=1,function(a){(function(i){var l={};l.Constants={},l.Math={},l.Accumulator={},function(u){u.WGS84={a:6378137,f:1/298.257223563},u.version={major:2,minor:1,patch:1},u.version_string="2.1.1"}(l.Constants),function(u){u.digits=53,u.epsilon=Math.pow(.5,u.digits-1),u.degree=Math.PI/180,u.sq=function(p){return p*p},u.hypot=function(p,x){return Math.sqrt(p*p+x*x)},u.cbrt=Math.cbrt||function(p){var x=Math.pow(Math.abs(p),.3333333333333333);return p>0?x:p<0?-x:p},u.log1p=Math.log1p||function(p){var x=1+p,m=x-1;return m===0?p:p*Math.log(x)/m},u.atanh=Math.atanh||function(p){var x=Math.abs(p);return x=u.log1p(2*x/(1-x))/2,p>0?x:p<0?-x:p},u.copysign=function(p,x){return Math.abs(p)*(x<0||x===0&&1/x<0?-1:1)},u.sum=function(p,x){var m=p+x,o=m-x,P=m-o,A;return o-=p,P-=x,A=m&&0-(o+P),{s:m,t:A}},u.polyval=function(p,x,m,o){for(var P=p<0?0:x[m++];--p>=0;)P=P*o+x[m++];return P},u.AngRound=function(p){var x=.0625,m=Math.abs(p);return m=m<x?x-(x-m):m,u.copysign(m,p)},u.remainder=function(p,x){return p%=x,p<-x/2?p+x:p<x/2?p:p-x},u.AngNormalize=function(p){var x=u.remainder(p,360);return Math.abs(x)===180?u.copysign(180,p):x},u.LatFix=function(p){return Math.abs(p)>90?NaN:p},u.AngDiff=function(p,x){var m=u.sum(u.remainder(-p,360),u.remainder(x,360)),o,P;return m=u.sum(u.remainder(m.s,360),m.t),o=m.s,P=m.t,(o===0||Math.abs(o)===180)&&(o=u.copysign(o,P===0?x-p:-P)),{d:o,e:P}},u.sincosd=function(p){var x,m,o,P,A,L,z;switch(x=p%360,o=Math.round(x/90),x-=90*o,m=x*this.degree,P=Math.sin(m),A=Math.cos(m),Math.abs(x)===45?(A=Math.sqrt(.5),P=u.copysign(A,m)):Math.abs(x)===30&&(A=Math.sqrt(.75),P=u.copysign(.5,m)),o&3){case 0:L=P,z=A;break;case 1:L=A,z=-P;break;case 2:L=-P,z=-A;break;default:L=-A,z=P;break}return z+=0,L===0&&(L=u.copysign(L,p)),{s:L,c:z}},u.sincosde=function(p,x){var m,o,P,A,L,z,D;switch(m=p%360,P=Math.round(m/90),m=u.AngRound(m-90*P+x),o=m*this.degree,A=Math.sin(o),L=Math.cos(o),Math.abs(m)===45?(L=Math.sqrt(.5),A=u.copysign(L,o)):Math.abs(m)===30&&(L=Math.sqrt(.75),A=u.copysign(.5,o)),P&3){case 0:z=A,D=L;break;case 1:z=L,D=-A;break;case 2:z=-A,D=-L;break;default:z=-L,D=A;break}return D+=0,z===0&&(z=u.copysign(z,p+x)),{s:z,c:D}},u.atan2d=function(p,x){var m=0,o;switch(Math.abs(p)>Math.abs(x)&&([p,x]=[x,p],m=2),u.copysign(1,x)<0&&(x=-x,++m),o=Math.atan2(p,x)/this.degree,m){case 1:o=u.copysign(180,p)-o;break;case 2:o=90-o;break;case 3:o=-90+o;break}return o}}(l.Math),function(u,p){u.Accumulator=function(x){this.Set(x)},u.Accumulator.prototype.Set=function(x){x||(x=0),x.constructor===u.Accumulator?(this._s=x._s,this._t=x._t):(this._s=x,this._t=0)},u.Accumulator.prototype.Add=function(x){var m=p.sum(x,this._t),o=p.sum(m.s,this._s);m=m.t,this._s=o.s,this._t=o.t,this._s===0?this._s=m:this._t+=m},u.Accumulator.prototype.Sum=function(x){var m;return x?(m=new u.Accumulator(this),m.Add(x),m._s):this._s},u.Accumulator.prototype.Negate=function(){this._s*=-1,this._t*=-1},u.Accumulator.prototype.Remainder=function(x){this._s=p.remainder(this._s,x),this.Add(0)}}(l.Accumulator,l.Math),l.Geodesic={},l.GeodesicLine={},l.PolygonArea={},function(u,p,x,m,o){var P=6,A=P,L=P,z=P,D=z,B,$,et=20,it=et+m.digits+10,ft=m.epsilon,dt=200*ft,Ot=Math.sqrt(ft),jt=ft,Gt=1e3*Ot,re=0,Ie=31,_e=32640,Re,ri,$e,oi,Qe,wi,li,Ii,Ri;u.tiny_=Math.sqrt(Number.MIN_VALUE/Number.EPSILON),u.nC1_=P,u.nC1p_=P,u.nC2_=P,u.nC3_=P,u.nC4_=P,B=u.nC3_*(u.nC3_-1)/2,$=u.nC4_*(u.nC4_+1)/2,u.CAP_C1=1,u.CAP_C1p=2,u.CAP_C2=4,u.CAP_C3=8,u.CAP_C4=16,u.NONE=0,u.ARC=64,u.LATITUDE=128|re,u.LONGITUDE=256|u.CAP_C3,u.AZIMUTH=512|re,u.DISTANCE=1024|u.CAP_C1,u.STANDARD=u.LATITUDE|u.LONGITUDE|u.AZIMUTH|u.DISTANCE,u.DISTANCE_IN=2048|u.CAP_C1|u.CAP_C1p,u.REDUCEDLENGTH=4096|u.CAP_C1|u.CAP_C2,u.GEODESICSCALE=8192|u.CAP_C1|u.CAP_C2,u.AREA=16384|u.CAP_C4,u.ALL=_e|Ie,u.LONG_UNROLL=32768,u.OUT_MASK=_e|u.LONG_UNROLL,u.SinCosSeries=function(Nt,qt,Xt,Dt){var Mt=Dt.length,Lt=Mt-(Nt?1:0),ee=2*(Xt-qt)*(Xt+qt),de=Lt&1?Dt[--Mt]:0,Ee=0;for(Lt=Math.floor(Lt/2);Lt--;)Ee=ee*de-Ee+Dt[--Mt],de=ee*Ee-de+Dt[--Mt];return Nt?2*qt*Xt*de:Xt*(de-Ee)},Re=function(Nt,qt){var Xt,Dt=m.sq(Nt),Mt=m.sq(qt),Lt=(Dt+Mt-1)/6,ee,de,Ee,me,Ge,ae,Se,ze,Wt,oe,Ce;return Mt===0&&Lt<=0?Xt=0:(ee=Dt*Mt/4,de=m.sq(Lt),Ee=Lt*de,me=ee*(ee+2*Ee),Ge=Lt,me>=0?(ae=ee+Ee,ae+=ae<0?-Math.sqrt(me):Math.sqrt(me),Se=m.cbrt(ae),Ge+=Se+(Se!==0?de/Se:0)):(ze=Math.atan2(Math.sqrt(-me),-(ee+Ee)),Ge+=2*Lt*Math.cos(ze/3)),Wt=Math.sqrt(m.sq(Ge)+Mt),oe=Ge<0?Mt/(Wt-Ge):Ge+Wt,Ce=(oe-Mt)/(2*Wt),Xt=oe/(Math.sqrt(oe+m.sq(Ce))+Ce)),Xt},ri=[1,4,64,0,256],u.A1m1f=function(Nt){var qt=Math.floor(A/2),Xt=m.polyval(qt,ri,0,m.sq(Nt))/ri[qt+1];return(Xt+Nt)/(1-Nt)},$e=[-1,6,-16,32,-9,64,-128,2048,9,-16,768,3,-5,512,-7,1280,-7,2048],u.C1f=function(Nt,qt){var Xt=m.sq(Nt),Dt=Nt,Mt=0,Lt,ee;for(Lt=1;Lt<=u.nC1_;++Lt)ee=Math.floor((u.nC1_-Lt)/2),qt[Lt]=Dt*m.polyval(ee,$e,Mt,Xt)/$e[Mt+ee+1],Mt+=ee+2,Dt*=Nt},oi=[205,-432,768,1536,4005,-4736,3840,12288,-225,116,384,-7173,2695,7680,3467,7680,38081,61440],u.C1pf=function(Nt,qt){var Xt=m.sq(Nt),Dt=Nt,Mt=0,Lt,ee;for(Lt=1;Lt<=u.nC1p_;++Lt)ee=Math.floor((u.nC1p_-Lt)/2),qt[Lt]=Dt*m.polyval(ee,oi,Mt,Xt)/oi[Mt+ee+1],Mt+=ee+2,Dt*=Nt},Qe=[-11,-28,-192,0,256],u.A2m1f=function(Nt){var qt=Math.floor(L/2),Xt=m.polyval(qt,Qe,0,m.sq(Nt))/Qe[qt+1];return(Xt-Nt)/(1+Nt)},wi=[1,2,16,32,35,64,384,2048,15,80,768,7,35,512,63,1280,77,2048],u.C2f=function(Nt,qt){var Xt=m.sq(Nt),Dt=Nt,Mt=0,Lt,ee;for(Lt=1;Lt<=u.nC2_;++Lt)ee=Math.floor((u.nC2_-Lt)/2),qt[Lt]=Dt*m.polyval(ee,wi,Mt,Xt)/wi[Mt+ee+1],Mt+=ee+2,Dt*=Nt},u.Geodesic=function(Nt,qt){if(this.a=Nt,this.f=qt,this._f1=1-this.f,this._e2=this.f*(2-this.f),this._ep2=this._e2/m.sq(this._f1),this._n=this.f/(2-this.f),this._b=this.a*this._f1,this._c2=(m.sq(this.a)+m.sq(this._b)*(this._e2===0?1:(this._e2>0?m.atanh(Math.sqrt(this._e2)):Math.atan(Math.sqrt(-this._e2)))/Math.sqrt(Math.abs(this._e2))))/2,this._etol2=.1*Ot/Math.sqrt(Math.max(.001,Math.abs(this.f))*Math.min(1,1-this.f/2)/2),!(isFinite(this.a)&&this.a>0))throw new Error("Equatorial radius is not positive");if(!(isFinite(this._b)&&this._b>0))throw new Error("Polar semi-axis is not positive");this._A3x=new Array(D),this._C3x=new Array(B),this._C4x=new Array($),this.A3coeff(),this.C3coeff(),this.C4coeff()},li=[-3,128,-2,-3,64,-1,-3,-1,16,3,-1,-2,8,1,-1,2,1,1],u.Geodesic.prototype.A3coeff=function(){var Nt=0,qt=0,Xt,Dt;for(Xt=z-1;Xt>=0;--Xt)Dt=Math.min(z-Xt-1,Xt),this._A3x[qt++]=m.polyval(Dt,li,Nt,this._n)/li[Nt+Dt+1],Nt+=Dt+2},Ii=[3,128,2,5,128,-1,3,3,64,-1,0,1,8,-1,1,4,5,256,1,3,128,-3,-2,3,64,1,-3,2,32,7,512,-10,9,384,5,-9,5,192,7,512,-14,7,512,21,2560],u.Geodesic.prototype.C3coeff=function(){var Nt=0,qt=0,Xt,Dt,Mt;for(Xt=1;Xt<u.nC3_;++Xt)for(Dt=u.nC3_-1;Dt>=Xt;--Dt)Mt=Math.min(u.nC3_-Dt-1,Dt),this._C3x[qt++]=m.polyval(Mt,Ii,Nt,this._n)/Ii[Nt+Mt+1],Nt+=Mt+2},Ri=[97,15015,1088,156,45045,-224,-4784,1573,45045,-10656,14144,-4576,-858,45045,64,624,-4576,6864,-3003,15015,100,208,572,3432,-12012,30030,45045,1,9009,-2944,468,135135,5792,1040,-1287,135135,5952,-11648,9152,-2574,135135,-64,-624,4576,-6864,3003,135135,8,10725,1856,-936,225225,-8448,4992,-1144,225225,-1440,4160,-4576,1716,225225,-136,63063,1024,-208,105105,3584,-3328,1144,315315,-128,135135,-2560,832,405405,128,99099],u.Geodesic.prototype.C4coeff=function(){var Nt=0,qt=0,Xt,Dt,Mt;for(Xt=0;Xt<u.nC4_;++Xt)for(Dt=u.nC4_-1;Dt>=Xt;--Dt)Mt=u.nC4_-Dt-1,this._C4x[qt++]=m.polyval(Mt,Ri,Nt,this._n)/Ri[Nt+Mt+1],Nt+=Mt+2},u.Geodesic.prototype.A3f=function(Nt){return m.polyval(D-1,this._A3x,0,Nt)},u.Geodesic.prototype.C3f=function(Nt,qt){var Xt=1,Dt=0,Mt,Lt;for(Mt=1;Mt<u.nC3_;++Mt)Lt=u.nC3_-Mt-1,Xt*=Nt,qt[Mt]=Xt*m.polyval(Lt,this._C3x,Dt,Nt),Dt+=Lt+1},u.Geodesic.prototype.C4f=function(Nt,qt){var Xt=1,Dt=0,Mt,Lt;for(Mt=0;Mt<u.nC4_;++Mt)Lt=u.nC4_-Mt-1,qt[Mt]=Xt*m.polyval(Lt,this._C4x,Dt,Nt),Dt+=Lt+1,Xt*=Nt},u.Geodesic.prototype.Lengths=function(Nt,qt,Xt,Dt,Mt,Lt,ee,de,Ee,me,Ge,ae,Se){Ge&=u.OUT_MASK;var ze={},Wt=0,oe=0,Ce=0,je=0,Xe,De,We,Ze,pi;if(Ge&(u.DISTANCE|u.REDUCEDLENGTH|u.GEODESICSCALE)&&(Ce=u.A1m1f(Nt),u.C1f(Nt,ae),Ge&(u.REDUCEDLENGTH|u.GEODESICSCALE)&&(je=u.A2m1f(Nt),u.C2f(Nt,Se),Wt=Ce-je,je=1+je),Ce=1+Ce),Ge&u.DISTANCE)Xe=u.SinCosSeries(!0,Lt,ee,ae)-u.SinCosSeries(!0,Xt,Dt,ae),ze.s12b=Ce*(qt+Xe),Ge&(u.REDUCEDLENGTH|u.GEODESICSCALE)&&(De=u.SinCosSeries(!0,Lt,ee,Se)-u.SinCosSeries(!0,Xt,Dt,Se),oe=Wt*qt+(Ce*Xe-je*De));else if(Ge&(u.REDUCEDLENGTH|u.GEODESICSCALE)){for(We=1;We<=u.nC2_;++We)Se[We]=Ce*ae[We]-je*Se[We];oe=Wt*qt+(u.SinCosSeries(!0,Lt,ee,Se)-u.SinCosSeries(!0,Xt,Dt,Se))}return Ge&u.REDUCEDLENGTH&&(ze.m0=Wt,ze.m12b=de*(Dt*Lt)-Mt*(Xt*ee)-Dt*ee*oe),Ge&u.GEODESICSCALE&&(Ze=Dt*ee+Xt*Lt,pi=this._ep2*(Ee-me)*(Ee+me)/(Mt+de),ze.M12=Ze+(pi*Lt-ee*oe)*Xt/Mt,ze.M21=Ze-(pi*Xt-Dt*oe)*Lt/de),ze},u.Geodesic.prototype.InverseStart=function(Nt,qt,Xt,Dt,Mt,Lt,ee,de,Ee,me,Ge){var ae={},Se=Dt*qt-Mt*Nt,ze=Mt*qt+Dt*Nt,Wt,oe,Ce,je,Xe,De,We,Ze,pi,Be,Ne,Ae,ci,Ti,ir,Vi,xr,br,ni,Di,yt,Z,X;return ae.sig12=-1,Wt=Dt*qt,Wt+=Mt*Nt,oe=ze>=0&&Se<.5&&Mt*ee<.5,oe?(je=m.sq(Nt+Dt),je/=je+m.sq(qt+Mt),ae.dnm=Math.sqrt(1+this._ep2*je),Ce=ee/(this._f1*ae.dnm),Xe=Math.sin(Ce),De=Math.cos(Ce)):(Xe=de,De=Ee),ae.salp1=Mt*Xe,ae.calp1=De>=0?Se+Mt*Nt*m.sq(Xe)/(1+De):Wt-Mt*Nt*m.sq(Xe)/(1-De),Ze=m.hypot(ae.salp1,ae.calp1),pi=Nt*Dt+qt*Mt*De,oe&&Ze<this._etol2?(ae.salp2=qt*Xe,ae.calp2=Se-qt*Dt*(De>=0?m.sq(Xe)/(1+De):1-De),We=m.hypot(ae.salp2,ae.calp2),ae.salp2/=We,ae.calp2/=We,ae.sig12=Math.atan2(Ze,pi)):Math.abs(this._n)>.1||pi>=0||Ze>=6*Math.abs(this._n)*Math.PI*m.sq(qt)||(X=Math.atan2(-de,-Ee),this.f>=0?(Ti=m.sq(Nt)*this._ep2,ir=Ti/(2*(1+Math.sqrt(1+Ti))+Ti),Ae=this.f*qt*this.A3f(ir)*Math.PI,ci=Ae*qt,Be=X/Ae,Ne=Wt/ci):(Vi=Mt*qt-Dt*Nt,xr=Math.atan2(Wt,Vi),Di=this.Lengths(this._n,Math.PI+xr,Nt,-qt,Xt,Dt,Mt,Lt,qt,Mt,u.REDUCEDLENGTH,me,Ge),br=Di.m12b,ni=Di.m0,Be=-1+br/(qt*Mt*ni*Math.PI),ci=Be<-.01?Wt/Be:-this.f*m.sq(qt)*Math.PI,Ae=ci/qt,Ne=ee/Ae),Ne>-dt&&Be>-1-Gt?this.f>=0?(ae.salp1=Math.min(1,-Be),ae.calp1=-Math.sqrt(1-m.sq(ae.salp1))):(ae.calp1=Math.max(Be>-dt?0:-1,Be),ae.salp1=Math.sqrt(1-m.sq(ae.calp1))):(yt=Re(Be,Ne),Z=Ae*(this.f>=0?-Be*yt/(1+yt):-Ne*(1+yt)/yt),Xe=Math.sin(Z),De=-Math.cos(Z),ae.salp1=Mt*Xe,ae.calp1=Wt-Mt*Nt*m.sq(Xe)/(1-De))),ae.salp1<=0?(ae.salp1=1,ae.calp1=0):(We=m.hypot(ae.salp1,ae.calp1),ae.salp1/=We,ae.calp1/=We),ae},u.Geodesic.prototype.Lambda12=function(Nt,qt,Xt,Dt,Mt,Lt,ee,de,Ee,me,Ge,ae,Se,ze){var Wt={},oe,Ce,je,Xe,De,We,Ze,pi,Be,Ne,Ae,ci,Ti;return Nt===0&&de===0&&(de=-u.tiny_),Ce=ee*qt,je=m.hypot(de,ee*Nt),Wt.ssig1=Nt,Xe=Ce*Nt,Wt.csig1=De=de*qt,oe=m.hypot(Wt.ssig1,Wt.csig1),Wt.ssig1/=oe,Wt.csig1/=oe,Wt.salp2=Mt!==qt?Ce/Mt:ee,Wt.calp2=Mt!==qt||Math.abs(Dt)!==-Nt?Math.sqrt(m.sq(de*qt)+(qt<-Nt?(Mt-qt)*(qt+Mt):(Nt-Dt)*(Nt+Dt)))/Mt:Math.abs(de),Wt.ssig2=Dt,We=Ce*Dt,Wt.csig2=Ze=Wt.calp2*Mt,oe=m.hypot(Wt.ssig2,Wt.csig2),Wt.ssig2/=oe,Wt.csig2/=oe,Wt.sig12=Math.atan2(Math.max(0,Wt.csig1*Wt.ssig2-Wt.ssig1*Wt.csig2),Wt.csig1*Wt.csig2+Wt.ssig1*Wt.ssig2),pi=Math.max(0,De*We-Xe*Ze),Be=De*Ze+Xe*We,Ae=Math.atan2(pi*me-Be*Ee,Be*me+pi*Ee),ci=m.sq(je)*this._ep2,Wt.eps=ci/(2*(1+Math.sqrt(1+ci))+ci),this.C3f(Wt.eps,ze),Ne=u.SinCosSeries(!0,Wt.ssig2,Wt.csig2,ze)-u.SinCosSeries(!0,Wt.ssig1,Wt.csig1,ze),Wt.domg12=-this.f*this.A3f(Wt.eps)*Ce*(Wt.sig12+Ne),Wt.lam12=Ae+Wt.domg12,Ge&&(Wt.calp2===0?Wt.dlam12=-2*this._f1*Xt/Nt:(Ti=this.Lengths(Wt.eps,Wt.sig12,Wt.ssig1,Wt.csig1,Xt,Wt.ssig2,Wt.csig2,Lt,qt,Mt,u.REDUCEDLENGTH,ae,Se),Wt.dlam12=Ti.m12b,Wt.dlam12*=this._f1/(Wt.calp2*Mt))),Wt},u.Geodesic.prototype.Inverse=function(Nt,qt,Xt,Dt,Mt){var Lt,ee;return Mt||(Mt=u.STANDARD),Mt===u.LONG_UNROLL&&(Mt|=u.STANDARD),Mt&=u.OUT_MASK,Lt=this.InverseInt(Nt,qt,Xt,Dt,Mt),ee=Lt.vals,Mt&u.AZIMUTH&&(ee.azi1=m.atan2d(Lt.salp1,Lt.calp1),ee.azi2=m.atan2d(Lt.salp2,Lt.calp2)),ee},u.Geodesic.prototype.InverseInt=function(Nt,qt,Xt,Dt,Mt){var Lt={},ee,de,Ee,me,Ge,ae,Se,ze,Wt,oe,Ce,je,Xe,De,We,Ze,pi,Be,Ne,Ae,ci,Ti,ir,Vi,xr,br,ni,Di,yt,Z,X,Y,at,gt,bt,Tt,vt,zt,At,wt,Bt,pt,ie,ve,se,ge,Te,fi,hi,ti,be,qe,qi,Ht,Hi,Mi,Fr,ts,Yt,ke,Le,rr,Ds,Br,Oe;if(Lt.lat1=Nt=m.LatFix(Nt),Lt.lat2=Xt=m.LatFix(Xt),Nt=m.AngRound(Nt),Xt=m.AngRound(Xt),ee=m.AngDiff(qt,Dt),de=ee.e,ee=ee.d,Mt&u.LONG_UNROLL?(Lt.lon1=qt,Lt.lon2=qt+ee+de):(Lt.lon1=m.AngNormalize(qt),Lt.lon2=m.AngNormalize(Dt)),Ee=m.copysign(1,ee),ee*=Ee,de*=Ee,We=ee*m.degree,me=m.sincosde(ee,de),Ze=me.s,pi=me.c,de=180-ee-de,Ge=Math.abs(Nt)<Math.abs(Xt)||isNaN(Xt)?-1:1,Ge<0&&(Ee*=-1,[Xt,Nt]=[Nt,Xt]),ae=m.copysign(1,-Nt),Nt*=ae,Xt*=ae,me=m.sincosd(Nt),Se=this._f1*me.s,ze=me.c,me=m.hypot(Se,ze),Se/=me,ze/=me,ze=Math.max(u.tiny_,ze),me=m.sincosd(Xt),Wt=this._f1*me.s,oe=me.c,me=m.hypot(Wt,oe),Wt/=me,oe/=me,oe=Math.max(u.tiny_,oe),ze<-Se?oe===ze&&(Wt=m.copysign(Se,Wt)):Math.abs(Wt)===-Se&&(oe=ze),Xe=Math.sqrt(1+this._ep2*m.sq(Se)),De=Math.sqrt(1+this._ep2*m.sq(Wt)),ir=new Array(u.nC1_+1),Vi=new Array(u.nC2_+1),xr=new Array(u.nC3_),br=Nt===-90||Ze===0,br&&(Ne=pi,Ae=Ze,ci=1,Ti=0,Di=Se,yt=Ne*ze,Z=Wt,X=ci*oe,Be=Math.atan2(Math.max(0,yt*Z-Di*X),yt*X+Di*Z),ni=this.Lengths(this._n,Be,Di,yt,Xe,Z,X,De,ze,oe,Mt|u.DISTANCE|u.REDUCEDLENGTH,ir,Vi),Ce=ni.s12b,je=ni.m12b,Mt&u.GEODESICSCALE&&(Lt.M12=ni.M12,Lt.M21=ni.M21),Be<1||je>=0?((Be<3*u.tiny_||Be<ft&&(Ce<0||je<0))&&(Be=je=Ce=0),je*=this._b,Ce*=this._b,Lt.a12=Be/m.degree):br=!1),Fr=2,!br&&Se===0&&(this.f<=0||de>=this.f*180))Ne=ci=0,Ae=Ti=1,Ce=this.a*We,Be=at=We/this._f1,je=this._b*Math.sin(Be),Mt&u.GEODESICSCALE&&(Lt.M12=Lt.M21=Math.cos(Be)),Lt.a12=ee/this._f1;else if(!br)if(ni=this.InverseStart(Se,ze,Xe,Wt,oe,De,We,Ze,pi,ir,Vi),Be=ni.sig12,Ae=ni.salp1,Ne=ni.calp1,Be>=0)Ti=ni.salp2,ci=ni.calp2,gt=ni.dnm,Ce=Be*this._b*gt,je=m.sq(gt)*this._b*Math.sin(Be/gt),Mt&u.GEODESICSCALE&&(Lt.M12=Lt.M21=Math.cos(Be/gt)),Lt.a12=Be/m.degree,at=We/(this._f1*gt);else{for(bt=0,Tt=u.tiny_,vt=1,zt=u.tiny_,At=-1,wt=!1,Bt=!1;ni=this.Lambda12(Se,ze,Xe,Wt,oe,De,Ae,Ne,Ze,pi,bt<et,ir,Vi,xr),pt=ni.lam12,Ti=ni.salp2,ci=ni.calp2,Be=ni.sig12,Di=ni.ssig1,yt=ni.csig1,Z=ni.ssig2,X=ni.csig2,Y=ni.eps,Yt=ni.domg12,ie=ni.dlam12,!(Bt||!(Math.abs(pt)>=(wt?8:1)*ft)||bt==it);++bt){if(pt>0&&(bt<et||Ne/Ae>At/zt)?(zt=Ae,At=Ne):pt<0&&(bt<et||Ne/Ae<vt/Tt)&&(Tt=Ae,vt=Ne),bt<et&&ie>0&&(ve=-pt/ie,Math.abs(ve)<Math.PI&&(se=Math.sin(ve),ge=Math.cos(ve),Te=Ae*ge+Ne*se,Te>0))){Ne=Ne*ge-Ae*se,Ae=Te,me=m.hypot(Ae,Ne),Ae/=me,Ne/=me,wt=Math.abs(pt)<=16*ft;continue}Ae=(Tt+zt)/2,Ne=(vt+At)/2,me=m.hypot(Ae,Ne),Ae/=me,Ne/=me,wt=!1,Bt=Math.abs(Tt-Ae)+(vt-Ne)<jt||Math.abs(Ae-zt)+(Ne-At)<jt}fi=Mt|(Mt&(u.REDUCEDLENGTH|u.GEODESICSCALE)?u.DISTANCE:u.NONE),ni=this.Lengths(Y,Be,Di,yt,Xe,Z,X,De,ze,oe,fi,ir,Vi),Ce=ni.s12b,je=ni.m12b,Mt&u.GEODESICSCALE&&(Lt.M12=ni.M12,Lt.M21=ni.M21),je*=this._b,Ce*=this._b,Lt.a12=Be/m.degree,Mt&u.AREA&&(Br=Math.sin(Yt),Oe=Math.cos(Yt),Fr=Ze*Oe-pi*Br,ts=pi*Oe+Ze*Br)}return Mt&u.DISTANCE&&(Lt.s12=0+Ce),Mt&u.REDUCEDLENGTH&&(Lt.m12=0+je),Mt&u.AREA&&(hi=Ae*ze,ti=m.hypot(Ne,Ae*Se),ti!==0&&hi!==0?(Di=Se,yt=Ne*ze,Z=Wt,X=ci*oe,qe=m.sq(ti)*this._ep2,Y=qe/(2*(1+Math.sqrt(1+qe))+qe),qi=m.sq(this.a)*ti*hi*this._e2,me=m.hypot(Di,yt),Di/=me,yt/=me,me=m.hypot(Z,X),Z/=me,X/=me,Ht=new Array(u.nC4_),this.C4f(Y,Ht),Hi=u.SinCosSeries(!1,Di,yt,Ht),Mi=u.SinCosSeries(!1,Z,X,Ht),Lt.S12=qi*(Mi-Hi)):Lt.S12=0,!br&&Fr==2&&(Fr=Math.sin(at),ts=Math.cos(at)),!br&&ts>-.7071&&Wt-Se<1.75?(Yt=1+ts,ke=1+ze,Le=1+oe,be=2*Math.atan2(Fr*(Se*Le+Wt*ke),Yt*(Se*Wt+ke*Le))):(rr=Ti*Ne-ci*Ae,Ds=ci*Ne+Ti*Ae,rr===0&&Ds<0&&(rr=u.tiny_*Ne,Ds=-1),be=Math.atan2(rr,Ds)),Lt.S12+=this._c2*be,Lt.S12*=Ge*Ee*ae,Lt.S12+=0),Ge<0&&([Ti,Ae]=[Ae,Ti],[ci,Ne]=[Ne,ci],Mt&u.GEODESICSCALE&&([Lt.M21,Lt.M12]=[Lt.M12,Lt.M21])),Ae*=Ge*Ee,Ne*=Ge*ae,Ti*=Ge*Ee,ci*=Ge*ae,{vals:Lt,salp1:Ae,calp1:Ne,salp2:Ti,calp2:ci}},u.Geodesic.prototype.GenDirect=function(Nt,qt,Xt,Dt,Mt,Lt){var ee;return Lt?Lt===u.LONG_UNROLL&&(Lt|=u.STANDARD):Lt=u.STANDARD,Dt||(Lt|=u.DISTANCE_IN),ee=new p.GeodesicLine(this,Nt,qt,Xt,Lt),ee.GenPosition(Dt,Mt,Lt)},u.Geodesic.prototype.Direct=function(Nt,qt,Xt,Dt,Mt){return this.GenDirect(Nt,qt,Xt,!1,Dt,Mt)},u.Geodesic.prototype.ArcDirect=function(Nt,qt,Xt,Dt,Mt){return this.GenDirect(Nt,qt,Xt,!0,Dt,Mt)},u.Geodesic.prototype.Line=function(Nt,qt,Xt,Dt){return new p.GeodesicLine(this,Nt,qt,Xt,Dt)},u.Geodesic.prototype.DirectLine=function(Nt,qt,Xt,Dt,Mt){return this.GenDirectLine(Nt,qt,Xt,!1,Dt,Mt)},u.Geodesic.prototype.ArcDirectLine=function(Nt,qt,Xt,Dt,Mt){return this.GenDirectLine(Nt,qt,Xt,!0,Dt,Mt)},u.Geodesic.prototype.GenDirectLine=function(Nt,qt,Xt,Dt,Mt,Lt){var ee;return Lt||(Lt=u.STANDARD|u.DISTANCE_IN),Dt||(Lt|=u.DISTANCE_IN),ee=new p.GeodesicLine(this,Nt,qt,Xt,Lt),ee.GenSetDistance(Dt,Mt),ee},u.Geodesic.prototype.InverseLine=function(Nt,qt,Xt,Dt,Mt){var Lt,ee,de;return Mt||(Mt=u.STANDARD|u.DISTANCE_IN),Lt=this.InverseInt(Nt,qt,Xt,Dt,u.ARC),de=m.atan2d(Lt.salp1,Lt.calp1),Mt&(u.OUT_MASK&u.DISTANCE_IN)&&(Mt|=u.DISTANCE),ee=new p.GeodesicLine(this,Nt,qt,de,Mt,Lt.salp1,Lt.calp1),ee.SetArc(Lt.vals.a12),ee},u.Geodesic.prototype.Polygon=function(Nt){return new x.PolygonArea(this,Nt)},u.WGS84=new u.Geodesic(o.WGS84.a,o.WGS84.f)}(l.Geodesic,l.GeodesicLine,l.PolygonArea,l.Math,l.Constants),function(u,p,x){p.GeodesicLine=function(m,o,P,A,L,z,D){var B,$,et,it,ft,dt;L||(L=u.STANDARD|u.DISTANCE_IN),this.a=m.a,this.f=m.f,this._b=m._b,this._c2=m._c2,this._f1=m._f1,this.caps=L|u.LATITUDE|u.AZIMUTH|u.LONG_UNROLL,this.lat1=x.LatFix(o),this.lon1=P,typeof z>"u"||typeof D>"u"?(this.azi1=x.AngNormalize(A),B=x.sincosd(x.AngRound(this.azi1)),this.salp1=B.s,this.calp1=B.c):(this.azi1=A,this.salp1=z,this.calp1=D),B=x.sincosd(x.AngRound(this.lat1)),et=this._f1*B.s,$=B.c,B=x.hypot(et,$),et/=B,$/=B,$=Math.max(u.tiny_,$),this._dn1=Math.sqrt(1+m._ep2*x.sq(et)),this._salp0=this.salp1*$,this._calp0=x.hypot(this.calp1,this.salp1*et),this._ssig1=et,this._somg1=this._salp0*et,this._csig1=this._comg1=et!==0||this.calp1!==0?$*this.calp1:1,B=x.hypot(this._ssig1,this._csig1),this._ssig1/=B,this._csig1/=B,this._k2=x.sq(this._calp0)*m._ep2,it=this._k2/(2*(1+Math.sqrt(1+this._k2))+this._k2),this.caps&u.CAP_C1&&(this._A1m1=u.A1m1f(it),this._C1a=new Array(u.nC1_+1),u.C1f(it,this._C1a),this._B11=u.SinCosSeries(!0,this._ssig1,this._csig1,this._C1a),ft=Math.sin(this._B11),dt=Math.cos(this._B11),this._stau1=this._ssig1*dt+this._csig1*ft,this._ctau1=this._csig1*dt-this._ssig1*ft),this.caps&u.CAP_C1p&&(this._C1pa=new Array(u.nC1p_+1),u.C1pf(it,this._C1pa)),this.caps&u.CAP_C2&&(this._A2m1=u.A2m1f(it),this._C2a=new Array(u.nC2_+1),u.C2f(it,this._C2a),this._B21=u.SinCosSeries(!0,this._ssig1,this._csig1,this._C2a)),this.caps&u.CAP_C3&&(this._C3a=new Array(u.nC3_),m.C3f(it,this._C3a),this._A3c=-this.f*this._salp0*m.A3f(it),this._B31=u.SinCosSeries(!0,this._ssig1,this._csig1,this._C3a)),this.caps&u.CAP_C4&&(this._C4a=new Array(u.nC4_),m.C4f(it,this._C4a),this._A4=x.sq(this.a)*this._calp0*this._salp0*m._e2,this._B41=u.SinCosSeries(!1,this._ssig1,this._csig1,this._C4a)),this.a13=this.s13=NaN},p.GeodesicLine.prototype.GenPosition=function(m,o,P){var A={},L,z,D,B,$,et,it,ft,dt,Ot,jt,Gt,re,Ie,_e,Re,ri,$e,oi,Qe,wi,li,Ii,Ri,Nt,qt,Xt,Dt,Mt;return P?P===u.LONG_UNROLL&&(P|=u.STANDARD):P=u.STANDARD,P&=this.caps&u.OUT_MASK,A.lat1=this.lat1,A.azi1=this.azi1,A.lon1=P&u.LONG_UNROLL?this.lon1:x.AngNormalize(this.lon1),m?A.a12=o:A.s12=o,m||this.caps&u.DISTANCE_IN&u.OUT_MASK?(B=0,$=0,m?(L=o*x.degree,qt=x.sincosd(o),z=qt.s,D=qt.c):(ft=o/(this._b*(1+this._A1m1)),dt=Math.sin(ft),Ot=Math.cos(ft),B=-u.SinCosSeries(!0,this._stau1*Ot+this._ctau1*dt,this._ctau1*Ot-this._stau1*dt,this._C1pa),L=ft-(B-this._B11),z=Math.sin(L),D=Math.cos(L),Math.abs(this.f)>.01&&(et=this._ssig1*D+this._csig1*z,it=this._csig1*D-this._ssig1*z,B=u.SinCosSeries(!0,et,it,this._C1a),jt=(1+this._A1m1)*(L+(B-this._B11))-o/this._b,L=L-jt/Math.sqrt(1+this._k2*x.sq(et)),z=Math.sin(L),D=Math.cos(L))),et=this._ssig1*D+this._csig1*z,it=this._csig1*D-this._ssig1*z,li=Math.sqrt(1+this._k2*x.sq(et)),P&(u.DISTANCE|u.REDUCEDLENGTH|u.GEODESICSCALE)&&((m||Math.abs(this.f)>.01)&&(B=u.SinCosSeries(!0,et,it,this._C1a)),$=(1+this._A1m1)*(B-this._B11)),Re=this._calp0*et,ri=x.hypot(this._salp0,this._calp0*it),ri===0&&(ri=it=u.tiny_),Qe=this._salp0,wi=this._calp0*it,m&&P&u.DISTANCE&&(A.s12=this._b*((1+this._A1m1)*L+$)),P&u.LONGITUDE&&($e=this._salp0*et,oi=it,_e=x.copysign(1,this._salp0),Gt=P&u.LONG_UNROLL?_e*(L-(Math.atan2(et,it)-Math.atan2(this._ssig1,this._csig1))+(Math.atan2(_e*$e,oi)-Math.atan2(_e*this._somg1,this._comg1))):Math.atan2($e*this._comg1-oi*this._somg1,oi*this._comg1+$e*this._somg1),re=Gt+this._A3c*(L+(u.SinCosSeries(!0,et,it,this._C3a)-this._B31)),Ie=re/x.degree,A.lon2=P&u.LONG_UNROLL?this.lon1+Ie:x.AngNormalize(x.AngNormalize(this.lon1)+x.AngNormalize(Ie))),P&u.LATITUDE&&(A.lat2=x.atan2d(Re,this._f1*ri)),P&u.AZIMUTH&&(A.azi2=x.atan2d(Qe,wi)),P&(u.REDUCEDLENGTH|u.GEODESICSCALE)&&(Ii=u.SinCosSeries(!0,et,it,this._C2a),Ri=(1+this._A2m1)*(Ii-this._B21),Nt=(this._A1m1-this._A2m1)*L+($-Ri),P&u.REDUCEDLENGTH&&(A.m12=this._b*(li*(this._csig1*et)-this._dn1*(this._ssig1*it)-this._csig1*it*Nt)),P&u.GEODESICSCALE&&(qt=this._k2*(et-this._ssig1)*(et+this._ssig1)/(this._dn1+li),A.M12=D+(qt*et-it*Nt)*this._ssig1/this._dn1,A.M21=D-(qt*this._ssig1-this._csig1*Nt)*et/li)),P&u.AREA&&(Xt=u.SinCosSeries(!1,et,it,this._C4a),this._calp0===0||this._salp0===0?(Dt=Qe*this.calp1-wi*this.salp1,Mt=wi*this.calp1+Qe*this.salp1):(Dt=this._calp0*this._salp0*(D<=0?this._csig1*(1-D)+z*this._ssig1:z*(this._csig1*z/(1+D)+this._ssig1)),Mt=x.sq(this._salp0)+x.sq(this._calp0)*this._csig1*it),A.S12=this._c2*Math.atan2(Dt,Mt)+this._A4*(Xt-this._B41)),m||(A.a12=L/x.degree),A):(A.a12=NaN,A)},p.GeodesicLine.prototype.Position=function(m,o){return this.GenPosition(!1,m,o)},p.GeodesicLine.prototype.ArcPosition=function(m,o){return this.GenPosition(!0,m,o)},p.GeodesicLine.prototype.GenSetDistance=function(m,o){m?this.SetArc(o):this.SetDistance(o)},p.GeodesicLine.prototype.SetDistance=function(m){var o;this.s13=m,o=this.GenPosition(!1,this.s13,u.ARC),this.a13=0+o.a12},p.GeodesicLine.prototype.SetArc=function(m){var o;this.a13=m,o=this.GenPosition(!0,this.a13,u.DISTANCE),this.s13=0+o.s12}}(l.Geodesic,l.GeodesicLine,l.Math),function(u,p,x,m){var o,P,A,L;o=function(z,D){var B=x.AngDiff(z,D).d;return z=x.AngNormalize(z),D=x.AngNormalize(D),B>0&&(z<0&&D>=0||z>0&&D===0)?1:B<0&&z>=0&&D<0?-1:0},P=function(z,D){return z=z%720,D=D%720,(0<=D&&D<360||D<-360?0:1)-(0<=z&&z<360||z<-360?0:1)},A=function(z,D,B,$,et){return z.Remainder(D),B&1&&z.Add((z.Sum()<0?1:-1)*D/2),$||z.Negate(),et?z.Sum()>D/2?z.Add(-D):z.Sum()<=-D/2&&z.Add(+D):z.Sum()>=D?z.Add(-D):z.Sum()<0&&z.Add(+D),0+z.Sum()},L=function(z,D,B,$,et){return z=x.remainder(z,D),B&1&&(z+=(z<0?1:-1)*D/2),$||(z*=-1),et?z>D/2?z-=D:z<=-D/2&&(z+=D):z>=D?z-=D:z<0&&(z+=D),0+z},u.PolygonArea=function(z,D){this._geod=z,this.a=this._geod.a,this.f=this._geod.f,this._area0=4*Math.PI*z._c2,this.polyline=D||!1,this._mask=p.LATITUDE|p.LONGITUDE|p.DISTANCE|(this.polyline?p.NONE:p.AREA|p.LONG_UNROLL),this.polyline||(this._areasum=new m.Accumulator(0)),this._perimetersum=new m.Accumulator(0),this.Clear()},u.PolygonArea.prototype.Clear=function(){this.num=0,this._crossings=0,this.polyline||this._areasum.Set(0),this._perimetersum.Set(0),this._lat0=this._lon0=this.lat=this.lon=NaN},u.PolygonArea.prototype.AddPoint=function(z,D){var B;this.num===0?(this._lat0=this.lat=z,this._lon0=this.lon=D):(B=this._geod.Inverse(this.lat,this.lon,z,D,this._mask),this._perimetersum.Add(B.s12),this.polyline||(this._areasum.Add(B.S12),this._crossings+=o(this.lon,D)),this.lat=z,this.lon=D),++this.num},u.PolygonArea.prototype.AddEdge=function(z,D){var B;this.num&&(B=this._geod.Direct(this.lat,this.lon,z,D,this._mask),this._perimetersum.Add(D),this.polyline||(this._areasum.Add(B.S12),this._crossings+=P(this.lon,B.lon2)),this.lat=B.lat2,this.lon=B.lon2),++this.num},u.PolygonArea.prototype.Compute=function(z,D){var B={number:this.num},$,et;return this.num<2?(B.perimeter=0,this.polyline||(B.area=0),B):this.polyline?(B.perimeter=this._perimetersum.Sum(),B):($=this._geod.Inverse(this.lat,this.lon,this._lat0,this._lon0,this._mask),B.perimeter=this._perimetersum.Sum($.s12),et=new m.Accumulator(this._areasum),et.Add($.S12),B.area=A(et,this._area0,this._crossings+o(this.lon,this._lon0),z,D),B)},u.PolygonArea.prototype.TestPoint=function(z,D,B,$){var et={number:this.num+1},it,ft,dt,Ot;if(this.num===0)return et.perimeter=0,this.polyline||(et.area=0),et;for(et.perimeter=this._perimetersum.Sum(),ft=this.polyline?0:this._areasum.Sum(),dt=this._crossings,Ot=0;Ot<(this.polyline?1:2);++Ot)it=this._geod.Inverse(Ot===0?this.lat:z,Ot===0?this.lon:D,Ot!==0?this._lat0:z,Ot!==0?this._lon0:D,this._mask),et.perimeter+=it.s12,this.polyline||(ft+=it.S12,dt+=o(Ot===0?this.lon:D,Ot!==0?this._lon0:D));return this.polyline||(et.area=L(ft,this._area0,dt,B,$)),et},u.PolygonArea.prototype.TestEdge=function(z,D,B,$){var et={number:this.num?this.num+1:0},it,ft,dt;return this.num===0||(et.perimeter=this._perimetersum.Sum()+D,this.polyline)||(ft=this._areasum.Sum(),dt=this._crossings,it=this._geod.Direct(this.lat,this.lon,z,D,this._mask),ft+=it.S12,dt+=P(this.lon,it.lon2),dt+=o(it.lon2,this._lon0),it=this._geod.Inverse(it.lat2,it.lon2,this._lat0,this._lon0,this._mask),et.perimeter+=it.s12,ft+=it.S12,et.area=L(ft,this._area0,dt,B,$)),et}}(l.PolygonArea,l.Geodesic,l.Math,l.Accumulator),i(l)})(function(i){a.exports?a.exports=i:window.geodesic=i})}(kp)),kp.exports}var _I=gI();function yI(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.g=new _I.Geodesic.Geodesic(this.a,this.es/(1+Math.sqrt(1-this.es)))}function vI(a){var i=a.x,l=a.y,u=Math.sin(a.y),p=Math.cos(a.y),x=fe(i-this.long0),m,o,P,A,L,z,D,B,$,et,it,ft,dt,Ot,jt;return this.sphere?Math.abs(this.sin_p12-1)<=le?(a.x=this.x0+this.a*(Qt-l)*Math.sin(x),a.y=this.y0-this.a*(Qt-l)*Math.cos(x),a):Math.abs(this.sin_p12+1)<=le?(a.x=this.x0+this.a*(Qt+l)*Math.sin(x),a.y=this.y0+this.a*(Qt+l)*Math.cos(x),a):($=this.sin_p12*u+this.cos_p12*p*Math.cos(x),D=Math.acos($),B=D?D/Math.sin(D):1,a.x=this.x0+this.a*B*p*Math.sin(x),a.y=this.y0+this.a*B*(this.cos_p12*u-this.sin_p12*p*Math.cos(x)),a):(m=Nc(this.es),o=Gc(this.es),P=jc(this.es),A=Uc(this.es),Math.abs(this.sin_p12-1)<=le?(L=this.a*Jr(m,o,P,A,Qt),z=this.a*Jr(m,o,P,A,l),a.x=this.x0+(L-z)*Math.sin(x),a.y=this.y0-(L-z)*Math.cos(x),a):Math.abs(this.sin_p12+1)<=le?(L=this.a*Jr(m,o,P,A,Qt),z=this.a*Jr(m,o,P,A,l),a.x=this.x0+(L+z)*Math.sin(x),a.y=this.y0+(L+z)*Math.cos(x),a):Math.abs(i)<le&&Math.abs(l-this.lat0)<le?(a.x=a.y=0,a):(et=this.lat0/Ai,it=this.long0/Ai,ft=l/Ai,dt=i/Ai,Ot=this.g.Inverse(et,it,ft,dt,this.g.AZIMUTH),jt=Ot.azi1*Ai,a.x=Ot.s12*Math.sin(jt),a.y=Ot.s12*Math.cos(jt),a))}function xI(a){a.x-=this.x0,a.y-=this.y0;var i,l,u,p,x,m,o,P,A,L,z,D,B,$,et,it,ft,dt;return this.sphere?(i=Math.sqrt(a.x*a.x+a.y*a.y),i>2*Qt*this.a?void 0:(l=i/this.a,u=Math.sin(l),p=Math.cos(l),x=this.long0,Math.abs(i)<=le?m=this.lat0:(m=Ma(p*this.sin_p12+a.y*u*this.cos_p12/i),o=Math.abs(this.lat0)-Qt,Math.abs(o)<=le?this.lat0>=0?x=fe(this.long0+Math.atan2(a.x,-a.y)):x=fe(this.long0-Math.atan2(-a.x,a.y)):x=fe(this.long0+Math.atan2(a.x*u,i*this.cos_p12*p-a.y*this.sin_p12*u))),a.x=x,a.y=m,a)):(P=Nc(this.es),A=Gc(this.es),L=jc(this.es),z=Uc(this.es),Math.abs(this.sin_p12-1)<=le?(D=this.a*Jr(P,A,L,z,Qt),i=Math.sqrt(a.x*a.x+a.y*a.y),B=D-i,m=Fd(B/this.a,P,A,L,z),x=fe(this.long0+Math.atan2(a.x,-1*a.y)),a.x=x,a.y=m,a):Math.abs(this.sin_p12+1)<=le?(D=this.a*Jr(P,A,L,z,Qt),i=Math.sqrt(a.x*a.x+a.y*a.y),B=i-D,m=Fd(B/this.a,P,A,L,z),x=fe(this.long0+Math.atan2(a.x,a.y)),a.x=x,a.y=m,a):($=this.lat0/Ai,et=this.long0/Ai,it=Math.atan2(a.x,a.y)/Ai,ft=Math.sqrt(a.x*a.x+a.y*a.y),dt=this.g.Direct($,et,it,ft,this.g.STANDARD),a.x=dt.lon2*Ai,a.y=dt.lat2*Ai,a))}var bI=["Azimuthal_Equidistant","aeqd"];const wI={init:yI,forward:vI,inverse:xI,names:bI};function MI(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function SI(a){var i,l,u,p,x,m,o,P,A=a.x,L=a.y;return u=fe(A-this.long0),i=Math.sin(L),l=Math.cos(L),p=Math.cos(u),m=this.sin_p14*i+this.cos_p14*l*p,x=1,(m>0||Math.abs(m)<=le)&&(o=this.a*x*l*Math.sin(u),P=this.y0+this.a*x*(this.cos_p14*i-this.sin_p14*l*p)),a.x=o,a.y=P,a}function TI(a){var i,l,u,p,x,m,o;return a.x-=this.x0,a.y-=this.y0,i=Math.sqrt(a.x*a.x+a.y*a.y),l=Ma(i/this.a),u=Math.sin(l),p=Math.cos(l),m=this.long0,Math.abs(i)<=le?(o=this.lat0,a.x=m,a.y=o,a):(o=Ma(p*this.sin_p14+a.y*u*this.cos_p14/i),x=Math.abs(this.lat0)-Qt,Math.abs(x)<=le?(this.lat0>=0?m=fe(this.long0+Math.atan2(a.x,-a.y)):m=fe(this.long0-Math.atan2(-a.x,a.y)),a.x=m,a.y=o,a):(m=fe(this.long0+Math.atan2(a.x*u,i*this.cos_p14*p-a.y*this.sin_p14*u)),a.x=m,a.y=o,a))}var PI=["ortho"];const EI={init:MI,forward:SI,inverse:TI,names:PI};var Xi={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},bi={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function II(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Qt-xi/2?this.face=Xi.TOP:this.lat0<=-(Qt-xi/2)?this.face=Xi.BOTTOM:Math.abs(this.long0)<=xi?this.face=Xi.FRONT:Math.abs(this.long0)<=Qt+xi?this.face=this.long0>0?Xi.RIGHT:Xi.LEFT:this.face=Xi.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function CI(a){var i={x:0,y:0},l,u,p,x,m,o,P={value:0};if(a.x-=this.long0,this.es!==0?l=Math.atan(this.one_minus_f_squared*Math.tan(a.y)):l=a.y,u=a.x,this.face===Xi.TOP)x=Qt-l,u>=xi&&u<=Qt+xi?(P.value=bi.AREA_0,p=u-Qt):u>Qt+xi||u<=-(Qt+xi)?(P.value=bi.AREA_1,p=u>0?u-Lr:u+Lr):u>-(Qt+xi)&&u<=-xi?(P.value=bi.AREA_2,p=u+Qt):(P.value=bi.AREA_3,p=u);else if(this.face===Xi.BOTTOM)x=Qt+l,u>=xi&&u<=Qt+xi?(P.value=bi.AREA_0,p=-u+Qt):u<xi&&u>=-xi?(P.value=bi.AREA_1,p=-u):u<-xi&&u>=-(Qt+xi)?(P.value=bi.AREA_2,p=-u-Qt):(P.value=bi.AREA_3,p=u>0?-u+Lr:-u-Lr);else{var A,L,z,D,B,$,et;this.face===Xi.RIGHT?u=jl(u,+Qt):this.face===Xi.BACK?u=jl(u,3.14159265359):this.face===Xi.LEFT&&(u=jl(u,-Qt)),D=Math.sin(l),B=Math.cos(l),$=Math.sin(u),et=Math.cos(u),A=B*et,L=B*$,z=D,this.face===Xi.FRONT?(x=Math.acos(A),p=md(x,z,L,P)):this.face===Xi.RIGHT?(x=Math.acos(L),p=md(x,z,-A,P)):this.face===Xi.BACK?(x=Math.acos(-A),p=md(x,z,-L,P)):this.face===Xi.LEFT?(x=Math.acos(-L),p=md(x,z,A,P)):(x=p=0,P.value=bi.AREA_0)}return o=Math.atan(12/Lr*(p+Math.acos(Math.sin(p)*Math.cos(xi))-Qt)),m=Math.sqrt((1-Math.cos(x))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(p))))),P.value===bi.AREA_1?o+=Qt:P.value===bi.AREA_2?o+=Lr:P.value===bi.AREA_3&&(o+=1.5*Lr),i.x=m*Math.cos(o),i.y=m*Math.sin(o),i.x=i.x*this.a+this.x0,i.y=i.y*this.a+this.y0,a.x=i.x,a.y=i.y,a}function AI(a){var i={lam:0,phi:0},l,u,p,x,m,o,P,A,L,z={value:0};if(a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,u=Math.atan(Math.sqrt(a.x*a.x+a.y*a.y)),l=Math.atan2(a.y,a.x),a.x>=0&&a.x>=Math.abs(a.y)?z.value=bi.AREA_0:a.y>=0&&a.y>=Math.abs(a.x)?(z.value=bi.AREA_1,l-=Qt):a.x<0&&-a.x>=Math.abs(a.y)?(z.value=bi.AREA_2,l=l<0?l+Lr:l-Lr):(z.value=bi.AREA_3,l+=Qt),L=Lr/12*Math.tan(l),m=Math.sin(L)/(Math.cos(L)-1/Math.sqrt(2)),o=Math.atan(m),p=Math.cos(l),x=Math.tan(u),P=1-p*p*x*x*(1-Math.cos(Math.atan(1/Math.cos(o)))),P<-1?P=-1:P>1&&(P=1),this.face===Xi.TOP)A=Math.acos(P),i.phi=Qt-A,z.value===bi.AREA_0?i.lam=o+Qt:z.value===bi.AREA_1?i.lam=o<0?o+Lr:o-Lr:z.value===bi.AREA_2?i.lam=o-Qt:i.lam=o;else if(this.face===Xi.BOTTOM)A=Math.acos(P),i.phi=A-Qt,z.value===bi.AREA_0?i.lam=-o+Qt:z.value===bi.AREA_1?i.lam=-o:z.value===bi.AREA_2?i.lam=-o-Qt:i.lam=o<0?-o-Lr:-o+Lr;else{var D,B,$;D=P,L=D*D,L>=1?$=0:$=Math.sqrt(1-L)*Math.sin(o),L+=$*$,L>=1?B=0:B=Math.sqrt(1-L),z.value===bi.AREA_1?(L=B,B=-$,$=L):z.value===bi.AREA_2?(B=-B,$=-$):z.value===bi.AREA_3&&(L=B,B=$,$=-L),this.face===Xi.RIGHT?(L=D,D=-B,B=L):this.face===Xi.BACK?(D=-D,B=-B):this.face===Xi.LEFT&&(L=D,D=B,B=-L),i.phi=Math.acos(-$)-Qt,i.lam=Math.atan2(B,D),this.face===Xi.RIGHT?i.lam=jl(i.lam,-Qt):this.face===Xi.BACK?i.lam=jl(i.lam,-3.14159265359):this.face===Xi.LEFT&&(i.lam=jl(i.lam,+Qt))}if(this.es!==0){var et,it,ft;et=i.phi<0?1:0,it=Math.tan(i.phi),ft=this.b/Math.sqrt(it*it+this.one_minus_f_squared),i.phi=Math.atan(Math.sqrt(this.a*this.a-ft*ft)/(this.one_minus_f*ft)),et&&(i.phi=-i.phi)}return i.lam+=this.long0,a.x=i.lam,a.y=i.phi,a}function md(a,i,l,u){var p;return a<le?(u.value=bi.AREA_0,p=0):(p=Math.atan2(i,l),Math.abs(p)<=xi?u.value=bi.AREA_0:p>xi&&p<=Qt+xi?(u.value=bi.AREA_1,p-=Qt):p>Qt+xi||p<=-(Qt+xi)?(u.value=bi.AREA_2,p=p>=0?p-Lr:p+Lr):(u.value=bi.AREA_3,p+=Qt)),p}function jl(a,i){var l=a+i;return l<-3.14159265359?l+=Ac:l>3.14159265359&&(l-=Ac),l}var RI=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const DI={init:II,forward:CI,inverse:AI,names:RI};var im=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],mc=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],v1=.8487,x1=1.3523,b1=gn/5,zI=1/b1,Ll=18,Bd=function(a,i){return a[0]+i*(a[1]+i*(a[2]+i*a[3]))},kI=function(a,i){return a[1]+i*(2*a[2]+i*3*a[3])};function LI(a,i,l,u){for(var p=i;u;--u){var x=a(p);if(p-=x,Math.abs(x)<l)break}return p}function OI(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function FI(a){var i=fe(a.x-this.long0),l=Math.abs(a.y),u=Math.floor(l*b1);u<0?u=0:u>=Ll&&(u=Ll-1),l=gn*(l-zI*u);var p={x:Bd(im[u],l)*i,y:Bd(mc[u],l)};return a.y<0&&(p.y=-p.y),p.x=p.x*this.a*v1+this.x0,p.y=p.y*this.a*x1+this.y0,p}function BI(a){var i={x:(a.x-this.x0)/(this.a*v1),y:Math.abs(a.y-this.y0)/(this.a*x1)};if(i.y>=1)i.x/=im[Ll][0],i.y=a.y<0?-Qt:Qt;else{var l=Math.floor(i.y*Ll);for(l<0?l=0:l>=Ll&&(l=Ll-1);;)if(mc[l][0]>i.y)--l;else if(mc[l+1][0]<=i.y)++l;else break;var u=mc[l],p=5*(i.y-u[0])/(mc[l+1][0]-u[0]);p=LI(function(x){return(Bd(u,x)-i.y)/kI(u,x)},p,le,100),i.x/=Bd(im[l],p),i.y=(5*l+p)*Ai,a.y<0&&(i.y=-i.y)}return i.x=fe(i.x+this.long0),i}var NI=["Robinson","robin"];const GI={init:OI,forward:FI,inverse:BI,names:NI};function jI(){this.name="geocent"}function UI(a){var i=l1(a,this.es,this.a);return i}function VI(a){var i=h1(a,this.es,this.a,this.b);return i}var $I=["Geocentric","geocentric","geocent","Geocent"];const qI={init:jI,forward:UI,inverse:VI,names:$I};var $r={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},uc={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function ZI(){if(Object.keys(uc).forEach((function(l){if(typeof this[l]>"u")this[l]=uc[l].def;else{if(uc[l].num&&isNaN(this[l]))throw new Error("Invalid parameter value, must be numeric "+l+" = "+this[l]);uc[l].num&&(this[l]=parseFloat(this[l]))}uc[l].degrees&&(this[l]=this[l]*Ai)}).bind(this)),Math.abs(Math.abs(this.lat0)-Qt)<le?this.mode=this.lat0<0?$r.S_POLE:$r.N_POLE:Math.abs(this.lat0)<le?this.mode=$r.EQUIT:(this.mode=$r.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var a=this.tilt,i=this.azi;this.cg=Math.cos(i),this.sg=Math.sin(i),this.cw=Math.cos(a),this.sw=Math.sin(a)}function WI(a){a.x-=this.long0;var i=Math.sin(a.y),l=Math.cos(a.y),u=Math.cos(a.x),p,x;switch(this.mode){case $r.OBLIQ:x=this.sinph0*i+this.cosph0*l*u;break;case $r.EQUIT:x=l*u;break;case $r.S_POLE:x=-i;break;case $r.N_POLE:x=i;break}switch(x=this.pn1/(this.p-x),p=x*l*Math.sin(a.x),this.mode){case $r.OBLIQ:x*=this.cosph0*i-this.sinph0*l*u;break;case $r.EQUIT:x*=i;break;case $r.N_POLE:x*=-(l*u);break;case $r.S_POLE:x*=l*u;break}var m,o;return m=x*this.cg+p*this.sg,o=1/(m*this.sw*this.h1+this.cw),p=(p*this.cg-x*this.sg)*this.cw*o,x=m*o,a.x=p*this.a,a.y=x*this.a,a}function XI(a){a.x/=this.a,a.y/=this.a;var i={x:a.x,y:a.y},l,u,p;p=1/(this.pn1-a.y*this.sw),l=this.pn1*a.x*p,u=this.pn1*a.y*this.cw*p,a.x=l*this.cg+u*this.sg,a.y=u*this.cg-l*this.sg;var x=os(a.x,a.y);if(Math.abs(x)<le)i.x=0,i.y=a.y;else{var m,o;switch(o=1-x*x*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/x+x/this.pn1),m=Math.sqrt(1-o*o),this.mode){case $r.OBLIQ:i.y=Math.asin(m*this.sinph0+a.y*o*this.cosph0/x),a.y=(m-this.sinph0*Math.sin(i.y))*x,a.x*=o*this.cosph0;break;case $r.EQUIT:i.y=Math.asin(a.y*o/x),a.y=m*x,a.x*=o;break;case $r.N_POLE:i.y=Math.asin(m),a.y=-a.y;break;case $r.S_POLE:i.y=-Math.asin(m);break}i.x=Math.atan2(a.x,a.y)}return a.x=i.x+this.long0,a.y=i.y,a}var HI=["Tilted_Perspective","tpers"];const KI={init:ZI,forward:WI,inverse:XI,names:HI};function YI(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var a=1-this.es,i=1/a;this.radius_p=Math.sqrt(a),this.radius_p2=a,this.radius_p_inv2=i,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function JI(a){var i=a.x,l=a.y,u,p,x,m;if(i=i-this.long0,this.shape==="ellipse"){l=Math.atan(this.radius_p2*Math.tan(l));var o=this.radius_p/os(this.radius_p*Math.cos(l),Math.sin(l));if(p=o*Math.cos(i)*Math.cos(l),x=o*Math.sin(i)*Math.cos(l),m=o*Math.sin(l),(this.radius_g-p)*p-x*x-m*m*this.radius_p_inv2<0)return a.x=Number.NaN,a.y=Number.NaN,a;u=this.radius_g-p,this.flip_axis?(a.x=this.radius_g_1*Math.atan(x/os(m,u)),a.y=this.radius_g_1*Math.atan(m/u)):(a.x=this.radius_g_1*Math.atan(x/u),a.y=this.radius_g_1*Math.atan(m/os(x,u)))}else this.shape==="sphere"&&(u=Math.cos(l),p=Math.cos(i)*u,x=Math.sin(i)*u,m=Math.sin(l),u=this.radius_g-p,this.flip_axis?(a.x=this.radius_g_1*Math.atan(x/os(m,u)),a.y=this.radius_g_1*Math.atan(m/u)):(a.x=this.radius_g_1*Math.atan(x/u),a.y=this.radius_g_1*Math.atan(m/os(x,u))));return a.x=a.x*this.a,a.y=a.y*this.a,a}function QI(a){var i=-1,l=0,u=0,p,x,m,o;if(a.x=a.x/this.a,a.y=a.y/this.a,this.shape==="ellipse"){this.flip_axis?(u=Math.tan(a.y/this.radius_g_1),l=Math.tan(a.x/this.radius_g_1)*os(1,u)):(l=Math.tan(a.x/this.radius_g_1),u=Math.tan(a.y/this.radius_g_1)*os(1,l));var P=u/this.radius_p;if(p=l*l+P*P+i*i,x=2*this.radius_g*i,m=x*x-4*p*this.C,m<0)return a.x=Number.NaN,a.y=Number.NaN,a;o=(-x-Math.sqrt(m))/(2*p),i=this.radius_g+o*i,l*=o,u*=o,a.x=Math.atan2(l,i),a.y=Math.atan(u*Math.cos(a.x)/i),a.y=Math.atan(this.radius_p_inv2*Math.tan(a.y))}else if(this.shape==="sphere"){if(this.flip_axis?(u=Math.tan(a.y/this.radius_g_1),l=Math.tan(a.x/this.radius_g_1)*Math.sqrt(1+u*u)):(l=Math.tan(a.x/this.radius_g_1),u=Math.tan(a.y/this.radius_g_1)*Math.sqrt(1+l*l)),p=l*l+u*u+i*i,x=2*this.radius_g*i,m=x*x-4*p*this.C,m<0)return a.x=Number.NaN,a.y=Number.NaN,a;o=(-x-Math.sqrt(m))/(2*p),i=this.radius_g+o*i,l*=o,u*=o,a.x=Math.atan2(l,i),a.y=Math.atan(u*Math.cos(a.x)/i)}return a.x=a.x+this.long0,a}var tC=["Geostationary Satellite View","Geostationary_Satellite","geos"];const eC={init:YI,forward:JI,inverse:QI,names:tC};var Mc=1.340264,Sc=-.081106,Tc=893e-6,Pc=.003796,Nd=Math.sqrt(3)/2;function iC(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function rC(a){var i=fe(a.x-this.long0),l=a.y,u=Math.asin(Nd*Math.sin(l)),p=u*u,x=p*p*p;return a.x=i*Math.cos(u)/(Nd*(Mc+3*Sc*p+x*(7*Tc+9*Pc*p))),a.y=u*(Mc+Sc*p+x*(Tc+Pc*p)),a.x=this.a*a.x+this.x0,a.y=this.a*a.y+this.y0,a}function sC(a){a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a;var i=1e-9,l=12,u=a.y,p,x,m,o,P,A;for(A=0;A<l&&(p=u*u,x=p*p*p,m=u*(Mc+Sc*p+x*(Tc+Pc*p))-a.y,o=Mc+3*Sc*p+x*(7*Tc+9*Pc*p),u-=P=m/o,!(Math.abs(P)<i));++A);return p=u*u,x=p*p*p,a.x=Nd*a.x*(Mc+3*Sc*p+x*(7*Tc+9*Pc*p))/Math.cos(u),a.y=Math.asin(Math.sin(u)/Nd),a.x=fe(a.x+this.long0),a}var nC=["eqearth","Equal Earth","Equal_Earth"];const aC={init:iC,forward:rC,inverse:sC,names:nC};var zc=1e-10;function oC(){var a;if(this.phi1=this.lat1,Math.abs(this.phi1)<zc)throw new Error;this.es?(this.en=zm(this.es),this.m1=Kl(this.phi1,this.am1=Math.sin(this.phi1),a=Math.cos(this.phi1),this.en),this.am1=a/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=hC,this.forward=lC):(Math.abs(this.phi1)+zc>=Qt?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=uC,this.forward=cC)}function lC(a){var i=fe(a.x-(this.long0||0)),l=a.y,u,p,x;return u=this.am1+this.m1-Kl(l,p=Math.sin(l),x=Math.cos(l),this.en),p=x*i/(u*Math.sqrt(1-this.es*p*p)),a.x=u*Math.sin(p),a.y=this.am1-u*Math.cos(p),a.x=this.a*a.x+(this.x0||0),a.y=this.a*a.y+(this.y0||0),a}function hC(a){a.x=(a.x-(this.x0||0))/this.a,a.y=(a.y-(this.y0||0))/this.a;var i,l,u,p;if(l=os(a.x,a.y=this.am1-a.y),p=km(this.am1+this.m1-l,this.es,this.en),(i=Math.abs(p))<Qt)i=Math.sin(p),u=l*Math.atan2(a.x,a.y)*Math.sqrt(1-this.es*i*i)/Math.cos(p);else if(Math.abs(i-Qt)<=zc)u=0;else throw new Error;return a.x=fe(u+(this.long0||0)),a.y=Ta(p),a}function cC(a){var i=fe(a.x-(this.long0||0)),l=a.y,u,p;return p=this.cphi1+this.phi1-l,Math.abs(p)>zc?(a.x=p*Math.sin(u=i*Math.cos(l)/p),a.y=this.cphi1-p*Math.cos(u)):a.x=a.y=0,a.x=this.a*a.x+(this.x0||0),a.y=this.a*a.y+(this.y0||0),a}function uC(a){a.x=(a.x-(this.x0||0))/this.a,a.y=(a.y-(this.y0||0))/this.a;var i,l,u=os(a.x,a.y=this.cphi1-a.y);if(l=this.cphi1+this.phi1-u,Math.abs(l)>Qt)throw new Error;return Math.abs(Math.abs(l)-Qt)<=zc?i=0:i=u*Math.atan2(a.x,a.y)/Math.cos(l),a.x=fe(i+(this.long0||0)),a.y=Ta(l),a}var dC=["bonne","Bonne (Werner lat_1=90)"];const fC={init:oC,names:dC};function pC(a){a.Proj.projections.add(wd),a.Proj.projections.add(Md),a.Proj.projections.add(oP),a.Proj.projections.add(gP),a.Proj.projections.add(wP),a.Proj.projections.add(EP),a.Proj.projections.add(zP),a.Proj.projections.add(BP),a.Proj.projections.add(VP),a.Proj.projections.add(XP),a.Proj.projections.add(uE),a.Proj.projections.add(_E),a.Proj.projections.add(wE),a.Proj.projections.add(IE),a.Proj.projections.add(zE),a.Proj.projections.add(BE),a.Proj.projections.add(VE),a.Proj.projections.add(XE),a.Proj.projections.add(tI),a.Proj.projections.add(nI),a.Proj.projections.add(cI),a.Proj.projections.add(mI),a.Proj.projections.add(wI),a.Proj.projections.add(EI),a.Proj.projections.add(DI),a.Proj.projections.add(GI),a.Proj.projections.add(qI),a.Proj.projections.add(KI),a.Proj.projections.add(eC),a.Proj.projections.add(aC),a.Proj.projections.add(fC)}Rs.defaultDatum="WGS84";Rs.Proj=_n;Rs.WGS84=new Rs.Proj("WGS84");Rs.Point=ql;Rs.toPoint=c1;Rs.defs=Kr;Rs.nadgrid=oT;Rs.transform=Od;Rs.mgrs=TT;Rs.version="__VERSION__";pC(Rs);var mC=hx(On('<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@10.5.0/ol.css"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/OrdnanceSurvey/os-api-branding@0.3.1/os-api-branding.css"/> <script src="https://cdn.jsdelivr.net/npm/proj4@2.15.0/dist/proj4.js"><\/script> <script src="https://cdn.jsdelivr.net/npm/ol/dist/ol.js"><\/script> <script src="https://unpkg.com/ol-mapbox-style@12.3.5/dist/olms.js"><\/script> <script src="https://cdn.jsdelivr.net/gh/OrdnanceSurvey/os-api-branding@0.3.1/os-api-branding.js"><\/script>',1)),gC=On(' <div class="os-map-container svelte-1kdui3s"><!></div>',1),_C=On(" <p>Generating the map...</p>",1),yC=(a,i,l)=>(Me(i).length=0,l(),zr(i,Me(i),!0)),vC=(a,i)=>i(),xC=On('<div><input name="checkbox" type="checkbox"/> <label for="checkbox"> </label></div>'),bC=On('<p> </p> <progress max="100"></progress>',1),wC=On("<p><b> </b></p>"),MC=On("<p> </p> <fieldset><legend>Layers to turn on/off:</legend> <button>all off</button> <button>all on</button> <!></fieldset> <!>",1),SC=On('<h2> </h2> <div class="container svelte-1kdui3s"><div><!></div> <div class="output svelte-1kdui3s"><!></div></div>',1);function BC(a,i){K0(i,!0);const[l,u]=Ox(),p=()=>Fx(re,"$blendingProgress",l),x=[];let m=ys(void 0),o=ys(void 0),P=ys(0),A=ys(0),L=ys(td([])),z=ys(void 0),D=ys(void 0),B=ys(void 0),$=ys(td([])),et=[],it,ft=ys(td([])),dt=ys(td([])),Ot=ys(0),jt,Gt=ys(void 0);const re=ux(0);let Ie,_e;Ie=new Worker(new URL(""+new URL("../workers/bitUnpackerWorker-kcsjxPM1.js",import.meta.url).href,import.meta.url),{type:"module"}),_e=new Worker(new URL(""+new URL("../workers/blendworker-BdRNaeG3.js",import.meta.url).href,import.meta.url),{type:"module"}),Ie.onmessage=Dt=>{var ee;const{bitLayers:Mt,rasterLayers:Lt}=Dt.data;if(!Array.isArray(Mt)||!Array.isArray(Lt)){console.error("Worker returned unexpected data:",Dt.data);return}et=Mt,zr($,Lt,!0),Me($).forEach((de,Ee)=>{de.data=et[Ee]}),it=(ee=Me($).find(de=>de.filename==="ENGLAND_100M.tif"))==null?void 0:ee.data,zr(ft,Me($).map(de=>de.filename).filter(de=>de!="ENGLAND_100M.tif"),!0),jt=Me($).map(de=>de.filename).filter(de=>de!="ENGLAND_100M.tif"),Re()},Ie.onerror=Dt=>{console.log("ERROR",Dt)},_e.onmessage=Dt=>{Dt.data.progress!==void 0?re.set(Dt.data.progress):Dt.data.type==="done"&&(zr(Ot,Dt.data.activeCount,!0),zr(dt,Dt.data.result,!0),re.set(100))};function Re(){if(!it)return;const Mt=Me($).filter(Lt=>Me(ft).includes(Lt.filename)).map(Lt=>Lt.data);re.set(0),_e.postMessage({bitArrays:Mt,englandMask:it})}q0(async()=>{const Dt=await ww(`${jp}/data/output.tif`);zr(m,await Dt.getImage(),!0),zr(P,Me(m).getWidth(),!0),zr(A,Me(m).getHeight(),!0),zr(L,Me(m).getBoundingBox(),!0);const Lt=await(await fetch("./bitpacking_metadata.csv")).text();Ie.postMessage({url:`${jp}/data/output.tif`,metadataCsv:Lt}),zr(z,document.createElement("canvas"),!0),Me(z).width=Me(P),Me(z).height=Me(A),zr(D,Me(z).getContext("2d"),!0),zr(B,Me(D).createImageData(Me(P),Me(A)),!0)}),Gp(()=>{for(let Dt=0;Dt<Me(dt).length;Dt++){const Mt=Me(dt)[Dt];Me(B).data[Dt*4+0]=0,Me(B).data[Dt*4+1]=0,Me(B).data[Dt*4+2]=0,Me(B).data[Dt*4+3]=Mt!==0?255:0}Me(z)&&(Me(D).putImageData(Me(B),0,0),zr(o,Me(z).toDataURL(),!0)),Me($).length&&zr(Gt,Me($).filter(Dt=>Dt.filename!=="ENGLAND_100M.tif").map(Dt=>{var Mt;return{label:`${Dt.filename.replace(".tif","").replaceAll("_"," ")}: ${((Mt=Dt.area)==null?void 0:Mt.toLocaleString())??0} ha`,value:Dt.filename}}),!0)});let ri=C_(()=>Me(ft).length);Gp(()=>{zr(ri,Me(ft).length,!0),Re()});let $e=C_(()=>{var Dt;return(Dt=Me($).find(Mt=>Mt.filename==="ENGLAND_100M.tif"))==null?void 0:Dt.area});var oi=SC();kx(Dt=>{var Mt=mC();A_(10),dn(Dt,Mt)});var Qe=Ml(oi),wi=Es(Qe);Is(Qe);var li=hn(Qe,2),Ii=Es(li),Ri=Es(Ii);Gx(Ri,()=>Me(m),Dt=>{var Mt=_C(),Lt=Ml(Mt);Lt.nodeValue=`${console.log("waiting")??""} `,A_(),dn(Dt,Mt)},(Dt,Mt)=>{var Lt=gC(),ee=Ml(Lt);ee.nodeValue=`${console.log("done waiting")??""}  `;var de=hn(ee),Ee=Es(de);mS(Ee,{get dataURL(){return Me(o)},get bbox(){return Me(L)}}),Is(de),dn(Dt,Lt)}),Is(Ii);var Nt=hn(Ii,2),qt=Es(Nt);{var Xt=Dt=>{var Mt=MC(),Lt=Ml(Mt),ee=Es(Lt);Is(Lt);var de=hn(Lt,2),Ee=hn(Es(de),2);Ee.__click=[yC,ft,Re];var me=hn(Ee,2);me.__click=()=>(Me(ft).length=0,jt.forEach(Wt=>Me(ft).push(Wt)),Re(),zr(ft,Me(ft),!0));var Ge=hn(me,2);Ux(Ge,17,()=>Me($),Wt=>Wt.filename,(Wt,oe)=>{var Ce=cx(),je=Ml(Ce);{var Xe=De=>{var We=xC(),Ze=Es(We);Wx(Ze);var pi;Ze.__change=[vC,Re];var Be=hn(Ze,2),Ne=Es(Be);Is(Be),Is(We),lc((Ae,ci)=>{pi!==(pi=Me(oe).filename)&&(Ze.value=(Ze.__value=Me(oe).filename)??""),hc(Ne,`${Ae??""}: ${ci??""} ha`)},[()=>Me(oe).filename.replace(".tif","").replaceAll("_"," "),()=>{var Ae;return((Ae=Me(oe).area)==null?void 0:Ae.toLocaleString())??0}]),Hx(x,[],Ze,()=>(Me(oe).filename,Me(ft)),Ae=>zr(ft,Ae)),dn(De,We)};fp(je,De=>{Me(oe).filename!=="ENGLAND_100M.tif"&&De(Xe)})}dn(Wt,Ce)}),Is(de);var ae=hn(de,2);{var Se=Wt=>{var oe=bC(),Ce=Ml(oe),je=Es(Ce);Is(Ce);var Xe=hn(Ce,2);lc(De=>{hc(je,`Blending... ${De??""}%`),Xx(Xe,p())},[()=>p().toFixed(1)]),dn(Wt,oe)},ze=Wt=>{var oe=wC(),Ce=Es(oe),je=Es(Ce);Is(Ce),Is(oe),lc(Xe=>hc(je,`English land outside selected categories:
            ${Xe??""} ha`),[()=>{var Xe;return(((Xe=Me($).find(De=>De.filename==="ENGLAND_100M.tif"))==null?void 0:Xe.area)-Me(Ot)).toLocaleString()}]),dn(Wt,oe)};fp(ae,Wt=>{p()<100?Wt(Se):Wt(ze,!1)})}lc(Wt=>hc(ee,`England total: ${Wt??""} ha`),[()=>{var Wt;return(Wt=Me($).find(oe=>oe.filename==="ENGLAND_100M.tif"))==null?void 0:Wt.area.toLocaleString()}]),dn(Dt,Mt)};fp(qt,Dt=>{Me($).length&&Dt(Xt)})}Is(Nt),Is(li),lc((Dt,Mt)=>hc(wi,`The total area of land in England is ${Dt??""} ha, removing undevelopable land there is ${Mt??""} ha`),[()=>Me($e)?Me($e).toLocaleString():"...",()=>Me($e)?(Me($e)-Me(Ot)).toLocaleString():"..."]),dn(a,oi),Y0(),u()}Gd(["click","change"]);export{zC as L,BC as _,kC as a,lm as g};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BfN7rNmm.js","./B2c5_Eok.js","./dv0JZMFe.js","./BLbg0tTC.js","./0QI0w0yl.js","./Cram60i4.js","./AId8NOvR.js","./Bbdp0RS6.js","./ByRDRQcx.js"])))=>i.map(i=>d[i]);
var xx=Object.defineProperty;var bx=(a,i,l)=>i in a?xx(a,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[i]=l;var N_=(a,i,l)=>bx(a,typeof i!="symbol"?i+"":i,l);import{f as ar,a as $i,c as kd,w as wx}from"./U45kXhoe.js";import{y as Dd,z as zd,B as Mx,C as $p,aq as sy,b as um,h as cr,N as dm,ar as G_,_ as ny,$ as Zp,J as Sd,I as wc,a2 as Wp,as as Mc,at as Ld,a8 as Hp,a as jl,a5 as Od,c as To,au as j_,e as Sx,a0 as Fd,a1 as Sc,am as Tx,av as Px,U as Ex,K as Ix,D as Cx,j as Zt,ad as Ax,Z as Rx,O as kx,aw as ay,S as oy,A as Dx,ax as Mp,ay as fm,az as zx,aA as pm,aB as Lx,R as Ox,aC as Fx,d as Bx,aD as Nx,G as Gx,aE as jx,aF as Ux,aG as Vx,aH as qx,aI as $x,a4 as ly,aJ as Zx,a7 as Wx,p as mm,g as Td,q as gm,s as Mi,v as bi,aK as Bd,t as ss,ap as gc,ag as ba,an as xr,a9 as Yi,w as Gr,f as Nn}from"./DVrfHW4_.js";import{d as jc,s as ms,a as Hx}from"./BIe-nRHw.js";import{_ as Do,b as Xx,p as Ma,i as vn,s as Kx,a as Yx}from"./Dc_y8KWg.js";import{o as Jx,w as Qx}from"./BfGr4jJz.js";import{b as tb}from"./Dha16Wb8.js";import"./mWQZCIz3.js";let U_=!1;function hy(){U_||(U_=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var i;if(!a.defaultPrevented)for(const l of a.target.elements)(i=l.__on_r)==null||i.call(l)})},{capture:!0}))}function eb(a){var i=Mx,l=$p;Dd(null),zd(null);try{return a()}finally{Dd(i),zd(l)}}function cy(a,i,l,u=l){a.addEventListener(i,()=>eb(l));const p=a.__on_r;p?a.__on_r=()=>{p(),u(!0)}:a.__on_r=()=>u(!0),hy()}const Sp=0,ld=1,Tp=2;function ib(a,i,l,u,p){cr&&dm();var x=a,m=sy(),o=Sx,P=Wp,A,O,D,k=(m?Ld:Hp)(void 0),B=(m?Ld:Hp)(void 0),V=!1;function K(gt,ct){V=!0,ct&&(zd(it),Dd(it),j_(o));try{gt===Sp&&l&&(A?Fd(A):A=jl(()=>l(x))),gt===ld&&u&&(O?Fd(O):O=jl(()=>u(x,k))),gt!==Sp&&A&&Sc(A,()=>A=null),gt!==ld&&O&&Sc(O,()=>O=null),gt!==Tp&&D&&Sc(D,()=>D=null)}finally{ct&&(j_(null),Dd(null),zd(null),Tx())}}var it=um(()=>{if(P===(P=i()))return;let gt=cr&&G_(P)===(x.data===ny);if(gt&&(x=Zp(),Sd(x),wc(!1),gt=!0),G_(P)){var ct=P;V=!1,ct.then(Dt=>{ct===P&&(Mc(k,Dt),K(ld,!0))},Dt=>{if(ct===P)throw Mc(B,Dt),K(Tp,!0),B.v}),cr?l&&(A=jl(()=>l(x))):Od(()=>{V||K(Sp,!0)})}else Mc(k,P),K(ld,!1);return gt&&wc(!0),()=>P=Wp});cr&&(x=To)}function V_(a,i,l){cr&&dm();var u=a,p=Wp,x,m=sy()?Px:Ex;um(()=>{m(p,p=i())&&(x&&Sc(x),x=jl(()=>l(u)))}),cr&&(u=To)}function hd(a,i){return i}function rb(a,i,l,u){for(var p=[],x=i.length,m=0;m<x;m++)Lx(i[m].e,p,!0);var o=x>0&&p.length===0&&l!==null;if(o){var P=l.parentNode;Ox(P),P.append(l),u.clear(),wa(a,i[0].prev,i[x-1].next)}Fx(p,()=>{for(var A=0;A<x;A++){var O=i[A];o||(u.delete(O.k),wa(a,O.prev,O.next)),Bx(O.e,!o)}})}function _c(a,i,l,u,p,x=null){var m=a,o={flags:i,items:new Map,first:null},P=(i&ay)!==0;if(P){var A=a;m=cr?Sd(Ix(A)):A.appendChild(Cx())}cr&&dm();var O=null,D=!1,k=Ax(()=>{var B=l();return Dx(B)?B:B==null?[]:oy(B)});um(()=>{var B=Zt(k),V=B.length;if(D&&V===0)return;D=V===0;let K=!1;if(cr){var it=Rx(m)===ny;it!==(V===0)&&(m=Zp(),Sd(m),wc(!1),K=!0)}if(cr){for(var gt=null,ct,Dt=0;Dt<V;Dt++){if(To.nodeType===8&&To.data===kx){m=To,K=!0,wc(!1);break}var Ct=B[Dt],zt=u(Ct,Dt);ct=uy(To,o,gt,null,Ct,zt,Dt,p,i,l),o.items.set(zt,ct),gt=ct}V>0&&Sd(Zp())}cr||sb(B,o,m,p,i,u,l),x!==null&&(V===0?O?Fd(O):O=jl(()=>x(m)):O!==null&&Sc(O,()=>{O=null})),K&&wc(!0),Zt(k)}),cr&&(m=To)}function sb(a,i,l,u,p,x,m){var qe,Ce,ui,yi;var o=(p&zx)!==0,P=(p&(pm|fm))!==0,A=a.length,O=i.items,D=i.first,k=D,B,V=null,K,it=[],gt=[],ct,Dt,Ct,zt;if(o)for(zt=0;zt<A;zt+=1)ct=a[zt],Dt=x(ct,zt),Ct=O.get(Dt),Ct!==void 0&&((qe=Ct.a)==null||qe.measure(),(K??(K=new Set)).add(Ct));for(zt=0;zt<A;zt+=1){if(ct=a[zt],Dt=x(ct,zt),Ct=O.get(Dt),Ct===void 0){var ae=k?k.e.nodes_start:l;V=uy(ae,i,V,V===null?i.first:V.next,ct,Dt,zt,u,p,m),O.set(Dt,V),it=[],gt=[],k=V.next;continue}if(P&&nb(Ct,ct,zt,p),(Ct.e.f&Mp)!==0&&(Fd(Ct.e),o&&((Ce=Ct.a)==null||Ce.unfix(),(K??(K=new Set)).delete(Ct))),Ct!==k){if(B!==void 0&&B.has(Ct)){if(it.length<gt.length){var ke=gt[0],de;V=ke.prev;var Le=it[0],Xe=it[it.length-1];for(de=0;de<it.length;de+=1)q_(it[de],ke,l);for(de=0;de<gt.length;de+=1)B.delete(gt[de]);wa(i,Le.prev,Xe.next),wa(i,V,Le),wa(i,Xe,ke),k=ke,V=Xe,zt-=1,it=[],gt=[]}else B.delete(Ct),q_(Ct,k,l),wa(i,Ct.prev,Ct.next),wa(i,Ct,V===null?i.first:V.next),wa(i,V,Ct),V=Ct;continue}for(it=[],gt=[];k!==null&&k.k!==Dt;)(k.e.f&Mp)===0&&(B??(B=new Set)).add(k),gt.push(k),k=k.next;if(k===null)continue;Ct=k}it.push(Ct),V=Ct,k=Ct.next}if(k!==null||B!==void 0){for(var ne=B===void 0?[]:oy(B);k!==null;)(k.e.f&Mp)===0&&ne.push(k),k=k.next;var le=ne.length;if(le>0){var be=(p&ay)!==0&&A===0?l:null;if(o){for(zt=0;zt<le;zt+=1)(ui=ne[zt].a)==null||ui.measure();for(zt=0;zt<le;zt+=1)(yi=ne[zt].a)==null||yi.fix()}rb(i,ne,be,O)}}o&&Od(()=>{var Ft;if(K!==void 0)for(Ct of K)(Ft=Ct.a)==null||Ft.apply()}),$p.first=i.first&&i.first.e,$p.last=V&&V.e}function nb(a,i,l,u){(u&pm)!==0&&Mc(a.v,i),(u&fm)!==0?Mc(a.i,l):a.i=l}function uy(a,i,l,u,p,x,m,o,P,A){var O=(P&pm)!==0,D=(P&Nx)===0,k=O?D?Hp(p):Ld(p):p,B=(P&fm)===0?m:Ld(m),V={i:B,v:k,k:x,a:null,e:null,prev:l,next:u};try{return V.e=jl(()=>o(a,k,B,A),cr),V.e.prev=l&&l.e,V.e.next=u&&u.e,l===null?i.first=V:(l.next=V,l.e.next=V.e),u!==null&&(u.prev=V,u.e.prev=V.e),V}finally{}}function q_(a,i,l){for(var u=a.next?a.next.e.nodes_start:l,p=i?i.e.nodes_start:l,x=a.e.nodes_start;x!==u;){var m=Gx(x);p.before(x),x=m}}function wa(a,i,l){i===null?a.first=l:(i.next=l,i.e.next=l&&l.e),l!==null&&(l.prev=i,l.e.prev=i&&i.e)}function dy(a){var i,l,u="";if(typeof a=="string"||typeof a=="number")u+=a;else if(typeof a=="object")if(Array.isArray(a)){var p=a.length;for(i=0;i<p;i++)a[i]&&(l=dy(a[i]))&&(u&&(u+=" "),u+=l)}else for(l in a)a[l]&&(u&&(u+=" "),u+=l);return u}function ab(){for(var a,i,l=0,u="",p=arguments.length;l<p;l++)(a=arguments[l])&&(i=dy(a))&&(u&&(u+=" "),u+=i);return u}function ob(a){return typeof a=="object"?ab(a):a??""}function lb(a,i,l){var u=a==null?"":""+a;return i&&(u=u?u+" "+i:i),u===""?null:u}function hb(a,i){return a==null?null:String(a)}function fy(a,i,l,u,p,x){var m=a.__className;if(cr||m!==l||m===void 0){var o=lb(l,u);(!cr||o!==a.getAttribute("class"))&&(o==null?a.removeAttribute("class"):a.className=o),a.__className=l}return x}function $_(a,i,l,u){var p=a.__style;if(cr||p!==i){var x=hb(i);(!cr||x!==a.getAttribute("style"))&&(x==null?a.removeAttribute("style"):a.style.cssText=x),a.__style=i}return u}const cb=Symbol("is custom element"),ub=Symbol("is html");function db(a){if(cr){var i=!1,l=()=>{if(!i){if(i=!0,a.hasAttribute("value")){var u=a.value;Xp(a,"value",null),a.value=u}if(a.hasAttribute("checked")){var p=a.checked;Xp(a,"checked",null),a.checked=p}}};a.__on_r=l,Vx(l),hy()}}function fb(a,i){var l=py(a);l.value===(l.value=i??void 0)||a.value===i&&(i!==0||a.nodeName!=="PROGRESS")||(a.value=i??"")}function Xp(a,i,l,u){var p=py(a);cr&&(p[i]=a.getAttribute(i),i==="src"||i==="srcset"||i==="href"&&a.nodeName==="LINK")||p[i]!==(p[i]=l)&&(i==="loading"&&(a[qx]=l),l==null?a.removeAttribute(i):typeof l!="string"&&pb(a).includes(i)?a[i]=l:a.setAttribute(i,l))}function py(a){return a.__attributes??(a.__attributes={[cb]:a.nodeName.includes("-"),[ub]:a.namespaceURI===jx})}var Z_=new Map;function pb(a){var i=Z_.get(a.nodeName);if(i)return i;Z_.set(a.nodeName,i=[]);for(var l,u=a,p=Element.prototype;p!==u;){l=$x(u);for(var x in l)l[x].set&&i.push(x);u=Ux(u)}return i}const Pp=new Set;function mb(a,i,l,u,p=u){var x=l.getAttribute("type")==="checkbox",m=a;let o=!1;if(i!==null)for(var P of i)m=m[P]??(m[P]=[]);m.push(l),cy(l,"change",()=>{var A=l.__value;x&&(A=W_(m,A,l.checked)),p(A)},()=>p(x?[]:null)),ly(()=>{var A=u();if(cr&&l.defaultChecked!==l.checked){o=!0;return}x?(A=A||[],l.checked=A.includes(l.__value)):l.checked=Zx(l.__value,A)}),Wx(()=>{var A=m.indexOf(l);A!==-1&&m.splice(A,1)}),Pp.has(m)||(Pp.add(m),Od(()=>{m.sort((A,O)=>A.compareDocumentPosition(O)===4?-1:1),Pp.delete(m)})),Od(()=>{if(o){var A;if(x)A=W_(m,A,l.checked);else{var O=m.find(D=>D.checked);A=O==null?void 0:O.__value}p(A)}})}function W_(a,i,l){for(var u=new Set,p=0;p<a.length;p+=1)a[p].checked&&u.add(a[p].__value);return l||u.delete(i),Array.from(u)}function gb(a,i,l=i){cy(a,"change",()=>{l(a.files)}),cr&&a.files&&l(a.files),ly(()=>{a.files=i()})}function Vr(a){return(i,...l)=>_b(a,i,l)}function Jl(a,i){return Vr(my(a,i).get)}const{apply:_b,getOwnPropertyDescriptor:my,getPrototypeOf:_m,ownKeys:yb}=Reflect,{iterator:Uc,toStringTag:vb}=Symbol,xb=Object,{create:ym,defineProperty:bb}=xb,wb=Array,Mb=wb.prototype,gy=Mb[Uc],Sb=Vr(gy),_y=ArrayBuffer,Tb=_y.prototype;Jl(Tb,"byteLength");const H_=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;H_&&Jl(H_.prototype,"byteLength");const yy=_m(Uint8Array);yy.from;const os=yy.prototype;os[Uc];Vr(os.keys);Vr(os.values);Vr(os.entries);Vr(os.set);Vr(os.reverse);Vr(os.fill);Vr(os.copyWithin);Vr(os.sort);Vr(os.slice);Vr(os.subarray);Jl(os,"buffer");Jl(os,"byteOffset");Jl(os,"length");Jl(os,vb);const Pb=Uint8Array,vy=Uint16Array,vm=Uint32Array,Eb=Float32Array,zc=_m([][Uc]()),xy=Vr(zc.next),Ib=Vr(function*(){}().next),Cb=_m(zc),Ab=DataView.prototype,Rb=Vr(Ab.getUint16),xm=WeakMap,by=xm.prototype,wy=Vr(by.get),kb=Vr(by.set),My=new xm,Db=ym(null,{next:{value:function(){const i=wy(My,this);return xy(i)}},[Uc]:{value:function(){return this}}});function zb(a){if(a[Uc]===gy&&zc.next===xy)return a;const i=ym(Db);return kb(My,i,Sb(a)),i}const Lb=new xm,Ob=ym(Cb,{next:{value:function(){const i=wy(Lb,this);return Ib(i)},writable:!0,configurable:!0}});for(const a of yb(zc))a!=="next"&&bb(Ob,a,my(zc,a));const Sy=new _y(4),Fb=new Eb(Sy),Bb=new vm(Sy),pn=new vy(512),mn=new Pb(512);for(let a=0;a<256;++a){const i=a-127;i<-24?(pn[a]=0,pn[a|256]=32768,mn[a]=24,mn[a|256]=24):i<-14?(pn[a]=1024>>-i-14,pn[a|256]=1024>>-i-14|32768,mn[a]=-i-1,mn[a|256]=-i-1):i<=15?(pn[a]=i+15<<10,pn[a|256]=i+15<<10|32768,mn[a]=13,mn[a|256]=13):i<128?(pn[a]=31744,pn[a|256]=64512,mn[a]=24,mn[a|256]=24):(pn[a]=31744,pn[a|256]=64512,mn[a]=13,mn[a|256]=13)}const bm=new vm(2048);for(let a=1;a<1024;++a){let i=a<<13,l=0;for(;(i&8388608)===0;)i<<=1,l-=8388608;i&=-8388609,l+=947912704,bm[a]=i|l}for(let a=1024;a<2048;++a)bm[a]=939524096+(a-1024<<13);const Ql=new vm(64);for(let a=1;a<31;++a)Ql[a]=a<<23;Ql[31]=1199570944;Ql[32]=2147483648;for(let a=33;a<63;++a)Ql[a]=2147483648+(a-32<<23);Ql[63]=3347054592;const Ty=new vy(64);for(let a=1;a<64;++a)a!==32&&(Ty[a]=1024);function Nb(a){const i=a>>10;return Bb[0]=bm[Ty[i]+(a&1023)]+Ql[i],Fb[0]}function Py(a,i,...l){return Nb(Rb(a,i,...zb(l)))}function wm(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var cd={exports:{}},X_;function Gb(){if(X_)return cd.exports;X_=1;function a(i,l,u){const p=u&&u.debug||!1;p&&console.log("[xml-utils] getting "+l+" in "+i);const x=typeof i=="object"?i.outer:i,m=x.slice(0,x.indexOf(">")+1),o=['"',"'"];for(let P=0;P<o.length;P++){const A=o[P],O=l+"\\="+A+"([^"+A+"]*)"+A;p&&console.log("[xml-utils] pattern:",O);const k=new RegExp(O).exec(m);if(p&&console.log("[xml-utils] match:",k),k)return k[1]}}return cd.exports=a,cd.exports.default=a,cd.exports}var jb=Gb();const Ep=wm(jb);var ud={exports:{}},dd={exports:{}},fd={exports:{}},K_;function Ub(){if(K_)return fd.exports;K_=1;function a(i,l,u){const x=new RegExp(l).exec(i.slice(u));return x?u+x.index:-1}return fd.exports=a,fd.exports.default=a,fd.exports}var pd={exports:{}},Y_;function Vb(){if(Y_)return pd.exports;Y_=1;function a(i,l,u){const x=new RegExp(l).exec(i.slice(u));return x?u+x.index+x[0].length-1:-1}return pd.exports=a,pd.exports.default=a,pd.exports}var md={exports:{}},J_;function qb(){if(J_)return md.exports;J_=1;function a(i,l){const u=new RegExp(l,"g"),p=i.match(u);return p?p.length:0}return md.exports=a,md.exports.default=a,md.exports}var Q_;function $b(){if(Q_)return dd.exports;Q_=1;const a=Ub(),i=Vb(),l=qb();function u(p,x,m){const o=m&&m.debug||!1,P=!(m&&typeof m.nested===!1),A=m&&m.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",x," and ",m);const O=a(p,`<${x}[ 
>/]`,A);if(o&&console.log("[xml-utils] start:",O),O===-1)return;const D=p.slice(O+x.length);let k=i(D,"^[^<]*[ /]>",0);const B=k!==-1&&D[k-1]==="/";if(o&&console.log("[xml-utils] selfClosing:",B),B===!1)if(P){let gt=0,ct=1,Dt=0;for(;(k=i(D,"[ /]"+x+">",gt))!==-1;){const Ct=D.substring(gt,k+1);if(ct+=l(Ct,"<"+x+`[ 
	>]`),Dt+=l(Ct,"</"+x+">"),Dt>=ct)break;gt=k}}else k=i(D,"[ /]"+x+">",0);const V=O+x.length+k+1;if(o&&console.log("[xml-utils] end:",V),V===-1)return;const K=p.slice(O,V);let it;return B?it=null:it=K.slice(K.indexOf(">")+1,K.lastIndexOf("<")),{inner:it,outer:K,start:O,end:V}}return dd.exports=u,dd.exports.default=u,dd.exports}var t0;function Zb(){if(t0)return ud.exports;t0=1;const a=$b();function i(l,u,p){const x=[],m=p&&p.debug||!1,o=p&&typeof p.nested=="boolean"?p.nested:!0;let P=p&&p.startIndex||0,A;for(;A=a(l,u,{debug:m,startIndex:P});)o?P=A.start+1+u.length:P=A.end,x.push(A);return m&&console.log("findTagsByName found",x.length,"tags"),x}return ud.exports=i,ud.exports.default=i,ud.exports}var Wb=Zb();const Hb=wm(Wb),Tc={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},gn={};for(const a in Tc)Tc.hasOwnProperty(a)&&(gn[Tc[a]]=parseInt(a,10));const Xb=[gn.BitsPerSample,gn.ExtraSamples,gn.SampleFormat,gn.StripByteCounts,gn.StripOffsets,gn.StripRowCounts,gn.TileByteCounts,gn.TileOffsets,gn.SubIFDs],Ip={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},hi={};for(const a in Ip)Ip.hasOwnProperty(a)&&(hi[Ip[a]]=parseInt(a,10));const Es={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},Kb={Unspecified:0},_4={AddCompression:1},y4={None:0,Deflate:1,Zstandard:2},Yb={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function Jb(a,i){const{width:l,height:u}=a,p=new Uint8Array(l*u*3);let x;for(let m=0,o=0;m<a.length;++m,o+=3)x=256-a[m]/i*256,p[o]=x,p[o+1]=x,p[o+2]=x;return p}function Qb(a,i){const{width:l,height:u}=a,p=new Uint8Array(l*u*3);let x;for(let m=0,o=0;m<a.length;++m,o+=3)x=a[m]/i*256,p[o]=x,p[o+1]=x,p[o+2]=x;return p}function tw(a,i){const{width:l,height:u}=a,p=new Uint8Array(l*u*3),x=i.length/3,m=i.length/3*2;for(let o=0,P=0;o<a.length;++o,P+=3){const A=a[o];p[P]=i[A]/65536*256,p[P+1]=i[A+x]/65536*256,p[P+2]=i[A+m]/65536*256}return p}function ew(a){const{width:i,height:l}=a,u=new Uint8Array(i*l*3);for(let p=0,x=0;p<a.length;p+=4,x+=3){const m=a[p],o=a[p+1],P=a[p+2],A=a[p+3];u[x]=255*((255-m)/256)*((255-A)/256),u[x+1]=255*((255-o)/256)*((255-A)/256),u[x+2]=255*((255-P)/256)*((255-A)/256)}return u}function iw(a){const{width:i,height:l}=a,u=new Uint8ClampedArray(i*l*3);for(let p=0,x=0;p<a.length;p+=3,x+=3){const m=a[p],o=a[p+1],P=a[p+2];u[x]=m+1.402*(P-128),u[x+1]=m-.34414*(o-128)-.71414*(P-128),u[x+2]=m+1.772*(o-128)}return u}const rw=.95047,sw=1,nw=1.08883;function aw(a){const{width:i,height:l}=a,u=new Uint8Array(i*l*3);for(let p=0,x=0;p<a.length;p+=3,x+=3){const m=a[p+0],o=a[p+1]<<24>>24,P=a[p+2]<<24>>24;let A=(m+16)/116,O=o/500+A,D=A-P/200,k,B,V;O=rw*(O*O*O>.008856?O*O*O:(O-16/116)/7.787),A=sw*(A*A*A>.008856?A*A*A:(A-16/116)/7.787),D=nw*(D*D*D>.008856?D*D*D:(D-16/116)/7.787),k=O*3.2406+A*-1.5372+D*-.4986,B=O*-.9689+A*1.8758+D*.0415,V=O*.0557+A*-.204+D*1.057,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,V=V>.0031308?1.055*V**(1/2.4)-.055:12.92*V,u[x]=Math.max(0,Math.min(1,k))*255,u[x+1]=Math.max(0,Math.min(1,B))*255,u[x+2]=Math.max(0,Math.min(1,V))*255}return u}const Ey=new Map;function Aa(a,i){Array.isArray(a)||(a=[a]),a.forEach(l=>Ey.set(l,i))}async function ow(a){const i=Ey.get(a.Compression);if(!i)throw new Error(`Unknown compression method identifier: ${a.Compression}`);const l=await i();return new l(a)}Aa([void 0,1],()=>Do(()=>import("./BfN7rNmm.js"),__vite__mapDeps([0,1]),import.meta.url).then(a=>a.default));Aa(5,()=>Do(()=>import("./dv0JZMFe.js"),__vite__mapDeps([2,1]),import.meta.url).then(a=>a.default));Aa(6,()=>{throw new Error("old style JPEG compression is not supported.")});Aa(7,()=>Do(()=>import("./BLbg0tTC.js"),__vite__mapDeps([3,1]),import.meta.url).then(a=>a.default));Aa([8,32946],()=>Do(()=>import("./0QI0w0yl.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(a=>a.default));Aa(32773,()=>Do(()=>import("./AId8NOvR.js"),__vite__mapDeps([6,1]),import.meta.url).then(a=>a.default));Aa(34887,()=>Do(()=>import("./Bbdp0RS6.js"),__vite__mapDeps([7,5,1]),import.meta.url).then(async a=>(await a.zstd.init(),a)).then(a=>a.default));Aa(50001,()=>Do(()=>import("./ByRDRQcx.js"),__vite__mapDeps([8,1]),import.meta.url).then(a=>a.default));function Yd(a,i,l,u=1){return new(Object.getPrototypeOf(a)).constructor(i*l*u)}function lw(a,i,l,u,p){const x=i/u,m=l/p;return a.map(o=>{const P=Yd(o,u,p);for(let A=0;A<p;++A){const O=Math.min(Math.round(m*A),l-1);for(let D=0;D<u;++D){const k=Math.min(Math.round(x*D),i-1),B=o[O*i+k];P[A*u+D]=B}}return P})}function Ul(a,i,l){return(1-l)*a+l*i}function hw(a,i,l,u,p){const x=i/u,m=l/p;return a.map(o=>{const P=Yd(o,u,p);for(let A=0;A<p;++A){const O=m*A,D=Math.floor(O),k=Math.min(Math.ceil(O),l-1);for(let B=0;B<u;++B){const V=x*B,K=V%1,it=Math.floor(V),gt=Math.min(Math.ceil(V),i-1),ct=o[D*i+it],Dt=o[D*i+gt],Ct=o[k*i+it],zt=o[k*i+gt],ae=Ul(Ul(ct,Dt,K),Ul(Ct,zt,K),O%1);P[A*u+B]=ae}}return P})}function cw(a,i,l,u,p,x="nearest"){switch(x.toLowerCase()){case"nearest":return lw(a,i,l,u,p);case"bilinear":case"linear":return hw(a,i,l,u,p);default:throw new Error(`Unsupported resampling method: '${x}'`)}}function uw(a,i,l,u,p,x){const m=i/u,o=l/p,P=Yd(a,u,p,x);for(let A=0;A<p;++A){const O=Math.min(Math.round(o*A),l-1);for(let D=0;D<u;++D){const k=Math.min(Math.round(m*D),i-1);for(let B=0;B<x;++B){const V=a[O*i*x+k*x+B];P[A*u*x+D*x+B]=V}}}return P}function dw(a,i,l,u,p,x){const m=i/u,o=l/p,P=Yd(a,u,p,x);for(let A=0;A<p;++A){const O=o*A,D=Math.floor(O),k=Math.min(Math.ceil(O),l-1);for(let B=0;B<u;++B){const V=m*B,K=V%1,it=Math.floor(V),gt=Math.min(Math.ceil(V),i-1);for(let ct=0;ct<x;++ct){const Dt=a[D*i*x+it*x+ct],Ct=a[D*i*x+gt*x+ct],zt=a[k*i*x+it*x+ct],ae=a[k*i*x+gt*x+ct],ke=Ul(Ul(Dt,Ct,K),Ul(zt,ae,K),O%1);P[A*u*x+B*x+ct]=ke}}}return P}function fw(a,i,l,u,p,x,m="nearest"){switch(m.toLowerCase()){case"nearest":return uw(a,i,l,u,p,x);case"bilinear":case"linear":return dw(a,i,l,u,p,x);default:throw new Error(`Unsupported resampling method: '${m}'`)}}function pw(a,i,l){let u=0;for(let p=i;p<l;++p)u+=a[p];return u}function Kp(a,i,l){switch(a){case 1:if(i<=8)return new Uint8Array(l);if(i<=16)return new Uint16Array(l);if(i<=32)return new Uint32Array(l);break;case 2:if(i===8)return new Int8Array(l);if(i===16)return new Int16Array(l);if(i===32)return new Int32Array(l);break;case 3:switch(i){case 16:case 32:return new Float32Array(l);case 64:return new Float64Array(l)}break}throw Error("Unsupported data format/bitsPerSample")}function mw(a,i){return(a===1||a===2)&&i<=32&&i%8===0?!1:!(a===3&&(i===16||i===32||i===64))}function gw(a,i,l,u,p,x,m){const o=new DataView(a),P=l===2?m*x:m*x*u,A=l===2?1:u,O=Kp(i,p,P),D=parseInt("1".repeat(p),2);if(i===1){let k;l===1?k=u*p:k=p;let B=x*k;(B&7)!==0&&(B=B+7&-8);for(let V=0;V<m;++V){const K=V*B;for(let it=0;it<x;++it){const gt=K+it*A*p;for(let ct=0;ct<A;++ct){const Dt=gt+ct*p,Ct=(V*x+it)*A+ct,zt=Math.floor(Dt/8),ae=Dt%8;if(ae+p<=8)O[Ct]=o.getUint8(zt)>>8-p-ae&D;else if(ae+p<=16)O[Ct]=o.getUint16(zt)>>16-p-ae&D;else if(ae+p<=24){const ke=o.getUint16(zt)<<8|o.getUint8(zt+2);O[Ct]=ke>>24-p-ae&D}else O[Ct]=o.getUint32(zt)>>32-p-ae&D}}}}return O.buffer}class _w{constructor(i,l,u,p,x,m){this.fileDirectory=i,this.geoKeys=l,this.dataView=u,this.littleEndian=p,this.tiles=x?{}:null,this.isTiled=!i.StripOffsets;const o=i.PlanarConfiguration;if(this.planarConfiguration=typeof o>"u"?1:o,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=m}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(i){return this.isTiled||(i+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-i*this.getTileHeight()}getBytesPerPixel(){let i=0;for(let l=0;l<this.fileDirectory.BitsPerSample.length;++l)i+=this.getSampleByteSize(l);return i}getSampleByteSize(i){if(i>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${i} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[i]/8)}getReaderForSample(i){const l=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[i]:1,u=this.fileDirectory.BitsPerSample[i];switch(l){case 1:if(u<=8)return DataView.prototype.getUint8;if(u<=16)return DataView.prototype.getUint16;if(u<=32)return DataView.prototype.getUint32;break;case 2:if(u<=8)return DataView.prototype.getInt8;if(u<=16)return DataView.prototype.getInt16;if(u<=32)return DataView.prototype.getInt32;break;case 3:switch(u){case 16:return function(p,x){return Py(this,p,x)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(i=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[i]:1}getBitsPerSample(i=0){return this.fileDirectory.BitsPerSample[i]}getArrayForSample(i,l){const u=this.getSampleFormat(i),p=this.getBitsPerSample(i);return Kp(u,p,l)}async getTileOrStrip(i,l,u,p,x){const m=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let P;const{tiles:A}=this;this.planarConfiguration===1?P=l*m+i:this.planarConfiguration===2&&(P=u*m*o+l*m+i);let O,D;this.isTiled?(O=this.fileDirectory.TileOffsets[P],D=this.fileDirectory.TileByteCounts[P]):(O=this.fileDirectory.StripOffsets[P],D=this.fileDirectory.StripByteCounts[P]);const k=(await this.source.fetch([{offset:O,length:D}],x))[0];let B;return A===null||!A[P]?(B=(async()=>{let V=await p.decode(this.fileDirectory,k);const K=this.getSampleFormat(),it=this.getBitsPerSample();return mw(K,it)&&(V=gw(V,K,this.planarConfiguration,this.getSamplesPerPixel(),it,this.getTileWidth(),this.getBlockHeight(l))),V})(),A!==null&&(A[P]=B)):B=A[P],{x:i,y:l,sample:u,data:await B}}async _readRaster(i,l,u,p,x,m,o,P,A){const O=this.getTileWidth(),D=this.getTileHeight(),k=this.getWidth(),B=this.getHeight(),V=Math.max(Math.floor(i[0]/O),0),K=Math.min(Math.ceil(i[2]/O),Math.ceil(k/O)),it=Math.max(Math.floor(i[1]/D),0),gt=Math.min(Math.ceil(i[3]/D),Math.ceil(B/D)),ct=i[2]-i[0];let Dt=this.getBytesPerPixel();const Ct=[],zt=[];for(let de=0;de<l.length;++de)this.planarConfiguration===1?Ct.push(pw(this.fileDirectory.BitsPerSample,0,l[de])/8):Ct.push(0),zt.push(this.getReaderForSample(l[de]));const ae=[],{littleEndian:ke}=this;for(let de=it;de<gt;++de)for(let Le=V;Le<K;++Le){let Xe;this.planarConfiguration===1&&(Xe=this.getTileOrStrip(Le,de,0,x,A));for(let ne=0;ne<l.length;++ne){const le=ne,be=l[ne];this.planarConfiguration===2&&(Dt=this.getSampleByteSize(be),Xe=this.getTileOrStrip(Le,de,be,x,A));const qe=Xe.then(Ce=>{const ui=Ce.data,yi=new DataView(ui),Ft=this.getBlockHeight(Ce.y),qt=Ce.y*D,Wt=Ce.x*O,Ut=qt+Ft,Et=(Ce.x+1)*O,Gt=zt[le],se=Math.min(Ft,Ft-(Ut-i[3]),B-qt),Se=Math.min(O,O-(Et-i[2]),k-Wt);for(let Ee=Math.max(0,i[1]-qt);Ee<se;++Ee)for(let _e=Math.max(0,i[0]-Wt);_e<Se;++_e){const je=(Ee*O+_e)*Dt,ue=Gt.call(yi,je+Ct[le],ke);let De;p?(De=(Ee+qt-i[1])*ct*l.length+(_e+Wt-i[0])*l.length+le,u[De]=ue):(De=(Ee+qt-i[1])*ct+_e+Wt-i[0],u[le][De]=ue)}});ae.push(qe)}}if(await Promise.all(ae),m&&i[2]-i[0]!==m||o&&i[3]-i[1]!==o){let de;return p?de=fw(u,i[2]-i[0],i[3]-i[1],m,o,l.length,P):de=cw(u,i[2]-i[0],i[3]-i[1],m,o,P),de.width=m,de.height=o,de}return u.width=m||i[2]-i[0],u.height=o||i[3]-i[1],u}async readRasters({window:i,samples:l=[],interleave:u,pool:p=null,width:x,height:m,resampleMethod:o,fillValue:P,signal:A}={}){const O=i||[0,0,this.getWidth(),this.getHeight()];if(O[0]>O[2]||O[1]>O[3])throw new Error("Invalid subsets");const D=O[2]-O[0],k=O[3]-O[1],B=D*k,V=this.getSamplesPerPixel();if(!l||!l.length)for(let ct=0;ct<V;++ct)l.push(ct);else for(let ct=0;ct<l.length;++ct)if(l[ct]>=V)return Promise.reject(new RangeError(`Invalid sample index '${l[ct]}'.`));let K;if(u){const ct=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Dt=Math.max.apply(null,this.fileDirectory.BitsPerSample);K=Kp(ct,Dt,B*l.length),P&&K.fill(P)}else{K=[];for(let ct=0;ct<l.length;++ct){const Dt=this.getArrayForSample(l[ct],B);Array.isArray(P)&&ct<P.length?Dt.fill(P[ct]):P&&!Array.isArray(P)&&Dt.fill(P),K.push(Dt)}}const it=p||await ow(this.fileDirectory);return await this._readRaster(O,l,K,u,it,x,m,o,A)}async readRGB({window:i,interleave:l=!0,pool:u=null,width:p,height:x,resampleMethod:m,enableAlpha:o=!1,signal:P}={}){const A=i||[0,0,this.getWidth(),this.getHeight()];if(A[0]>A[2]||A[1]>A[3])throw new Error("Invalid subsets");const O=this.fileDirectory.PhotometricInterpretation;if(O===Es.RGB){let gt=[0,1,2];if(this.fileDirectory.ExtraSamples!==Kb.Unspecified&&o){gt=[];for(let ct=0;ct<this.fileDirectory.BitsPerSample.length;ct+=1)gt.push(ct)}return this.readRasters({window:i,interleave:l,samples:gt,pool:u,width:p,height:x,resampleMethod:m,signal:P})}let D;switch(O){case Es.WhiteIsZero:case Es.BlackIsZero:case Es.Palette:D=[0];break;case Es.CMYK:D=[0,1,2,3];break;case Es.YCbCr:case Es.CIELab:D=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const k={window:A,interleave:!0,samples:D,pool:u,width:p,height:x,resampleMethod:m,signal:P},{fileDirectory:B}=this,V=await this.readRasters(k),K=2**this.fileDirectory.BitsPerSample[0];let it;switch(O){case Es.WhiteIsZero:it=Jb(V,K);break;case Es.BlackIsZero:it=Qb(V,K);break;case Es.Palette:it=tw(V,B.ColorMap);break;case Es.CMYK:it=ew(V);break;case Es.YCbCr:it=iw(V);break;case Es.CIELab:it=aw(V);break;default:throw new Error("Unsupported photometric interpretation.")}if(!l){const gt=new Uint8Array(it.length/3),ct=new Uint8Array(it.length/3),Dt=new Uint8Array(it.length/3);for(let Ct=0,zt=0;Ct<it.length;Ct+=3,++zt)gt[zt]=it[Ct],ct[zt]=it[Ct+1],Dt[zt]=it[Ct+2];it=[gt,ct,Dt]}return it.width=V.width,it.height=V.height,it}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const i=[];for(let l=0;l<this.fileDirectory.ModelTiepoint.length;l+=6)i.push({i:this.fileDirectory.ModelTiepoint[l],j:this.fileDirectory.ModelTiepoint[l+1],k:this.fileDirectory.ModelTiepoint[l+2],x:this.fileDirectory.ModelTiepoint[l+3],y:this.fileDirectory.ModelTiepoint[l+4],z:this.fileDirectory.ModelTiepoint[l+5]});return i}getGDALMetadata(i=null){const l={};if(!this.fileDirectory.GDAL_METADATA)return null;const u=this.fileDirectory.GDAL_METADATA;let p=Hb(u,"Item");i===null?p=p.filter(x=>Ep(x,"sample")===void 0):p=p.filter(x=>Number(Ep(x,"sample"))===i);for(let x=0;x<p.length;++x){const m=p[x];l[Ep(m,"name")]=m.inner}return l}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const i=this.fileDirectory.GDAL_NODATA;return Number(i.substring(0,i.length-1))}getOrigin(){const i=this.fileDirectory.ModelTiepoint,l=this.fileDirectory.ModelTransformation;if(i&&i.length===6)return[i[3],i[4],i[5]];if(l)return[l[3],l[7],l[11]];throw new Error("The image does not have an affine transformation.")}getResolution(i=null){const l=this.fileDirectory.ModelPixelScale,u=this.fileDirectory.ModelTransformation;if(l)return[l[0],-l[1],l[2]];if(u)return u[1]===0&&u[4]===0?[u[0],-u[5],u[10]]:[Math.sqrt(u[0]*u[0]+u[4]*u[4]),-Math.sqrt(u[1]*u[1]+u[5]*u[5]),u[10]];if(i){const[p,x,m]=i.getResolution();return[p*i.getWidth()/this.getWidth(),x*i.getHeight()/this.getHeight(),m*i.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(i=!1){const l=this.getHeight(),u=this.getWidth();if(this.fileDirectory.ModelTransformation&&!i){const[p,x,m,o,P,A,O,D]=this.fileDirectory.ModelTransformation,B=[[0,0],[0,l],[u,0],[u,l]].map(([it,gt])=>[o+p*it+x*gt,D+P*it+A*gt]),V=B.map(it=>it[0]),K=B.map(it=>it[1]);return[Math.min(...V),Math.min(...K),Math.max(...V),Math.max(...K)]}else{const p=this.getOrigin(),x=this.getResolution(),m=p[0],o=p[1],P=m+x[0]*u,A=o+x[1]*l;return[Math.min(m,P),Math.min(o,A),Math.max(m,P),Math.max(o,A)]}}}class yw{constructor(i){this._dataView=new DataView(i)}get buffer(){return this._dataView.buffer}getUint64(i,l){const u=this.getUint32(i,l),p=this.getUint32(i+4,l);let x;if(l){if(x=u+2**32*p,!Number.isSafeInteger(x))throw new Error(`${x} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return x}if(x=2**32*u+p,!Number.isSafeInteger(x))throw new Error(`${x} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return x}getInt64(i,l){let u=0;const p=(this._dataView.getUint8(i+(l?7:0))&128)>0;let x=!0;for(let m=0;m<8;m++){let o=this._dataView.getUint8(i+(l?m:7-m));p&&(x?o!==0&&(o=~(o-1)&255,x=!1):o=~o&255),u+=o*256**m}return p&&(u=-u),u}getUint8(i,l){return this._dataView.getUint8(i,l)}getInt8(i,l){return this._dataView.getInt8(i,l)}getUint16(i,l){return this._dataView.getUint16(i,l)}getInt16(i,l){return this._dataView.getInt16(i,l)}getUint32(i,l){return this._dataView.getUint32(i,l)}getInt32(i,l){return this._dataView.getInt32(i,l)}getFloat16(i,l){return Py(this._dataView,i,l)}getFloat32(i,l){return this._dataView.getFloat32(i,l)}getFloat64(i,l){return this._dataView.getFloat64(i,l)}}class vw{constructor(i,l,u,p){this._dataView=new DataView(i),this._sliceOffset=l,this._littleEndian=u,this._bigTiff=p}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(i,l){return this.sliceOffset<=i&&this.sliceTop>=i+l}readUint8(i){return this._dataView.getUint8(i-this._sliceOffset,this._littleEndian)}readInt8(i){return this._dataView.getInt8(i-this._sliceOffset,this._littleEndian)}readUint16(i){return this._dataView.getUint16(i-this._sliceOffset,this._littleEndian)}readInt16(i){return this._dataView.getInt16(i-this._sliceOffset,this._littleEndian)}readUint32(i){return this._dataView.getUint32(i-this._sliceOffset,this._littleEndian)}readInt32(i){return this._dataView.getInt32(i-this._sliceOffset,this._littleEndian)}readFloat32(i){return this._dataView.getFloat32(i-this._sliceOffset,this._littleEndian)}readFloat64(i){return this._dataView.getFloat64(i-this._sliceOffset,this._littleEndian)}readUint64(i){const l=this.readUint32(i),u=this.readUint32(i+4);let p;if(this._littleEndian){if(p=l+2**32*u,!Number.isSafeInteger(p))throw new Error(`${p} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return p}if(p=2**32*l+u,!Number.isSafeInteger(p))throw new Error(`${p} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return p}readInt64(i){let l=0;const u=(this._dataView.getUint8(i+(this._littleEndian?7:0))&128)>0;let p=!0;for(let x=0;x<8;x++){let m=this._dataView.getUint8(i+(this._littleEndian?x:7-x));u&&(p?m!==0&&(m=~(m-1)&255,p=!1):m=~m&255),l+=m*256**x}return u&&(l=-l),l}readOffset(i){return this._bigTiff?this.readUint64(i):this.readUint32(i)}}const e0=`\r
\r
`;function Iy(a){if(typeof Object.fromEntries<"u")return Object.fromEntries(a);const i={};for(const[l,u]of a)i[l.toLowerCase()]=u;return i}function xw(a){const i=a.split(`\r
`).map(l=>{const u=l.split(":").map(p=>p.trim());return u[0]=u[0].toLowerCase(),u});return Iy(i)}function bw(a){const[i,...l]=a.split(";").map(p=>p.trim()),u=l.map(p=>p.split("="));return{type:i,params:Iy(u)}}function Yp(a){let i,l,u;return a&&([,i,l,u]=a.match(/bytes (\d+)-(\d+)\/(\d+)/),i=parseInt(i,10),l=parseInt(l,10),u=parseInt(u,10)),{start:i,end:l,total:u}}function ww(a,i){let l=null;const u=new TextDecoder("ascii"),p=[],x=`--${i}`,m=`${x}--`;for(let o=0;o<10;++o)u.decode(new Uint8Array(a,o,x.length))===x&&(l=o);if(l===null)throw new Error("Could not find initial boundary");for(;l<a.byteLength;){const o=u.decode(new Uint8Array(a,l,Math.min(x.length+1024,a.byteLength-l)));if(o.length===0||o.startsWith(m))break;if(!o.startsWith(x))throw new Error("Part does not start with boundary");const P=o.substr(x.length+2);if(P.length===0)break;const A=P.indexOf(e0),O=xw(P.substr(0,A)),{start:D,end:k,total:B}=Yp(O["content-range"]),V=l+x.length+A+e0.length,K=parseInt(k,10)+1-parseInt(D,10);p.push({headers:O,data:a.slice(V,V+K),offset:D,length:K,fileSize:B}),l=V+K+4}return p}class Mm{async fetch(i,l=void 0){return Promise.all(i.map(u=>this.fetchSlice(u,l)))}async fetchSlice(i){throw new Error(`fetching of slice ${i} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Mw extends Map{constructor(i={}){if(super(),!(i.maxSize&&i.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof i.maxAge=="number"&&i.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=i.maxSize,this.maxAge=i.maxAge||Number.POSITIVE_INFINITY,this.onEviction=i.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(i){if(typeof this.onEviction=="function")for(const[l,u]of i)this.onEviction(l,u.value)}_deleteIfExpired(i,l){return typeof l.expiry=="number"&&l.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(i,l.value),this.delete(i)):!1}_getOrDeleteIfExpired(i,l){if(this._deleteIfExpired(i,l)===!1)return l.value}_getItemValue(i,l){return l.expiry?this._getOrDeleteIfExpired(i,l):l.value}_peek(i,l){const u=l.get(i);return this._getItemValue(i,u)}_set(i,l){this.cache.set(i,l),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(i,l){this.oldCache.delete(i),this._set(i,l)}*_entriesAscending(){for(const i of this.oldCache){const[l,u]=i;this.cache.has(l)||this._deleteIfExpired(l,u)===!1&&(yield i)}for(const i of this.cache){const[l,u]=i;this._deleteIfExpired(l,u)===!1&&(yield i)}}get(i){if(this.cache.has(i)){const l=this.cache.get(i);return this._getItemValue(i,l)}if(this.oldCache.has(i)){const l=this.oldCache.get(i);if(this._deleteIfExpired(i,l)===!1)return this._moveToRecent(i,l),l.value}}set(i,l,{maxAge:u=this.maxAge}={}){const p=typeof u=="number"&&u!==Number.POSITIVE_INFINITY?Date.now()+u:void 0;return this.cache.has(i)?this.cache.set(i,{value:l,expiry:p}):this._set(i,{value:l,expiry:p}),this}has(i){return this.cache.has(i)?!this._deleteIfExpired(i,this.cache.get(i)):this.oldCache.has(i)?!this._deleteIfExpired(i,this.oldCache.get(i)):!1}peek(i){if(this.cache.has(i))return this._peek(i,this.cache);if(this.oldCache.has(i))return this._peek(i,this.oldCache)}delete(i){const l=this.cache.delete(i);return l&&this._size--,this.oldCache.delete(i)||l}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(i){if(!(i&&i>0))throw new TypeError("`maxSize` must be a number greater than 0");const l=[...this._entriesAscending()],u=l.length-i;u<0?(this.cache=new Map(l),this.oldCache=new Map,this._size=l.length):(u>0&&this._emitEvictions(l.slice(0,u)),this.oldCache=new Map(l.slice(u)),this.cache=new Map,this._size=0),this.maxSize=i}*keys(){for(const[i]of this)yield i}*values(){for(const[,i]of this)yield i}*[Symbol.iterator](){for(const i of this.cache){const[l,u]=i;this._deleteIfExpired(l,u)===!1&&(yield[l,u.value])}for(const i of this.oldCache){const[l,u]=i;this.cache.has(l)||this._deleteIfExpired(l,u)===!1&&(yield[l,u.value])}}*entriesDescending(){let i=[...this.cache];for(let l=i.length-1;l>=0;--l){const u=i[l],[p,x]=u;this._deleteIfExpired(p,x)===!1&&(yield[p,x.value])}i=[...this.oldCache];for(let l=i.length-1;l>=0;--l){const u=i[l],[p,x]=u;this.cache.has(p)||this._deleteIfExpired(p,x)===!1&&(yield[p,x.value])}}*entriesAscending(){for(const[i,l]of this._entriesAscending())yield[i,l.value]}get size(){if(!this._size)return this.oldCache.size;let i=0;for(const l of this.oldCache.keys())this.cache.has(l)||i++;return Math.min(this._size+i,this.maxSize)}entries(){return this.entriesAscending()}forEach(i,l=this){for(const[u,p]of this.entriesAscending())i.call(l,p,u,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function Sw(a){return new Promise(i=>setTimeout(i,a))}function Tw(a,i){const l=Array.isArray(a)?a:Array.from(a),u=Array.isArray(i)?i:Array.from(i);return l.map((p,x)=>[p,u[x]])}class Hl extends Error{constructor(i){super(i),Error.captureStackTrace&&Error.captureStackTrace(this,Hl),this.name="AbortError"}}class Pw extends Error{constructor(i,l){super(l),this.errors=i,this.message=l,this.name="AggregateError"}}const Ew=Pw;class Iw{constructor(i,l,u=null){this.offset=i,this.length=l,this.data=u}get top(){return this.offset+this.length}}class i0{constructor(i,l,u){this.offset=i,this.length=l,this.blockIds=u}}class Cw extends Mm{constructor(i,{blockSize:l=65536,cacheSize:u=100}={}){super(),this.source=i,this.blockSize=l,this.blockCache=new Mw({maxSize:u,onEviction:(p,x)=>{this.evictedBlocks.set(p,x)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(i,l){const u=[],p=[],x=[];this.evictedBlocks.clear();for(const{offset:k,length:B}of i){let V=k+B;const{fileSize:K}=this;K!==null&&(V=Math.min(V,K));const it=Math.floor(k/this.blockSize)*this.blockSize;for(let gt=it;gt<V;gt+=this.blockSize){const ct=Math.floor(gt/this.blockSize);!this.blockCache.has(ct)&&!this.blockRequests.has(ct)&&(this.blockIdsToFetch.add(ct),p.push(ct)),this.blockRequests.has(ct)&&u.push(this.blockRequests.get(ct)),x.push(ct)}}await Sw(),this.fetchBlocks(l);const m=[];for(const k of p)this.blockRequests.has(k)&&m.push(this.blockRequests.get(k));await Promise.allSettled(u),await Promise.allSettled(m);const o=[],P=x.filter(k=>this.abortedBlockIds.has(k)||!this.blockCache.has(k));if(P.forEach(k=>this.blockIdsToFetch.add(k)),P.length>0&&l&&!l.aborted){this.fetchBlocks(null);for(const k of P){const B=this.blockRequests.get(k);if(!B)throw new Error(`Block ${k} is not in the block requests`);o.push(B)}await Promise.allSettled(o)}if(l&&l.aborted)throw new Hl("Request was aborted");const A=x.map(k=>this.blockCache.get(k)||this.evictedBlocks.get(k)),O=A.filter(k=>!k);if(O.length)throw new Ew(O,"Request failed");const D=new Map(Tw(x,A));return this.readSliceData(i,D)}fetchBlocks(i){if(this.blockIdsToFetch.size>0){const l=this.groupBlocks(this.blockIdsToFetch),u=this.source.fetch(l,i);for(let p=0;p<l.length;++p){const x=l[p];for(const m of x.blockIds)this.blockRequests.set(m,(async()=>{try{const o=(await u)[p],P=m*this.blockSize,A=P-o.offset,O=Math.min(A+this.blockSize,o.data.byteLength),D=o.data.slice(A,O),k=new Iw(P,D.byteLength,D,m);this.blockCache.set(m,k),this.abortedBlockIds.delete(m)}catch(o){if(o.name==="AbortError")o.signal=i,this.blockCache.delete(m),this.abortedBlockIds.add(m);else throw o}finally{this.blockRequests.delete(m)}})())}this.blockIdsToFetch.clear()}}groupBlocks(i){const l=Array.from(i).sort((m,o)=>m-o);if(l.length===0)return[];let u=[],p=null;const x=[];for(const m of l)p===null||p+1===m?(u.push(m),p=m):(x.push(new i0(u[0]*this.blockSize,u.length*this.blockSize,u)),u=[m],p=m);return x.push(new i0(u[0]*this.blockSize,u.length*this.blockSize,u)),x}readSliceData(i,l){return i.map(u=>{let p=u.offset+u.length;this.fileSize!==null&&(p=Math.min(this.fileSize,p));const x=Math.floor(u.offset/this.blockSize),m=Math.floor(p/this.blockSize),o=new ArrayBuffer(u.length),P=new Uint8Array(o);for(let A=x;A<=m;++A){const O=l.get(A),D=O.offset-u.offset,k=O.top-p;let B=0,V=0,K;D<0?B=-D:D>0&&(V=D),k<0?K=O.length-B:K=p-O.offset-B;const it=new Uint8Array(O.data,B,K);P.set(it,V)}return o})}}class Sm{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(i){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Tm{constructor(i){this.url=i}async request({headers:i,signal:l}={}){throw new Error("request is not implemented")}}class Aw extends Sm{constructor(i){super(),this.response=i}get status(){return this.response.status}getHeader(i){return this.response.headers.get(i)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class Rw extends Tm{constructor(i,l){super(i),this.credentials=l}async request({headers:i,signal:l}={}){const u=await fetch(this.url,{headers:i,credentials:this.credentials,signal:l});return new Aw(u)}}class kw extends Sm{constructor(i,l){super(),this.xhr=i,this.data=l}get status(){return this.xhr.status}getHeader(i){return this.xhr.getResponseHeader(i)}async getData(){return this.data}}class Dw extends Tm{constructRequest(i,l){return new Promise((u,p)=>{const x=new XMLHttpRequest;x.open("GET",this.url),x.responseType="arraybuffer";for(const[m,o]of Object.entries(i))x.setRequestHeader(m,o);x.onload=()=>{const m=x.response;u(new kw(x,m))},x.onerror=p,x.onabort=()=>p(new Hl("Request aborted")),x.send(),l&&(l.aborted&&x.abort(),l.addEventListener("abort",()=>x.abort()))})}async request({headers:i,signal:l}={}){return await this.constructRequest(i,l)}}const Cp={};class zw extends Sm{constructor(i,l){super(),this.response=i,this.dataPromise=l}get status(){return this.response.statusCode}getHeader(i){return this.response.headers[i]}async getData(){return await this.dataPromise}}class Lw extends Tm{constructor(i){super(i),this.parsedUrl=Cp.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Cp)}constructRequest(i,l){return new Promise((u,p)=>{const x=this.httpApi.get({...this.parsedUrl,headers:i},m=>{const o=new Promise(P=>{const A=[];m.on("data",O=>{A.push(O)}),m.on("end",()=>{const O=Buffer.concat(A).buffer;P(O)}),m.on("error",p)});u(new zw(m,o))});x.on("error",p),l&&(l.aborted&&x.destroy(new Hl("Request aborted")),l.addEventListener("abort",()=>x.destroy(new Hl("Request aborted"))))})}async request({headers:i,signal:l}={}){return await this.constructRequest(i,l)}}class Pm extends Mm{constructor(i,l,u,p){super(),this.client=i,this.headers=l,this.maxRanges=u,this.allowFullFile=p,this._fileSize=null}async fetch(i,l){return this.maxRanges>=i.length?this.fetchSlices(i,l):(this.maxRanges>0&&i.length>1,Promise.all(i.map(u=>this.fetchSlice(u,l))))}async fetchSlices(i,l){const u=await this.client.request({headers:{...this.headers,Range:`bytes=${i.map(({offset:p,length:x})=>`${p}-${p+x}`).join(",")}`},signal:l});if(u.ok)if(u.status===206){const{type:p,params:x}=bw(u.getHeader("content-type"));if(p==="multipart/byteranges"){const D=ww(await u.getData(),x.boundary);return this._fileSize=D[0].fileSize||null,D}const m=await u.getData(),{start:o,end:P,total:A}=Yp(u.getHeader("content-range"));this._fileSize=A||null;const O=[{data:m,offset:o,length:P-o}];if(i.length>1){const D=await Promise.all(i.slice(1).map(k=>this.fetchSlice(k,l)));return O.concat(D)}return O}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const p=await u.getData();return this._fileSize=p.byteLength,[{data:p,offset:0,length:p.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(i,l){const{offset:u,length:p}=i,x=await this.client.request({headers:{...this.headers,Range:`bytes=${u}-${u+p}`},signal:l});if(x.ok)if(x.status===206){const m=await x.getData(),{total:o}=Yp(x.getHeader("content-range"));return this._fileSize=o||null,{data:m,offset:u,length:p}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const m=await x.getData();return this._fileSize=m.byteLength,{data:m,offset:0,length:m.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Em(a,{blockSize:i,cacheSize:l}){return i===null?a:new Cw(a,{blockSize:i,cacheSize:l})}function Ow(a,{headers:i={},credentials:l,maxRanges:u=0,allowFullFile:p=!1,...x}={}){const m=new Rw(a,l),o=new Pm(m,i,u,p);return Em(o,x)}function Fw(a,{headers:i={},maxRanges:l=0,allowFullFile:u=!1,...p}={}){const x=new Dw(a),m=new Pm(x,i,l,u);return Em(m,p)}function Bw(a,{headers:i={},maxRanges:l=0,allowFullFile:u=!1,...p}={}){const x=new Lw(a),m=new Pm(x,i,l,u);return Em(m,p)}function Nw(a,{forceXHR:i=!1,...l}={}){return typeof fetch=="function"&&!i?Ow(a,l):typeof XMLHttpRequest<"u"?Fw(a,l):Bw(a,l)}class Gw extends Mm{constructor(i){super(),this.file=i}async fetchSlice(i,l){return new Promise((u,p)=>{const x=this.file.slice(i.offset,i.offset+i.length),m=new FileReader;m.onload=o=>u(o.target.result),m.onerror=p,m.onabort=p,m.readAsArrayBuffer(x),l&&l.addEventListener("abort",()=>m.abort())})}}function jw(a){return new Gw(a)}function Jp(a){switch(a){case hi.BYTE:case hi.ASCII:case hi.SBYTE:case hi.UNDEFINED:return 1;case hi.SHORT:case hi.SSHORT:return 2;case hi.LONG:case hi.SLONG:case hi.FLOAT:case hi.IFD:return 4;case hi.RATIONAL:case hi.SRATIONAL:case hi.DOUBLE:case hi.LONG8:case hi.SLONG8:case hi.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${a}`)}}function Uw(a){const i=a.GeoKeyDirectory;if(!i)return null;const l={};for(let u=4;u<=i[3]*4;u+=4){const p=Yb[i[u]],x=i[u+1]?Tc[i[u+1]]:null,m=i[u+2],o=i[u+3];let P=null;if(!x)P=o;else{if(P=a[x],typeof P>"u"||P===null)throw new Error(`Could not get value of geoKey '${p}'.`);typeof P=="string"?P=P.substring(o,o+m-1):P.subarray&&(P=P.subarray(o,o+m),m===1&&(P=P[0]))}l[p]=P}return l}function Al(a,i,l,u){let p=null,x=null;const m=Jp(i);switch(i){case hi.BYTE:case hi.ASCII:case hi.UNDEFINED:p=new Uint8Array(l),x=a.readUint8;break;case hi.SBYTE:p=new Int8Array(l),x=a.readInt8;break;case hi.SHORT:p=new Uint16Array(l),x=a.readUint16;break;case hi.SSHORT:p=new Int16Array(l),x=a.readInt16;break;case hi.LONG:case hi.IFD:p=new Uint32Array(l),x=a.readUint32;break;case hi.SLONG:p=new Int32Array(l),x=a.readInt32;break;case hi.LONG8:case hi.IFD8:p=new Array(l),x=a.readUint64;break;case hi.SLONG8:p=new Array(l),x=a.readInt64;break;case hi.RATIONAL:p=new Uint32Array(l*2),x=a.readUint32;break;case hi.SRATIONAL:p=new Int32Array(l*2),x=a.readInt32;break;case hi.FLOAT:p=new Float32Array(l),x=a.readFloat32;break;case hi.DOUBLE:p=new Float64Array(l),x=a.readFloat64;break;default:throw new RangeError(`Invalid field type: ${i}`)}if(i===hi.RATIONAL||i===hi.SRATIONAL)for(let o=0;o<l;o+=2)p[o]=x.call(a,u+o*m),p[o+1]=x.call(a,u+(o*m+4));else for(let o=0;o<l;++o)p[o]=x.call(a,u+o*m);return i===hi.ASCII?new TextDecoder("utf-8").decode(p):p}class Vw{constructor(i,l,u){this.fileDirectory=i,this.geoKeyDirectory=l,this.nextIFDByteOffset=u}}class gd extends Error{constructor(i){super(`No image at index ${i}`),this.index=i}}class qw{async readRasters(i={}){const{window:l,width:u,height:p}=i;let{resX:x,resY:m,bbox:o}=i;const P=await this.getImage();let A=P;const O=await this.getImageCount(),D=P.getBoundingBox();if(l&&o)throw new Error('Both "bbox" and "window" passed.');if(u||p){if(l){const[V,K]=P.getOrigin(),[it,gt]=P.getResolution();o=[V+l[0]*it,K+l[1]*gt,V+l[2]*it,K+l[3]*gt]}const B=o||D;if(u){if(x)throw new Error("Both width and resX passed");x=(B[2]-B[0])/u}if(p){if(m)throw new Error("Both width and resY passed");m=(B[3]-B[1])/p}}if(x||m){const B=[];for(let V=0;V<O;++V){const K=await this.getImage(V),{SubfileType:it,NewSubfileType:gt}=K.fileDirectory;(V===0||it===2||gt&1)&&B.push(K)}B.sort((V,K)=>V.getWidth()-K.getWidth());for(let V=0;V<B.length;++V){const K=B[V],it=(D[2]-D[0])/K.getWidth(),gt=(D[3]-D[1])/K.getHeight();if(A=K,x&&x>it||m&&m>gt)break}}let k=l;if(o){const[B,V]=P.getOrigin(),[K,it]=A.getResolution(P);k=[Math.round((o[0]-B)/K),Math.round((o[1]-V)/it),Math.round((o[2]-B)/K),Math.round((o[3]-V)/it)],k=[Math.min(k[0],k[2]),Math.min(k[1],k[3]),Math.max(k[0],k[2]),Math.max(k[1],k[3])]}return A.readRasters({...i,window:k})}}class Jd extends qw{constructor(i,l,u,p,x={}){super(),this.source=i,this.littleEndian=l,this.bigTiff=u,this.firstIFDOffset=p,this.cache=x.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(i,l){const u=this.bigTiff?4048:1024;return new vw((await this.source.fetch([{offset:i,length:typeof l<"u"?l:u}]))[0],i,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(i){const l=this.bigTiff?20:12,u=this.bigTiff?8:2;let p=await this.getSlice(i);const x=this.bigTiff?p.readUint64(i):p.readUint16(i),m=x*l+(this.bigTiff?16:6);p.covers(i,m)||(p=await this.getSlice(i,m));const o={};let P=i+(this.bigTiff?8:2);for(let D=0;D<x;P+=l,++D){const k=p.readUint16(P),B=p.readUint16(P+2),V=this.bigTiff?p.readUint64(P+4):p.readUint32(P+4);let K,it;const gt=Jp(B),ct=P+(this.bigTiff?12:8);if(gt*V<=(this.bigTiff?8:4))K=Al(p,B,V,ct);else{const Dt=p.readOffset(ct),Ct=Jp(B)*V;if(p.covers(Dt,Ct))K=Al(p,B,V,Dt);else{const zt=await this.getSlice(Dt,Ct);K=Al(zt,B,V,Dt)}}V===1&&Xb.indexOf(k)===-1&&!(B===hi.RATIONAL||B===hi.SRATIONAL)?it=K[0]:it=K,o[Tc[k]]=it}const A=Uw(o),O=p.readOffset(i+u+l*x);return new Vw(o,A,O)}async requestIFD(i){if(this.ifdRequests[i])return this.ifdRequests[i];if(i===0)return this.ifdRequests[i]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[i];if(!this.ifdRequests[i-1])try{this.ifdRequests[i-1]=this.requestIFD(i-1)}catch(l){throw l instanceof gd?new gd(i):l}return this.ifdRequests[i]=(async()=>{const l=await this.ifdRequests[i-1];if(l.nextIFDByteOffset===0)throw new gd(i);return this.parseFileDirectoryAt(l.nextIFDByteOffset)})(),this.ifdRequests[i]}async getImage(i=0){const l=await this.requestIFD(i);return new _w(l.fileDirectory,l.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let i=0,l=!0;for(;l;)try{await this.requestIFD(i),++i}catch(u){if(u instanceof gd)l=!1;else throw u}return i}async getGhostValues(){const i=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const l="GDAL_STRUCTURAL_METADATA_SIZE=",u=l.length+100;let p=await this.getSlice(i,u);if(l===Al(p,hi.ASCII,l.length,i)){const m=Al(p,hi.ASCII,u,i).split(`
`)[0],o=Number(m.split("=")[1].split(" ")[0])+m.length;o>u&&(p=await this.getSlice(i,o));const P=Al(p,hi.ASCII,o,i);this.ghostValues={},P.split(`
`).filter(A=>A.length>0).map(A=>A.split("=")).forEach(([A,O])=>{this.ghostValues[A]=O})}return this.ghostValues}static async fromSource(i,l,u){const p=(await i.fetch([{offset:0,length:1024}],u))[0],x=new yw(p),m=x.getUint16(0,0);let o;if(m===18761)o=!0;else if(m===19789)o=!1;else throw new TypeError("Invalid byte order value.");const P=x.getUint16(2,o);let A;if(P===42)A=!1;else if(P===43){if(A=!0,x.getUint16(4,o)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const O=A?x.getUint64(8,o):x.getUint32(4,o);return new Jd(i,o,A,O,l)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function $w(a,i={},l){return Jd.fromSource(Nw(a,i),l)}async function Zw(a,i){return Jd.fromSource(jw(a),i)}var Pd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.0/LICENSE.txt
 */var Ww=Pd.exports,r0;function Hw(){return r0||(r0=1,function(a,i){(function(l,u){a.exports=u()})(Ww,function(){var l={},u={};function p(m,o,P){if(u[m]=P,m==="index"){var A="var sharedModule = {}; ("+u.shared+")(sharedModule); ("+u.worker+")(sharedModule);",O={};return u.shared(O),u.index(l,O),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([A],{type:"text/javascript"}))),l}}p("shared",["exports"],function(m){function o(n,e,s,h){return new(s||(s=Promise))(function(f,y){function v(E){try{S(h.next(E))}catch(C){y(C)}}function w(E){try{S(h.throw(E))}catch(C){y(C)}}function S(E){var C;E.done?f(E.value):(C=E.value,C instanceof s?C:new s(function(z){z(C)})).then(v,w)}S((h=h.apply(n,e||[])).next())})}function P(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var A,O;function D(){if(O)return A;function n(e,s){this.x=e,this.y=s}return O=1,A=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,s){return this.clone()._rotateAround(e,s)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var s=e.x-this.x,h=e.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,s){return Math.atan2(this.x*s-this.y*e,this.x*e+this.y*s)},_matMult:function(e){var s=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=s,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var s=Math.cos(e),h=Math.sin(e),f=h*this.x+s*this.y;return this.x=s*this.x-h*this.y,this.y=f,this},_rotateAround:function(e,s){var h=Math.cos(e),f=Math.sin(e),y=s.y+f*(this.x-s.x)+h*(this.y-s.y);return this.x=s.x+h*(this.x-s.x)-f*(this.y-s.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},A}typeof SuppressedError=="function"&&SuppressedError;var k,B,V=P(D()),K=function(){if(B)return k;function n(e,s,h,f){this.cx=3*e,this.bx=3*(h-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=h,this.p2y=f}return B=1,k=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var h=e,f=0;f<8;f++){var y=this.sampleCurveX(h)-e;if(Math.abs(y)<s)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=y/v}var w=0,S=1;for(h=e,f=0;f<20&&(y=this.sampleCurveX(h),!(Math.abs(y-e)<s));f++)e>y?w=h:S=h,h=.5*(S-w)+w;return h},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},k}(),it=P(K);let gt,ct;function Dt(){return gt==null&&(gt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),gt}function Ct(){if(ct==null&&(ct=!1,Dt())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let h=0;h<5*5;h++){const f=4*h;e.fillStyle=`rgb(${f},${f+1},${f+2})`,e.fillRect(h%5,Math.floor(h/5),1,1)}const s=e.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&s[h]!==h){ct=!0;break}}}return ct||!1}var zt=1e-6,ae=typeof Float32Array<"u"?Float32Array:Array;function ke(){var n=new ae(9);return ae!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function de(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Le(){var n=new ae(3);return ae!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Xe(n){return Math.hypot(n[0],n[1],n[2])}function ne(n,e,s){var h=new ae(3);return h[0]=n,h[1]=e,h[2]=s,h}function le(n,e,s){return n[0]=e[0]+s[0],n[1]=e[1]+s[1],n[2]=e[2]+s[2],n}function be(n,e,s){return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n}function qe(n,e,s){var h=e[0],f=e[1],y=e[2],v=s[0],w=s[1],S=s[2];return n[0]=f*S-y*w,n[1]=y*v-h*S,n[2]=h*w-f*v,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Ce,ui=Xe;function yi(n,e,s){var h=e[0],f=e[1],y=e[2],v=e[3];return n[0]=s[0]*h+s[4]*f+s[8]*y+s[12]*v,n[1]=s[1]*h+s[5]*f+s[9]*y+s[13]*v,n[2]=s[2]*h+s[6]*f+s[10]*y+s[14]*v,n[3]=s[3]*h+s[7]*f+s[11]*y+s[15]*v,n}function Ft(){var n=new ae(4);return ae!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function qt(n,e,s,h){var f=.5*Math.PI/180;e*=f,s*=f,h*=f;var y=Math.sin(e),v=Math.cos(e),w=Math.sin(s),S=Math.cos(s),E=Math.sin(h),C=Math.cos(h);return n[0]=y*S*C-v*w*E,n[1]=v*w*C+y*S*E,n[2]=v*S*E-y*w*C,n[3]=v*S*C+y*w*E,n}function Wt(){var n=new ae(2);return ae!=Float32Array&&(n[0]=0,n[1]=0),n}function Ut(n,e){var s=new ae(2);return s[0]=n,s[1]=e,s}Le(),Ce=new ae(4),ae!=Float32Array&&(Ce[0]=0,Ce[1]=0,Ce[2]=0,Ce[3]=0),Le(),ne(1,0,0),ne(0,1,0),Ft(),Ft(),ke(),Wt();const Et=8192;function Gt(n,e,s){return e*(Et/(n.tileSize*Math.pow(2,s-n.tileID.overscaledZ)))}function se(n,e){return(n%e+e)%e}function Se(n,e,s){return n*(1-s)+e*s}function Ee(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,s=e*n;return 4*(n<.5?s:3*(n-e)+s-.75)}function _e(n,e,s,h){const f=new it(n,e,s,h);return y=>f.solve(y)}const je=_e(.25,.1,.25,1);function ue(n,e,s){return Math.min(s,Math.max(e,n))}function De(n,e,s){const h=s-e,f=((n-e)%h+h)%h+e;return f===e?s:f}function Ve(n,...e){for(const s of e)for(const h in s)n[h]=s[h];return n}let ie=1;function Me(n,e,s){const h={};for(const f in n)h[f]=e.call(this,n[f],f,n);return h}function Ke(n,e,s){const h={};for(const f in n)e.call(this,n[f],f,n)&&(h[f]=n[f]);return h}function ii(n){return Array.isArray(n)?n.map(ii):typeof n=="object"&&n?Me(n,ii):n}const ee={};function he(n){ee[n]||(typeof console<"u"&&console.warn(n),ee[n]=!0)}function we(n,e,s){return(s.y-n.y)*(e.x-n.x)>(e.y-n.y)*(s.x-n.x)}function Ne(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let Be=null;function Oe(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ue(n,e,s,h,f){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const y=new VideoFrame(n,{timestamp:0});try{const v=y==null?void 0:y.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const w=v.startsWith("BGR"),S=new Uint8ClampedArray(h*f*4);if(yield y.copyTo(S,function(E,C,z,N,U){const q=4*Math.max(1,0),W=(Math.max(0,z)-z)*N*4+q,J=4*N,rt=Math.max(0,C),yt=Math.max(0,z);return{rect:{x:rt,y:yt,width:Math.min(E.width,C+N)-rt,height:Math.min(E.height,z+U)-yt},layout:[{offset:W,stride:J}]}}(n,e,s,h,f)),w)for(let E=0;E<S.length;E+=4){const C=S[E];S[E]=S[E+2],S[E+2]=C}return S}finally{y.close()}})}let di,gi;function Bi(n,e,s,h){return n.addEventListener(e,s,h),{unsubscribe:()=>{n.removeEventListener(e,s,h)}}}function Ye(n){return n*Math.PI/180}function _i(n){return n/Math.PI*180}const Si={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Je={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},fi="AbortError";function _t(){return new Error(fi)}const $={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function H(n){return $.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Y="global-dispatcher";class nt extends Error{constructor(e,s,h,f){super(`AJAXError: ${s} (${e}): ${h}`),this.status=e,this.statusText=s,this.url=h,this.body=f}}const mt=()=>Ne(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,vt=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const h=H(n.url);if(h)return h(n,e);if(Ne(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Y},e)}if(!(/^file:/.test(s=n.url)||/^file:/.test(mt())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(h,f){return o(this,void 0,void 0,function*(){const y=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:mt(),signal:f.signal});let v,w;h.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");try{v=yield fetch(y)}catch(E){throw new nt(0,E.message,h.url,new Blob)}if(!v.ok){const E=yield v.blob();throw new nt(v.status,v.statusText,h.url,E)}w=h.type==="arrayBuffer"||h.type==="image"?v.arrayBuffer():h.type==="json"?v.json():v.text();const S=yield w;if(f.signal.aborted)throw _t();return{data:S,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}})}(n,e);if(Ne(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Y},e)}var s;return function(h,f){return new Promise((y,v)=>{var w;const S=new XMLHttpRequest;S.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(S.responseType="arraybuffer");for(const E in h.headers)S.setRequestHeader(E,h.headers[E]);h.type==="json"&&(S.responseType="text",!((w=h.headers)===null||w===void 0)&&w.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=h.credentials==="include",S.onerror=()=>{v(new Error(S.statusText))},S.onload=()=>{if(!f.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let E=S.response;if(h.type==="json")try{E=JSON.parse(S.response)}catch(C){return void v(C)}y({data:E,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const E=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});v(new nt(S.status,S.statusText,h.url,E))}},f.signal.addEventListener("abort",()=>{S.abort(),v(_t())}),S.send(h.body)})}(n,e)};function St(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),s=window.location;return e.protocol===s.protocol&&e.host===s.host}function xt(n,e,s){s[n]&&s[n].indexOf(e)!==-1||(s[n]=s[n]||[],s[n].push(e))}function Lt(n,e,s){if(s&&s[n]){const h=s[n].indexOf(e);h!==-1&&s[n].splice(h,1)}}class Rt{constructor(e,s={}){Ve(this,s),this.type=e}}class wt extends Rt{constructor(e,s={}){super("error",Ve({error:e},s))}}class Nt{on(e,s){return this._listeners=this._listeners||{},xt(e,s,this._listeners),{unsubscribe:()=>{this.off(e,s)}}}off(e,s){return Lt(e,s,this._listeners),Lt(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},xt(e,s,this._oneTimeListeners),this):new Promise(h=>this.once(e,h))}fire(e,s){typeof e=="string"&&(e=new Rt(e,s||{}));const h=e.type;if(this.listens(h)){e.target=this;const f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of f)w.call(this,e);const y=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of y)Lt(h,w,this._oneTimeListeners),w.call(this,e);const v=this._eventedParent;v&&(Ve(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(e))}else e instanceof wt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var ft={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const re=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pe(n,e){const s={};for(const h in n)h!=="ref"&&(s[h]=n[h]);return re.forEach(h=>{h in e&&(s[h]=e[h])}),s}function oe(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let s=0;s<n.length;s++)if(!oe(n[s],e[s]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const s in n)if(!oe(n[s],e[s]))return!1;return!0}return n===e}function xe(n,e){n.push(e)}function ze(n,e,s){xe(s,{command:"addSource",args:[n,e[n]]})}function wi(n,e,s){xe(e,{command:"removeSource",args:[n]}),s[n]=!0}function mi(n,e,s,h){wi(n,s,h),ze(n,e,s)}function oi(n,e,s){let h;for(h in n[s])if(Object.prototype.hasOwnProperty.call(n[s],h)&&h!=="data"&&!oe(n[s][h],e[s][h]))return!1;for(h in e[s])if(Object.prototype.hasOwnProperty.call(e[s],h)&&h!=="data"&&!oe(n[s][h],e[s][h]))return!1;return!0}function Ae(n,e,s,h,f,y){n=n||{},e=e||{};for(const v in n)Object.prototype.hasOwnProperty.call(n,v)&&(oe(n[v],e[v])||s.push({command:y,args:[h,v,e[v],f]}));for(const v in e)Object.prototype.hasOwnProperty.call(e,v)&&!Object.prototype.hasOwnProperty.call(n,v)&&(oe(n[v],e[v])||s.push({command:y,args:[h,v,e[v],f]}))}function ei(n){return n.id}function Ji(n,e){return n[e.id]=e,n}class Xt{constructor(e,s,h,f){this.message=(e?`${e}: `:"")+h,f&&(this.identifier=f),s!=null&&s.__line__&&(this.line=s.__line__)}}function ir(n,...e){for(const s of e)for(const h in s)n[h]=s[h];return n}class ki extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class qr{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[h,f]of s)this.bindings[h]=f}concat(e){return new qr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ls={kind:"null"},Yt={kind:"number"},$e={kind:"string"},Ze={kind:"boolean"},ur={kind:"color"},Fs={kind:"projectionDefinition"},$r={kind:"object"},We={kind:"value"},Bs={kind:"collator"},Mn={kind:"formatted"},Qi={kind:"padding"},ka={kind:"colorArray"},Da={kind:"numberArray"},Ns={kind:"resolvedImage"},za={kind:"variableAnchorOffsetCollection"};function Jr(n,e){return{kind:"array",itemType:n,N:e}}function Ni(n){if(n.kind==="array"){const e=Ni(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Yc=[ls,Yt,$e,Ze,ur,Fs,Mn,$r,Jr(We),Qi,Da,ka,Ns,za];function La(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!La(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const s of Yc)if(!La(s,e))return null}}return`Expected ${Ni(n)} but found ${Ni(e)} instead.`}function zo(n,e){return e.some(s=>s.kind===n.kind)}function Sn(n,e){return e.some(s=>s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n)}function tn(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const Jc=.96422,Qc=.82521,tu=4/29,Un=6/29,eu=3*Un*Un,iu=Un*Un*Un,Oa=Math.PI/180,of=180/Math.PI;function ru(n){return(n%=360)<0&&(n+=360),n}function Vn([n,e,s,h]){let f,y;const v=sh((.2225045*(n=rh(n))+.7168786*(e=rh(e))+.0606169*(s=rh(s)))/1);n===e&&e===s?f=y=v:(f=sh((.4360747*n+.3850649*e+.1430804*s)/Jc),y=sh((.0139322*n+.0971045*e+.7141733*s)/Qc));const w=116*v-16;return[w<0?0:w,500*(f-v),200*(v-y),h]}function rh(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function sh(n){return n>iu?Math.pow(n,1/3):n/eu+tu}function su([n,e,s,h]){let f=(n+16)/116,y=isNaN(e)?f:f+e/500,v=isNaN(s)?f:f-s/200;return f=1*Oo(f),y=Jc*Oo(y),v=Qc*Oo(v),[Lo(3.1338561*y-1.6168667*f-.4906146*v),Lo(-.9787684*y+1.9161415*f+.033454*v),Lo(.0719453*y-.2289914*f+1.4052427*v),h]}function Lo(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Oo(n){return n>Un?n*n*n:eu*(n-tu)}const Is=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function ri(n,e){return Is(n,e)?n[e]:void 0}function Gs(n){return parseInt(n.padEnd(2,n),16)/255}function js(n,e){return Tn(e?n/100:n,0,1)}function Tn(n,e,s){return Math.min(Math.max(e,n),s)}function nh(n){return!n.some(Number.isNaN)}const ah={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function hs(n,e,s){return n+s*(e-n)}function Us(n,e,s){return n.map((h,f)=>hs(h,e[f],s))}class si{constructor(e,s,h,f=1,y=!0){this.r=e,this.g=s,this.b=h,this.a=f,y||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[e,s,h,f]))}static parse(e){if(e instanceof si)return e;if(typeof e!="string")return;const s=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=ri(ah,h);if(f){const[v,w,S]=f;return[v/255,w/255,S/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const v=h.length<6?1:2;let w=1;return[Gs(h.slice(w,w+=v)),Gs(h.slice(w,w+=v)),Gs(h.slice(w,w+=v)),Gs(h.slice(w,w+v)||"ff")]}if(h.startsWith("rgb")){const v=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,S,E,C,z,N,U,q,W,J,rt,yt]=v,lt=[C||" ",U||" ",J].join("");if(lt==="  "||lt==="  /"||lt===",,"||lt===",,,"){const j=[E,N,W].join(""),X=j==="%%%"?100:j===""?255:0;if(X){const ut=[Tn(+S/X,0,1),Tn(+z/X,0,1),Tn(+q/X,0,1),rt?js(+rt,yt):1];if(nh(ut))return ut}}return}}const y=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,w,S,E,C,z,N,U,q]=y,W=[S||" ",C||" ",N].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const J=[+w,Tn(+E,0,100),Tn(+z,0,100),U?js(+U,q):1];if(nh(J))return function([rt,yt,lt,j]){function X(ut){const Pt=(ut+rt/30)%12,jt=yt*Math.min(lt,1-lt);return lt-jt*Math.max(-1,Math.min(Pt-3,9-Pt,1))}return rt=ru(rt),yt/=100,lt/=100,[X(0),X(8),X(4),j]}(J)}}}(e);return s?new si(...s,!1):void 0}get rgb(){const{r:e,g:s,b:h,a:f}=this,y=f||1/0;return this.overwriteGetter("rgb",[e/y,s/y,h/y,f])}get hcl(){return this.overwriteGetter("hcl",function(e){const[s,h,f,y]=Vn(e),v=Math.sqrt(h*h+f*f);return[Math.round(1e4*v)?ru(Math.atan2(f,h)*of):NaN,v,s,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Vn(this.rgb))}overwriteGetter(e,s){return Object.defineProperty(this,e,{value:s}),s}toString(){const[e,s,h,f]=this.rgb;return`rgba(${[e,s,h].map(y=>Math.round(255*y)).join(",")},${f})`}static interpolate(e,s,h,f="rgb"){switch(f){case"rgb":{const[y,v,w,S]=Us(e.rgb,s.rgb,h);return new si(y,v,w,S,!1)}case"hcl":{const[y,v,w,S]=e.hcl,[E,C,z,N]=s.hcl;let U,q;if(isNaN(y)||isNaN(E))isNaN(y)?isNaN(E)?U=NaN:(U=E,w!==1&&w!==0||(q=C)):(U=y,z!==1&&z!==0||(q=v));else{let lt=E-y;E>y&&lt>180?lt-=360:E<y&&y-E>180&&(lt+=360),U=y+h*lt}const[W,J,rt,yt]=function([lt,j,X,ut]){return lt=isNaN(lt)?0:lt*Oa,su([X,Math.cos(lt)*j,Math.sin(lt)*j,ut])}([U,q??hs(v,C,h),hs(w,z,h),hs(S,N,h)]);return new si(W,J,rt,yt,!1)}case"lab":{const[y,v,w,S]=su(Us(e.lab,s.lab,h));return new si(y,v,w,S,!1)}}}}si.black=new si(0,0,0,1),si.white=new si(1,1,1,1),si.transparent=new si(0,0,0,0),si.red=new si(1,0,0,1);class Fa{constructor(e,s,h){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Fo=["bottom","center","top"];class oh{constructor(e,s,h,f,y,v){this.text=e,this.image=s,this.scale=h,this.fontStack=f,this.textColor=y,this.verticalAlign=v}}class Cr{constructor(e){this.sections=e}static fromString(e){return new Cr([new oh(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Cr?e:Cr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class rr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof rr)return e;if(typeof e=="number")return new rr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const s of e)if(typeof s!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new rr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,s,h){return new rr(Us(e.values,s.values,h))}}class Ar{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ar)return e;if(typeof e=="number")return new Ar([e]);if(Array.isArray(e)){for(const s of e)if(typeof s!="number")return;return new Ar(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,s,h){return new Ar(Us(e.values,s.values,h))}}class dr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof dr)return e;if(typeof e=="string"){const h=si.parse(e);return h?new dr([h]):void 0}if(!Array.isArray(e))return;const s=[];for(const h of e){if(typeof h!="string")return;const f=si.parse(h);if(!f)return;s.push(f)}return new dr(s)}toString(){return JSON.stringify(this.values)}static interpolate(e,s,h,f="rgb"){const y=[];if(e.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let v=0;v<e.values.length;v++)y.push(si.interpolate(e.values[v],s.values[v],h,f));return new dr(y)}}class Gi extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Bo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ci{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ci)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let s=0;s<e.length;s+=2){const h=e[s],f=e[s+1];if(typeof h!="string"||!Bo.has(h)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new ci(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,s,h){const f=e.values,y=s.values;if(f.length!==y.length)throw new Gi(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${s.toString()}`);const v=[];for(let w=0;w<f.length;w+=2){if(f[w]!==y[w])throw new Gi(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${y[w]}`);v.push(f[w]);const[S,E]=f[w+1],[C,z]=y[w+1];v.push([hs(S,C,h),hs(E,z,h)])}return new ci(v)}}class Zr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Zr({name:e,available:!1}):null}}class He{constructor(e,s,h){this.from=e,this.to=s,this.transition=h}static interpolate(e,s,h){return new He(e,s,h)}static parse(e){return e instanceof He?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new He(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new He(e.from,e.to,e.transition):typeof e=="string"?new He(e,e,1):void 0}}function Qe(n,e,s,h){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[n,e,s,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[n,e,s,h]:[n,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Pn(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof He||n instanceof si||n instanceof Fa||n instanceof Cr||n instanceof rr||n instanceof Ar||n instanceof dr||n instanceof ci||n instanceof Zr)return!0;if(Array.isArray(n)){for(const e of n)if(!Pn(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Pn(n[e]))return!1;return!0}return!1}function Fe(n){if(n===null)return ls;if(typeof n=="string")return $e;if(typeof n=="boolean")return Ze;if(typeof n=="number")return Yt;if(n instanceof si)return ur;if(n instanceof He)return Fs;if(n instanceof Fa)return Bs;if(n instanceof Cr)return Mn;if(n instanceof rr)return Qi;if(n instanceof Ar)return Da;if(n instanceof dr)return ka;if(n instanceof ci)return za;if(n instanceof Zr)return Ns;if(Array.isArray(n)){const e=n.length;let s;for(const h of n){const f=Fe(h);if(s){if(s===f)continue;s=We;break}s=f}return Jr(s||We,e)}return $r}function En(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof si||n instanceof He||n instanceof Cr||n instanceof rr||n instanceof Ar||n instanceof dr||n instanceof ci||n instanceof Zr?n.toString():JSON.stringify(n)}class zr{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(e.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Pn(e[1]))return s.error("invalid value");const h=e[1];let f=Fe(h);const y=s.expectedType;return f.kind!=="array"||f.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(f=y),new zr(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const qn={string:$e,number:Yt,boolean:Ze,object:$r};class cs{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let h,f=1;const y=e[0];if(y==="array"){let w,S;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in qn)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=qn[E],f++}else w=We;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);S=e[2],f++}h=Jr(w,S)}else{if(!qn[y])throw new Error(`Types doesn't contain name = ${y}`);h=qn[y]}const v=[];for(;f<e.length;f++){const w=s.parse(e[f],f,We);if(!w)return null;v.push(w)}return new cs(h,v)}evaluate(e){for(let s=0;s<this.args.length;s++){const h=this.args[s].evaluate(e);if(!La(this.type,Fe(h)))return h;if(s===this.args.length-1)throw new Gi(`Expected value to be of type ${Ni(this.type)}, but found ${Ni(Fe(h))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const lh={"to-boolean":Ze,"to-color":ur,"to-number":Yt,"to-string":$e};class Cs{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const h=e[0];if(!lh[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&e.length!==2)return s.error("Expected one argument.");const f=lh[h],y=[];for(let v=1;v<e.length;v++){const w=s.parse(e[v],v,We);if(!w)return null;y.push(w)}return new Cs(f,y)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let s,h;for(const f of this.args){if(s=f.evaluate(e),h=null,s instanceof si)return s;if(typeof s=="string"){const y=e.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(h=s.length<3||s.length>4?`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Qe(s[0],s[1],s[2],s[3]),!h))return new si(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Gi(h||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const h of this.args){s=h.evaluate(e);const f=rr.parse(s);if(f)return f}throw new Gi(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const h of this.args){s=h.evaluate(e);const f=Ar.parse(s);if(f)return f}throw new Gi(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const h of this.args){s=h.evaluate(e);const f=dr.parse(s);if(f)return f}throw new Gi(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const h of this.args){s=h.evaluate(e);const f=ci.parse(s);if(f)return f}throw new Gi(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const h of this.args){if(s=h.evaluate(e),s===null)return 0;const f=Number(s);if(!isNaN(f))return f}throw new Gi(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Cr.fromString(En(this.args[0].evaluate(e)));case"resolvedImage":return Zr.fromString(En(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return En(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const nu=["Unknown","Point","LineString","Polygon"];class au{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?nu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let s=this._parseColorCache.get(e);return s||(s=si.parse(e),this._parseColorCache.set(e,s)),s}}class Ba{constructor(e,s,h=[],f,y=new qr,v=[]){this.registry=e,this.path=h,this.key=h.map(w=>`[${w}]`).join(""),this.scope=y,this.errors=v,this.expectedType=f,this._isConstant=s}parse(e,s,h,f,y={}){return s?this.concat(s,h,f)._parse(e,y):this._parse(e,y)}_parse(e,s){function h(f,y,v){return v==="assert"?new cs(y,[f]):v==="coerce"?new Cs(y,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=e[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[f];if(y){let v=y.parse(e,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,S=v.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||S.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(S.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(S.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(S.kind)||w.kind==="colorArray"&&["value","string","array"].includes(S.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(S.kind))v=h(v,w,s.typeAnnotation||"coerce");else if(this.checkSubtype(w,S))return null}else v=h(v,w,s.typeAnnotation||"assert")}if(!(v instanceof zr)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const w=new au;try{v=new zr(v.type,v.evaluate(w))}catch(S){return this.error(S.message),null}}return v}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,h){const f=typeof e=="number"?this.path.concat(e):this.path,y=h?this.scope.concat(h):this.scope;return new Ba(this.registry,this._isConstant,f,s||null,y,this.errors)}error(e,...s){const h=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new ki(h,e))}checkSubtype(e,s){const h=La(e,s);return h&&this.error(h),h}}class Na{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const h=[];for(let y=1;y<e.length-1;y+=2){const v=e[y];if(typeof v!="string")return s.error(`Expected string, but found ${typeof v} instead.`,y);if(/[^a-zA-Z0-9_]/.test(v))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const w=s.parse(e[y+1],y+1);if(!w)return null;h.push([v,w])}const f=s.parse(e[e.length-1],e.length-1,s.expectedType,h);return f?new Na(h,f):null}outputDefined(){return this.result.outputDefined()}}class vs{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(e.length!==2||typeof e[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const h=e[1];return s.scope.has(h)?new vs(h,s.scope.get(h)):s.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class fr{constructor(e,s,h){this.type=e,this.index=s,this.input=h}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,Yt),f=s.parse(e[2],2,Jr(s.expectedType||We));return h&&f?new fr(f.type.itemType,h,f):null}evaluate(e){const s=this.index.evaluate(e),h=this.input.evaluate(e);if(s<0)throw new Gi(`Array index out of bounds: ${s} < 0.`);if(s>=h.length)throw new Gi(`Array index out of bounds: ${s} > ${h.length-1}.`);if(s!==Math.floor(s))throw new Gi(`Array index must be an integer, but found ${s} instead.`);return h[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class $n{constructor(e,s){this.type=Ze,this.needle=e,this.haystack=s}static parse(e,s){if(e.length!==3)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,We),f=s.parse(e[2],2,We);return h&&f?zo(h.type,[Ze,$e,Yt,ls,We])?new $n(h,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(h.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!h)return!1;if(!Sn(s,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(Fe(s))} instead.`);if(!Sn(h,["string","array"]))throw new Gi(`Expected second argument to be of type array or string, but found ${Ni(Fe(h))} instead.`);return h.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ga{constructor(e,s,h){this.type=Yt,this.needle=e,this.haystack=s,this.fromIndex=h}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,We),f=s.parse(e[2],2,We);if(!h||!f)return null;if(!zo(h.type,[Ze,$e,Yt,ls,We]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(h.type)} instead`);if(e.length===4){const y=s.parse(e[3],3,Yt);return y?new Ga(h,f,y):null}return new Ga(h,f)}evaluate(e){const s=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!Sn(s,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(Fe(s))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(e)),Sn(h,["string"])){const y=h.indexOf(s,f);return y===-1?-1:[...h.slice(0,y)].length}if(Sn(h,["array"]))return h.indexOf(s,f);throw new Gi(`Expected second argument to be of type array or string, but found ${Ni(Fe(h))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Zn{constructor(e,s,h,f,y,v){this.inputType=e,this.type=s,this.input=h,this.cases=f,this.outputs=y,this.otherwise=v}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let h,f;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);const y={},v=[];for(let E=2;E<e.length-1;E+=2){let C=e[E];const z=e[E+1];Array.isArray(C)||(C=[C]);const N=s.concat(E);if(C.length===0)return N.error("Expected at least one branch label.");for(const q of C){if(typeof q!="number"&&typeof q!="string")return N.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return N.error("Numeric branch labels must be integer values.");if(h){if(N.checkSubtype(h,Fe(q)))return null}else h=Fe(q);if(y[String(q)]!==void 0)return N.error("Branch labels must be unique.");y[String(q)]=v.length}const U=s.parse(z,E,f);if(!U)return null;f=f||U.type,v.push(U)}const w=s.parse(e[1],1,We);if(!w)return null;const S=s.parse(e[e.length-1],e.length-1,f);return S?w.type.kind!=="value"&&s.concat(1).checkSubtype(h,w.type)?null:new Zn(h,f,w,y,v,S):null}evaluate(e){const s=this.input.evaluate(e);return(Fe(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class sr{constructor(e,s,h){this.type=e,this.branches=s,this.otherwise=h}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const f=[];for(let v=1;v<e.length-1;v+=2){const w=s.parse(e[v],v,Ze);if(!w)return null;const S=s.parse(e[v+1],v+1,h);if(!S)return null;f.push([w,S]),h=h||S.type}const y=s.parse(e[e.length-1],e.length-1,h);if(!y)return null;if(!h)throw new Error("Can't infer output type");return new sr(h,f,y)}evaluate(e){for(const[s,h]of this.branches)if(s.evaluate(e))return h.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,h]of this.branches)e(s),e(h);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class ja{constructor(e,s,h,f){this.type=e,this.input=s,this.beginIndex=h,this.endIndex=f}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=s.parse(e[1],1,We),f=s.parse(e[2],2,Yt);if(!h||!f)return null;if(!zo(h.type,[Jr(We),$e,We]))return s.error(`Expected first argument to be of type array or string, but found ${Ni(h.type)} instead`);if(e.length===4){const y=s.parse(e[3],3,Yt);return y?new ja(h.type,h,f,y):null}return new ja(h.type,h,f)}evaluate(e){const s=this.input.evaluate(e),h=this.beginIndex.evaluate(e);let f;if(this.endIndex&&(f=this.endIndex.evaluate(e)),Sn(s,["string"]))return[...s].slice(h,f).join("");if(Sn(s,["array"]))return s.slice(h,f);throw new Gi(`Expected first argument to be of type array or string, but found ${Ni(Fe(s))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Wn(n,e){const s=n.length-1;let h,f,y=0,v=s,w=0;for(;y<=v;)if(w=Math.floor((y+v)/2),h=n[w],f=n[w+1],h<=e){if(w===s||e<f)return w;y=w+1}else{if(!(h>e))throw new Gi("Input is not a number.");v=w-1}return 0}class Hn{constructor(e,s,h){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[f,y]of h)this.labels.push(f),this.outputs.push(y)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const h=s.parse(e[1],1,Yt);if(!h)return null;const f=[];let y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(let v=1;v<e.length;v+=2){const w=v===1?-1/0:e[v],S=e[v+1],E=v,C=v+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const z=s.parse(S,C,y);if(!z)return null;y=y||z.type,f.push([w,z])}return new Hn(y,h,f)}evaluate(e){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(e);const f=this.input.evaluate(e);if(f<=s[0])return h[0].evaluate(e);const y=s.length;return f>=s[y-1]?h[y-1].evaluate(e):h[Wn(s,f)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function lf(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var en,Ua,hh=function(){if(Ua)return en;function n(e,s,h,f){this.cx=3*e,this.bx=3*(h-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=s,this.p2x=h,this.p2y=f}return Ua=1,en=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,s){if(s===void 0&&(s=1e-6),e<0)return 0;if(e>1)return 1;for(var h=e,f=0;f<8;f++){var y=this.sampleCurveX(h)-e;if(Math.abs(y)<s)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=y/v}var w=0,S=1;for(h=e,f=0;f<20&&(y=this.sampleCurveX(h),!(Math.abs(y-e)<s));f++)e>y?w=h:S=h,h=.5*(S-w)+w;return h},solve:function(e,s){return this.sampleCurveY(this.solveCurveX(e,s))}},en}(),hf=lf(hh);class Lr{constructor(e,s,h,f,y){this.type=e,this.operator=s,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(const[v,w]of y)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(e,s,h,f){let y=0;if(e.name==="exponential")y=Xn(s,e.base,h,f);else if(e.name==="linear")y=Xn(s,1,h,f);else if(e.name==="cubic-bezier"){const v=e.controlPoints;y=new hf(v[0],v[1],v[2],v[3]).solve(Xn(s,1,h,f))}return y}static parse(e,s){let[h,f,y,...v]=e;if(!Array.isArray(f)||f.length===0)return s.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const E=f[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if(f[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const E=f.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,Yt),!y)return null;const w=[];let S=null;h!=="interpolate-hcl"&&h!=="interpolate-lab"||s.expectedType==ka?s.expectedType&&s.expectedType.kind!=="value"&&(S=s.expectedType):S=ur;for(let E=0;E<v.length;E+=2){const C=v[E],z=v[E+1],N=E+3,U=E+4;if(typeof C!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(w.length&&w[w.length-1][0]>=C)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const q=s.parse(z,U,S);if(!q)return null;S=S||q.type,w.push([C,q])}return tn(S,Yt)||tn(S,Fs)||tn(S,ur)||tn(S,Qi)||tn(S,Da)||tn(S,ka)||tn(S,za)||tn(S,Jr(Yt))?new Lr(S,h,f,y,w):s.error(`Type ${Ni(S)} is not interpolatable.`)}evaluate(e){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(e);const f=this.input.evaluate(e);if(f<=s[0])return h[0].evaluate(e);const y=s.length;if(f>=s[y-1])return h[y-1].evaluate(e);const v=Wn(s,f),w=Lr.interpolationFactor(this.interpolation,f,s[v],s[v+1]),S=h[v].evaluate(e),E=h[v+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return hs(S,E,w);case"color":return si.interpolate(S,E,w);case"padding":return rr.interpolate(S,E,w);case"colorArray":return dr.interpolate(S,E,w);case"numberArray":return Ar.interpolate(S,E,w);case"variableAnchorOffsetCollection":return ci.interpolate(S,E,w);case"array":return Us(S,E,w);case"projectionDefinition":return He.interpolate(S,E,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return si.interpolate(S,E,w,"hcl");case"colorArray":return dr.interpolate(S,E,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return si.interpolate(S,E,w,"lab");case"colorArray":return dr.interpolate(S,E,w,"lab")}}}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Xn(n,e,s,h){const f=h-s,y=n-s;return f===0?0:e===1?y/f:(Math.pow(e,y)-1)/(Math.pow(e,f)-1)}const Qr={color:si.interpolate,number:hs,padding:rr.interpolate,numberArray:Ar.interpolate,colorArray:dr.interpolate,variableAnchorOffsetCollection:ci.interpolate,array:Us};class Wr{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let h=null;const f=s.expectedType;f&&f.kind!=="value"&&(h=f);const y=[];for(const w of e.slice(1)){const S=s.parse(w,1+y.length,h,void 0,{typeAnnotation:"omit"});if(!S)return null;h=h||S.type,y.push(S)}if(!h)throw new Error("No output type");const v=f&&y.some(w=>La(f,w.type));return new Wr(v?We:h,y)}evaluate(e){let s,h=null,f=0;for(const y of this.args)if(f++,h=y.evaluate(e),h&&h instanceof Zr&&!h.available&&(s||(s=h.name),h=null,f===this.args.length&&(h=s)),h!==null)break;return h}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function ch(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Va(n,e,s,h){return h.compare(e,s)===0}function Kn(n,e,s){const h=n!=="=="&&n!=="!=";return class Cy{constructor(y,v,w){this.type=Ze,this.lhs=y,this.rhs=v,this.collator=w,this.hasUntypedArgument=y.type.kind==="value"||v.type.kind==="value"}static parse(y,v){if(y.length!==3&&y.length!==4)return v.error("Expected two or three arguments.");const w=y[0];let S=v.parse(y[1],1,We);if(!S)return null;if(!ch(w,S.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${Ni(S.type)}'.`);let E=v.parse(y[2],2,We);if(!E)return null;if(!ch(w,E.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${Ni(E.type)}'.`);if(S.type.kind!==E.type.kind&&S.type.kind!=="value"&&E.type.kind!=="value")return v.error(`Cannot compare types '${Ni(S.type)}' and '${Ni(E.type)}'.`);h&&(S.type.kind==="value"&&E.type.kind!=="value"?S=new cs(E.type,[S]):S.type.kind!=="value"&&E.type.kind==="value"&&(E=new cs(S.type,[E])));let C=null;if(y.length===4){if(S.type.kind!=="string"&&E.type.kind!=="string"&&S.type.kind!=="value"&&E.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(C=v.parse(y[3],3,Bs),!C)return null}return new Cy(S,E,C)}evaluate(y){const v=this.lhs.evaluate(y),w=this.rhs.evaluate(y);if(h&&this.hasUntypedArgument){const S=Fe(v),E=Fe(w);if(S.kind!==E.kind||S.kind!=="string"&&S.kind!=="number")throw new Gi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${S.kind}, ${E.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const S=Fe(v),E=Fe(w);if(S.kind!=="string"||E.kind!=="string")return e(y,v,w)}return this.collator?s(y,v,w,this.collator.evaluate(y)):e(y,v,w)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const uh=Kn("==",function(n,e,s){return e===s},Va),cf=Kn("!=",function(n,e,s){return e!==s},function(n,e,s,h){return!Va(0,e,s,h)}),uf=Kn("<",function(n,e,s){return e<s},function(n,e,s,h){return h.compare(e,s)<0}),df=Kn(">",function(n,e,s){return e>s},function(n,e,s,h){return h.compare(e,s)>0}),ff=Kn("<=",function(n,e,s){return e<=s},function(n,e,s,h){return h.compare(e,s)<=0}),No=Kn(">=",function(n,e,s){return e>=s},function(n,e,s,h){return h.compare(e,s)>=0});class Go{constructor(e,s,h){this.type=Bs,this.locale=h,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(e.length!==2)return s.error("Expected one argument.");const h=e[1];if(typeof h!="object"||Array.isArray(h))return s.error("Collator options argument must be an object.");const f=s.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Ze);if(!f)return null;const y=s.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Ze);if(!y)return null;let v=null;return h.locale&&(v=s.parse(h.locale,1,$e),!v)?null:new Go(f,y,v)}evaluate(e){return new Fa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class jo{constructor(e,s,h,f,y){this.type=$e,this.number=e,this.locale=s,this.currency=h,this.minFractionDigits=f,this.maxFractionDigits=y}static parse(e,s){if(e.length!==3)return s.error("Expected two arguments.");const h=s.parse(e[1],1,Yt);if(!h)return null;const f=e[2];if(typeof f!="object"||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let y=null;if(f.locale&&(y=s.parse(f.locale,1,$e),!y))return null;let v=null;if(f.currency&&(v=s.parse(f.currency,1,$e),!v))return null;let w=null;if(f["min-fraction-digits"]&&(w=s.parse(f["min-fraction-digits"],1,Yt),!w))return null;let S=null;return f["max-fraction-digits"]&&(S=s.parse(f["max-fraction-digits"],1,Yt),!S)?null:new jo(h,y,v,w,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class qa{constructor(e){this.type=Mn,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const h=e[1];if(!Array.isArray(h)&&typeof h=="object")return s.error("First argument must be an image or text section.");const f=[];let y=!1;for(let v=1;v<=e.length-1;++v){const w=e[v];if(y&&typeof w=="object"&&!Array.isArray(w)){y=!1;let S=null;if(w["font-scale"]&&(S=s.parse(w["font-scale"],1,Yt),!S))return null;let E=null;if(w["text-font"]&&(E=s.parse(w["text-font"],1,Jr($e)),!E))return null;let C=null;if(w["text-color"]&&(C=s.parse(w["text-color"],1,ur),!C))return null;let z=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!Fo.includes(w["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(z=s.parse(w["vertical-align"],1,$e),!z)return null}const N=f[f.length-1];N.scale=S,N.font=E,N.textColor=C,N.verticalAlign=z}else{const S=s.parse(e[v],1,We);if(!S)return null;const E=S.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,f.push({content:S,scale:null,font:null,textColor:null,verticalAlign:null})}}return new qa(f)}evaluate(e){return new Cr(this.sections.map(s=>{const h=s.content.evaluate(e);return Fe(h)===Ns?new oh("",h,null,null,null,s.verticalAlign?s.verticalAlign.evaluate(e):null):new oh(En(h),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null,s.verticalAlign?s.verticalAlign.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor),s.verticalAlign&&e(s.verticalAlign)}outputDefined(){return!1}}class dh{constructor(e){this.type=Ns,this.input=e}static parse(e,s){if(e.length!==2)return s.error("Expected two arguments.");const h=s.parse(e[1],1,$e);return h?new dh(h):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),h=Zr.fromString(s);return h&&e.availableImages&&(h.available=e.availableImages.indexOf(s)>-1),h}eachChild(e){e(this.input)}outputDefined(){return!1}}class Uo{constructor(e){this.type=Yt,this.input=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const h=s.parse(e[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ni(h.type)} instead.`):new Uo(h):null}evaluate(e){const s=this.input.evaluate(e);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new Gi(`Expected value to be of type string or array, but found ${Ni(Fe(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const As=8192;function pf(n,e){const s=(180+n[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(s*f*As),Math.round(h*f*As)]}function fh(n,e){const s=Math.pow(2,e.z);return[(f=(n[0]/As+e.x)/s,360*f-180),(h=(n[1]/As+e.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,f}function $a(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Za(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function ou(n,e,s){const h=n[0]-e[0],f=n[1]-e[1],y=n[0]-s[0],v=n[1]-s[1];return h*v-y*f==0&&h*y<=0&&f*v<=0}function Wa(n,e,s,h){return(f=[h[0]-s[0],h[1]-s[1]])[0]*(y=[e[0]-n[0],e[1]-n[1]])[1]-f[1]*y[0]!=0&&!(!Vo(n,e,s,h)||!Vo(s,h,n,e));var f,y}function lu(n,e,s){for(const h of s)for(let f=0;f<h.length-1;++f)if(Wa(n,e,h[f],h[f+1]))return!0;return!1}function Yn(n,e,s=!1){let h=!1;for(const w of e)for(let S=0;S<w.length-1;S++){if(ou(n,w[S],w[S+1]))return s;(y=w[S])[1]>(f=n)[1]!=(v=w[S+1])[1]>f[1]&&f[0]<(v[0]-y[0])*(f[1]-y[1])/(v[1]-y[1])+y[0]&&(h=!h)}var f,y,v;return h}function mf(n,e){for(const s of e)if(Yn(n,s))return!0;return!1}function hu(n,e){for(const s of n)if(!Yn(s,e))return!1;for(let s=0;s<n.length-1;++s)if(lu(n[s],n[s+1],e))return!1;return!0}function gf(n,e){for(const s of e)if(hu(n,s))return!0;return!1}function Vo(n,e,s,h){const f=h[0]-s[0],y=h[1]-s[1],v=(n[0]-s[0])*y-f*(n[1]-s[1]),w=(e[0]-s[0])*y-f*(e[1]-s[1]);return v>0&&w<0||v<0&&w>0}function ph(n,e,s){const h=[];for(let f=0;f<n.length;f++){const y=[];for(let v=0;v<n[f].length;v++){const w=pf(n[f][v],s);$a(e,w),y.push(w)}h.push(y)}return h}function cu(n,e,s){const h=[];for(let f=0;f<n.length;f++){const y=ph(n[f],e,s);h.push(y)}return h}function uu(n,e,s,h){if(n[0]<s[0]||n[0]>s[2]){const f=.5*h;let y=n[0]-s[0]>f?-h:s[0]-n[0]>f?h:0;y===0&&(y=n[0]-s[2]>f?-h:s[2]-n[0]>f?h:0),n[0]+=y}$a(e,n)}function mh(n,e,s,h){const f=Math.pow(2,h.z)*As,y=[h.x*As,h.y*As],v=[];for(const w of n)for(const S of w){const E=[S.x+y[0],S.y+y[1]];uu(E,e,s,f),v.push(E)}return v}function gh(n,e,s,h){const f=Math.pow(2,h.z)*As,y=[h.x*As,h.y*As],v=[];for(const S of n){const E=[];for(const C of S){const z=[C.x+y[0],C.y+y[1]];$a(e,z),E.push(z)}v.push(E)}if(e[2]-e[0]<=f/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const S of v)for(const E of S)uu(E,e,s,f)}var w;return v}class In{constructor(e,s){this.type=Ze,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Pn(e[1])){const h=e[1];if(h.type==="FeatureCollection"){const f=[];for(const y of h.features){const{type:v,coordinates:w}=y.geometry;v==="Polygon"&&f.push(w),v==="MultiPolygon"&&f.push(...w)}if(f.length)return new In(h,{type:"MultiPolygon",coordinates:f})}else if(h.type==="Feature"){const f=h.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new In(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new In(h,h)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,h){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(h.type==="Polygon"){const w=ph(h.coordinates,y,v),S=mh(s.geometry(),f,y,v);if(!Za(f,y))return!1;for(const E of S)if(!Yn(E,w))return!1}if(h.type==="MultiPolygon"){const w=cu(h.coordinates,y,v),S=mh(s.geometry(),f,y,v);if(!Za(f,y))return!1;for(const E of S)if(!mf(E,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,h){const f=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=s.canonicalID();if(h.type==="Polygon"){const w=ph(h.coordinates,y,v),S=gh(s.geometry(),f,y,v);if(!Za(f,y))return!1;for(const E of S)if(!hu(E,w))return!1}if(h.type==="MultiPolygon"){const w=cu(h.coordinates,y,v),S=gh(s.geometry(),f,y,v);if(!Za(f,y))return!1;for(const E of S)if(!gf(E,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let du=class{constructor(n=[],e=(s,h)=>s<h?-1:s>h?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:s}=this,h=e[n];for(;n>0;){const f=n-1>>1,y=e[f];if(s(h,y)>=0)break;e[n]=y,n=f}e[n]=h}_down(n){const{data:e,compare:s}=this,h=this.length>>1,f=e[n];for(;n<h;){let y=1+(n<<1);const v=y+1;if(v<this.length&&s(e[v],e[y])<0&&(y=v),s(e[y],f)>=0)break;e[n]=e[y],n=y}e[n]=f}};function _h(n,e,s=0,h=n.length-1,f=_f){for(;h>s;){if(h-s>600){const S=h-s+1,E=e-s+1,C=Math.log(S),z=.5*Math.exp(2*C/3),N=.5*Math.sqrt(C*z*(S-z)/S)*(E-S/2<0?-1:1);_h(n,e,Math.max(s,Math.floor(e-E*z/S+N)),Math.min(h,Math.floor(e+(S-E)*z/S+N)),f)}const y=n[e];let v=s,w=h;for(Jn(n,s,e),f(n[h],y)>0&&Jn(n,s,h);v<w;){for(Jn(n,v,w),v++,w--;f(n[v],y)<0;)v++;for(;f(n[w],y)>0;)w--}f(n[s],y)===0?Jn(n,s,w):(w++,Jn(n,w,h)),w<=e&&(s=w+1),e<=w&&(h=w-1)}}function Jn(n,e,s){const h=n[e];n[e]=n[s],n[s]=h}function _f(n,e){return n<e?-1:n>e?1:0}function qo(n,e){if(n.length<=1)return[n];const s=[];let h,f;for(const y of n){const v=fu(y);v!==0&&(y.area=Math.abs(v),f===void 0&&(f=v<0),f===v<0?(h&&s.push(h),h=[y]):h.push(y))}if(h&&s.push(h),e>1)for(let y=0;y<s.length;y++)s[y].length<=e||(_h(s[y],e,1,s[y].length-1,yf),s[y]=s[y].slice(0,e));return s}function yf(n,e){return e.area-n.area}function fu(n){let e=0;for(let s,h,f=0,y=n.length,v=y-1;f<y;v=f++)s=n[f],h=n[v],e+=(h.x-s.x)*(s.y+h.y);return e}const pu=1/298.257223563,mu=pu*(2-pu),gu=Math.PI/180;class yh{constructor(e){const s=6378.137*gu*1e3,h=Math.cos(e*gu),f=1/(1-mu*(1-h*h)),y=Math.sqrt(f);this.kx=s*y*h,this.ky=s*y*f*(1-mu)}distance(e,s){const h=this.wrap(e[0]-s[0])*this.kx,f=(e[1]-s[1])*this.ky;return Math.sqrt(h*h+f*f)}pointOnLine(e,s){let h,f,y,v,w=1/0;for(let S=0;S<e.length-1;S++){let E=e[S][0],C=e[S][1],z=this.wrap(e[S+1][0]-E)*this.kx,N=(e[S+1][1]-C)*this.ky,U=0;z===0&&N===0||(U=(this.wrap(s[0]-E)*this.kx*z+(s[1]-C)*this.ky*N)/(z*z+N*N),U>1?(E=e[S+1][0],C=e[S+1][1]):U>0&&(E+=z/this.kx*U,C+=N/this.ky*U)),z=this.wrap(s[0]-E)*this.kx,N=(s[1]-C)*this.ky;const q=z*z+N*N;q<w&&(w=q,h=E,f=C,y=S,v=U)}return{point:[h,f],index:y,t:Math.max(0,Math.min(1,v))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function vi(n,e){return e[0]-n[0]}function $o(n){return n[1]-n[0]+1}function Vs(n,e){return n[1]>=n[0]&&n[1]<e}function vh(n,e){if(n[0]>n[1])return[null,null];const s=$o(n);if(e){if(s===2)return[n,null];const f=Math.floor(s/2);return[[n[0],n[0]+f],[n[0]+f,n[1]]]}if(s===1)return[n,null];const h=Math.floor(s/2)-1;return[[n[0],n[0]+h],[n[0]+h+1,n[1]]]}function xh(n,e){if(!Vs(e,n.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let h=e[0];h<=e[1];++h)$a(s,n[h]);return s}function bh(n){const e=[1/0,1/0,-1/0,-1/0];for(const s of n)for(const h of s)$a(e,h);return e}function _u(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function wh(n,e,s){if(!_u(n)||!_u(e))return NaN;let h=0,f=0;return n[2]<e[0]&&(h=e[0]-n[2]),n[0]>e[2]&&(h=n[0]-e[2]),n[1]>e[3]&&(f=n[1]-e[3]),n[3]<e[1]&&(f=e[1]-n[3]),s.distance([0,0],[h,f])}function Cn(n,e,s){const h=s.pointOnLine(e,n);return s.distance(n,h.point)}function Mh(n,e,s,h,f){const y=Math.min(Cn(n,[s,h],f),Cn(e,[s,h],f)),v=Math.min(Cn(s,[n,e],f),Cn(h,[n,e],f));return Math.min(y,v)}function vf(n,e,s,h,f){if(!Vs(e,n.length)||!Vs(h,s.length))return 1/0;let y=1/0;for(let v=e[0];v<e[1];++v){const w=n[v],S=n[v+1];for(let E=h[0];E<h[1];++E){const C=s[E],z=s[E+1];if(Wa(w,S,C,z))return 0;y=Math.min(y,Mh(w,S,C,z,f))}}return y}function xf(n,e,s,h,f){if(!Vs(e,n.length)||!Vs(h,s.length))return NaN;let y=1/0;for(let v=e[0];v<=e[1];++v)for(let w=h[0];w<=h[1];++w)if(y=Math.min(y,f.distance(n[v],s[w])),y===0)return y;return y}function bf(n,e,s){if(Yn(n,e,!0))return 0;let h=1/0;for(const f of e){const y=f[0],v=f[f.length-1];if(y!==v&&(h=Math.min(h,Cn(n,[v,y],s)),h===0))return h;const w=s.pointOnLine(f,n);if(h=Math.min(h,s.distance(n,w.point)),h===0)return h}return h}function wf(n,e,s,h){if(!Vs(e,n.length))return NaN;for(let y=e[0];y<=e[1];++y)if(Yn(n[y],s,!0))return 0;let f=1/0;for(let y=e[0];y<e[1];++y){const v=n[y],w=n[y+1];for(const S of s)for(let E=0,C=S.length,z=C-1;E<C;z=E++){const N=S[z],U=S[E];if(Wa(v,w,N,U))return 0;f=Math.min(f,Mh(v,w,N,U,h))}}return f}function yu(n,e){for(const s of n)for(const h of s)if(Yn(h,e,!0))return!0;return!1}function Mf(n,e,s,h=1/0){const f=bh(n),y=bh(e);if(h!==1/0&&wh(f,y,s)>=h)return h;if(Za(f,y)){if(yu(n,e))return 0}else if(yu(e,n))return 0;let v=1/0;for(const w of n)for(let S=0,E=w.length,C=E-1;S<E;C=S++){const z=w[C],N=w[S];for(const U of e)for(let q=0,W=U.length,J=W-1;q<W;J=q++){const rt=U[J],yt=U[q];if(Wa(z,N,rt,yt))return 0;v=Math.min(v,Mh(z,N,rt,yt,s))}}return v}function vu(n,e,s,h,f,y){if(!y)return;const v=wh(xh(h,y),f,s);v<e&&n.push([v,y,[0,0]])}function Zo(n,e,s,h,f,y,v){if(!y||!v)return;const w=wh(xh(h,y),xh(f,v),s);w<e&&n.push([w,y,v])}function Wo(n,e,s,h,f=1/0){let y=Math.min(h.distance(n[0],s[0][0]),f);if(y===0)return y;const v=new du([[0,[0,n.length-1],[0,0]]],vi),w=bh(s);for(;v.length>0;){const S=v.pop();if(S[0]>=y)continue;const E=S[1],C=e?50:100;if($o(E)<=C){if(!Vs(E,n.length))return NaN;if(e){const z=wf(n,E,s,h);if(isNaN(z)||z===0)return z;y=Math.min(y,z)}else for(let z=E[0];z<=E[1];++z){const N=bf(n[z],s,h);if(y=Math.min(y,N),y===0)return 0}}else{const z=vh(E,e);vu(v,y,h,n,w,z[0]),vu(v,y,h,n,w,z[1])}}return y}function Ho(n,e,s,h,f,y=1/0){let v=Math.min(y,f.distance(n[0],s[0]));if(v===0)return v;const w=new du([[0,[0,n.length-1],[0,s.length-1]]],vi);for(;w.length>0;){const S=w.pop();if(S[0]>=v)continue;const E=S[1],C=S[2],z=e?50:100,N=h?50:100;if($o(E)<=z&&$o(C)<=N){if(!Vs(E,n.length)&&Vs(C,s.length))return NaN;let U;if(e&&h)U=vf(n,E,s,C,f),v=Math.min(v,U);else if(e&&!h){const q=n.slice(E[0],E[1]+1);for(let W=C[0];W<=C[1];++W)if(U=Cn(s[W],q,f),v=Math.min(v,U),v===0)return v}else if(!e&&h){const q=s.slice(C[0],C[1]+1);for(let W=E[0];W<=E[1];++W)if(U=Cn(n[W],q,f),v=Math.min(v,U),v===0)return v}else U=xf(n,E,s,C,f),v=Math.min(v,U)}else{const U=vh(E,e),q=vh(C,h);Zo(w,v,f,n,s,U[0],q[0]),Zo(w,v,f,n,s,U[0],q[1]),Zo(w,v,f,n,s,U[1],q[0]),Zo(w,v,f,n,s,U[1],q[1])}}return v}function Sh(n){return n.type==="MultiPolygon"?n.coordinates.map(e=>({type:"Polygon",coordinates:e})):n.type==="MultiLineString"?n.coordinates.map(e=>({type:"LineString",coordinates:e})):n.type==="MultiPoint"?n.coordinates.map(e=>({type:"Point",coordinates:e})):[n]}class An{constructor(e,s){this.type=Yt,this.geojson=e,this.geometries=s}static parse(e,s){if(e.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Pn(e[1])){const h=e[1];if(h.type==="FeatureCollection")return new An(h,h.features.map(f=>Sh(f.geometry)).flat());if(h.type==="Feature")return new An(h,Sh(h.geometry));if("type"in h&&"coordinates"in h)return new An(h,Sh(h))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(s,h){const f=s.geometry(),y=f.flat().map(S=>fh([S.x,S.y],s.canonical));if(f.length===0)return NaN;const v=new yh(y[0][1]);let w=1/0;for(const S of h){switch(S.type){case"Point":w=Math.min(w,Ho(y,!1,[S.coordinates],!1,v,w));break;case"LineString":w=Math.min(w,Ho(y,!1,S.coordinates,!0,v,w));break;case"Polygon":w=Math.min(w,Wo(y,!1,S.coordinates,v,w))}if(w===0)return w}return w}(e,this.geometries);if(e.geometryType()==="LineString")return function(s,h){const f=s.geometry(),y=f.flat().map(S=>fh([S.x,S.y],s.canonical));if(f.length===0)return NaN;const v=new yh(y[0][1]);let w=1/0;for(const S of h){switch(S.type){case"Point":w=Math.min(w,Ho(y,!0,[S.coordinates],!1,v,w));break;case"LineString":w=Math.min(w,Ho(y,!0,S.coordinates,!0,v,w));break;case"Polygon":w=Math.min(w,Wo(y,!0,S.coordinates,v,w))}if(w===0)return w}return w}(e,this.geometries);if(e.geometryType()==="Polygon")return function(s,h){const f=s.geometry();if(f.length===0||f[0].length===0)return NaN;const y=qo(f,0).map(S=>S.map(E=>E.map(C=>fh([C.x,C.y],s.canonical)))),v=new yh(y[0][0][0][1]);let w=1/0;for(const S of h)for(const E of y){switch(S.type){case"Point":w=Math.min(w,Wo([S.coordinates],!1,E,v,w));break;case"LineString":w=Math.min(w,Wo(S.coordinates,!0,E,v,w));break;case"Polygon":w=Math.min(w,Mf(E,S.coordinates,v,w))}if(w===0)return w}return w}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ha{constructor(e){this.type=We,this.key=e}static parse(e,s){if(e.length!==2)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const h=e[1];return h==null?s.error("Global state property must be defined."):typeof h!="string"?s.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ha(h)}evaluate(e){var s;const h=(s=e.globals)===null||s===void 0?void 0:s.globalState;return h&&Object.keys(h).length!==0?ri(h,this.key):null}eachChild(){}outputDefined(){return!1}}const Qn={"==":uh,"!=":cf,">":df,"<":uf,">=":No,"<=":ff,array:cs,at:fr,boolean:cs,case:sr,coalesce:Wr,collator:Go,format:qa,image:dh,in:$n,"index-of":Ga,interpolate:Lr,"interpolate-hcl":Lr,"interpolate-lab":Lr,length:Uo,let:Na,literal:zr,match:Zn,number:cs,"number-format":jo,object:cs,slice:ja,step:Hn,string:cs,"to-boolean":Cs,"to-color":Cs,"to-number":Cs,"to-string":Cs,var:vs,within:In,distance:An,"global-state":Ha};class us{constructor(e,s,h,f){this.name=e,this.type=s,this._evaluate=h,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,s){const h=e[0],f=us.definitions[h];if(!f)return s.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(f)?f[0]:f.type,v=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=v.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let S=null;for(const[E,C]of w){S=new Ba(s.registry,Xo,s.path,null,s.scope);const z=[];let N=!1;for(let U=1;U<e.length;U++){const q=e[U],W=Array.isArray(E)?E[U-1]:E.type,J=S.parse(q,1+z.length,W);if(!J){N=!0;break}z.push(J)}if(!N)if(Array.isArray(E)&&E.length!==z.length)S.error(`Expected ${E.length} arguments, but found ${z.length} instead.`);else{for(let U=0;U<z.length;U++){const q=Array.isArray(E)?E[U]:E.type,W=z[U];S.concat(U+1).checkSubtype(q,W.type)}if(S.errors.length===0)return new us(h,y,C,z)}}if(w.length===1)s.errors.push(...S.errors);else{const E=(w.length?w:v).map(([z])=>{return N=z,Array.isArray(N)?`(${N.map(Ni).join(", ")})`:`(${Ni(N.type)}...)`;var N}).join(" | "),C=[];for(let z=1;z<e.length;z++){const N=s.parse(e[z],1+C.length);if(!N)return null;C.push(Ni(N.type))}s.error(`Expected arguments of type ${E}, but found (${C.join(", ")}) instead.`)}return null}static register(e,s){us.definitions=s;for(const h in s)e[h]=us}}function xu(n,[e,s,h,f]){e=e.evaluate(n),s=s.evaluate(n),h=h.evaluate(n);const y=f?f.evaluate(n):1,v=Qe(e,s,h,y);if(v)throw new Gi(v);return new si(e/255,s/255,h/255,y,!1)}function bu(n,e){return n in e}function Th(n,e){const s=e[n];return s===void 0?null:s}function Rn(n){return{type:n}}function Xo(n){if(n instanceof vs)return Xo(n.boundExpression);if(n instanceof us&&n.name==="error"||n instanceof Go||n instanceof In||n instanceof An||n instanceof Ha)return!1;const e=n instanceof Cs||n instanceof cs;let s=!0;return n.eachChild(h=>{s=e?s&&Xo(h):s&&h instanceof zr}),!!s&&Ko(n)&&ta(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ko(n){if(n instanceof us&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof In||n instanceof An)return!1;let e=!0;return n.eachChild(s=>{e&&!Ko(s)&&(e=!1)}),e}function Xa(n){if(n instanceof us&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(s=>{e&&!Xa(s)&&(e=!1)}),e}function ta(n,e){if(n instanceof us&&e.indexOf(n.name)>=0)return!1;let s=!0;return n.eachChild(h=>{s&&!ta(h,e)&&(s=!1)}),s}function wu(n){return{result:"success",value:n}}function ea(n){return{result:"error",value:n}}function ia(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Ph(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Eh(n){return!!n.expression&&n.expression.interpolated}function ni(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function kn(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Fe(n)===$r}function Mu(n){return n}function Su(n,e){const s=n.stops&&typeof n.stops[0][0]=="object",h=s||!(s||n.property!==void 0),f=n.type||(Eh(e)?"exponential":"interval"),y=function(C){switch(C.type){case"color":return si.parse;case"padding":return rr.parse;case"numberArray":return Ar.parse;case"colorArray":return dr.parse;default:return null}}(e);if(y&&((n=ir({},n)).stops&&(n.stops=n.stops.map(C=>[C[0],y(C[1])])),n.default=y(n.default?n.default:e.default)),n.colorSpace&&(v=n.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var v;const w=function(C){switch(C){case"exponential":return Tu;case"interval":return Tf;case"categorical":return Sf;case"identity":return Pu;default:throw new Error(`Unknown function type "${C}"`)}}(f);let S,E;if(f==="categorical"){S=Object.create(null);for(const C of n.stops)S[C[0]]=C[1];E=typeof n.stops[0][0]}if(s){const C={},z=[];for(let q=0;q<n.stops.length;q++){const W=n.stops[q],J=W[0].zoom;C[J]===void 0&&(C[J]={zoom:J,type:n.type,property:n.property,default:n.default,stops:[]},z.push(J)),C[J].stops.push([W[0].value,W[1]])}const N=[];for(const q of z)N.push([C[q].zoom,Su(C[q],e)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:Lr.interpolationFactor.bind(void 0,U),zoomStops:N.map(q=>q[0]),evaluate:({zoom:q},W)=>Tu({stops:N,base:n.base},e,q).evaluate(q,W)}}if(h){const C=f==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Lr.interpolationFactor.bind(void 0,C),zoomStops:n.stops.map(z=>z[0]),evaluate:({zoom:z})=>w(n,e,z,S,E)}}return{kind:"source",evaluate(C,z){const N=z&&z.properties?z.properties[n.property]:void 0;return N===void 0?Ka(n.default,e.default):w(n,e,N,S,E)}}}function Ka(n,e,s){return n!==void 0?n:e!==void 0?e:s!==void 0?s:void 0}function Sf(n,e,s,h,f){return Ka(typeof s===f?h[s]:void 0,n.default,e.default)}function Tf(n,e,s){if(ni(s)!=="number")return Ka(n.default,e.default);const h=n.stops.length;if(h===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[h-1][0])return n.stops[h-1][1];const f=Wn(n.stops.map(y=>y[0]),s);return n.stops[f][1]}function Tu(n,e,s){const h=n.base!==void 0?n.base:1;if(ni(s)!=="number")return Ka(n.default,e.default);const f=n.stops.length;if(f===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[f-1][0])return n.stops[f-1][1];const y=Wn(n.stops.map(C=>C[0]),s),v=function(C,z,N,U){const q=U-N,W=C-N;return q===0?0:z===1?W/q:(Math.pow(z,W)-1)/(Math.pow(z,q)-1)}(s,h,n.stops[y][0],n.stops[y+1][0]),w=n.stops[y][1],S=n.stops[y+1][1],E=Qr[e.type]||Mu;return typeof w.evaluate=="function"?{evaluate(...C){const z=w.evaluate.apply(void 0,C),N=S.evaluate.apply(void 0,C);if(z!==void 0&&N!==void 0)return E(z,N,v,n.colorSpace)}}:E(w,S,v,n.colorSpace)}function Pu(n,e,s){switch(e.type){case"color":s=si.parse(s);break;case"formatted":s=Cr.fromString(s.toString());break;case"resolvedImage":s=Zr.fromString(s.toString());break;case"padding":s=rr.parse(s);break;case"colorArray":s=dr.parse(s);break;case"numberArray":s=Ar.parse(s);break;default:ni(s)===e.type||e.type==="enum"&&e.values[s]||(s=void 0)}return Ka(s,n.default,e.default)}us.register(Qn,{error:[{kind:"error"},[$e],(n,[e])=>{throw new Gi(e.evaluate(n))}],typeof:[$e,[We],(n,[e])=>Ni(Fe(e.evaluate(n)))],"to-rgba":[Jr(Yt,4),[ur],(n,[e])=>{const[s,h,f,y]=e.evaluate(n).rgb;return[255*s,255*h,255*f,y]}],rgb:[ur,[Yt,Yt,Yt],xu],rgba:[ur,[Yt,Yt,Yt,Yt],xu],has:{type:Ze,overloads:[[[$e],(n,[e])=>bu(e.evaluate(n),n.properties())],[[$e,$r],(n,[e,s])=>bu(e.evaluate(n),s.evaluate(n))]]},get:{type:We,overloads:[[[$e],(n,[e])=>Th(e.evaluate(n),n.properties())],[[$e,$r],(n,[e,s])=>Th(e.evaluate(n),s.evaluate(n))]]},"feature-state":[We,[$e],(n,[e])=>Th(e.evaluate(n),n.featureState||{})],properties:[$r,[],n=>n.properties()],"geometry-type":[$e,[],n=>n.geometryType()],id:[We,[],n=>n.id()],zoom:[Yt,[],n=>n.globals.zoom],"heatmap-density":[Yt,[],n=>n.globals.heatmapDensity||0],elevation:[Yt,[],n=>n.globals.elevation||0],"line-progress":[Yt,[],n=>n.globals.lineProgress||0],accumulated:[We,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Yt,Rn(Yt),(n,e)=>{let s=0;for(const h of e)s+=h.evaluate(n);return s}],"*":[Yt,Rn(Yt),(n,e)=>{let s=1;for(const h of e)s*=h.evaluate(n);return s}],"-":{type:Yt,overloads:[[[Yt,Yt],(n,[e,s])=>e.evaluate(n)-s.evaluate(n)],[[Yt],(n,[e])=>-e.evaluate(n)]]},"/":[Yt,[Yt,Yt],(n,[e,s])=>e.evaluate(n)/s.evaluate(n)],"%":[Yt,[Yt,Yt],(n,[e,s])=>e.evaluate(n)%s.evaluate(n)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(n,[e,s])=>Math.pow(e.evaluate(n),s.evaluate(n))],sqrt:[Yt,[Yt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Yt,[Yt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Yt,[Yt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Yt,[Yt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Yt,[Yt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Yt,[Yt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Yt,[Yt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Yt,[Yt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Yt,[Yt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Yt,[Yt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Yt,Rn(Yt),(n,e)=>Math.min(...e.map(s=>s.evaluate(n)))],max:[Yt,Rn(Yt),(n,e)=>Math.max(...e.map(s=>s.evaluate(n)))],abs:[Yt,[Yt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Yt,[Yt],(n,[e])=>{const s=e.evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[Yt,[Yt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Yt,[Yt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Ze,[$e,We],(n,[e,s])=>n.properties()[e.value]===s.value],"filter-id-==":[Ze,[We],(n,[e])=>n.id()===e.value],"filter-type-==":[Ze,[$e],(n,[e])=>n.geometryType()===e.value],"filter-<":[Ze,[$e,We],(n,[e,s])=>{const h=n.properties()[e.value],f=s.value;return typeof h==typeof f&&h<f}],"filter-id-<":[Ze,[We],(n,[e])=>{const s=n.id(),h=e.value;return typeof s==typeof h&&s<h}],"filter->":[Ze,[$e,We],(n,[e,s])=>{const h=n.properties()[e.value],f=s.value;return typeof h==typeof f&&h>f}],"filter-id->":[Ze,[We],(n,[e])=>{const s=n.id(),h=e.value;return typeof s==typeof h&&s>h}],"filter-<=":[Ze,[$e,We],(n,[e,s])=>{const h=n.properties()[e.value],f=s.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[Ze,[We],(n,[e])=>{const s=n.id(),h=e.value;return typeof s==typeof h&&s<=h}],"filter->=":[Ze,[$e,We],(n,[e,s])=>{const h=n.properties()[e.value],f=s.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[Ze,[We],(n,[e])=>{const s=n.id(),h=e.value;return typeof s==typeof h&&s>=h}],"filter-has":[Ze,[We],(n,[e])=>e.value in n.properties()],"filter-has-id":[Ze,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ze,[Jr($e)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ze,[Jr(We)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Ze,[$e,Jr(We)],(n,[e,s])=>s.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Ze,[$e,Jr(We)],(n,[e,s])=>function(h,f,y,v){for(;y<=v;){const w=y+v>>1;if(f[w]===h)return!0;f[w]>h?v=w-1:y=w+1}return!1}(n.properties()[e.value],s.value,0,s.value.length-1)],all:{type:Ze,overloads:[[[Ze,Ze],(n,[e,s])=>e.evaluate(n)&&s.evaluate(n)],[Rn(Ze),(n,e)=>{for(const s of e)if(!s.evaluate(n))return!1;return!0}]]},any:{type:Ze,overloads:[[[Ze,Ze],(n,[e,s])=>e.evaluate(n)||s.evaluate(n)],[Rn(Ze),(n,e)=>{for(const s of e)if(s.evaluate(n))return!0;return!1}]]},"!":[Ze,[Ze],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Ze,[$e],(n,[e])=>{const s=n.globals&&n.globals.isSupportedScript;return!s||s(e.evaluate(n))}],upcase:[$e,[$e],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[$e,[$e],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[$e,Rn(We),(n,e)=>e.map(s=>En(s.evaluate(n))).join("")],"resolved-locale":[$e,[Bs],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Yo{constructor(e,s){this.expression=e,this._warningHistory={},this._evaluator=new au,this._defaultValue=s?function(h){if(h.type==="color"&&kn(h.default))return new si(0,0,0,0);switch(h.type){case"color":return si.parse(h.default)||null;case"padding":return rr.parse(h.default)||null;case"numberArray":return Ar.parse(h.default)||null;case"colorArray":return dr.parse(h.default)||null;case"variableAnchorOffsetCollection":return ci.parse(h.default)||null;case"projectionDefinition":return He.parse(h.default)||null;default:return h.default===void 0?null:h.default}}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(e,s,h,f,y,v){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=h,this._evaluator.canonical=f,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(e,s,h,f,y,v){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Gi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Jo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Qn}function Qo(n,e){const s=new Ba(Qn,Xo,[],e?function(f){const y={color:ur,string:$e,number:Yt,enum:$e,boolean:Ze,formatted:Mn,padding:Qi,numberArray:Da,colorArray:ka,projectionDefinition:Fs,resolvedImage:Ns,variableAnchorOffsetCollection:za};return f.type==="array"?Jr(y[f.value]||We,f.length):y[f.type]}(e):void 0),h=s.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?wu(new Yo(h,e)):ea(s.errors)}class Ya{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent=e!=="constant"&&!Xa(s.expression),this.globalStateRefs=sa(s.expression)}evaluateWithoutErrorHandling(e,s,h,f,y,v){return this._styleExpression.evaluateWithoutErrorHandling(e,s,h,f,y,v)}evaluate(e,s,h,f,y,v){return this._styleExpression.evaluate(e,s,h,f,y,v)}}class tl{constructor(e,s,h,f){this.kind=e,this.zoomStops=h,this._styleExpression=s,this.isStateDependent=e!=="camera"&&!Xa(s.expression),this.globalStateRefs=sa(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(e,s,h,f,y,v){return this._styleExpression.evaluateWithoutErrorHandling(e,s,h,f,y,v)}evaluate(e,s,h,f,y,v){return this._styleExpression.evaluate(e,s,h,f,y,v)}interpolationFactor(e,s,h){return this.interpolationType?Lr.interpolationFactor(this.interpolationType,e,s,h):0}}function Ih(n,e){const s=Qo(n,e);if(s.result==="error")return s;const h=s.value.expression,f=Ko(h);if(!f&&!ia(e))return ea([new ki("","data expressions not supported")]);const y=ta(h,["zoom"]);if(!y&&!Ph(e))return ea([new ki("","zoom expressions not supported")]);const v=ra(h);return v||y?v instanceof ki?ea([v]):v instanceof Lr&&!Eh(e)?ea([new ki("",'"interpolate" expressions cannot be used with this property')]):wu(v?new tl(f?"camera":"composite",s.value,v.labels,v instanceof Lr?v.interpolation:void 0):new Ya(f?"constant":"source",s.value)):ea([new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ja{constructor(e,s){this._parameters=e,this._specification=s,ir(this,Su(this._parameters,this._specification))}static deserialize(e){return new Ja(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ra(n){let e=null;if(n instanceof Na)e=ra(n.result);else if(n instanceof Wr){for(const s of n.args)if(e=ra(s),e)break}else(n instanceof Hn||n instanceof Lr)&&n.input instanceof us&&n.input.name==="zoom"&&(e=n);return e instanceof ki||n.eachChild(s=>{const h=ra(s);h instanceof ki?e=h:!e&&h?e=new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&h&&e!==h&&(e=new ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function sa(n,e=new Set){return n instanceof Ha&&e.add(n.key),n.eachChild(s=>{sa(s,e)}),e}function Qa(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Qa(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ch={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function rn(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Qa(n)||(n=el(n));const e=Qo(n,Ch);if(e.result==="error")throw new Error(e.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,h,f)=>e.value.evaluate(s,h,{},f),needGeometry:Eu(n),getGlobalStateRefs:()=>sa(e.value.expression)}}function Pf(n,e){return n<e?-1:n>e?1:0}function Eu(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Eu(n[e]))return!0;return!1}function el(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Ah(n[1],n[2],"=="):e==="!="?to(Ah(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ah(n[1],n[2],e):e==="any"?(s=n.slice(1),["any"].concat(s.map(el))):e==="all"?["all"].concat(n.slice(1).map(el)):e==="none"?["all"].concat(n.slice(1).map(el).map(to)):e==="in"?Iu(n[1],n.slice(2)):e==="!in"?to(Iu(n[1],n.slice(2))):e==="has"?Cu(n[1]):e!=="!has"||to(Cu(n[1]));var s}function Ah(n,e,s){switch(n){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,n,e]}}function Iu(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Pf)]]:["filter-in-small",n,["literal",e]]}}function Cu(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function to(n){return["!",n]}function il(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let f="[";for(const y of n)f+=`${il(y)},`;return`${f}]`}const s=Object.keys(n).sort();let h="{";for(let f=0;f<s.length;f++)h+=`${JSON.stringify(s[f])}:${il(n[s[f]])},`;return`${h}}`}function rl(n){let e="";for(const s of re)e+=`/${il(n[s])}`;return e}function Au(n){const e=n.value;return e?[new Xt(n.key,e,"constants have been deprecated as of v8")]:[]}function Zi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function sn(n){if(Array.isArray(n))return n.map(sn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const s in n)e[s]=sn(n[s]);return e}return Zi(n)}function ds(n){const e=n.key,s=n.value,h=n.valueSpec||{},f=n.objectElementValidators||{},y=n.style,v=n.styleSpec,w=n.validateSpec;let S=[];const E=ni(s);if(E!=="object")return[new Xt(e,s,`object expected, ${E} found`)];for(const C in s){const z=C.split(".")[0],N=ri(h,z)||h["*"];let U;if(ri(f,z))U=f[z];else if(ri(h,z))U=w;else if(f["*"])U=f["*"];else{if(!h["*"]){S.push(new Xt(e,s[C],`unknown property "${C}"`));continue}U=w}S=S.concat(U({key:(e&&`${e}.`)+C,value:s[C],valueSpec:N,style:y,styleSpec:v,object:s,objectKey:C,validateSpec:w},s))}for(const C in h)f[C]||h[C].required&&h[C].default===void 0&&s[C]===void 0&&S.push(new Xt(e,s,`missing required property "${C}"`));return S}function sl(n){const e=n.value,s=n.valueSpec,h=n.style,f=n.styleSpec,y=n.key,v=n.arrayElementValidator||n.validateSpec;if(ni(e)!=="array")return[new Xt(y,e,`array expected, ${ni(e)} found`)];if(s.length&&e.length!==s.length)return[new Xt(y,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new Xt(y,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let w={type:s.value,values:s.values};f.$version<7&&(w.function=s.function),ni(s.value)==="object"&&(w=s.value);let S=[];for(let E=0;E<e.length;E++)S=S.concat(v({array:e,arrayIndex:E,value:e[E],valueSpec:w,validateSpec:n.validateSpec,style:h,styleSpec:f,key:`${y}[${E}]`}));return S}function eo(n){const e=n.key,s=n.value,h=n.valueSpec;let f=ni(s);return f==="number"&&s!=s&&(f="NaN"),f!=="number"?[new Xt(e,s,`number expected, ${f} found`)]:"minimum"in h&&s<h.minimum?[new Xt(e,s,`${s} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&s>h.maximum?[new Xt(e,s,`${s} is greater than the maximum value ${h.maximum}`)]:[]}function na(n){const e=n.valueSpec,s=Zi(n.value.type);let h,f,y,v={};const w=s!=="categorical"&&n.value.property===void 0,S=!w,E=ni(n.value.stops)==="array"&&ni(n.value.stops[0])==="array"&&ni(n.value.stops[0][0])==="object",C=ds({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(U){if(s==="identity")return[new Xt(U.key,U.value,'identity function may not have a "stops" property')];let q=[];const W=U.value;return q=q.concat(sl({key:U.key,value:W,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:z})),ni(W)==="array"&&W.length===0&&q.push(new Xt(U.key,W,"array must have at least one stop")),q},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:e,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return s==="identity"&&w&&C.push(new Xt(n.key,n.value,'missing required property "property"')),s==="identity"||n.value.stops||C.push(new Xt(n.key,n.value,'missing required property "stops"')),s==="exponential"&&n.valueSpec.expression&&!Eh(n.valueSpec)&&C.push(new Xt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(S&&!ia(n.valueSpec)?C.push(new Xt(n.key,n.value,"property functions not supported")):w&&!Ph(n.valueSpec)&&C.push(new Xt(n.key,n.value,"zoom functions not supported"))),s!=="categorical"&&!E||n.value.property!==void 0||C.push(new Xt(n.key,n.value,'"property" property is required')),C;function z(U){let q=[];const W=U.value,J=U.key;if(ni(W)!=="array")return[new Xt(J,W,`array expected, ${ni(W)} found`)];if(W.length!==2)return[new Xt(J,W,`array length 2 expected, length ${W.length} found`)];if(E){if(ni(W[0])!=="object")return[new Xt(J,W,`object expected, ${ni(W[0])} found`)];if(W[0].zoom===void 0)return[new Xt(J,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new Xt(J,W,"object stop key must have value")];if(y&&y>Zi(W[0].zoom))return[new Xt(J,W[0].zoom,"stop zoom values must appear in ascending order")];Zi(W[0].zoom)!==y&&(y=Zi(W[0].zoom),f=void 0,v={}),q=q.concat(ds({key:`${J}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:eo,value:N}}))}else q=q.concat(N({key:`${J}[0]`,value:W[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},W));return Jo(sn(W[1]))?q.concat([new Xt(`${J}[1]`,W[1],"expressions are not allowed in function stops.")]):q.concat(U.validateSpec({key:`${J}[1]`,value:W[1],valueSpec:e,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function N(U,q){const W=ni(U.value),J=Zi(U.value),rt=U.value!==null?U.value:q;if(h){if(W!==h)return[new Xt(U.key,rt,`${W} stop domain type must match previous stop domain type ${h}`)]}else h=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new Xt(U.key,rt,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&s!=="categorical"){let yt=`number expected, ${W} found`;return ia(e)&&s===void 0&&(yt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Xt(U.key,rt,yt)]}return s!=="categorical"||W!=="number"||isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&W==="number"&&f!==void 0&&J<f?[new Xt(U.key,rt,"stop domain values must appear in ascending order")]:(f=J,s==="categorical"&&J in v?[new Xt(U.key,rt,"stop domain values must be unique")]:(v[J]=!0,[])):[new Xt(U.key,rt,`integer expected, found ${J}`)]}}function aa(n){const e=(n.expressionContext==="property"?Ih:Qo)(sn(n.value),n.valueSpec);if(e.result==="error")return e.value.map(h=>new Xt(`${n.key}${h.key}`,n.value,h.message));const s=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new Xt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Xa(s))return[new Xt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Xa(s))return[new Xt(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!ta(s,["zoom","feature-state"]))return[new Xt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ko(s))return[new Xt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Rh(n){const e=n.key,s=n.value,h=ni(s);return h!=="string"?[new Xt(e,s,`color expected, ${h} found`)]:si.parse(String(s))?[]:[new Xt(e,s,`color expected, "${s}" found`)]}function io(n){const e=n.key,s=n.value,h=n.valueSpec,f=[];return Array.isArray(h.values)?h.values.indexOf(Zi(s))===-1&&f.push(new Xt(e,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(Zi(s))===-1&&f.push(new Xt(e,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function kh(n){return Qa(sn(n.value))?aa(ir({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ru(n)}function Ru(n){const e=n.value,s=n.key;if(ni(e)!=="array")return[new Xt(s,e,`array expected, ${ni(e)} found`)];const h=n.styleSpec;let f,y=[];if(e.length<1)return[new Xt(s,e,"filter array must have at least 1 element")];switch(y=y.concat(io({key:`${s}[0]`,value:e[0],valueSpec:h.filter_operator,style:n.style,styleSpec:n.styleSpec})),Zi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Zi(e[1])==="$type"&&y.push(new Xt(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&y.push(new Xt(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=ni(e[1]),f!=="string"&&y.push(new Xt(`${s}[1]`,e[1],`string expected, ${f} found`)));for(let v=2;v<e.length;v++)f=ni(e[v]),Zi(e[1])==="$type"?y=y.concat(io({key:`${s}[${v}]`,value:e[v],valueSpec:h.geometry_type,style:n.style,styleSpec:n.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&y.push(new Xt(`${s}[${v}]`,e[v],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let v=1;v<e.length;v++)y=y.concat(Ru({key:`${s}[${v}]`,value:e[v],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":f=ni(e[1]),e.length!==2?y.push(new Xt(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="string"&&y.push(new Xt(`${s}[1]`,e[1],`string expected, ${f} found`))}return y}function ku(n,e){const s=n.key,h=n.validateSpec,f=n.style,y=n.styleSpec,v=n.value,w=n.objectKey,S=y[`${e}_${n.layerType}`];if(!S)return[];const E=w.match(/^(.*)-transition$/);if(e==="paint"&&E&&S[E[1]]&&S[E[1]].transition)return h({key:s,value:v,valueSpec:y.transition,style:f,styleSpec:y});const C=n.valueSpec||S[w];if(!C)return[new Xt(s,v,`unknown property "${w}"`)];let z;if(ni(v)==="string"&&ia(C)&&!C.tokens&&(z=/^{([^}]+)}$/.exec(v)))return[new Xt(s,v,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const N=[];return n.layerType==="symbol"&&(w==="text-field"&&f&&!f.glyphs&&N.push(new Xt(s,v,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&kn(sn(v))&&Zi(v.type)==="identity"&&N.push(new Xt(s,v,'"text-font" does not support identity functions'))),N.concat(h({key:n.key,value:v,valueSpec:C,style:f,styleSpec:y,expressionContext:"property",propertyType:e,propertyKey:w}))}function oa(n){return ku(n,"paint")}function la(n){return ku(n,"layout")}function Hr(n){let e=[];const s=n.value,h=n.key,f=n.style,y=n.styleSpec;if(ni(s)!=="object")return[new Xt(h,s,`object expected, ${ni(s)} found`)];s.type||s.ref||e.push(new Xt(h,s,'either "type" or "ref" is required'));let v=Zi(s.type);const w=Zi(s.ref);if(s.id){const S=Zi(s.id);for(let E=0;E<n.arrayIndex;E++){const C=f.layers[E];Zi(C.id)===S&&e.push(new Xt(h,s.id,`duplicate layer id "${s.id}", previously used at line ${C.id.__line__}`))}}if("ref"in s){let S;["type","source","source-layer","filter","layout"].forEach(E=>{E in s&&e.push(new Xt(h,s[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{Zi(E.id)===w&&(S=E)}),S?S.ref?e.push(new Xt(h,s.ref,"ref cannot reference another ref layer")):v=Zi(S.type):e.push(new Xt(h,s.ref,`ref layer "${w}" not found`))}else if(v!=="background")if(s.source){const S=f.sources&&f.sources[s.source],E=S&&Zi(S.type);S?E==="vector"&&v==="raster"?e.push(new Xt(h,s.source,`layer "${s.id}" requires a raster source`)):E!=="raster-dem"&&v==="hillshade"||E!=="raster-dem"&&v==="color-relief"?e.push(new Xt(h,s.source,`layer "${s.id}" requires a raster-dem source`)):E==="raster"&&v!=="raster"?e.push(new Xt(h,s.source,`layer "${s.id}" requires a vector source`)):E!=="vector"||s["source-layer"]?E==="raster-dem"&&v!=="hillshade"&&v!=="color-relief"?e.push(new Xt(h,s.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):v!=="line"||!s.paint||!s.paint["line-gradient"]||E==="geojson"&&S.lineMetrics||e.push(new Xt(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Xt(h,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new Xt(h,s.source,`source "${s.source}" not found`))}else e.push(new Xt(h,s,'missing required property "source"'));return e=e.concat(ds({key:h,value:s,valueSpec:y.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${h}.type`,value:s.type,valueSpec:y.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:s,objectKey:"type"}),filter:kh,layout:S=>ds({layer:s,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":E=>la(ir({layerType:v},E))}}),paint:S=>ds({layer:s,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":E=>oa(ir({layerType:v},E))}})}})),e}function xs(n){const e=n.value,s=n.key,h=ni(e);return h!=="string"?[new Xt(s,e,`string expected, ${h} found`)]:[]}const Dh={promoteId:function({key:n,value:e}){if(ni(e)==="string")return xs({key:n,value:e});{const s=[];for(const h in e)s.push(...xs({key:`${n}.${h}`,value:e[h]}));return s}}};function Du(n){const e=n.value,s=n.key,h=n.styleSpec,f=n.style,y=n.validateSpec;if(!e.type)return[new Xt(s,e,'"type" is required')];const v=Zi(e.type);let w;switch(v){case"vector":case"raster":return w=ds({key:s,value:e,valueSpec:h[`source_${v.replace("-","_")}`],style:n.style,styleSpec:h,objectElementValidators:Dh,validateSpec:y}),w;case"raster-dem":return w=function(S){var E;const C=(E=S.sourceName)!==null&&E!==void 0?E:"",z=S.value,N=S.styleSpec,U=N.source_raster_dem,q=S.style;let W=[];const J=ni(z);if(z===void 0)return W;if(J!=="object")return W.push(new Xt("source_raster_dem",z,`object expected, ${J} found`)),W;const rt=Zi(z.encoding)==="custom",yt=["redFactor","greenFactor","blueFactor","baseShift"],lt=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const j in z)!rt&&yt.includes(j)?W.push(new Xt(j,z[j],`In "${C}": "${j}" is only valid when "encoding" is set to "custom". ${lt} encoding found`)):U[j]?W=W.concat(S.validateSpec({key:j,value:z[j],valueSpec:U[j],validateSpec:S.validateSpec,style:q,styleSpec:N})):W.push(new Xt(j,z[j],`unknown property "${j}"`));return W}({sourceName:s,value:e,style:n.style,styleSpec:h,validateSpec:y}),w;case"geojson":if(w=ds({key:s,value:e,valueSpec:h.source_geojson,style:f,styleSpec:h,validateSpec:y,objectElementValidators:Dh}),e.cluster)for(const S in e.clusterProperties){const[E,C]=e.clusterProperties[S],z=typeof E=="string"?[E,["accumulated"],["get",S]]:E;w.push(...aa({key:`${s}.${S}.map`,value:C,expressionContext:"cluster-map"})),w.push(...aa({key:`${s}.${S}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return w;case"video":return ds({key:s,value:e,valueSpec:h.source_video,style:f,validateSpec:y,styleSpec:h});case"image":return ds({key:s,value:e,valueSpec:h.source_image,style:f,validateSpec:y,styleSpec:h});case"canvas":return[new Xt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return io({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function zu(n){const e=n.value,s=n.styleSpec,h=s.light,f=n.style;let y=[];const v=ni(e);if(e===void 0)return y;if(v!=="object")return y=y.concat([new Xt("light",e,`object expected, ${v} found`)]),y;for(const w in e){const S=w.match(/^(.*)-transition$/);y=y.concat(S&&h[S[1]]&&h[S[1]].transition?n.validateSpec({key:w,value:e[w],valueSpec:s.transition,validateSpec:n.validateSpec,style:f,styleSpec:s}):h[w]?n.validateSpec({key:w,value:e[w],valueSpec:h[w],validateSpec:n.validateSpec,style:f,styleSpec:s}):[new Xt(w,e[w],`unknown property "${w}"`)])}return y}function ha(n){const e=n.value,s=n.styleSpec,h=s.sky,f=n.style,y=ni(e);if(e===void 0)return[];if(y!=="object")return[new Xt("sky",e,`object expected, ${y} found`)];let v=[];for(const w in e)v=v.concat(h[w]?n.validateSpec({key:w,value:e[w],valueSpec:h[w],style:f,styleSpec:s}):[new Xt(w,e[w],`unknown property "${w}"`)]);return v}function zh(n){const e=n.value,s=n.styleSpec,h=s.terrain,f=n.style;let y=[];const v=ni(e);if(e===void 0)return y;if(v!=="object")return y=y.concat([new Xt("terrain",e,`object expected, ${v} found`)]),y;for(const w in e)y=y.concat(h[w]?n.validateSpec({key:w,value:e[w],valueSpec:h[w],validateSpec:n.validateSpec,style:f,styleSpec:s}):[new Xt(w,e[w],`unknown property "${w}"`)]);return y}function nl(n){let e=[];const s=n.value,h=n.key;if(Array.isArray(s)){const f=[],y=[];for(const v in s)s[v].id&&f.includes(s[v].id)&&e.push(new Xt(h,s,`all the sprites' ids must be unique, but ${s[v].id} is duplicated`)),f.push(s[v].id),s[v].url&&y.includes(s[v].url)&&e.push(new Xt(h,s,`all the sprites' URLs must be unique, but ${s[v].url} is duplicated`)),y.push(s[v].url),e=e.concat(ds({key:`${h}[${v}]`,value:s[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return xs({key:h,value:s})}function Lu(n){return e=n.value,e&&e.constructor===Object?[]:[new Xt(n.key,n.value,`object expected, ${ni(n.value)} found`)];var e}const al={"*":()=>[],array:sl,boolean:function(n){const e=n.value,s=n.key,h=ni(e);return h!=="boolean"?[new Xt(s,e,`boolean expected, ${h} found`)]:[]},number:eo,color:Rh,constants:Au,enum:io,filter:kh,function:na,layer:Hr,object:ds,source:Du,light:zu,sky:ha,terrain:zh,projection:function(n){const e=n.value,s=n.styleSpec,h=s.projection,f=n.style,y=ni(e);if(e===void 0)return[];if(y!=="object")return[new Xt("projection",e,`object expected, ${y} found`)];let v=[];for(const w in e)v=v.concat(h[w]?n.validateSpec({key:w,value:e[w],valueSpec:h[w],style:f,styleSpec:s}):[new Xt(w,e[w],`unknown property "${w}"`)]);return v},projectionDefinition:function(n){const e=n.key;let s=n.value;s=s instanceof String?s.valueOf():s;const h=ni(s);return h!=="array"||function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"}(s)||function(f){return!!["interpolate","step","literal"].includes(f[0])}(s)?["array","string"].includes(h)?[]:[new Xt(e,s,`projection expected, invalid type "${h}" found`)]:[new Xt(e,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]},string:xs,formatted:function(n){return xs(n).length===0?[]:aa(n)},resolvedImage:function(n){return xs(n).length===0?[]:aa(n)},padding:function(n){const e=n.key,s=n.value;if(ni(s)==="array"){if(s.length<1||s.length>4)return[new Xt(e,s,`padding requires 1 to 4 values; ${s.length} values found`)];const h={type:"number"};let f=[];for(let y=0;y<s.length;y++)f=f.concat(n.validateSpec({key:`${e}[${y}]`,value:s[y],validateSpec:n.validateSpec,valueSpec:h}));return f}return eo({key:e,value:s,valueSpec:{}})},numberArray:function(n){const e=n.key,s=n.value;if(ni(s)==="array"){const h={type:"number"};if(s.length<1)return[new Xt(e,s,"array length at least 1 expected, length 0 found")];let f=[];for(let y=0;y<s.length;y++)f=f.concat(n.validateSpec({key:`${e}[${y}]`,value:s[y],validateSpec:n.validateSpec,valueSpec:h}));return f}return eo({key:e,value:s,valueSpec:{}})},colorArray:function(n){const e=n.key,s=n.value;if(ni(s)==="array"){if(s.length<1)return[new Xt(e,s,"array length at least 1 expected, length 0 found")];let h=[];for(let f=0;f<s.length;f++)h=h.concat(Rh({key:`${e}[${f}]`,value:s[f]}));return h}return Rh({key:e,value:s})},variableAnchorOffsetCollection:function(n){const e=n.key,s=n.value,h=ni(s),f=n.styleSpec;if(h!=="array"||s.length<1||s.length%2!=0)return[new Xt(e,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let v=0;v<s.length;v+=2)y=y.concat(io({key:`${e}[${v}]`,value:s[v],valueSpec:f.layout_symbol["text-anchor"]})),y=y.concat(sl({key:`${e}[${v+1}]`,value:s[v+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:f}));return y},sprite:nl,state:Lu};function ll(n){const e=n.value,s=n.valueSpec,h=n.styleSpec;return n.validateSpec=ll,s.expression&&kn(Zi(e))?na(n):s.expression&&Jo(sn(e))?aa(n):s.type&&al[s.type]?al[s.type](n):ds(ir({},n,{valueSpec:s.type?h[s.type]:s}))}function ca(n){const e=n.value,s=n.key,h=xs(n);return h.length||(e.indexOf("{fontstack}")===-1&&h.push(new Xt(s,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&h.push(new Xt(s,e,'"glyphs" url must include a "{range}" token'))),h}function fs(n,e=ft){let s=[];return s=s.concat(ll({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:ll,objectElementValidators:{glyphs:ca,"*":()=>[]}})),n.constants&&(s=s.concat(Au({key:"constants",value:n.constants}))),Ou(s)}function bs(n){return function(e){return n({...e,validateSpec:ll})}}function Ou(n){return[].concat(n).sort((e,s)=>e.line-s.line)}function Or(n){return function(...e){return Ou(n.apply(this,e))}}fs.source=Or(bs(Du)),fs.sprite=Or(bs(nl)),fs.glyphs=Or(bs(ca)),fs.light=Or(bs(zu)),fs.sky=Or(bs(ha)),fs.terrain=Or(bs(zh)),fs.state=Or(bs(Lu)),fs.layer=Or(bs(Hr)),fs.filter=Or(bs(kh)),fs.paintProperty=Or(bs(oa)),fs.layoutProperty=Or(bs(la));const ua=fs,Ef=ua.light,hl=ua.sky,If=ua.paintProperty,Lh=ua.layoutProperty;function ro(n,e){let s=!1;if(e&&e.length)for(const h of e)n.fire(new wt(new Error(h.message))),s=!0;return s}class da{constructor(e,s,h){const f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(s=v[1])+2*(h=v[2]);for(let S=0;S<this.d*this.d;S++){const E=v[3+S],C=v[3+S+1];f.push(E===C?null:v.subarray(E,C))}const w=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],w),this.bboxes=v.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*h;for(let v=0;v<this.d*this.d;v++)f.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=e,this.padding=h,this.scale=s/e,this.uid=0;const y=h/s*e;this.min=-y,this.max=e+y}insert(e,s,h,f,y){this._forEachCell(s,h,f,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,s,h,f,y,v){this.cells[y].push(v)}query(e,s,h,f,y){const v=this.min,w=this.max;if(e<=v&&s<=v&&w<=h&&w<=f&&!y)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,s,h,f,this._queryCell,S,{},y),S}}_queryCell(e,s,h,f,y,v,w,S){const E=this.cells[y];if(E!==null){const C=this.keys,z=this.bboxes;for(let N=0;N<E.length;N++){const U=E[N];if(w[U]===void 0){const q=4*U;(S?S(z[q+0],z[q+1],z[q+2],z[q+3]):e<=z[q+2]&&s<=z[q+3]&&h>=z[q+0]&&f>=z[q+1])?(w[U]=!0,v.push(C[U])):w[U]=!1}}}}_forEachCell(e,s,h,f,y,v,w,S){const E=this._convertToCellCoord(e),C=this._convertToCellCoord(s),z=this._convertToCellCoord(h),N=this._convertToCellCoord(f);for(let U=E;U<=z;U++)for(let q=C;q<=N;q++){const W=this.d*q+U;if((!S||S(this._convertFromCellCoord(U),this._convertFromCellCoord(q),this._convertFromCellCoord(U+1),this._convertFromCellCoord(q+1)))&&y.call(this,e,s,h,f,W,v,w,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,s=3+this.cells.length+1+1;let h=0;for(let v=0;v<this.cells.length;v++)h+=this.cells[v].length;const f=new Int32Array(s+h+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let y=s;for(let v=0;v<e.length;v++){const w=e[v];f[3+v]=y,f.set(w,y),y+=w.length}return f[3+e.length]=y,f.set(this.keys,y),y+=this.keys.length,f[3+e.length+1]=y,f.set(this.bboxes,y),y+=this.bboxes.length,f.buffer}static serialize(e,s){const h=e.toArrayBuffer();return s&&s.push(h),{buffer:h}}static deserialize(e){return new da(e.buffer)}}const Rs={};function ce(n,e,s={}){if(Rs[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),Rs[n]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}ce("Object",Object),ce("Set",Set),ce("TransferableGridIndex",da),ce("Color",si),ce("Error",Error),ce("AJAXError",nt),ce("ResolvedImage",Zr),ce("StylePropertyFunction",Ja),ce("StyleExpression",Yo,{omit:["_evaluator"]}),ce("ZoomDependentExpression",tl),ce("ZoomConstantExpression",Ya),ce("CompoundExpression",us,{omit:["_evaluate"]});for(const n in Qn)Qn[n]._classRegistryKey||ce(`Expression_${n}`,Qn[n]);function Oh(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function so(n){return n.$name||n.constructor._classRegistryKey}function Fh(n){return!function(e){if(e===null||typeof e!="object")return!1;const s=so(e);return!(!s||s==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Oh(n)||Oe(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function no(n,e){if(Fh(n))return(Oh(n)||Oe(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const y=[];for(const v of n)y.push(no(v,e));return y}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const s=so(n);if(!s)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Rs[s])throw new Error(`${s} is not registered.`);const{klass:h}=Rs[s],f=h.serialize?h.serialize(n,e):{};if(h.serialize){if(e&&f===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in n){if(!n.hasOwnProperty(y)||Rs[s].omit.indexOf(y)>=0)continue;const v=n[y];f[y]=Rs[s].shallow.indexOf(y)>=0?v:no(v,e)}n instanceof Error&&(f.message=n.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(f.$name=s),f}function fa(n){if(Fh(n))return n;if(Array.isArray(n))return n.map(fa);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=so(n)||"Object";if(!Rs[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:s}=Rs[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(n);const h=Object.create(s.prototype);for(const f of Object.keys(n)){if(f==="$name")continue;const y=n[f];h[f]=Rs[e].shallow.indexOf(f)>=0?y:fa(y)}return h}class Bh{constructor(){this.first=!0}update(e,s){const h=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=h,!0))}}const ai={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Nh(n){for(const e of n)if(ul(e.charCodeAt(0)))return!0;return!1}function Fu(n){for(const e of n)if(!Af(e.charCodeAt(0)))return!1;return!0}function cl(n){const e=n.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(e.join("|"),"u")}const Cf=cl(["Arab","Dupl","Mong","Ougr","Syrc"]);function Af(n){return!Cf.test(String.fromCodePoint(n))}const Gh=cl(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ul(n){return!(n!==746&&n!==747&&(n<4352||!(ai["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||ai["CJK Compatibility"](n)||ai["CJK Strokes"](n)||!(!ai["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||ai["Enclosed CJK Letters and Months"](n)||ai["Ideographic Description Characters"](n)||ai.Kanbun(n)||ai.Katakana(n)&&n!==12540||!(!ai["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!ai["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||ai["Vertical Forms"](n)||ai["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Gh.test(String.fromCodePoint(n)))))}function jh(n){return!(ul(n)||function(e){return!!(ai["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ai["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ai["Letterlike Symbols"](e)||ai["Number Forms"](e)||ai["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ai["Control Pictures"](e)&&e!==9251||ai["Optical Character Recognition"](e)||ai["Enclosed Alphanumerics"](e)||ai["Geometric Shapes"](e)||ai["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ai["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ai["CJK Symbols and Punctuation"](e)||ai.Katakana(e)||ai["Private Use Area"](e)||ai["CJK Compatibility Forms"](e)||ai["Small Form Variants"](e)||ai["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}const Bu=cl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ao(n){return Bu.test(String.fromCodePoint(n))}function Rf(n,e){return!(!e&&ao(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||ai.Khmer(n))}function Uh(n){for(const e of n)if(ao(e.charCodeAt(0)))return!0;return!1}const nn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(nn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const s=n.pluginURL,h=new Promise(y=>{this.loadScriptResolve=y});e(s);const f=new Promise(y=>setTimeout(()=>y(),this.TIMEOUT));if(yield Promise.race([h,f]),this.isParsed()){const y={pluginStatus:"loaded",pluginURL:s};return this.setState(y),y}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${s}`)})}};class Oi{constructor(e,s){this.zoom=e,s?(this.now=s.now||0,this.fadeDuration=s.fadeDuration||0,this.zoomHistory=s.zoomHistory||new Bh,this.transition=s.transition||{},this.globalState=s.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bh,this.transition={},this.globalState={})}isSupportedScript(e){return function(s,h){for(const f of s)if(!Rf(f.charCodeAt(0),h))return!1;return!0}(e,nn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),h=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*s}}}class oo{constructor(e,s){this.property=e,this.value=s,this.expression=function(h,f){if(kn(h))return new Ja(h,f);if(Jo(h)){const y=Ih(h,f);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));return y.value}{let y=h;return f.type==="color"&&typeof h=="string"?y=si.parse(h):f.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?f.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?f.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?y=ci.parse(h):f.type==="projectionDefinition"&&typeof h=="string"&&(y=He.parse(h)):y=dr.parse(h):y=Ar.parse(h):y=rr.parse(h),{globalStateRefs:new Set,kind:"constant",evaluate:()=>y}}}(s===void 0?e.specification.default:s,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,s,h){return this.property.possiblyEvaluate(this,e,s,h)}}class dl{constructor(e){this.property=e,this.value=new oo(e,void 0)}transitioned(e,s){return new Nu(this.property,this.value,s,Ve({},e.transition,this.transition),e.now)}untransitioned(){return new Nu(this.property,this.value,null,{},0)}}class Vh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ii(this._values[e].value.value)}setValue(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new dl(this._values[e].property)),this._values[e].value=new oo(this._values[e].property,s===null?void 0:ii(s))}getTransition(e){return ii(this._values[e].transition)}setTransition(e,s){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new dl(this._values[e].property)),this._values[e].transition=ii(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(e[s]=h);const f=this.getTransition(s);f!==void 0&&(e[`${s}-transition`]=f)}return e}transitioned(e,s){const h=new Gu(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(e,s._values[f]);return h}untransitioned(){const e=new Gu(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class Nu{constructor(e,s,h,f,y){this.property=e,this.value=s,this.begin=y+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(e,s,h){const f=e.now||0,y=this.value.possiblyEvaluate(e,s,h),v=this.prior;if(v){if(f>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(f<this.begin)return v.possiblyEvaluate(e,s,h);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(e,s,h),y,Ee(w))}}return y}}class Gu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,h){const f=new fl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(e,s,h);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class kf{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return ii(this._values[e].value)}setValue(e,s){this._values[e]=new oo(this._values[e].property,s===null?void 0:ii(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(e[s]=h)}return e}possiblyEvaluate(e,s,h){const f=new fl(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].possiblyEvaluate(e,s,h);return f}}class ks{constructor(e,s,h){this.property=e,this.value=s,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,s,h,f){return this.property.evaluate(this.value,this.parameters,e,s,h,f)}}class fl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ge{constructor(e){this.specification=e}possiblyEvaluate(e,s){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(s)}interpolate(e,s,h){const f=Qr[this.specification.type];return f?f(e,s,h):e}}class Re{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,h,f){return new ks(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(s,null,{},h,f)}:e.expression,s)}interpolate(e,s,h){if(e.value.kind!=="constant"||s.value.kind!=="constant")return e;if(e.value.value===void 0||s.value.value===void 0)return new ks(this,{kind:"constant",value:void 0},e.parameters);const f=Qr[this.specification.type];if(f){const y=f(e.value.value,s.value.value,h);return new ks(this,{kind:"constant",value:y},e.parameters)}return e}evaluate(e,s,h,f,y,v){return e.kind==="constant"?e.value:e.evaluate(s,h,f,y,v)}}class pl extends Re{possiblyEvaluate(e,s,h,f){if(e.value===void 0)return new ks(this,{kind:"constant",value:void 0},s);if(e.expression.kind==="constant"){const y=e.expression.evaluate(s,null,{},h,f),v=e.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,w=this._calculate(v,v,v,s);return new ks(this,{kind:"constant",value:w},s)}if(e.expression.kind==="camera"){const y=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new ks(this,{kind:"constant",value:y},s)}return new ks(this,e.expression,s)}evaluate(e,s,h,f,y,v){if(e.kind==="source"){const w=e.evaluate(s,h,f,y,v);return this._calculate(w,w,w,s)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},h,f),e.evaluate({zoom:Math.floor(s.zoom)},h,f),e.evaluate({zoom:Math.floor(s.zoom)+1},h,f),s):e.value}_calculate(e,s,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:h,to:s}}interpolate(e){return e}}class qh{constructor(e){this.specification=e}possiblyEvaluate(e,s,h,f){if(e.value!==void 0){if(e.expression.kind==="constant"){const y=e.expression.evaluate(s,null,{},h,f);return this._calculate(y,y,y,s)}return this._calculate(e.expression.evaluate(new Oi(Math.floor(s.zoom-1),s)),e.expression.evaluate(new Oi(Math.floor(s.zoom),s)),e.expression.evaluate(new Oi(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:h,to:s}}interpolate(e){return e}}class lo{constructor(e){this.specification=e}possiblyEvaluate(e,s,h,f){return!!e.expression.evaluate(s,null,{},h,f)}interpolate(){return!1}}class Fr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new oo(h,void 0),y=this.defaultTransitionablePropertyValues[s]=new dl(h);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate({})}}}ce("DataDrivenProperty",Re),ce("DataConstantProperty",ge),ce("CrossFadedDataDrivenProperty",pl),ce("CrossFadedProperty",qh),ce("ColorRampProperty",lo);const ju="-transition";class br extends Nt{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=rn(e.filter)),s.layout&&(this._unevaluatedLayout=new kf(s.layout)),s.paint)){this._transitionablePaint=new Vh(s.paint);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fl(s.paint)}}setFilter(e){this.filter=e,this._featureFilter=rn(e)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const s in this._unevaluatedLayout._values){const h=this._unevaluatedLayout._values[s];for(const f of h.getGlobalStateRefs())e.add(f)}for(const s of this._featureFilter.getGlobalStateRefs())e.add(s);return e}setLayoutProperty(e,s,h={}){s!=null&&this._validate(Lh,`layers.${this.id}.layout.${e}`,e,s,h)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return e.endsWith(ju)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,h={}){if(s!=null&&this._validate(If,`layers.${this.id}.paint.${e}`,e,s,h))return!1;if(e.endsWith(ju))return this._transitionablePaint.setTransition(e.slice(0,-11),s||void 0),!1;{const f=this._transitionablePaint._values[e],y=f.property.specification["property-type"]==="cross-faded-data-driven",v=f.value.isDataDriven(),w=f.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||v||y||this._handleOverridablePaintPropertyUpdate(e,w,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,s,h){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ke(e,(s,h)=>!(s===void 0||h==="layout"&&!Object.keys(s).length||h==="paint"&&!Object.keys(s).length))}_validate(e,s,h,f,y={}){return(!y||y.validate!==!1)&&ro(this,e.call(ua,{key:s,layerType:this.type,objectKey:h,value:f,styleSpec:ft,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof ks&&ia(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const Uu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Dn{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ji{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wi(n,e=1){let s=0,h=0;return{members:n.map(f=>{const y=Uu[f.type].BYTES_PER_ELEMENT,v=s=Vu(s,Math.max(e,y)),w=f.components||1;return h=Math.max(h,y),s+=y*w,{name:f.name,type:f.type,components:w,offset:v}}),size:Vu(s,Math.max(h,e)),alignment:e}}function Vu(n,e){return Math.ceil(n/e)*e}class an extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const f=2*e;return this.int16[f+0]=s,this.int16[f+1]=h,e}}an.prototype.bytesPerElement=4,ce("StructArrayLayout2i4",an);class on extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=3*e;return this.int16[y+0]=s,this.int16[y+1]=h,this.int16[y+2]=f,e}}on.prototype.bytesPerElement=6,ce("StructArrayLayout3i6",on);class $h extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,h,f)}emplace(e,s,h,f,y){const v=4*e;return this.int16[v+0]=s,this.int16[v+1]=h,this.int16[v+2]=f,this.int16[v+3]=y,e}}$h.prototype.bytesPerElement=8,ce("StructArrayLayout4i8",$h);class ml extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,h,f,y,v)}emplace(e,s,h,f,y,v,w){const S=6*e;return this.int16[S+0]=s,this.int16[S+1]=h,this.int16[S+2]=f,this.int16[S+3]=y,this.int16[S+4]=v,this.int16[S+5]=w,e}}ml.prototype.bytesPerElement=12,ce("StructArrayLayout2i4i12",ml);class zn extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,h,f,y,v)}emplace(e,s,h,f,y,v,w){const S=4*e,E=8*e;return this.int16[S+0]=s,this.int16[S+1]=h,this.uint8[E+4]=f,this.uint8[E+5]=y,this.uint8[E+6]=v,this.uint8[E+7]=w,e}}zn.prototype.bytesPerElement=8,ce("StructArrayLayout2i4ub8",zn);class ho extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const f=2*e;return this.float32[f+0]=s,this.float32[f+1]=h,e}}ho.prototype.bytesPerElement=8,ce("StructArrayLayout2f8",ho);class Zh extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E,C){const z=this.length;return this.resize(z+1),this.emplace(z,e,s,h,f,y,v,w,S,E,C)}emplace(e,s,h,f,y,v,w,S,E,C,z){const N=10*e;return this.uint16[N+0]=s,this.uint16[N+1]=h,this.uint16[N+2]=f,this.uint16[N+3]=y,this.uint16[N+4]=v,this.uint16[N+5]=w,this.uint16[N+6]=S,this.uint16[N+7]=E,this.uint16[N+8]=C,this.uint16[N+9]=z,e}}Zh.prototype.bytesPerElement=20,ce("StructArrayLayout10ui20",Zh);class gl extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E,C,z,N){const U=this.length;return this.resize(U+1),this.emplace(U,e,s,h,f,y,v,w,S,E,C,z,N)}emplace(e,s,h,f,y,v,w,S,E,C,z,N,U){const q=12*e;return this.int16[q+0]=s,this.int16[q+1]=h,this.int16[q+2]=f,this.int16[q+3]=y,this.uint16[q+4]=v,this.uint16[q+5]=w,this.uint16[q+6]=S,this.uint16[q+7]=E,this.int16[q+8]=C,this.int16[q+9]=z,this.int16[q+10]=N,this.int16[q+11]=U,e}}gl.prototype.bytesPerElement=24,ce("StructArrayLayout4i4ui4i24",gl);class Wh extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=3*e;return this.float32[y+0]=s,this.float32[y+1]=h,this.float32[y+2]=f,e}}Wh.prototype.bytesPerElement=12,ce("StructArrayLayout3f12",Wh);class g extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}g.prototype.bytesPerElement=4,ce("StructArrayLayout1ul4",g);class t extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,s,h,f,y,v,w,S,E)}emplace(e,s,h,f,y,v,w,S,E,C){const z=10*e,N=5*e;return this.int16[z+0]=s,this.int16[z+1]=h,this.int16[z+2]=f,this.int16[z+3]=y,this.int16[z+4]=v,this.int16[z+5]=w,this.uint32[N+3]=S,this.uint16[z+8]=E,this.uint16[z+9]=C,e}}t.prototype.bytesPerElement=20,ce("StructArrayLayout6i1ul2ui20",t);class r extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,h,f,y,v)}emplace(e,s,h,f,y,v,w){const S=6*e;return this.int16[S+0]=s,this.int16[S+1]=h,this.int16[S+2]=f,this.int16[S+3]=y,this.int16[S+4]=v,this.int16[S+5]=w,e}}r.prototype.bytesPerElement=12,ce("StructArrayLayout2i2i2i12",r);class c extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,s,h,f,y)}emplace(e,s,h,f,y,v){const w=4*e,S=8*e;return this.float32[w+0]=s,this.float32[w+1]=h,this.float32[w+2]=f,this.int16[S+6]=y,this.int16[S+7]=v,e}}c.prototype.bytesPerElement=16,ce("StructArrayLayout2f1f2i16",c);class d extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,h,f,y,v)}emplace(e,s,h,f,y,v,w){const S=16*e,E=4*e,C=8*e;return this.uint8[S+0]=s,this.uint8[S+1]=h,this.float32[E+1]=f,this.float32[E+2]=y,this.int16[C+6]=v,this.int16[C+7]=w,e}}d.prototype.bytesPerElement=16,ce("StructArrayLayout2ub2f2i16",d);class _ extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=3*e;return this.uint16[y+0]=s,this.uint16[y+1]=h,this.uint16[y+2]=f,e}}_.prototype.bytesPerElement=6,ce("StructArrayLayout3ui6",_);class b extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E,C,z,N,U,q,W,J,rt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,e,s,h,f,y,v,w,S,E,C,z,N,U,q,W,J,rt)}emplace(e,s,h,f,y,v,w,S,E,C,z,N,U,q,W,J,rt,yt){const lt=24*e,j=12*e,X=48*e;return this.int16[lt+0]=s,this.int16[lt+1]=h,this.uint16[lt+2]=f,this.uint16[lt+3]=y,this.uint32[j+2]=v,this.uint32[j+3]=w,this.uint32[j+4]=S,this.uint16[lt+10]=E,this.uint16[lt+11]=C,this.uint16[lt+12]=z,this.float32[j+7]=N,this.float32[j+8]=U,this.uint8[X+36]=q,this.uint8[X+37]=W,this.uint8[X+38]=J,this.uint32[j+10]=rt,this.int16[lt+22]=yt,e}}b.prototype.bytesPerElement=48,ce("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",b);class M extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,f,y,v,w,S,E,C,z,N,U,q,W,J,rt,yt,lt,j,X,ut,Pt,jt,kt,Ot,Ht,$t){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,e,s,h,f,y,v,w,S,E,C,z,N,U,q,W,J,rt,yt,lt,j,X,ut,Pt,jt,kt,Ot,Ht,$t)}emplace(e,s,h,f,y,v,w,S,E,C,z,N,U,q,W,J,rt,yt,lt,j,X,ut,Pt,jt,kt,Ot,Ht,$t,Kt){const Bt=32*e,me=16*e;return this.int16[Bt+0]=s,this.int16[Bt+1]=h,this.int16[Bt+2]=f,this.int16[Bt+3]=y,this.int16[Bt+4]=v,this.int16[Bt+5]=w,this.int16[Bt+6]=S,this.int16[Bt+7]=E,this.uint16[Bt+8]=C,this.uint16[Bt+9]=z,this.uint16[Bt+10]=N,this.uint16[Bt+11]=U,this.uint16[Bt+12]=q,this.uint16[Bt+13]=W,this.uint16[Bt+14]=J,this.uint16[Bt+15]=rt,this.uint16[Bt+16]=yt,this.uint16[Bt+17]=lt,this.uint16[Bt+18]=j,this.uint16[Bt+19]=X,this.uint16[Bt+20]=ut,this.uint16[Bt+21]=Pt,this.uint16[Bt+22]=jt,this.uint32[me+12]=kt,this.float32[me+13]=Ot,this.float32[me+14]=Ht,this.uint16[Bt+30]=$t,this.uint16[Bt+31]=Kt,e}}M.prototype.bytesPerElement=64,ce("StructArrayLayout8i15ui1ul2f2ui64",M);class T extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}T.prototype.bytesPerElement=4,ce("StructArrayLayout1f4",T);class I extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=3*e;return this.uint16[6*e+0]=s,this.float32[y+1]=h,this.float32[y+2]=f,e}}I.prototype.bytesPerElement=12,ce("StructArrayLayout1ui2f12",I);class R extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,s,h)}emplace(e,s,h,f){const y=4*e;return this.uint32[2*e+0]=s,this.uint16[y+2]=h,this.uint16[y+3]=f,e}}R.prototype.bytesPerElement=8,ce("StructArrayLayout1ul2ui8",R);class F extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,s)}emplace(e,s,h){const f=2*e;return this.uint16[f+0]=s,this.uint16[f+1]=h,e}}F.prototype.bytesPerElement=4,ce("StructArrayLayout2ui4",F);class L extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}L.prototype.bytesPerElement=2,ce("StructArrayLayout1ui2",L);class G extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,s,h,f)}emplace(e,s,h,f,y){const v=4*e;return this.float32[v+0]=s,this.float32[v+1]=h,this.float32[v+2]=f,this.float32[v+3]=y,e}}G.prototype.bytesPerElement=16,ce("StructArrayLayout4f16",G);class Z extends Dn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new V(this.anchorPointX,this.anchorPointY)}}Z.prototype.size=20;class tt extends t{get(e){return new Z(this,e)}}ce("CollisionBoxArray",tt);class Q extends Dn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Q.prototype.size=48;class et extends b{get(e){return new Q(this,e)}}ce("PlacedSymbolArray",et);class st extends Dn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}st.prototype.size=64;class ht extends M{get(e){return new st(this,e)}}ce("SymbolInstanceArray",ht);class at extends T{getoffsetX(e){return this.float32[1*e+0]}}ce("GlyphOffsetArray",at);class dt extends on{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ce("SymbolLineVertexArray",dt);class pt extends Dn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}pt.prototype.size=12;class ot extends I{get(e){return new pt(this,e)}}ce("TextAnchorOffsetArray",ot);class bt extends Dn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}bt.prototype.size=8;class It extends R{get(e){return new bt(this,e)}}ce("FeatureIndexArray",It);class Mt extends an{}class Tt extends an{}class At extends an{}class te extends ml{}class Jt extends zn{}class Vt extends ho{}class pe extends Zh{}class ti extends gl{}class xi extends Wh{}class Ui extends g{}class Ti extends r{}class Vi extends d{}class Ii extends _{}class Pi extends F{}const Ci=Wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:wr}=Ci;class pi{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,s,h,f){const y=this.segments[this.segments.length-1];return e>pi.MAX_VERTEX_ARRAY_LENGTH&&he(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${pi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!y||y.vertexLength+e>pi.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==f?this.createNewSegment(s,h,f):y}createNewSegment(e,s,h){const f={vertexOffset:e.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0,vaos:{}};return h!==void 0&&(f.sortKey=h),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(e,s,h){return this.prepareSegment(0,e,s,h)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,h,f){return new pi([{vertexOffset:e,primitiveOffset:s,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}function pr(n,e){return 256*(n=ue(Math.floor(n),0,255))+ue(Math.floor(e),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ce("SegmentVector",pi);const Mr=Wi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ln,hn,cn,Ds={exports:{}},co={exports:{}},uo={exports:{}},pa=function(){if(cn)return Ds.exports;cn=1;var n=(ln||(ln=1,co.exports=function(s,h){var f,y,v,w,S,E,C,z;for(y=s.length-(f=3&s.length),v=h,S=3432918353,E=461845907,z=0;z<y;)C=255&s.charCodeAt(z)|(255&s.charCodeAt(++z))<<8|(255&s.charCodeAt(++z))<<16|(255&s.charCodeAt(++z))<<24,++z,v=27492+(65535&(w=5*(65535&(v=(v^=C=(65535&(C=(C=(65535&C)*S+(((C>>>16)*S&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(C=0,f){case 3:C^=(255&s.charCodeAt(z+2))<<16;case 2:C^=(255&s.charCodeAt(z+1))<<8;case 1:v^=C=(65535&(C=(C=(65535&(C^=255&s.charCodeAt(z)))*S+(((C>>>16)*S&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295}return v^=s.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),co.exports),e=(hn||(hn=1,uo.exports=function(s,h){for(var f,y=s.length,v=h^y,w=0;y>=4;)f=1540483477*(65535&(f=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(f>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),y-=4,++w;switch(y){case 3:v^=(255&s.charCodeAt(w+2))<<16;case 2:v^=(255&s.charCodeAt(w+1))<<8;case 1:v=1540483477*(65535&(v^=255&s.charCodeAt(w)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),uo.exports);return Ds.exports=n,Ds.exports.murmur3=n,Ds.exports.murmur2=e,Ds.exports}(),Xr=P(pa);class ws{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,h,f){this.ids.push(un(e)),this.positions.push(s,h,f)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=un(e);let h=0,f=this.ids.length-1;for(;h<f;){const v=h+f>>1;this.ids[v]>=s?f=v:h=v+1}const y=[];for(;this.ids[h]===s;)y.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return y}static serialize(e,s){const h=new Float64Array(e.ids),f=new Uint32Array(e.positions);return Ln(h,f,0,h.length-1),s&&s.push(h.buffer,f.buffer),{ids:h,positions:f}}static deserialize(e){const s=new ws;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function un(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Xr(String(n))}function Ln(n,e,s,h){for(;s<h;){const f=n[s+h>>1];let y=s-1,v=h+1;for(;;){do y++;while(n[y]<f);do v--;while(n[v]>f);if(y>=v)break;Ki(n,y,v),Ki(e,3*y,3*v),Ki(e,3*y+1,3*v+1),Ki(e,3*y+2,3*v+2)}v-s<h-v?(Ln(n,e,s,v),s=v+1):(Ln(n,e,v+1,h),h=v)}}function Ki(n,e,s){const h=n[e];n[e]=n[s],n[s]=h}ce("FeaturePositionMap",ws);class zi{constructor(e,s){this.gl=e.gl,this.location=s}}class Br extends zi{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class or extends zi{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class qu extends zi{constructor(e,s){super(e,s),this.current=si.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Df=new Float32Array(16);function Hh(n){return[pr(255*n.r,255*n.g),pr(255*n.b,255*n.a)]}class fo{constructor(e,s,h){this.value=e,this.uniformNames=s.map(f=>`u_${f}`),this.type=h}setUniform(e,s,h){e.set(h.constantOr(this.value))}getBinding(e,s,h){return this.type==="color"?new qu(e,s):new Br(e,s)}}class ma{constructor(e,s){this.uniformNames=s.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=e.tlbr}setUniform(e,s,h,f){const y=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&e.set(y)}getBinding(e,s,h){return h.substr(0,9)==="u_pattern"?new or(e,s):new Br(e,s)}}class qs{constructor(e,s,h,f){this.expression=e,this.type=h,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,s,h,f,y){const v=this.paintVertexArray.length,w=this.expression.evaluate(new Oi(0),s,{},f,[],y);this.paintVertexArray.resize(e),this._setPaintValue(v,e,w)}updatePaintArray(e,s,h,f){const y=this.expression.evaluate({zoom:0},h,f);this._setPaintValue(e,s,y)}_setPaintValue(e,s,h){if(this.type==="color"){const f=Hh(h);for(let y=e;y<s;y++)this.paintVertexArray.emplace(y,f[0],f[1])}else{for(let f=e;f<s;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sr{constructor(e,s,h,f,y,v){this.expression=e,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=h,this.useIntegerZoom=f,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(e,s,h,f,y){const v=this.expression.evaluate(new Oi(this.zoom),s,{},f,[],y),w=this.expression.evaluate(new Oi(this.zoom+1),s,{},f,[],y),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,v,w)}updatePaintArray(e,s,h,f){const y=this.expression.evaluate({zoom:this.zoom},h,f),v=this.expression.evaluate({zoom:this.zoom+1},h,f);this._setPaintValue(e,s,y,v)}_setPaintValue(e,s,h,f){if(this.type==="color"){const y=Hh(h),v=Hh(f);for(let w=e;w<s;w++)this.paintVertexArray.emplace(w,y[0],y[1],v[0],v[1])}else{for(let y=e;y<s;y++)this.paintVertexArray.emplace(y,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,f=ue(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);e.set(f)}getBinding(e,s,h){return new Br(e,s)}}class $s{constructor(e,s,h,f,y,v){this.expression=e,this.type=s,this.useIntegerZoom=h,this.zoom=f,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(e,s,h){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,s.patterns&&s.patterns[this.layerId],h)}updatePaintArray(e,s,h,f,y){this._setPaintValues(e,s,h.patterns&&h.patterns[this.layerId],y)}_setPaintValues(e,s,h,f){if(!f||!h)return;const{min:y,mid:v,max:w}=h,S=f[y],E=f[v],C=f[w];if(S&&E&&C)for(let z=e;z<s;z++)this.zoomInPaintVertexArray.emplace(z,E.tl[0],E.tl[1],E.br[0],E.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],E.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,E.tl[0],E.tl[1],E.br[0],E.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],E.pixelRatio,C.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Mr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Mr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xh{constructor(e,s,h){this.binders={},this._buffers=[];const f=[];for(const y in e.paint._values){if(!h(y))continue;const v=e.paint.get(y);if(!(v instanceof ks&&ia(v.property.specification)))continue;const w=Kh(y,e.type),S=v.value,E=v.property.specification.type,C=v.property.useIntegerZoom,z=v.property.specification["property-type"],N=z==="cross-faded"||z==="cross-faded-data-driven";if(S.kind==="constant")this.binders[y]=N?new ma(S.value,w):new fo(S.value,w,E),f.push(`/u_${y}`);else if(S.kind==="source"||N){const U=Yh(y,E,"source");this.binders[y]=N?new $s(S,E,C,s,U,e.id):new qs(S,w,E,U),f.push(`/a_${y}`)}else{const U=Yh(y,E,"composite");this.binders[y]=new Sr(S,w,E,C,s,U),f.push(`/z_${y}`)}}this.cacheKey=f.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof qs||s instanceof Sr?s.maxValue:0}populatePaintArrays(e,s,h,f,y){for(const v in this.binders){const w=this.binders[v];(w instanceof qs||w instanceof Sr||w instanceof $s)&&w.populatePaintArray(e,s,h,f,y)}}setConstantPatternPositions(e,s){for(const h in this.binders){const f=this.binders[h];f instanceof ma&&f.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,h,f,y){let v=!1;for(const w in e){const S=s.getPositions(w);for(const E of S){const C=h.feature(E.index);for(const z in this.binders){const N=this.binders[z];if((N instanceof qs||N instanceof Sr||N instanceof $s)&&N.expression.isStateDependent===!0){const U=f.paint.get(z);N.expression=U.value,N.updatePaintArray(E.start,E.end,C,e[w],y),v=!0}}}}return v}defines(){const e=[];for(const s in this.binders){const h=this.binders[s];(h instanceof fo||h instanceof ma)&&e.push(...h.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof qs||h instanceof Sr)for(let f=0;f<h.paintVertexAttributes.length;f++)e.push(h.paintVertexAttributes[f].name);else if(h instanceof $s)for(let f=0;f<Mr.members.length;f++)e.push(Mr.members[f].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof fo||h instanceof ma||h instanceof Sr)for(const f of h.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const h=[];for(const f in this.binders){const y=this.binders[f];if(y instanceof fo||y instanceof ma||y instanceof Sr){for(const v of y.uniformNames)if(s[v]){const w=y.getBinding(e,s[v],v);h.push({name:v,property:f,binding:w})}}}return h}setUniforms(e,s,h,f){for(const{name:y,property:v,binding:w}of s)this.binders[v].setUniform(w,f,h.get(v),y)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const h=this.binders[s];if(e&&h instanceof $s){const f=e.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(h instanceof qs||h instanceof Sr)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(e){for(const s in this.binders){const h=this.binders[s];(h instanceof qs||h instanceof Sr||h instanceof $s)&&h.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof qs||s instanceof Sr||s instanceof $s)&&s.destroy()}}}class dn{constructor(e,s,h=()=>!0){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new Xh(f,s,h);this.needsUpload=!1,this._featureMap=new ws,this._bufferOffset=0}populatePaintArrays(e,s,h,f,y,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,s,f,y,v);s.id!==void 0&&this._featureMap.add(s.id,h,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,h,f){for(const y of h)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,s,y,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Kh(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function Yh(n,e,s){const h={color:{source:ho,composite:G},number:{source:T,composite:ho}},f=function(y){return{"line-pattern":{source:pe,composite:pe},"fill-pattern":{source:pe,composite:pe},"fill-extrusion-pattern":{source:pe,composite:pe}}[y]}(n);return f&&f[s]||h[e][s]}ce("ConstantBinder",fo),ce("CrossFadedConstantBinder",ma),ce("SourceExpressionBinder",qs),ce("CrossFadedCompositeBinder",$s),ce("CompositeExpressionBinder",Sr),ce("ProgramConfiguration",Xh,{omit:["_buffers"]}),ce("ProgramConfigurationSet",dn);const po=Math.pow(2,14)-1,Qm=-po-1;function mo(n){const e=Et/n.extent,s=n.loadGeometry();for(let h=0;h<s.length;h++){const f=s[h];for(let y=0;y<f.length;y++){const v=f[y],w=Math.round(v.x*e),S=Math.round(v.y*e);v.x=ue(w,Qm,po),v.y=ue(S,Qm,po),(w<v.x||w>v.x+1||S<v.y||S>v.y+1)&&he("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function go(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?mo(n):[]}}const tg=-32768;function L1(n,e,s,h,f){n.emplaceBack(tg+8*e+h,tg+8*s+f)}class zf{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Tt,this.indexArray=new Ii,this.segments=new pi,this.programConfigurations=new dn(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){const f=this.layers[0],y=[];let v=null,w=!1,S=f.type==="heatmap";if(f.type==="circle"){const C=f;v=C.layout.get("circle-sort-key"),w=!v.isConstant(),S=S||C.paint.get("circle-pitch-alignment")==="map"}const E=S?s.subdivisionGranularity.circle:1;for(const{feature:C,id:z,index:N,sourceLayerIndex:U}of e){const q=this.layers[0]._featureFilter.needGeometry,W=go(C,q);if(!this.layers[0]._featureFilter.filter(new Oi(this.zoom,{globalState:this.globalState}),W,h))continue;const J=w?v.evaluate(W,{},h):void 0,rt={id:z,properties:C.properties,type:C.type,sourceLayerIndex:U,index:N,geometry:q?W.geometry:mo(C),patterns:{},sortKey:J};y.push(rt)}w&&y.sort((C,z)=>C.sortKey-z.sortKey);for(const C of y){const{geometry:z,index:N,sourceLayerIndex:U}=C,q=e[N].feature;this.addFeature(C,z,N,h,E),s.featureIndex.insert(q,z,N,U,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,h,f,y=1){let v;switch(y){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${y}; valid values are 1, 3, 5, 7.`)}const w=v.length;for(const S of s)for(const E of S){const C=E.x,z=E.y;if(C<0||C>=Et||z<0||z>=Et)continue;const N=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,e.sortKey),U=N.vertexLength;for(let q=0;q<w;q++)for(let W=0;W<w;W++)L1(this.layoutVertexArray,C,z,v[W],v[q]);for(let q=0;q<w-1;q++)for(let W=0;W<w-1;W++){const J=U+q*w+W,rt=U+(q+1)*w+W;this.indexArray.emplaceBack(J,rt+1,J+1),this.indexArray.emplaceBack(J,rt,rt+1)}N.vertexLength+=w*w,N.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,{},f)}}function eg(n,e){for(let s=0;s<n.length;s++)if(_l(e,n[s]))return!0;for(let s=0;s<e.length;s++)if(_l(n,e[s]))return!0;return!!Lf(n,e)}function O1(n,e,s){return!!_l(n,e)||!!Of(e,n,s)}function ig(n,e){if(n.length===1)return sg(e,n[0]);for(let s=0;s<e.length;s++){const h=e[s];for(let f=0;f<h.length;f++)if(_l(n,h[f]))return!0}for(let s=0;s<n.length;s++)if(sg(e,n[s]))return!0;for(let s=0;s<e.length;s++)if(Lf(n,e[s]))return!0;return!1}function F1(n,e,s){if(n.length>1){if(Lf(n,e))return!0;for(let h=0;h<e.length;h++)if(Of(e[h],n,s))return!0}for(let h=0;h<n.length;h++)if(Of(n[h],e,s))return!0;return!1}function Lf(n,e){if(n.length===0||e.length===0)return!1;for(let s=0;s<n.length-1;s++){const h=n[s],f=n[s+1];for(let y=0;y<e.length-1;y++)if(B1(h,f,e[y],e[y+1]))return!0}return!1}function B1(n,e,s,h){return we(n,s,h)!==we(e,s,h)&&we(n,e,s)!==we(n,e,h)}function Of(n,e,s){const h=s*s;if(e.length===1)return n.distSqr(e[0])<h;for(let f=1;f<e.length;f++)if(rg(n,e[f-1],e[f])<h)return!0;return!1}function rg(n,e,s){const h=e.distSqr(s);if(h===0)return n.distSqr(e);const f=((n.x-e.x)*(s.x-e.x)+(n.y-e.y)*(s.y-e.y))/h;return n.distSqr(f<0?e:f>1?s:s.sub(e)._mult(f)._add(e))}function sg(n,e){let s,h,f,y=!1;for(let v=0;v<n.length;v++){s=n[v];for(let w=0,S=s.length-1;w<s.length;S=w++)h=s[w],f=s[S],h.y>e.y!=f.y>e.y&&e.x<(f.x-h.x)*(e.y-h.y)/(f.y-h.y)+h.x&&(y=!y)}return y}function _l(n,e){let s=!1;for(let h=0,f=n.length-1;h<n.length;f=h++){const y=n[h],v=n[f];y.y>e.y!=v.y>e.y&&e.x<(v.x-y.x)*(e.y-y.y)/(v.y-y.y)+y.x&&(s=!s)}return s}function N1(n,e,s){const h=s[0],f=s[2];if(n.x<h.x&&e.x<h.x||n.x>f.x&&e.x>f.x||n.y<h.y&&e.y<h.y||n.y>f.y&&e.y>f.y)return!1;const y=we(n,e,s[0]);return y!==we(n,e,s[1])||y!==we(n,e,s[2])||y!==we(n,e,s[3])}function Jh(n,e,s){const h=e.paint.get(n).value;return h.kind==="constant"?h.value:s.programConfigurations.get(e.id).getMaxValue(n)}function $u(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Zu(n,e,s,h,f){if(!e[0]&&!e[1])return n;const y=V.convert(e)._mult(f);s==="viewport"&&y._rotate(-h);const v=[];for(let w=0;w<n.length;w++)v.push(n[w].sub(y));return v}let ng,ag;ce("CircleBucket",zf,{omit:["layers"]});var G1={get paint(){return ag=ag||new Fr({"circle-radius":new Re(ft.paint_circle["circle-radius"]),"circle-color":new Re(ft.paint_circle["circle-color"]),"circle-blur":new Re(ft.paint_circle["circle-blur"]),"circle-opacity":new Re(ft.paint_circle["circle-opacity"]),"circle-translate":new ge(ft.paint_circle["circle-translate"]),"circle-translate-anchor":new ge(ft.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ge(ft.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ge(ft.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Re(ft.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Re(ft.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Re(ft.paint_circle["circle-stroke-opacity"])})},get layout(){return ng=ng||new Fr({"circle-sort-key":new Re(ft.layout_circle["circle-sort-key"])})}};class j1 extends br{constructor(e){super(e,G1)}createBucket(e){return new zf(e)}queryRadius(e){const s=e;return Jh("circle-radius",this,s)+Jh("circle-stroke-width",this,s)+$u(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:h,geometry:f,transform:y,pixelsToTileUnits:v,unwrappedTileID:w,getElevation:S}){const E=Zu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-y.bearingInRadians,v),C=this.paint.get("circle-radius").evaluate(s,h)+this.paint.get("circle-stroke-width").evaluate(s,h),z=this.paint.get("circle-pitch-alignment")==="map",N=z?E:function(q,W,J,rt){return q.map(yt=>og(yt,W,J,rt))}(E,y,w,S),U=z?C*v:C;for(const q of f)for(const W of q){const J=z?W:og(W,y,w,S);let rt=U;const yt=y.projectTileCoordinates(W.x,W.y,w,S).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?rt*=yt/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(rt*=y.cameraToCenterDistance/yt),O1(N,J,rt))return!0}return!1}}function og(n,e,s,h){const f=e.projectTileCoordinates(n.x,n.y,s,h).point;return new V((.5*f.x+.5)*e.width,(.5*-f.y+.5)*e.height)}class lg extends zf{}let hg;ce("HeatmapBucket",lg,{omit:["layers"]});var U1={get paint(){return hg=hg||new Fr({"heatmap-radius":new Re(ft.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Re(ft.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ge(ft.paint_heatmap["heatmap-intensity"]),"heatmap-color":new lo(ft.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ge(ft.paint_heatmap["heatmap-opacity"])})}};function Ff(n,{width:e,height:s},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*s*h)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${e*s*h}`)}else f=new Uint8Array(e*s*h);return n.width=e,n.height=s,n.data=f,n}function cg(n,{width:e,height:s},h){if(e===n.width&&s===n.height)return;const f=Ff({},{width:e,height:s},h);Bf(n,f,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,s)},h),n.width=e,n.height=s,n.data=f.data}function Bf(n,e,s,h,f,y){if(f.width===0||f.height===0)return e;if(f.width>n.width||f.height>n.height||s.x>n.width-f.width||s.y>n.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||h.x>e.width-f.width||h.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const v=n.data,w=e.data;if(v===w)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<f.height;S++){const E=((s.y+S)*n.width+s.x)*y,C=((h.y+S)*e.width+h.x)*y;for(let z=0;z<f.width*y;z++)w[C+z]=v[E+z]}return e}class Qh{constructor(e,s){Ff(this,e,1,s)}resize(e){cg(this,e,1)}clone(){return new Qh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,h,f,y){Bf(e,s,h,f,y,1)}}class ts{constructor(e,s){Ff(this,e,4,s)}resize(e){cg(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ts({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,h,f,y){Bf(e,s,h,f,y,4)}setPixel(e,s,h){const f=4*(e*this.width+s);this.data[f+0]=Math.round(255*h.r/h.a),this.data[f+1]=Math.round(255*h.g/h.a),this.data[f+2]=Math.round(255*h.b/h.a),this.data[f+3]=Math.round(255*h.a)}}function ug(n){const e={},s=n.resolution||256,h=n.clips?n.clips.length:1,f=n.image||new ts({width:s,height:h});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const y=(v,w,S)=>{e[n.evaluationKey]=S;const E=n.expression.evaluate(e);f.setPixel(v/4/s,w/4,E)};if(n.clips)for(let v=0,w=0;v<h;++v,w+=4*s)for(let S=0,E=0;S<s;S++,E+=4){const C=S/(s-1),{start:z,end:N}=n.clips[v];y(w,E,z*(1-C)+N*C)}else for(let v=0,w=0;v<s;v++,w+=4)y(0,w,v/(s-1));return f}ce("AlphaImage",Qh),ce("RGBAImage",ts);const Nf="big-fb";class V1 extends br{createBucket(e){return new lg(e)}constructor(e){super(e,U1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ug({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Nf)&&this.heatmapFbos.delete(Nf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let dg;var q1={get paint(){return dg=dg||new Fr({"hillshade-illumination-direction":new ge(ft.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ge(ft.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ge(ft.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ge(ft.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ge(ft.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ge(ft.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ge(ft.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ge(ft.paint_hillshade["hillshade-method"])})}};class $1 extends br{constructor(e){super(e,q1),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,s=this.paint.get("hillshade-illumination-altitude").values,h=this.paint.get("hillshade-highlight-color").values,f=this.paint.get("hillshade-shadow-color").values;const y=Math.max(e.length,s.length,h.length,f.length);e=e.concat(Array(y-e.length).fill(e.at(-1))),s=s.concat(Array(y-s.length).fill(s.at(-1))),h=h.concat(Array(y-h.length).fill(h.at(-1))),f=f.concat(Array(y-f.length).fill(f.at(-1)));const v=s.map(Ye);return{directionRadians:e.map(Ye),altitudeRadians:v,shadowColor:f,highlightColor:h}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let fg;var Z1={get paint(){return fg=fg||new Fr({"color-relief-opacity":new ge(ft["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new lo(ft["paint_color-relief"]["color-relief-color"])})}};class Gf{constructor(e,s,h,f){this.context=e,this.format=h,this.texture=e.gl.createTexture(),this.update(s,f)}update(e,s,h){const{width:f,height:y}=e,v=!(this.size&&this.size[0]===f&&this.size[1]===y||h),{context:w}=this,{gl:S}=w;if(this.useMipmap=!!(s&&s.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[f,y],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Oe(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,f,y,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:E,y:C}=h||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Oe(e)?S.texSubImage2D(S.TEXTURE_2D,0,E,C,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,E,C,f,y,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,s,h){const{context:f}=this,{gl:y}=f;y.bindTexture(y.TEXTURE_2D,this.texture),h!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=y.LINEAR),e!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,e),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,h||e),this.filter=e),s!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class pg{constructor(e,s,h,f=1,y=1,v=1,w=0){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void he(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const S=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=y,this.blueFactor=v,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<S;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(S,E)]=this.data[this._idx(S-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,S)]=this.data[this._idx(E,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<S;E++)for(let C=0;C<S;C++){const z=this.get(E,C);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(e,s){const h=new Uint8Array(this.data.buffer),f=4*this._idx(e,s);return this.unpack(h[f],h[f+1],h[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}unpack(e,s,h){return e*this.redFactor+s*this.greenFactor+h*this.blueFactor-this.baseShift}pack(e){return mg(e,this.getUnpackVector())}getPixels(){return new ts({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,h){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,y=s*this.dim+this.dim,v=h*this.dim,w=h*this.dim+this.dim;switch(s){case-1:f=y-1;break;case 1:y=f+1}switch(h){case-1:v=w-1;break;case 1:w=v+1}const S=-s*this.dim,E=-h*this.dim;for(let C=v;C<w;C++)for(let z=f;z<y;z++)this.data[this._idx(z,C)]=e.data[this._idx(z+S,C+E)]}}function mg(n,e){const s=e[0],h=e[1],f=e[2],y=e[3],v=Math.min(s,h,f),w=Math.round((n+y)/v);return{r:Math.floor(w*v/s)%256,g:Math.floor(w*v/h)%256,b:Math.floor(w*v/f)%256}}ce("DEMData",pg);class W1 extends br{constructor(e){super(e,Z1)}_createColorRamp(e){const s={elevationStops:[],colorStops:[]},h=this._transitionablePaint._values["color-relief-color"].value.expression;if(h instanceof Ya&&h._styleExpression.expression instanceof Lr){this.colorRampExpression=h;const v=h._styleExpression.expression;s.elevationStops=v.labels,s.colorStops=[];for(const w of s.elevationStops)s.colorStops.push(v.evaluate({globals:{elevation:w}}))}if(s.elevationStops.length<1&&(s.elevationStops=[0],s.colorStops=[si.transparent]),s.elevationStops.length<2&&(s.elevationStops.push(s.elevationStops[0]+1),s.colorStops.push(s.colorStops[0])),s.elevationStops.length<=e)return s;const f={elevationStops:[],colorStops:[]},y=(s.elevationStops.length-1)/(e-1);for(let v=0;v<s.elevationStops.length-.5;v+=y)f.elevationStops.push(s.elevationStops[Math.round(v)]),f.colorStops.push(s.colorStops[Math.round(v)]);return he(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),f}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,s,h){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const f=this._createColorRamp(s),y=new ts({width:f.colorStops.length,height:1}),v=new ts({width:f.colorStops.length,height:1});for(let w=0;w<f.elevationStops.length;w++){const S=mg(f.elevationStops[w],h);v.setPixel(0,w,new si(S.r/255,S.g/255,S.b/255,1)),y.setPixel(0,w,f.colorStops[w])}return this.colorRampTextures={elevationTexture:new Gf(e,v,e.gl.RGBA),colorTexture:new Gf(e,y,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const H1=Wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:X1}=H1;function jf(n,e,s){const h=s.patternDependencies;let f=!1;for(const y of e){const v=y.paint.get(`${n}-pattern`);v.isConstant()||(f=!0);const w=v.constantOr(null);w&&(f=!0,h[w.to]=!0,h[w.from]=!0)}return f}function Uf(n,e,s,h,f){const y=f.patternDependencies;for(const v of e){const w=v.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let S=w.evaluate({zoom:h-1},s,{},f.availableImages),E=w.evaluate({zoom:h},s,{},f.availableImages),C=w.evaluate({zoom:h+1},s,{},f.availableImages);S=S&&S.name?S.name:S,E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,y[S]=!0,y[E]=!0,y[C]=!0,s.patterns[v.id]={min:S,mid:E,max:C}}}return s}function gg(n,e,s,h,f){let y;if(f===function(v,w,S,E){let C=0;for(let z=w,N=S-E;z<S;z+=E)C+=(v[N]-v[z])*(v[z+1]+v[N+1]),N=z;return C}(n,e,s,h)>0)for(let v=e;v<s;v+=h)y=xg(v/h|0,n[v],n[v+1],y);else for(let v=s-h;v>=e;v-=h)y=xg(v/h|0,n[v],n[v+1],y);return y&&yl(y,y.next)&&(rc(y),y=y.next),y}function _o(n,e){if(!n)return n;e||(e=n);let s,h=n;do if(s=!1,h.steiner||!yl(h,h.next)&&tr(h.prev,h,h.next)!==0)h=h.next;else{if(rc(h),h=e=h.prev,h===h.next)break;s=!0}while(s||h!==e);return e}function tc(n,e,s,h,f,y,v){if(!n)return;!v&&y&&function(S,E,C,z){let N=S;do N.z===0&&(N.z=Vf(N.x,N.y,E,C,z)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==S);N.prevZ.nextZ=null,N.prevZ=null,function(U){let q,W=1;do{let J,rt=U;U=null;let yt=null;for(q=0;rt;){q++;let lt=rt,j=0;for(let ut=0;ut<W&&(j++,lt=lt.nextZ,lt);ut++);let X=W;for(;j>0||X>0&&lt;)j!==0&&(X===0||!lt||rt.z<=lt.z)?(J=rt,rt=rt.nextZ,j--):(J=lt,lt=lt.nextZ,X--),yt?yt.nextZ=J:U=J,J.prevZ=yt,yt=J;rt=lt}yt.nextZ=null,W*=2}while(q>1)}(N)}(n,h,f,y);let w=n;for(;n.prev!==n.next;){const S=n.prev,E=n.next;if(y?Y1(n,h,f,y):K1(n))e.push(S.i,n.i,E.i),rc(n),n=E.next,w=E.next;else if((n=E)===w){v?v===1?tc(n=J1(_o(n),e),e,s,h,f,y,2):v===2&&Q1(n,e,s,h,f,y):tc(_o(n),e,s,h,f,y,1);break}}}function K1(n){const e=n.prev,s=n,h=n.next;if(tr(e,s,h)>=0)return!1;const f=e.x,y=s.x,v=h.x,w=e.y,S=s.y,E=h.y,C=Math.min(f,y,v),z=Math.min(w,S,E),N=Math.max(f,y,v),U=Math.max(w,S,E);let q=h.next;for(;q!==e;){if(q.x>=C&&q.x<=N&&q.y>=z&&q.y<=U&&ec(f,w,y,S,v,E,q.x,q.y)&&tr(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function Y1(n,e,s,h){const f=n.prev,y=n,v=n.next;if(tr(f,y,v)>=0)return!1;const w=f.x,S=y.x,E=v.x,C=f.y,z=y.y,N=v.y,U=Math.min(w,S,E),q=Math.min(C,z,N),W=Math.max(w,S,E),J=Math.max(C,z,N),rt=Vf(U,q,e,s,h),yt=Vf(W,J,e,s,h);let lt=n.prevZ,j=n.nextZ;for(;lt&&lt.z>=rt&&j&&j.z<=yt;){if(lt.x>=U&&lt.x<=W&&lt.y>=q&&lt.y<=J&&lt!==f&&lt!==v&&ec(w,C,S,z,E,N,lt.x,lt.y)&&tr(lt.prev,lt,lt.next)>=0||(lt=lt.prevZ,j.x>=U&&j.x<=W&&j.y>=q&&j.y<=J&&j!==f&&j!==v&&ec(w,C,S,z,E,N,j.x,j.y)&&tr(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;lt&&lt.z>=rt;){if(lt.x>=U&&lt.x<=W&&lt.y>=q&&lt.y<=J&&lt!==f&&lt!==v&&ec(w,C,S,z,E,N,lt.x,lt.y)&&tr(lt.prev,lt,lt.next)>=0)return!1;lt=lt.prevZ}for(;j&&j.z<=yt;){if(j.x>=U&&j.x<=W&&j.y>=q&&j.y<=J&&j!==f&&j!==v&&ec(w,C,S,z,E,N,j.x,j.y)&&tr(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function J1(n,e){let s=n;do{const h=s.prev,f=s.next.next;!yl(h,f)&&yg(h,s,s.next,f)&&ic(h,f)&&ic(f,h)&&(e.push(h.i,s.i,f.i),rc(s),rc(s.next),s=n=f),s=s.next}while(s!==n);return _o(s)}function Q1(n,e,s,h,f,y){let v=n;do{let w=v.next.next;for(;w!==v.prev;){if(v.i!==w.i&&sv(v,w)){let S=vg(v,w);return v=_o(v,v.next),S=_o(S,S.next),tc(v,e,s,h,f,y,0),void tc(S,e,s,h,f,y,0)}w=w.next}v=v.next}while(v!==n)}function tv(n,e){let s=n.x-e.x;return s===0&&(s=n.y-e.y,s===0)&&(s=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),s}function ev(n,e){const s=function(f,y){let v=y;const w=f.x,S=f.y;let E,C=-1/0;if(yl(f,v))return v;do{if(yl(f,v.next))return v.next;if(S<=v.y&&S>=v.next.y&&v.next.y!==v.y){const W=v.x+(S-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(W<=w&&W>C&&(C=W,E=v.x<v.next.x?v:v.next,W===w))return E}v=v.next}while(v!==y);if(!E)return null;const z=E,N=E.x,U=E.y;let q=1/0;v=E;do{if(w>=v.x&&v.x>=N&&w!==v.x&&_g(S<U?w:C,S,N,U,S<U?C:w,S,v.x,v.y)){const W=Math.abs(S-v.y)/(w-v.x);ic(v,f)&&(W<q||W===q&&(v.x>E.x||v.x===E.x&&iv(E,v)))&&(E=v,q=W)}v=v.next}while(v!==z);return E}(n,e);if(!s)return e;const h=vg(s,n);return _o(h,h.next),_o(s,s.next)}function iv(n,e){return tr(n.prev,n,e.prev)<0&&tr(e.next,n,n.next)<0}function Vf(n,e,s,h,f){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-s)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-h)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function rv(n){let e=n,s=n;do(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next;while(e!==n);return s}function _g(n,e,s,h,f,y,v,w){return(f-v)*(e-w)>=(n-v)*(y-w)&&(n-v)*(h-w)>=(s-v)*(e-w)&&(s-v)*(y-w)>=(f-v)*(h-w)}function ec(n,e,s,h,f,y,v,w){return!(n===v&&e===w)&&_g(n,e,s,h,f,y,v,w)}function sv(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(s,h){let f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==h.i&&f.next.i!==h.i&&yg(f,f.next,s,h))return!0;f=f.next}while(f!==s);return!1}(n,e)&&(ic(n,e)&&ic(e,n)&&function(s,h){let f=s,y=!1;const v=(s.x+h.x)/2,w=(s.y+h.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&v<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(y=!y),f=f.next;while(f!==s);return y}(n,e)&&(tr(n.prev,n,e.prev)||tr(n,e.prev,e))||yl(n,e)&&tr(n.prev,n,n.next)>0&&tr(e.prev,e,e.next)>0)}function tr(n,e,s){return(e.y-n.y)*(s.x-e.x)-(e.x-n.x)*(s.y-e.y)}function yl(n,e){return n.x===e.x&&n.y===e.y}function yg(n,e,s,h){const f=Hu(tr(n,e,s)),y=Hu(tr(n,e,h)),v=Hu(tr(s,h,n)),w=Hu(tr(s,h,e));return f!==y&&v!==w||!(f!==0||!Wu(n,s,e))||!(y!==0||!Wu(n,h,e))||!(v!==0||!Wu(s,n,h))||!(w!==0||!Wu(s,e,h))}function Wu(n,e,s){return e.x<=Math.max(n.x,s.x)&&e.x>=Math.min(n.x,s.x)&&e.y<=Math.max(n.y,s.y)&&e.y>=Math.min(n.y,s.y)}function Hu(n){return n>0?1:n<0?-1:0}function ic(n,e){return tr(n.prev,n,n.next)<0?tr(n,e,n.next)>=0&&tr(n,n.prev,e)>=0:tr(n,e,n.prev)<0||tr(n,n.next,e)<0}function vg(n,e){const s=qf(n.i,n.x,n.y),h=qf(e.i,e.x,e.y),f=n.next,y=e.prev;return n.next=e,e.prev=n,s.next=f,f.prev=s,h.next=s,s.prev=h,y.next=h,h.prev=y,h}function xg(n,e,s,h){const f=qf(n,e,s);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function rc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function qf(n,e,s){return{i:n,x:e,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class vl{constructor(e,s){if(s>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=s}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Xu{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Xu.noSubdivision=new Xu({fill:new vl(0,0),line:new vl(0,0),tile:new vl(0,0),stencil:new vl(0,0),circle:1}),ce("SubdivisionGranularityExpression",vl),ce("SubdivisionGranularitySetting",Xu);const xl=-32768,sc=32767;class nv{constructor(e,s){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Et/e,this._canonical=s}_getKey(e,s){return(e+=32768)<<16|s+32768}_vertexToIndex(e,s){if(e<-32768||s<-32768||e>32767||s>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const h=0|Math.round(e),f=0|Math.round(s),y=this._getKey(h,f);if(this._vertexDictionary.has(y))return this._vertexDictionary.get(y);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(y,v),this._vertexBuffer.push(h,f),v}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(f,y){const v=[];for(let w=0;w<y.length;w+=3){const S=y[w],E=y[w+1],C=y[w+2],z=f[2*S],N=f[2*S+1];(f[2*E]-z)*(f[2*C+1]-N)-(f[2*E+1]-N)*(f[2*C]-z)>0?(v.push(S),v.push(C),v.push(E)):(v.push(S),v.push(E),v.push(C))}return v}(this._vertexBuffer,e);const s=[],h=e.length;for(let f=0;f<h;f+=3){const y=[e[f+0],e[f+1],e[f+2]],v=[this._vertexBuffer[2*e[f+0]+0],this._vertexBuffer[2*e[f+0]+1],this._vertexBuffer[2*e[f+1]+0],this._vertexBuffer[2*e[f+1]+1],this._vertexBuffer[2*e[f+2]+0],this._vertexBuffer[2*e[f+2]+1]];let w=1/0,S=1/0,E=-1/0,C=-1/0;for(let W=0;W<3;W++){const J=v[2*W],rt=v[2*W+1];w=Math.min(w,J),E=Math.max(E,J),S=Math.min(S,rt),C=Math.max(C,rt)}if(w===E||S===C)continue;const z=Math.floor(w/this._granularityCellSize),N=Math.ceil(E/this._granularityCellSize),U=Math.floor(S/this._granularityCellSize),q=Math.ceil(C/this._granularityCellSize);if(z!==N||U!==q)for(let W=U;W<q;W++){const J=this._scanlineGenerateVertexRingForCellRow(W,v,y);av(this._vertexBuffer,J,s)}else s.push(...y)}return s}_scanlineGenerateVertexRingForCellRow(e,s,h){const f=e*this._granularityCellSize,y=f+this._granularityCellSize,v=[];for(let w=0;w<3;w++){const S=s[2*w],E=s[2*w+1],C=s[2*(w+1)%6],z=s[(2*(w+1)+1)%6],N=s[2*(w+2)%6],U=s[(2*(w+2)+1)%6],q=C-S,W=z-E,J=q===0,rt=W===0,yt=(f-E)/W,lt=(y-E)/W,j=Math.min(yt,lt),X=Math.max(yt,lt);if(!rt&&(j>=1||X<=0)||rt&&(E<f||E>y)){z>=f&&z<=y&&v.push(h[(w+1)%3]);continue}!rt&&j>0&&v.push(this._vertexToIndex(S+q*j,E+W*j));const ut=S+q*Math.max(j,0),Pt=S+q*Math.min(X,1);J||this._generateIntraEdgeVertices(v,S,E,C,z,ut,Pt),!rt&&X<1&&v.push(this._vertexToIndex(S+q*X,E+W*X)),(rt||z>=f&&z<=y)&&v.push(h[(w+1)%3]),!rt&&(z<=f||z>=y)&&this._generateInterEdgeVertices(v,S,E,C,z,N,U,Pt,f,y)}return v}_generateIntraEdgeVertices(e,s,h,f,y,v,w){const S=f-s,E=y-h,C=E===0,z=C?Math.min(s,f):Math.min(v,w),N=C?Math.max(s,f):Math.max(v,w),U=Math.floor(z/this._granularityCellSize)+1,q=Math.ceil(N/this._granularityCellSize)-1;if(C?s<f:v<w)for(let W=U;W<=q;W++){const J=W*this._granularityCellSize;e.push(this._vertexToIndex(J,h+E*(J-s)/S))}else for(let W=q;W>=U;W--){const J=W*this._granularityCellSize;e.push(this._vertexToIndex(J,h+E*(J-s)/S))}}_generateInterEdgeVertices(e,s,h,f,y,v,w,S,E,C){const z=y-h,N=v-f,U=w-y,q=(E-y)/U,W=(C-y)/U,J=Math.min(q,W),rt=Math.max(q,W),yt=f+N*J;let lt=Math.floor(Math.min(yt,S)/this._granularityCellSize)+1,j=Math.ceil(Math.max(yt,S)/this._granularityCellSize)-1,X=S<yt;const ut=U===0;if(ut&&(w===E||w===C))return;if(ut||J>=1||rt<=0){const jt=h-w,kt=v+(s-v)*Math.min((E-w)/jt,(C-w)/jt);lt=Math.floor(Math.min(kt,S)/this._granularityCellSize)+1,j=Math.ceil(Math.max(kt,S)/this._granularityCellSize)-1,X=S<kt}const Pt=z>0?C:E;if(X)for(let jt=lt;jt<=j;jt++)e.push(this._vertexToIndex(jt*this._granularityCellSize,Pt));else for(let jt=j;jt>=lt;jt--)e.push(this._vertexToIndex(jt*this._granularityCellSize,Pt))}_generateOutline(e){const s=[];for(const h of e){const f=yo(h,this._granularity,!0),y=this._pointArrayToIndices(f),v=[];for(let w=1;w<y.length;w++)v.push(y[w-1]),v.push(y[w]);s.push(v)}return s}_handlePoles(e){let s=!1,h=!1;this._canonical&&(this._canonical.y===0&&(s=!0),this._canonical.y===(1<<this._canonical.z)-1&&(h=!0)),(s||h)&&this._fillPoles(e,s,h)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let s=0;s<e.length;s+=2){const h=e[s+1];h===xl&&(e[s+1]=-32767),h===sc&&(e[s+1]=32766)}}_generatePoleQuad(e,s,h,f,y,v){f>y!=(v===xl)?(e.push(s),e.push(h),e.push(this._vertexToIndex(f,v)),e.push(h),e.push(this._vertexToIndex(y,v)),e.push(this._vertexToIndex(f,v))):(e.push(h),e.push(s),e.push(this._vertexToIndex(f,v)),e.push(this._vertexToIndex(y,v)),e.push(h),e.push(this._vertexToIndex(f,v)))}_fillPoles(e,s,h){const f=this._vertexBuffer,y=Et,v=e.length;for(let w=2;w<v;w+=3){const S=e[w-2],E=e[w-1],C=e[w],z=f[2*S],N=f[2*S+1],U=f[2*E],q=f[2*E+1],W=f[2*C],J=f[2*C+1];s&&(N===0&&q===0&&this._generatePoleQuad(e,S,E,z,U,xl),q===0&&J===0&&this._generatePoleQuad(e,E,C,U,W,xl),J===0&&N===0&&this._generatePoleQuad(e,C,S,W,z,xl)),h&&(N===y&&q===y&&this._generatePoleQuad(e,S,E,z,U,sc),q===y&&J===y&&this._generatePoleQuad(e,E,C,U,W,sc),J===y&&N===y&&this._generatePoleQuad(e,C,S,W,z,sc))}}_initializeVertices(e){for(let s=0;s<e.length;s+=2)this._vertexToIndex(e[s],e[s+1])}subdividePolygonInternal(e,s){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:h,holeIndices:f}=function(w){const S=[],E=[];for(const C of w)if(C.length!==0){C!==w[0]&&S.push(E.length/2);for(let z=0;z<C.length;z++)E.push(C[z].x),E.push(C[z].y)}return{flattened:E,holeIndices:S}}(e);let y;this._initializeVertices(h);try{const w=function(E,C,z=2){const N=C&&C.length,U=N?C[0]*z:E.length;let q=gg(E,0,U,z,!0);const W=[];if(!q||q.next===q.prev)return W;let J,rt,yt;if(N&&(q=function(lt,j,X,ut){const Pt=[];for(let jt=0,kt=j.length;jt<kt;jt++){const Ot=gg(lt,j[jt]*ut,jt<kt-1?j[jt+1]*ut:lt.length,ut,!1);Ot===Ot.next&&(Ot.steiner=!0),Pt.push(rv(Ot))}Pt.sort(tv);for(let jt=0;jt<Pt.length;jt++)X=ev(Pt[jt],X);return X}(E,C,q,z)),E.length>80*z){J=1/0,rt=1/0;let lt=-1/0,j=-1/0;for(let X=z;X<U;X+=z){const ut=E[X],Pt=E[X+1];ut<J&&(J=ut),Pt<rt&&(rt=Pt),ut>lt&&(lt=ut),Pt>j&&(j=Pt)}yt=Math.max(lt-J,j-rt),yt=yt!==0?32767/yt:0}return tc(q,W,z,J,rt,yt,0),W}(h,f),S=this._convertIndices(h,w);y=this._subdivideTrianglesScanline(S)}catch(w){console.error(w)}let v=[];return s&&(v=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(y),{verticesFlattened:this._vertexBuffer,indicesTriangles:y,indicesLineList:v}}_convertIndices(e,s){const h=[];for(let f=0;f<s.length;f++)h.push(this._vertexToIndex(e[2*s[f]],e[2*s[f]+1]));return h}_pointArrayToIndices(e){const s=[];for(let h=0;h<e.length;h++){const f=e[h];s.push(this._vertexToIndex(f.x,f.y))}return s}}function bg(n,e,s,h=!0){return new nv(s,e).subdividePolygonInternal(n,h)}function yo(n,e,s=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const h=n[0],f=n[n.length-1],y=s&&(h.x!==f.x||h.y!==f.y);if(e<2)return y?[...n,n[0]]:[...n];const v=Math.floor(Et/e),w=[];w.push(new V(n[0].x,n[0].y));const S=n.length,E=y?S:S-1;for(let C=0;C<E;C++){const z=n[C],N=C<S-1?n[C+1]:n[0],U=z.x,q=z.y,W=N.x,J=N.y,rt=U!==W,yt=q!==J;if(!rt&&!yt)continue;const lt=W-U,j=J-q,X=Math.abs(lt),ut=Math.abs(j);let Pt=U,jt=q;for(;;){const Ot=lt>0?(Math.floor(Pt/v)+1)*v:(Math.ceil(Pt/v)-1)*v,Ht=j>0?(Math.floor(jt/v)+1)*v:(Math.ceil(jt/v)-1)*v,$t=Math.abs(Pt-Ot),Kt=Math.abs(jt-Ht),Bt=Math.abs(Pt-W),me=Math.abs(jt-J),Ie=rt?$t/X:Number.POSITIVE_INFINITY,Te=yt?Kt/ut:Number.POSITIVE_INFINITY;if((Bt<=$t||!rt)&&(me<=Kt||!yt))break;if(Ie<Te&&rt||!yt){Pt=Ot,jt+=j*Ie;const ve=new V(Pt,Math.round(jt));w[w.length-1].x===ve.x&&w[w.length-1].y===ve.y||w.push(ve)}else{Pt+=lt*Te,jt=Ht;const ve=new V(Math.round(Pt),jt);w[w.length-1].x===ve.x&&w[w.length-1].y===ve.y||w.push(ve)}}const kt=new V(W,J);w[w.length-1].x===kt.x&&w[w.length-1].y===kt.y||w.push(kt)}return w}function av(n,e,s){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let h=0,f=n[2*e[0]];for(let S=1;S<e.length;S++){const E=n[2*e[S]];E<f&&(f=E,h=S)}const y=e.length;let v=h,w=(v+1)%y;for(;;){const S=v-1>=0?v-1:y-1,E=(w+1)%y,C=n[2*e[S]],z=n[2*e[E]],N=n[2*e[v]],U=n[2*e[v]+1],q=n[2*e[w]+1];let W=!1;if(C<z)W=!0;else if(C>z)W=!1;else{const J=q-U,rt=-(n[2*e[w]]-N),yt=U<q?1:-1;((C-N)*J+(n[2*e[S]+1]-U)*rt)*yt>((z-N)*J+(n[2*e[E]+1]-U)*rt)*yt&&(W=!0)}if(W){const J=e[S],rt=e[v],yt=e[w];J!==rt&&J!==yt&&rt!==yt&&s.push(yt,rt,J),v--,v<0&&(v=y-1)}else{const J=e[E],rt=e[v],yt=e[w];J!==rt&&J!==yt&&rt!==yt&&s.push(yt,rt,J),w++,w>=y&&(w=0)}if(S===E)break}}function wg(n,e,s,h,f,y,v,w,S){const E=f.length/2,C=v&&w&&S;if(E<pi.MAX_VERTEX_ARRAY_LENGTH){const z=e.prepareSegment(E,s,h),N=z.vertexLength;for(let W=0;W<y.length;W+=3)h.emplaceBack(N+y[W],N+y[W+1],N+y[W+2]);let U,q;z.vertexLength+=E,z.primitiveLength+=y.length/3,C&&(q=v.prepareSegment(E,s,w),U=q.vertexLength,q.vertexLength+=E);for(let W=0;W<f.length;W+=2)n(f[W],f[W+1]);if(C)for(let W=0;W<S.length;W++){const J=S[W];for(let rt=1;rt<J.length;rt+=2)w.emplaceBack(U+J[rt-1],U+J[rt]);q.primitiveLength+=J.length/2}}else(function(z,N,U,q,W,J){const rt=[];for(let ut=0;ut<q.length/2;ut++)rt.push(-1);const yt={count:0};let lt=0,j=z.getOrCreateLatestSegment(N,U),X=j.vertexLength;for(let ut=2;ut<W.length;ut+=3){const Pt=W[ut-2],jt=W[ut-1],kt=W[ut];let Ot=rt[Pt]<lt,Ht=rt[jt]<lt,$t=rt[kt]<lt;j.vertexLength+((Ot?1:0)+(Ht?1:0)+($t?1:0))>pi.MAX_VERTEX_ARRAY_LENGTH&&(j=z.createNewSegment(N,U),lt=yt.count,Ot=!0,Ht=!0,$t=!0,X=0);const Kt=nc(rt,q,J,yt,Pt,Ot,j),Bt=nc(rt,q,J,yt,jt,Ht,j),me=nc(rt,q,J,yt,kt,$t,j);U.emplaceBack(X+Kt-lt,X+Bt-lt,X+me-lt),j.primitiveLength++}})(e,s,h,f,y,n),C&&function(z,N,U,q,W,J){const rt=[];for(let ut=0;ut<q.length/2;ut++)rt.push(-1);const yt={count:0};let lt=0,j=z.getOrCreateLatestSegment(N,U),X=j.vertexLength;for(let ut=0;ut<W.length;ut++){const Pt=W[ut];for(let jt=1;jt<W[ut].length;jt+=2){const kt=Pt[jt-1],Ot=Pt[jt];let Ht=rt[kt]<lt,$t=rt[Ot]<lt;j.vertexLength+((Ht?1:0)+($t?1:0))>pi.MAX_VERTEX_ARRAY_LENGTH&&(j=z.createNewSegment(N,U),lt=yt.count,Ht=!0,$t=!0,X=0);const Kt=nc(rt,q,J,yt,kt,Ht,j),Bt=nc(rt,q,J,yt,Ot,$t,j);U.emplaceBack(X+Kt-lt,X+Bt-lt),j.primitiveLength++}}}(v,s,w,f,S,n),e.forceNewSegmentOnNextPrepare(),v==null||v.forceNewSegmentOnNextPrepare()}function nc(n,e,s,h,f,y,v){if(y){const w=h.count;return s(e[2*f],e[2*f+1]),n[f]=h.count,h.count++,v.vertexLength++,w}return n[f]}class $f{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new At,this.indexArray=new Ii,this.indexArray2=new Pi,this.programConfigurations=new dn(e.layers,e.zoom),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.hasPattern=jf("fill",this.layers,s);const f=this.layers[0].layout.get("fill-sort-key"),y=!f.isConstant(),v=[];for(const{feature:w,id:S,index:E,sourceLayerIndex:C}of e){const z=this.layers[0]._featureFilter.needGeometry,N=go(w,z);if(!this.layers[0]._featureFilter.filter(new Oi(this.zoom,{globalState:this.globalState}),N,h))continue;const U=y?f.evaluate(N,{},h,s.availableImages):void 0,q={id:S,properties:w.properties,type:w.type,sourceLayerIndex:C,index:E,geometry:z?N.geometry:mo(w),patterns:{},sortKey:U};v.push(q)}y&&v.sort((w,S)=>w.sortKey-S.sortKey);for(const w of v){const{geometry:S,index:E,sourceLayerIndex:C}=w;if(this.hasPattern){const z=Uf("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(z)}else this.addFeature(w,S,E,h,{},s.subdivisionGranularity);s.featureIndex.insert(e[E].feature,S,E,C,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}addFeatures(e,s,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,h,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,X1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,h,f,y,v){for(const w of qo(s,500)){const S=bg(w,f,v.fill.getGranularityForZoomLevel(f.z)),E=this.layoutVertexArray;wg((C,z)=>{E.emplaceBack(C,z)},this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles,this.segments2,this.indexArray2,S.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,y,f)}}let Mg,Sg;ce("FillBucket",$f,{omit:["layers","patternFeatures"]});var ov={get paint(){return Sg=Sg||new Fr({"fill-antialias":new ge(ft.paint_fill["fill-antialias"]),"fill-opacity":new Re(ft.paint_fill["fill-opacity"]),"fill-color":new Re(ft.paint_fill["fill-color"]),"fill-outline-color":new Re(ft.paint_fill["fill-outline-color"]),"fill-translate":new ge(ft.paint_fill["fill-translate"]),"fill-translate-anchor":new ge(ft.paint_fill["fill-translate-anchor"]),"fill-pattern":new pl(ft.paint_fill["fill-pattern"])})},get layout(){return Mg=Mg||new Fr({"fill-sort-key":new Re(ft.layout_fill["fill-sort-key"])})}};class lv extends br{constructor(e){super(e,ov)}recalculate(e,s){super.recalculate(e,s);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new $f(e)}queryRadius(){return $u(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:s,transform:h,pixelsToTileUnits:f}){return ig(Zu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-h.bearingInRadians,f),s)}isTileClipped(){return!0}}const hv=Wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),cv=Wi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:uv}=hv;var Zf,Tg,Wf,Pg,Hf,Eg,Ig,Ku={};function Cg(){if(Tg)return Zf;Tg=1;var n=D();function e(f,y,v,w,S){this.properties={},this.extent=v,this.type=0,this._pbf=f,this._geometry=-1,this._keys=w,this._values=S,f.readFields(s,this,y)}function s(f,y,v){f==1?y.id=v.readVarint():f==2?function(w,S){for(var E=w.readVarint()+w.pos;w.pos<E;){var C=S._keys[w.readVarint()],z=S._values[w.readVarint()];S.properties[C]=z}}(v,y):f==3?y.type=v.readVarint():f==4&&(y._geometry=v.pos)}function h(f){for(var y,v,w=0,S=0,E=f.length,C=E-1;S<E;C=S++)w+=((v=f[C]).x-(y=f[S]).x)*(y.y+v.y);return w}return Zf=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var y,v=f.readVarint()+f.pos,w=1,S=0,E=0,C=0,z=[];f.pos<v;){if(S<=0){var N=f.readVarint();w=7&N,S=N>>3}if(S--,w===1||w===2)E+=f.readSVarint(),C+=f.readSVarint(),w===1&&(y&&z.push(y),y=[]),y.push(new n(E,C));else{if(w!==7)throw new Error("unknown command "+w);y&&y.push(y[0].clone())}}return y&&z.push(y),z},e.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var y=f.readVarint()+f.pos,v=1,w=0,S=0,E=0,C=1/0,z=-1/0,N=1/0,U=-1/0;f.pos<y;){if(w<=0){var q=f.readVarint();v=7&q,w=q>>3}if(w--,v===1||v===2)(S+=f.readSVarint())<C&&(C=S),S>z&&(z=S),(E+=f.readSVarint())<N&&(N=E),E>U&&(U=E);else if(v!==7)throw new Error("unknown command "+v)}return[C,N,z,U]},e.prototype.toGeoJSON=function(f,y,v){var w,S,E=this.extent*Math.pow(2,v),C=this.extent*f,z=this.extent*y,N=this.loadGeometry(),U=e.types[this.type];function q(rt){for(var yt=0;yt<rt.length;yt++){var lt=rt[yt];rt[yt]=[360*(lt.x+C)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(lt.y+z)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(w=0;w<N.length;w++)W[w]=N[w][0];q(N=W);break;case 2:for(w=0;w<N.length;w++)q(N[w]);break;case 3:for(N=function(rt){var yt=rt.length;if(yt<=1)return[rt];for(var lt,j,X=[],ut=0;ut<yt;ut++){var Pt=h(rt[ut]);Pt!==0&&(j===void 0&&(j=Pt<0),j===Pt<0?(lt&&X.push(lt),lt=[rt[ut]]):lt.push(rt[ut]))}return lt&&X.push(lt),X}(N),w=0;w<N.length;w++)for(S=0;S<N[w].length;S++)q(N[w][S])}N.length===1?N=N[0]:U="Multi"+U;var J={type:"Feature",geometry:{type:U,coordinates:N},properties:this.properties};return"id"in this&&(J.id=this.id),J},Zf}function Ag(){if(Pg)return Wf;Pg=1;var n=Cg();function e(h,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(s,this,f),this.length=this._features.length}function s(h,f,y){h===15?f.version=y.readVarint():h===1?f.name=y.readString():h===5?f.extent=y.readVarint():h===2?f._features.push(y.pos):h===3?f._keys.push(y.readString()):h===4&&f._values.push(function(v){for(var w=null,S=v.readVarint()+v.pos;v.pos<S;){var E=v.readVarint()>>3;w=E===1?v.readString():E===2?v.readFloat():E===3?v.readDouble():E===4?v.readVarint64():E===5?v.readVarint():E===6?v.readSVarint():E===7?v.readBoolean():null}return w}(y))}return Wf=e,e.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var f=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,f,this.extent,this._keys,this._values)},Wf}function Rg(){return Ig||(Ig=1,Ku.VectorTile=function(){if(Eg)return Hf;Eg=1;var n=Ag();function e(s,h,f){if(s===3){var y=new n(f,f.readVarint()+f.pos);y.length&&(h[y.name]=y)}}return Hf=function(s,h){this.layers=s.readFields(e,{},h)},Hf}(),Ku.VectorTileFeature=Cg(),Ku.VectorTileLayer=Ag()),Ku}var ac=P(Rg());const dv=ac.VectorTileFeature.types,Xf=Math.pow(2,13);function oc(n,e,s,h,f,y,v,w){n.emplaceBack(e,s,2*Math.floor(h*Xf)+v,f*Xf*2,y*Xf*2,Math.round(w))}class Kf{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new te,this.centroidVertexArray=new Mt,this.indexArray=new Ii,this.programConfigurations=new dn(e.layers,e.zoom),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.features=[],this.hasPattern=jf("fill-extrusion",this.layers,s);for(const{feature:f,id:y,index:v,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,E=go(f,S);if(!this.layers[0]._featureFilter.filter(new Oi(this.zoom,{globalState:this.globalState}),E,h))continue;const C={id:y,sourceLayerIndex:w,index:v,geometry:S?E.geometry:mo(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Uf("fill-extrusion",this.layers,C,this.zoom,s)):this.addFeature(C,C.geometry,v,h,{},s.subdivisionGranularity),s.featureIndex.insert(f,C.geometry,v,w,this.index,!0)}}addFeatures(e,s,h){for(const f of this.features){const{geometry:y}=f;this.addFeature(f,y,f.index,s,h,e.subdivisionGranularity)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uv),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,cv.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,s,h,f,y,v){for(const w of qo(s,500)){const S={x:0,y:0,sampleCount:0},E=this.layoutVertexArray.length;this.processPolygon(S,f,e,w,v);const C=this.layoutVertexArray.length-E,z=Math.floor(S.x/S.sampleCount),N=Math.floor(S.y/S.sampleCount);for(let U=0;U<C;U++)this.centroidVertexArray.emplaceBack(z,N)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,y,f)}processPolygon(e,s,h,f,y){if(f.length<1||kg(f[0]))return;for(const z of f)z.length!==0&&fv(e,z);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=y.fill.getGranularityForZoomLevel(s.z),S=dv[h.type]==="Polygon";for(const z of f){if(z.length===0||kg(z))continue;const N=yo(z,w,S);this._generateSideFaces(N,v)}if(!S)return;const E=bg(f,s,w,!1),C=this.layoutVertexArray;wg((z,N)=>{oc(C,z,N,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles)}_generateSideFaces(e,s){let h=0;for(let f=1;f<e.length;f++){const y=e[f],v=e[f-1];if(pv(y,v))continue;s.segment.vertexLength+4>pi.MAX_VERTEX_ARRAY_LENGTH&&(s.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=y.sub(v)._perp()._unit(),S=v.dist(y);h+S>32768&&(h=0),oc(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,0,h),oc(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,1,h),h+=S,oc(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,0,h),oc(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,1,h);const E=s.segment.vertexLength;this.indexArray.emplaceBack(E,E+2,E+1),this.indexArray.emplaceBack(E+1,E+2,E+3),s.segment.vertexLength+=4,s.segment.primitiveLength+=2}}}function fv(n,e){for(let s=0;s<e.length;s++){const h=e[s];s===e.length-1&&e[0].x===h.x&&e[0].y===h.y||(n.x+=h.x,n.y+=h.y,n.sampleCount++)}}function pv(n,e){return n.x===e.x&&(n.x<0||n.x>Et)||n.y===e.y&&(n.y<0||n.y>Et)}function kg(n){return n.every(e=>e.x<0)||n.every(e=>e.x>Et)||n.every(e=>e.y<0)||n.every(e=>e.y>Et)}let Dg;ce("FillExtrusionBucket",Kf,{omit:["layers","features"]});var mv={get paint(){return Dg=Dg||new Fr({"fill-extrusion-opacity":new ge(ft["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Re(ft["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ge(ft["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ge(ft["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pl(ft["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Re(ft["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Re(ft["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ge(ft["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class gv extends br{constructor(e){super(e,mv)}createBucket(e){return new Kf(e)}queryRadius(){return $u(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:h,geometry:f,transform:y,pixelsToTileUnits:v,pixelPosMatrix:w}){const S=Zu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-y.bearingInRadians,v),E=this.paint.get("fill-extrusion-height").evaluate(s,h),C=this.paint.get("fill-extrusion-base").evaluate(s,h),z=function(U,q){const W=[];for(const J of U){const rt=[J.x,J.y,0,1];yi(rt,rt,q),W.push(new V(rt[0]/rt[3],rt[1]/rt[3]))}return W}(S,w),N=function(U,q,W,J){const rt=[],yt=[],lt=J[8]*q,j=J[9]*q,X=J[10]*q,ut=J[11]*q,Pt=J[8]*W,jt=J[9]*W,kt=J[10]*W,Ot=J[11]*W;for(const Ht of U){const $t=[],Kt=[];for(const Bt of Ht){const me=Bt.x,Ie=Bt.y,Te=J[0]*me+J[4]*Ie+J[12],ve=J[1]*me+J[5]*Ie+J[13],li=J[2]*me+J[6]*Ie+J[14],Hi=J[3]*me+J[7]*Ie+J[15],lr=li+X,kr=Hi+ut,Ss=Te+Pt,es=ve+jt,Tr=li+kt,qi=Hi+Ot,gr=new V((Te+lt)/kr,(ve+j)/kr);gr.z=lr/kr,$t.push(gr);const Pr=new V(Ss/qi,es/qi);Pr.z=Tr/qi,Kt.push(Pr)}rt.push($t),yt.push(Kt)}return[rt,yt]}(f,C,E,w);return function(U,q,W){let J=1/0;ig(W,q)&&(J=zg(W,q[0]));for(let rt=0;rt<q.length;rt++){const yt=q[rt],lt=U[rt];for(let j=0;j<yt.length-1;j++){const X=yt[j],ut=[X,yt[j+1],lt[j+1],lt[j],X];eg(W,ut)&&(J=Math.min(J,zg(W,ut)))}}return J!==1/0&&J}(N[0],N[1],z)}}function lc(n,e){return n.x*e.x+n.y*e.y}function zg(n,e){if(n.length===1){let s=0;const h=e[s++];let f;for(;!f||h.equals(f);)if(f=e[s++],!f)return 1/0;for(;s<e.length;s++){const y=e[s],v=n[0],w=f.sub(h),S=y.sub(h),E=v.sub(h),C=lc(w,w),z=lc(w,S),N=lc(S,S),U=lc(E,w),q=lc(E,S),W=C*N-z*z,J=(N*U-z*q)/W,rt=(C*q-z*U)/W,yt=h.z*(1-J-rt)+f.z*J+y.z*rt;if(isFinite(yt))return yt}return 1/0}{let s=1/0;for(const h of e)s=Math.min(s,h.z);return s}}const _v=Wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:yv}=_v,vv=Wi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:xv}=vv,bv=ac.VectorTileFeature.types,wv=Math.cos(Math.PI/180*37.5),Lg=Math.pow(2,14)/.5;class Yf{constructor(e){this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Jt,this.layoutVertexArray2=new Vt,this.indexArray=new Ii,this.programConfigurations=new dn(e.layers,e.zoom),this.segments=new pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,h){this.hasPattern=jf("line",this.layers,s);const f=this.layers[0].layout.get("line-sort-key"),y=!f.isConstant(),v=[];for(const{feature:w,id:S,index:E,sourceLayerIndex:C}of e){const z=this.layers[0]._featureFilter.needGeometry,N=go(w,z);if(!this.layers[0]._featureFilter.filter(new Oi(this.zoom,{globalState:this.globalState}),N,h))continue;const U=y?f.evaluate(N,{},h):void 0,q={id:S,properties:w.properties,type:w.type,sourceLayerIndex:C,index:E,geometry:z?N.geometry:mo(w),patterns:{},sortKey:U};v.push(q)}y&&v.sort((w,S)=>w.sortKey-S.sortKey);for(const w of v){const{geometry:S,index:E,sourceLayerIndex:C}=w;if(this.hasPattern){const z=Uf("line",this.layers,w,this.zoom,s);this.patternFeatures.push(z)}else this.addFeature(w,S,E,h,{},s.subdivisionGranularity);s.featureIndex.insert(e[E].feature,S,E,C,this.index)}}update(e,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,h)}addFeatures(e,s,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,h,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,xv)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,h,f,y,v){const w=this.layers[0].layout,S=w.get("line-join").evaluate(e,{}),E=w.get("line-cap"),C=w.get("line-miter-limit"),z=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const N of s)this.addLine(N,e,S,E,C,z,f,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,y,f)}addLine(e,s,h,f,y,v,w,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=yo(e,w?S.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let lt=0;lt<e.length-1;lt++)this.totalDistance+=e[lt].dist(e[lt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=bv[s.type]==="Polygon";let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let z=0;for(;z<C-1&&e[z].equals(e[z+1]);)z++;if(C<(E?3:2))return;h==="bevel"&&(y=1.05);const N=this.overscaling<=16?122880/(512*this.overscaling):0,U=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let q,W,J,rt,yt;this.e1=this.e2=-1,E&&(q=e[C-2],yt=e[z].sub(q)._unit()._perp());for(let lt=z;lt<C;lt++){if(J=lt===C-1?E?e[z+1]:void 0:e[lt+1],J&&e[lt].equals(J))continue;yt&&(rt=yt),q&&(W=q),q=e[lt],yt=J?J.sub(q)._unit()._perp():rt,rt=rt||yt;let j=rt.add(yt);j.x===0&&j.y===0||j._unit();const X=rt.x*yt.x+rt.y*yt.y,ut=j.x*yt.x+j.y*yt.y,Pt=ut!==0?1/ut:1/0,jt=2*Math.sqrt(2-2*ut),kt=ut<wv&&W&&J,Ot=rt.x*yt.y-rt.y*yt.x>0;if(kt&&lt>z){const Kt=q.dist(W);if(Kt>2*N){const Bt=q.sub(q.sub(W)._mult(N/Kt)._round());this.updateDistance(W,Bt),this.addCurrentVertex(Bt,rt,0,0,U),W=Bt}}const Ht=W&&J;let $t=Ht?h:E?"butt":f;if(Ht&&$t==="round"&&(Pt<v?$t="miter":Pt<=2&&($t="fakeround")),$t==="miter"&&Pt>y&&($t="bevel"),$t==="bevel"&&(Pt>2&&($t="flipbevel"),Pt<y&&($t="miter")),W&&this.updateDistance(W,q),$t==="miter")j._mult(Pt),this.addCurrentVertex(q,j,0,0,U);else if($t==="flipbevel"){if(Pt>100)j=yt.mult(-1);else{const Kt=Pt*rt.add(yt).mag()/rt.sub(yt).mag();j._perp()._mult(Kt*(Ot?-1:1))}this.addCurrentVertex(q,j,0,0,U),this.addCurrentVertex(q,j.mult(-1),0,0,U)}else if($t==="bevel"||$t==="fakeround"){const Kt=-Math.sqrt(Pt*Pt-1),Bt=Ot?Kt:0,me=Ot?0:Kt;if(W&&this.addCurrentVertex(q,rt,Bt,me,U),$t==="fakeround"){const Ie=Math.round(180*jt/Math.PI/20);for(let Te=1;Te<Ie;Te++){let ve=Te/Ie;if(ve!==.5){const Hi=ve-.5;ve+=ve*Hi*(ve-1)*((1.0904+X*(X*(3.55645-1.43519*X)-3.2452))*Hi*Hi+(.848013+X*(.215638*X-1.06021)))}const li=yt.sub(rt)._mult(ve)._add(rt)._unit()._mult(Ot?-1:1);this.addHalfVertex(q,li.x,li.y,!1,Ot,0,U)}}J&&this.addCurrentVertex(q,yt,-Bt,-me,U)}else if($t==="butt")this.addCurrentVertex(q,j,0,0,U);else if($t==="square"){const Kt=W?1:-1;this.addCurrentVertex(q,j,Kt,Kt,U)}else $t==="round"&&(W&&(this.addCurrentVertex(q,rt,0,0,U),this.addCurrentVertex(q,rt,1,1,U,!0)),J&&(this.addCurrentVertex(q,yt,-1,-1,U,!0),this.addCurrentVertex(q,yt,0,0,U)));if(kt&&lt<C-1){const Kt=q.dist(J);if(Kt>2*N){const Bt=q.add(J.sub(q)._mult(N/Kt)._round());this.updateDistance(q,Bt),this.addCurrentVertex(Bt,yt,0,0,U),q=Bt}}}}addCurrentVertex(e,s,h,f,y,v=!1){const w=s.y*f-s.x,S=-s.y-s.x*f;this.addHalfVertex(e,s.x+s.y*h,s.y-s.x*h,v,!1,h,y),this.addHalfVertex(e,w,S,v,!0,-f,y),this.distance>Lg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,s,h,f,y,v))}addHalfVertex({x:e,y:s},h,f,y,v,w,S){const E=.5*(this.lineClips?this.scaledDistance*(Lg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(y?1:0),(s<<1)+(v?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(w===0?0:w<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,C,this.e2),S.primitiveLength++),v?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}let Og,Fg;ce("LineBucket",Yf,{omit:["layers","patternFeatures"]});var Bg={get paint(){return Fg=Fg||new Fr({"line-opacity":new Re(ft.paint_line["line-opacity"]),"line-color":new Re(ft.paint_line["line-color"]),"line-translate":new ge(ft.paint_line["line-translate"]),"line-translate-anchor":new ge(ft.paint_line["line-translate-anchor"]),"line-width":new Re(ft.paint_line["line-width"]),"line-gap-width":new Re(ft.paint_line["line-gap-width"]),"line-offset":new Re(ft.paint_line["line-offset"]),"line-blur":new Re(ft.paint_line["line-blur"]),"line-dasharray":new qh(ft.paint_line["line-dasharray"]),"line-pattern":new pl(ft.paint_line["line-pattern"]),"line-gradient":new lo(ft.paint_line["line-gradient"])})},get layout(){return Og=Og||new Fr({"line-cap":new ge(ft.layout_line["line-cap"]),"line-join":new Re(ft.layout_line["line-join"]),"line-miter-limit":new ge(ft.layout_line["line-miter-limit"]),"line-round-limit":new ge(ft.layout_line["line-round-limit"]),"line-sort-key":new Re(ft.layout_line["line-sort-key"])})}};class Mv extends Re{possiblyEvaluate(e,s){return s=new Oi(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(e,s)}evaluate(e,s,h,f){return s=Ve({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(e,s,h,f)}}let Yu;class Sv extends br{constructor(e){super(e,Bg),this.gradientVersion=0,Yu||(Yu=new Mv(Bg.paint.properties["line-width"].specification),Yu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof Hn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,s){super.recalculate(e,s),this.paint._values["line-floorwidth"]=Yu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Yf(e)}queryRadius(e){const s=e,h=Ng(Jh("line-width",this,s),Jh("line-gap-width",this,s)),f=Jh("line-offset",this,s);return h/2+Math.abs(f)+$u(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:s,featureState:h,geometry:f,transform:y,pixelsToTileUnits:v}){const w=Zu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-y.bearingInRadians,v),S=v/2*Ng(this.paint.get("line-width").evaluate(s,h),this.paint.get("line-gap-width").evaluate(s,h)),E=this.paint.get("line-offset").evaluate(s,h);return E&&(f=function(C,z){const N=[];for(let U=0;U<C.length;U++){const q=C[U],W=[];for(let J=0;J<q.length;J++){const rt=q[J-1],yt=q[J],lt=q[J+1],j=J===0?new V(0,0):yt.sub(rt)._unit()._perp(),X=J===q.length-1?new V(0,0):lt.sub(yt)._unit()._perp(),ut=j._add(X)._unit(),Pt=ut.x*X.x+ut.y*X.y;Pt!==0&&ut._mult(1/Pt),W.push(ut._mult(z)._add(yt))}N.push(W)}return N}(f,E*v)),function(C,z,N){for(let U=0;U<z.length;U++){const q=z[U];if(C.length>=3){for(let W=0;W<q.length;W++)if(_l(C,q[W]))return!0}if(F1(C,q,N))return!0}return!1}(w,f,S)}isTileClipped(){return!0}}function Ng(n,e){return e>0?e+2*n:n}const Tv=Wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Pv=Wi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ev=Wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Wi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gg=Wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Iv=Wi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cv(n,e,s){return n.sections.forEach(h=>{h.text=function(f,y,v){const w=y.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?f=f.toLocaleUpperCase():w==="lowercase"&&(f=f.toLocaleLowerCase()),nn.applyArabicShaping&&(f=nn.applyArabicShaping(f)),f}(h.text,e,s)}),n}Wi([{name:"triangle",components:3,type:"Uint16"}]),Wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wi([{type:"Float32",name:"offsetX"}]),Wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const hc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var jg,Jf,Ug,mr=24,Qf={};function Av(){return jg||(jg=1,Qf.read=function(n,e,s,h,f){var y,v,w=8*f-h-1,S=(1<<w)-1,E=S>>1,C=-7,z=s?f-1:0,N=s?-1:1,U=n[e+z];for(z+=N,y=U&(1<<-C)-1,U>>=-C,C+=w;C>0;y=256*y+n[e+z],z+=N,C-=8);for(v=y&(1<<-C)-1,y>>=-C,C+=h;C>0;v=256*v+n[e+z],z+=N,C-=8);if(y===0)y=1-E;else{if(y===S)return v?NaN:1/0*(U?-1:1);v+=Math.pow(2,h),y-=E}return(U?-1:1)*v*Math.pow(2,y-h)},Qf.write=function(n,e,s,h,f,y){var v,w,S,E=8*y-f-1,C=(1<<E)-1,z=C>>1,N=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=h?0:y-1,q=h?1:-1,W=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,v=C):(v=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-v))<1&&(v--,S*=2),(e+=v+z>=1?N/S:N*Math.pow(2,1-z))*S>=2&&(v++,S/=2),v+z>=C?(w=0,v=C):v+z>=1?(w=(e*S-1)*Math.pow(2,f),v+=z):(w=e*Math.pow(2,z-1)*Math.pow(2,f),v=0));f>=8;n[s+U]=255&w,U+=q,w/=256,f-=8);for(v=v<<f|w,E+=f;E>0;n[s+U]=255&v,U+=q,v/=256,E-=8);n[s+U-q]|=128*W}),Qf}function Vg(){if(Ug)return Jf;Ug=1,Jf=e;var n=Av();function e(j){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(j)?j:new Uint8Array(j||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var s=4294967296,h=1/s,f=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function y(j){return j.type===e.Bytes?j.readVarint()+j.pos:j.pos+1}function v(j,X,ut){return ut?4294967296*X+(j>>>0):4294967296*(X>>>0)+(j>>>0)}function w(j,X,ut){var Pt=X<=16383?1:X<=2097151?2:X<=268435455?3:Math.floor(Math.log(X)/(7*Math.LN2));ut.realloc(Pt);for(var jt=ut.pos-1;jt>=j;jt--)ut.buf[jt+Pt]=ut.buf[jt]}function S(j,X){for(var ut=0;ut<j.length;ut++)X.writeVarint(j[ut])}function E(j,X){for(var ut=0;ut<j.length;ut++)X.writeSVarint(j[ut])}function C(j,X){for(var ut=0;ut<j.length;ut++)X.writeFloat(j[ut])}function z(j,X){for(var ut=0;ut<j.length;ut++)X.writeDouble(j[ut])}function N(j,X){for(var ut=0;ut<j.length;ut++)X.writeBoolean(j[ut])}function U(j,X){for(var ut=0;ut<j.length;ut++)X.writeFixed32(j[ut])}function q(j,X){for(var ut=0;ut<j.length;ut++)X.writeSFixed32(j[ut])}function W(j,X){for(var ut=0;ut<j.length;ut++)X.writeFixed64(j[ut])}function J(j,X){for(var ut=0;ut<j.length;ut++)X.writeSFixed64(j[ut])}function rt(j,X){return(j[X]|j[X+1]<<8|j[X+2]<<16)+16777216*j[X+3]}function yt(j,X,ut){j[ut]=X,j[ut+1]=X>>>8,j[ut+2]=X>>>16,j[ut+3]=X>>>24}function lt(j,X){return(j[X]|j[X+1]<<8|j[X+2]<<16)+(j[X+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(j,X,ut){for(ut=ut||this.length;this.pos<ut;){var Pt=this.readVarint(),jt=Pt>>3,kt=this.pos;this.type=7&Pt,j(jt,X,this),this.pos===kt&&this.skip(Pt)}return X},readMessage:function(j,X){return this.readFields(j,X,this.readVarint()+this.pos)},readFixed32:function(){var j=rt(this.buf,this.pos);return this.pos+=4,j},readSFixed32:function(){var j=lt(this.buf,this.pos);return this.pos+=4,j},readFixed64:function(){var j=rt(this.buf,this.pos)+rt(this.buf,this.pos+4)*s;return this.pos+=8,j},readSFixed64:function(){var j=rt(this.buf,this.pos)+lt(this.buf,this.pos+4)*s;return this.pos+=8,j},readFloat:function(){var j=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,j},readDouble:function(){var j=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,j},readVarint:function(j){var X,ut,Pt=this.buf;return X=127&(ut=Pt[this.pos++]),ut<128?X:(X|=(127&(ut=Pt[this.pos++]))<<7,ut<128?X:(X|=(127&(ut=Pt[this.pos++]))<<14,ut<128?X:(X|=(127&(ut=Pt[this.pos++]))<<21,ut<128?X:function(jt,kt,Ot){var Ht,$t,Kt=Ot.buf;if(Ht=(112&($t=Kt[Ot.pos++]))>>4,$t<128||(Ht|=(127&($t=Kt[Ot.pos++]))<<3,$t<128)||(Ht|=(127&($t=Kt[Ot.pos++]))<<10,$t<128)||(Ht|=(127&($t=Kt[Ot.pos++]))<<17,$t<128)||(Ht|=(127&($t=Kt[Ot.pos++]))<<24,$t<128)||(Ht|=(1&($t=Kt[Ot.pos++]))<<31,$t<128))return v(jt,Ht,kt);throw new Error("Expected varint not more than 10 bytes")}(X|=(15&(ut=Pt[this.pos]))<<28,j,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var j=this.readVarint();return j%2==1?(j+1)/-2:j/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var j=this.readVarint()+this.pos,X=this.pos;return this.pos=j,j-X>=12&&f?function(ut,Pt,jt){return f.decode(ut.subarray(Pt,jt))}(this.buf,X,j):function(ut,Pt,jt){for(var kt="",Ot=Pt;Ot<jt;){var Ht,$t,Kt,Bt=ut[Ot],me=null,Ie=Bt>239?4:Bt>223?3:Bt>191?2:1;if(Ot+Ie>jt)break;Ie===1?Bt<128&&(me=Bt):Ie===2?(192&(Ht=ut[Ot+1]))==128&&(me=(31&Bt)<<6|63&Ht)<=127&&(me=null):Ie===3?($t=ut[Ot+2],(192&(Ht=ut[Ot+1]))==128&&(192&$t)==128&&((me=(15&Bt)<<12|(63&Ht)<<6|63&$t)<=2047||me>=55296&&me<=57343)&&(me=null)):Ie===4&&($t=ut[Ot+2],Kt=ut[Ot+3],(192&(Ht=ut[Ot+1]))==128&&(192&$t)==128&&(192&Kt)==128&&((me=(15&Bt)<<18|(63&Ht)<<12|(63&$t)<<6|63&Kt)<=65535||me>=1114112)&&(me=null)),me===null?(me=65533,Ie=1):me>65535&&(me-=65536,kt+=String.fromCharCode(me>>>10&1023|55296),me=56320|1023&me),kt+=String.fromCharCode(me),Ot+=Ie}return kt}(this.buf,X,j)},readBytes:function(){var j=this.readVarint()+this.pos,X=this.buf.subarray(this.pos,j);return this.pos=j,X},readPackedVarint:function(j,X){if(this.type!==e.Bytes)return j.push(this.readVarint(X));var ut=y(this);for(j=j||[];this.pos<ut;)j.push(this.readVarint(X));return j},readPackedSVarint:function(j){if(this.type!==e.Bytes)return j.push(this.readSVarint());var X=y(this);for(j=j||[];this.pos<X;)j.push(this.readSVarint());return j},readPackedBoolean:function(j){if(this.type!==e.Bytes)return j.push(this.readBoolean());var X=y(this);for(j=j||[];this.pos<X;)j.push(this.readBoolean());return j},readPackedFloat:function(j){if(this.type!==e.Bytes)return j.push(this.readFloat());var X=y(this);for(j=j||[];this.pos<X;)j.push(this.readFloat());return j},readPackedDouble:function(j){if(this.type!==e.Bytes)return j.push(this.readDouble());var X=y(this);for(j=j||[];this.pos<X;)j.push(this.readDouble());return j},readPackedFixed32:function(j){if(this.type!==e.Bytes)return j.push(this.readFixed32());var X=y(this);for(j=j||[];this.pos<X;)j.push(this.readFixed32());return j},readPackedSFixed32:function(j){if(this.type!==e.Bytes)return j.push(this.readSFixed32());var X=y(this);for(j=j||[];this.pos<X;)j.push(this.readSFixed32());return j},readPackedFixed64:function(j){if(this.type!==e.Bytes)return j.push(this.readFixed64());var X=y(this);for(j=j||[];this.pos<X;)j.push(this.readFixed64());return j},readPackedSFixed64:function(j){if(this.type!==e.Bytes)return j.push(this.readSFixed64());var X=y(this);for(j=j||[];this.pos<X;)j.push(this.readSFixed64());return j},skip:function(j){var X=7&j;if(X===e.Varint)for(;this.buf[this.pos++]>127;);else if(X===e.Bytes)this.pos=this.readVarint()+this.pos;else if(X===e.Fixed32)this.pos+=4;else{if(X!==e.Fixed64)throw new Error("Unimplemented type: "+X);this.pos+=8}},writeTag:function(j,X){this.writeVarint(j<<3|X)},realloc:function(j){for(var X=this.length||16;X<this.pos+j;)X*=2;if(X!==this.length){var ut=new Uint8Array(X);ut.set(this.buf),this.buf=ut,this.length=X}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(j){this.realloc(4),yt(this.buf,j,this.pos),this.pos+=4},writeSFixed32:function(j){this.realloc(4),yt(this.buf,j,this.pos),this.pos+=4},writeFixed64:function(j){this.realloc(8),yt(this.buf,-1&j,this.pos),yt(this.buf,Math.floor(j*h),this.pos+4),this.pos+=8},writeSFixed64:function(j){this.realloc(8),yt(this.buf,-1&j,this.pos),yt(this.buf,Math.floor(j*h),this.pos+4),this.pos+=8},writeVarint:function(j){(j=+j||0)>268435455||j<0?function(X,ut){var Pt,jt;if(X>=0?(Pt=X%4294967296|0,jt=X/4294967296|0):(jt=~(-X/4294967296),4294967295^(Pt=~(-X%4294967296))?Pt=Pt+1|0:(Pt=0,jt=jt+1|0)),X>=18446744073709552e3||X<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ut.realloc(10),function(kt,Ot,Ht){Ht.buf[Ht.pos++]=127&kt|128,kt>>>=7,Ht.buf[Ht.pos++]=127&kt|128,kt>>>=7,Ht.buf[Ht.pos++]=127&kt|128,kt>>>=7,Ht.buf[Ht.pos++]=127&kt|128,Ht.buf[Ht.pos]=127&(kt>>>=7)}(Pt,0,ut),function(kt,Ot){var Ht=(7&kt)<<4;Ot.buf[Ot.pos++]|=Ht|((kt>>>=3)?128:0),kt&&(Ot.buf[Ot.pos++]=127&kt|((kt>>>=7)?128:0),kt&&(Ot.buf[Ot.pos++]=127&kt|((kt>>>=7)?128:0),kt&&(Ot.buf[Ot.pos++]=127&kt|((kt>>>=7)?128:0),kt&&(Ot.buf[Ot.pos++]=127&kt|((kt>>>=7)?128:0),kt&&(Ot.buf[Ot.pos++]=127&kt)))))}(jt,ut)}(j,this):(this.realloc(4),this.buf[this.pos++]=127&j|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=j>>>7&127))))},writeSVarint:function(j){this.writeVarint(j<0?2*-j-1:2*j)},writeBoolean:function(j){this.writeVarint(!!j)},writeString:function(j){j=String(j),this.realloc(4*j.length),this.pos++;var X=this.pos;this.pos=function(Pt,jt,kt){for(var Ot,Ht,$t=0;$t<jt.length;$t++){if((Ot=jt.charCodeAt($t))>55295&&Ot<57344){if(!Ht){Ot>56319||$t+1===jt.length?(Pt[kt++]=239,Pt[kt++]=191,Pt[kt++]=189):Ht=Ot;continue}if(Ot<56320){Pt[kt++]=239,Pt[kt++]=191,Pt[kt++]=189,Ht=Ot;continue}Ot=Ht-55296<<10|Ot-56320|65536,Ht=null}else Ht&&(Pt[kt++]=239,Pt[kt++]=191,Pt[kt++]=189,Ht=null);Ot<128?Pt[kt++]=Ot:(Ot<2048?Pt[kt++]=Ot>>6|192:(Ot<65536?Pt[kt++]=Ot>>12|224:(Pt[kt++]=Ot>>18|240,Pt[kt++]=Ot>>12&63|128),Pt[kt++]=Ot>>6&63|128),Pt[kt++]=63&Ot|128)}return kt}(this.buf,j,this.pos);var ut=this.pos-X;ut>=128&&w(X,ut,this),this.pos=X-1,this.writeVarint(ut),this.pos+=ut},writeFloat:function(j){this.realloc(4),n.write(this.buf,j,this.pos,!0,23,4),this.pos+=4},writeDouble:function(j){this.realloc(8),n.write(this.buf,j,this.pos,!0,52,8),this.pos+=8},writeBytes:function(j){var X=j.length;this.writeVarint(X),this.realloc(X);for(var ut=0;ut<X;ut++)this.buf[this.pos++]=j[ut]},writeRawMessage:function(j,X){this.pos++;var ut=this.pos;j(X,this);var Pt=this.pos-ut;Pt>=128&&w(ut,Pt,this),this.pos=ut-1,this.writeVarint(Pt),this.pos+=Pt},writeMessage:function(j,X,ut){this.writeTag(j,e.Bytes),this.writeRawMessage(X,ut)},writePackedVarint:function(j,X){X.length&&this.writeMessage(j,S,X)},writePackedSVarint:function(j,X){X.length&&this.writeMessage(j,E,X)},writePackedBoolean:function(j,X){X.length&&this.writeMessage(j,N,X)},writePackedFloat:function(j,X){X.length&&this.writeMessage(j,C,X)},writePackedDouble:function(j,X){X.length&&this.writeMessage(j,z,X)},writePackedFixed32:function(j,X){X.length&&this.writeMessage(j,U,X)},writePackedSFixed32:function(j,X){X.length&&this.writeMessage(j,q,X)},writePackedFixed64:function(j,X){X.length&&this.writeMessage(j,W,X)},writePackedSFixed64:function(j,X){X.length&&this.writeMessage(j,J,X)},writeBytesField:function(j,X){this.writeTag(j,e.Bytes),this.writeBytes(X)},writeFixed32Field:function(j,X){this.writeTag(j,e.Fixed32),this.writeFixed32(X)},writeSFixed32Field:function(j,X){this.writeTag(j,e.Fixed32),this.writeSFixed32(X)},writeFixed64Field:function(j,X){this.writeTag(j,e.Fixed64),this.writeFixed64(X)},writeSFixed64Field:function(j,X){this.writeTag(j,e.Fixed64),this.writeSFixed64(X)},writeVarintField:function(j,X){this.writeTag(j,e.Varint),this.writeVarint(X)},writeSVarintField:function(j,X){this.writeTag(j,e.Varint),this.writeSVarint(X)},writeStringField:function(j,X){this.writeTag(j,e.Bytes),this.writeString(X)},writeFloatField:function(j,X){this.writeTag(j,e.Fixed32),this.writeFloat(X)},writeDoubleField:function(j,X){this.writeTag(j,e.Fixed64),this.writeDouble(X)},writeBooleanField:function(j,X){this.writeVarintField(j,!!X)}},Jf}var ga,tp=P(Vg());function Rv(n,e,s){n===1&&s.readMessage(kv,e)}function kv(n,e,s){if(n===3){const{id:h,bitmap:f,width:y,height:v,left:w,top:S,advance:E}=s.readMessage(Dv,{});e.push({id:h,bitmap:new Qh({width:y+6,height:v+6},f),metrics:{width:y,height:v,left:w,top:S,advance:E}})}}function Dv(n,e,s){n===1?e.id=s.readVarint():n===2?e.bitmap=s.readBytes():n===3?e.width=s.readVarint():n===4?e.height=s.readVarint():n===5?e.left=s.readSVarint():n===6?e.top=s.readSVarint():n===7&&(e.advance=s.readVarint())}function qg(n){let e=0,s=0;for(const v of n)e+=v.w*v.h,s=Math.max(s,v.w);n.sort((v,w)=>w.h-v.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let f=0,y=0;for(const v of n)for(let w=h.length-1;w>=0;w--){const S=h[w];if(!(v.w>S.w||v.h>S.h)){if(v.x=S.x,v.y=S.y,y=Math.max(y,v.y+v.h),f=Math.max(f,v.x+v.w),v.w===S.w&&v.h===S.h){const E=h.pop();w<h.length&&(h[w]=E)}else v.h===S.h?(S.x+=v.w,S.w-=v.w):v.w===S.w?(S.y+=v.h,S.h-=v.h):(h.push({x:S.x+v.w,y:S.y,w:S.w-v.w,h:v.h}),S.y+=v.h,S.h-=v.h);break}}return{w:f,h:y,fill:e/(f*y)||0}}class ep{constructor(e,{pixelRatio:s,version:h,stretchX:f,stretchY:y,content:v,textFitWidth:w,textFitHeight:S}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=f,this.stretchY=y,this.content=v,this.version=h,this.textFitWidth=w,this.textFitHeight=S}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class $g{constructor(e,s){const h={},f={};this.haveRenderCallbacks=[];const y=[];this.addImages(e,h,y),this.addImages(s,f,y);const{w:v,h:w}=qg(y),S=new ts({width:v||1,height:w||1});for(const E in e){const C=e[E],z=h[E].paddedRect;ts.copy(C.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},C.data)}for(const E in s){const C=s[E],z=f[E].paddedRect,N=z.x+1,U=z.y+1,q=C.data.width,W=C.data.height;ts.copy(C.data,S,{x:0,y:0},{x:N,y:U},C.data),ts.copy(C.data,S,{x:0,y:W-1},{x:N,y:U-1},{width:q,height:1}),ts.copy(C.data,S,{x:0,y:0},{x:N,y:U+W},{width:q,height:1}),ts.copy(C.data,S,{x:q-1,y:0},{x:N-1,y:U},{width:1,height:W}),ts.copy(C.data,S,{x:0,y:0},{x:N+q,y:U},{width:1,height:W})}this.image=S,this.iconPositions=h,this.patternPositions=f}addImages(e,s,h){for(const f in e){const y=e[f],v={x:0,y:0,w:y.data.width+2,h:y.data.height+2};h.push(v),s[f]=new ep(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in e.updatedImages)this.patchUpdatedImage(this.iconPositions[h],e.getImage(h),s),this.patchUpdatedImage(this.patternPositions[h],e.getImage(h),s)}patchUpdatedImage(e,s,h){if(!e||!s||e.version===s.version)return;e.version=s.version;const[f,y]=e.tl;h.update(s.data,void 0,{x:f,y})}}ce("ImagePosition",ep),ce("ImageAtlas",$g),m.an=void 0,(ga=m.an||(m.an={}))[ga.none=0]="none",ga[ga.horizontal=1]="horizontal",ga[ga.vertical=2]="vertical",ga[ga.horizontalOnly=3]="horizontalOnly";class cc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(e,s,h){const f=new cc;return f.scale=e||1,f.fontStack=s,f.verticalAlign=h||"bottom",f}static forImage(e,s){const h=new cc;return h.imageName=e,h.verticalAlign=s||"bottom",h}}class bl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const h=new bl;for(let f=0;f<e.sections.length;f++){const y=e.sections[f];y.image?h.addImageSection(y):h.addTextSection(y,s)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let s="";for(let h=0;h<e.length;h++){const f=e.charCodeAt(h+1)||null,y=e.charCodeAt(h-1)||null;s+=f&&jh(f)&&!hc[e[h+1]]||y&&jh(y)&&!hc[e[h-1]]||!hc[e[h]]?e[h]:hc[e[h]]}return s}(this.text)}trim(){let e=0;for(let h=0;h<this.text.length&&Qu[this.text.charCodeAt(h)];h++)e++;let s=this.text.length;for(let h=this.text.length-1;h>=0&&h>=e&&Qu[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const h=new bl;return h.text=this.text.substring(e,s),h.sectionIndex=this.sectionIndex.slice(e,s),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}getMaxImageSize(e){let s=0,h=0;for(let f=0;f<this.length();f++){const y=this.getSection(f);if(y.imageName){const v=e[y.imageName];if(!v)continue;const w=v.displaySize;s=Math.max(s,w[0]),h=Math.max(h,w[1])}}return{maxImageWidth:s,maxImageHeight:h}}addTextSection(e,s){this.text+=e.text,this.sections.push(cc.forText(e.scale,e.fontStack||s,e.verticalAlign));const h=this.sections.length-1;for(let f=0;f<e.text.length;++f)this.sectionIndex.push(h)}addImageSection(e){const s=e.image?e.image.name:"";if(s.length===0)return void he("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(cc.forImage(s,e.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):he("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ju(n,e,s,h,f,y,v,w,S,E,C,z,N,U,q){const W=bl.fromFeature(n,f);let J;z===m.an.vertical&&W.verticalizePunctuation();const{processBidirectionalText:rt,processStyledBidirectionalText:yt}=nn;if(rt&&W.sections.length===1){J=[];const X=rt(W.toString(),ip(W,E,y,e,h,U));for(const ut of X){const Pt=new bl;Pt.text=ut,Pt.sections=W.sections;for(let jt=0;jt<ut.length;jt++)Pt.sectionIndex.push(0);J.push(Pt)}}else if(yt){J=[];const X=yt(W.text,W.sectionIndex,ip(W,E,y,e,h,U));for(const ut of X){const Pt=new bl;Pt.text=ut[0],Pt.sectionIndex=ut[1],Pt.sections=W.sections,J.push(Pt)}}else J=function(X,ut){const Pt=[],jt=X.text;let kt=0;for(const Ot of ut)Pt.push(X.substring(kt,Ot)),kt=Ot;return kt<jt.length&&Pt.push(X.substring(kt,jt.length)),Pt}(W,ip(W,E,y,e,h,U));const lt=[],j={positionedLines:lt,text:W.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(X,ut,Pt,jt,kt,Ot,Ht,$t,Kt,Bt,me,Ie){let Te=0,ve=0,li=0,Hi=0;const lr=$t==="right"?1:$t==="left"?0:.5,kr=mr/Ie;let Ss=0;for(const qi of kt){qi.trim();const gr=qi.getMaxScale(),Pr={positionedGlyphs:[],lineOffset:0};X.positionedLines[Ss]=Pr;const Er=Pr.positionedGlyphs;let Kr=0;if(!qi.length()){ve+=Ot,++Ss;continue}const Ts=Fv(jt,qi,kr);for(let is=0;is<qi.length();is++){const hr=qi.getSection(is),yr=qi.getSectionIndex(is),vr=qi.getCharCode(is),nr=Bv(Kt,me,vr);let Li;if(hr.imageName){if(X.iconsInText=!0,hr.scale=hr.scale*kr,Li=Gv(hr,nr,gr,Ts,jt),!Li)continue;Kr=Math.max(Kr,Li.imageOffset)}else if(Li=Nv(hr,vr,nr,Ts,ut,Pt),!Li)continue;const{rect:Zs,metrics:Tl,baselineOffset:Ws}=Li;Er.push({glyph:vr,imageName:hr.imageName,x:Te,y:ve+Ws+-17,vertical:nr,scale:hr.scale,fontStack:hr.fontStack,sectionIndex:yr,metrics:Tl,rect:Zs}),nr?(X.verticalizable=!0,Te+=(hr.imageName?Tl.advance:mr)*hr.scale+Bt):Te+=Tl.advance*hr.scale+Bt}Er.length!==0&&(li=Math.max(Te-Bt,li),jv(Er,0,Er.length-1,lr)),Te=0,Pr.lineOffset=Math.max(Kr,(gr-1)*mr);const _r=Ot*gr+Kr;ve+=_r,Hi=Math.max(_r,Hi),++Ss}const{horizontalAlign:es,verticalAlign:Tr}=rp(Ht);(function(qi,gr,Pr,Er,Kr,Ts,_r,is,hr){const yr=(gr-Pr)*Kr;let vr=0;vr=Ts!==_r?-is*Er- -17:-Er*hr*_r+.5*_r;for(const nr of qi)for(const Li of nr.positionedGlyphs)Li.x+=yr,Li.y+=vr})(X.positionedLines,lr,es,Tr,li,Hi,Ot,ve,kt.length),X.top+=-Tr*ve,X.bottom=X.top+ve,X.left+=-es*li,X.right=X.left+li}(j,e,s,h,J,v,w,S,z,E,N,q),!function(X){for(const ut of X)if(ut.positionedGlyphs.length!==0)return!1;return!0}(lt)&&j}const Qu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Lv={40:!0};function Zg(n,e,s,h,f,y){if(e.imageName){const v=h[e.imageName];return v?v.displaySize[0]*e.scale*mr/y+f:0}{const v=s[e.fontStack],w=v&&v[n];return w?w.metrics.advance*e.scale+f:0}}function Wg(n,e,s,h){const f=Math.pow(n-e,2);return h?n<e?f/2:2*f:f+Math.abs(s)*s}function Ov(n,e,s){let h=0;return n===10&&(h-=1e4),s&&(h+=150),n!==40&&n!==65288||(h+=50),e!==41&&e!==65289||(h+=50),h}function Hg(n,e,s,h,f,y){let v=null,w=Wg(e,s,f,y);for(const S of h){const E=Wg(e-S.x,s,f,y)+S.badness;E<=w&&(v=S,w=E)}return{index:n,x:e,priorBreak:v,badness:w}}function Xg(n){return n?Xg(n.priorBreak).concat(n.index):[]}function ip(n,e,s,h,f,y){if(!n)return[];const v=[],w=function(z,N,U,q,W,J){let rt=0;for(let yt=0;yt<z.length();yt++){const lt=z.getSection(yt);rt+=Zg(z.getCharCode(yt),lt,q,W,N,J)}return rt/Math.max(1,Math.ceil(rt/U))}(n,e,s,h,f,y),S=n.text.indexOf("​")>=0;let E=0;for(let z=0;z<n.length();z++){const N=n.getSection(z),U=n.getCharCode(z);if(Qu[U]||(E+=Zg(U,N,h,f,e,y)),z<n.length()-1){const q=!((C=U)<11904)&&(!!ai["CJK Compatibility Forms"](C)||!!ai["CJK Compatibility"](C)||!!ai["CJK Strokes"](C)||!!ai["CJK Symbols and Punctuation"](C)||!!ai["Enclosed CJK Letters and Months"](C)||!!ai["Halfwidth and Fullwidth Forms"](C)||!!ai["Ideographic Description Characters"](C)||!!ai["Vertical Forms"](C)||Gh.test(String.fromCodePoint(C)));(zv[U]||q||N.imageName||z!==n.length()-2&&Lv[n.getCharCode(z+1)])&&v.push(Hg(z+1,E,w,v,Ov(U,n.getCharCode(z+1),q&&S),!1))}}var C;return Xg(Hg(n.length(),E,w,v,0,!0))}function rp(n){let e=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function Fv(n,e,s){const h=e.getMaxScale()*mr,{maxImageWidth:f,maxImageHeight:y}=e.getMaxImageSize(n),v=Math.max(h,y*s);return{verticalLineContentWidth:Math.max(h,f*s),horizontalLineContentHeight:v}}function Kg(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function Bv(n,e,s){return!(n===m.an.horizontal||!e&&!ul(s)||e&&(Qu[s]||(h=s,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(h)))));var h}function Nv(n,e,s,h,f,y){const v=y[n.fontStack],w=function(E,C,z,N){if(E&&E.rect)return E;const U=C[z.fontStack],q=U&&U[N];return q?{rect:null,metrics:q.metrics}:null}(v&&v[e],f,n,e);if(w===null)return null;let S;if(s)S=h.verticalLineContentWidth-n.scale*mr;else{const E=Kg(n.verticalAlign);S=(h.horizontalLineContentHeight-n.scale*mr)*E}return{rect:w.rect,metrics:w.metrics,baselineOffset:S}}function Gv(n,e,s,h,f){const y=f[n.imageName];if(!y)return null;const v=y.paddedRect,w=y.displaySize,S={width:w[0],height:w[1],left:1,top:-3,advance:e?w[1]:w[0]};let E;if(e)E=h.verticalLineContentWidth-w[1]*n.scale;else{const C=Kg(n.verticalAlign);E=(h.horizontalLineContentHeight-w[1]*n.scale)*C}return{rect:v,metrics:S,baselineOffset:E,imageOffset:(e?w[0]:w[1])*n.scale-mr*s}}function jv(n,e,s,h){if(h===0)return;const f=n[s],y=(n[s].x+f.metrics.advance*f.scale)*h;for(let v=e;v<=s;v++)n[v].x-=y}function Uv(n,e,s){const{horizontalAlign:h,verticalAlign:f}=rp(s),y=e[0]-n.displaySize[0]*h,v=e[1]-n.displaySize[1]*f;return{image:n,top:v,bottom:v+n.displaySize[1],left:y,right:y+n.displaySize[0]}}function Yg(n){var e,s;let h=n.left,f=n.top,y=n.right-h,v=n.bottom-f;const w=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",S=(s=n.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",E=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(S==="proportional"){if(w==="stretchOnly"&&y/v<E||w==="proportional"){const C=Math.ceil(v*E);h*=C/y,y=C}}else if(w==="proportional"&&S==="stretchOnly"&&E!==0&&y/v>E){const C=Math.ceil(y/E);f*=C/v,v=C}return{x1:h,y1:f,x2:h+y,y2:f+v}}function Jg(n,e,s,h,f,y){const v=n.image;let w;if(v.content){const J=v.content,rt=v.pixelRatio||1;w=[J[0]/rt,J[1]/rt,v.displaySize[0]-J[2]/rt,v.displaySize[1]-J[3]/rt]}const S=e.left*y,E=e.right*y;let C,z,N,U;s==="width"||s==="both"?(U=f[0]+S-h[3],z=f[0]+E+h[1]):(U=f[0]+(S+E-v.displaySize[0])/2,z=U+v.displaySize[0]);const q=e.top*y,W=e.bottom*y;return s==="height"||s==="both"?(C=f[1]+q-h[0],N=f[1]+W+h[2]):(C=f[1]+(q+W-v.displaySize[1])/2,N=C+v.displaySize[1]),{image:v,top:C,right:z,bottom:N,left:U,collisionPadding:w}}const On=128,_a=32640;function Qg(n,e){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Oi(n+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:f}=s;let y=0;for(;y<h.length&&h[y]<=n;)y++;y=Math.max(0,y-1);let v=y;for(;v<h.length&&h[v]<n+1;)v++;v=Math.min(h.length-1,v);const w=h[y],S=h[v];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:S,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:S,minSize:s.evaluate(new Oi(w)),maxSize:s.evaluate(new Oi(S)),interpolationType:f}}}function sp(n,e,s){let h="never";const f=n.get(e);return f?h=f:n.get(s)&&(h="always"),h}const Vv=ac.VectorTileFeature.types,qv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function td(n,e,s,h,f,y,v,w,S,E,C,z,N){const U=w?Math.min(_a,Math.round(w[0])):0,q=w?Math.min(_a,Math.round(w[1])):0;n.emplaceBack(e,s,Math.round(32*h),Math.round(32*f),y,v,(U<<1)+(S?1:0),q,16*E,16*C,256*z,256*N)}function np(n,e,s){n.emplaceBack(e.x,e.y,s),n.emplaceBack(e.x,e.y,s),n.emplaceBack(e.x,e.y,s),n.emplaceBack(e.x,e.y,s)}function $v(n){for(const e of n.sections)if(Uh(e.text))return!0;return!1}class ap{constructor(e){this.layoutVertexArray=new ti,this.indexArray=new Ii,this.programConfigurations=e,this.segments=new pi,this.dynamicLayoutVertexArray=new xi,this.opacityVertexArray=new Ui,this.hasVisibleVertices=!1,this.placedSymbolArray=new et}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,s,h,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Pv.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,qv,!0),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ce("SymbolBuffers",ap);class op{constructor(e,s,h){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new h,this.segments=new pi,this.collisionVertexArray=new Vi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ev.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ce("CollisionBuffers",op);class wl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.globalState=e.globalState,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(v=>v.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qg(this.zoom,s["text-size"]),this.iconSizeData=Qg(this.zoom,s["icon-size"]);const h=this.layers[0].layout,f=h.get("symbol-sort-key"),y=h.get("symbol-z-order");this.canOverlap=sp(h,"text-overlap","text-allow-overlap")!=="never"||sp(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(v=>m.an[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=e.sourceID}createArrays(){this.text=new ap(new dn(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ap(new dn(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new at,this.lineVertexArray=new dt,this.symbolInstances=new ht,this.textAnchorOffsets=new ot}calculateGlyphDependencies(e,s,h,f,y){for(let v=0;v<e.length;v++)if(s[e.charCodeAt(v)]=!0,(h||f)&&y){const w=hc[e.charAt(v)];w&&(s[w.charCodeAt(0)]=!0)}}populate(e,s,h){const f=this.layers[0],y=f.layout,v=y.get("text-font"),w=y.get("text-field"),S=y.get("icon-image"),E=(w.value.kind!=="constant"||w.value.value instanceof Cr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),C=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,z=y.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const N=s.iconDependencies,U=s.glyphDependencies,q=s.availableImages,W=new Oi(this.zoom,{globalState:this.globalState});for(const{feature:J,id:rt,index:yt,sourceLayerIndex:lt}of e){const j=f._featureFilter.needGeometry,X=go(J,j);if(!f._featureFilter.filter(W,X,h))continue;let ut,Pt;if(j||(X.geometry=mo(J)),E){const kt=f.getValueAndResolveTokens("text-field",X,h,q),Ot=Cr.factory(kt),Ht=this.hasRTLText=this.hasRTLText||$v(Ot);(!Ht||nn.getRTLTextPluginStatus()==="unavailable"||Ht&&nn.isParsed())&&(ut=Cv(Ot,f,X))}if(C){const kt=f.getValueAndResolveTokens("icon-image",X,h,q);Pt=kt instanceof Zr?kt:Zr.fromString(kt)}if(!ut&&!Pt)continue;const jt=this.sortFeaturesByKey?z.evaluate(X,{},h):void 0;if(this.features.push({id:rt,text:ut,icon:Pt,index:yt,sourceLayerIndex:lt,geometry:X.geometry,properties:J.properties,type:Vv[J.type],sortKey:jt}),Pt&&(N[Pt.name]=!0),ut){const kt=v.evaluate(X,{},h).join(","),Ot=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.an.vertical)>=0;for(const Ht of ut.sections)if(Ht.image)N[Ht.image.name]=!0;else{const $t=Nh(ut.toString()),Kt=Ht.fontStack||kt,Bt=U[Kt]=U[Kt]||{};this.calculateGlyphDependencies(Ht.text,Bt,Ot,this.allowVerticalPlacement,$t)}}}y.get("symbol-placement")==="line"&&(this.features=function(J){const rt={},yt={},lt=[];let j=0;function X(kt){lt.push(J[kt]),j++}function ut(kt,Ot,Ht){const $t=yt[kt];return delete yt[kt],yt[Ot]=$t,lt[$t].geometry[0].pop(),lt[$t].geometry[0]=lt[$t].geometry[0].concat(Ht[0]),$t}function Pt(kt,Ot,Ht){const $t=rt[Ot];return delete rt[Ot],rt[kt]=$t,lt[$t].geometry[0].shift(),lt[$t].geometry[0]=Ht[0].concat(lt[$t].geometry[0]),$t}function jt(kt,Ot,Ht){const $t=Ht?Ot[0][Ot[0].length-1]:Ot[0][0];return`${kt}:${$t.x}:${$t.y}`}for(let kt=0;kt<J.length;kt++){const Ot=J[kt],Ht=Ot.geometry,$t=Ot.text?Ot.text.toString():null;if(!$t){X(kt);continue}const Kt=jt($t,Ht),Bt=jt($t,Ht,!0);if(Kt in yt&&Bt in rt&&yt[Kt]!==rt[Bt]){const me=Pt(Kt,Bt,Ht),Ie=ut(Kt,Bt,lt[me].geometry);delete rt[Kt],delete yt[Bt],yt[jt($t,lt[Ie].geometry,!0)]=Ie,lt[me].geometry=null}else Kt in yt?ut(Kt,Bt,Ht):Bt in rt?Pt(Kt,Bt,Ht):(X(kt),rt[Kt]=j-1,yt[Bt]=j-1)}return lt.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,rt)=>J.sortKey-rt.sortKey)}update(e,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,h),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const h=this.lineVertexArray.length;if(e.segment!==void 0){let f=e.dist(s[e.segment+1]),y=e.dist(s[e.segment]);const v={};for(let w=e.segment+1;w<s.length;w++)v[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:f},w<s.length-1&&(f+=s[w+1].dist(s[w]));for(let w=e.segment||0;w>=0;w--)v[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:y},w>0&&(y+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const S=v[w];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(e,s,h,f,y,v,w,S,E,C,z,N){const U=e.indexArray,q=e.layoutVertexArray,W=e.segments.prepareSegment(4*s.length,q,U,this.canOverlap?v.sortKey:void 0),J=this.glyphOffsetArray.length,rt=W.vertexLength,yt=this.allowVerticalPlacement&&w===m.an.vertical?Math.PI/2:0,lt=v.text&&v.text.sections;for(let j=0;j<s.length;j++){const{tl:X,tr:ut,bl:Pt,br:jt,tex:kt,pixelOffsetTL:Ot,pixelOffsetBR:Ht,minFontScaleX:$t,minFontScaleY:Kt,glyphOffset:Bt,isSDF:me,sectionIndex:Ie}=s[j],Te=W.vertexLength,ve=Bt[1];td(q,S.x,S.y,X.x,ve+X.y,kt.x,kt.y,h,me,Ot.x,Ot.y,$t,Kt),td(q,S.x,S.y,ut.x,ve+ut.y,kt.x+kt.w,kt.y,h,me,Ht.x,Ot.y,$t,Kt),td(q,S.x,S.y,Pt.x,ve+Pt.y,kt.x,kt.y+kt.h,h,me,Ot.x,Ht.y,$t,Kt),td(q,S.x,S.y,jt.x,ve+jt.y,kt.x+kt.w,kt.y+kt.h,h,me,Ht.x,Ht.y,$t,Kt),np(e.dynamicLayoutVertexArray,S,yt),U.emplaceBack(Te,Te+2,Te+1),U.emplaceBack(Te+1,Te+2,Te+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Bt[0]),j!==s.length-1&&Ie===s[j+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,v,v.index,{},N,lt&&lt[Ie])}e.placedSymbolArray.emplaceBack(S.x,S.y,J,this.glyphOffsetArray.length-J,rt,E,C,S.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],w,0,!1,0,z)}_addCollisionDebugVertex(e,s,h,f,y,v){return s.emplaceBack(0,0),e.emplaceBack(h.x,h.y,f,y,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(e,s,h,f,y,v,w){const S=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),E=S.vertexLength,C=y.layoutVertexArray,z=y.collisionVertexArray,N=w.anchorX,U=w.anchorY;this._addCollisionDebugVertex(C,z,v,N,U,new V(e,s)),this._addCollisionDebugVertex(C,z,v,N,U,new V(h,s)),this._addCollisionDebugVertex(C,z,v,N,U,new V(h,f)),this._addCollisionDebugVertex(C,z,v,N,U,new V(e,f)),S.vertexLength+=4;const q=y.indexArray;q.emplaceBack(E,E+1),q.emplaceBack(E+1,E+2),q.emplaceBack(E+2,E+3),q.emplaceBack(E+3,E),S.primitiveLength+=4}addDebugCollisionBoxes(e,s,h,f){for(let y=e;y<s;y++){const v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,f?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new op(Ti,Gg.members,Pi),this.iconCollisionBox=new op(Ti,Gg.members,Pi);for(let e=0;e<this.symbolInstances.length;e++){const s=this.symbolInstances.get(e);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(e,s,h,f,y,v,w,S,E){const C={};for(let z=s;z<h;z++){const N=e.get(z);C.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},C.textFeatureIndex=N.featureIndex;break}for(let z=f;z<y;z++){const N=e.get(z);C.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},C.verticalTextFeatureIndex=N.featureIndex;break}for(let z=v;z<w;z++){const N=e.get(z);C.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},C.iconFeatureIndex=N.featureIndex;break}for(let z=S;z<E;z++){const N=e.get(z);C.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},C.verticalIconFeatureIndex=N.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const h=e.placedSymbolArray.get(s),f=h.vertexStartIndex+4*h.numGlyphs;for(let y=h.vertexStartIndex;y<f;y+=4)e.indexArray.emplaceBack(y,y+2,y+1),e.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(e),h=Math.cos(e),f=[],y=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const S=this.symbolInstances.get(w);f.push(0|Math.round(s*S.anchorX+h*S.anchorY)),y.push(S.featureIndex)}return v.sort((w,S)=>f[w]-f[S]||y[S]-y[w]),v}addToSortKeyRanges(e,s){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===s?h.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const h=this.symbolInstances.get(s);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((f,y,v)=>{f>=0&&v.indexOf(f)===y&&this.addIndicesForPlacedSymbol(this.text,f)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let t_,e_;ce("SymbolBucket",wl,{omit:["layers","collisionBoxArray","features","compareText"]}),wl.MAX_GLYPHS=65535,wl.addDynamicAttributes=np;var lp={get paint(){return e_=e_||new Fr({"icon-opacity":new Re(ft.paint_symbol["icon-opacity"]),"icon-color":new Re(ft.paint_symbol["icon-color"]),"icon-halo-color":new Re(ft.paint_symbol["icon-halo-color"]),"icon-halo-width":new Re(ft.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Re(ft.paint_symbol["icon-halo-blur"]),"icon-translate":new ge(ft.paint_symbol["icon-translate"]),"icon-translate-anchor":new ge(ft.paint_symbol["icon-translate-anchor"]),"text-opacity":new Re(ft.paint_symbol["text-opacity"]),"text-color":new Re(ft.paint_symbol["text-color"],{runtimeType:ur,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Re(ft.paint_symbol["text-halo-color"]),"text-halo-width":new Re(ft.paint_symbol["text-halo-width"]),"text-halo-blur":new Re(ft.paint_symbol["text-halo-blur"]),"text-translate":new ge(ft.paint_symbol["text-translate"]),"text-translate-anchor":new ge(ft.paint_symbol["text-translate-anchor"])})},get layout(){return t_=t_||new Fr({"symbol-placement":new ge(ft.layout_symbol["symbol-placement"]),"symbol-spacing":new ge(ft.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ge(ft.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Re(ft.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ge(ft.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ge(ft.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ge(ft.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ge(ft.layout_symbol["icon-ignore-placement"]),"icon-optional":new ge(ft.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ge(ft.layout_symbol["icon-rotation-alignment"]),"icon-size":new Re(ft.layout_symbol["icon-size"]),"icon-text-fit":new ge(ft.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ge(ft.layout_symbol["icon-text-fit-padding"]),"icon-image":new Re(ft.layout_symbol["icon-image"]),"icon-rotate":new Re(ft.layout_symbol["icon-rotate"]),"icon-padding":new Re(ft.layout_symbol["icon-padding"]),"icon-keep-upright":new ge(ft.layout_symbol["icon-keep-upright"]),"icon-offset":new Re(ft.layout_symbol["icon-offset"]),"icon-anchor":new Re(ft.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ge(ft.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ge(ft.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ge(ft.layout_symbol["text-rotation-alignment"]),"text-field":new Re(ft.layout_symbol["text-field"]),"text-font":new Re(ft.layout_symbol["text-font"]),"text-size":new Re(ft.layout_symbol["text-size"]),"text-max-width":new Re(ft.layout_symbol["text-max-width"]),"text-line-height":new ge(ft.layout_symbol["text-line-height"]),"text-letter-spacing":new Re(ft.layout_symbol["text-letter-spacing"]),"text-justify":new Re(ft.layout_symbol["text-justify"]),"text-radial-offset":new Re(ft.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ge(ft.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Re(ft.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Re(ft.layout_symbol["text-anchor"]),"text-max-angle":new ge(ft.layout_symbol["text-max-angle"]),"text-writing-mode":new ge(ft.layout_symbol["text-writing-mode"]),"text-rotate":new Re(ft.layout_symbol["text-rotate"]),"text-padding":new ge(ft.layout_symbol["text-padding"]),"text-keep-upright":new ge(ft.layout_symbol["text-keep-upright"]),"text-transform":new Re(ft.layout_symbol["text-transform"]),"text-offset":new Re(ft.layout_symbol["text-offset"]),"text-allow-overlap":new ge(ft.layout_symbol["text-allow-overlap"]),"text-overlap":new ge(ft.layout_symbol["text-overlap"]),"text-ignore-placement":new ge(ft.layout_symbol["text-ignore-placement"]),"text-optional":new ge(ft.layout_symbol["text-optional"])})}};class i_{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ls,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ce("FormatSectionOverride",i_,{omit:["defaultValue"]});class ed extends br{constructor(e){super(e,lp)}recalculate(e,s){if(super.recalculate(e,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const f=[];for(const y of h)f.indexOf(y)<0&&f.push(y);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,s,h,f){const y=this.layout.get(e).evaluate(s,{},h,f),v=this._unevaluatedLayout._values[e];return v.isDataDriven()||Jo(v.value)||!y?y:function(w,S){return S.replace(/{([^{}]+)}/g,(E,C)=>w&&C in w?String(w[C]):"")}(s.properties,y)}createBucket(e){return new wl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of lp.paint.overridableProperties){if(!ed.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),h=new i_(s),f=new Yo(h,s.property.specification);let y=null;y=s.value.kind==="constant"||s.value.kind==="source"?new Ya("source",f):new tl("composite",f,s.value.zoomStops),this.paint._values[e]=new ks(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,h){return!(!this.layout||s.isDataDriven()||h.isDataDriven())&&ed.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const h=e.get("text-field"),f=lp.paint.properties[s];let y=!1;const v=w=>{for(const S of w)if(f.overrides&&f.overrides.hasOverride(S))return void(y=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Cr)v(h.value.value.sections);else if(h.value.kind==="source"){const w=E=>{y||(E instanceof zr&&Fe(E.value)===Mn?v(E.value.sections):E instanceof qa?v(E.sections):E.eachChild(w))},S=h.value;S._styleExpression&&w(S._styleExpression.expression)}return y}}let r_;var Zv={get paint(){return r_=r_||new Fr({"background-color":new ge(ft.paint_background["background-color"]),"background-pattern":new qh(ft.paint_background["background-pattern"]),"background-opacity":new ge(ft.paint_background["background-opacity"])})}};class Wv extends br{constructor(e){super(e,Zv)}}let s_;var Hv={get paint(){return s_=s_||new Fr({"raster-opacity":new ge(ft.paint_raster["raster-opacity"]),"raster-hue-rotate":new ge(ft.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ge(ft.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ge(ft.paint_raster["raster-brightness-max"]),"raster-saturation":new ge(ft.paint_raster["raster-saturation"]),"raster-contrast":new ge(ft.paint_raster["raster-contrast"]),"raster-resampling":new ge(ft.paint_raster["raster-resampling"]),"raster-fade-duration":new ge(ft.paint_raster["raster-fade-duration"])})}};class Xv extends br{constructor(e){super(e,Hv)}}class Kv extends br{constructor(e){super(e,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Yv{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Jv={once:!0},hp=63710088e-1;class ya{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ya(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,h=this.lat*s,f=e.lat*s,y=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((e.lng-this.lng)*s);return hp*Math.acos(Math.min(y,1))}static convert(e){if(e instanceof ya)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ya(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ya(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const n_=2*Math.PI*hp;function a_(n){return n_*Math.cos(n*Math.PI/180)}function o_(n){return(180+n)/360}function l_(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function h_(n,e){return n/a_(e)}function cp(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function c_(n,e){return n*a_(cp(e))}class uc{constructor(e,s,h=0){this.x=+e,this.y=+s,this.z=+h}static fromLngLat(e,s=0){const h=ya.convert(e);return new uc(o_(h.lng),l_(h.lat),h_(s,h.lat))}toLngLat(){return new ya(360*this.x-180,cp(this.y))}toAltitude(){return c_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/n_*(e=cp(this.y),1/Math.cos(e*Math.PI/180));var e}}function u_(n,e,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[n*h-2*Math.PI*6378137/2,e*h-2*Math.PI*6378137/2]}class up{constructor(e,s,h){if(!function(f,y,v){return!(f<0||f>25||v<0||v>=Math.pow(2,f)||y<0||y>=Math.pow(2,f))}(e,s,h))throw new Error(`x=${s}, y=${h}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=s,this.y=h,this.key=Ml(0,e,e,s,h)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s,h){const f=(v=this.y,w=this.z,S=u_(256*(y=this.x),256*(v=Math.pow(2,w)-v-1),w),E=u_(256*(y+1),256*(v+1),w),S[0]+","+S[1]+","+E[0]+","+E[1]);var y,v,w,S,E;const C=function(z,N,U){let q,W="";for(let J=z;J>0;J--)q=1<<J-1,W+=(N&q?1:0)+(U&q?2:0);return W}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,f)}isChildOf(e){const s=this.z-e.z;return s>0&&e.x===this.x>>s&&e.y===this.y>>s}getTilePoint(e){const s=Math.pow(2,this.z);return new V((e.x*s-this.x)*Et,(e.y*s-this.y)*Et)}toString(){return`${this.z}/${this.x}/${this.y}`}}class d_{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Ml(e,s.z,s.z,s.x,s.y)}}class Ms{constructor(e,s,h,f,y){if(this.terrainRttPosMatrix32f=null,e<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${h}`);this.overscaledZ=e,this.wrap=s,this.canonical=new up(h,+f,+y),this.key=Ml(s,e,h,f,y)}clone(){return new Ms(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?new Ms(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ms(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-e;return e>this.canonical.z?Ml(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y):Ml(this.wrap*+s,e,e,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new Ms(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new Ms(s,this.wrap,s,h,f),new Ms(s,this.wrap,s,h+1,f),new Ms(s,this.wrap,s,h,f+1),new Ms(s,this.wrap,s,h+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ms(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ms(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new d_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new uc(e.x-this.wrap,e.y))}}function Ml(n,e,s,h,f){(n*=2)<0&&(n=-1*n-1);const y=1<<s;return(y*y*n+y*f+h).toString(36)+s.toString(36)+e.toString(36)}ce("CanonicalTileID",up),ce("OverscaledTileID",Ms,{omit:["terrainRttPosMatrix32f"]});class vo{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const s=new vo;return s.extend(e(new V(this.minX,this.minY))),s.extend(e(new V(this.maxX,this.minY))),s.extend(e(new V(this.minX,this.maxY))),s.extend(e(new V(this.maxX,this.maxY))),s}static fromPoints(e){const s=new vo;for(const h of e)s.extend(h);return s}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class f_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const h=e[s];this._stringToNumber[h]=s,this._numberToString[s]=h}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class p_{constructor(e,s,h,f,y){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=h,e._y=f,this.properties=e.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(e[s]=this[s]);return e}}class m_{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new da(Et,16,0),this.grid3D=new da(Et,16,0),this.featureIndexArray=new It,this.promoteId=s}insert(e,s,h,f,y,v){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,y);const S=v?this.grid3D:this.grid;for(let E=0;E<s.length;E++){const C=s[E],z=[1/0,1/0,-1/0,-1/0];for(let N=0;N<C.length;N++){const U=C[N];z[0]=Math.min(z[0],U.x),z[1]=Math.min(z[1],U.y),z[2]=Math.max(z[2],U.x),z[3]=Math.max(z[3],U.y)}z[0]<Et&&z[1]<Et&&z[2]>=0&&z[3]>=0&&S.insert(w,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ac.VectorTile(new tp(this.rawTileData)).layers,this.sourceLayerCoder=new f_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,s,h,f){this.loadVTLayers();const y=e.params,v=Et/e.tileSize/e.scale,w=rn(y.filter),S=e.queryGeometry,E=e.queryPadding*v,C=vo.fromPoints(S),z=this.grid.query(C.minX-E,C.minY-E,C.maxX+E,C.maxY+E),N=vo.fromPoints(e.cameraQueryGeometry).expandBy(E),U=this.grid3D.query(N.minX,N.minY,N.maxX,N.maxY,(J,rt,yt,lt)=>function(j,X,ut,Pt,jt){for(const Ot of j)if(X<=Ot.x&&ut<=Ot.y&&Pt>=Ot.x&&jt>=Ot.y)return!0;const kt=[new V(X,ut),new V(X,jt),new V(Pt,jt),new V(Pt,ut)];if(j.length>2){for(const Ot of kt)if(_l(j,Ot))return!0}for(let Ot=0;Ot<j.length-1;Ot++)if(N1(j[Ot],j[Ot+1],kt))return!0;return!1}(e.cameraQueryGeometry,J-E,rt-E,yt+E,lt+E));for(const J of U)z.push(J);z.sort(Qv);const q={};let W;for(let J=0;J<z.length;J++){const rt=z[J];if(rt===W)continue;W=rt;const yt=this.featureIndexArray.get(rt);let lt=null;this.loadMatchingFeature(q,yt.bucketIndex,yt.sourceLayerIndex,yt.featureIndex,w,y.layers,y.availableImages,s,h,f,(j,X,ut)=>(lt||(lt=mo(j)),X.queryIntersectsFeature({queryGeometry:S,feature:j,featureState:ut,geometry:lt,zoom:this.z,transform:e.transform,pixelsToTileUnits:v,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation})))}return q}loadMatchingFeature(e,s,h,f,y,v,w,S,E,C,z){const N=this.bucketLayerIDs[s];if(v&&!N.some(J=>v.has(J)))return;const U=this.sourceLayerCoder.decode(h),q=this.vtLayers[U].feature(f);if(y.needGeometry){const J=go(q,!0);if(!y.filter(new Oi(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!y.filter(new Oi(this.tileID.overscaledZ),q))return;const W=this.getId(q,U);for(let J=0;J<N.length;J++){const rt=N[J];if(v&&!v.has(rt))continue;const yt=S[rt];if(!yt)continue;let lt={};W&&C&&(lt=C.getState(yt.sourceLayer||"_geojsonTileLayer",W));const j=Ve({},E[rt]);j.paint=g_(j.paint,yt.paint,q,lt,w),j.layout=g_(j.layout,yt.layout,q,lt,w);const X=!z||z(q,yt,lt);if(!X)continue;const ut=new p_(q,this.z,this.x,this.y,W);ut.layer=j;let Pt=e[rt];Pt===void 0&&(Pt=e[rt]=[]),Pt.push({featureIndex:f,feature:ut,intersectionZ:X})}}lookupSymbolFeatures(e,s,h,f,y,v,w,S){const E={};this.loadVTLayers();const C=rn(y);for(const z of e)this.loadMatchingFeature(E,h,f,z,C,v,w,S,s);return E}hasLayer(e){for(const s of this.bucketLayerIDs)for(const h of s)if(e===h)return!0;return!1}getId(e,s){var h;let f=e.id;return this.promoteId&&(f=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((h=e.properties)===null||h===void 0)&&h.cluster)&&this.promoteId&&(f=Number(e.properties.cluster_id))),f}}function g_(n,e,s,h,f){return Me(n,(y,v)=>{const w=e instanceof fl?e.get(v):null;return w&&w.evaluate?w.evaluate(s,h,f):w})}function Qv(n,e){return e-n}function __(n,e,s,h,f){const y=[];for(let v=0;v<n.length;v++){const w=n[v];let S;for(let E=0;E<w.length-1;E++){let C=w[E],z=w[E+1];C.x<e&&z.x<e||(C.x<e?C=new V(e,C.y+(e-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x<e&&(z=new V(e,C.y+(e-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y<s&&z.y<s||(C.y<s?C=new V(C.x+(s-C.y)/(z.y-C.y)*(z.x-C.x),s)._round():z.y<s&&(z=new V(C.x+(s-C.y)/(z.y-C.y)*(z.x-C.x),s)._round()),C.x>=h&&z.x>=h||(C.x>=h?C=new V(h,C.y+(h-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x>=h&&(z=new V(h,C.y+(h-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y>=f&&z.y>=f||(C.y>=f?C=new V(C.x+(f-C.y)/(z.y-C.y)*(z.x-C.x),f)._round():z.y>=f&&(z=new V(C.x+(f-C.y)/(z.y-C.y)*(z.x-C.x),f)._round()),S&&C.equals(S[S.length-1])||(S=[C],y.push(S)),S.push(z)))))}}return y}ce("FeatureIndex",m_,{omit:["rawTileData","sourceLayerCoder"]});class va extends V{constructor(e,s,h,f){super(e,s),this.angle=h,f!==void 0&&(this.segment=f)}clone(){return new va(this.x,this.y,this.angle,this.segment)}}function y_(n,e,s,h,f){if(e.segment===void 0||s===0)return!0;let y=e,v=e.segment+1,w=0;for(;w>-s/2;){if(v--,v<0)return!1;w-=n[v].dist(y),y=n[v]}w+=n[v].dist(n[v+1]),v++;const S=[];let E=0;for(;w<s/2;){const C=n[v],z=n[v+1];if(!z)return!1;let N=n[v-1].angleTo(C)-C.angleTo(z);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:w,angleDelta:N}),E+=N;w-S[0].distance>h;)E-=S.shift().angleDelta;if(E>f)return!1;v++,w+=C.dist(z)}return!0}function v_(n){let e=0;for(let s=0;s<n.length-1;s++)e+=n[s].dist(n[s+1]);return e}function x_(n,e,s){return n?.6*e*s:0}function b_(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function tx(n,e,s,h,f,y){const v=x_(s,f,y),w=b_(s,h)*y;let S=0;const E=v_(n)/2;for(let C=0;C<n.length-1;C++){const z=n[C],N=n[C+1],U=z.dist(N);if(S+U>E){const q=(E-S)/U,W=Qr.number(z.x,N.x,q),J=Qr.number(z.y,N.y,q),rt=new va(W,J,N.angleTo(z),C);return rt._round(),!v||y_(n,rt,w,v,e)?rt:void 0}S+=U}}function ex(n,e,s,h,f,y,v,w,S){const E=x_(h,y,v),C=b_(h,f),z=C*v,N=n[0].x===0||n[0].x===S||n[0].y===0||n[0].y===S;return e-z<e/4&&(e=z+e/4),w_(n,N?e/2*w%e:(C/2+2*y)*v*w%e,e,E,s,z,N,!1,S)}function w_(n,e,s,h,f,y,v,w,S){const E=y/2,C=v_(n);let z=0,N=e-s,U=[];for(let q=0;q<n.length-1;q++){const W=n[q],J=n[q+1],rt=W.dist(J),yt=J.angleTo(W);for(;N+s<z+rt;){N+=s;const lt=(N-z)/rt,j=Qr.number(W.x,J.x,lt),X=Qr.number(W.y,J.y,lt);if(j>=0&&j<S&&X>=0&&X<S&&N-E>=0&&N+E<=C){const ut=new va(j,X,yt,q);ut._round(),h&&!y_(n,ut,y,h,f)||U.push(ut)}}z+=rt}return w||U.length||v||(U=w_(n,z/2,s,h,f,y,v,!0,S)),U}function M_(n,e,s,h){const f=[],y=n.image,v=y.pixelRatio,w=y.paddedRect.w-2,S=y.paddedRect.h-2;let E={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const C=y.stretchX||[[0,w]],z=y.stretchY||[[0,S]],N=(Bt,me)=>Bt+me[1]-me[0],U=C.reduce(N,0),q=z.reduce(N,0),W=w-U,J=S-q;let rt=0,yt=U,lt=0,j=q,X=0,ut=W,Pt=0,jt=J;if(y.content&&h){const Bt=y.content,me=Bt[2]-Bt[0],Ie=Bt[3]-Bt[1];(y.textFitWidth||y.textFitHeight)&&(E=Yg(n)),rt=id(C,0,Bt[0]),lt=id(z,0,Bt[1]),yt=id(C,Bt[0],Bt[2]),j=id(z,Bt[1],Bt[3]),X=Bt[0]-rt,Pt=Bt[1]-lt,ut=me-yt,jt=Ie-j}const kt=E.x1,Ot=E.y1,Ht=E.x2-kt,$t=E.y2-Ot,Kt=(Bt,me,Ie,Te)=>{const ve=rd(Bt.stretch-rt,yt,Ht,kt),li=sd(Bt.fixed-X,ut,Bt.stretch,U),Hi=rd(me.stretch-lt,j,$t,Ot),lr=sd(me.fixed-Pt,jt,me.stretch,q),kr=rd(Ie.stretch-rt,yt,Ht,kt),Ss=sd(Ie.fixed-X,ut,Ie.stretch,U),es=rd(Te.stretch-lt,j,$t,Ot),Tr=sd(Te.fixed-Pt,jt,Te.stretch,q),qi=new V(ve,Hi),gr=new V(kr,Hi),Pr=new V(kr,es),Er=new V(ve,es),Kr=new V(li/v,lr/v),Ts=new V(Ss/v,Tr/v),_r=e*Math.PI/180;if(_r){const yr=Math.sin(_r),vr=Math.cos(_r),nr=[vr,-yr,yr,vr];qi._matMult(nr),gr._matMult(nr),Er._matMult(nr),Pr._matMult(nr)}const is=Bt.stretch+Bt.fixed,hr=me.stretch+me.fixed;return{tl:qi,tr:gr,bl:Er,br:Pr,tex:{x:y.paddedRect.x+1+is,y:y.paddedRect.y+1+hr,w:Ie.stretch+Ie.fixed-is,h:Te.stretch+Te.fixed-hr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Kr,pixelOffsetBR:Ts,minFontScaleX:ut/v/Ht,minFontScaleY:jt/v/$t,isSDF:s}};if(h&&(y.stretchX||y.stretchY)){const Bt=S_(C,W,U),me=S_(z,J,q);for(let Ie=0;Ie<Bt.length-1;Ie++){const Te=Bt[Ie],ve=Bt[Ie+1];for(let li=0;li<me.length-1;li++)f.push(Kt(Te,me[li],ve,me[li+1]))}}else f.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:S+1}));return f}function id(n,e,s){let h=0;for(const f of n)h+=Math.max(e,Math.min(s,f[1]))-Math.max(e,Math.min(s,f[0]));return h}function S_(n,e,s){const h=[{fixed:-1,stretch:0}];for(const[f,y]of n){const v=h[h.length-1];h.push({fixed:f-v.stretch,stretch:v.stretch}),h.push({fixed:f-v.stretch,stretch:v.stretch+(y-f)})}return h.push({fixed:e+1,stretch:s}),h}function rd(n,e,s,h){return n/e*s+h}function sd(n,e,s,h){return n-e*s/h}ce("Anchor",va);class nd{constructor(e,s,h,f,y,v,w,S,E,C){var z;if(this.boxStartIndex=e.length,E){let N=v.top,U=v.bottom;const q=v.collisionPadding;q&&(N-=q[1],U+=q[3]);let W=U-N;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{const N=!((z=v.image)===null||z===void 0)&&z.content&&(v.image.textFitWidth||v.image.textFitHeight)?Yg(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};N.y1=N.y1*w-S[0],N.y2=N.y2*w+S[2],N.x1=N.x1*w-S[3],N.x2=N.x2*w+S[1];const U=v.collisionPadding;if(U&&(N.x1-=U[0]*w,N.y1-=U[1]*w,N.x2+=U[2]*w,N.y2+=U[3]*w),C){const q=new V(N.x1,N.y1),W=new V(N.x2,N.y1),J=new V(N.x1,N.y2),rt=new V(N.x2,N.y2),yt=C*Math.PI/180;q._rotate(yt),W._rotate(yt),J._rotate(yt),rt._rotate(yt),N.x1=Math.min(q.x,W.x,J.x,rt.x),N.x2=Math.max(q.x,W.x,J.x,rt.x),N.y1=Math.min(q.y,W.y,J.y,rt.y),N.y2=Math.max(q.y,W.y,J.y,rt.y)}e.emplaceBack(s.x,s.y,N.x1,N.y1,N.x2,N.y2,h,f,y)}this.boxEndIndex=e.length}}class ix{constructor(e=[],s=(h,f)=>h<f?-1:h>f?1:0){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:h}=this,f=s[e];for(;e>0;){const y=e-1>>1,v=s[y];if(h(f,v)>=0)break;s[e]=v,e=y}s[e]=f}_down(e){const{data:s,compare:h}=this,f=this.length>>1,y=s[e];for(;e<f;){let v=1+(e<<1);const w=v+1;if(w<this.length&&h(s[w],s[v])<0&&(v=w),h(s[v],y)>=0)break;s[e]=s[v],e=v}s[e]=y}}function rx(n,e=1,s=!1){const h=vo.fromPoints(n[0]),f=Math.min(h.width(),h.height());let y=f/2;const v=new ix([],sx),{minX:w,minY:S,maxX:E,maxY:C}=h;if(f===0)return new V(w,S);for(let U=w;U<E;U+=f)for(let q=S;q<C;q+=f)v.push(new Sl(U+y,q+y,y,n));let z=function(U){let q=0,W=0,J=0;const rt=U[0];for(let yt=0,lt=rt.length,j=lt-1;yt<lt;j=yt++){const X=rt[yt],ut=rt[j],Pt=X.x*ut.y-ut.x*X.y;W+=(X.x+ut.x)*Pt,J+=(X.y+ut.y)*Pt,q+=3*Pt}return new Sl(W/q,J/q,0,U)}(n),N=v.length;for(;v.length;){const U=v.pop();(U.d>z.d||!z.d)&&(z=U,s&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,N)),U.max-z.d<=e||(y=U.h/2,v.push(new Sl(U.p.x-y,U.p.y-y,y,n)),v.push(new Sl(U.p.x+y,U.p.y-y,y,n)),v.push(new Sl(U.p.x-y,U.p.y+y,y,n)),v.push(new Sl(U.p.x+y,U.p.y+y,y,n)),N+=4)}return s&&(console.log(`num probes: ${N}`),console.log(`best distance: ${z.d}`)),z.p}function sx(n,e){return e.max-n.max}function Sl(n,e,s,h){this.p=new V(n,e),this.h=s,this.d=function(f,y){let v=!1,w=1/0;for(let S=0;S<y.length;S++){const E=y[S];for(let C=0,z=E.length,N=z-1;C<z;N=C++){const U=E[C],q=E[N];U.y>f.y!=q.y>f.y&&f.x<(q.x-U.x)*(f.y-U.y)/(q.y-U.y)+U.x&&(v=!v),w=Math.min(w,rg(f,U,q))}}return(v?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Rr;m.aD=void 0,(Rr=m.aD||(m.aD={}))[Rr.center=1]="center",Rr[Rr.left=2]="left",Rr[Rr.right=3]="right",Rr[Rr.top=4]="top",Rr[Rr.bottom=5]="bottom",Rr[Rr["top-left"]=6]="top-left",Rr[Rr["top-right"]=7]="top-right",Rr[Rr["bottom-left"]=8]="bottom-left",Rr[Rr["bottom-right"]=9]="bottom-right";const dp=Number.POSITIVE_INFINITY;function T_(n,e){return e[1]!==dp?function(s,h,f){let y=0,v=0;switch(h=Math.abs(h),f=Math.abs(f),s){case"top-right":case"top-left":case"top":v=f-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-f}switch(s){case"top-right":case"bottom-right":case"right":y=-h;break;case"top-left":case"bottom-left":case"left":y=h}return[y,v]}(n,e[0],e[1]):function(s,h){let f=0,y=0;h<0&&(h=0);const v=h/Math.SQRT2;switch(s){case"top-right":case"top-left":y=v-7;break;case"bottom-right":case"bottom-left":y=7-v;break;case"bottom":y=7-h;break;case"top":y=h-7}switch(s){case"top-right":case"bottom-right":f=-v;break;case"top-left":case"bottom-left":f=v;break;case"left":f=h;break;case"right":f=-h}return[f,y]}(n,e[0])}function P_(n,e,s){var h;const f=n.layout,y=(h=f.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(e,{},s);if(y){const w=y.values,S=[];for(let E=0;E<w.length;E+=2){const C=S[E]=w[E],z=w[E+1].map(N=>N*mr);C.startsWith("top")?z[1]-=7:C.startsWith("bottom")&&(z[1]+=7),S[E+1]=z}return new ci(S)}const v=f.get("text-variable-anchor");if(v){let w;w=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(e,{},s)*mr,dp]:f.get("text-offset").evaluate(e,{},s).map(E=>E*mr);const S=[];for(const E of v)S.push(E,T_(E,w));return new ci(S)}return null}function fp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function nx(n,e,s,h,f,y,v,w,S,E,C,z){let N=y.textMaxSize.evaluate(e,{});N===void 0&&(N=v);const U=n.layers[0].layout,q=U.get("icon-offset").evaluate(e,{},C),W=I_(s.horizontal),J=v/24,rt=n.tilePixelRatio*J,yt=n.tilePixelRatio*N/24,lt=n.tilePixelRatio*w,j=n.tilePixelRatio*U.get("symbol-spacing"),X=U.get("text-padding")*n.tilePixelRatio,ut=function(Ie,Te,ve,li=1){const Hi=Ie.get("icon-padding").evaluate(Te,{},ve),lr=Hi&&Hi.values;return[lr[0]*li,lr[1]*li,lr[2]*li,lr[3]*li]}(U,e,C,n.tilePixelRatio),Pt=U.get("text-max-angle")/180*Math.PI,jt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",kt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Ot=U.get("symbol-placement"),Ht=j/2,$t=U.get("icon-text-fit");let Kt;h&&$t!=="none"&&(n.allowVerticalPlacement&&s.vertical&&(Kt=Jg(h,s.vertical,$t,U.get("icon-text-fit-padding"),q,J)),W&&(h=Jg(h,W,$t,U.get("icon-text-fit-padding"),q,J)));const Bt=C?z.line.getGranularityForZoomLevel(C.z):1,me=(Ie,Te)=>{Te.x<0||Te.x>=Et||Te.y<0||Te.y>=Et||function(ve,li,Hi,lr,kr,Ss,es,Tr,qi,gr,Pr,Er,Kr,Ts,_r,is,hr,yr,vr,nr,Li,Zs,Tl,Ws,lx){const Pl=ve.addToLineVertexArray(li,Hi);let xo,El,Il,Cl,k_=0,D_=0,z_=0,L_=0,bp=-1,wp=-1;const Fn={};let O_=Xr("");if(ve.allowVerticalPlacement&&lr.vertical){const Nr=Tr.layout.get("text-rotate").evaluate(Li,{},Ws)+90;Il=new nd(qi,li,gr,Pr,Er,lr.vertical,Kr,Ts,_r,Nr),es&&(Cl=new nd(qi,li,gr,Pr,Er,es,hr,yr,_r,Nr))}if(kr){const Nr=Tr.layout.get("icon-rotate").evaluate(Li,{}),Ps=Tr.layout.get("icon-text-fit")!=="none",bo=M_(kr,Nr,Tl,Ps),Xs=es?M_(es,Nr,Tl,Ps):void 0;El=new nd(qi,li,gr,Pr,Er,kr,hr,yr,!1,Nr),k_=4*bo.length;const wo=ve.iconSizeData;let fn=null;wo.kind==="source"?(fn=[On*Tr.layout.get("icon-size").evaluate(Li,{})],fn[0]>_a&&he(`${ve.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):wo.kind==="composite"&&(fn=[On*Zs.compositeIconSizes[0].evaluate(Li,{},Ws),On*Zs.compositeIconSizes[1].evaluate(Li,{},Ws)],(fn[0]>_a||fn[1]>_a)&&he(`${ve.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ve.addSymbols(ve.icon,bo,fn,nr,vr,Li,m.an.none,li,Pl.lineStartIndex,Pl.lineLength,-1,Ws),bp=ve.icon.placedSymbolArray.length-1,Xs&&(D_=4*Xs.length,ve.addSymbols(ve.icon,Xs,fn,nr,vr,Li,m.an.vertical,li,Pl.lineStartIndex,Pl.lineLength,-1,Ws),wp=ve.icon.placedSymbolArray.length-1)}const F_=Object.keys(lr.horizontal);for(const Nr of F_){const Ps=lr.horizontal[Nr];if(!xo){O_=Xr(Ps.text);const Xs=Tr.layout.get("text-rotate").evaluate(Li,{},Ws);xo=new nd(qi,li,gr,Pr,Er,Ps,Kr,Ts,_r,Xs)}const bo=Ps.positionedLines.length===1;if(z_+=E_(ve,li,Ps,Ss,Tr,_r,Li,is,Pl,lr.vertical?m.an.horizontal:m.an.horizontalOnly,bo?F_:[Nr],Fn,bp,Zs,Ws),bo)break}lr.vertical&&(L_+=E_(ve,li,lr.vertical,Ss,Tr,_r,Li,is,Pl,m.an.vertical,["vertical"],Fn,wp,Zs,Ws));const hx=xo?xo.boxStartIndex:ve.collisionBoxArray.length,cx=xo?xo.boxEndIndex:ve.collisionBoxArray.length,ux=Il?Il.boxStartIndex:ve.collisionBoxArray.length,dx=Il?Il.boxEndIndex:ve.collisionBoxArray.length,fx=El?El.boxStartIndex:ve.collisionBoxArray.length,px=El?El.boxEndIndex:ve.collisionBoxArray.length,mx=Cl?Cl.boxStartIndex:ve.collisionBoxArray.length,gx=Cl?Cl.boxEndIndex:ve.collisionBoxArray.length;let Hs=-1;const od=(Nr,Ps)=>Nr&&Nr.circleDiameter?Math.max(Nr.circleDiameter,Ps):Ps;Hs=od(xo,Hs),Hs=od(Il,Hs),Hs=od(El,Hs),Hs=od(Cl,Hs);const B_=Hs>-1?1:0;B_&&(Hs*=lx/mr),ve.glyphOffsetArray.length>=wl.MAX_GLYPHS&&he("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Li.sortKey!==void 0&&ve.addToSortKeyRanges(ve.symbolInstances.length,Li.sortKey);const _x=P_(Tr,Li,Ws),[yx,vx]=function(Nr,Ps){const bo=Nr.length,Xs=Ps==null?void 0:Ps.values;if((Xs==null?void 0:Xs.length)>0)for(let wo=0;wo<Xs.length;wo+=2){const fn=Xs[wo+1];Nr.emplaceBack(m.aD[Xs[wo]],fn[0],fn[1])}return[bo,Nr.length]}(ve.textAnchorOffsets,_x);ve.symbolInstances.emplaceBack(li.x,li.y,Fn.right>=0?Fn.right:-1,Fn.center>=0?Fn.center:-1,Fn.left>=0?Fn.left:-1,Fn.vertical||-1,bp,wp,O_,hx,cx,ux,dx,fx,px,mx,gx,gr,z_,L_,k_,D_,B_,0,Kr,Hs,yx,vx)}(n,Te,Ie,s,h,f,Kt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,rt,[X,X,X,X],jt,S,lt,ut,kt,q,e,y,E,C,v)};if(Ot==="line")for(const Ie of __(e.geometry,0,0,Et,Et)){const Te=yo(Ie,Bt),ve=ex(Te,j,Pt,s.vertical||W,h,24,yt,n.overscaling,Et);for(const li of ve)W&&ax(n,W.text,Ht,li)||me(Te,li)}else if(Ot==="line-center"){for(const Ie of e.geometry)if(Ie.length>1){const Te=yo(Ie,Bt),ve=tx(Te,Pt,s.vertical||W,h,24,yt);ve&&me(Te,ve)}}else if(e.type==="Polygon")for(const Ie of qo(e.geometry,0)){const Te=rx(Ie,16);me(yo(Ie[0],Bt,!0),new va(Te.x,Te.y,0))}else if(e.type==="LineString")for(const Ie of e.geometry){const Te=yo(Ie,Bt);me(Te,new va(Te[0].x,Te[0].y,0))}else if(e.type==="Point")for(const Ie of e.geometry)for(const Te of Ie)me([Te],new va(Te.x,Te.y,0))}function E_(n,e,s,h,f,y,v,w,S,E,C,z,N,U,q){const W=function(yt,lt,j,X,ut,Pt,jt,kt){const Ot=X.layout.get("text-rotate").evaluate(Pt,{})*Math.PI/180,Ht=[];for(const $t of lt.positionedLines)for(const Kt of $t.positionedGlyphs){if(!Kt.rect)continue;const Bt=Kt.rect||{};let me=4,Ie=!0,Te=1,ve=0;const li=(ut||kt)&&Kt.vertical,Hi=Kt.metrics.advance*Kt.scale/2;if(kt&&lt.verticalizable&&(ve=$t.lineOffset/2-(Kt.imageName?-(mr-Kt.metrics.width*Kt.scale)/2:(Kt.scale-1)*mr)),Kt.imageName){const yr=jt[Kt.imageName];Ie=yr.sdf,Te=yr.pixelRatio,me=1/Te}const lr=ut?[Kt.x+Hi,Kt.y]:[0,0];let kr=ut?[0,0]:[Kt.x+Hi+j[0],Kt.y+j[1]-ve],Ss=[0,0];li&&(Ss=kr,kr=[0,0]);const es=Kt.metrics.isDoubleResolution?2:1,Tr=(Kt.metrics.left-me)*Kt.scale-Hi+kr[0],qi=(-Kt.metrics.top-me)*Kt.scale+kr[1],gr=Tr+Bt.w/es*Kt.scale/Te,Pr=qi+Bt.h/es*Kt.scale/Te,Er=new V(Tr,qi),Kr=new V(gr,qi),Ts=new V(Tr,Pr),_r=new V(gr,Pr);if(li){const yr=new V(-Hi,Hi- -17),vr=-Math.PI/2,nr=12-Hi,Li=new V(22-nr,-(Kt.imageName?nr:0)),Zs=new V(...Ss);Er._rotateAround(vr,yr)._add(Li)._add(Zs),Kr._rotateAround(vr,yr)._add(Li)._add(Zs),Ts._rotateAround(vr,yr)._add(Li)._add(Zs),_r._rotateAround(vr,yr)._add(Li)._add(Zs)}if(Ot){const yr=Math.sin(Ot),vr=Math.cos(Ot),nr=[vr,-yr,yr,vr];Er._matMult(nr),Kr._matMult(nr),Ts._matMult(nr),_r._matMult(nr)}const is=new V(0,0),hr=new V(0,0);Ht.push({tl:Er,tr:Kr,bl:Ts,br:_r,tex:Bt,writingMode:lt.writingMode,glyphOffset:lr,sectionIndex:Kt.sectionIndex,isSDF:Ie,pixelOffsetTL:is,pixelOffsetBR:hr,minFontScaleX:0,minFontScaleY:0})}return Ht}(0,s,w,f,y,v,h,n.allowVerticalPlacement),J=n.textSizeData;let rt=null;J.kind==="source"?(rt=[On*f.layout.get("text-size").evaluate(v,{})],rt[0]>_a&&he(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):J.kind==="composite"&&(rt=[On*U.compositeTextSizes[0].evaluate(v,{},q),On*U.compositeTextSizes[1].evaluate(v,{},q)],(rt[0]>_a||rt[1]>_a)&&he(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,W,rt,w,y,v,E,e,S.lineStartIndex,S.lineLength,N,q);for(const yt of C)z[yt]=n.text.placedSymbolArray.length-1;return 4*W.length}function I_(n){for(const e in n)return n[e];return null}function ax(n,e,s,h){const f=n.compareText;if(e in f){const y=f[e];for(let v=y.length-1;v>=0;v--)if(h.dist(y[v])<s)return!0}else f[e]=[];return f[e].push(h),!1}const C_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,h]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=h>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const y=C_[15&h];if(!y)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new pp(w,v,y,e)}constructor(e,s=64,h=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=h,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const y=C_.indexOf(this.ArrayType),v=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-w%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${h}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=e,this.coords[this._pos++]=s,h}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return mp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:v,nodeSize:w}=this,S=[0,y.length-1,0],E=[];for(;S.length;){const C=S.pop()||0,z=S.pop()||0,N=S.pop()||0;if(z-N<=w){for(let J=N;J<=z;J++){const rt=v[2*J],yt=v[2*J+1];rt>=e&&rt<=h&&yt>=s&&yt<=f&&E.push(y[J])}continue}const U=N+z>>1,q=v[2*U],W=v[2*U+1];q>=e&&q<=h&&W>=s&&W<=f&&E.push(y[U]),(C===0?e<=q:s<=W)&&(S.push(N),S.push(U-1),S.push(1-C)),(C===0?h>=q:f>=W)&&(S.push(U+1),S.push(z),S.push(1-C))}return E}within(e,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:v}=this,w=[0,f.length-1,0],S=[],E=h*h;for(;w.length;){const C=w.pop()||0,z=w.pop()||0,N=w.pop()||0;if(z-N<=v){for(let J=N;J<=z;J++)R_(y[2*J],y[2*J+1],e,s)<=E&&S.push(f[J]);continue}const U=N+z>>1,q=y[2*U],W=y[2*U+1];R_(q,W,e,s)<=E&&S.push(f[U]),(C===0?e-h<=q:s-h<=W)&&(w.push(N),w.push(U-1),w.push(1-C)),(C===0?e+h>=q:s+h>=W)&&(w.push(U+1),w.push(z),w.push(1-C))}return S}}function mp(n,e,s,h,f,y){if(f-h<=s)return;const v=h+f>>1;A_(n,e,v,h,f,y),mp(n,e,s,h,v-1,1-y),mp(n,e,s,v+1,f,1-y)}function A_(n,e,s,h,f,y){for(;f>h;){if(f-h>600){const E=f-h+1,C=s-h+1,z=Math.log(E),N=.5*Math.exp(2*z/3),U=.5*Math.sqrt(z*N*(E-N)/E)*(C-E/2<0?-1:1);A_(n,e,s,Math.max(h,Math.floor(s-C*N/E+U)),Math.min(f,Math.floor(s+(E-C)*N/E+U)),y)}const v=e[2*s+y];let w=h,S=f;for(dc(n,e,h,s),e[2*f+y]>v&&dc(n,e,h,f);w<S;){for(dc(n,e,w,S),w++,S--;e[2*w+y]<v;)w++;for(;e[2*S+y]>v;)S--}e[2*h+y]===v?dc(n,e,h,S):(S++,dc(n,e,S,f)),S<=s&&(h=S+1),s<=S&&(f=S-1)}}function dc(n,e,s,h){gp(n,s,h),gp(e,2*s,2*h),gp(e,2*s+1,2*h+1)}function gp(n,e,s){const h=n[e];n[e]=n[s],n[s]=h}function R_(n,e,s,h){const f=n-s,y=e-h;return f*f+y*y}var _p;m.cw=void 0,(_p=m.cw||(m.cw={})).create="create",_p.load="load",_p.fullLoad="fullLoad";let ad=null,fc=[];const yp=1e3/60,vp="loadTime",xp="fullLoadTime",ox={mark(n){performance.mark(n)},frame(n){const e=n;ad!=null&&fc.push(e-ad),ad=e},clearMetrics(){ad=null,fc=[],performance.clearMeasures(vp),performance.clearMeasures(xp);for(const n in m.cw)performance.clearMarks(m.cw[n])},getPerformanceMetrics(){performance.measure(vp,m.cw.create,m.cw.load),performance.measure(xp,m.cw.create,m.cw.fullLoad);const n=performance.getEntriesByName(vp)[0].duration,e=performance.getEntriesByName(xp)[0].duration,s=fc.length,h=1/(fc.reduce((y,v)=>y+v,0)/s/1e3),f=fc.filter(y=>y>yp).reduce((y,v)=>y+(v-yp)/yp,0);return{loadTime:n,fullLoadTime:e,fps:h,percentDroppedFrames:f/(s+f)*100,totalFrames:s}}};m.$=Et,m.A=ae,m.B=function([n,e,s]){return e+=90,e*=Math.PI/180,s*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(s),y:n*Math.sin(e)*Math.sin(s),z:n*Math.cos(s)}},m.C=Qr,m.D=ge,m.E=Nt,m.F=Oi,m.G=hl,m.H=function(n){if(Be==null){const e=n.navigator?n.navigator.userAgent:null;Be=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Be},m.I=ep,m.J=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Yv(()=>this.process()),this.subscription=Bi(this.target,"message",s=>this.receive(s),!1),this.globalScope=Ne(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}sendAsync(n,e){return new Promise((s,h)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10),y=e?Bi(e.signal,"abort",()=>{y==null||y.unsubscribe(),delete this.resolveRejects[f];const S={id:f,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(S)},Jv):null;this.resolveRejects[f]={resolve:S=>{y==null||y.unsubscribe(),s(S)},reject:S=>{y==null||y.unsubscribe(),h(S)}};const v=[],w=Object.assign(Object.assign({},n),{id:f,sourceMapId:this.mapId,origin:location.origin,data:no(n.data,v)});this.target.postMessage(w,{transfer:v})})}receive(n){const e=n.data,s=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[s];const h=this.abortControllers[s];return delete this.abortControllers[s],void(h&&h.abort())}if(Ne(self)||e.mustQueue)return this.tasks[s]=e,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return o(this,void 0,void 0,function*(){if(e.type==="<response>"){const f=this.resolveRejects[n];return delete this.resolveRejects[n],f?void(e.error?f.reject(fa(e.error)):f.resolve(fa(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=fa(e.data),h=new AbortController;this.abortControllers[n]=h;try{const f=yield this.messageHandlers[e.type](e.sourceMapId,s,h);this.completeTask(n,null,f)}catch(f){this.completeTask(n,f)}})}completeTask(n,e,s){const h=[];delete this.abortControllers[n];const f={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?no(e):null,data:no(s,h)};this.target.postMessage(f,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.K=Y,m.L=function(){var n=new ae(16);return ae!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},m.M=function(n,e,s){var h,f,y,v,w,S,E,C,z,N,U,q,W=s[0],J=s[1],rt=s[2];return e===n?(n[12]=e[0]*W+e[4]*J+e[8]*rt+e[12],n[13]=e[1]*W+e[5]*J+e[9]*rt+e[13],n[14]=e[2]*W+e[6]*J+e[10]*rt+e[14],n[15]=e[3]*W+e[7]*J+e[11]*rt+e[15]):(f=e[1],y=e[2],v=e[3],w=e[4],S=e[5],E=e[6],C=e[7],z=e[8],N=e[9],U=e[10],q=e[11],n[0]=h=e[0],n[1]=f,n[2]=y,n[3]=v,n[4]=w,n[5]=S,n[6]=E,n[7]=C,n[8]=z,n[9]=N,n[10]=U,n[11]=q,n[12]=h*W+w*J+z*rt+e[12],n[13]=f*W+S*J+N*rt+e[13],n[14]=y*W+E*J+U*rt+e[14],n[15]=v*W+C*J+q*rt+e[15]),n},m.N=function(n,e,s){var h=s[0],f=s[1],y=s[2];return n[0]=e[0]*h,n[1]=e[1]*h,n[2]=e[2]*h,n[3]=e[3]*h,n[4]=e[4]*f,n[5]=e[5]*f,n[6]=e[6]*f,n[7]=e[7]*f,n[8]=e[8]*y,n[9]=e[9]*y,n[10]=e[10]*y,n[11]=e[11]*y,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},m.O=function(n,e,s){var h=e[0],f=e[1],y=e[2],v=e[3],w=e[4],S=e[5],E=e[6],C=e[7],z=e[8],N=e[9],U=e[10],q=e[11],W=e[12],J=e[13],rt=e[14],yt=e[15],lt=s[0],j=s[1],X=s[2],ut=s[3];return n[0]=lt*h+j*w+X*z+ut*W,n[1]=lt*f+j*S+X*N+ut*J,n[2]=lt*y+j*E+X*U+ut*rt,n[3]=lt*v+j*C+X*q+ut*yt,n[4]=(lt=s[4])*h+(j=s[5])*w+(X=s[6])*z+(ut=s[7])*W,n[5]=lt*f+j*S+X*N+ut*J,n[6]=lt*y+j*E+X*U+ut*rt,n[7]=lt*v+j*C+X*q+ut*yt,n[8]=(lt=s[8])*h+(j=s[9])*w+(X=s[10])*z+(ut=s[11])*W,n[9]=lt*f+j*S+X*N+ut*J,n[10]=lt*y+j*E+X*U+ut*rt,n[11]=lt*v+j*C+X*q+ut*yt,n[12]=(lt=s[12])*h+(j=s[13])*w+(X=s[14])*z+(ut=s[15])*W,n[13]=lt*f+j*S+X*N+ut*J,n[14]=lt*y+j*E+X*U+ut*rt,n[15]=lt*v+j*C+X*q+ut*yt,n},m.P=V,m.Q=function(n,e){const s={};for(let h=0;h<e.length;h++){const f=e[h];f in n&&(s[f]=n[f])}return s},m.R=ts,m.S=ya,m.T=Gf,m.U=l_,m.V=o_,m.W=Dt,m.X=Ct,m.Y=Ue,m.Z=Ms,m._=o,m.a=$,m.a$=function(n,e,s){return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n},m.a0=uc,m.a1=vo,m.a2=25,m.a3=up,m.a4=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(s=>{e.onloadstart=()=>{s(e)};for(const h of n){const f=window.document.createElement("source");St(h)||(e.crossOrigin="Anonymous"),f.src=h,e.appendChild(f)}})},m.a5=Xt,m.a6=function(){return ie++},m.a7=tt,m.a8=wl,m.a9=rn,m.aA=mr,m.aB=Gt,m.aC=function(n,e,s,h,f=!1){if(!s[0]&&!s[1])return[0,0];const y=f?h==="map"?-n.bearingInRadians:0:h==="viewport"?n.bearingInRadians:0;if(y){const v=Math.sin(y),w=Math.cos(y);s=[s[0]*w-s[1]*v,s[0]*v+s[1]*w]}return[f?s[0]:Gt(e,s[0],n.zoom),f?s[1]:Gt(e,s[1],n.zoom)]},m.aE=sp,m.aF=fp,m.aG=rp,m.aH=pp,m.aI=Wi,m.aJ=Xu,m.aK=Mt,m.aL=pi,m.aM=Ii,m.aN=De,m.aO=_i,m.aP=c_,m.aQ=be,m.aR=le,m.aS=function(n){var e=new ae(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},m.aT=function(n,e,s){return n[0]=e[0]-s[0],n[1]=e[1]-s[1],n[2]=e[2]-s[2],n},m.aU=function(n,e){var s=e[0],h=e[1],f=e[2],y=s*s+h*h+f*f;return y>0&&(y=1/Math.sqrt(y)),n[0]=e[0]*y,n[1]=e[1]*y,n[2]=e[2]*y,n},m.aV=qe,m.aW=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},m.aX=function(n,e,s){return n[0]=e[0]*s[0],n[1]=e[1]*s[1],n[2]=e[2]*s[2],n[3]=e[3]*s[3],n},m.aY=Xe,m.aZ=function(n,e,s){const h=e[0]*s[0]+e[1]*s[1]+e[2]*s[2];return h===0?null:(-(n[0]*s[0]+n[1]*s[1]+n[2]*s[2])-s[3])/h},m.a_=ui,m.aa=go,m.ab=p_,m.ac=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,h,f,y)=>{const v=f||y;return e[h]=!v||v.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e},m.ad=Ye,m.ae=function(n){return Math.pow(2,n)},m.af=de,m.ag=ue,m.ah=85.051129,m.ai=h_,m.aj=function(n){return Math.log(n)/Math.LN2},m.ak=function(n){var e=n[0],s=n[1];return e*e+s*s},m.al=function(n,e){const s=[];for(const h in n)h in e||s.push(h);return s},m.am=function(n,e){let s=0,h=0;if(n.kind==="constant")h=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:f,minZoom:y,maxZoom:v}=n,w=f?ue(Lr.interpolationFactor(f,e,y,v),0,1):0;n.kind==="camera"?h=Qr.number(n.minSize,n.maxSize,w):s=w}return{uSizeT:s,uSize:h}},m.ao=function(n,{uSize:e,uSizeT:s},{lowerSize:h,upperSize:f}){return n.kind==="source"?h/On:n.kind==="composite"?Qr.number(h/On,f/On,s):e},m.ap=function(n,e){var s=e[0],h=e[1],f=e[2],y=e[3],v=e[4],w=e[5],S=e[6],E=e[7],C=e[8],z=e[9],N=e[10],U=e[11],q=e[12],W=e[13],J=e[14],rt=e[15],yt=s*w-h*v,lt=s*S-f*v,j=s*E-y*v,X=h*S-f*w,ut=h*E-y*w,Pt=f*E-y*S,jt=C*W-z*q,kt=C*J-N*q,Ot=C*rt-U*q,Ht=z*J-N*W,$t=z*rt-U*W,Kt=N*rt-U*J,Bt=yt*Kt-lt*$t+j*Ht+X*Ot-ut*kt+Pt*jt;return Bt?(n[0]=(w*Kt-S*$t+E*Ht)*(Bt=1/Bt),n[1]=(f*$t-h*Kt-y*Ht)*Bt,n[2]=(W*Pt-J*ut+rt*X)*Bt,n[3]=(N*ut-z*Pt-U*X)*Bt,n[4]=(S*Ot-v*Kt-E*kt)*Bt,n[5]=(s*Kt-f*Ot+y*kt)*Bt,n[6]=(J*j-q*Pt-rt*lt)*Bt,n[7]=(C*Pt-N*j+U*lt)*Bt,n[8]=(v*$t-w*Ot+E*jt)*Bt,n[9]=(h*Ot-s*$t-y*jt)*Bt,n[10]=(q*ut-W*j+rt*yt)*Bt,n[11]=(z*j-C*ut-U*yt)*Bt,n[12]=(w*kt-v*Ht-S*jt)*Bt,n[13]=(s*Ht-h*kt+f*jt)*Bt,n[14]=(W*lt-q*X-J*yt)*Bt,n[15]=(C*X-z*lt+N*yt)*Bt,n):null},m.aq=Wt,m.ar=function(n){return Math.hypot(n[0],n[1])},m.as=function(n){return n[0]=0,n[1]=0,n},m.at=function(n,e,s){return n[0]=e[0]*s,n[1]=e[1]*s,n},m.au=np,m.av=yi,m.aw=function(n,e,s,h){const f=e.y-n.y,y=e.x-n.x,v=h.y-s.y,w=h.x-s.x,S=v*y-w*f;if(S===0)return null;const E=(w*(n.y-s.y)-v*(n.x-s.x))/S;return new V(n.x+E*y,n.y+E*f)},m.ax=__,m.ay=eg,m.az=function(n){let e=1/0,s=1/0,h=-1/0,f=-1/0;for(const y of n)e=Math.min(e,y.x),s=Math.min(s,y.y),h=Math.max(h,y.x),f=Math.max(f,y.y);return[e,s,h,f]},m.b=Oe,m.b$=Iv,m.b0=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},m.b1=d_,m.b2=Ml,m.b3=function(n,e,s,h,f){var y,v=1/Math.tan(e/2);return n[0]=v/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,f!=null&&f!==1/0?(n[10]=(f+h)*(y=1/(h-f)),n[14]=2*f*h*y):(n[10]=-1,n[14]=-2*h),n},m.b4=function(n){var e=new ae(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},m.b5=function(n,e,s){var h=Math.sin(s),f=Math.cos(s),y=e[0],v=e[1],w=e[2],S=e[3],E=e[4],C=e[5],z=e[6],N=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=y*f+E*h,n[1]=v*f+C*h,n[2]=w*f+z*h,n[3]=S*f+N*h,n[4]=E*f-y*h,n[5]=C*f-v*h,n[6]=z*f-w*h,n[7]=N*f-S*h,n},m.b6=function(n,e,s){var h=Math.sin(s),f=Math.cos(s),y=e[4],v=e[5],w=e[6],S=e[7],E=e[8],C=e[9],z=e[10],N=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=y*f+E*h,n[5]=v*f+C*h,n[6]=w*f+z*h,n[7]=S*f+N*h,n[8]=E*f-y*h,n[9]=C*f-v*h,n[10]=z*f-w*h,n[11]=N*f-S*h,n},m.b7=function(){const n=new Float32Array(16);return de(n),n},m.b8=function(){const n=new Float64Array(16);return de(n),n},m.b9=function(){return new Float64Array(16)},m.bA=function(n){return n[0]=0,n[1]=0,n[2]=0,n},m.bB=function(n,e,s,h){const f=Math.sqrt(n*n+e*e),y=Math.sqrt(s*s+h*h);n/=f,e/=f,s/=y,h/=y;const v=Math.acos(n*s+e*h);return-e*s+n*h>0?v:-v},m.bC=function(n,e){const s=se(n,2*Math.PI),h=se(e,2*Math.PI);return Math.min(Math.abs(s-h),Math.abs(s-h+2*Math.PI),Math.abs(s-h-2*Math.PI))},m.bD=function(){const n={},e=ft.$version;for(const s in ft.$root){const h=ft.$root[s];if(h.required){let f=null;f=s==="version"?e:h.type==="array"?[]:{},f!=null&&(n[s]=f)}}return n},m.bE=Bh,m.bF=mt,m.bG=function n(e,s){if(Array.isArray(e)){if(!Array.isArray(s)||e.length!==s.length)return!1;for(let h=0;h<e.length;h++)if(!n(e[h],s[h]))return!1;return!0}if(typeof e=="object"&&e!==null&&s!==null){if(typeof s!="object"||Object.keys(e).length!==Object.keys(s).length)return!1;for(const h in e)if(!n(e[h],s[h]))return!1;return!0}return e===s},m.bH=function(n){n=n.slice();const e=Object.create(null);for(let s=0;s<n.length;s++)e[n[s].id]=n[s];for(let s=0;s<n.length;s++)"ref"in n[s]&&(n[s]=Pe(n[s],e[n[s].ref]));return n},m.bI=function(n){if(n.type==="custom")return new Kv(n);switch(n.type){case"background":return new Wv(n);case"circle":return new j1(n);case"color-relief":return new W1(n);case"fill":return new lv(n);case"fill-extrusion":return new gv(n);case"heatmap":return new V1(n);case"hillshade":return new $1(n);case"line":return new Sv(n);case"raster":return new Xv(n);case"symbol":return new ed(n)}},m.bJ=ii,m.bK=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let s=[];try{if(!oe(n.version,e.version))return[{command:"setStyle",args:[e]}];oe(n.center,e.center)||s.push({command:"setCenter",args:[e.center]}),oe(n.state,e.state)||s.push({command:"setGlobalState",args:[e.state]}),oe(n.centerAltitude,e.centerAltitude)||s.push({command:"setCenterAltitude",args:[e.centerAltitude]}),oe(n.zoom,e.zoom)||s.push({command:"setZoom",args:[e.zoom]}),oe(n.bearing,e.bearing)||s.push({command:"setBearing",args:[e.bearing]}),oe(n.pitch,e.pitch)||s.push({command:"setPitch",args:[e.pitch]}),oe(n.roll,e.roll)||s.push({command:"setRoll",args:[e.roll]}),oe(n.sprite,e.sprite)||s.push({command:"setSprite",args:[e.sprite]}),oe(n.glyphs,e.glyphs)||s.push({command:"setGlyphs",args:[e.glyphs]}),oe(n.transition,e.transition)||s.push({command:"setTransition",args:[e.transition]}),oe(n.light,e.light)||s.push({command:"setLight",args:[e.light]}),oe(n.terrain,e.terrain)||s.push({command:"setTerrain",args:[e.terrain]}),oe(n.sky,e.sky)||s.push({command:"setSky",args:[e.sky]}),oe(n.projection,e.projection)||s.push({command:"setProjection",args:[e.projection]});const h={},f=[];(function(v,w,S,E){let C;for(C in w=w||{},v=v||{})Object.prototype.hasOwnProperty.call(v,C)&&(Object.prototype.hasOwnProperty.call(w,C)||wi(C,S,E));for(C in w)Object.prototype.hasOwnProperty.call(w,C)&&(Object.prototype.hasOwnProperty.call(v,C)?oe(v[C],w[C])||(v[C].type==="geojson"&&w[C].type==="geojson"&&oi(v,w,C)?xe(S,{command:"setGeoJSONSourceData",args:[C,w[C].data]}):mi(C,w,S,E)):ze(C,w,S))})(n.sources,e.sources,f,h);const y=[];n.layers&&n.layers.forEach(v=>{"source"in v&&h[v.source]?s.push({command:"removeLayer",args:[v.id]}):y.push(v)}),s=s.concat(f),function(v,w,S){w=w||[];const E=(v=v||[]).map(ei),C=w.map(ei),z=v.reduce(Ji,{}),N=w.reduce(Ji,{}),U=E.slice(),q=Object.create(null);let W,J,rt,yt,lt;for(let j=0,X=0;j<E.length;j++)W=E[j],Object.prototype.hasOwnProperty.call(N,W)?X++:(xe(S,{command:"removeLayer",args:[W]}),U.splice(U.indexOf(W,X),1));for(let j=0,X=0;j<C.length;j++)W=C[C.length-1-j],U[U.length-1-j]!==W&&(Object.prototype.hasOwnProperty.call(z,W)?(xe(S,{command:"removeLayer",args:[W]}),U.splice(U.lastIndexOf(W,U.length-X),1)):X++,yt=U[U.length-j],xe(S,{command:"addLayer",args:[N[W],yt]}),U.splice(U.length-j,0,W),q[W]=!0);for(let j=0;j<C.length;j++)if(W=C[j],J=z[W],rt=N[W],!q[W]&&!oe(J,rt))if(oe(J.source,rt.source)&&oe(J["source-layer"],rt["source-layer"])&&oe(J.type,rt.type)){for(lt in Ae(J.layout,rt.layout,S,W,null,"setLayoutProperty"),Ae(J.paint,rt.paint,S,W,null,"setPaintProperty"),oe(J.filter,rt.filter)||xe(S,{command:"setFilter",args:[W,rt.filter]}),oe(J.minzoom,rt.minzoom)&&oe(J.maxzoom,rt.maxzoom)||xe(S,{command:"setLayerZoomRange",args:[W,rt.minzoom,rt.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?Ae(J[lt],rt[lt],S,W,lt.slice(6),"setPaintProperty"):oe(J[lt],rt[lt])||xe(S,{command:"setLayerProperty",args:[W,lt,rt[lt]]}));for(lt in rt)Object.prototype.hasOwnProperty.call(rt,lt)&&!Object.prototype.hasOwnProperty.call(J,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?Ae(J[lt],rt[lt],S,W,lt.slice(6),"setPaintProperty"):oe(J[lt],rt[lt])||xe(S,{command:"setLayerProperty",args:[W,lt,rt[lt]]}))}else xe(S,{command:"removeLayer",args:[W]}),yt=U[U.lastIndexOf(W)+1],xe(S,{command:"addLayer",args:[rt,yt]})}(y,e.layers,s)}catch(h){console.warn("Unable to compute style diff:",h),s=[{command:"setStyle",args:[e]}]}return s},m.bL=function(n){const e=[],s=n.id;return s===void 0&&e.push({message:`layers.${s}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${s}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},m.bM=Me,m.bN=Ke,m.bO=class extends zi{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},m.bP=qu,m.bQ=class extends zi{constructor(n,e){super(n,e),this.current=Df}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},m.bR=or,m.bS=class extends zi{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},m.bT=class extends zi{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},m.bU=ke,m.bV=function(n,e){var s=Math.sin(e),h=Math.cos(e);return n[0]=h,n[1]=s,n[2]=0,n[3]=-s,n[4]=h,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},m.bW=function(n,e,s){var h=e[0],f=e[1],y=e[2];return n[0]=h*s[0]+f*s[3]+y*s[6],n[1]=h*s[1]+f*s[4]+y*s[7],n[2]=h*s[2]+f*s[5]+y*s[8],n},m.bX=function(n,e,s,h,f,y,v){var w=1/(e-s),S=1/(h-f),E=1/(y-v);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*S,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*E,n[11]=0,n[12]=(e+s)*w,n[13]=(f+h)*S,n[14]=(v+y)*E,n[15]=1,n},m.bY=class extends zi{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let s=0;s<n.length;s++)e[4*s]=n[s].r,e[4*s+1]=n[s].g,e[4*s+2]=n[s].b,e[4*s+3]=n[s].a;this.gl.uniform4fv(this.location,e)}}},m.bZ=class extends zi{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},m.b_=class extends c{},m.ba=function(n,e,s){const h=new Float64Array(4);return qt(h,n,e-90,s),h},m.bb=function(n,e,s,h){var f,y,v,w,S,E=e[0],C=e[1],z=e[2],N=e[3],U=s[0],q=s[1],W=s[2],J=s[3];return(y=E*U+C*q+z*W+N*J)<0&&(y=-y,U=-U,q=-q,W=-W,J=-J),1-y>zt?(f=Math.acos(y),v=Math.sin(f),w=Math.sin((1-h)*f)/v,S=Math.sin(h*f)/v):(w=1-h,S=h),n[0]=w*E+S*U,n[1]=w*C+S*q,n[2]=w*z+S*W,n[3]=w*N+S*J,n},m.bc=function(n){const e=new Float64Array(9);var s,h,f,y,v,w,S,E,C,z,N,U,q,W,J,rt,yt,lt;z=(f=(h=n)[0])*(S=f+f),N=(y=h[1])*S,q=(v=h[2])*S,W=v*(E=y+y),rt=(w=h[3])*S,yt=w*E,lt=w*(C=v+v),(s=e)[0]=1-(U=y*E)-(J=v*C),s[3]=N-lt,s[6]=q+yt,s[1]=N+lt,s[4]=1-z-J,s[7]=W-rt,s[2]=q-yt,s[5]=W+rt,s[8]=1-z-U;const j=_i(-Math.asin(ue(e[2],-1,1)));let X,ut;return Math.hypot(e[5],e[8])<.001?(X=0,ut=-_i(Math.atan2(e[3],e[4]))):(X=_i(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),ut=_i(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:X,pitch:j+90,bearing:ut}},m.bd=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},m.be=si,m.bf=Br,m.bg=xl,m.bh=sc,m.bi=vl,m.bj=Se,m.bk=Ee,m.bl=He,m.bm=function(n,e,s,h,f){return Se(h,f,ue((n-e)/(s-e),0,1))},m.bn=se,m.bo=function(){return new Float64Array(3)},m.bp=function(n,e,s,h){return n[0]=e[0]+s[0]*h,n[1]=e[1]+s[1]*h,n[2]=e[2]+s[2]*h,n},m.bq=qt,m.br=function(n,e,s){var h=s[0],f=s[1],y=s[2],v=e[0],w=e[1],S=e[2],E=f*S-y*w,C=y*v-h*S,z=h*w-f*v,N=f*z-y*C,U=y*E-h*z,q=h*C-f*E,W=2*s[3];return C*=W,z*=W,U*=2,q*=2,n[0]=v+(E*=W)+(N*=2),n[1]=w+C+U,n[2]=S+z+q,n},m.bs=function(n,e,s){const h=(f=[n[0],n[1],n[2],e[0],e[1],e[2],s[0],s[1],s[2]])[0]*((C=f[8])*(v=f[4])-(w=f[5])*(E=f[7]))+f[1]*(-C*(y=f[3])+w*(S=f[6]))+f[2]*(E*y-v*S);var f,y,v,w,S,E,C;if(h===0)return null;const z=qe([],[e[0],e[1],e[2]],[s[0],s[1],s[2]]),N=qe([],[s[0],s[1],s[2]],[n[0],n[1],n[2]]),U=qe([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),q=be([],z,-n[3]);return le(q,q,be([],N,-e[3])),le(q,q,be([],U,-s[3])),be(q,q,1/h),q},m.bt=hp,m.bu=function(){return new Float64Array(4)},m.bv=function(n,e,s,h){var f=[],y=[];return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],y[0]=f[0]*Math.cos(h)-f[1]*Math.sin(h),y[1]=f[0]*Math.sin(h)+f[1]*Math.cos(h),y[2]=f[2],n[0]=y[0]+s[0],n[1]=y[1]+s[1],n[2]=y[2]+s[2],n},m.bw=function(n,e,s,h){var f=[],y=[];return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],y[0]=f[0],y[1]=f[1]*Math.cos(h)-f[2]*Math.sin(h),y[2]=f[1]*Math.sin(h)+f[2]*Math.cos(h),n[0]=y[0]+s[0],n[1]=y[1]+s[1],n[2]=y[2]+s[2],n},m.bx=function(n,e,s,h){var f=[],y=[];return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],y[0]=f[2]*Math.sin(h)+f[0]*Math.cos(h),y[1]=f[1],y[2]=f[2]*Math.cos(h)-f[0]*Math.sin(h),n[0]=y[0]+s[0],n[1]=y[1]+s[1],n[2]=y[2]+s[2],n},m.by=function(n,e,s){var h=Math.sin(s),f=Math.cos(s),y=e[0],v=e[1],w=e[2],S=e[3],E=e[8],C=e[9],z=e[10],N=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=y*f-E*h,n[1]=v*f-C*h,n[2]=w*f-z*h,n[3]=S*f-N*h,n[8]=y*h+E*f,n[9]=v*h+C*f,n[10]=w*h+z*f,n[11]=S*h+N*f,n},m.bz=function(n,e){const s=se(n,360),h=se(e,360),f=h-s,y=h>s?f-360:f+360;return Math.abs(f)<Math.abs(y)?f:y},m.c=_t,m.c0=class extends _{},m.c1=Nf,m.c2=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},m.c3=ug,m.c4=function(n,e,s){var h=e[0],f=e[1],y=e[2],v=s[3]*h+s[7]*f+s[11]*y+s[15];return n[0]=(s[0]*h+s[4]*f+s[8]*y+s[12])/(v=v||1),n[1]=(s[1]*h+s[5]*f+s[9]*y+s[13])/v,n[2]=(s[2]*h+s[6]*f+s[10]*y+s[14])/v,n},m.c5=class extends $h{},m.c6=class extends L{},m.c7=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},m.c8=function(n,e){var s=n[0],h=n[1],f=n[2],y=n[3],v=n[4],w=n[5],S=n[6],E=n[7],C=n[8],z=n[9],N=n[10],U=n[11],q=n[12],W=n[13],J=n[14],rt=n[15],yt=e[0],lt=e[1],j=e[2],X=e[3],ut=e[4],Pt=e[5],jt=e[6],kt=e[7],Ot=e[8],Ht=e[9],$t=e[10],Kt=e[11],Bt=e[12],me=e[13],Ie=e[14],Te=e[15];return Math.abs(s-yt)<=zt*Math.max(1,Math.abs(s),Math.abs(yt))&&Math.abs(h-lt)<=zt*Math.max(1,Math.abs(h),Math.abs(lt))&&Math.abs(f-j)<=zt*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(y-X)<=zt*Math.max(1,Math.abs(y),Math.abs(X))&&Math.abs(v-ut)<=zt*Math.max(1,Math.abs(v),Math.abs(ut))&&Math.abs(w-Pt)<=zt*Math.max(1,Math.abs(w),Math.abs(Pt))&&Math.abs(S-jt)<=zt*Math.max(1,Math.abs(S),Math.abs(jt))&&Math.abs(E-kt)<=zt*Math.max(1,Math.abs(E),Math.abs(kt))&&Math.abs(C-Ot)<=zt*Math.max(1,Math.abs(C),Math.abs(Ot))&&Math.abs(z-Ht)<=zt*Math.max(1,Math.abs(z),Math.abs(Ht))&&Math.abs(N-$t)<=zt*Math.max(1,Math.abs(N),Math.abs($t))&&Math.abs(U-Kt)<=zt*Math.max(1,Math.abs(U),Math.abs(Kt))&&Math.abs(q-Bt)<=zt*Math.max(1,Math.abs(q),Math.abs(Bt))&&Math.abs(W-me)<=zt*Math.max(1,Math.abs(W),Math.abs(me))&&Math.abs(J-Ie)<=zt*Math.max(1,Math.abs(J),Math.abs(Ie))&&Math.abs(rt-Te)<=zt*Math.max(1,Math.abs(rt),Math.abs(Te))},m.c9=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},m.cA=function(n){delete $.REGISTERED_PROTOCOLS[n]},m.cB=function(n,e){const s={};for(let f=0;f<n.length;f++){const y=e&&e[n[f].id]||rl(n[f]);e&&(e[n[f].id]=y);let v=s[y];v||(v=s[y]=[]),v.push(n[f])}const h=[];for(const f in s)h.push(s[f]);return h},m.cC=ce,m.cD=f_,m.cE=m_,m.cF=$g,m.cG=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Et/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],s=e.layout,h=e._unevaluatedLayout._values,f={layoutIconSize:h["icon-size"].possiblyEvaluate(new Oi(n.bucket.zoom+1),n.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new Oi(n.bucket.zoom+1),n.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new Oi(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:C}=n.bucket.textSizeData;f.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Oi(E),n.canonical),h["text-size"].possiblyEvaluate(new Oi(C),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:C}=n.bucket.iconSizeData;f.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Oi(E),n.canonical),h["icon-size"].possiblyEvaluate(new Oi(C),n.canonical)]}const y=s.get("text-line-height")*mr,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),S=s.get("text-size");for(const E of n.bucket.features){const C=s.get("text-font").evaluate(E,{},n.canonical).join(","),z=S.evaluate(E,{},n.canonical),N=f.layoutTextSize.evaluate(E,{},n.canonical),U=f.layoutIconSize.evaluate(E,{},n.canonical),q={horizontal:{},vertical:void 0},W=E.text;let J,rt=[0,0];if(W){const j=W.toString(),X=s.get("text-letter-spacing").evaluate(E,{},n.canonical)*mr,ut=Fu(j)?X:0,Pt=s.get("text-anchor").evaluate(E,{},n.canonical),jt=P_(e,E,n.canonical);if(!jt){const $t=s.get("text-radial-offset").evaluate(E,{},n.canonical);rt=$t?T_(Pt,[$t*mr,dp]):s.get("text-offset").evaluate(E,{},n.canonical).map(Kt=>Kt*mr)}let kt=v?"center":s.get("text-justify").evaluate(E,{},n.canonical);const Ot=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(E,{},n.canonical)*mr:1/0,Ht=()=>{n.bucket.allowVerticalPlacement&&Nh(j)&&(q.vertical=Ju(W,n.glyphMap,n.glyphPositions,n.imagePositions,C,Ot,y,Pt,"left",ut,rt,m.an.vertical,!0,N,z))};if(!v&&jt){const $t=new Set;if(kt==="auto")for(let Bt=0;Bt<jt.values.length;Bt+=2)$t.add(fp(jt.values[Bt]));else $t.add(kt);let Kt=!1;for(const Bt of $t)if(!q.horizontal[Bt])if(Kt)q.horizontal[Bt]=q.horizontal[0];else{const me=Ju(W,n.glyphMap,n.glyphPositions,n.imagePositions,C,Ot,y,"center",Bt,ut,rt,m.an.horizontal,!1,N,z);me&&(q.horizontal[Bt]=me,Kt=me.positionedLines.length===1)}Ht()}else{kt==="auto"&&(kt=fp(Pt));const $t=Ju(W,n.glyphMap,n.glyphPositions,n.imagePositions,C,Ot,y,Pt,kt,ut,rt,m.an.horizontal,!1,N,z);$t&&(q.horizontal[kt]=$t),Ht(),Nh(j)&&v&&w&&(q.vertical=Ju(W,n.glyphMap,n.glyphPositions,n.imagePositions,C,Ot,y,Pt,kt,ut,rt,m.an.vertical,!1,N,z))}}let yt=!1;if(E.icon&&E.icon.name){const j=n.imageMap[E.icon.name];j&&(J=Uv(n.imagePositions[E.icon.name],s.get("icon-offset").evaluate(E,{},n.canonical),s.get("icon-anchor").evaluate(E,{},n.canonical)),yt=!!j.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=yt:n.bucket.sdfIcons!==yt&&he("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==n.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const lt=I_(q.horizontal)||q.vertical;n.bucket.iconsInText=!!lt&&lt.iconsInText,(lt||J)&&nx(n.bucket,E,q,J,n.imageMap,f,N,U,rt,yt,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},m.cH=Yf,m.cI=$f,m.cJ=Kf,m.cK=ac,m.cL=tp,m.cM=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},m.cN=function(n,e,s,h,f){return o(this,void 0,void 0,function*(){if(Ct())try{return yield Ue(n,e,s,h,f)}catch{}return function(y,v,w,S,E){const C=y.width,z=y.height;di&&gi||(di=new OffscreenCanvas(C,z),gi=di.getContext("2d",{willReadFrequently:!0})),di.width=C,di.height=z,gi.drawImage(y,0,0,C,z);const N=gi.getImageData(v,w,S,E);return gi.clearRect(0,0,C,z),N.data}(n,e,s,h,f)})},m.cO=pg,m.cP=P,m.cQ=D,m.cR=Rg,m.cS=Vg,m.cT=Qo,m.cU=nn,m.ca=n=>n.type==="symbol",m.cb=n=>n.type==="circle",m.cc=n=>n.type==="heatmap",m.cd=n=>n.type==="line",m.ce=n=>n.type==="fill",m.cf=n=>n.type==="fill-extrusion",m.cg=n=>n.type==="hillshade",m.ch=n=>n.type==="color-relief",m.ci=n=>n.type==="raster",m.cj=n=>n.type==="background",m.ck=n=>n.type==="custom",m.cl=_e,m.cm=function(n,e,s){const h=Ut(e.x-s.x,e.y-s.y),f=Ut(n.x-s.x,n.y-s.y);var y,v;return _i(Math.atan2(h[0]*f[1]-h[1]*f[0],(y=h)[0]*(v=f)[0]+y[1]*v[1]))},m.cn=je,m.co=function(n,e){return Je[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},m.cp=function(n,e){return Si[e]&&"touches"in n},m.cq=function(n){return Si[n]||Je[n]},m.cr=function(n,e,s){var h=e[0],f=e[1];return n[0]=s[0]*h+s[4]*f+s[12],n[1]=s[1]*h+s[5]*f+s[13],n},m.cs=function(n,e){const{x:s,y:h}=uc.fromLngLat(e);return!(n<0||n>25||h<0||h>=1||s<0||s>=1)},m.ct=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},m.cu=class extends on{},m.cv=ox,m.cx=function(n){return n.message===fi},m.cy=nt,m.cz=function(n,e){$.REGISTERED_PROTOCOLS[n]=e},m.d=St,m.e=Ve,m.f=n=>o(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.g=H,m.h=n=>new Promise((e,s)=>{const h=new Image;h.onload=()=>{e(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=Ge})},h.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(n)],{type:"image/png"});h.src=n.byteLength?URL.createObjectURL(f):Ge}),m.i=Ne,m.j=(n,e)=>vt(Ve(n,{type:"json"}),e),m.k=wt,m.l=Rt,m.m=vt,m.n=(n,e)=>vt(Ve(n,{type:"arrayBuffer"}),e),m.o=function(n){return new tp(n).readFields(Rv,[])},m.p=qg,m.q=Qh,m.r=Fr,m.s=Bi,m.t=Vh,m.u=ai,m.v=ft,m.w=he,m.x=Ef,m.y=ro,m.z=ua}),p("worker",["./shared"],function(m){class o{constructor($){this.keyCache={},$&&this.replace($)}replace($){this._layerConfigs={},this._layers={},this.update($,[])}update($,H){for(const nt of $){this._layerConfigs[nt.id]=nt;const mt=this._layers[nt.id]=m.bI(nt);mt._featureFilter=m.a9(mt.filter),this.keyCache[nt.id]&&delete this.keyCache[nt.id]}for(const nt of H)delete this.keyCache[nt],delete this._layerConfigs[nt],delete this._layers[nt];this.familiesBySource={};const Y=m.cB(Object.values(this._layerConfigs),this.keyCache);for(const nt of Y){const mt=nt.map(wt=>this._layers[wt.id]),vt=mt[0];if(vt.visibility==="none")continue;const St=vt.source||"";let xt=this.familiesBySource[St];xt||(xt=this.familiesBySource[St]={});const Lt=vt.sourceLayer||"_geojsonTileLayer";let Rt=xt[Lt];Rt||(Rt=xt[Lt]=[]),Rt.push(mt)}}}class P{constructor($){const H={},Y=[];for(const St in $){const xt=$[St],Lt=H[St]={};for(const Rt in xt){const wt=xt[+Rt];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;const Nt={x:0,y:0,w:wt.bitmap.width+2,h:wt.bitmap.height+2};Y.push(Nt),Lt[Rt]={rect:Nt,metrics:wt.metrics}}}const{w:nt,h:mt}=m.p(Y),vt=new m.q({width:nt||1,height:mt||1});for(const St in $){const xt=$[St];for(const Lt in xt){const Rt=xt[+Lt];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const wt=H[St][Lt].rect;m.q.copy(Rt.bitmap,vt,{x:0,y:0},{x:wt.x+1,y:wt.y+1},Rt.bitmap)}}this.image=vt,this.positions=H}}m.cC("GlyphAtlas",P);class A{constructor($){this.tileID=new m.Z($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.uid=$.uid,this.zoom=$.zoom,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.returnDependencies=!!$.returnDependencies,this.promoteId=$.promoteId,this.inFlightDependencies=[],this.globalState=$.globalState}parse($,H,Y,nt,mt){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=$,this.collisionBoxArray=new m.a7;const vt=new m.cD(Object.keys($.layers).sort()),St=new m.cE(this.tileID,this.promoteId);St.bucketLayerIDs=[];const xt={},Lt={featureIndex:St,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y,subdivisionGranularity:mt},Rt=H.familiesBySource[this.source];for(const Ae in Rt){const ei=$.layers[Ae];if(!ei)continue;ei.version===1&&m.w(`Vector tile source "${this.source}" layer "${Ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ji=vt.encode(Ae),Xt=[];for(let ir=0;ir<ei.length;ir++){const ki=ei.feature(ir),qr=St.getId(ki,Ae);Xt.push({feature:ki,id:qr,index:ir,sourceLayerIndex:Ji})}for(const ir of Rt[Ae]){const ki=ir[0];ki.source!==this.source&&m.w(`layer.source = ${ki.source} does not equal this.source = ${this.source}`),ki.minzoom&&this.zoom<Math.floor(ki.minzoom)||ki.maxzoom&&this.zoom>=ki.maxzoom||ki.visibility!=="none"&&(O(ir,this.zoom,Y),(xt[ki.id]=ki.createBucket({index:St.bucketLayerIDs.length,layers:ir,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ji,sourceID:this.source,globalState:this.globalState})).populate(Xt,Lt,this.tileID.canonical),St.bucketLayerIDs.push(ir.map(qr=>qr.id)))}}const wt=m.bM(Lt.glyphDependencies,Ae=>Object.keys(Ae).map(Number));this.inFlightDependencies.forEach(Ae=>Ae==null?void 0:Ae.abort()),this.inFlightDependencies=[];let Nt=Promise.resolve({});if(Object.keys(wt).length){const Ae=new AbortController;this.inFlightDependencies.push(Ae),Nt=nt.sendAsync({type:"GG",data:{stacks:wt,source:this.source,tileID:this.tileID,type:"glyphs"}},Ae)}const ft=Object.keys(Lt.iconDependencies);let re=Promise.resolve({});if(ft.length){const Ae=new AbortController;this.inFlightDependencies.push(Ae),re=nt.sendAsync({type:"GI",data:{icons:ft,source:this.source,tileID:this.tileID,type:"icons"}},Ae)}const Pe=Object.keys(Lt.patternDependencies);let oe=Promise.resolve({});if(Pe.length){const Ae=new AbortController;this.inFlightDependencies.push(Ae),oe=nt.sendAsync({type:"GI",data:{icons:Pe,source:this.source,tileID:this.tileID,type:"patterns"}},Ae)}const[xe,ze,wi]=yield Promise.all([Nt,re,oe]),mi=new P(xe),oi=new m.cF(ze,wi);for(const Ae in xt){const ei=xt[Ae];ei instanceof m.a8?(O(ei.layers,this.zoom,Y),m.cG({bucket:ei,glyphMap:xe,glyphPositions:mi.positions,imageMap:ze,imagePositions:oi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Lt.subdivisionGranularity})):ei.hasPattern&&(ei instanceof m.cH||ei instanceof m.cI||ei instanceof m.cJ)&&(O(ei.layers,this.zoom,Y),ei.addFeatures(Lt,this.tileID.canonical,oi.patternPositions))}return this.status="done",{buckets:Object.values(xt).filter(Ae=>!Ae.isEmpty()),featureIndex:St,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mi.image,imageAtlas:oi,glyphMap:this.returnDependencies?xe:null,iconMap:this.returnDependencies?ze:null,glyphPositions:this.returnDependencies?mi.positions:null}})}}function O(_t,$,H){const Y=new m.F($);for(const nt of _t)nt.recalculate(Y,H)}class D{constructor($,H,Y){this.actor=$,this.layerIndex=H,this.availableImages=Y,this.fetching={},this.loading={},this.loaded={}}loadVectorTile($,H){return m._(this,void 0,void 0,function*(){const Y=yield m.n($.request,H);try{return{vectorTile:new m.cK.VectorTile(new m.cL(Y.data)),rawData:Y.data,cacheControl:Y.cacheControl,expires:Y.expires}}catch(nt){const mt=new Uint8Array(Y.data);let vt=`Unable to parse the tile at ${$.request.url}, `;throw vt+=mt[0]===31&&mt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${nt.message}`,new Error(vt)}})}loadTile($){return m._(this,void 0,void 0,function*(){const H=$.uid,Y=!!($&&$.request&&$.request.collectResourceTiming)&&new m.cM($.request),nt=new A($);this.loading[H]=nt;const mt=new AbortController;nt.abort=mt;try{const vt=yield this.loadVectorTile($,mt);if(delete this.loading[H],!vt)return null;const St=vt.rawData,xt={};vt.expires&&(xt.expires=vt.expires),vt.cacheControl&&(xt.cacheControl=vt.cacheControl);const Lt={};if(Y){const wt=Y.finish();wt&&(Lt.resourceTiming=JSON.parse(JSON.stringify(wt)))}nt.vectorTile=vt.vectorTile;const Rt=nt.parse(vt.vectorTile,this.layerIndex,this.availableImages,this.actor,$.subdivisionGranularity);this.loaded[H]=nt,this.fetching[H]={rawTileData:St,cacheControl:xt,resourceTiming:Lt};try{const wt=yield Rt;return m.e({rawTileData:St.slice(0)},wt,xt,Lt)}finally{delete this.fetching[H]}}catch(vt){throw delete this.loading[H],nt.status="done",this.loaded[H]=nt,vt}})}reloadTile($){return m._(this,void 0,void 0,function*(){const H=$.uid;if(!this.loaded||!this.loaded[H])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Y=this.loaded[H];if(Y.showCollisionBoxes=$.showCollisionBoxes,Y.globalState=$.globalState,Y.status==="parsing"){const nt=yield Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,$.subdivisionGranularity);let mt;if(this.fetching[H]){const{rawTileData:vt,cacheControl:St,resourceTiming:xt}=this.fetching[H];delete this.fetching[H],mt=m.e({rawTileData:vt.slice(0)},nt,St,xt)}else mt=nt;return mt}if(Y.status==="done"&&Y.vectorTile)return Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,$.subdivisionGranularity)})}abortTile($){return m._(this,void 0,void 0,function*(){const H=this.loading,Y=$.uid;H&&H[Y]&&H[Y].abort&&(H[Y].abort.abort(),delete H[Y])})}removeTile($){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[$.uid]&&delete this.loaded[$.uid]})}}class k{constructor(){this.loaded={}}loadTile($){return m._(this,void 0,void 0,function*(){const{uid:H,encoding:Y,rawImageData:nt,redFactor:mt,greenFactor:vt,blueFactor:St,baseShift:xt}=$,Lt=nt.width+2,Rt=nt.height+2,wt=m.b(nt)?new m.R({width:Lt,height:Rt},yield m.cN(nt,-1,-1,Lt,Rt)):nt,Nt=new m.cO(H,wt,Y,mt,vt,St,xt);return this.loaded=this.loaded||{},this.loaded[H]=Nt,Nt})}removeTile($){const H=this.loaded,Y=$.uid;H&&H[Y]&&delete H[Y]}}var B,V,K=function(){if(V)return B;function _t(H,Y){if(H.length!==0){$(H[0],Y);for(var nt=1;nt<H.length;nt++)$(H[nt],!Y)}}function $(H,Y){for(var nt=0,mt=0,vt=0,St=H.length,xt=St-1;vt<St;xt=vt++){var Lt=(H[vt][0]-H[xt][0])*(H[xt][1]+H[vt][1]),Rt=nt+Lt;mt+=Math.abs(nt)>=Math.abs(Lt)?nt-Rt+Lt:Lt-Rt+nt,nt=Rt}nt+mt>=0!=!!Y&&H.reverse()}return V=1,B=function H(Y,nt){var mt,vt=Y&&Y.type;if(vt==="FeatureCollection")for(mt=0;mt<Y.features.length;mt++)H(Y.features[mt],nt);else if(vt==="GeometryCollection")for(mt=0;mt<Y.geometries.length;mt++)H(Y.geometries[mt],nt);else if(vt==="Feature")H(Y.geometry,nt);else if(vt==="Polygon")_t(Y.coordinates,nt);else if(vt==="MultiPolygon")for(mt=0;mt<Y.coordinates.length;mt++)_t(Y.coordinates[mt],nt);return Y}}(),it=m.cP(K);const gt=m.cK.VectorTileFeature.prototype.toGeoJSON;class ct{constructor($){this._feature=$,this.extent=m.$,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))}loadGeometry(){if(this._feature.type===1){const $=[];for(const H of this._feature.geometry)$.push([new m.P(H[0],H[1])]);return $}{const $=[];for(const H of this._feature.geometry){const Y=[];for(const nt of H)Y.push(new m.P(nt[0],nt[1]));$.push(Y)}return $}}toGeoJSON($,H,Y){return gt.call(this,$,H,Y)}}class Dt{constructor($){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.$,this.length=$.length,this._features=$}feature($){return new ct(this._features[$])}}var Ct,zt,ae,ke={exports:{}},de=function(){if(ae)return ke.exports;ae=1;var _t=m.cS(),$=function(){if(zt)return Ct;zt=1;var Rt=m.cQ(),wt=m.cR().VectorTileFeature;function Nt(re,Pe){this.options=Pe||{},this.features=re,this.length=re.length}function ft(re,Pe){this.id=typeof re.id=="number"?re.id:void 0,this.type=re.type,this.rawGeometry=re.type===1?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=Pe||4096}return Ct=Nt,Nt.prototype.feature=function(re){return new ft(this.features[re],this.options.extent)},ft.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var Pe=0;Pe<re.length;Pe++){for(var oe=re[Pe],xe=[],ze=0;ze<oe.length;ze++)xe.push(new Rt(oe[ze][0],oe[ze][1]));this.geometry.push(xe)}return this.geometry},ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,Pe=1/0,oe=-1/0,xe=1/0,ze=-1/0,wi=0;wi<re.length;wi++)for(var mi=re[wi],oi=0;oi<mi.length;oi++){var Ae=mi[oi];Pe=Math.min(Pe,Ae.x),oe=Math.max(oe,Ae.x),xe=Math.min(xe,Ae.y),ze=Math.max(ze,Ae.y)}return[Pe,xe,oe,ze]},ft.prototype.toGeoJSON=wt.prototype.toGeoJSON,Ct}();function H(Rt){var wt=new _t;return function(Nt,ft){for(var re in Nt.layers)ft.writeMessage(3,Y,Nt.layers[re])}(Rt,wt),wt.finish()}function Y(Rt,wt){var Nt;wt.writeVarintField(15,Rt.version||1),wt.writeStringField(1,Rt.name||""),wt.writeVarintField(5,Rt.extent||4096);var ft={keys:[],values:[],keycache:{},valuecache:{}};for(Nt=0;Nt<Rt.length;Nt++)ft.feature=Rt.feature(Nt),wt.writeMessage(2,nt,ft);var re=ft.keys;for(Nt=0;Nt<re.length;Nt++)wt.writeStringField(3,re[Nt]);var Pe=ft.values;for(Nt=0;Nt<Pe.length;Nt++)wt.writeMessage(4,Lt,Pe[Nt])}function nt(Rt,wt){var Nt=Rt.feature;Nt.id!==void 0&&wt.writeVarintField(1,Nt.id),wt.writeMessage(2,mt,Rt),wt.writeVarintField(3,Nt.type),wt.writeMessage(4,xt,Nt)}function mt(Rt,wt){var Nt=Rt.feature,ft=Rt.keys,re=Rt.values,Pe=Rt.keycache,oe=Rt.valuecache;for(var xe in Nt.properties){var ze=Nt.properties[xe],wi=Pe[xe];if(ze!==null){wi===void 0&&(ft.push(xe),Pe[xe]=wi=ft.length-1),wt.writeVarint(wi);var mi=typeof ze;mi!=="string"&&mi!=="boolean"&&mi!=="number"&&(ze=JSON.stringify(ze));var oi=mi+":"+ze,Ae=oe[oi];Ae===void 0&&(re.push(ze),oe[oi]=Ae=re.length-1),wt.writeVarint(Ae)}}}function vt(Rt,wt){return(wt<<3)+(7&Rt)}function St(Rt){return Rt<<1^Rt>>31}function xt(Rt,wt){for(var Nt=Rt.loadGeometry(),ft=Rt.type,re=0,Pe=0,oe=Nt.length,xe=0;xe<oe;xe++){var ze=Nt[xe],wi=1;ft===1&&(wi=ze.length),wt.writeVarint(vt(1,wi));for(var mi=ft===3?ze.length-1:ze.length,oi=0;oi<mi;oi++){oi===1&&ft!==1&&wt.writeVarint(vt(2,mi-1));var Ae=ze[oi].x-re,ei=ze[oi].y-Pe;wt.writeVarint(St(Ae)),wt.writeVarint(St(ei)),re+=Ae,Pe+=ei}ft===3&&wt.writeVarint(vt(7,1))}}function Lt(Rt,wt){var Nt=typeof Rt;Nt==="string"?wt.writeStringField(1,Rt):Nt==="boolean"?wt.writeBooleanField(7,Rt):Nt==="number"&&(Rt%1!=0?wt.writeDoubleField(3,Rt):Rt<0?wt.writeSVarintField(6,Rt):wt.writeVarintField(5,Rt))}return ke.exports=H,ke.exports.fromVectorTileJs=H,ke.exports.fromGeojsonVt=function(Rt,wt){wt=wt||{};var Nt={};for(var ft in Rt)Nt[ft]=new $(Rt[ft].features,wt),Nt[ft].name=ft,Nt[ft].version=wt.version,Nt[ft].extent=wt.extent;return H({layers:Nt})},ke.exports.GeoJSONWrapper=$,ke.exports}(),Le=m.cP(de);const Xe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_t=>_t},ne=Math.fround||(le=new Float32Array(1),_t=>(le[0]=+_t,le[0]));var le;class be{constructor($){this.options=Object.assign(Object.create(Xe),$),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load($){const{log:H,minZoom:Y,maxZoom:nt}=this.options;H&&console.time("total time");const mt=`prepare ${$.length} points`;H&&console.time(mt),this.points=$;const vt=[];for(let xt=0;xt<$.length;xt++){const Lt=$[xt];if(!Lt.geometry)continue;const[Rt,wt]=Lt.geometry.coordinates,Nt=ne(ui(Rt)),ft=ne(yi(wt));vt.push(Nt,ft,1/0,xt,-1,1),this.options.reduce&&vt.push(0)}let St=this.trees[nt+1]=this._createTree(vt);H&&console.timeEnd(mt);for(let xt=nt;xt>=Y;xt--){const Lt=+Date.now();St=this.trees[xt]=this._createTree(this._cluster(St,xt)),H&&console.log("z%d: %d clusters in %dms",xt,St.numItems,+Date.now()-Lt)}return H&&console.timeEnd("total time"),this}getClusters($,H){let Y=(($[0]+180)%360+360)%360-180;const nt=Math.max(-90,Math.min(90,$[1]));let mt=$[2]===180?180:(($[2]+180)%360+360)%360-180;const vt=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)Y=-180,mt=180;else if(Y>mt){const wt=this.getClusters([Y,nt,180,vt],H),Nt=this.getClusters([-180,nt,mt,vt],H);return wt.concat(Nt)}const St=this.trees[this._limitZoom(H)],xt=St.range(ui(Y),yi(vt),ui(mt),yi(nt)),Lt=St.data,Rt=[];for(const wt of xt){const Nt=this.stride*wt;Rt.push(Lt[Nt+5]>1?qe(Lt,Nt,this.clusterProps):this.points[Lt[Nt+3]])}return Rt}getChildren($){const H=this._getOriginId($),Y=this._getOriginZoom($),nt="No cluster with the specified id.",mt=this.trees[Y];if(!mt)throw new Error(nt);const vt=mt.data;if(H*this.stride>=vt.length)throw new Error(nt);const St=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),xt=mt.within(vt[H*this.stride],vt[H*this.stride+1],St),Lt=[];for(const Rt of xt){const wt=Rt*this.stride;vt[wt+4]===$&&Lt.push(vt[wt+5]>1?qe(vt,wt,this.clusterProps):this.points[vt[wt+3]])}if(Lt.length===0)throw new Error(nt);return Lt}getLeaves($,H,Y){const nt=[];return this._appendLeaves(nt,$,H=H||10,Y=Y||0,0),nt}getTile($,H,Y){const nt=this.trees[this._limitZoom($)],mt=Math.pow(2,$),{extent:vt,radius:St}=this.options,xt=St/vt,Lt=(Y-xt)/mt,Rt=(Y+1+xt)/mt,wt={features:[]};return this._addTileFeatures(nt.range((H-xt)/mt,Lt,(H+1+xt)/mt,Rt),nt.data,H,Y,mt,wt),H===0&&this._addTileFeatures(nt.range(1-xt/mt,Lt,1,Rt),nt.data,mt,Y,mt,wt),H===mt-1&&this._addTileFeatures(nt.range(0,Lt,xt/mt,Rt),nt.data,-1,Y,mt,wt),wt.features.length?wt:null}getClusterExpansionZoom($){let H=this._getOriginZoom($)-1;for(;H<=this.options.maxZoom;){const Y=this.getChildren($);if(H++,Y.length!==1)break;$=Y[0].properties.cluster_id}return H}_appendLeaves($,H,Y,nt,mt){const vt=this.getChildren(H);for(const St of vt){const xt=St.properties;if(xt&&xt.cluster?mt+xt.point_count<=nt?mt+=xt.point_count:mt=this._appendLeaves($,xt.cluster_id,Y,nt,mt):mt<nt?mt++:$.push(St),$.length===Y)break}return mt}_createTree($){const H=new m.aH($.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<$.length;Y+=this.stride)H.add($[Y],$[Y+1]);return H.finish(),H.data=$,H}_addTileFeatures($,H,Y,nt,mt,vt){for(const St of $){const xt=St*this.stride,Lt=H[xt+5]>1;let Rt,wt,Nt;if(Lt)Rt=Ce(H,xt,this.clusterProps),wt=H[xt],Nt=H[xt+1];else{const Pe=this.points[H[xt+3]];Rt=Pe.properties;const[oe,xe]=Pe.geometry.coordinates;wt=ui(oe),Nt=yi(xe)}const ft={type:1,geometry:[[Math.round(this.options.extent*(wt*mt-Y)),Math.round(this.options.extent*(Nt*mt-nt))]],tags:Rt};let re;re=Lt||this.options.generateId?H[xt+3]:this.points[H[xt+3]].id,re!==void 0&&(ft.id=re),vt.features.push(ft)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(Math.floor(+$),this.options.maxZoom+1))}_cluster($,H){const{radius:Y,extent:nt,reduce:mt,minPoints:vt}=this.options,St=Y/(nt*Math.pow(2,H)),xt=$.data,Lt=[],Rt=this.stride;for(let wt=0;wt<xt.length;wt+=Rt){if(xt[wt+2]<=H)continue;xt[wt+2]=H;const Nt=xt[wt],ft=xt[wt+1],re=$.within(xt[wt],xt[wt+1],St),Pe=xt[wt+5];let oe=Pe;for(const xe of re){const ze=xe*Rt;xt[ze+2]>H&&(oe+=xt[ze+5])}if(oe>Pe&&oe>=vt){let xe,ze=Nt*Pe,wi=ft*Pe,mi=-1;const oi=(wt/Rt<<5)+(H+1)+this.points.length;for(const Ae of re){const ei=Ae*Rt;if(xt[ei+2]<=H)continue;xt[ei+2]=H;const Ji=xt[ei+5];ze+=xt[ei]*Ji,wi+=xt[ei+1]*Ji,xt[ei+4]=oi,mt&&(xe||(xe=this._map(xt,wt,!0),mi=this.clusterProps.length,this.clusterProps.push(xe)),mt(xe,this._map(xt,ei)))}xt[wt+4]=oi,Lt.push(ze/oe,wi/oe,1/0,oi,-1,oe),mt&&Lt.push(mi)}else{for(let xe=0;xe<Rt;xe++)Lt.push(xt[wt+xe]);if(oe>1)for(const xe of re){const ze=xe*Rt;if(!(xt[ze+2]<=H)){xt[ze+2]=H;for(let wi=0;wi<Rt;wi++)Lt.push(xt[ze+wi])}}}}return Lt}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,H,Y){if($[H+5]>1){const vt=this.clusterProps[$[H+6]];return Y?Object.assign({},vt):vt}const nt=this.points[$[H+3]].properties,mt=this.options.map(nt);return Y&&mt===nt?Object.assign({},mt):mt}}function qe(_t,$,H){return{type:"Feature",id:_t[$+3],properties:Ce(_t,$,H),geometry:{type:"Point",coordinates:[(Y=_t[$],360*(Y-.5)),Ft(_t[$+1])]}};var Y}function Ce(_t,$,H){const Y=_t[$+5],nt=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,mt=_t[$+6],vt=mt===-1?{}:Object.assign({},H[mt]);return Object.assign(vt,{cluster:!0,cluster_id:_t[$+3],point_count:Y,point_count_abbreviated:nt})}function ui(_t){return _t/360+.5}function yi(_t){const $=Math.sin(_t*Math.PI/180),H=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return H<0?0:H>1?1:H}function Ft(_t){const $=(180-360*_t)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function qt(_t,$,H,Y){let nt=Y;const mt=$+(H-$>>1);let vt,St=H-$;const xt=_t[$],Lt=_t[$+1],Rt=_t[H],wt=_t[H+1];for(let Nt=$+3;Nt<H;Nt+=3){const ft=Wt(_t[Nt],_t[Nt+1],xt,Lt,Rt,wt);if(ft>nt)vt=Nt,nt=ft;else if(ft===nt){const re=Math.abs(Nt-mt);re<St&&(vt=Nt,St=re)}}nt>Y&&(vt-$>3&&qt(_t,$,vt,Y),_t[vt+2]=nt,H-vt>3&&qt(_t,vt,H,Y))}function Wt(_t,$,H,Y,nt,mt){let vt=nt-H,St=mt-Y;if(vt!==0||St!==0){const xt=((_t-H)*vt+($-Y)*St)/(vt*vt+St*St);xt>1?(H=nt,Y=mt):xt>0&&(H+=vt*xt,Y+=St*xt)}return vt=_t-H,St=$-Y,vt*vt+St*St}function Ut(_t,$,H,Y){const nt={id:_t??null,type:$,geometry:H,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if($==="Point"||$==="MultiPoint"||$==="LineString")Et(nt,H);else if($==="Polygon")Et(nt,H[0]);else if($==="MultiLineString")for(const mt of H)Et(nt,mt);else if($==="MultiPolygon")for(const mt of H)Et(nt,mt[0]);return nt}function Et(_t,$){for(let H=0;H<$.length;H+=3)_t.minX=Math.min(_t.minX,$[H]),_t.minY=Math.min(_t.minY,$[H+1]),_t.maxX=Math.max(_t.maxX,$[H]),_t.maxY=Math.max(_t.maxY,$[H+1])}function Gt(_t,$,H,Y){if(!$.geometry)return;const nt=$.geometry.coordinates;if(nt&&nt.length===0)return;const mt=$.geometry.type,vt=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2);let St=[],xt=$.id;if(H.promoteId?xt=$.properties[H.promoteId]:H.generateId&&(xt=Y||0),mt==="Point")se(nt,St);else if(mt==="MultiPoint")for(const Lt of nt)se(Lt,St);else if(mt==="LineString")Se(nt,St,vt,!1);else if(mt==="MultiLineString"){if(H.lineMetrics){for(const Lt of nt)St=[],Se(Lt,St,vt,!1),_t.push(Ut(xt,"LineString",St,$.properties));return}Ee(nt,St,vt,!1)}else if(mt==="Polygon")Ee(nt,St,vt,!0);else{if(mt!=="MultiPolygon"){if(mt==="GeometryCollection"){for(const Lt of $.geometry.geometries)Gt(_t,{id:xt,geometry:Lt,properties:$.properties},H,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Lt of nt){const Rt=[];Ee(Lt,Rt,vt,!0),St.push(Rt)}}_t.push(Ut(xt,mt,St,$.properties))}function se(_t,$){$.push(_e(_t[0]),je(_t[1]),0)}function Se(_t,$,H,Y){let nt,mt,vt=0;for(let xt=0;xt<_t.length;xt++){const Lt=_e(_t[xt][0]),Rt=je(_t[xt][1]);$.push(Lt,Rt,0),xt>0&&(vt+=Y?(nt*Rt-Lt*mt)/2:Math.sqrt(Math.pow(Lt-nt,2)+Math.pow(Rt-mt,2))),nt=Lt,mt=Rt}const St=$.length-3;$[2]=1,qt($,0,St,H),$[St+2]=1,$.size=Math.abs(vt),$.start=0,$.end=$.size}function Ee(_t,$,H,Y){for(let nt=0;nt<_t.length;nt++){const mt=[];Se(_t[nt],mt,H,Y),$.push(mt)}}function _e(_t){return _t/360+.5}function je(_t){const $=Math.sin(_t*Math.PI/180),H=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return H<0?0:H>1?1:H}function ue(_t,$,H,Y,nt,mt,vt,St){if(Y/=$,mt>=(H/=$)&&vt<Y)return _t;if(vt<H||mt>=Y)return null;const xt=[];for(const Lt of _t){const Rt=Lt.geometry;let wt=Lt.type;const Nt=nt===0?Lt.minX:Lt.minY,ft=nt===0?Lt.maxX:Lt.maxY;if(Nt>=H&&ft<Y){xt.push(Lt);continue}if(ft<H||Nt>=Y)continue;let re=[];if(wt==="Point"||wt==="MultiPoint")De(Rt,re,H,Y,nt);else if(wt==="LineString")Ve(Rt,re,H,Y,nt,!1,St.lineMetrics);else if(wt==="MultiLineString")Me(Rt,re,H,Y,nt,!1);else if(wt==="Polygon")Me(Rt,re,H,Y,nt,!0);else if(wt==="MultiPolygon")for(const Pe of Rt){const oe=[];Me(Pe,oe,H,Y,nt,!0),oe.length&&re.push(oe)}if(re.length){if(St.lineMetrics&&wt==="LineString"){for(const Pe of re)xt.push(Ut(Lt.id,wt,Pe,Lt.tags));continue}wt!=="LineString"&&wt!=="MultiLineString"||(re.length===1?(wt="LineString",re=re[0]):wt="MultiLineString"),wt!=="Point"&&wt!=="MultiPoint"||(wt=re.length===3?"Point":"MultiPoint"),xt.push(Ut(Lt.id,wt,re,Lt.tags))}}return xt.length?xt:null}function De(_t,$,H,Y,nt){for(let mt=0;mt<_t.length;mt+=3){const vt=_t[mt+nt];vt>=H&&vt<=Y&&Ke($,_t[mt],_t[mt+1],_t[mt+2])}}function Ve(_t,$,H,Y,nt,mt,vt){let St=ie(_t);const xt=nt===0?ii:ee;let Lt,Rt,wt=_t.start;for(let oe=0;oe<_t.length-3;oe+=3){const xe=_t[oe],ze=_t[oe+1],wi=_t[oe+2],mi=_t[oe+3],oi=_t[oe+4],Ae=nt===0?xe:ze,ei=nt===0?mi:oi;let Ji=!1;vt&&(Lt=Math.sqrt(Math.pow(xe-mi,2)+Math.pow(ze-oi,2))),Ae<H?ei>H&&(Rt=xt(St,xe,ze,mi,oi,H),vt&&(St.start=wt+Lt*Rt)):Ae>Y?ei<Y&&(Rt=xt(St,xe,ze,mi,oi,Y),vt&&(St.start=wt+Lt*Rt)):Ke(St,xe,ze,wi),ei<H&&Ae>=H&&(Rt=xt(St,xe,ze,mi,oi,H),Ji=!0),ei>Y&&Ae<=Y&&(Rt=xt(St,xe,ze,mi,oi,Y),Ji=!0),!mt&&Ji&&(vt&&(St.end=wt+Lt*Rt),$.push(St),St=ie(_t)),vt&&(wt+=Lt)}let Nt=_t.length-3;const ft=_t[Nt],re=_t[Nt+1],Pe=nt===0?ft:re;Pe>=H&&Pe<=Y&&Ke(St,ft,re,_t[Nt+2]),Nt=St.length-3,mt&&Nt>=3&&(St[Nt]!==St[0]||St[Nt+1]!==St[1])&&Ke(St,St[0],St[1],St[2]),St.length&&$.push(St)}function ie(_t){const $=[];return $.size=_t.size,$.start=_t.start,$.end=_t.end,$}function Me(_t,$,H,Y,nt,mt){for(const vt of _t)Ve(vt,$,H,Y,nt,mt,!1)}function Ke(_t,$,H,Y){_t.push($,H,Y)}function ii(_t,$,H,Y,nt,mt){const vt=(mt-$)/(Y-$);return Ke(_t,mt,H+(nt-H)*vt,1),vt}function ee(_t,$,H,Y,nt,mt){const vt=(mt-H)/(nt-H);return Ke(_t,$+(Y-$)*vt,mt,1),vt}function he(_t,$){const H=[];for(let Y=0;Y<_t.length;Y++){const nt=_t[Y],mt=nt.type;let vt;if(mt==="Point"||mt==="MultiPoint"||mt==="LineString")vt=we(nt.geometry,$);else if(mt==="MultiLineString"||mt==="Polygon"){vt=[];for(const St of nt.geometry)vt.push(we(St,$))}else if(mt==="MultiPolygon"){vt=[];for(const St of nt.geometry){const xt=[];for(const Lt of St)xt.push(we(Lt,$));vt.push(xt)}}H.push(Ut(nt.id,mt,vt,nt.tags))}return H}function we(_t,$){const H=[];H.size=_t.size,_t.start!==void 0&&(H.start=_t.start,H.end=_t.end);for(let Y=0;Y<_t.length;Y+=3)H.push(_t[Y]+$,_t[Y+1],_t[Y+2]);return H}function Ne(_t,$){if(_t.transformed)return _t;const H=1<<_t.z,Y=_t.x,nt=_t.y;for(const mt of _t.features){const vt=mt.geometry,St=mt.type;if(mt.geometry=[],St===1)for(let xt=0;xt<vt.length;xt+=2)mt.geometry.push(Be(vt[xt],vt[xt+1],$,H,Y,nt));else for(let xt=0;xt<vt.length;xt++){const Lt=[];for(let Rt=0;Rt<vt[xt].length;Rt+=2)Lt.push(Be(vt[xt][Rt],vt[xt][Rt+1],$,H,Y,nt));mt.geometry.push(Lt)}}return _t.transformed=!0,_t}function Be(_t,$,H,Y,nt,mt){return[Math.round(H*(_t*Y-nt)),Math.round(H*($*Y-mt))]}function Oe(_t,$,H,Y,nt){const mt=$===nt.maxZoom?0:nt.tolerance/((1<<$)*nt.extent),vt={features:[],numPoints:0,numSimplified:0,numFeatures:_t.length,source:null,x:H,y:Y,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const St of _t)Ge(vt,St,mt,nt);return vt}function Ge(_t,$,H,Y){const nt=$.geometry,mt=$.type,vt=[];if(_t.minX=Math.min(_t.minX,$.minX),_t.minY=Math.min(_t.minY,$.minY),_t.maxX=Math.max(_t.maxX,$.maxX),_t.maxY=Math.max(_t.maxY,$.maxY),mt==="Point"||mt==="MultiPoint")for(let St=0;St<nt.length;St+=3)vt.push(nt[St],nt[St+1]),_t.numPoints++,_t.numSimplified++;else if(mt==="LineString")Ue(vt,nt,_t,H,!1,!1);else if(mt==="MultiLineString"||mt==="Polygon")for(let St=0;St<nt.length;St++)Ue(vt,nt[St],_t,H,mt==="Polygon",St===0);else if(mt==="MultiPolygon")for(let St=0;St<nt.length;St++){const xt=nt[St];for(let Lt=0;Lt<xt.length;Lt++)Ue(vt,xt[Lt],_t,H,!0,Lt===0)}if(vt.length){let St=$.tags||null;if(mt==="LineString"&&Y.lineMetrics){St={};for(const Lt in $.tags)St[Lt]=$.tags[Lt];St.mapbox_clip_start=nt.start/nt.size,St.mapbox_clip_end=nt.end/nt.size}const xt={geometry:vt,type:mt==="Polygon"||mt==="MultiPolygon"?3:mt==="LineString"||mt==="MultiLineString"?2:1,tags:St};$.id!==null&&(xt.id=$.id),_t.features.push(xt)}}function Ue(_t,$,H,Y,nt,mt){const vt=Y*Y;if(Y>0&&$.size<(nt?vt:Y))return void(H.numPoints+=$.length/3);const St=[];for(let xt=0;xt<$.length;xt+=3)(Y===0||$[xt+2]>vt)&&(H.numSimplified++,St.push($[xt],$[xt+1])),H.numPoints++;nt&&function(xt,Lt){let Rt=0;for(let wt=0,Nt=xt.length,ft=Nt-2;wt<Nt;ft=wt,wt+=2)Rt+=(xt[wt]-xt[ft])*(xt[wt+1]+xt[ft+1]);if(Rt>0===Lt)for(let wt=0,Nt=xt.length;wt<Nt/2;wt+=2){const ft=xt[wt],re=xt[wt+1];xt[wt]=xt[Nt-2-wt],xt[wt+1]=xt[Nt-1-wt],xt[Nt-2-wt]=ft,xt[Nt-1-wt]=re}}(St,mt),_t.push(St)}const di={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class gi{constructor($,H){const Y=(H=this.options=function(mt,vt){for(const St in vt)mt[St]=vt[St];return mt}(Object.create(di),H)).debug;if(Y&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let nt=function(mt,vt){const St=[];if(mt.type==="FeatureCollection")for(let xt=0;xt<mt.features.length;xt++)Gt(St,mt.features[xt],vt,xt);else Gt(St,mt.type==="Feature"?mt:{geometry:mt},vt);return St}($,H);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),nt=function(mt,vt){const St=vt.buffer/vt.extent;let xt=mt;const Lt=ue(mt,1,-1-St,St,0,-1,2,vt),Rt=ue(mt,1,1-St,2+St,0,-1,2,vt);return(Lt||Rt)&&(xt=ue(mt,1,-St,1+St,0,-1,2,vt)||[],Lt&&(xt=he(Lt,1).concat(xt)),Rt&&(xt=xt.concat(he(Rt,-1)))),xt}(nt,H),nt.length&&this.splitTile(nt,0,0,0),Y&&(nt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile($,H,Y,nt,mt,vt,St){const xt=[$,H,Y,nt],Lt=this.options,Rt=Lt.debug;for(;xt.length;){nt=xt.pop(),Y=xt.pop(),H=xt.pop(),$=xt.pop();const wt=1<<H,Nt=Bi(H,Y,nt);let ft=this.tiles[Nt];if(!ft&&(Rt>1&&console.time("creation"),ft=this.tiles[Nt]=Oe($,H,Y,nt,Lt),this.tileCoords.push({z:H,x:Y,y:nt}),Rt)){Rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,Y,nt,ft.numFeatures,ft.numPoints,ft.numSimplified),console.timeEnd("creation"));const Ji=`z${H}`;this.stats[Ji]=(this.stats[Ji]||0)+1,this.total++}if(ft.source=$,mt==null){if(H===Lt.indexMaxZoom||ft.numPoints<=Lt.indexMaxPoints)continue}else{if(H===Lt.maxZoom||H===mt)continue;if(mt!=null){const Ji=mt-H;if(Y!==vt>>Ji||nt!==St>>Ji)continue}}if(ft.source=null,$.length===0)continue;Rt>1&&console.time("clipping");const re=.5*Lt.buffer/Lt.extent,Pe=.5-re,oe=.5+re,xe=1+re;let ze=null,wi=null,mi=null,oi=null,Ae=ue($,wt,Y-re,Y+oe,0,ft.minX,ft.maxX,Lt),ei=ue($,wt,Y+Pe,Y+xe,0,ft.minX,ft.maxX,Lt);$=null,Ae&&(ze=ue(Ae,wt,nt-re,nt+oe,1,ft.minY,ft.maxY,Lt),wi=ue(Ae,wt,nt+Pe,nt+xe,1,ft.minY,ft.maxY,Lt),Ae=null),ei&&(mi=ue(ei,wt,nt-re,nt+oe,1,ft.minY,ft.maxY,Lt),oi=ue(ei,wt,nt+Pe,nt+xe,1,ft.minY,ft.maxY,Lt),ei=null),Rt>1&&console.timeEnd("clipping"),xt.push(ze||[],H+1,2*Y,2*nt),xt.push(wi||[],H+1,2*Y,2*nt+1),xt.push(mi||[],H+1,2*Y+1,2*nt),xt.push(oi||[],H+1,2*Y+1,2*nt+1)}}getTile($,H,Y){$=+$,H=+H,Y=+Y;const nt=this.options,{extent:mt,debug:vt}=nt;if($<0||$>24)return null;const St=1<<$,xt=Bi($,H=H+St&St-1,Y);if(this.tiles[xt])return Ne(this.tiles[xt],mt);vt>1&&console.log("drilling down to z%d-%d-%d",$,H,Y);let Lt,Rt=$,wt=H,Nt=Y;for(;!Lt&&Rt>0;)Rt--,wt>>=1,Nt>>=1,Lt=this.tiles[Bi(Rt,wt,Nt)];return Lt&&Lt.source?(vt>1&&(console.log("found parent tile z%d-%d-%d",Rt,wt,Nt),console.time("drilling down")),this.splitTile(Lt.source,Rt,wt,Nt,$,H,Y),vt>1&&console.timeEnd("drilling down"),this.tiles[xt]?Ne(this.tiles[xt],mt):null):null}}function Bi(_t,$,H){return 32*((1<<_t)*H+$)+_t}function Ye(_t,$){return $?_t.properties[$]:_t.id}function _i(_t,$){if(_t==null)return!0;if(_t.type==="Feature")return Ye(_t,$)!=null;if(_t.type==="FeatureCollection"){const H=new Set;for(const Y of _t.features){const nt=Ye(Y,$);if(nt==null||H.has(nt))return!1;H.add(nt)}return!0}return!1}function Si(_t,$){const H=new Map;if(_t!=null)if(_t.type==="Feature")H.set(Ye(_t,$),_t);else for(const Y of _t.features)H.set(Ye(Y,$),Y);return H}class Je extends D{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile($,H){return m._(this,void 0,void 0,function*(){const Y=$.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const nt=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!nt)return null;const mt=new Dt(nt.features);let vt=Le(mt);return vt.byteOffset===0&&vt.byteLength===vt.buffer.byteLength||(vt=new Uint8Array(vt)),{vectorTile:mt,rawData:vt.buffer}})}loadData($){return m._(this,void 0,void 0,function*(){var H;(H=this._pendingRequest)===null||H===void 0||H.abort();const Y=!!($&&$.request&&$.request.collectResourceTiming)&&new m.cM($.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON($,this._pendingRequest),this._geoJSONIndex=$.cluster?new be(function({superclusterOptions:vt,clusterProperties:St}){if(!St||!vt)return vt;const xt={},Lt={},Rt={accumulated:null,zoom:0},wt={properties:null},Nt=Object.keys(St);for(const ft of Nt){const[re,Pe]=St[ft],oe=m.cT(Pe),xe=m.cT(typeof re=="string"?[re,["accumulated"],["get",ft]]:re);xt[ft]=oe.value,Lt[ft]=xe.value}return vt.map=ft=>{wt.properties=ft;const re={};for(const Pe of Nt)re[Pe]=xt[Pe].evaluate(Rt,wt);return re},vt.reduce=(ft,re)=>{wt.properties=re;for(const Pe of Nt)Rt.accumulated=ft[Pe],ft[Pe]=Lt[Pe].evaluate(Rt,wt)},vt}($)).load((yield this._pendingData).features):(nt=yield this._pendingData,new gi(nt,$.geojsonVtOptions)),this.loaded={};const mt={};if(Y){const vt=Y.finish();vt&&(mt.resourceTiming={},mt.resourceTiming[$.source]=JSON.parse(JSON.stringify(vt)))}return mt}catch(mt){if(delete this._pendingRequest,m.cx(mt))return{abandoned:!0};throw mt}var nt})}getData(){return m._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile($){const H=this.loaded;return H&&H[$.uid]?super.reloadTile($):this.loadTile($)}loadAndProcessGeoJSON($,H){return m._(this,void 0,void 0,function*(){let Y=yield this.loadGeoJSON($,H);if(delete this._pendingRequest,typeof Y!="object")throw new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`);if(it(Y,!0),$.filter){const nt=m.cT($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(nt.result==="error")throw new Error(nt.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));Y={type:"FeatureCollection",features:Y.features.filter(vt=>nt.value.evaluate({zoom:0},vt))}}return Y})}loadGeoJSON($,H){return m._(this,void 0,void 0,function*(){const{promoteId:Y}=$;if($.request){const nt=yield m.j($.request,H);return this._dataUpdateable=_i(nt.data,Y)?Si(nt.data,Y):void 0,nt.data}if(typeof $.data=="string")try{const nt=JSON.parse($.data);return this._dataUpdateable=_i(nt,Y)?Si(nt,Y):void 0,nt}catch{throw new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`)}if(!$.dataDiff)throw new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${$.source}`);return function(nt,mt,vt){var St,xt,Lt,Rt;if(mt.removeAll&&nt.clear(),mt.remove)for(const wt of mt.remove)nt.delete(wt);if(mt.add)for(const wt of mt.add){const Nt=Ye(wt,vt);Nt!=null&&nt.set(Nt,wt)}if(mt.update)for(const wt of mt.update){let Nt=nt.get(wt.id);if(Nt==null)continue;const ft=!wt.removeAllProperties&&(((St=wt.removeProperties)===null||St===void 0?void 0:St.length)>0||((xt=wt.addOrUpdateProperties)===null||xt===void 0?void 0:xt.length)>0);if((wt.newGeometry||wt.removeAllProperties||ft)&&(Nt=Object.assign({},Nt),nt.set(wt.id,Nt),ft&&(Nt.properties=Object.assign({},Nt.properties))),wt.newGeometry&&(Nt.geometry=wt.newGeometry),wt.removeAllProperties)Nt.properties={};else if(((Lt=wt.removeProperties)===null||Lt===void 0?void 0:Lt.length)>0)for(const re of wt.removeProperties)Object.prototype.hasOwnProperty.call(Nt.properties,re)&&delete Nt.properties[re];if(((Rt=wt.addOrUpdateProperties)===null||Rt===void 0?void 0:Rt.length)>0)for(const{key:re,value:Pe}of wt.addOrUpdateProperties)Nt.properties[re]=Pe}}(this._dataUpdateable,$.dataDiff,Y),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource($){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom($){return this._geoJSONIndex.getClusterExpansionZoom($.clusterId)}getClusterChildren($){return this._geoJSONIndex.getChildren($.clusterId)}getClusterLeaves($){return this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset)}}class fi{constructor($){this.self=$,this.actor=new m.J($),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(H,Y)=>{if(this.externalWorkerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.externalWorkerSourceTypes[H]=Y},this.self.addProtocol=m.cz,this.self.removeProtocol=m.cA,this.self.registerRTLTextPlugin=H=>{m.cU.setMethods(H)},this.actor.registerMessageHandler("LDT",(H,Y)=>this._getDEMWorkerSource(H,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RDT",(H,Y)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(H,Y.source).removeTile(Y)})),this.actor.registerMessageHandler("GCEZ",(H,Y)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(H,Y.type,Y.source).getClusterExpansionZoom(Y)})),this.actor.registerMessageHandler("GCC",(H,Y)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(H,Y.type,Y.source).getClusterChildren(Y)})),this.actor.registerMessageHandler("GCL",(H,Y)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(H,Y.type,Y.source).getClusterLeaves(Y)})),this.actor.registerMessageHandler("LD",(H,Y)=>this._getWorkerSource(H,Y.type,Y.source).loadData(Y)),this.actor.registerMessageHandler("GD",(H,Y)=>this._getWorkerSource(H,Y.type,Y.source).getData()),this.actor.registerMessageHandler("LT",(H,Y)=>this._getWorkerSource(H,Y.type,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RT",(H,Y)=>this._getWorkerSource(H,Y.type,Y.source).reloadTile(Y)),this.actor.registerMessageHandler("AT",(H,Y)=>this._getWorkerSource(H,Y.type,Y.source).abortTile(Y)),this.actor.registerMessageHandler("RMT",(H,Y)=>this._getWorkerSource(H,Y.type,Y.source).removeTile(Y)),this.actor.registerMessageHandler("RS",(H,Y)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[H]||!this.workerSources[H][Y.type]||!this.workerSources[H][Y.type][Y.source])return;const nt=this.workerSources[H][Y.type][Y.source];delete this.workerSources[H][Y.type][Y.source],nt.removeSource!==void 0&&nt.removeSource(Y)})),this.actor.registerMessageHandler("RM",H=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H]})),this.actor.registerMessageHandler("SR",(H,Y)=>m._(this,void 0,void 0,function*(){this.referrer=Y})),this.actor.registerMessageHandler("SRPS",(H,Y)=>this._syncRTLPluginState(H,Y)),this.actor.registerMessageHandler("IS",(H,Y)=>m._(this,void 0,void 0,function*(){this.self.importScripts(Y)})),this.actor.registerMessageHandler("SI",(H,Y)=>this._setImages(H,Y)),this.actor.registerMessageHandler("UL",(H,Y)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(H).update(Y.layers,Y.removedIds)})),this.actor.registerMessageHandler("SL",(H,Y)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(H).replace(Y)}))}_setImages($,H){return m._(this,void 0,void 0,function*(){this.availableImages[$]=H;for(const Y in this.workerSources[$]){const nt=this.workerSources[$][Y];for(const mt in nt)nt[mt].availableImages=H}})}_syncRTLPluginState($,H){return m._(this,void 0,void 0,function*(){return yield m.cU.syncState(H,this.self.importScripts)})}_getAvailableImages($){let H=this.availableImages[$];return H||(H=[]),H}_getLayerIndex($){let H=this.layerIndexes[$];return H||(H=this.layerIndexes[$]=new o),H}_getWorkerSource($,H,Y){if(this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][H]||(this.workerSources[$][H]={}),!this.workerSources[$][H][Y]){const nt={sendAsync:(mt,vt)=>(mt.targetMapId=$,this.actor.sendAsync(mt,vt))};switch(H){case"vector":this.workerSources[$][H][Y]=new D(nt,this._getLayerIndex($),this._getAvailableImages($));break;case"geojson":this.workerSources[$][H][Y]=new Je(nt,this._getLayerIndex($),this._getAvailableImages($));break;default:this.workerSources[$][H][Y]=new this.externalWorkerSourceTypes[H](nt,this._getLayerIndex($),this._getAvailableImages($))}}return this.workerSources[$][H][Y]}_getDEMWorkerSource($,H){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][H]||(this.demWorkerSources[$][H]=new k),this.demWorkerSources[$][H]}}return m.i(self)&&(self.worker=new fi(self)),fi}),p("index",["exports","./shared"],function(m,o){var P="5.6.0";function A(){var g=new o.A(4);return o.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let O,D;const k={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(g,t,r){const c=requestAnimationFrame(_=>{d(),t(_)}),{unsubscribe:d}=o.s(g.signal,"abort",()=>{d(),cancelAnimationFrame(c),r(o.c())},!1)},frameAsync(g){return new Promise((t,r)=>{this.frame(g,t,r)})},getImageData(g,t=0){return this.getImageCanvasContext(g).getImageData(-t,-t,g.width+2*t,g.height+2*t)},getImageCanvasContext(g){const t=window.document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return t.width=g.width,t.height=g.height,r.drawImage(g,0,0,g.width,g.height),r},resolveURL:g=>(O||(O=document.createElement("a")),O.href=g,O.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(D==null&&(D=matchMedia("(prefers-reduced-motion: reduce)")),D.matches)}};class B{static testProp(t){if(!B.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in B.docStyle)return t[r];return t[0]}static create(t,r,c){const d=window.document.createElement(t);return r!==void 0&&(d.className=r),c&&c.appendChild(d),d}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){B.docStyle&&B.selectProp&&(B.userSelect=B.docStyle[B.selectProp],B.docStyle[B.selectProp]="none")}static enableDrag(){B.docStyle&&B.selectProp&&(B.docStyle[B.selectProp]=B.userSelect)}static setTransform(t,r){t.style[B.transformProp]=r}static addEventListener(t,r,c,d={}){t.addEventListener(r,c,"passive"in d?d:d.capture)}static removeEventListener(t,r,c,d={}){t.removeEventListener(r,c,"passive"in d?d:d.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",B.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",B.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",B.suppressClickInternal,!0)},0)}static getScale(t){const r=t.getBoundingClientRect();return{x:r.width/t.offsetWidth||1,y:r.height/t.offsetHeight||1,boundingClientRect:r}}static getPoint(t,r,c){const d=r.boundingClientRect;return new o.P((c.clientX-d.left)/r.x-t.clientLeft,(c.clientY-d.top)/r.y-t.clientTop)}static mousePos(t,r){const c=B.getScale(t);return B.getPoint(t,c,r)}static touchPos(t,r){const c=[],d=B.getScale(t);for(let _=0;_<r.length;_++)c.push(B.getPoint(t,d,r[_]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const r=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),c=r.querySelectorAll("script");for(const d of c)d.remove();return B.clean(r),r.innerHTML}static isPossiblyDangerous(t,r){const c=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!c.includes("javascript:")&&!c.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const r=t.children;for(const c of r)B.removeAttributes(c),B.clean(c)}static removeAttributes(t){for(const{name:r,value:c}of t.attributes)B.isPossiblyDangerous(r,c)&&t.removeAttribute(r)}}B.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,B.selectProp=B.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),B.transformProp=B.testProp(["transform","WebkitTransform"]);const V={supported:!1,testSupport:function(g){!gt&&it&&(ct?Dt(g):K=g)}};let K,it,gt=!1,ct=!1;function Dt(g){const t=g.createTexture();g.bindTexture(g.TEXTURE_2D,t);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,it),g.isContextLost())return;V.supported=!0}catch{}g.deleteTexture(t),gt=!0}var Ct;typeof document<"u"&&(it=document.createElement("img"),it.onload=()=>{K&&Dt(K),K=null,ct=!0},it.onerror=()=>{gt=!0,K=null},it.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let t,r,c,d;g.resetRequestQueue=()=>{t=[],r=0,c=0,d={}},g.addThrottleControl=T=>{const I=c++;return d[I]=T,I},g.removeThrottleControl=T=>{delete d[T],b()},g.getImage=(T,I,R=!0)=>new Promise((F,L)=>{V.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),o.e(T,{type:"image"}),t.push({abortController:I,requestParameters:T,supportImageRefresh:R,state:"queued",onError:G=>{L(G)},onSuccess:G=>{F(G)}}),b()});const _=T=>o._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:I,supportImageRefresh:R,onError:F,onSuccess:L,abortController:G}=T,Z=R===!1&&!o.i(self)&&!o.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce((et,st)=>et&&st==="accept",!0));r++;const tt=Z?M(I,G):o.m(I,G);try{const et=yield tt;delete T.abortController,T.state="completed",et.data instanceof HTMLImageElement||o.b(et.data)?L(et):et.data&&L({data:yield(Q=et.data,typeof createImageBitmap=="function"?o.f(Q):o.h(Q)),cacheControl:et.cacheControl,expires:et.expires})}catch(et){delete T.abortController,F(et)}finally{r--,b()}var Q}),b=()=>{const T=(()=>{for(const I of Object.keys(d))if(d[I]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=r;I<T&&t.length>0;I++){const R=t.shift();R.abortController.signal.aborted?I--:_(R)}},M=(T,I)=>new Promise((R,F)=>{const L=new Image,G=T.url,Z=T.credentials;Z&&Z==="include"?L.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!o.d(G))&&(L.crossOrigin="anonymous"),I.signal.addEventListener("abort",()=>{L.src="",F(o.c())}),L.fetchPriority="high",L.onload=()=>{L.onerror=L.onload=null,R({data:L})},L.onerror=()=>{L.onerror=L.onload=null,I.signal.aborted||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},L.src=G})}(Ct||(Ct={})),Ct.resetRequestQueue();class zt{constructor(t){this._transformRequestFn=t}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ae(g){const t=[];if(typeof g=="string")t.push({id:"default",url:g});else if(g&&g.length>0){const r=[];for(const{id:c,url:d}of g){const _=`${c}${d}`;r.indexOf(_)===-1&&(r.push(_),t.push({id:c,url:d}))}}return t}function ke(g,t,r){try{const c=new URL(g);return c.pathname+=`${t}${r}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function de(g){const{userImage:t}=g;return!!(t&&t.render&&t.render())&&(g.data.replace(new Uint8Array(t.data.buffer)),!0)}class Le extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,promiseResolve:c}of this.requestors)c(this._getImagesForIds(r));this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const c=r.spriteData;r.data=new o.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let c=!0;const d=r.data||r.spriteData;return this._validateStretch(r.stretchX,d&&d.width)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,d&&d.height)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,r){if(!t)return!0;let c=0;for(const d of t){if(d[0]<c||d[1]<d[0]||r<d[1])return!1;c=d[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const c=r.spriteData,d=c&&c.width||r.data.width,_=c&&c.height||r.data.height;return!(t[0]<0||d<t[0]||t[1]<0||_<t[1]||t[2]<0||d<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,c=!0){const d=this.getImage(t);if(c&&(d.data.width!==r.data.width||d.data.height!==r.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=d.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((r,c)=>{let d=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(d=!1);this.isLoaded()||d?r(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:r})})}_getImagesForIds(t){const r={};for(const c of t){let d=this.getImage(c);d||(this.fire(new o.l("styleimagemissing",{id:c})),d=this.getImage(c)),d?r[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:o.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],c=this.getImage(t);if(!c)return null;if(r&&r.position.version===c.version)return r.position;if(r)r.position.version=c.version;else{const d={w:c.data.width+2,h:c.data.height+2,x:0,y:0},_=new o.I(d,c);this.patterns[t]={bin:d,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:r,h:c}=o.p(t),d=this.atlasImage;d.resize({width:r||1,height:c||1});for(const _ in this.patterns){const{bin:b}=this.patterns[_],M=b.x+1,T=b.y+1,I=this.getImage(_).data,R=I.width,F=I.height;o.R.copy(I,d,{x:0,y:0},{x:M,y:T},{width:R,height:F}),o.R.copy(I,d,{x:0,y:F-1},{x:M,y:T-1},{width:R,height:1}),o.R.copy(I,d,{x:0,y:0},{x:M,y:T+F},{width:R,height:1}),o.R.copy(I,d,{x:R-1,y:0},{x:M-1,y:T},{width:1,height:F}),o.R.copy(I,d,{x:0,y:0},{x:M+R,y:T},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const c=this.getImage(r);c||o.w(`Image with ID: "${r}" was not found`),de(c)&&this.updateImage(r,c)}}}const Xe=1e20;function ne(g,t,r,c,d,_,b,M,T){for(let I=t;I<t+c;I++)le(g,r*_+I,_,d,b,M,T);for(let I=r;I<r+d;I++)le(g,I*_+t,1,c,b,M,T)}function le(g,t,r,c,d,_,b){_[0]=0,b[0]=-1e20,b[1]=Xe,d[0]=g[t];for(let M=1,T=0,I=0;M<c;M++){d[M]=g[t+M*r];const R=M*M;do{const F=_[T];I=(d[M]-d[F]+R-F*F)/(M-F)/2}while(I<=b[T]&&--T>-1);T++,_[T]=M,b[T]=I,b[T+1]=Xe}for(let M=0,T=0;M<c;M++){for(;b[T+1]<M;)T++;const I=_[T],R=M-I;g[t+M*r]=d[I]+R*R}}class be{constructor(t,r){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return o._(this,void 0,void 0,function*(){const r=[];for(const _ in t)for(const b of t[_])r.push(this._getAndCacheGlyphsPromise(_,b));const c=yield Promise.all(r),d={};for(const{stack:_,id:b,glyph:M}of c)d[_]||(d[_]={}),d[_][b]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return d})}_getAndCacheGlyphsPromise(t,r){return o._(this,void 0,void 0,function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let d=c.glyphs[r];if(d!==void 0)return{stack:t,id:r,glyph:d};if(d=this._tinySDF(c,t,r),d)return c.glyphs[r]=d,{stack:t,id:r,glyph:d};const _=Math.floor(r/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(c.ranges[_])return{stack:t,id:r,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!c.requests[_]){const M=be.loadGlyphRange(t,_,this.url,this.requestManager);c.requests[_]=M}const b=yield c.requests[_];for(const M in b)this._doesCharSupportLocalGlyph(+M)||(c.glyphs[+M]=b[+M]);return c.ranges[_]=!0,{stack:t,id:r,glyph:b[r]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))||o.u["CJK Unified Ideographs"](t)||o.u["Hangul Syllables"](t)||o.u.Hiragana(t)||o.u.Katakana(t)||o.u["CJK Symbols and Punctuation"](t)||o.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,r,c){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let _=t.tinySDF;if(!_){let M="400";/bold/i.test(r)?M="900":/medium/i.test(r)?M="500":/light/i.test(r)&&(M="200"),_=t.tinySDF=new be.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:M})}const b=_.draw(String.fromCharCode(c));return{id:c,bitmap:new o.q({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}}be.loadGlyphRange=function(g,t,r,c){return o._(this,void 0,void 0,function*(){const d=256*t,_=d+255,b=c.transformRequest(r.replace("{fontstack}",g).replace("{range}",`${d}-${_}`),"Glyphs"),M=yield o.n(b,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${t}, ${d}-${_}`);const T={};for(const I of o.o(M.data))T[I.id]=I;return T})},be.TinySDF=class{constructor({fontSize:g=24,buffer:t=3,radius:r=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:b="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=r;const M=this.size=g+4*t,T=this._createCanvas(M),I=this.ctx=T.getContext("2d",{willReadFrequently:!0});I.font=`${b} ${_} ${g}px ${d}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(g){const t=document.createElement("canvas");return t.width=t.height=g,t}draw(g){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(g),b=Math.ceil(r),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),T=Math.min(this.size-this.buffer,b+Math.ceil(c)),I=M+2*this.buffer,R=T+2*this.buffer,F=Math.max(I*R,0),L=new Uint8ClampedArray(F),G={data:L,width:I,height:R,glyphWidth:M,glyphHeight:T,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(M===0||T===0)return G;const{ctx:Z,buffer:tt,gridInner:Q,gridOuter:et}=this;Z.clearRect(tt,tt,M,T),Z.fillText(g,tt,tt+b);const st=Z.getImageData(tt,tt,M,T);et.fill(Xe,0,F),Q.fill(0,0,F);for(let ht=0;ht<T;ht++)for(let at=0;at<M;at++){const dt=st.data[4*(ht*M+at)+3]/255;if(dt===0)continue;const pt=(ht+tt)*I+at+tt;if(dt===1)et[pt]=0,Q[pt]=Xe;else{const ot=.5-dt;et[pt]=ot>0?ot*ot:0,Q[pt]=ot<0?ot*ot:0}}ne(et,0,0,I,R,I,this.f,this.v,this.z),ne(Q,tt,tt,M,T,I,this.f,this.v,this.z);for(let ht=0;ht<F;ht++){const at=Math.sqrt(et[ht])-Math.sqrt(Q[ht]);L[ht]=Math.round(255-255*(at/this.radius+this.cutoff))}return G}};class qe{constructor(){this.specification=o.v.light.position}possiblyEvaluate(t,r){return o.B(t.expression.evaluate(r))}interpolate(t,r,c){return{x:o.C.number(t.x,r.x,c),y:o.C.number(t.y,r.y,c),z:o.C.number(t.z,r.z,c)}}}let Ce;class ui extends o.E{constructor(t){super(),Ce=Ce||new o.r({anchor:new o.D(o.v.light.anchor),position:new qe,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(Ce),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(o.x,t,r))for(const c in t){const d=t[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&o.y(this,t.call(o.z,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const yi=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class Ft extends o.E{constructor(t){super(),this._transitionable=new o.t(yi),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(t,r={}){if(!this._validate(o.G,t,r)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const d=t[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c={}){return(c==null?void 0:c.validate)!==!1&&o.y(this,t.call(o.z,o.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class qt{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const c=t.join(",")+String(r);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,r)),this.dashEntry[c]}getDashRanges(t,r,c){const d=[];let _=t.length%2==1?-t[t.length-1]*c:0,b=t[0]*c,M=!0;d.push({left:_,right:b,isDash:M,zeroLength:t[0]===0});let T=t[0];for(let I=1;I<t.length;I++){M=!M;const R=t[I];_=T*c,T+=R,b=T*c,d.push({left:_,right:b,isDash:M,zeroLength:R===0})}return d}addRoundDash(t,r,c){const d=r/2;for(let _=-c;_<=c;_++){const b=this.width*(this.nextRow+c+_);let M=0,T=t[M];for(let I=0;I<this.width;I++){I/T.right>1&&(T=t[++M]);const R=Math.abs(I-T.left),F=Math.abs(I-T.right),L=Math.min(R,F);let G;const Z=_/c*(d+1);if(T.isDash){const tt=d-Math.abs(Z);G=Math.sqrt(L*L+tt*tt)}else G=d-Math.sqrt(L*L+Z*Z);this.data[b+I]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(t){for(let M=t.length-1;M>=0;--M){const T=t[M],I=t[M+1];T.zeroLength?t.splice(M,1):I&&I.isDash===T.isDash&&(I.left=T.left,t.splice(M,1))}const r=t[0],c=t[t.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const d=this.width*this.nextRow;let _=0,b=t[_];for(let M=0;M<this.width;M++){M/b.right>1&&(b=t[++_]);const T=Math.abs(M-b.left),I=Math.abs(M-b.right),R=Math.min(T,I);this.data[d+M]=Math.max(0,Math.min(255,(b.isDash?R:-R)+128))}}addDash(t,r){const c=r?7:0,d=2*c+1;if(this.nextRow+d>this.height)return o.w("LineAtlas out of space"),null;let _=0;for(let M=0;M<t.length;M++)_+=t[M];if(_!==0){const M=this.width/_,T=this.getDashRanges(t,this.width,M);r?this.addRoundDash(T,M,c):this.addRegularDash(T)}const b={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:_};return this.nextRow+=d,this.dirty=!0,b}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const Wt="maplibre_preloaded_worker_pool";class Ut{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ut.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Wt]}numActive(){return Object.keys(this.active).length}}const Et=Math.floor(k.hardwareConcurrency/2);let Gt,se;function Se(){return Gt||(Gt=new Ut),Gt}Ut.workerCount=o.H(globalThis)?Math.max(Math.min(Et,3),1):1;class Ee{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=r;const c=this.workerPool.acquire(r);for(let d=0;d<c.length;d++){const _=new o.J(c[d],r);_.name=`Worker ${d}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r){const c=[];for(const d of this.actors)c.push(d.sendAsync({type:t,data:r}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,r){for(const c of this.actors)c.registerMessageHandler(t,r)}}function _e(){return se||(se=new Ee(Se(),o.K),se.registerMessageHandler("GR",(g,t,r)=>o.m(t,r))),se}function je(g,t){const r=o.L();return o.M(r,r,[1,1,0]),o.N(r,r,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?o.O(r,r,g.calculatePosMatrix(t.toUnwrapped())):r}function ue(g,t,r,c,d,_,b){var M;const T=function(L,G,Z){if(L)for(const tt of L){const Q=G[tt];if(Q&&Q.source===Z&&Q.type==="fill-extrusion")return!0}else for(const tt in G){const Q=G[tt];if(Q.source===Z&&Q.type==="fill-extrusion")return!0}return!1}((M=d==null?void 0:d.layers)!==null&&M!==void 0?M:null,t,g.id),I=_.maxPitchScaleFactor(),R=g.tilesIn(c,I,T);R.sort(De);const F=[];for(const L of R)F.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(t,r,g._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,d,_,I,je(g.transform,L.tileID),b?(G,Z)=>b(L.tileID,G,Z):void 0)});return function(L,G){for(const Z in L)for(const tt of L[Z])Ve(tt,G);return L}(function(L){const G={},Z={};for(const tt of L){const Q=tt.queryResults,et=tt.wrappedTileID,st=Z[et]=Z[et]||{};for(const ht in Q){const at=Q[ht],dt=st[ht]=st[ht]||{},pt=G[ht]=G[ht]||[];for(const ot of at)dt[ot.featureIndex]||(dt[ot.featureIndex]=!0,pt.push(ot))}}return G}(F),g)}function De(g,t){const r=g.tileID,c=t.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function Ve(g,t){const r=g.feature,c=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=c}function ie(g,t,r){return o._(this,void 0,void 0,function*(){let c=g;if(g.url?c=(yield o.j(t.transformRequest(g.url,"Source"),r)).data:yield k.frameAsync(r),!c)return null;const d=o.Q(o.e(c,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(d.vectorLayerIds=c.vector_layers.map(_=>_.id)),d})}class Me{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.S?new o.S(t.lng,t.lat):o.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.S?new o.S(t.lng,t.lat):o.S.convert(t),this}extend(t){const r=this._sw,c=this._ne;let d,_;if(t instanceof o.S)d=t,_=t;else{if(!(t instanceof Me))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Me.convert(t)):this.extend(o.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.S.convert(t)):this;if(d=t._sw,_=t._ne,!d||!_)return this}return r||c?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),c.lng=Math.max(_.lng,c.lng),c.lat=Math.max(_.lat,c.lat)):(this._sw=new o.S(d.lng,d.lat),this._ne=new o.S(_.lng,_.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:c}=o.S.convert(t);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(t){return t instanceof Me?t:t&&new Me(t)}static fromLngLat(t,r=0){const c=360*r/40075017,d=c/Math.cos(Math.PI/180*t.lat);return new Me(new o.S(t.lng-d,t.lat-c),new o.S(t.lng+d,t.lat+c))}adjustAntiMeridian(){const t=new o.S(this._sw.lng,this._sw.lat),r=new o.S(this._ne.lng,this._ne.lat);return new Me(t,t.lng>r.lng?new o.S(r.lng+360,r.lat):r)}}class Ke{constructor(t,r,c){this.bounds=Me.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),c=Math.floor(o.V(this.bounds.getWest())*r),d=Math.floor(o.U(this.bounds.getNorth())*r),_=Math.ceil(o.V(this.bounds.getEast())*r),b=Math.ceil(o.U(this.bounds.getSouth())*r);return t.x>=c&&t.x<_&&t.y>=d&&t.y<b}}class ii extends o.E{constructor(t,r,c,d){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(r,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ie(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(o.e(this,t),t.bounds&&(this.tileBounds=new Ke(t.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new o.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(t){return o._(this,void 0,void 0,function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(r,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};c.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((_,b)=>{t.reloadPromise={resolve:_,reject:b}})}else t.actor=this.dispatcher.getActor(),d="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:d,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,r){if(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return o._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return o._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ee extends o.E{constructor(t,r,c,d){super(),this.id=t,this.dispatcher=c,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},r),o.e(this,o.Q(r,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield ie(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(o.e(this,r),r.bounds&&(this.tileBounds=new Ke(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(r){this._tileJSONRequest=null,this.fire(new o.k(r))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return o.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return o._(this,void 0,void 0,function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield Ct.getImage(this.map._requestManager.transformRequest(r,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const d=this.map.painter.context,_=d.gl,b=c.data;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new o.T(d,b,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}})}abortTile(t){return o._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return o._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class he extends ee{constructor(t,r,c,d){super(t,r,c,d),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(t){return o._(this,void 0,void 0,function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(r,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const d=yield Ct.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(d&&d.data){const _=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&t.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const b=o.b(_)&&o.W()?_:yield this.readImageNow(_),M={type:this.type,uid:t.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const T=yield t.actor.sendAsync({type:"LDT",data:M});t.dem=T,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(d){if(delete t.abortController,t.aborted)t.state="unloaded";else if(d)throw t.state="errored",d}})}readImageNow(t){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.X()){const r=t.width+2,c=t.height+2;try{return new o.R({width:r,height:c},yield o.Y(t,-1,-1,r,c))}catch{}}return k.getImageData(t,1)})}_getNeighboringTiles(t){const r=t.canonical,c=Math.pow(2,r.z),d=(r.x-1+c)%c,_=r.x===0?t.wrap-1:t.wrap,b=(r.x+1+c)%c,M=r.x+1===c?t.wrap+1:t.wrap,T={};return T[new o.Z(t.overscaledZ,_,r.z,d,r.y).key]={backfilled:!1},T[new o.Z(t.overscaledZ,M,r.z,b,r.y).key]={backfilled:!1},r.y>0&&(T[new o.Z(t.overscaledZ,_,r.z,d,r.y-1).key]={backfilled:!1},T[new o.Z(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new o.Z(t.overscaledZ,M,r.z,b,r.y-1).key]={backfilled:!1}),r.y+1<c&&(T[new o.Z(t.overscaledZ,_,r.z,d,r.y+1).key]={backfilled:!1},T[new o.Z(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new o.Z(t.overscaledZ,M,r.z,b,r.y+1).key]={backfilled:!1}),T}unloadTile(t){return o._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class we extends o.E{constructor(t,r,c,d){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(d),this._data=r.data,this._options=o.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(o.$/this.tileSize)}_getClusterMaxZoom(t){const r=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${r}"`),r}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return o._(this,void 0,void 0,function*(){const t=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getCoordinatesFromGeometry(t){return t.type==="GeometryCollection"?t.geometries.map(r=>r.coordinates).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,function*(){const t=new Me,r=yield this.getData();let c;switch(r.type){case"FeatureCollection":c=r.features.map(d=>this.getCoordinatesFromGeometry(d.geometry)).flat(1/0);break;case"Feature":c=this.getCoordinatesFromGeometry(r.geometry);break;default:c=this.getCoordinatesFromGeometry(r)}if(c.length==0)return t;for(let d=0;d<c.length-1;d+=2)t.extend([c[d],c[d+1]]);return t})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,r,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:r,offset:c}})}_updateWorkerData(t){return o._(this,void 0,void 0,function*(){const r=o.e({type:this.type},this.workerOptions);t?r.dataDiff=t:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(k.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.l("dataloading",{dataType:"source"}));try{const c=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||c.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));let d=null;c.resourceTiming&&c.resourceTiming[this.id]&&(d=c.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&o.e(_,{resourceTiming:d}),this.fire(new o.l("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(c){if(this._pendingLoads--,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(c))}})}loaded(){return this._pendingLoads===0}loadTile(t){return o._(this,void 0,void 0,function*(){const r=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};t.abortController=new AbortController;const d=yield this.actor.sendAsync({type:r,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(d,this.map.painter,r==="RT")})}abortTile(t){return o._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return o._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Ne extends o.E{constructor(t,r,c,d){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=c,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=r}load(t){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Ct.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,t&&(this.coordinates=t),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new o.k(r))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(o.a0.fromLngLat);var c;return this.tileID=function(d){const _=o.a1.fromPoints(d),b=_.width(),M=_.height(),T=Math.max(b,M),I=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),R=Math.pow(2,I);return new o.a3(I,Math.floor((_.minX+_.maxX)/2*R),Math.floor((_.minY+_.maxY)/2*R))}(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(d=>this.tileID.getTilePoint(d)._round()),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,r=t.gl;this.texture||(this.texture=new o.T(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:r,minY:c,maxX:d,maxY:_}=o.a1.fromPoints(t),b={};for(let M=0;M<=o.a2;M++){const T=Math.pow(2,M),I=Math.floor(r*T),R=Math.floor(c*T),F=Math.floor(d*T),L=Math.floor(_*T);b[M]={minTileX:I,minTileY:R,maxTileX:F,maxTileY:L}}return b}}class Be extends Ne{constructor(t,r,c,d){super(t,r,c,d),this.roundZoom=!0,this.type="video",this.options=r}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield o.a4(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new o.k(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new o.k(new o.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Oe extends Ne{constructor(t,r,c,d){super(t,r,c,d),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(b=>typeof b!="number"))||this.fire(new o.k(new o.a5(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a5(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.k(new o.a5(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a5(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a5(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,c=r.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,c.RGBA,{premultiply:!0});let d=!1;for(const _ in this.tiles){const b=this.tiles[_];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,d=!0)}d&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ge={},Ue=g=>{switch(g){case"geojson":return we;case"image":return Ne;case"raster":return ee;case"raster-dem":return he;case"vector":return ii;case"video":return Be;case"canvas":return Oe}return Ge[g]},di="RTLPluginLoaded";class gi extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=_e()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return o._(this,arguments,void 0,function*(r,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=k.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(di))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Bi=null;function Ye(){return Bi||(Bi=new gi),Bi}class _i{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=o.a6(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const r=t+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(d,_){const b={};if(!_)return b;for(const M of d){const T=M.layerIds.map(I=>_.getLayer(I)).filter(Boolean);if(T.length!==0){M.layers=T,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(I=>T.filter(R=>R.id===I)[0]));for(const I of T)b[I.id]=M}}return b}(t.buckets,r==null?void 0:r.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof o.a8){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const _=this.buckets[d];if(_ instanceof o.a8&&_.hasRTLText){this.hasRTLText=!0,Ye().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const _=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(d).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.a7}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,c,d,_,b,M,T,I,R,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:b,tileSize:this.tileSize,pixelPosMatrix:R,transform:T,params:M,queryPadding:this.queryPadding*I,getElevation:F},t,r,c):{}}querySourceFeatures(t,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),_=r&&r.sourceLayer?r.sourceLayer:"",b=d._geojsonTileLayer||d[_];if(!b)return;const M=o.a9(r&&r.filter),{z:T,x:I,y:R}=this.tileID.canonical,F={z:T,x:I,y:R};for(let L=0;L<b.length;L++){const G=b.feature(L);if(M.needGeometry){const Q=o.aa(G,!0);if(!M.filter(new o.F(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!M.filter(new o.F(this.tileID.overscaledZ),G))continue;const Z=c.getId(G,_),tt=new o.ab(G,T,I,R,Z);tt.tile=F,t.push(tt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const c=o.ac(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(r)if(this.expirationTime<r)d=!0;else{const _=this.expirationTime-r;_?this.expirationTime=c+Math.max(_,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const _=this.buckets[d],b=_.layers[0].sourceLayer||"_geojsonTileLayer",M=c[b],T=t[b];if(!M||!T||Object.keys(T).length===0)continue;_.update(T,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=r&&r.style&&r.style.getLayer(d);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<k.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=k.now()+t}setDependencies(t,r){const c={};for(const d of r)c[d]=!0;this.dependencies[t]=c}hasDependency(t,r){for(const c of t){const d=this.dependencies[c];if(d){for(const _ of r)if(d[_])return!0}}return!1}}class Si{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,c){const d=t.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const _={value:r,timeout:void 0};if(c!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},c)),this.data[d].push(_),this.order.push(d),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const c=t.wrapped().key,d=r===void 0?0:this.data[c].indexOf(r),_=this.data[c][d];return this.data[c].splice(d,1),_.timeout&&clearTimeout(_.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const c in this.data)for(const d of this.data[c])t(d.value)||r.push(d);for(const c of r)this.remove(c.value.tileID,c)}}class Je{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,c){const d=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},o.e(this.stateChanges[t][d],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==d&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][d]===null){this.deletedStates[t][d]={};for(const _ in this.state[t][d])c[_]||(this.deletedStates[t][d][_]=null)}else for(const _ in c)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][_]===null&&delete this.deletedStates[t][d][_]}removeFeatureState(t,r,c){if(this.deletedStates[t]===null)return;const d=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&r!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][c]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(c in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][c]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}getState(t,r){const c=String(r),d=o.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][r];if(_===null)return{};for(const b in _)delete d[b]}return d}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const _={};for(const b in this.stateChanges[d])this.state[d][b]||(this.state[d][b]={}),o.e(this.state[d][b],this.stateChanges[d][b]),_[b]=this.state[d][b];c[d]=_}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const _={};if(this.deletedStates[d]===null)for(const b in this.state[d])_[b]={},this.state[d][b]={};else for(const b in this.deletedStates[d]){if(this.deletedStates[d][b]===null)this.state[d][b]={};else for(const M of Object.keys(this.deletedStates[d][b]))delete this.state[d][b][M];_[b]=this.state[d][b]}c[d]=c[d]||{},o.e(c[d],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in t)t[d].setFeatureState(c,r)}}const fi=89.25;function _t(g,t){const r=o.ag(t.lat,-85.051129,o.ah);return new o.P(o.V(t.lng)*g,o.U(r)*g)}function $(g,t){return new o.a0(t.x/g,t.y/g).toLngLat()}function H(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(o.ad(90-g.pitch)),Math.tan(o.ad(fi-g.pitch)))}function Y(g,t){const r=g.canonical,c=t/o.ae(r.z),d=r.x+Math.pow(2,r.z)*g.wrap,_=o.af(new Float64Array(16));return o.M(_,_,[d*c,r.y*c,0]),o.N(_,_,[c/o.$,c/o.$,1]),_}function nt(g,t,r,c,d){const _=o.a0.fromLngLat(g,t),b=d*o.ai(1,g.lat),M=b*Math.cos(o.ad(r)),T=Math.sqrt(b*b-M*M),I=T*Math.sin(o.ad(-c)),R=T*Math.cos(o.ad(-c));return new o.a0(_.x+I,_.y+R,_.z+M)}function mt(g,t,r){const c=t.intersectsFrustum(g);if(!r||c===0)return c;const d=t.intersectsPlane(r);return d===0?0:c===2&&d===2?2:1}function vt(g,t,r){let c=0;const d=(r-t)/10;for(let _=0;_<10;_++)c+=d*Math.pow(Math.cos(t+(_+.5)/10*(r-t)),g);return c}function St(g,t){return function(r,c,d,_,b){const M=2*((g-1)/o.aj(Math.cos(o.ad(fi-b))/Math.cos(o.ad(fi)))-1),T=Math.acos(d/_),I=2*vt(M-1,0,o.ad(b/2)),R=Math.min(o.ad(fi),T+o.ad(b/2)),F=vt(M-1,Math.min(R,T-o.ad(b/2)),R),L=Math.atan(c/d),G=Math.hypot(c,d);let Z=r;return Z+=o.aj(_/G/Math.max(.5,Math.cos(o.ad(b/2)))),Z+=M*o.aj(Math.cos(L))/2,Z-=o.aj(Math.max(1,F/I/t))/2,Z}}const xt=St(9.314,3);function Lt(g,t){const r=(t.roundZoom?Math.round:Math.floor)(g.zoom+o.aj(g.tileSize/t.tileSize));return Math.max(0,r)}function Rt(g,t){const r=g.getCameraFrustum(),c=g.getClippingPlane(),d=g.screenPointToMercatorCoordinate(g.getCameraPoint()),_=o.a0.fromLngLat(g.center,g.elevation);d.z=_.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const b=g.getCoveringTilesDetailsProvider(),M=b.allowVariableZoom(g,t),T=Lt(g,t),I=t.minzoom||0,R=t.maxzoom!==void 0?t.maxzoom:g.maxZoom,F=Math.min(Math.max(0,T),R),L=Math.pow(2,F),G=[L*d.x,L*d.y,0],Z=[L*_.x,L*_.y,0],tt=Math.hypot(_.x-d.x,_.y-d.y),Q=Math.abs(_.z-d.z),et=Math.hypot(tt,Q),st=dt=>({zoom:0,x:0,y:0,wrap:dt,fullyVisible:!1}),ht=[],at=[];if(g.renderWorldCopies&&b.allowWorldCopies())for(let dt=1;dt<=3;dt++)ht.push(st(-dt)),ht.push(st(dt));for(ht.push(st(0));ht.length>0;){const dt=ht.pop(),pt=dt.x,ot=dt.y;let bt=dt.fullyVisible;const It={x:pt,y:ot,z:dt.zoom},Mt=b.getTileBoundingVolume(It,dt.wrap,g.elevation,t);if(!bt){const Jt=mt(r,Mt,c);if(Jt===0)continue;bt=Jt===2}const Tt=b.distanceToTile2d(d.x,d.y,It,Mt);let At=T;M&&(At=(t.calculateTileZoom||xt)(g.zoom+o.aj(g.tileSize/t.tileSize),Tt,Q,et,g.fov)),At=(t.roundZoom?Math.round:Math.floor)(At),At=Math.max(0,At);const te=Math.min(At,R);if(dt.wrap=b.getWrap(_,It,dt.wrap),dt.zoom>=te){if(dt.zoom<I)continue;const Jt=F-dt.zoom,Vt=G[0]-.5-(pt<<Jt),pe=G[1]-.5-(ot<<Jt),ti=t.reparseOverscaled?Math.max(dt.zoom,At):dt.zoom;at.push({tileID:new o.Z(dt.zoom===R?ti:dt.zoom,dt.wrap,dt.zoom,pt,ot),distanceSq:o.ak([Z[0]-.5-pt,Z[1]-.5-ot]),tileDistanceToCamera:Math.sqrt(Vt*Vt+pe*pe)})}else for(let Jt=0;Jt<4;Jt++)ht.push({zoom:dt.zoom+1,x:(pt<<1)+Jt%2,y:(ot<<1)+(Jt>>1),wrap:dt.wrap,fullyVisible:bt})}return at.sort((dt,pt)=>dt.distanceSq-pt.distanceSq).map(dt=>dt.tileID)}const wt=o.a1.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class Nt extends o.E{constructor(t,r,c){super(),this.id=t,this.dispatcher=c,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,_,b,M)=>{const T=new(Ue(_.type))(d,_,b,M);if(T.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${T.id}`);return T})(t,r,c,this),this._tiles={},this._cache=new Si(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Je,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const r=this._tiles[t];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r,c){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,r,c)}catch(d){t.state="errored",d.status!==404?this._source.fire(new o.k(d,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new o.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(ft).map(t=>t.key)}getRenderableIds(t){const r=[];for(const c in this._tiles)this._isIdRenderable(c,t)&&r.push(this._tiles[c]);return t?r.sort((c,d)=>{const _=c.tileID,b=d.tileID,M=new o.P(_.canonical.x,_.canonical.y)._rotate(-this.transform.bearingInRadians),T=new o.P(b.canonical.x,b.canonical.y)._rotate(-this.transform.bearingInRadians);return _.overscaledZ-b.overscaledZ||T.y-M.y||T.x-M.x}).map(c=>c.tileID.key):r.map(c=>c.tileID).sort(ft).map(c=>c.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)t?this._reloadTile(r,"expired"):this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(t,r){return o._(this,void 0,void 0,function*(){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=r),yield this._loadTile(c,t,r))})}_tileLoaded(t,r,c){t.timeAdded=k.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const r=this.getRenderableIds();for(let d=0;d<r.length;d++){const _=r[d];if(t.neighboringTiles&&t.neighboringTiles[_]){const b=this.getTileByID(_);c(t,b),c(b,t)}}function c(d,_){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let b=_.tileID.canonical.x-d.tileID.canonical.x;const M=_.tileID.canonical.y-d.tileID.canonical.y,T=Math.pow(2,d.tileID.canonical.z),I=_.tileID.key;b===0&&M===0||Math.abs(M)>1||(Math.abs(b)>1&&(Math.abs(b+T)===1?b+=T:Math.abs(b-T)===1&&(b-=T)),_.dem&&d.dem&&(d.dem.backfillBorder(_.dem,b,M),d.neighboringTiles&&d.neighboringTiles[I]&&(d.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,c,d){for(const _ in this._tiles){let b=this._tiles[_];if(d[_]||!b.hasData()||b.tileID.overscaledZ<=r||b.tileID.overscaledZ>c)continue;let M=b.tileID;for(;b&&b.tileID.overscaledZ>r+1;){const I=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[I.key],b&&b.hasData()&&(M=I)}let T=M;for(;T.overscaledZ>r;)if(T=T.scaledTo(T.overscaledZ-1),t[T.key]||t[T.canonical.key]){d[M.key]=M;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=r?c:null}for(let c=t.overscaledZ-1;c>=r;c--){const d=t.scaledTo(c),_=this._getLoadedTile(d);if(_)return _}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,d=Math.floor(r*c*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(_)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const c={};for(const d in this._tiles){const _=this._tiles[d];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),c[_.tileID.key]=_}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(t,r,c,d,_,b){const M={},T={},I=Object.keys(t),R=k.now();for(const F of I){const L=t[F],G=this._tiles[F];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=R)continue;const Z=this.findLoadedParent(L,r),tt=this.findLoadedSibling(L),Q=Z||tt||null;Q&&(this._addTile(Q.tileID),M[Q.tileID.key]=Q.tileID),T[F]=L}this._retainLoadedChildren(T,d,c,t);for(const F in M)t[F]||(this._coveredTiles[F]=!0,t[F]=M[F]);if(b){const F={},L={};for(const G of _)this._tiles[G.key].hasData()?F[G.key]=G:L[G.key]=G;for(const G in L){const Z=L[G].children(this._source.maxzoom);this._tiles[Z[0].key]&&this._tiles[Z[1].key]&&this._tiles[Z[2].key]&&this._tiles[Z[3].key]&&(F[Z[0].key]=t[Z[0].key]=Z[0],F[Z[1].key]=t[Z[1].key]=Z[1],F[Z[2].key]=t[Z[2].key]=Z[2],F[Z[3].key]=t[Z[3].key]=Z[3],delete L[G])}for(const G in L){const Z=L[G],tt=this.findLoadedParent(Z,this._source.minzoom),Q=this.findLoadedSibling(Z),et=tt||Q||null;if(et){F[et.tileID.key]=t[et.tileID.key]=et.tileID;for(const st in F)F[st].isChildOf(et.tileID)&&delete F[st]}}for(const G in this._tiles)F[G]||(this._coveredTiles[G]=!0)}}update(t,r){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=r,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new o.Z(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(c=Rt(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter(R=>this._source.hasTile(R)))):c=[];const d=Lt(t,this._source),_=Math.max(d-Nt.maxOverzooming,this._source.minzoom),b=Math.max(d+Nt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const F of c)if(F.canonical.z>this._source.minzoom){const L=F.scaledTo(F.canonical.z-1);R[L.key]=L;const G=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));R[G.key]=G}c=c.concat(Object.values(R))}const M=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(c,d);re(this._source.type)&&this._updateCoveredAndRetainedTiles(T,_,b,d,c,r);for(const R in T)this._tiles[R].clearFadeHold();const I=o.al(this._tiles,T);for(const R of I){const F=this._tiles[R];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){var c;const d={},_={},b=Math.max(r-Nt.maxOverzooming,this._source.minzoom),M=Math.max(r+Nt.maxUnderzooming,this._source.minzoom),T={};for(const I of t){const R=this._addTile(I);d[I.key]=I,R.hasData()||r<this._source.maxzoom&&(T[I.key]=I)}this._retainLoadedChildren(T,r,M,d);for(const I of t){let R=this._tiles[I.key];if(R.hasData())continue;if(r+1>this._source.maxzoom){const L=I.children(this._source.maxzoom)[0],G=this.getTile(L);if(G&&G.hasData()){d[L.key]=L;continue}}else{const L=I.children(this._source.maxzoom);if(d[L[0].key]&&d[L[1].key]&&d[L[2].key]&&d[L[3].key])continue}let F=R.wasRequested();for(let L=I.overscaledZ-1;L>=b;--L){const G=I.scaledTo(L);if(_[G.key])break;if(_[G.key]=!0,R=this.getTile(G),!R&&F&&(R=this._addTile(G)),R){const Z=R.hasData();if((Z||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||F)&&(d[G.key]=G),F=R.wasRequested(),Z)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let c,d=this._tiles[t].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}r.push(d.key);const _=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;d=_}for(const _ of r)this._loadedParentTiles[_]=c}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const r=this._tiles[t].tileID,c=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=c}}_addTile(t){let r=this._tiles[t.key];if(r)return r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const c=r;return r||(r=new _i(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,t.key,r.state)),r.uses++,this._tiles[t.key]=r,c||this._source.fire(new o.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=r.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}refreshTiles(t){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&t.some(c=>c.equals(this._tiles[r].tileID.canonical))&&this._reloadTile(r,"expired")}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(t){const r=t.sourceDataType;t.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&r==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,r,c){const d=[],_=this.transform;if(!_)return d;const b=_.getCoveringTilesDetailsProvider().allowWorldCopies(),M=c?_.getCameraQueryGeometry(t):t,T=G=>_.screenPointToMercatorCoordinate(G,this.terrain),I=this.transformBbox(t,T,!b),R=this.transformBbox(M,T,!b),F=this.getIds(),L=o.a1.fromPoints(R);for(let G=0;G<F.length;G++){const Z=this._tiles[F[G]];if(Z.holdingForFade())continue;const tt=b?[Z.tileID]:[Z.tileID.unwrapTo(-1),Z.tileID.unwrapTo(0)],Q=Math.pow(2,_.zoom-Z.tileID.overscaledZ),et=r*Z.queryPadding*o.$/Z.tileSize/Q;for(const st of tt){const ht=L.map(at=>st.getTilePoint(new o.a0(at.x,at.y)));if(ht.expandBy(et),ht.intersects(wt)){const at=I.map(pt=>st.getTilePoint(pt)),dt=R.map(pt=>st.getTilePoint(pt));d.push({tile:Z,tileID:b?st:st.unwrapTo(0),queryGeometry:at,cameraQueryGeometry:dt,scale:Q})}}}return d}transformBbox(t,r,c){let d=t.map(r);if(c){const _=o.a1.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const b=_.map(r);o.a1.fromPoints(d).covers(b)||(d=d.map(M=>M.x>.5?new o.a0(M.x-1,M.y,M.z):M))}return d}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(re(this._source.type)){const t=k.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=t)return!0}return!1}setFeatureState(t,r,c){this._state.updateState(t=t||"_geojsonTileLayer",r,c)}removeFeatureState(t,r,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,c)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,c){const d=this._tiles[t];d&&d.setDependencies(r,c)}reloadTilesForDependencies(t,r){for(const c in this._tiles)this._tiles[c].hasDependency(t,r)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(t,r))}}function ft(g,t){const r=Math.abs(2*g.wrap)-+(g.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return g.overscaledZ-t.overscaledZ||c-r||t.canonical.y-g.canonical.y||t.canonical.x-g.canonical.x}function re(g){return g==="raster"||g==="image"||g==="video"}Nt.maxOverzooming=10,Nt.maxUnderzooming=3;class Pe{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.ag(t,0,1);let r=1,c=this._distances[r];const d=t*this.paddedLength+this.padding;for(;c<d&&r<this._distances.length;)c=this._distances[++r];const _=r-1,b=this._distances[_],M=c-b,T=M>0?(d-b)/M:0;return this.points[_].mult(1-T).add(this.points[r].mult(T))}}function oe(g,t){let r=!0;return g==="always"||g!=="never"&&t!=="never"||(r=!1),r}class xe{constructor(t,r,c){const d=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(r/c);for(let b=0;b<this.xCellCount*this.yCellCount;b++)d.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,c,d,_){this._forEachCell(r,c,d,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(_)}insertCircle(t,r,c,d){this._forEachCell(r-d,c-d,r+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(c),this.circles.push(d)}_insertBoxCell(t,r,c,d,_,b){this.boxCells[_].push(b)}_insertCircleCell(t,r,c,d,_,b){this.circleCells[_].push(b)}_query(t,r,c,d,_,b,M){if(c<0||t>this.width||d<0||r>this.height)return[];const T=[];if(t<=0&&r<=0&&this.width<=c&&this.height<=d){if(_)return[{key:null,x1:t,y1:r,x2:c,y2:d}];for(let I=0;I<this.boxKeys.length;I++)T.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const R=this.circles[3*I],F=this.circles[3*I+1],L=this.circles[3*I+2];T.push({key:this.circleKeys[I],x1:R-L,y1:F-L,x2:R+L,y2:F+L})}}else this._forEachCell(t,r,c,d,this._queryCell,T,{hitTest:_,overlapMode:b,seenUids:{box:{},circle:{}}},M);return T}query(t,r,c,d){return this._query(t,r,c,d,!1,null)}hitTest(t,r,c,d,_,b){return this._query(t,r,c,d,!0,_,b).length>0}hitTestCircle(t,r,c,d,_){const b=t-c,M=t+c,T=r-c,I=r+c;if(M<0||b>this.width||I<0||T>this.height)return!1;const R=[];return this._forEachCell(b,T,M,I,this._queryCellCircle,R,{hitTest:!0,overlapMode:d,circle:{x:t,y:r,radius:c},seenUids:{box:{},circle:{}}},_),R.length>0}_queryCell(t,r,c,d,_,b,M,T){const{seenUids:I,hitTest:R,overlapMode:F}=M,L=this.boxCells[_];if(L!==null){const Z=this.bboxes;for(const tt of L)if(!I.box[tt]){I.box[tt]=!0;const Q=4*tt,et=this.boxKeys[tt];if(t<=Z[Q+2]&&r<=Z[Q+3]&&c>=Z[Q+0]&&d>=Z[Q+1]&&(!T||T(et))&&(!R||!oe(F,et.overlapMode))&&(b.push({key:et,x1:Z[Q],y1:Z[Q+1],x2:Z[Q+2],y2:Z[Q+3]}),R))return!0}}const G=this.circleCells[_];if(G!==null){const Z=this.circles;for(const tt of G)if(!I.circle[tt]){I.circle[tt]=!0;const Q=3*tt,et=this.circleKeys[tt];if(this._circleAndRectCollide(Z[Q],Z[Q+1],Z[Q+2],t,r,c,d)&&(!T||T(et))&&(!R||!oe(F,et.overlapMode))){const st=Z[Q],ht=Z[Q+1],at=Z[Q+2];if(b.push({key:et,x1:st-at,y1:ht-at,x2:st+at,y2:ht+at}),R)return!0}}}return!1}_queryCellCircle(t,r,c,d,_,b,M,T){const{circle:I,seenUids:R,overlapMode:F}=M,L=this.boxCells[_];if(L!==null){const Z=this.bboxes;for(const tt of L)if(!R.box[tt]){R.box[tt]=!0;const Q=4*tt,et=this.boxKeys[tt];if(this._circleAndRectCollide(I.x,I.y,I.radius,Z[Q+0],Z[Q+1],Z[Q+2],Z[Q+3])&&(!T||T(et))&&!oe(F,et.overlapMode))return b.push(!0),!0}}const G=this.circleCells[_];if(G!==null){const Z=this.circles;for(const tt of G)if(!R.circle[tt]){R.circle[tt]=!0;const Q=3*tt,et=this.circleKeys[tt];if(this._circlesCollide(Z[Q],Z[Q+1],Z[Q+2],I.x,I.y,I.radius)&&(!T||T(et))&&!oe(F,et.overlapMode))return b.push(!0),!0}}}_forEachCell(t,r,c,d,_,b,M,T){const I=this._convertToXCellCoord(t),R=this._convertToYCellCoord(r),F=this._convertToXCellCoord(c),L=this._convertToYCellCoord(d);for(let G=I;G<=F;G++)for(let Z=R;Z<=L;Z++)if(_.call(this,t,r,c,d,this.xCellCount*Z+G,b,M,T))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,c,d,_,b){const M=d-t,T=_-r,I=c+b;return I*I>M*M+T*T}_circleAndRectCollide(t,r,c,d,_,b,M){const T=(b-d)/2,I=Math.abs(t-(d+T));if(I>T+c)return!1;const R=(M-_)/2,F=Math.abs(r-(_+R));if(F>R+c)return!1;if(I<=T||F<=R)return!0;const L=I-T,G=F-R;return L*L+G*G<=c*c}}function ze(g,t,r){const c=o.L();if(!g){const{vecSouth:F,vecEast:L}=mi(t),G=A();G[0]=L[0],G[1]=L[1],G[2]=F[0],G[3]=F[1],d=G,(R=(b=(_=G)[0])*(I=_[3])-(T=_[2])*(M=_[1]))&&(d[0]=I*(R=1/R),d[1]=-M*R,d[2]=-T*R,d[3]=b*R),c[0]=G[0],c[1]=G[1],c[4]=G[2],c[5]=G[3]}var d,_,b,M,T,I,R;return o.N(c,c,[1/r,1/r,1]),c}function wi(g,t,r,c){if(g){const d=o.L();if(!t){const{vecSouth:_,vecEast:b}=mi(r);d[0]=b[0],d[1]=b[1],d[4]=_[0],d[5]=_[1]}return o.N(d,d,[c,c,1]),d}return r.pixelsToClipSpaceMatrix}function mi(g){const t=Math.cos(g.rollInRadians),r=Math.sin(g.rollInRadians),c=Math.cos(g.pitchInRadians),d=Math.cos(g.bearingInRadians),_=Math.sin(g.bearingInRadians),b=o.aq();b[0]=-d*c*r-_*t,b[1]=-_*c*r+d*t;const M=o.ar(b);M<1e-9?o.as(b):o.at(b,b,1/M);const T=o.aq();T[0]=d*c*t-_*r,T[1]=_*c*t+d*r;const I=o.ar(T);return I<1e-9?o.as(T):o.at(T,T,1/I),{vecEast:T,vecSouth:b}}function oi(g,t,r,c){let d;c?(d=[g,t,c(g,t),1],o.av(d,d,r)):(d=[g,t,0,1],Mn(d,d,r));const _=d[3];return{point:new o.P(d[0]/_,d[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Ae(g,t){return .5+g/t*.5}function ei(g,t){return g.x>=-t[0]&&g.x<=t[0]&&g.y>=-t[1]&&g.y<=t[1]}function Ji(g,t,r,c,d,_,b,M,T,I,R,F,L){const G=r?g.textSizeData:g.iconSizeData,Z=o.am(G,t.transform.zoom),tt=[256/t.width*2+1,256/t.height*2+1],Q=r?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Q.clear();const et=g.lineVertexArray,st=r?g.text.placedSymbolArray:g.icon.placedSymbolArray,ht=t.transform.width/t.transform.height;let at=!1;for(let dt=0;dt<st.length;dt++){const pt=st.get(dt);if(pt.hidden||pt.writingMode===o.an.vertical&&!at){Bs(pt.numGlyphs,Q);continue}at=!1;const ot=new o.P(pt.anchorX,pt.anchorY),bt={getElevation:L,pitchedLabelPlaneMatrix:c,lineVertexArray:et,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:ot,unwrappedTileID:T,width:I,height:R,translation:F},It=Ze(pt.anchorX,pt.anchorY,bt);if(!ei(It.point,tt)){Bs(pt.numGlyphs,Q);continue}const Mt=Ae(t.transform.cameraToCenterDistance,It.signedDistanceFromCamera),Tt=o.ao(G,Z,pt),At=_?Tt*t.transform.getPitchedTextCorrection(pt.anchorX,pt.anchorY,T)/Mt:Tt*Mt,te=ki({projectionContext:bt,pitchedLabelPlaneMatrixInverse:d,symbol:pt,fontSize:At,flip:!1,keepUpright:b,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:ht,rotateToLine:M});at=te.useVertical,(te.notEnoughRoom||at||te.needsFlipping&&ki({projectionContext:bt,pitchedLabelPlaneMatrixInverse:d,symbol:pt,fontSize:At,flip:!0,keepUpright:b,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:ht,rotateToLine:M}).notEnoughRoom)&&Bs(pt.numGlyphs,Q)}r?g.text.dynamicLayoutVertexBuffer.updateData(Q):g.icon.dynamicLayoutVertexBuffer.updateData(Q)}function Xt(g,t,r,c,d,_,b,M){const T=_.glyphStartIndex+_.numGlyphs,I=_.lineStartIndex,R=_.lineStartIndex+_.lineLength,F=t.getoffsetX(_.glyphStartIndex),L=t.getoffsetX(T-1),G=$r(g*F,r,c,d,_.segment,I,R,M,b);if(!G)return null;const Z=$r(g*L,r,c,d,_.segment,I,R,M,b);return Z?M.projectionCache.anyProjectionOccluded?null:{first:G,last:Z}:null}function ir(g,t,r,c){return g===o.an.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*c?{useVertical:!0}:(g===o.an.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function ki(g){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:r,symbol:c,fontSize:d,flip:_,keepUpright:b,glyphOffsetArray:M,dynamicLayoutVertexArray:T,aspectRatio:I,rotateToLine:R}=g,F=d/24,L=c.lineOffsetX*F,G=c.lineOffsetY*F;let Z;if(c.numGlyphs>1){const tt=c.glyphStartIndex+c.numGlyphs,Q=c.lineStartIndex,et=c.lineStartIndex+c.lineLength,st=Xt(F,M,L,G,_,c,R,t);if(!st)return{notEnoughRoom:!0};const ht=$e(st.first.point.x,st.first.point.y,t,r),at=$e(st.last.point.x,st.last.point.y,t,r);if(b&&!_){const dt=ir(c.writingMode,ht,at,I);if(dt)return dt}Z=[st.first];for(let dt=c.glyphStartIndex+1;dt<tt-1;dt++){const pt=$r(F*M.getoffsetX(dt),L,G,_,c.segment,Q,et,t,R);if(!pt)return{notEnoughRoom:!0};Z.push(pt)}Z.push(st.last)}else{if(b&&!_){const Q=Yt(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,et=c.lineStartIndex+c.segment+1,st=new o.P(t.lineVertexArray.getx(et),t.lineVertexArray.gety(et)),ht=Yt(st.x,st.y,t),at=ht.signedDistanceFromCamera>0?ht.point:qr(t.tileAnchorPoint,st,Q,1,t),dt=$e(Q.x,Q.y,t,r),pt=$e(at.x,at.y,t,r),ot=ir(c.writingMode,dt,pt,I);if(ot)return ot}const tt=$r(F*M.getoffsetX(c.glyphStartIndex),L,G,_,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,t,R);if(!tt||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[tt]}for(const tt of Z)o.au(T,tt.point,tt.angle);return{}}function qr(g,t,r,c,d){const _=g.add(g.sub(t)._unit()),b=Yt(_.x,_.y,d).point,M=r.sub(b);return r.add(M._mult(c/M.mag()))}function ls(g,t,r){const c=t.projectionCache;if(c.projections[g])return c.projections[g];const d=new o.P(t.lineVertexArray.getx(g),t.lineVertexArray.gety(g)),_=Yt(d.x,d.y,t);if(_.signedDistanceFromCamera>0)return c.projections[g]=_.point,c.anyProjectionOccluded=c.anyProjectionOccluded||_.isOccluded,_.point;const b=g-r.direction;return qr(r.distanceFromAnchor===0?t.tileAnchorPoint:new o.P(t.lineVertexArray.getx(b),t.lineVertexArray.gety(b)),d,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,t)}function Yt(g,t,r){const c=g+r.translation[0],d=t+r.translation[1];let _;return r.pitchWithMap?(_=oi(c,d,r.pitchedLabelPlaneMatrix,r.getElevation),_.isOccluded=!1):(_=r.transform.projectTileCoordinates(c,d,r.unwrappedTileID,r.getElevation),_.point.x=(.5*_.point.x+.5)*r.width,_.point.y=(.5*-_.point.y+.5)*r.height),_}function $e(g,t,r,c){if(r.pitchWithMap){const d=[g,t,0,1];return o.av(d,d,c),r.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],r.unwrappedTileID,r.getElevation).point}return{x:g/r.width*2-1,y:t/r.height*2-1}}function Ze(g,t,r){return r.transform.projectTileCoordinates(g,t,r.unwrappedTileID,r.getElevation)}function ur(g,t,r){return g._unit()._perp()._mult(t*r)}function Fs(g,t,r,c,d,_,b,M,T){if(M.projectionCache.offsets[g])return M.projectionCache.offsets[g];const I=r.add(t);if(g+T.direction<c||g+T.direction>=d)return M.projectionCache.offsets[g]=I,I;const R=ls(g+T.direction,M,T),F=ur(R.sub(r),b,T.direction),L=r.add(F),G=R.add(F);return M.projectionCache.offsets[g]=o.aw(_,I,L,G)||I,M.projectionCache.offsets[g]}function $r(g,t,r,c,d,_,b,M,T){const I=c?g-t:g+t;let R=I>0?1:-1,F=0;c&&(R*=-1,F=Math.PI),R<0&&(F+=Math.PI);let L,G=R>0?_+d:_+d+1;M.projectionCache.cachedAnchorPoint?L=M.projectionCache.cachedAnchorPoint:(L=Yt(M.tileAnchorPoint.x,M.tileAnchorPoint.y,M).point,M.projectionCache.cachedAnchorPoint=L);let Z,tt,Q=L,et=L,st=0,ht=0;const at=Math.abs(I),dt=[];let pt;for(;st+ht<=at;){if(G+=R,G<_||G>=b)return null;st+=ht,et=Q,tt=Z;const It={absOffsetX:at,direction:R,distanceFromAnchor:st,previousVertex:et};if(Q=ls(G,M,It),r===0)dt.push(et),pt=Q.sub(et);else{let Mt;const Tt=Q.sub(et);Mt=Tt.mag()===0?ur(ls(G+R,M,It).sub(Q),r,R):ur(Tt,r,R),tt||(tt=et.add(Mt)),Z=Fs(G,Mt,Q,_,b,tt,r,M,It),dt.push(tt),pt=Z.sub(tt)}ht=pt.mag()}const ot=pt._mult((at-st)/ht)._add(tt||et),bt=F+Math.atan2(Q.y-et.y,Q.x-et.x);return dt.push(ot),{point:ot,angle:T?bt:0,path:dt}}const We=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Bs(g,t){for(let r=0;r<g;r++){const c=t.length;t.resize(c+4),t.float32.set(We,3*c)}}function Mn(g,t,r){const c=t[0],d=t[1];return g[0]=r[0]*c+r[4]*d+r[12],g[1]=r[1]*c+r[5]*d+r[13],g[3]=r[3]*c+r[7]*d+r[15],g}const Qi=100;class ka{constructor(t,r=new xe(t.width+200,t.height+200,25),c=new xe(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=c,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Qi,this.screenBottomBoundary=t.height+Qi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,c,d,_,b,M,T,I,R,F,L){const G=this.projectAndGetPerspectiveRatio(t.anchorPointX+T[0],t.anchorPointY+T[1],_,R,L),Z=c*G.perspectiveRatio;let tt;if(b||M)tt=this._projectCollisionBox(t,Z,d,_,b,M,T,G,R,F,L);else{const pt=G.x+(F?F.x*Z:0),ot=G.y+(F?F.y*Z:0);tt={allPointsOccluded:!1,box:[pt+t.x1*Z,ot+t.y1*Z,pt+t.x2*Z,ot+t.y2*Z]}}const[Q,et,st,ht]=tt.box,at=b?tt.allPointsOccluded:G.isOccluded;let dt=at;return dt||(dt=G.perspectiveRatio<this.perspectiveRatioCutoff),dt||(dt=!this.isInsideGrid(Q,et,st,ht)),dt||r!=="always"&&this.grid.hitTest(Q,et,st,ht,r,I)?{box:[Q,et,st,ht],placeable:!1,offscreen:!1,occluded:at}:{box:[Q,et,st,ht],placeable:!0,offscreen:this.isOffscreen(Q,et,st,ht),occluded:at}}placeCollisionCircles(t,r,c,d,_,b,M,T,I,R,F,L,G,Z){const tt=[],Q=new o.P(r.anchorX,r.anchorY),et=this.getPerspectiveRatio(Q.x,Q.y,b,Z),st=(I?_*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,b)/et:_*et)/o.aA,ht={getElevation:Z,pitchedLabelPlaneMatrix:M,lineVertexArray:c,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Q,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:G},at=Xt(st,d,r.lineOffsetX*st,r.lineOffsetY*st,!1,r,!1,ht);let dt=!1,pt=!1,ot=!0;if(at){const bt=.5*F*et+L,It=new o.P(-100,-100),Mt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Tt=new Pe,At=at.first,te=at.last;let Jt=[];for(let ti=At.path.length-1;ti>=1;ti--)Jt.push(At.path[ti]);for(let ti=1;ti<te.path.length;ti++)Jt.push(te.path[ti]);const Vt=2.5*bt;if(I){const ti=this.projectPathToScreenSpace(Jt,ht);Jt=ti.some(xi=>xi.signedDistanceFromCamera<=0)?[]:ti.map(xi=>xi.point)}let pe=[];if(Jt.length>0){const ti=Jt[0].clone(),xi=Jt[0].clone();for(let Ui=1;Ui<Jt.length;Ui++)ti.x=Math.min(ti.x,Jt[Ui].x),ti.y=Math.min(ti.y,Jt[Ui].y),xi.x=Math.max(xi.x,Jt[Ui].x),xi.y=Math.max(xi.y,Jt[Ui].y);pe=ti.x>=It.x&&xi.x<=Mt.x&&ti.y>=It.y&&xi.y<=Mt.y?[Jt]:xi.x<It.x||ti.x>Mt.x||xi.y<It.y||ti.y>Mt.y?[]:o.ax([Jt],It.x,It.y,Mt.x,Mt.y)}for(const ti of pe){Tt.reset(ti,.25*bt);let xi=0;xi=Tt.length<=.5*bt?1:Math.ceil(Tt.paddedLength/Vt)+1;for(let Ui=0;Ui<xi;Ui++){const Ti=Ui/Math.max(xi-1,1),Vi=Tt.lerp(Ti),Ii=Vi.x+Qi,Pi=Vi.y+Qi;tt.push(Ii,Pi,bt,0);const Ci=Ii-bt,wr=Pi-bt,pi=Ii+bt,pr=Pi+bt;if(ot=ot&&this.isOffscreen(Ci,wr,pi,pr),pt=pt||this.isInsideGrid(Ci,wr,pi,pr),t!=="always"&&this.grid.hitTestCircle(Ii,Pi,bt,t,R)&&(dt=!0,!T))return{circles:[],offscreen:!1,collisionDetected:dt}}}}return{circles:!T&&dt||!pt||et<this.perspectiveRatioCutoff?[]:tt,offscreen:ot,collisionDetected:dt}}projectPathToScreenSpace(t,r){const c=function(d,_){const b=o.L();return o.ap(b,_.pitchedLabelPlaneMatrix),d.map(M=>{const T=oi(M.x,M.y,b,_.getElevation),I=_.transform.projectTileCoordinates(T.point.x,T.point.y,_.unwrappedTileID,_.getElevation);return I.point.x=(.5*I.point.x+.5)*_.width,I.point.y=(.5*-I.point.y+.5)*_.height,I})}(t,r);return function(d){let _=0,b=0,M=0,T=0;for(let I=0;I<d.length;I++)d[I].isOccluded?(M=I+1,T=0):(T++,T>b&&(b=T,_=M));return d.slice(_,_+b)}(c)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],c=new o.a1;for(const F of t){const L=new o.P(F.x+Qi,F.y+Qi);c.extend(L),r.push(L)}const{minX:d,minY:_,maxX:b,maxY:M}=c,T=this.grid.query(d,_,b,M).concat(this.ignoredGrid.query(d,_,b,M)),I={},R={};for(const F of T){const L=F.key;if(I[L.bucketInstanceId]===void 0&&(I[L.bucketInstanceId]={}),I[L.bucketInstanceId][L.featureIndex])continue;const G=[new o.P(F.x1,F.y1),new o.P(F.x2,F.y1),new o.P(F.x2,F.y2),new o.P(F.x1,F.y2)];o.ay(r,G)&&(I[L.bucketInstanceId][L.featureIndex]=!0,R[L.bucketInstanceId]===void 0&&(R[L.bucketInstanceId]=[]),R[L.bucketInstanceId].push(L.featureIndex))}return R}insertCollisionBox(t,r,c,d,_,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:b,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,c,d,_,b){const M=c?this.ignoredGrid:this.grid,T={bucketInstanceId:d,featureIndex:_,collisionGroupID:b,overlapMode:r};for(let I=0;I<t.length;I+=4)M.insertCircle(T,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,r,c,d,_){if(_){let b;d?(b=[t,r,d(t,r),1],o.av(b,b,_)):(b=[t,r,0,1],Mn(b,b,_));const M=b[3];return{x:(b[0]/M+1)/2*this.transform.width+Qi,y:(-b[1]/M+1)/2*this.transform.height+Qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M*.5,isOccluded:!1,signedDistanceFromCamera:M}}{const b=this.transform.projectTileCoordinates(t,r,c,d);return{x:(b.point.x+1)/2*this.transform.width+Qi,y:(1-b.point.y)/2*this.transform.height+Qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5,isOccluded:b.isOccluded,signedDistanceFromCamera:b.signedDistanceFromCamera}}}getPerspectiveRatio(t,r,c,d){const _=this.transform.projectTileCoordinates(t,r,c,d);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,r,c,d){return c<Qi||t>=this.screenRightBoundary||d<Qi||r>this.screenBottomBoundary}isInsideGrid(t,r,c,d){return c>=0&&t<this.gridRightBoundary&&d>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=o.af([]);return o.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,r,c,d,_,b,M,T,I,R,F){let L=1,G=0,Z=0,tt=1;const Q=t.anchorPointX+M[0],et=t.anchorPointY+M[1];if(b&&!_){const Jt=this.projectAndGetPerspectiveRatio(Q+1,et,d,I,F),Vt=Jt.x-T.x,pe=Math.atan((Jt.y-T.y)/Vt)+(Vt<0?Math.PI:0),ti=Math.sin(pe),xi=Math.cos(pe);L=xi,G=ti,Z=-ti,tt=xi}else if(!b&&_){const Jt=mi(this.transform);L=Jt.vecEast[0],G=Jt.vecEast[1],Z=Jt.vecSouth[0],tt=Jt.vecSouth[1]}let st=T.x,ht=T.y,at=r;_&&(st=Q,ht=et,at=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),at*=this.transform.getPitchedTextCorrection(Q,et,d),R||(at*=o.ag(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),R&&(st+=L*R.x*at+Z*R.y*at,ht+=G*R.x*at+tt*R.y*at);const dt=t.x1*at,pt=t.x2*at,ot=(dt+pt)/2,bt=t.y1*at,It=t.y2*at,Mt=(bt+It)/2,Tt=[{offsetX:dt,offsetY:bt},{offsetX:ot,offsetY:bt},{offsetX:pt,offsetY:bt},{offsetX:pt,offsetY:Mt},{offsetX:pt,offsetY:It},{offsetX:ot,offsetY:It},{offsetX:dt,offsetY:It},{offsetX:dt,offsetY:Mt}];let At=[];for(const{offsetX:Jt,offsetY:Vt}of Tt)At.push(new o.P(st+L*Jt+Z*Vt,ht+G*Jt+tt*Vt));let te=!1;if(_){const Jt=At.map(Vt=>this.projectAndGetPerspectiveRatio(Vt.x,Vt.y,d,I,F));te=Jt.some(Vt=>!Vt.isOccluded),At=Jt.map(Vt=>new o.P(Vt.x,Vt.y))}else te=!0;return{box:o.az(At),allPointsOccluded:!te}}}class Da{constructor(t,r,c,d){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):d&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Ns{constructor(t,r,c,d,_){this.text=new Da(t?t.text:null,r,c,_),this.icon=new Da(t?t.icon:null,r,d,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class za{constructor(t,r,c){this.text=t,this.icon=r,this.skipFade=c}}class Jr{constructor(t,r,c,d,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=_}}class Ni{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[t]}}function Yc(g,t,r,c,d){const{horizontalAlign:_,verticalAlign:b}=o.aG(g);return new o.P(-(_-.5)*t+c[0]*d,-(b-.5)*r+c[1]*d)}class La{constructor(t,r,c,d,_){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new ka(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Ni(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const r=this.terrain;return r?(c,d)=>r.getElevation(t,c,d):null}getBucketParts(t,r,c,d){const _=c.getBucket(r),b=c.latestFeatureIndex;if(!_||!b||r.id!==_.layerIds[0])return;const M=c.collisionBoxArray,T=_.layers[0].layout,I=_.layers[0].paint,R=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),F=c.tileSize/o.$,L=c.tileID.toUnwrapped(),G=T.get("text-rotation-alignment")==="map",Z=o.aB(c,1,this.transform.zoom),tt=o.aC(this.collisionIndex.transform,c,I.get("text-translate"),I.get("text-translate-anchor")),Q=o.aC(this.collisionIndex.transform,c,I.get("icon-translate"),I.get("icon-translate-anchor")),et=ze(G,this.transform,Z);this.retainedQueryData[_.bucketInstanceId]=new Jr(_.bucketInstanceId,b,_.sourceLayerIndex,_.index,c.tileID);const st={bucket:_,layout:T,translationText:tt,translationIcon:Q,unwrappedTileID:L,pitchedLabelPlaneMatrix:et,scale:R,textPixelRatio:F,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.am(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(d)for(const ht of _.sortKeyRanges){const{sortKey:at,symbolInstanceStart:dt,symbolInstanceEnd:pt}=ht;t.push({sortKey:at,symbolInstanceStart:dt,symbolInstanceEnd:pt,parameters:st})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:st})}attemptAnchorPlacement(t,r,c,d,_,b,M,T,I,R,F,L,G,Z,tt,Q,et,st,ht,at){const dt=o.aD[t.textAnchor],pt=[t.textOffset0,t.textOffset1],ot=Yc(dt,c,d,pt,_),bt=this.collisionIndex.placeCollisionBox(r,L,T,I,R,M,b,Q,F.predicate,ht,ot,at);if((!st||this.collisionIndex.placeCollisionBox(st,L,T,I,R,M,b,et,F.predicate,ht,ot,at).placeable)&&bt.placeable){let It;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(It=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:pt,width:c,height:d,anchor:dt,textBoxScale:_,prevAnchor:It},this.markUsedJustification(Z,dt,G,tt),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,tt,G),this.placedOrientations[G.crossTileID]=tt),{shift:ot,placedGlyphBoxes:bt}}}placeLayerBucketPart(t,r,c){const{bucket:d,layout:_,translationText:b,translationIcon:M,unwrappedTileID:T,pitchedLabelPlaneMatrix:I,textPixelRatio:R,holdingForFade:F,collisionBoxArray:L,partiallyEvaluatedTextSize:G,collisionGroup:Z}=t.parameters,tt=_.get("text-optional"),Q=_.get("icon-optional"),et=o.aE(_,"text-overlap","text-allow-overlap"),st=et==="always",ht=o.aE(_,"icon-overlap","icon-allow-overlap"),at=ht==="always",dt=_.get("text-rotation-alignment")==="map",pt=_.get("text-pitch-alignment")==="map",ot=_.get("icon-text-fit")!=="none",bt=_.get("symbol-z-order")==="viewport-y",It=st&&(at||!d.hasIconData()||Q),Mt=at&&(st||!d.hasTextData()||tt);!d.collisionArrays&&L&&d.deserializeCollisionBoxes(L);const Tt=this.retainedQueryData[d.bucketInstanceId].tileID,At=this._getTerrainElevationFunc(Tt),te=this.transform.getFastPathSimpleProjectionMatrix(Tt),Jt=(Vt,pe,ti)=>{var xi,Ui;if(r[Vt.crossTileID])return;if(F)return void(this.placements[Vt.crossTileID]=new za(!1,!1,!1));let Ti=!1,Vi=!1,Ii=!0,Pi=null,Ci={box:null,placeable:!1,offscreen:null,occluded:!1},wr={placeable:!1},pi=null,pr=null,Mr=null,ln=0,hn=0,cn=0;pe.textFeatureIndex?ln=pe.textFeatureIndex:Vt.useRuntimeCollisionCircles&&(ln=Vt.featureIndex),pe.verticalTextFeatureIndex&&(hn=pe.verticalTextFeatureIndex);const Ds=pe.textBox;if(Ds){const Xr=Ki=>{let zi=o.an.horizontal;if(d.allowVerticalPlacement&&!Ki&&this.prevPlacement){const Br=this.prevPlacement.placedOrientations[Vt.crossTileID];Br&&(this.placedOrientations[Vt.crossTileID]=Br,zi=Br,this.markUsedOrientation(d,zi,Vt))}return zi},ws=(Ki,zi)=>{if(d.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&pe.verticalTextBox){for(const Br of d.writingModes)if(Br===o.an.vertical?(Ci=zi(),wr=Ci):Ci=Ki(),Ci&&Ci.placeable)break}else Ci=Ki()},un=Vt.textAnchorOffsetStartIndex,Ln=Vt.textAnchorOffsetEndIndex;if(Ln===un){const Ki=(zi,Br)=>{const or=this.collisionIndex.placeCollisionBox(zi,et,R,Tt,T,pt,dt,b,Z.predicate,At,void 0,te);return or&&or.placeable&&(this.markUsedOrientation(d,Br,Vt),this.placedOrientations[Vt.crossTileID]=Br),or};ws(()=>Ki(Ds,o.an.horizontal),()=>{const zi=pe.verticalTextBox;return d.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&zi?Ki(zi,o.an.vertical):{box:null,offscreen:null}}),Xr(Ci&&Ci.placeable)}else{let Ki=o.aD[(Ui=(xi=this.prevPlacement)===null||xi===void 0?void 0:xi.variableOffsets[Vt.crossTileID])===null||Ui===void 0?void 0:Ui.anchor];const zi=(or,qu,Df)=>{const Hh=or.x2-or.x1,fo=or.y2-or.y1,ma=Vt.textBoxScale,qs=ot&&ht==="never"?qu:null;let Sr=null,$s=et==="never"?1:2,Xh="never";Ki&&$s++;for(let dn=0;dn<$s;dn++){for(let Kh=un;Kh<Ln;Kh++){const Yh=d.textAnchorOffsets.get(Kh);if(Ki&&Yh.textAnchor!==Ki)continue;const po=this.attemptAnchorPlacement(Yh,or,Hh,fo,ma,dt,pt,R,Tt,T,Z,Xh,Vt,d,Df,b,M,qs,At);if(po&&(Sr=po.placedGlyphBoxes,Sr&&Sr.placeable))return Ti=!0,Pi=po.shift,Sr}Ki?Ki=null:Xh=et}return c&&!Sr&&(Sr={box:this.collisionIndex.placeCollisionBox(Ds,"always",R,Tt,T,pt,dt,b,Z.predicate,At,void 0,te).box,offscreen:!1,placeable:!1,occluded:!1}),Sr};ws(()=>zi(Ds,pe.iconBox,o.an.horizontal),()=>{const or=pe.verticalTextBox;return d.allowVerticalPlacement&&(!Ci||!Ci.placeable)&&Vt.numVerticalGlyphVertices>0&&or?zi(or,pe.verticalIconBox,o.an.vertical):{box:null,occluded:!0,offscreen:null}}),Ci&&(Ti=Ci.placeable,Ii=Ci.offscreen);const Br=Xr(Ci&&Ci.placeable);if(!Ti&&this.prevPlacement){const or=this.prevPlacement.variableOffsets[Vt.crossTileID];or&&(this.variableOffsets[Vt.crossTileID]=or,this.markUsedJustification(d,or.anchor,Vt,Br))}}}if(pi=Ci,Ti=pi&&pi.placeable,Ii=pi&&pi.offscreen,Vt.useRuntimeCollisionCircles){const Xr=d.text.placedSymbolArray.get(Vt.centerJustifiedTextSymbolIndex),ws=o.ao(d.textSizeData,G,Xr),un=_.get("text-padding");pr=this.collisionIndex.placeCollisionCircles(et,Xr,d.lineVertexArray,d.glyphOffsetArray,ws,T,I,c,pt,Z.predicate,Vt.collisionCircleDiameter,un,b,At),pr.circles.length&&pr.collisionDetected&&!c&&o.w("Collisions detected, but collision boxes are not shown"),Ti=st||pr.circles.length>0&&!pr.collisionDetected,Ii=Ii&&pr.offscreen}if(pe.iconFeatureIndex&&(cn=pe.iconFeatureIndex),pe.iconBox){const Xr=ws=>this.collisionIndex.placeCollisionBox(ws,ht,R,Tt,T,pt,dt,M,Z.predicate,At,ot&&Pi?Pi:void 0,te);wr&&wr.placeable&&pe.verticalIconBox?(Mr=Xr(pe.verticalIconBox),Vi=Mr.placeable):(Mr=Xr(pe.iconBox),Vi=Mr.placeable),Ii=Ii&&Mr.offscreen}const co=tt||Vt.numHorizontalGlyphVertices===0&&Vt.numVerticalGlyphVertices===0,uo=Q||Vt.numIconVertices===0;co||uo?uo?co||(Vi=Vi&&Ti):Ti=Vi&&Ti:Vi=Ti=Vi&&Ti;const pa=Vi&&Mr.placeable;if(Ti&&pi.placeable&&this.collisionIndex.insertCollisionBox(pi.box,et,_.get("text-ignore-placement"),d.bucketInstanceId,wr&&wr.placeable&&hn?hn:ln,Z.ID),pa&&this.collisionIndex.insertCollisionBox(Mr.box,ht,_.get("icon-ignore-placement"),d.bucketInstanceId,cn,Z.ID),pr&&Ti&&this.collisionIndex.insertCollisionCircles(pr.circles,et,_.get("text-ignore-placement"),d.bucketInstanceId,ln,Z.ID),c&&this.storeCollisionData(d.bucketInstanceId,ti,pe,pi,Mr,pr),Vt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Vt.crossTileID]=new za((Ti||It)&&!(pi!=null&&pi.occluded),(Vi||Mt)&&!(Mr!=null&&Mr.occluded),Ii||d.justReloaded),r[Vt.crossTileID]=!0};if(bt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Vt=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let pe=Vt.length-1;pe>=0;--pe){const ti=Vt[pe];Jt(d.symbolInstances.get(ti),d.collisionArrays[ti],ti)}}else for(let Vt=t.symbolInstanceStart;Vt<t.symbolInstanceEnd;Vt++)Jt(d.symbolInstances.get(Vt),d.collisionArrays[Vt],Vt);d.justReloaded=!1}storeCollisionData(t,r,c,d,_,b){if(c.textBox||c.iconBox){let M,T;this.collisionBoxArrays.has(t)?M=this.collisionBoxArrays.get(t):(M=new Map,this.collisionBoxArrays.set(t,M)),M.has(r)?T=M.get(r):(T={text:null,icon:null},M.set(r,T)),c.textBox&&(T.text=d.box),c.iconBox&&(T.icon=_.box)}if(b){let M=this.collisionCircleArrays[t];M===void 0&&(M=this.collisionCircleArrays[t]=[]);for(let T=0;T<b.circles.length;T+=4)M.push(b.circles[T+0]-Qi),M.push(b.circles[T+1]-Qi),M.push(b.circles[T+2]),M.push(b.collisionDetected?1:0)}}markUsedJustification(t,r,c,d){let _;_=d===o.an.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[o.aF(r)];const b=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const M of b)M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=_>=0&&M!==_?0:c.crossTileID)}markUsedOrientation(t,r,c){const d=r===o.an.horizontal||r===o.an.horizontalOnly?r:0,_=r===o.an.vertical?r:0,b=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const M of b)t.text.placedSymbolArray.get(M).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const d=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},b=r?r.variableOffsets:{},M=r?r.placedOrientations:{};for(const T in this.placements){const I=this.placements[T],R=_[T];R?(this.opacities[T]=new Ns(R,d,I.text,I.icon),c=c||I.text!==R.text.placed||I.icon!==R.icon.placed):(this.opacities[T]=new Ns(null,d,I.text,I.icon,I.skipFade),c=c||I.text||I.icon)}for(const T in _){const I=_[T];if(!this.opacities[T]){const R=new Ns(I,d,!1,!1);R.isHidden()||(this.opacities[T]=R,c=c||I.text.placed||I.icon.placed)}}for(const T in b)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=b[T]);for(const T in M)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=M[T]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const c={};for(const d of r){const _=d.getBucket(t);_&&d.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,d.tileID,c,d.collisionBoxArray)}}updateBucketOpacities(t,r,c,d){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],b=_.layout,M=new Ns(null,0,!1,!1,!0),T=b.get("text-allow-overlap"),I=b.get("icon-allow-overlap"),R=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=b.get("text-rotation-alignment")==="map",L=b.get("text-pitch-alignment")==="map",G=b.get("icon-text-fit")!=="none",Z=new Ns(null,0,T&&(I||!t.hasIconData()||b.get("icon-optional")),I&&(T||!t.hasTextData()||b.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const tt=(et,st,ht)=>{for(let at=0;at<st/4;at++)et.opacityVertexArray.emplaceBack(ht);et.hasVisibleVertices=et.hasVisibleVertices||ht!==Oa},Q=this.collisionBoxArrays.get(t.bucketInstanceId);for(let et=0;et<t.symbolInstances.length;et++){const st=t.symbolInstances.get(et),{numHorizontalGlyphVertices:ht,numVerticalGlyphVertices:at,crossTileID:dt}=st;let pt=this.opacities[dt];c[dt]?pt=M:pt||(pt=Z,this.opacities[dt]=pt),c[dt]=!0;const ot=st.numIconVertices>0,bt=this.placedOrientations[st.crossTileID],It=bt===o.an.vertical,Mt=bt===o.an.horizontal||bt===o.an.horizontalOnly;if(ht>0||at>0){const At=iu(pt.text);tt(t.text,ht,It?Oa:At),tt(t.text,at,Mt?Oa:At);const te=pt.text.isHidden();[st.rightJustifiedTextSymbolIndex,st.centerJustifiedTextSymbolIndex,st.leftJustifiedTextSymbolIndex].forEach(pe=>{pe>=0&&(t.text.placedSymbolArray.get(pe).hidden=te||It?1:0)}),st.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(st.verticalPlacedTextSymbolIndex).hidden=te||Mt?1:0);const Jt=this.variableOffsets[st.crossTileID];Jt&&this.markUsedJustification(t,Jt.anchor,st,bt);const Vt=this.placedOrientations[st.crossTileID];Vt&&(this.markUsedJustification(t,"left",st,Vt),this.markUsedOrientation(t,Vt,st))}if(ot){const At=iu(pt.icon),te=!(G&&st.verticalPlacedIconSymbolIndex&&It);st.placedIconSymbolIndex>=0&&(tt(t.icon,st.numIconVertices,te?At:Oa),t.icon.placedSymbolArray.get(st.placedIconSymbolIndex).hidden=pt.icon.isHidden()),st.verticalPlacedIconSymbolIndex>=0&&(tt(t.icon,st.numVerticalIconVertices,te?Oa:At),t.icon.placedSymbolArray.get(st.verticalPlacedIconSymbolIndex).hidden=pt.icon.isHidden())}const Tt=Q&&Q.has(et)?Q.get(et):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const At=t.collisionArrays[et];if(At){let te=new o.P(0,0);if(At.textBox||At.verticalTextBox){let Jt=!0;if(R){const Vt=this.variableOffsets[dt];Vt?(te=Yc(Vt.anchor,Vt.width,Vt.height,Vt.textOffset,Vt.textBoxScale),F&&te._rotate(L?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Jt=!1}if(At.textBox||At.verticalTextBox){let Vt;At.textBox&&(Vt=It),At.verticalTextBox&&(Vt=Mt),zo(t.textCollisionBox.collisionVertexArray,pt.text.placed,!Jt||Vt,Tt.text,te.x,te.y)}}if(At.iconBox||At.verticalIconBox){const Jt=!!(!Mt&&At.verticalIconBox);let Vt;At.iconBox&&(Vt=Jt),At.verticalIconBox&&(Vt=!Jt),zo(t.iconCollisionBox.collisionVertexArray,pt.icon.placed,Vt,Tt.icon,G?te.x:0,G?te.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function zo(g,t,r,c,d,_){c&&c.length!==0||(c=[0,0,0,0]);const b=c[0]-Qi,M=c[1]-Qi,T=c[2]-Qi,I=c[3]-Qi;g.emplaceBack(t?1:0,r?1:0,d||0,_||0,b,M),g.emplaceBack(t?1:0,r?1:0,d||0,_||0,T,M),g.emplaceBack(t?1:0,r?1:0,d||0,_||0,T,I),g.emplaceBack(t?1:0,r?1:0,d||0,_||0,b,I)}const Sn=Math.pow(2,25),tn=Math.pow(2,24),Jc=Math.pow(2,17),Qc=Math.pow(2,16),tu=Math.pow(2,9),Un=Math.pow(2,8),eu=Math.pow(2,1);function iu(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const t=g.placed?1:0,r=Math.floor(127*g.opacity);return r*Sn+t*tn+r*Jc+t*Qc+r*tu+t*Un+r*eu+t}const Oa=0;class of{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,c,d,_){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(b,d,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((M,T)=>M.sortKey-T.sortKey));this._currentPartIndex<b.length;)if(r.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,_())return!0;return!1}}class ru{constructor(t,r,c,d,_,b,M,T){this.placement=new La(t,r,b,M,T),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,r,c){const d=k.now(),_=()=>!this._forceFullPlacement&&k.now()-d>2;for(;this._currentPlacementIndex>=0;){const b=r[t[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=M)&&(!b.maxzoom||b.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new of(b)),this._inProgressLayer.continuePlacement(c[b.source],this.placement,this._showCollisionBoxes,b,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Vn=512/o.$/2;class rh{constructor(t,r,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const d=new Map;for(let _=0;_<r.length;_++){const b=r.get(_),M=b.key,T=d.get(M);T?T.push(b):d.set(M,[b])}for(const[_,b]of d){const M={positions:b.map(T=>({x:Math.floor(T.anchorX*Vn),y:Math.floor(T.anchorY*Vn)})),crossTileIDs:b.map(T=>T.crossTileID)};if(M.positions.length>128){const T=new o.aH(M.positions.length,16,Uint16Array);for(const{x:I,y:R}of M.positions)T.add(I,R);T.finish(),delete M.positions,M.index=T}this._symbolsByKey[_]=M}}getScaledCoordinates(t,r){const{x:c,y:d,z:_}=this.tileID.canonical,{x:b,y:M,z:T}=r.canonical,I=Vn/Math.pow(2,T-_),R=(M*o.$+t.anchorY)*I,F=d*o.$*Vn;return{x:Math.floor((b*o.$+t.anchorX)*I-c*o.$*Vn),y:Math.floor(R-F)}}findMatches(t,r,c){const d=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let _=0;_<t.length;_++){const b=t.get(_);if(b.crossTileID)continue;const M=this._symbolsByKey[b.key];if(!M)continue;const T=this.getScaledCoordinates(b,r);if(M.index){const I=M.index.range(T.x-d,T.y-d,T.x+d,T.y+d).sort();for(const R of I){const F=M.crossTileIDs[R];if(!c[F]){c[F]=!0,b.crossTileID=F;break}}}else if(M.positions)for(let I=0;I<M.positions.length;I++){const R=M.positions[I],F=M.crossTileIDs[I];if(Math.abs(R.x-T.x)<=d&&Math.abs(R.y-T.y)<=d&&!c[F]){c[F]=!0,b.crossTileID=F;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class sh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class su{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const c in this.indexes){const d=this.indexes[c],_={};for(const b in d){const M=d[b];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+r),_[M.tileID.key]=M}this.indexes[c]=_}this.lng=t}addBucket(t,r,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const d=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const b=this.indexes[_];if(Number(_)>t.overscaledZ)for(const M in b){const T=b[M];T.tileID.isChildOf(t)&&T.findMatches(r.symbolInstances,t,d)}else{const M=b[t.scaledTo(Number(_)).key];M&&M.findMatches(r.symbolInstances,t,d)}}for(let _=0;_<r.symbolInstances.length;_++){const b=r.symbolInstances.get(_);b.crossTileID||(b.crossTileID=c.generate(),d[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new rh(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const c of r.getCrossTileIDsLists())for(const d of c)delete this.usedCrossTileIDs[t][d]}removeStaleBuckets(t){let r=!1;for(const c in this.indexes){const d=this.indexes[c];for(const _ in d)t[d[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[_]),delete d[_],r=!0)}return r}}class Lo{constructor(){this.layerIndexes={},this.crossTileIDs=new sh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,c){let d=this.layerIndexes[t.id];d===void 0&&(d=this.layerIndexes[t.id]=new su);let _=!1;const b={};d.handleWrapJump(c);for(const M of r){const T=M.getBucket(t);T&&t.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(M.tileID,T,this.crossTileIDs)&&(_=!0),b[T.bucketInstanceId]=!0)}return d.removeStaleBuckets(b)&&(_=!0),_}pruneUnusedLayers(t){const r={};t.forEach(c=>{r[c]=!0});for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}var Oo="void main() {fragColor=vec4(1.0);}";const Is={prelude:ri(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ri("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ri("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ri(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ri(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ri(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ri(Oo,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ri(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ri("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ri("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(textureSize(u_elevation_stops,0)[0]);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int num_elevation_stops=textureSize(u_elevation_stops,0)[0];int r=(num_elevation_stops-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(textureSize(u_color_stops,0)[0]);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ri(Oo,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ri(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ri(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ri(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ri(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ri(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ri(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:
basic_hillshade(deriv);break;case COMBINED:
combined_hillshade(deriv);break;case IGOR:
igor_hillshade(deriv);break;case MULTIDIRECTIONAL:
multidirectional_hillshade(deriv);break;case STANDARD:
default:
standard_hillshade(deriv);break;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ri(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ri(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ri(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ri(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ri(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ri("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ri("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ri("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ri("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ri(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ri("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ri(g,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/in ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=_?_.concat(d):d,M={};return{fragmentSource:g=g.replace(r,(T,I,R,F,L)=>(M[L]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${R} ${F} ${L};
#else
uniform ${R} ${F} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${R} ${F} ${L} = u_${L};
#endif
`)),vertexSource:t=t.replace(r,(T,I,R,F,L)=>{const G=F==="float"?"vec2":"vec4",Z=L.match(/color/)?"color":G;return M[L]?I==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${R} ${G} a_${L};
out ${R} ${F} ${L};
#else
uniform ${R} ${F} u_${L};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${R} ${F} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${Z}(a_${L}, u_${L}_t);
#else
    ${R} ${F} ${L} = u_${L};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${R} ${G} a_${L};
#else
uniform ${R} ${F} u_${L};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${R} ${F} ${L} = a_${L};
#else
    ${R} ${F} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${R} ${F} ${L} = unpack_mix_${Z}(a_${L}, u_${L}_t);
#else
    ${R} ${F} ${L} = u_${L};
#endif
`}),staticAttributes:c,staticUniforms:b}}class Gs{constructor(t,r,c){this.vertexBuffer=t,this.indexBuffer=r,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var js=o.aI([{name:"a_pos",type:"Int16",components:2}]);const Tn="#define PROJECTION_MERCATOR",nh="mercator";class ah{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return nh}get shaderDefine(){return Tn}get shaderPreludeCode(){return Is.projectionMercator}get vertexShaderPreludeCode(){return Is.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,r,c,d,_){if(this._cachedMesh)return this._cachedMesh;const b=new o.aK;b.emplaceBack(0,0),b.emplaceBack(o.$,0),b.emplaceBack(0,o.$),b.emplaceBack(o.$,o.$);const M=t.createVertexBuffer(b,js.members),T=o.aL.simpleSegment(0,0,4,2),I=new o.aM;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3);const R=t.createIndexBuffer(I);return this._cachedMesh=new Gs(M,R,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class hs{constructor(t=0,r=0,c=0,d=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=c,this.right=d}interpolate(t,r,c){return r.top!=null&&t.top!=null&&(this.top=o.C.number(t.top,r.top,c)),r.bottom!=null&&t.bottom!=null&&(this.bottom=o.C.number(t.bottom,r.bottom,c)),r.left!=null&&t.left!=null&&(this.left=o.C.number(t.left,r.left,c)),r.right!=null&&t.right!=null&&(this.right=o.C.number(t.right,r.right,c)),this}getCenter(t,r){const c=o.ag((this.left+t-this.right)/2,0,t),d=o.ag((this.top+r-this.bottom)/2,0,r);return new o.P(c,d)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new hs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Us(g,t){if(!g.renderWorldCopies||g.lngRange)return;const r=t.lng-g.center.lng;t.lng+=r>180?-360:r<-180?360:0}function si(g){return Math.max(0,Math.floor(g))}class Fa{constructor(t,r,c,d,_,b){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=d??0,this._maxPitch=_??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=si(this._zoom),this._scale=o.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new hs,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,r,c){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=si(this._zoom),this._scale=o.ae(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new hs(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!c&&t.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const r=o.aN(t,-180,180)*Math.PI/180;var c,d,_,b,M,T,I,R,F;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=A(),c=this._rotationMatrix,_=-this._bearingInRadians,b=(d=this._rotationMatrix)[0],M=d[1],T=d[2],I=d[3],R=Math.sin(_),F=Math.cos(_),c[0]=b*F+T*R,c[1]=M*F+I*R,c[2]=b*-R+T*F,c[3]=M*-R+I*F)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const r=o.ag(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const r=t/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aO(this._fovInRadians)}setFov(t){t=o.ag(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=o.ad(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const r=this.getConstrained(this._center,t).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=o.ae(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,r){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,c){this._unmodified=!1,this._edgeInsets.interpolate(t,r,c),this._constrain(),this._calcMatrices()}resize(t,r,c=!0){this._width=t,this._height=r,c&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Me([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,o.ah])}getConstrained(t,r){return this._callbacks.getConstrained(t,r)}getCameraQueryGeometry(t,r){if(r.length===1)return[r[0],t];{const{minX:c,minY:d,maxX:_,maxY:b}=o.a1.fromPoints(r).extend(t);return[new o.P(c,d),new o.P(_,d),new o.P(_,b),new o.P(c,b),new o.P(c,d)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:r,zoom:c}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(c),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=o.af(new Float64Array(16));o.N(t,t,[this._width/2,-this._height/2,1]),o.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=o.af(new Float64Array(16)),o.N(t,t,[1,-1,1]),o.M(t,t,[-1,-1,0]),o.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,r,c,d){const _=c!==void 0?c:this.bearing,b=d=d!==void 0?d:this.pitch,M=o.a0.fromLngLat(t,r),T=-Math.cos(o.ad(b)),I=Math.sin(o.ad(b)),R=I*Math.sin(o.ad(_)),F=-I*Math.cos(o.ad(_));let L=this.elevation;const G=r-L;let Z;T*G>=0||Math.abs(T)<.1?(Z=1e4,L=r+Z*T):Z=-G/T;let tt,Q,et=o.aP(1,M.y),st=0;do{if(st+=1,st>10)break;Q=Z/et,tt=new o.a0(M.x+R*Q,M.y+F*Q),et=1/tt.meterInMercatorCoordinateUnits()}while(Math.abs(Z-Q*et)>1e-12);return{center:tt.toLngLat(),elevation:L,zoom:o.aj(this.height/2/Math.tan(this.fovInRadians/2)/Q/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const r=o.ai(1,this.center.lat)*this.worldSize,c=this.cameraToCenterDistance/r,d=o.a0.fromLngLat(this.center,this.elevation),_=nt(this.center,this.elevation,this.pitch,this.bearing,c);this._elevation=t;const b=this.calculateCenterFromCameraLngLatAlt(_.toLngLat(),o.aP(_.z,d.y),this.bearing,this.pitch);this._elevation=b.elevation,this._center=b.center,this.setZoom(b.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=o.ai(1,this.center.lat)*this.worldSize;return nt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const r=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/r,t.canonical.y/r,1/r/o.$,1/r/o.$]}}class Fo{constructor(t,r){this.min=t,this.max=r,this.center=o.aQ([],o.aR([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],c=o.aS(this.min),d=o.aS(this.max);for(let _=0;_<r.length;_++)c[_]=r[_]?this.min[_]:this.center[_],d[_]=r[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new Fo(c,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let r=!0;for(let c=0;c<t.planes.length;c++){const d=this.intersectsPlane(t.planes[c]);if(d===0)return 0;d===1&&(r=!1)}return r?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let r=t[3],c=t[3];for(let d=0;d<3;d++)t[d]>0?(r+=t[d]*this.min[d],c+=t[d]*this.max[d]):(c+=t[d]*this.min[d],r+=t[d]*this.max[d]);return r>=0?2:c<0?0:1}}class oh{distanceToTile2d(t,r,c,d){const _=d.distanceX([t,r]),b=d.distanceY([t,r]);return Math.hypot(_,b)}getWrap(t,r,c){return c}getTileBoundingVolume(t,r,c,d){var _,b;let M=c,T=c;if(d!=null&&d.terrain){const R=new o.Z(t.z,r,t.z,t.x,t.y),F=d.terrain.getMinMaxElevation(R);M=(_=F.minElevation)!==null&&_!==void 0?_:c,T=(b=F.maxElevation)!==null&&b!==void 0?b:c}const I=1<<t.z;return new Fo([r+t.x/I,t.y/I,M],[r+(t.x+1)/I,(t.y+1)/I,T])}allowVariableZoom(t,r){const c=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,d=o.ag(78.5-c/2,0,60);return!!r.terrain||t.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class Cr{constructor(t,r,c){this.points=t,this.planes=r,this.aabb=c}static fromInvProjectionMatrix(t,r=1,c=0,d,_){const b=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],M=Math.pow(2,c),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>function(G,Z,tt,Q){const et=o.av([],G,Z),st=1/et[3]/tt*Q;return o.aX(et,et,[st,st,1/et[3],st])}(L,t,r,M));d&&function(L,G,Z,tt){const Q=tt?4:0,et=tt?0:4;let st=0;const ht=[],at=[];for(let ot=0;ot<4;ot++){const bt=o.aT([],L[ot+et],L[ot+Q]),It=o.aY(bt);o.aQ(bt,bt,1/It),ht.push(It),at.push(bt)}for(let ot=0;ot<4;ot++){const bt=o.aZ(L[ot+Q],at[ot],Z);st=bt!==null&&bt>=0?Math.max(st,bt):Math.max(st,ht[ot])}const dt=function(ot,bt){const It=o.aT([],ot[bt[0]],ot[bt[1]]),Mt=o.aT([],ot[bt[2]],ot[bt[1]]),Tt=[0,0,0,0];return o.aU(Tt,o.aV([],It,Mt)),Tt[3]=-o.aW(Tt,ot[bt[0]]),Tt}(L,G),pt=function(ot,bt){const It=o.a_(ot),Mt=o.a$([],ot,1/It),Tt=o.aT([],bt,o.aQ([],Mt,o.aW(bt,Mt))),At=o.a_(Tt);if(At>0){const te=Math.sqrt(1-Mt[3]*Mt[3]),Jt=o.aQ([],Mt,-Mt[3]),Vt=o.aR([],Jt,o.aQ([],Tt,te/At));return o.b0(bt,Vt)}return null}(Z,dt);if(pt!==null){const ot=pt/o.aW(at[0],dt);st=Math.min(st,ot)}for(let ot=0;ot<4;ot++){const bt=Math.min(st,ht[ot]);L[ot+et]=[L[ot+Q][0]+at[ot][0]*bt,L[ot+Q][1]+at[ot][1]*bt,L[ot+Q][2]+at[ot][2]*bt,1]}}(T,b[0],d,_);const I=b.map(L=>{const G=o.aT([],T[L[0]],T[L[1]]),Z=o.aT([],T[L[2]],T[L[1]]),tt=o.aU([],o.aV([],G,Z)),Q=-o.aW(tt,T[L[1]]);return tt.concat(Q)}),R=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],F=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const L of T)for(let G=0;G<3;G++)R[G]=Math.min(R[G],L[G]),F[G]=Math.max(F[G],L[G]);return new Cr(T,I,new Fo(R,F))}}class rr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,c){return this._helper.interpolatePadding(t,r,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,c=!0){this._helper.resize(t,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,r){}constructor(t,r,c,d,_){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Fa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(b,M)=>this.getConstrained(b,M)},t,r,c,d,_),this._coveringTilesDetailsProvider=new oh}clone(){const t=new rr;return t.apply(this),t}apply(t,r,c){this._helper.apply(t,r,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const r=[new o.b1(0,t)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new o.P(0,0)),d=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),b=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),M=Math.floor(Math.min(c.x,d.x,_.x,b.x)),T=Math.floor(Math.max(c.x,d.x,_.x,b.x)),I=1;for(let R=M-I;R<=T+I;R++)R!==0&&r.push(new o.b1(R,t))}return r}getCameraFrustum(){return Cr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const r=this.screenPointToLocation(this.centerPoint,t),c=t?t.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(t,r){const c=o.ai(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(r,c),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),b=o.a0.fromLngLat(t),M=new o.a0(b.x-(d.x-_.x),b.y-(d.y-_.y));this.setCenter(M==null?void 0:M.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,r){return r?this.coordinatePoint(o.a0.fromLngLat(t),r.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a0.fromLngLat(t))}screenPointToLocation(t,r){var c;return(c=this.screenPointToMercatorCoordinate(t,r))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(t,r){if(r){const c=r.pointCoordinate(t);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,r){const c=r||0,d=[t.x,t.y,0,1],_=[t.x,t.y,1,1];o.av(d,d,this._pixelMatrixInverse),o.av(_,_,this._pixelMatrixInverse);const b=d[3],M=_[3],T=d[1]/b,I=_[1]/M,R=d[2]/b,F=_[2]/M,L=R===F?0:(c-R)/(F-R);return new o.a0(o.C.number(d[0]/b,_[0]/M,L)/this.worldSize,o.C.number(T,I,L)/this.worldSize,c)}coordinatePoint(t,r=0,c=this._pixelMatrix){const d=[t.x*this.worldSize,t.y*this.worldSize,r,1];return o.av(d,d,c),new o.P(d[0]/d[3],d[1]/d[3])}getBounds(){const t=Math.max(0,this._helper._height/2-H(this));return new Me().extend(this.screenPointToLocation(new o.P(0,t))).extend(this.screenPointToLocation(new o.P(this._helper._width,t))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(t,r){return r?r.pointCoordinate(t)!=null:t.y>this.height/2-H(this)}calculatePosMatrix(t,r=!1,c){var d;const _=(d=t.key)!==null&&d!==void 0?d:o.b2(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),b=r?this._alignedPosMatrixCache:this._posMatrixCache;if(b.has(_)){const I=b.get(_);return c?I.f32:I.f64}const M=Y(t,this.worldSize);o.O(M,r?this._alignedProjMatrix:this._viewProjMatrix,M);const T={f64:M,f32:new Float32Array(M)};return b.set(_,T),c?T.f32:T.f64}calculateFogMatrix(t){const r=t.key,c=this._fogMatrixCacheF32;if(c.has(r))return c.get(r);const d=Y(t,this.worldSize);return o.O(d,this._fogMatrix,d),c.set(r,new Float32Array(d)),c.get(r)}getConstrained(t,r){r=o.ag(+r,this.minZoom,this.maxZoom);const c={center:new o.S(t.lng,t.lat),zoom:r};let d=this._helper._lngRange;this._helper._renderWorldCopies||d!==null||(d=[-179.9999999999,180-1e-10]);const _=this.tileSize*o.ae(c.zoom);let b=0,M=_,T=0,I=_,R=0,F=0;const{x:L,y:G}=this.size;if(this._helper._latRange){const ht=this._helper._latRange;b=o.U(ht[1])*_,M=o.U(ht[0])*_,M-b<G&&(R=G/(M-b))}d&&(T=o.aN(o.V(d[0])*_,0,_),I=o.aN(o.V(d[1])*_,0,_),I<T&&(I+=_),I-T<L&&(F=L/(I-T)));const{x:Z,y:tt}=_t(_,t);let Q,et;const st=Math.max(F||0,R||0);if(st){const ht=new o.P(F?(I+T)/2:Z,R?(M+b)/2:tt);return c.center=$(_,ht).wrap(),c.zoom+=o.aj(st),c}if(this._helper._latRange){const ht=G/2;tt-ht<b&&(et=b+ht),tt+ht>M&&(et=M-ht)}if(d){const ht=(T+I)/2;let at=Z;this._helper._renderWorldCopies&&(at=o.aN(Z,ht-_/2,ht+_/2));const dt=L/2;at-dt<T&&(Q=T+dt),at+dt>I&&(Q=I-dt)}if(Q!==void 0||et!==void 0){const ht=new o.P(Q??Z,et??tt);c.center=$(_,ht).wrap()}return c}calculateCenterFromCameraLngLatAlt(t,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,c,d)}_calculateNearFarZIfNeeded(t,r,c){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-d*this._helper._pixelPerMeter/Math.cos(r),b=d<0?_:t,M=Math.PI/2+this.pitchInRadians,T=o.ad(this.fov)*(Math.abs(Math.cos(o.ad(this.roll)))*this.height+Math.abs(Math.sin(o.ad(this.roll)))*this.width)/this.height*(.5+c.y/this.height),I=Math.sin(T)*b/Math.sin(o.ag(Math.PI-M-T,.01,Math.PI-.01)),R=H(this),F=Math.atan(R/this._helper.cameraToCenterDistance),L=o.ad(.75),G=F>L?2*F*(.5+c.y/(2*R)):L,Z=Math.sin(G)*b/Math.sin(o.ag(Math.PI-M-G,.01,Math.PI-.01)),tt=Math.min(I,Z);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*tt+b),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,r=_t(this.worldSize,this.center),c=r.x,d=r.y;this._helper._pixelPerMeter=o.ai(1,this.center.lat)*this.worldSize;const _=o.ad(Math.min(this.pitch,fi)),b=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let M;this._calculateNearFarZIfNeeded(b,_,t),M=new Float64Array(16),o.b3(M,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.ap(this._invProjMatrix,M),M[8]=2*-t.x/this._helper._width,M[9]=2*t.y/this._helper._height,this._projectionMatrix=o.b4(M),o.N(M,M,[1,-1,1]),o.M(M,M,[0,0,-this._helper.cameraToCenterDistance]),o.b5(M,M,-this.rollInRadians),o.b6(M,M,this.pitchInRadians),o.b5(M,M,-this.bearingInRadians),o.M(M,M,[-c,-d,0]),this._mercatorMatrix=o.N([],M,[this.worldSize,this.worldSize,this.worldSize]),o.N(M,M,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,M),o.M(M,M,[0,0,-this.elevation]),this._viewProjMatrix=M,this._invViewProjMatrix=o.ap([],M);const T=[0,0,-1,1];o.av(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),o.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,b,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-c,-d,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,M);const I=this._helper._width%2/2,R=this._helper._height%2/2,F=Math.cos(this.bearingInRadians),L=Math.sin(-this.bearingInRadians),G=c-Math.round(c)+F*I+L*R,Z=d-Math.round(d)+F*R+L*I,tt=new Float64Array(M);if(o.M(tt,tt,[G>.5?G-1:G,Z>.5?Z-1:Z,0]),this._alignedProjMatrix=tt,M=o.ap(new Float64Array(16),this._pixelMatrix),!M)throw new Error("failed to invert matrix");this._pixelMatrixInverse=M,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new o.P(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.av(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=o.ai(1,this.center.lat)*this.worldSize;return nt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,r){const c=o.a0.fromLngLat(t),d=[c.x*this.worldSize,c.y*this.worldSize,r,1];return o.av(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(t){const{overscaledTileID:r,aligned:c,applyTerrainMatrix:d}=t,_=this._helper.getMercatorTileCoordinates(r),b=r?this.calculatePosMatrix(r,c,!0):null;let M;return M=r&&r.terrainRttPosMatrix32f&&d?r.terrainRttPosMatrix32f:b||o.b7(),{mainMatrix:M,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:M}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,r,c){return 1}transformLightDirection(t){return o.aS(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,r,c,d){const _=this.calculatePosMatrix(c);let b;d?(b=[t,r,d(t,r),1],o.av(b,b,_)):(b=[t,r,0,1],Mn(b,b,_));const M=b[3];return{point:new o.P(b[0]/M,b[1]/M),signedDistanceFromCamera:M,isOccluded:!1}}populateCache(t){for(const r of t)this.calculatePosMatrix(r)}getMatrixForModel(t,r){const c=o.a0.fromLngLat(t,r),d=c.meterInMercatorCoordinateUnits(),_=o.b8();return o.M(_,_,[c.x,c.y,c.z]),o.b5(_,_,Math.PI),o.b6(_,_,Math.PI/2),o.N(_,_,[-d,d,d]),_}getProjectionDataForCustomLayer(t=!0){const r=new o.Z(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:t}),d=Y(r,this.worldSize);o.O(d,this._viewProjMatrix,d),c.tileMercatorCoords=[0,0,1,1];const _=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],b=o.b9();return o.N(b,d,_),c.fallbackMatrix=b,c.mainMatrix=b,c}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Ar(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function dr(g){if(g.useSlerp)if(g.k<1){const t=o.ba(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),r=o.ba(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),c=new Float64Array(4);o.bb(c,t,r,g.k);const d=o.bc(c);g.tr.setRoll(d.roll),g.tr.setPitch(d.pitch),g.tr.setBearing(d.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(o.C.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(o.C.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(o.C.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function Gi(g,t,r,c,d){const _=d.padding,b=_t(d.worldSize,r.getNorthWest()),M=_t(d.worldSize,r.getNorthEast()),T=_t(d.worldSize,r.getSouthEast()),I=_t(d.worldSize,r.getSouthWest()),R=o.ad(-c),F=b.rotate(R),L=M.rotate(R),G=T.rotate(R),Z=I.rotate(R),tt=new o.P(Math.max(F.x,L.x,Z.x,G.x),Math.max(F.y,L.y,Z.y,G.y)),Q=new o.P(Math.min(F.x,L.x,Z.x,G.x),Math.min(F.y,L.y,Z.y,G.y)),et=tt.sub(Q),st=(d.width-(_.left+_.right+t.left+t.right))/et.x,ht=(d.height-(_.top+_.bottom+t.top+t.bottom))/et.y;if(ht<0||st<0)return void Ar();const at=Math.min(o.aj(d.scale*Math.min(st,ht)),g.maxZoom),dt=o.P.convert(g.offset),pt=new o.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(o.ad(c)),ot=dt.add(pt).mult(d.scale/o.ae(at));return{center:$(d.worldSize,b.add(T).div(2).sub(ot)),zoom:at,bearing:c}}class Bo{get useGlobeControls(){return!1}handlePanInertia(t,r){return{easingOffset:t,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(t,r){t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta),t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta)}handleMapControlsPan(t,r,c){t.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(c,t.around)}cameraForBoxAndBearing(t,r,c,d,_){return Gi(t,r,c,d,_)}handleJumpToCenterZoom(t,r){t.zoom!==(r.zoom!==void 0?+r.zoom:t.zoom)&&t.setZoom(+r.zoom),r.center!==void 0&&t.setCenter(o.S.convert(r.center))}handleEaseTo(t,r){const c=t.zoom,d=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},M=r.zoom!==void 0,T=!t.isPaddingEqual(r.padding);let I=!1;const R=M?+r.zoom:t.zoom;let F=t.centerPoint.add(r.offsetAsPoint);const L=t.screenPointToLocation(F),{center:G,zoom:Z}=t.getConstrained(o.S.convert(r.center||L),R??c);Us(t,G);const tt=_t(t.worldSize,L),Q=_t(t.worldSize,G).sub(tt),et=o.ae(Z-c);return I=Z!==c,{easeFunc:st=>{if(I&&t.setZoom(o.C.number(c,Z,st)),o.bd(_,b)||dr({startEulerAngles:_,endEulerAngles:b,tr:t,k:st,useSlerp:_.roll!=b.roll}),T&&(t.interpolatePadding(d,r.padding,st),F=t.centerPoint.add(r.offsetAsPoint)),r.around)t.setLocationAtPoint(r.around,r.aroundPoint);else{const ht=o.ae(t.zoom-c),at=Z>c?Math.min(2,et):Math.max(.5,et),dt=Math.pow(at,1-st),pt=$(t.worldSize,tt.add(Q.mult(st*dt)).mult(ht));t.setLocationAtPoint(t.renderWorldCopies?pt.wrap():pt,F)}},isZooming:I,elevationCenter:G}}handleFlyTo(t,r){const c=r.zoom!==void 0,d=t.zoom,_=t.getConstrained(o.S.convert(r.center||r.locationAtOffset),c?+r.zoom:d),b=_.center,M=_.zoom;Us(t,b);const T=_t(t.worldSize,r.locationAtOffset),I=_t(t.worldSize,b).sub(T),R=I.mag(),F=o.ae(M-d);let L;if(r.minZoom!==void 0){const G=Math.min(+r.minZoom,d,M),Z=t.getConstrained(b,G).zoom;L=o.ae(Z-d)}return{easeFunc:(G,Z,tt,Q)=>{t.setZoom(G===1?M:d+o.aj(Z));const et=G===1?b:$(t.worldSize,T.add(I.mult(tt)).mult(Z));t.setLocationAtPoint(t.renderWorldCopies?et.wrap():et,Q)},scaleOfZoom:F,targetCenter:b,scaleOfMinZoom:L,pixelPathLength:R}}}class ci{constructor(t,r,c){this.blendFunction=t,this.blendColor=r,this.mask=c}}ci.Replace=[1,0],ci.disabled=new ci(ci.Replace,o.be.transparent,[!1,!1,!1,!1]),ci.unblended=new ci(ci.Replace,o.be.transparent,[!0,!0,!0,!0]),ci.alphaBlended=new ci([1,771],o.be.transparent,[!0,!0,!0,!0]);const Zr=2305;class He{constructor(t,r,c){this.enable=t,this.mode=r,this.frontFace=c}}He.disabled=new He(!1,1029,Zr),He.backCCW=new He(!0,1029,Zr),He.frontCCW=new He(!0,1028,Zr);class Qe{constructor(t,r,c){this.func=t,this.mask=r,this.range=c}}Qe.ReadOnly=!1,Qe.ReadWrite=!0,Qe.disabled=new Qe(519,Qe.ReadOnly,[0,1]);const Pn=7680;class Fe{constructor(t,r,c,d,_,b){this.test=t,this.ref=r,this.mask=c,this.fail=d,this.depthFail=_,this.pass=b}}Fe.disabled=new Fe({func:519,mask:0},0,0,Pn,Pn,Pn);const En=new WeakMap;function zr(g){var t;if(En.has(g))return En.get(g);{const r=(t=g.getParameter(g.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return En.set(g,r),r}}class qn{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const r=t.context,c=r.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const d=new o.aK;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const _=new o.aM;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Gs(r.createVertexBuffer(d,js.members),r.createIndexBuffer(_),o.aL.simpleSegment(0,0,d.length,_.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(c.TEXTURE1);const b=c.createTexture();c.bindTexture(c.TEXTURE_2D,b),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(b),zr(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,r){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,r=t.gl;t.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,r){const c=this._cachedRenderContext.context,d=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:o.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,d.TRIANGLES,Qe.disabled,Fe.disabled,ci.unblended,He.disabled,((_,b)=>({u_input:_,u_output_expected:b}))(t,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&zr(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const _=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&zr(t)){const r=t.clientWaitSync(this._readbackQueue.sync,0,0);if(r===t.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=qn._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let r=0;return r+=t[0]/256,r+=t[1]/65536,r+=t[2]/16777216,t[3]<127&&(r=-r),r/128}}const cs=o.$/128;function lh(g,t){const r=g.granularity!==void 0?Math.max(g.granularity,1):1,c=r+(g.generateBorders?2:0),d=r+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),_=c+1,b=d+1,M=g.generateBorders?-1:0,T=g.generateBorders||g.extendToNorthPole?-1:0,I=r+(g.generateBorders?1:0),R=r+(g.generateBorders||g.extendToSouthPole?1:0),F=_*b,L=c*d*6,G=_*b>65536;if(G&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Z=G||t==="32bit",tt=new Int16Array(2*F);let Q=0;for(let ht=T;ht<=R;ht++)for(let at=M;at<=I;at++){let dt=at/r*o.$;at===-1&&(dt=-64),at===r+1&&(dt=o.$+cs);let pt=ht/r*o.$;ht===-1&&(pt=g.extendToNorthPole?o.bg:-64),ht===r+1&&(pt=g.extendToSouthPole?o.bh:o.$+cs),tt[Q++]=dt,tt[Q++]=pt}const et=Z?new Uint32Array(L):new Uint16Array(L);let st=0;for(let ht=0;ht<d;ht++)for(let at=0;at<c;at++){const dt=at+1+ht*_,pt=at+(ht+1)*_,ot=at+1+(ht+1)*_;et[st++]=at+ht*_,et[st++]=pt,et[st++]=dt,et[st++]=dt,et[st++]=pt,et[st++]=ot}return{vertices:tt.buffer.slice(0),indices:et.buffer.slice(0),uses32bitIndices:Z}}const Cs=new o.aJ({fill:new o.bi(128,2),line:new o.bi(512,0),tile:new o.bi(128,32),stencil:new o.bi(128,1),circle:3});class nu{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Is.projectionGlobe}get vertexShaderPreludeCode(){return Is.projectionMercator.vertexSource}get subdivisionGranularity(){return Cs}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new qn(t));const r=o.U(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(r,c),_=k.now();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=_);const b=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bk(b))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,r,c,d,_){const b=(_==="stencil"?Cs.stencil:Cs.tile).getGranularityForZoomLevel(r.z);return this._getMesh(t,{granularity:b,generateBorders:c,extendToNorthPole:r.y===0&&d,extendToSouthPole:r.y===(1<<r.z)-1&&d})}_getMesh(t,r){const c=this._getMeshKey(r);if(c in this._tileMeshCache)return this._tileMeshCache[c];const d=function(_,b){const M=lh(b,"16bit"),T=o.aK.deserialize({arrayBuffer:M.vertices,length:M.vertices.byteLength/2/2}),I=o.aM.deserialize({arrayBuffer:M.indices,length:M.indices.byteLength/2/3});return new Gs(_.createVertexBuffer(T,js.members),_.createIndexBuffer(I),o.aL.simpleSegment(0,0,T.length,I.length))}(t,r);return this._tileMeshCache[c]=d,d}recalculate(t){}hasTransition(){const t=k.now();let r=!1;return r=r||(t-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const au=new o.r({type:new o.D(o.v.projection.type)});class Ba extends o.E{constructor(t){super(),this._transitionable=new o.t(au),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new ah,this._verticalPerspectiveProjection=new nu}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof o.bl){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,r,c,d,_){return this.currentProjection.getMeshFromTileID(t,r,c,d,_)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Na(g){const t=$n(g.worldSize,g.center.lat);return 2*Math.PI*t}function vs(g,t,r,c,d){const _=1/(1<<d),b=t/o.$*_+c*_,M=o.bn((g/o.$*_+r*_)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI,I=Math.cos(T),R=new Float64Array(3);return R[0]=Math.sin(M)*I,R[1]=Math.sin(T),R[2]=Math.cos(M)*I,R}function fr(g){return function(t,r){const c=Math.cos(r),d=new Float64Array(3);return d[0]=Math.sin(t)*c,d[1]=Math.sin(r),d[2]=Math.cos(t)*c,d}(g.lng*Math.PI/180,g.lat*Math.PI/180)}function $n(g,t){return g/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Ga(g){const t=Math.asin(g[1])/Math.PI*180,r=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(r>1e-6){const c=g[0]/r,d=Math.acos(g[2]/r),_=(c>0?d:-d)/Math.PI*180;return new o.S(o.aN(_,-180,180),t)}return new o.S(0,t)}function Zn(g){return Math.cos(g*Math.PI/180)}function sr(g,t){const r=Zn(g),c=Zn(t);return o.aj(c/r)}function ja(g,t){const r=g.rotate(t.bearingInRadians),c=t.zoom+sr(t.center.lat,0),d=o.bj(1/Zn(t.center.lat),1/Zn(Math.min(Math.abs(t.center.lat),60)),o.bm(c,7,3,0,1)),_=360/Na({worldSize:t.worldSize,center:{lat:t.center.lat}});return new o.S(t.center.lng-r.x*_*d,o.ag(t.center.lat+r.y*_,-85.051129,o.ah))}function Wn(g){const t=.5*g,r=Math.sin(t),c=Math.cos(t);return Math.log(r+c)-Math.log(c-r)}function Hn(g,t,r,c){const d=g.lat+r*c;if(Math.abs(r)>1){const _=(Math.sign(g.lat+r)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,b=Math.abs(g.lat+r)*Math.PI/180,M=Wn(_+c*(b-_)),T=Wn(_),I=Wn(b);return new o.S(g.lng+t*((M-T)/(I-T)),d)}return new o.S(g.lng+t*c,d)}class lf{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,r,c,d){const _=`${t.z}_${t.x}_${t.y}_${d!=null&&d.terrain?"t":""}`,b=this._cache.get(_);if(b)return b;const M=this._cachePrevious.get(_);if(M)return this._cache.set(_,M),M;const T=this._boundingVolumeFactory(t,r,c,d);return this._cache.set(_,T),this._hadAnyChanges=!0,T}}class en{constructor(t,r,c,d){this.min=c,this.max=d,this.points=t,this.planes=r}static fromAabb(t,r){const c=[];for(let d=0;d<8;d++)c.push([1&~d?t[0]:r[0],(d>>1&1)==1?r[1]:t[1],(d>>2&1)==1?r[2]:t[2]]);return new en(c,[[-1,0,0,r[0]],[1,0,0,-t[0]],[0,-1,0,r[1]],[0,1,0,-t[1]],[0,0,-1,r[2]],[0,0,1,-t[2]]],t,r)}static fromCenterSizeAngles(t,r,c){const d=o.bq([],c[0],c[1],c[2]),_=o.br([],[r[0],0,0],d),b=o.br([],[0,r[1],0],d),M=o.br([],[0,0,r[2]],d),T=[...t],I=[...t];for(let F=0;F<8;F++)for(let L=0;L<3;L++){const G=t[L]+_[L]*(1&~F?-1:1)+b[L]*((F>>1&1)==1?1:-1)+M[L]*((F>>2&1)==1?1:-1);T[L]=Math.min(T[L],G),I[L]=Math.max(I[L],G)}const R=[];for(let F=0;F<8;F++){const L=[...t];o.aR(L,L,o.aQ([],_,1&~F?-1:1)),o.aR(L,L,o.aQ([],b,(F>>1&1)==1?1:-1)),o.aR(L,L,o.aQ([],M,(F>>2&1)==1?1:-1)),R.push(L)}return new en(R,[[..._,-o.aW(_,R[0])],[...b,-o.aW(b,R[0])],[...M,-o.aW(M,R[0])],[-_[0],-_[1],-_[2],-o.aW(_,R[7])],[-b[0],-b[1],-b[2],-o.aW(b,R[7])],[-M[0],-M[1],-M[2],-o.aW(M,R[7])]],T,I)}intersectsFrustum(t){let r=!0;const c=this.points.length,d=this.planes.length,_=t.planes.length,b=t.points.length;for(let M=0;M<_;M++){const T=t.planes[M];let I=0;for(let R=0;R<c;R++){const F=this.points[R];T[0]*F[0]+T[1]*F[1]+T[2]*F[2]+T[3]>=0&&I++}if(I===0)return 0;I<c&&(r=!1)}if(r)return 2;for(let M=0;M<d;M++){const T=this.planes[M];let I=0;for(let R=0;R<b;R++){const F=t.points[R];T[0]*F[0]+T[1]*F[1]+T[2]*F[2]+T[3]>=0&&I++}if(I===0)return 0}return 1}intersectsPlane(t){const r=this.points.length;let c=0;for(let d=0;d<r;d++){const _=this.points[d];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&c++}return c===r?2:c===0?0:1}}function Ua(g,t,r){const c=g-t;return c<0?-c:Math.max(0,c-r)}function hh(g,t,r,c,d){const _=g-r;let b;return b=_<0?Math.min(-_,1+_-d):_>1?Math.min(Math.max(_-d,0),1-_):0,Math.max(b,Ua(t,c,d))}class hf{constructor(){this._boundingVolumeCache=new lf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,r,c,d){const _=1<<c.z,b=1/_,M=c.x/_,T=c.y/_;let I=2;return I=Math.min(I,hh(t,r,M,T,b)),I=Math.min(I,hh(t,r,M+.5,-T-b,b)),I=Math.min(I,hh(t,r,M+.5,2-T-b,b)),I}getWrap(t,r,c){const d=1<<r.z,_=1/d,b=r.x/d,M=Ua(t.x,b,_),T=Ua(t.x,b-1,_),I=Ua(t.x,b+1,_),R=Math.min(M,T,I);return R===I?1:R===T?-1:0}allowVariableZoom(t,r){return Lt(t,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,r,c,d){return this._boundingVolumeCache.getTileBoundingVolume(t,r,c,d)}_computeTileBoundingVolume(t,r,c,d){var _,b;let M=c,T=c;if(d!=null&&d.terrain){const I=new o.Z(t.z,r,t.z,t.x,t.y),R=d.terrain.getMinMaxElevation(I);M=(_=R.minElevation)!==null&&_!==void 0?_:c,T=(b=R.maxElevation)!==null&&b!==void 0?b:c}if(M/=o.bt,T/=o.bt,M+=1,T+=1,t.z<=0)return en.fromAabb([-T,-T,-T],[T,T,T]);if(t.z===1)return en.fromAabb([t.x===0?-T:0,t.y===0?0:-T,-T],[t.x===0?0:T,t.y===0?T:0,T]);{const I=[vs(0,0,t.x,t.y,t.z),vs(o.$,0,t.x,t.y,t.z),vs(o.$,o.$,t.x,t.y,t.z),vs(0,o.$,t.x,t.y,t.z)],R=[];for(const Tt of I)R.push(o.aQ([],Tt,T));if(T!==M)for(const Tt of I)R.push(o.aQ([],Tt,M));t.y===0&&R.push([0,1,0]),t.y===(1<<t.z)-1&&R.push([0,-1,0]);const F=[1,1,1],L=[-1,-1,-1];for(const Tt of R)for(let At=0;At<3;At++)F[At]=Math.min(F[At],Tt[At]),L[At]=Math.max(L[At],Tt[At]);const G=vs(o.$/2,o.$/2,t.x,t.y,t.z),Z=o.aV([],[0,1,0],G);o.aU(Z,Z);const tt=o.aV([],G,Z);o.aU(tt,tt);const Q=o.aV([],I[2],I[1]);o.aU(Q,Q);const et=o.aV([],I[0],I[3]);o.aU(et,et),R.push(o.aQ([],G,T)),t.y>=(1<<t.z)/2&&R.push(o.aQ([],vs(o.$/2,0,t.x,t.y,t.z),T)),t.y<(1<<t.z)/2&&R.push(o.aQ([],vs(o.$/2,o.$,t.x,t.y,t.z),T));const st=Lr(G,R),ht=Lr(tt,R),at=[-G[0],-G[1],-G[2],st.max],dt=[G[0],G[1],G[2],-st.min],pt=[-tt[0],-tt[1],-tt[2],ht.max],ot=[tt[0],tt[1],tt[2],-ht.min],bt=[...Q,0],It=[...et,0],Mt=[];return t.y===0?Mt.push(o.bs(It,bt,at),o.bs(It,bt,dt)):Mt.push(o.bs(pt,bt,at),o.bs(pt,bt,dt),o.bs(pt,It,at),o.bs(pt,It,dt)),t.y===(1<<t.z)-1?Mt.push(o.bs(It,bt,at),o.bs(It,bt,dt)):Mt.push(o.bs(ot,bt,at),o.bs(ot,bt,dt),o.bs(ot,It,at),o.bs(ot,It,dt)),new en(Mt,[at,dt,pt,ot,bt,It],F,L)}}}function Lr(g,t){let r=1/0,c=-1/0;for(const d of t){const _=o.aW(g,d);r=Math.min(r,_),c=Math.max(c,_)}return{min:r,max:c}}class Xn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,c){return this._helper.interpolatePadding(t,r,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r){this._helper.resize(t,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=o.bu(),this._projectionMatrix=o.b8(),this._globeViewProjMatrix32f=o.b7(),this._globeViewProjMatrixNoCorrection=o.b8(),this._globeViewProjMatrixNoCorrectionInverted=o.b8(),this._globeProjMatrixInverted=o.b8(),this._cameraPosition=o.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Fa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,r)=>this.getConstrained(t,r)}),this._coveringTilesDetailsProvider=new hf}clone(){const t=new Xn;return t.apply(this),t}apply(t,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=o.bo();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:r,applyGlobeMatrix:c}=t,d=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const r=this.pitchInRadians,c=this.cameraToCenterDistance/t,d=Math.sin(r)*c,_=Math.cos(r)*c+1,b=1/Math.sqrt(d*d+_*_)*1;let M=-d,T=_;const I=Math.sqrt(M*M+T*T);M/=I,T/=I;const R=[0,M,T];o.bv(R,R,[0,0,0],-this.bearingInRadians),o.bw(R,R,[0,0,0],-1*this.center.lat*Math.PI/180),o.bx(R,R,[0,0,0],this.center.lng*Math.PI/180);const F=1/o.aY(R);return o.aQ(R,R,F),[...R,-b*F]}isLocationOccluded(t){return!this.isSurfacePointVisible(fr(t))}transformLightDirection(t){const r=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,d=Math.cos(c),_=[Math.sin(r)*d,Math.sin(c),Math.cos(r)*d],b=[_[2],0,-_[0]],M=[0,0,0];o.aV(M,b,_),o.aU(b,b),o.aU(M,M);const T=[0,0,0];return o.aU(T,[b[0]*t[0]+M[0]*t[1]+_[0]*t[2],b[1]*t[0]+M[1]*t[1]+_[1]*t[2],b[2]*t[0]+M[2]*t[1]+_[2]*t[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,r,c){const d=function(M,T,I){const R=1/(1<<I.z);return new o.a0(M/o.$*R+I.x*R,T/o.$*R+I.y*R)}(t,r,c.canonical),_=(b=d.y,[o.bn(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI]);var b;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,r,c,d){const _=c.canonical,b=vs(t,r,_.x,_.y,_.z),M=1+(d?d(t,r):0)/o.bt,T=[b[0]*M,b[1]*M,b[2]*M,1];o.av(T,T,this._globeViewProjMatrixNoCorrection);const I=this._cachedClippingPlane,R=I[0]*b[0]+I[1]*b[1]+I[2]*b[2]+I[3]<0;return{point:new o.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:R}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=$n(this.worldSize,this.center.lat),r=o.b9(),c=o.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),o.b3(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;r[8]=2*-d.x/this._helper._width,r[9]=2*d.y/this._helper._height,this._projectionMatrix=o.b4(r),this._globeProjMatrixInverted=o.b9(),o.ap(this._globeProjMatrixInverted,r),o.M(r,r,[0,0,-this.cameraToCenterDistance]),o.b5(r,r,this.rollInRadians),o.b6(r,r,-this.pitchInRadians),o.b5(r,r,this.bearingInRadians),o.M(r,r,[0,0,-t]);const _=o.bo();_[0]=t,_[1]=t,_[2]=t,o.b6(c,r,this.center.lat*Math.PI/180),o.by(c,c,-this.center.lng*Math.PI/180),o.N(c,c,_),this._globeViewProjMatrixNoCorrection=c,o.b6(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.by(r,r,-this.center.lng*Math.PI/180),o.N(r,r,_),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),o.ap(this._globeViewProjMatrixNoCorrectionInverted,c);const b=o.bo();this._cameraPosition=o.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/t,o.bv(this._cameraPosition,this._cameraPosition,b,-this.rollInRadians),o.bw(this._cameraPosition,this._cameraPosition,b,this.pitchInRadians),o.bv(this._cameraPosition,this._cameraPosition,b,-this.bearingInRadians),o.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bw(this._cameraPosition,this._cameraPosition,b,-this.center.lat*Math.PI/180),o.bx(this._cameraPosition,this._cameraPosition,b,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const M=o.b4(this._globeViewProjMatrixNoCorrectionInverted);o.N(M,M,[1,1,-1]),this._cachedFrustum=Cr.fromInvProjectionMatrix(M,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){o.w("calculateFogMatrix is not supported on globe projection.");const r=o.b9();return o.af(r),r}getVisibleUnwrappedCoordinates(t){return[new o.b1(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=fr(t);o.aQ(c,c,1+r/o.bt);const d=o.bu();return o.av(d,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(t){}getBounds(){const t=.5*this.width,r=.5*this.height,c=[new o.P(0,0),new o.P(t,0),new o.P(this.width,0),new o.P(this.width,r),new o.P(this.width,this.height),new o.P(t,this.height),new o.P(0,this.height),new o.P(0,r)],d=[];for(const F of c)d.push(this.unprojectScreenPoint(F));let _=0,b=0,M=0,T=0;const I=this.center;for(const F of d){const L=o.bz(I.lng,F.lng),G=o.bz(I.lat,F.lat);L<b&&(b=L),L>_&&(_=L),G<T&&(T=G),G>M&&(M=G)}const R=[I.lng+b,I.lat+T,I.lng+_,I.lat+M];return this.isSurfacePointOnScreen([0,1,0])&&(R[3]=90,R[0]=-180,R[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(R[1]=-90,R[0]=-180,R[2]=180),new Me(R)}getConstrained(t,r){const c=o.ag(t.lat,-85.051129,o.ah),d=o.ag(+r,this.minZoom+sr(0,c),this.maxZoom);return{center:new o.S(t.lng,c),zoom:d}}calculateCenterFromCameraLngLatAlt(t,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,c,d)}setLocationAtPoint(t,r){const c=fr(this.unprojectScreenPoint(r)),d=fr(t),_=o.bo();o.bA(_);const b=o.bo();o.bx(b,c,_,-this.center.lng*Math.PI/180),o.bw(b,b,_,this.center.lat*Math.PI/180);const M=d[0]*d[0]+d[2]*d[2],T=b[0]*b[0];if(M<T)return;const I=Math.sqrt(M-T),R=-I,F=o.bB(d[0],d[2],b[0],I),L=o.bB(d[0],d[2],b[0],R),G=o.bo();o.bx(G,d,_,-F);const Z=o.bB(G[1],G[2],b[1],b[2]),tt=o.bo();o.bx(tt,d,_,-L);const Q=o.bB(tt[1],tt[2],b[1],b[2]),et=.5*Math.PI,st=Z>=-et&&Z<=et,ht=Q>=-et&&Q<=et;let at,dt;if(st&&ht){const It=this.center.lng*Math.PI/180,Mt=this.center.lat*Math.PI/180;o.bC(F,It)+o.bC(Z,Mt)<o.bC(L,It)+o.bC(Q,Mt)?(at=F,dt=Z):(at=L,dt=Q)}else if(st)at=F,dt=Z;else{if(!ht)return;at=L,dt=Q}const pt=at/Math.PI*180,ot=dt/Math.PI*180,bt=this.center.lat;this.setCenter(new o.S(pt,o.ag(ot,-90,90))),this.setZoom(this.zoom+sr(bt,this.center.lat))}locationToScreenPoint(t,r){const c=fr(t);if(r){const d=r.getElevationForLngLatZoom(t,this._helper._tileZoom);o.aQ(c,c,1+d/o.bt)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(t){const r=o.bu();return o.av(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new o.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,r){if(r){const c=r.pointCoordinate(t);if(c)return c}return o.a0.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,r){var c;return(c=this.screenPointToMercatorCoordinate(t,r))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(t,r){const c=this._cameraPosition,d=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(c,d)}getRayDirectionFromPixel(t){const r=o.bu();r[0]=t.x/this.width*2-1,r[1]=-1*(t.y/this.height*2-1),r[2]=1,r[3]=1,o.av(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const c=o.bo();c[0]=r[0]-this._cameraPosition[0],c[1]=r[1]-this._cameraPosition[1],c[2]=r[2]-this._cameraPosition[2];const d=o.bo();return o.aU(d,c),d}isSurfacePointVisible(t){const r=this._cachedClippingPlane;return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const r=o.bu();return o.av(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(t,r){const c=o.aW(t,r),d=o.bo(),_=o.bo();o.aQ(_,r,c),o.aT(d,t,_);const b=1-o.aW(d,d);if(b<0)return null;const M=o.aW(t,t)-1,T=-c+(c<0?1:-1)*Math.sqrt(b),I=M/T,R=T;return{tMin:Math.min(I,R),tMax:Math.max(I,R)}}unprojectScreenPoint(t){const r=this._cameraPosition,c=this.getRayDirectionFromPixel(t),d=this.rayPlanetIntersection(r,c);if(d){const R=o.bo();o.aR(R,r,[c[0]*d.tMin,c[1]*d.tMin,c[2]*d.tMin]);const F=o.bo();return o.aU(F,R),Ga(F)}const _=this._cachedClippingPlane,b=_[0]*c[0]+_[1]*c[1]+_[2]*c[2],M=-o.b0(_,r)/b,T=o.bo();if(M>0)o.aR(T,r,[c[0]*M,c[1]*M,c[2]*M]);else{const R=o.bo();o.aR(R,r,[2*c[0],2*c[1],2*c[2]]);const F=o.b0(this._cachedClippingPlane,R);o.aT(T,R,[this._cachedClippingPlane[0]*F,this._cachedClippingPlane[1]*F,this._cachedClippingPlane[2]*F])}const I=function(R){const F=o.bo();return F[0]=R[0]*-R[3],F[1]=R[1]*-R[3],F[2]=R[2]*-R[3],{center:F,radius:Math.sqrt(1-R[3]*R[3])}}(_);return Ga(function(R,F,L){const G=o.bo();o.aT(G,L,R);const Z=o.bo();return o.bp(Z,R,G,F/o.a_(G)),Z}(I.center,I.radius,T))}getMatrixForModel(t,r){const c=o.S.convert(t),d=1/o.bt,_=o.b8();return o.by(_,_,c.lng/180*Math.PI),o.b6(_,_,-c.lat/180*Math.PI),o.M(_,_,[0,0,1+r/o.bt]),o.b6(_,_,.5*Math.PI),o.N(_,_,[d,d,d]),_}getProjectionDataForCustomLayer(t=!0){const r=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:t});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(t){}}class Qr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,c){return this._helper.interpolatePadding(t,r,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,c=!0){this._helper.resize(t,r,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,r){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Fa({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,r)=>this.getConstrained(t,r)}),this._globeness=1,this._mercatorTransform=new rr,this._verticalPerspectiveTransform=new Xn}clone(){const t=new Qr;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const r=this._mercatorTransform.getProjectionData(t),c=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:r.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return o.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,r,c){const d=this._mercatorTransform.getPitchedTextCorrection(t,r,c),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,r,c);return o.bj(d,_,this._globeness)}projectTileCoordinates(t,r,c,d){return this.currentTransform.projectTileCoordinates(t,r,c,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){return this.currentTransform.lngLatToCameraDepth(t,r)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,r){return this.currentTransform.getConstrained(t,r)}calculateCenterFromCameraLngLatAlt(t,r,c,d){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,c,d)}setLocationAtPoint(t,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,r){return this.currentTransform.locationToScreenPoint(t,r)}screenPointToMercatorCoordinate(t,r){return this.currentTransform.screenPointToMercatorCoordinate(t,r)}screenPointToLocation(t,r){return this.currentTransform.screenPointToLocation(t,r)}isPointOnMapSurface(t,r){return this.currentTransform.isPointOnMapSurface(t,r)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,r){return this.currentTransform.getMatrixForModel(t,r)}getProjectionDataForCustomLayer(t=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return r;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return c.fallbackMatrix=r.mainMatrix,c}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Wr{get useGlobeControls(){return!0}handlePanInertia(t,r){const c=ja(t,r);return Math.abs(c.lng-r.center.lng)>180&&(c.lng=r.center.lng+179.5*Math.sign(c.lng-r.center.lng)),{easingCenter:c,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,r){const c=t.around,d=r.screenPointToLocation(c);t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta);const _=r.zoom;t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta);const b=r.zoom-_;if(b===0)return;const M=o.bz(r.center.lng,d.lng),T=M/(Math.abs(M/180)+1),I=o.bz(r.center.lat,d.lat),R=r.getRayDirectionFromPixel(c),F=r.cameraPosition,L=-1*o.aW(F,R),G=o.bo();o.aR(G,F,[R[0]*L,R[1]*L,R[2]*L]);const Z=o.aY(G)-1,tt=Math.exp(.5*-Math.max(Z-.3,0)),Q=$n(r.worldSize,r.center.lat)/Math.min(r.width,r.height),et=o.bm(Q,.9,.5,1,.25),st=(1-o.ae(-b))*Math.min(tt,et),ht=r.center.lat,at=r.zoom,dt=new o.S(r.center.lng+T*st,o.ag(r.center.lat+I*st,-85.051129,o.ah));r.setLocationAtPoint(d,c);const pt=r.center,ot=o.bm(Math.abs(M),45,85,0,1),bt=o.bm(Q,.75,.35,0,1),It=Math.pow(Math.max(ot,bt),.25),Mt=o.bz(pt.lng,dt.lng),Tt=o.bz(pt.lat,dt.lat);r.setCenter(new o.S(pt.lng+Mt*It,pt.lat+Tt*It).wrap()),r.setZoom(at+sr(ht,r.center.lat))}handleMapControlsPan(t,r,c){if(!t.panDelta)return;const d=r.center.lat,_=r.zoom;r.setCenter(ja(t.panDelta,r).wrap()),r.setZoom(_+sr(d,r.center.lat))}cameraForBoxAndBearing(t,r,c,d,_){const b=Gi(t,r,c,d,_),M=r.left/_.width*2-1,T=(_.width-r.right)/_.width*2-1,I=r.top/_.height*-2+1,R=(_.height-r.bottom)/_.height*-2+1,F=o.bz(c.getWest(),c.getEast())<0,L=F?c.getEast():c.getWest(),G=F?c.getWest():c.getEast(),Z=Math.max(c.getNorth(),c.getSouth()),tt=Math.min(c.getNorth(),c.getSouth()),Q=L+.5*o.bz(L,G),et=Z+.5*o.bz(Z,tt),st=_.clone();st.setCenter(b.center),st.setBearing(b.bearing),st.setPitch(0),st.setRoll(0),st.setZoom(b.zoom);const ht=st.modelViewProjectionMatrix,at=[fr(c.getNorthWest()),fr(c.getNorthEast()),fr(c.getSouthWest()),fr(c.getSouthEast()),fr(new o.S(G,et)),fr(new o.S(L,et)),fr(new o.S(Q,Z)),fr(new o.S(Q,tt))],dt=fr(b.center);let pt=Number.POSITIVE_INFINITY;for(const ot of at)M<0&&(pt=Wr.getLesserNonNegativeNonNull(pt,Wr.solveVectorScale(ot,dt,ht,"x",M))),T>0&&(pt=Wr.getLesserNonNegativeNonNull(pt,Wr.solveVectorScale(ot,dt,ht,"x",T))),I>0&&(pt=Wr.getLesserNonNegativeNonNull(pt,Wr.solveVectorScale(ot,dt,ht,"y",I))),R<0&&(pt=Wr.getLesserNonNegativeNonNull(pt,Wr.solveVectorScale(ot,dt,ht,"y",R)));if(Number.isFinite(pt)&&pt!==0)return b.zoom=st.zoom+o.aj(pt),b;Ar()}handleJumpToCenterZoom(t,r){const c=t.center.lat,d=t.getConstrained(r.center?o.S.convert(r.center):t.center,t.zoom).center;t.setCenter(d.wrap());const _=r.zoom!==void 0?+r.zoom:t.zoom+sr(c,d.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,r){const c=t.zoom,d=t.center,_=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},M={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},T=r.zoom!==void 0,I=!t.isPaddingEqual(r.padding);let R=!1;const F=r.center?o.S.convert(r.center):d,L=t.getConstrained(F,c).center;Us(t,L);const G=t.clone();G.setCenter(L),G.setZoom(T?+r.zoom:c+sr(d.lat,F.lat)),G.setBearing(r.bearing);const Z=new o.P(o.ag(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),o.ag(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));G.setLocationAtPoint(L,Z);const tt=(r.offset&&r.offsetAsPoint.mag())>0?G.center:L,Q=T?+r.zoom:c+sr(d.lat,tt.lat),et=c+sr(d.lat,0),st=Q+sr(tt.lat,0),ht=o.bz(d.lng,tt.lng),at=o.bz(d.lat,tt.lat),dt=o.ae(st-et);return R=Q!==c,{easeFunc:pt=>{if(o.bd(b,M)||dr({startEulerAngles:b,endEulerAngles:M,tr:t,k:pt,useSlerp:b.roll!=M.roll}),I&&t.interpolatePadding(_,r.padding,pt),r.around)o.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(r.around,r.aroundPoint);else{const ot=st>et?Math.min(2,dt):Math.max(.5,dt),bt=Math.pow(ot,1-pt),It=Hn(d,ht,at,pt*bt);t.setCenter(It.wrap())}if(R){const ot=o.C.number(et,st,pt)+sr(0,t.center.lat);t.setZoom(ot)}},isZooming:R,elevationCenter:tt}}handleFlyTo(t,r){const c=r.zoom!==void 0,d=t.center,_=t.zoom,b=t.padding,M=!t.isPaddingEqual(r.padding),T=t.getConstrained(o.S.convert(r.center||r.locationAtOffset),_).center,I=c?+r.zoom:t.zoom+sr(t.center.lat,T.lat),R=t.clone();R.setCenter(T),R.setZoom(I),R.setBearing(r.bearing);const F=new o.P(o.ag(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),o.ag(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));R.setLocationAtPoint(T,F);const L=R.center;Us(t,L);const G=function(at,dt,pt){const ot=fr(dt),bt=fr(pt),It=o.aW(ot,bt),Mt=Math.acos(It),Tt=Na(at);return Mt/(2*Math.PI)*Tt}(t,d,L),Z=_+sr(d.lat,0),tt=I+sr(L.lat,0),Q=o.ae(tt-Z);let et;if(typeof r.minZoom=="number"){const at=+r.minZoom+sr(L.lat,0),dt=Math.min(at,Z,tt)+sr(0,L.lat),pt=t.getConstrained(L,dt).zoom+sr(L.lat,0);et=o.ae(pt-Z)}const st=o.bz(d.lng,L.lng),ht=o.bz(d.lat,L.lat);return{easeFunc:(at,dt,pt,ot)=>{const bt=Hn(d,st,ht,pt);M&&t.interpolatePadding(b,r.padding,at);const It=at===1?L:bt;t.setCenter(It.wrap());const Mt=Z+o.aj(dt);t.setZoom(at===1?I:Mt+sr(0,It.lat))},scaleOfZoom:Q,targetCenter:L,scaleOfMinZoom:et,pixelPathLength:G}}static solveVectorScale(t,r,c,d,_){const b=d==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],M=[c[3],c[7],c[11],c[15]],T=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],I=t[0]*M[0]+t[1]*M[1]+t[2]*M[2],R=r[0]*b[0]+r[1]*b[1]+r[2]*b[2],F=r[0]*M[0]+r[1]*M[1]+r[2]*M[2];return R+_*I===T+_*F||M[3]*(T-R)+b[3]*(F-I)+T*F==R*I?null:(R+b[3]-_*F-_*M[3])/(R-T-_*F+_*I)}static getLesserNonNegativeNonNull(t,r){return r!==null&&r>=0&&r<t?r:t}}class ch{constructor(t){this._globe=t,this._mercatorCameraHelper=new Bo,this._verticalPerspectiveCameraHelper=new Wr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,r){return this.currentHelper.handlePanInertia(t,r)}handleMapControlsRollPitchBearingZoom(t,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,r)}handleMapControlsPan(t,r,c){this.currentHelper.handleMapControlsPan(t,r,c)}cameraForBoxAndBearing(t,r,c,d,_){return this.currentHelper.cameraForBoxAndBearing(t,r,c,d,_)}handleJumpToCenterZoom(t,r){this.currentHelper.handleJumpToCenterZoom(t,r)}handleEaseTo(t,r){return this.currentHelper.handleEaseTo(t,r)}handleFlyTo(t,r){return this.currentHelper.handleFlyTo(t,r)}}const Va=(g,t)=>o.y(g,t&&t.filter(r=>r.identifier!=="source.canvas")),Kn=o.bD();class uh extends o.E{constructor(t,r={}){super(),this._rtlPluginLoaded=()=>{for(const c in this.sourceCaches){const d=this.sourceCaches[c].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[c].reload()}},this.map=t,this.dispatcher=new Ee(Se(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(c,d)=>this.getGlyphs(c,d)),this.dispatcher.registerMessageHandler("GI",(c,d)=>this.getImages(c,d)),this.imageManager=new Le,this.imageManager.setEventedParent(this),this.glyphManager=new be(t._requestManager,r.localIdeographFontFamily),this.lineAtlas=new qt(256,512),this.crossTileSymbolIndex=new Lo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bF()),Ye().on(di,this._rtlPluginLoaded),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const d=this.sourceCaches[c.sourceId];if(!d)return;const _=d.getSource();if(_&&_.vectorLayerIds)for(const b in this._layers){const M=this._layers[b];M.source===_.id&&this._validateLayer(M)}})}setGlobalStateProperty(t,r){var c,d,_;this._checkLoaded();const b=r===null?(_=(d=(c=this.stylesheet.state)===null||c===void 0?void 0:c[t])===null||d===void 0?void 0:d.default)!==null&&_!==void 0?_:null:r;if(o.bG(b,this._globalState[t]))return this;this._globalState[t]=b;const M=this._findGlobalStateAffectedSources([t]);for(const T in this.sourceCaches)M.has(T)&&(this._reloadSource(T),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const r=[];for(const d in t)!o.bG(this._globalState[d],t[d].default)&&(r.push(d),this._globalState[d]=t[d].default);const c=this._findGlobalStateAffectedSources(r);for(const d in this.sourceCaches)c.has(d)&&(this._reloadSource(d),this._changed=!0)}_findGlobalStateAffectedSources(t){if(t.length===0)return new Set;const r=new Set;for(const c in this._layers){const d=this._layers[c],_=d.getLayoutAffectingGlobalStateRefs();for(const b of t)_.has(b)&&r.add(d.source)}return r}loadURL(t,r={},c){this.fire(new o.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const d=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;o.j(d,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,r,c)}).catch(b=>{this._loadStyleRequest=null,b&&!_.signal.aborted&&this.fire(new o.k(b))})}loadJSON(t,r={},c){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,k.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(t,r,c)}).catch(()=>{})}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Kn,{validate:!1})}_load(t,r,c){var d,_,b;const M=r.transformStyle?r.transformStyle(c,t):t;if(!r.validate||!Va(this,o.z(M))){this._loaded=!0,this.stylesheet=M;for(const T in M.sources)this.addSource(T,M.sources[T],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new ui(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new Ft(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.setGlobalState((b=this.stylesheet.state)!==null&&b!==void 0?b:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){const t=o.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of t){const c=o.bI(r);c.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=c}}_loadSprite(t,r=!1,c=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,b,M,T){return o._(this,void 0,void 0,function*(){const I=ae(_),R=M>1?"@2x":"",F={},L={};for(const{id:G,url:Z}of I){const tt=b.transformRequest(ke(Z,R,".json"),"SpriteJSON");F[G]=o.j(tt,T);const Q=b.transformRequest(ke(Z,R,".png"),"SpriteImage");L[G]=Ct.getImage(Q,T)}return yield Promise.all([...Object.values(F),...Object.values(L)]),function(G,Z){return o._(this,void 0,void 0,function*(){const tt={};for(const Q in G){tt[Q]={};const et=k.getImageCanvasContext((yield Z[Q]).data),st=(yield G[Q]).data;for(const ht in st){const{width:at,height:dt,x:pt,y:ot,sdf:bt,pixelRatio:It,stretchX:Mt,stretchY:Tt,content:At,textFitWidth:te,textFitHeight:Jt}=st[ht];tt[Q][ht]={data:null,pixelRatio:It,sdf:bt,stretchX:Mt,stretchY:Tt,content:At,textFitWidth:te,textFitHeight:Jt,spriteData:{width:at,height:dt,x:pt,y:ot,context:et}}}}return tt})}(F,L)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const b in _){this._spritesImagesIds[b]=[];const M=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(T=>!(T in _)):[];for(const T of M)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in _[b]){const I=b==="default"?T:`${b}:${T}`;this._spritesImagesIds[b].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,_[b][T],!1):this.imageManager.addImage(I,_[b][T]),r&&(this._changedImages[I]=!0)}}}).catch(_=>{this._spriteRequest=null,d=_,this.fire(new o.k(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),c&&c(d)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(t){const r=this.sourceCaches[t.source];if(!r)return;const c=t.sourceLayer;if(!c)return;const d=r.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.k(new Error(`Source layer "${c}" does not exist on source "${d.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,r=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r?o.bJ(c):c);const d=[];for(const _ of t)if(c[_]){const b=r?o.bJ(c[_]):c[_];d.push(b)}return d}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const c of r){const d=this._layers[c];d.type!=="custom"&&(t[c]=d.serialize())}return t}hasTransitions(){var t,r,c;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(r){const d=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(d.length||_.length)&&this._updateWorkerLayers(d,_);for(const b in this._updatedSources){const M=this._updatedSources[b];if(M==="reload")this._reloadSource(b);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const d in this.sourceCaches){const _=this.sourceCaches[d];c[d]=_.used,_.used=!1}for(const d of this._order){const _=this._layers[d];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const d in c){const _=this.sourceCaches[d];!!c[d]!=!!_.used&&_.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,r&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){var c;this._checkLoaded();const d=this.serialize();if(t=r.transformStyle?r.transformStyle(d,t):t,((c=r.validate)===null||c===void 0||c)&&Va(this,o.z(t)))return!1;(t=o.bJ(t)).layers=o.bH(t.layers);const _=o.bK(d,t),b=this._getOperationsToPerform(_);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const M of b.operations)M();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const r=[],c=[];for(const d of t)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":r.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":r.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,d.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setSky":r.push(()=>this.setSky.apply(this,d.args));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":r.push(()=>this.setGlobalState.apply(this,d.args));break;case"setTransition":r.push(()=>{});break;default:c.push(d.command)}return{operations:r,unimplemented:c}}addImage(t,r){if(this.getImage(t))return this.fire(new o.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,c={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(o.z.source,`sources.${t}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const d=this.sourceCaches[t]=new Nt(t,r,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:t})),d.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new o.k(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const r=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],r.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.sourceCaches[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(r),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,r,c={}){this._checkLoaded();const d=t.id;if(this.getLayer(d))return void this.fire(new o.k(new Error(`Layer "${d}" already exists on this map.`)));let _;if(t.type==="custom"){if(Va(this,o.bL(t)))return;_=o.bI(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(d,t.source),t=o.bJ(t),t=o.e(t,{source:d})),this._validate(o.z.layer,`layers.${d}`,t,{arrayIndex:-1},c))return;_=o.bI(t),this._validateLayer(_),_.setEventedParent(this,{layer:{id:d}})}const b=r?this._order.indexOf(r):this._order.length;if(r&&b===-1)this.fire(new o.k(new Error(`Cannot add layer "${d}" before non-existing layer "${r}".`)));else{if(this._order.splice(b,0,d),this._layerOrderChanged=!0,this._layers[d]=_,this._removedLayers[d]&&_.source&&_.type!=="custom"){const M=this._removedLayers[d];delete this._removedLayers[d],M.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const c=this._order.indexOf(t);this._order.splice(c,1);const d=r?this._order.indexOf(r):this._order.length;r&&d===-1?this.fire(new o.k(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(d,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,c){this._checkLoaded();const d=this.getLayer(t);d?d.minzoom===r&&d.maxzoom===c||(r!=null&&(d.minzoom=r),c!=null&&(d.maxzoom=c),this._updateLayer(d)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,c={}){this._checkLoaded();const d=this.getLayer(t);if(d){if(!o.bG(d.filter,r))return r==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(o.z.filter,`layers.${d.id}.filter`,r,null,c)||(d.setFilter(o.bJ(r)),this._updateLayer(d)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.bJ(this.getLayer(t).filter)}setLayoutProperty(t,r,c,d={}){this._checkLoaded();const _=this.getLayer(t);_?o.bG(_.getLayoutProperty(r),c)||(_.setLayoutProperty(r,c,d),this._updateLayer(_)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const c=this.getLayer(t);if(c)return c.getLayoutProperty(r);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,c,d={}){this._checkLoaded();const _=this.getLayer(t);_?o.bG(_.getPaintProperty(r),c)||(_.setPaintProperty(r,c,d)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new o.k(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const c=t.source,d=t.sourceLayer,_=this.sourceCaches[c];if(_===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));const b=_.getSource().type;b==="geojson"&&d?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||d?(t.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(d,t.id,r)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const c=t.source,d=this.sourceCaches[c];if(d===void 0)return void this.fire(new o.k(new Error(`The source '${c}' does not exist in the map's style.`)));const _=d.getSource().type,b=_==="vector"?t.sourceLayer:void 0;_!=="vector"||b?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(b,t.id,r):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,c=t.sourceLayer,d=this.sourceCaches[r];if(d!==void 0)return d.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(c,t.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=o.bM(this.sourceCaches,_=>_.serialize()),r=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,d=this.stylesheet;return o.bN({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:t,layers:r,terrain:c},_=>_!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=b=>this._layers[b].type==="fill-extrusion",c={},d=[];for(let b=this._order.length-1;b>=0;b--){const M=this._order[b];if(r(M)){c[M]=b;for(const T of t){const I=T[M];if(I)for(const R of I)d.push(R)}}}d.sort((b,M)=>M.intersectionZ-b.intersectionZ);const _=[];for(let b=this._order.length-1;b>=0;b--){const M=this._order[b];if(r(M))for(let T=d.length-1;T>=0;T--){const I=d[T].feature;if(c[I.layer.id]<b)break;_.push(I),d.pop()}else for(const T of t){const I=T[M];if(I)for(const R of I)_.push(R.feature)}}return _}queryRenderedFeatures(t,r,c){r&&r.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",r.filter,null,r);const d={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const I of r.layers){const R=this._layers[I];if(!R)return this.fire(new o.k(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];d[R.source]=!0}}const _=[];r.availableImages=this._availableImages;const b=this._serializedAllLayers(),M=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,T=Object.assign(Object.assign({},r),{layers:M});for(const I in this.sourceCaches)r.layers&&!d[I]||_.push(ue(this.sourceCaches[I],this._layers,b,t,T,c,this.map.terrain?(R,F,L)=>this.map.terrain.getElevation(R,F,L):void 0));return this.placement&&_.push(function(I,R,F,L,G,Z,tt){const Q={},et=Z.queryRenderedSymbols(L),st=[];for(const ht of Object.keys(et).map(Number))st.push(tt[ht]);st.sort(De);for(const ht of st){const at=ht.featureIndex.lookupSymbolFeatures(et[ht.bucketInstanceId],R,ht.bucketIndex,ht.sourceLayerIndex,G.filter,G.layers,G.availableImages,I);for(const dt in at){const pt=Q[dt]=Q[dt]||[],ot=at[dt];ot.sort((bt,It)=>{const Mt=ht.featureSortOrder;if(Mt){const Tt=Mt.indexOf(bt.featureIndex);return Mt.indexOf(It.featureIndex)-Tt}return It.featureIndex-bt.featureIndex});for(const bt of ot)pt.push(bt)}}return function(ht,at,dt){for(const pt in ht)for(const ot of ht[pt])Ve(ot,dt[at[pt].source]);return ht}(Q,I,F)}(this._layers,b,this.sourceCaches,t,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,r){r&&r.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",r.filter,null,r);const c=this.sourceCaches[t];return c?function(d,_){const b=d.getRenderableIds().map(I=>d.getTileByID(I)),M=[],T={};for(let I=0;I<b.length;I++){const R=b[I],F=R.tileID.canonical.key;T[F]||(T[F]=!0,R.querySourceFeatures(M,_))}return M}(c,r):[]}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const c=this.light.getLight();let d=!1;for(const b in t)if(!o.bG(t[b],c[b])){d=!0;break}if(!d)return;const _={now:k.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,r={}){this._checkLoaded();const c=this.getSky();let d=!1;if(!t&&!c)return;if(t&&!c)d=!0;else if(!t&&c)d=!0;else for(const b in t)if(!o.bG(t[b],c[b])){d=!0;break}if(!d)return;const _={now:k.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,r),this.sky.updateTransitions(_)}_setProjectionInternal(t){const r=function(c){if(Array.isArray(c)){const d=new Ba({type:c});return{projection:d,transform:new Qr,cameraHelper:new ch(d)}}switch(c){case"mercator":return{projection:new ah,transform:new rr,cameraHelper:new Bo};case"globe":{const d=new Ba({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:d,transform:new Qr,cameraHelper:new ch(d)}}case"vertical-perspective":return{projection:new nu,transform:new Xn,cameraHelper:new Wr};default:return o.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new ah,transform:new rr,cameraHelper:new Bo}}}(t);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const c in this.sourceCaches)this.sourceCaches[c].reload()}_validate(t,r,c,d,_={}){return(!_||_.validate!==!1)&&Va(this,t.call(o.z,o.e({key:r,style:this.serialize(),value:c,styleSpec:o.v},d)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ye().off(di,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const c=this.sourceCaches[r];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const r in this.sourceCaches)this.sourceCaches[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,r,c,d,_=!1){let b=!1,M=!1;const T={};for(const I of this._order){const R=this._layers[I];if(R.type!=="symbol")continue;if(!T[R.source]){const L=this.sourceCaches[R.source];T[R.source]=L.getRenderableIds(!0).map(G=>L.getTileByID(G)).sort((G,Z)=>Z.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(Z.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(R,T[R.source],t.center.lng);b=b||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(k.now(),t.zoom))&&(this.pauseablePlacement=new ru(t,this.map.terrain,this._order,_,r,c,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(k.now()),M=!0),b&&this.pauseablePlacement.placement.setStale()),M||b)for(const I of this._order){const R=this._layers[I];R.type==="symbol"&&this.placement.updateLayerOpacities(R,T[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(k.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,r){return o._(this,void 0,void 0,function*(){const c=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[r.source];return d&&d.setDependencies(r.tileID.key,r.type,r.icons),c})}getGlyphs(t,r){return o._(this,void 0,void 0,function*(){const c=yield this.glyphManager.getGlyphs(r.stacks),d=this.sourceCaches[r.source];return d&&d.setDependencies(r.tileID.key,r.type,[""]),c})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(o.z.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,r,c={},d){this._checkLoaded();const _=[{id:t,url:r}],b=[...ae(this.stylesheet.sprite),..._];this._validate(o.z.sprite,"sprite",b,null,c)||(this.stylesheet.sprite=b,this._loadSprite(_,!0,d))}removeSprite(t){this._checkLoaded();const r=ae(this.stylesheet.sprite);if(r.find(c=>c.id===t)){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;r.splice(r.findIndex(c=>c.id===t),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ae(this.stylesheet.sprite)}setSprite(t,r={},c){this._checkLoaded(),t&&this._validate(o.z.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}}var cf=o.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class uf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,c,d,_,b,M,T,I){this.context=t;let R=this.boundPaintVertexBuffers.length!==d.length;for(let F=0;!R&&F<d.length;F++)this.boundPaintVertexBuffers[F]!==d[F]&&(R=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||R||this.boundIndexBuffer!==_||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==I?this.freshBind(r,c,d,_,b,M,T,I):(t.bindVertexArray.set(this.vao),M&&M.bind(),_&&_.dynamicDraw&&_.bind(),T&&T.bind(),I&&I.bind())}freshBind(t,r,c,d,_,b,M,T){const I=t.numAttributes,R=this.context,F=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=T,r.enableAttributes(F,t);for(const L of c)L.enableAttributes(F,t);b&&b.enableAttributes(F,t),M&&M.enableAttributes(F,t),T&&T.enableAttributes(F,t),r.bind(),r.setVertexAttribPointers(F,t,_);for(const L of c)L.bind(),L.setVertexAttribPointers(F,t,_);b&&(b.bind(),b.setVertexAttribPointers(F,t,_)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(F,t,_)),T&&(T.bind(),T.setVertexAttribPointers(F,t,_)),R.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const df=(g,t,r,c,d)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:t,u_fog_color:r?r.properties.get("fog-color"):o.be.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:r?r.calculateFogBlendOpacity(c):0,u_horizon_color:r?r.properties.get("horizon-color"):o.be.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),ff={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function No(g){const t=[];for(let r=0;r<g.length;r++){if(g[r]===null)continue;const c=g[r].split(" ");t.push(c.pop())}return t}class Go{constructor(t,r,c,d,_,b,M,T,I=[]){const R=t.gl;this.program=R.createProgram();const F=No(r.staticAttributes),L=c?c.getBinderAttributes():[],G=F.concat(L),Z=Is.prelude.staticUniforms?No(Is.prelude.staticUniforms):[],tt=M.staticUniforms?No(M.staticUniforms):[],Q=r.staticUniforms?No(r.staticUniforms):[],et=c?c.getBinderUniforms():[],st=Z.concat(tt).concat(Q).concat(et),ht=[];for(const Mt of st)ht.indexOf(Mt)<0&&ht.push(Mt);const at=c?c.defines():[];zr(R)&&at.unshift("#version 300 es"),_&&at.push("#define OVERDRAW_INSPECTOR;"),b&&at.push("#define TERRAIN3D;"),T&&at.push(T),I&&at.push(...I);let dt=at.concat(Is.prelude.fragmentSource,M.fragmentSource,r.fragmentSource).join(`
`),pt=at.concat(Is.prelude.vertexSource,M.vertexSource,r.vertexSource).join(`
`);zr(R)||(dt=function(Mt){return Mt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(dt),pt=function(Mt){return Mt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(pt));const ot=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(ot,dt),R.compileShader(ot),!R.getShaderParameter(ot,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(ot)}`);R.attachShader(this.program,ot);const bt=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(bt,pt),R.compileShader(bt),!R.getShaderParameter(bt,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(bt)}`);R.attachShader(this.program,bt),this.attributes={};const It={};this.numAttributes=G.length;for(let Mt=0;Mt<this.numAttributes;Mt++)G[Mt]&&(R.bindAttribLocation(this.program,Mt,G[Mt]),this.attributes[G[Mt]]=Mt);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(bt),R.deleteShader(ot);for(let Mt=0;Mt<ht.length;Mt++){const Tt=ht[Mt];if(Tt&&!It[Tt]){const At=R.getUniformLocation(this.program,Tt);At&&(It[Tt]=At)}}this.fixedUniforms=d(t,It),this.terrainUniforms=((Mt,Tt)=>({u_depth:new o.bO(Mt,Tt.u_depth),u_terrain:new o.bO(Mt,Tt.u_terrain),u_terrain_dim:new o.bf(Mt,Tt.u_terrain_dim),u_terrain_matrix:new o.bQ(Mt,Tt.u_terrain_matrix),u_terrain_unpack:new o.bR(Mt,Tt.u_terrain_unpack),u_terrain_exaggeration:new o.bf(Mt,Tt.u_terrain_exaggeration)}))(t,It),this.projectionUniforms=((Mt,Tt)=>({u_projection_matrix:new o.bQ(Mt,Tt.u_projection_matrix),u_projection_tile_mercator_coords:new o.bR(Mt,Tt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bR(Mt,Tt.u_projection_clipping_plane),u_projection_transition:new o.bf(Mt,Tt.u_projection_transition),u_projection_fallback_matrix:new o.bQ(Mt,Tt.u_projection_fallback_matrix)}))(t,It),this.binderUniforms=c?c.getUniforms(t,It):[]}draw(t,r,c,d,_,b,M,T,I,R,F,L,G,Z,tt,Q,et,st,ht){const at=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(d),t.setColorMode(_),t.setCullFace(b),T){t.activeTexture.set(at.TEXTURE2),at.bindTexture(at.TEXTURE_2D,T.depthTexture),t.activeTexture.set(at.TEXTURE3),at.bindTexture(at.TEXTURE_2D,T.texture);for(const pt in this.terrainUniforms)this.terrainUniforms[pt].set(T[pt])}if(I)for(const pt in I)this.projectionUniforms[ff[pt]].set(I[pt]);if(M)for(const pt in this.fixedUniforms)this.fixedUniforms[pt].set(M[pt]);Q&&Q.setUniforms(t,this.binderUniforms,Z,{zoom:tt});let dt=0;switch(r){case at.LINES:dt=2;break;case at.TRIANGLES:dt=3;break;case at.LINE_STRIP:dt=1}for(const pt of G.get()){const ot=pt.vaos||(pt.vaos={});(ot[R]||(ot[R]=new uf)).bind(t,this,F,Q?Q.getPaintVertexBuffers():[],L,pt.vertexOffset,et,st,ht),at.drawElements(r,pt.primitiveLength*dt,at.UNSIGNED_SHORT,pt.primitiveOffset*dt*2)}}}function jo(g,t,r){const c=1/o.aB(r,1,t.transform.tileZoom),d=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,t.transform.tileZoom)/d,b=_*(r.tileID.canonical.x+r.tileID.wrap*d),M=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[c,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[b>>16,M>>16],u_pixel_coord_lower:[65535&b,65535&M]}}const qa=(g,t,r,c)=>{const d=g.style.light,_=d.properties.get("position"),b=[_.x,_.y,_.z],M=o.bU();d.properties.get("anchor")==="viewport"&&o.bV(M,g.transform.bearingInRadians),o.bW(b,b,M);const T=g.transform.transformLightDirection(b),I=d.properties.get("color");return{u_lightpos:b,u_lightpos_globe:T,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+t,u_opacity:r,u_fill_translate:c}},dh=(g,t,r,c,d,_,b)=>o.e(qa(g,t,r,c),jo(_,g,b),{u_height_factor:-Math.pow(2,d.overscaledZ)/b.tileSize/8}),Uo=(g,t,r,c)=>o.e(jo(t,g,r),{u_fill_translate:c}),As=(g,t)=>({u_world:g,u_fill_translate:t}),pf=(g,t,r,c,d)=>o.e(Uo(g,t,r,d),{u_world:c}),fh=(g,t,r,c,d)=>{const _=g.transform;let b,M,T=0;if(r.paint.get("circle-pitch-alignment")==="map"){const I=o.aB(t,1,_.zoom);b=!0,M=[I,I],T=I/(o.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*d}else b=!1,M=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+b,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:M,u_globe_extrude_scale:T,u_translate:c}},$a=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),Za=g=>({u_viewport_size:[g.width,g.height]}),ou=(g,t=1)=>({u_color:g,u_overlay:0,u_overlay_scale:t}),Wa=(g,t,r,c)=>{const d=o.aB(g,1,t)/(o.$*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:o.aB(g,1,t),u_intensity:r,u_globe_extrude_scale:d}},lu=(g,t,r,c)=>{const d=o.L();o.bX(d,0,g.width,g.height,0,0,1);const _=g.context.gl;return{u_matrix:d,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:r,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}},Yn=(g,t,r)=>{const c=r.paint.get("hillshade-accent-color");let d;switch(r.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}const _=r.getIlluminationProperties();for(let b=0;b<_.directionRadians.length;b++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[b]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:hu(0,t.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:c,u_method:d,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},mf=(g,t)=>{const r=t.stride,c=o.L();return o.bX(c,0,o.$,-8192,0,0,1),o.M(c,c,[0,-8192,0]),{u_matrix:c,u_image:1,u_dimension:[r,r],u_zoom:g.overscaledZ,u_unpack:t.getUnpackVector()}};function hu(g,t){const r=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new o.a0(0,c/r).toLngLat().lat,new o.a0(0,(c+1)/r).toLngLat().lat]}const gf=(g,t)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_opacity:g.paint.get("color-relief-opacity")}),Vo=(g,t,r,c)=>{const d=g.transform;return{u_translation:gh(g,t,r),u_ratio:c/o.aB(t,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},ph=(g,t,r,c,d)=>o.e(Vo(g,t,r,c),{u_image:0,u_image_height:d}),cu=(g,t,r,c,d)=>{const _=g.transform,b=mh(t,_);return{u_translation:gh(g,t,r),u_texsize:t.imageAtlasTexture.size,u_ratio:c/o.aB(t,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[b,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},uu=(g,t,r,c,d,_)=>{const b=g.lineAtlas,M=mh(t,g.transform),T=r.layout.get("line-cap")==="round",I=b.getDash(d.from,T),R=b.getDash(d.to,T),F=I.width*_.fromScale,L=R.width*_.toScale;return o.e(Vo(g,t,r,c),{u_patternscale_a:[M/F,-I.height/2],u_patternscale_b:[M/L,-R.height/2],u_sdfgamma:b.width/(256*Math.min(F,L)*g.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:R.y,u_mix:_.t})};function mh(g,t){return 1/o.aB(g,1,t.tileZoom)}function gh(g,t,r){return o.aC(g.transform,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const In=(g,t,r,c,d)=>{return{u_tl_parent:g,u_scale_parent:t,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(b=c.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(_=c.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:du(c.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var _,b};function du(g){g*=Math.PI/180;const t=Math.sin(g),r=Math.cos(g);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const _h=(g,t,r,c,d,_,b,M,T,I,R,F,L)=>{const G=b.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:G.width/G.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_label_plane_matrix:M,u_coord_matrix:T,u_is_text:+R,u_pitch_with_map:+c,u_is_along_line:d,u_is_variable_anchor:_,u_texsize:F,u_texture:0,u_translation:I,u_pitched_scale:L}},Jn=(g,t,r,c,d,_,b,M,T,I,R,F,L,G)=>{const Z=b.transform;return o.e(_h(g,t,r,c,d,_,b,M,T,I,R,F,G),{u_gamma_scale:c?Math.cos(Z.pitch*Math.PI/180)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:1})},_f=(g,t,r,c,d,_,b,M,T,I,R,F,L)=>o.e(Jn(g,t,r,c,d,_,b,M,T,I,!0,R,0,L),{u_texsize_icon:F,u_texture_icon:1}),qo=(g,t)=>({u_opacity:g,u_color:t}),yf=(g,t,r,c,d)=>o.e(function(_,b,M,T){const I=M.imageManager.getPattern(_.from.toString()),R=M.imageManager.getPattern(_.to.toString()),{width:F,height:L}=M.imageManager.getPixelSize(),G=Math.pow(2,T.tileID.overscaledZ),Z=T.tileSize*Math.pow(2,M.transform.tileZoom)/G,tt=Z*(T.tileID.canonical.x+T.tileID.wrap*G),Q=Z*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[F,L],u_mix:b.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/o.aB(T,1,M.transform.tileZoom),u_pixel_coord_upper:[tt>>16,Q>>16],u_pixel_coord_lower:[65535&tt,65535&Q]}}(r,d,t,c),{u_opacity:g}),fu=(g,t)=>{},pu={fillExtrusion:(g,t)=>({u_lightpos:new o.bS(g,t.u_lightpos),u_lightpos_globe:new o.bS(g,t.u_lightpos_globe),u_lightintensity:new o.bf(g,t.u_lightintensity),u_lightcolor:new o.bS(g,t.u_lightcolor),u_vertical_gradient:new o.bf(g,t.u_vertical_gradient),u_opacity:new o.bf(g,t.u_opacity),u_fill_translate:new o.bT(g,t.u_fill_translate)}),fillExtrusionPattern:(g,t)=>({u_lightpos:new o.bS(g,t.u_lightpos),u_lightpos_globe:new o.bS(g,t.u_lightpos_globe),u_lightintensity:new o.bf(g,t.u_lightintensity),u_lightcolor:new o.bS(g,t.u_lightcolor),u_vertical_gradient:new o.bf(g,t.u_vertical_gradient),u_height_factor:new o.bf(g,t.u_height_factor),u_opacity:new o.bf(g,t.u_opacity),u_fill_translate:new o.bT(g,t.u_fill_translate),u_image:new o.bO(g,t.u_image),u_texsize:new o.bT(g,t.u_texsize),u_pixel_coord_upper:new o.bT(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(g,t.u_pixel_coord_lower),u_scale:new o.bS(g,t.u_scale),u_fade:new o.bf(g,t.u_fade)}),fill:(g,t)=>({u_fill_translate:new o.bT(g,t.u_fill_translate)}),fillPattern:(g,t)=>({u_image:new o.bO(g,t.u_image),u_texsize:new o.bT(g,t.u_texsize),u_pixel_coord_upper:new o.bT(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(g,t.u_pixel_coord_lower),u_scale:new o.bS(g,t.u_scale),u_fade:new o.bf(g,t.u_fade),u_fill_translate:new o.bT(g,t.u_fill_translate)}),fillOutline:(g,t)=>({u_world:new o.bT(g,t.u_world),u_fill_translate:new o.bT(g,t.u_fill_translate)}),fillOutlinePattern:(g,t)=>({u_world:new o.bT(g,t.u_world),u_image:new o.bO(g,t.u_image),u_texsize:new o.bT(g,t.u_texsize),u_pixel_coord_upper:new o.bT(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(g,t.u_pixel_coord_lower),u_scale:new o.bS(g,t.u_scale),u_fade:new o.bf(g,t.u_fade),u_fill_translate:new o.bT(g,t.u_fill_translate)}),circle:(g,t)=>({u_camera_to_center_distance:new o.bf(g,t.u_camera_to_center_distance),u_scale_with_map:new o.bO(g,t.u_scale_with_map),u_pitch_with_map:new o.bO(g,t.u_pitch_with_map),u_extrude_scale:new o.bT(g,t.u_extrude_scale),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_globe_extrude_scale:new o.bf(g,t.u_globe_extrude_scale),u_translate:new o.bT(g,t.u_translate)}),collisionBox:(g,t)=>({u_pixel_extrude_scale:new o.bT(g,t.u_pixel_extrude_scale)}),collisionCircle:(g,t)=>({u_viewport_size:new o.bT(g,t.u_viewport_size)}),debug:(g,t)=>({u_color:new o.bP(g,t.u_color),u_overlay:new o.bO(g,t.u_overlay),u_overlay_scale:new o.bf(g,t.u_overlay_scale)}),depth:fu,clippingMask:fu,heatmap:(g,t)=>({u_extrude_scale:new o.bf(g,t.u_extrude_scale),u_intensity:new o.bf(g,t.u_intensity),u_globe_extrude_scale:new o.bf(g,t.u_globe_extrude_scale)}),heatmapTexture:(g,t)=>({u_matrix:new o.bQ(g,t.u_matrix),u_world:new o.bT(g,t.u_world),u_image:new o.bO(g,t.u_image),u_color_ramp:new o.bO(g,t.u_color_ramp),u_opacity:new o.bf(g,t.u_opacity)}),hillshade:(g,t)=>({u_image:new o.bO(g,t.u_image),u_latrange:new o.bT(g,t.u_latrange),u_exaggeration:new o.bf(g,t.u_exaggeration),u_altitudes:new o.bZ(g,t.u_altitudes),u_azimuths:new o.bZ(g,t.u_azimuths),u_accent:new o.bP(g,t.u_accent),u_method:new o.bO(g,t.u_method),u_shadows:new o.bY(g,t.u_shadows),u_highlights:new o.bY(g,t.u_highlights)}),hillshadePrepare:(g,t)=>({u_matrix:new o.bQ(g,t.u_matrix),u_image:new o.bO(g,t.u_image),u_dimension:new o.bT(g,t.u_dimension),u_zoom:new o.bf(g,t.u_zoom),u_unpack:new o.bR(g,t.u_unpack)}),colorRelief:(g,t)=>({u_image:new o.bO(g,t.u_image),u_unpack:new o.bR(g,t.u_unpack),u_dimension:new o.bT(g,t.u_dimension),u_elevation_stops:new o.bO(g,t.u_elevation_stops),u_color_stops:new o.bO(g,t.u_color_stops),u_opacity:new o.bf(g,t.u_opacity)}),line:(g,t)=>({u_translation:new o.bT(g,t.u_translation),u_ratio:new o.bf(g,t.u_ratio),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_units_to_pixels:new o.bT(g,t.u_units_to_pixels)}),lineGradient:(g,t)=>({u_translation:new o.bT(g,t.u_translation),u_ratio:new o.bf(g,t.u_ratio),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_units_to_pixels:new o.bT(g,t.u_units_to_pixels),u_image:new o.bO(g,t.u_image),u_image_height:new o.bf(g,t.u_image_height)}),linePattern:(g,t)=>({u_translation:new o.bT(g,t.u_translation),u_texsize:new o.bT(g,t.u_texsize),u_ratio:new o.bf(g,t.u_ratio),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_image:new o.bO(g,t.u_image),u_units_to_pixels:new o.bT(g,t.u_units_to_pixels),u_scale:new o.bS(g,t.u_scale),u_fade:new o.bf(g,t.u_fade)}),lineSDF:(g,t)=>({u_translation:new o.bT(g,t.u_translation),u_ratio:new o.bf(g,t.u_ratio),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_units_to_pixels:new o.bT(g,t.u_units_to_pixels),u_patternscale_a:new o.bT(g,t.u_patternscale_a),u_patternscale_b:new o.bT(g,t.u_patternscale_b),u_sdfgamma:new o.bf(g,t.u_sdfgamma),u_image:new o.bO(g,t.u_image),u_tex_y_a:new o.bf(g,t.u_tex_y_a),u_tex_y_b:new o.bf(g,t.u_tex_y_b),u_mix:new o.bf(g,t.u_mix)}),raster:(g,t)=>({u_tl_parent:new o.bT(g,t.u_tl_parent),u_scale_parent:new o.bf(g,t.u_scale_parent),u_buffer_scale:new o.bf(g,t.u_buffer_scale),u_fade_t:new o.bf(g,t.u_fade_t),u_opacity:new o.bf(g,t.u_opacity),u_image0:new o.bO(g,t.u_image0),u_image1:new o.bO(g,t.u_image1),u_brightness_low:new o.bf(g,t.u_brightness_low),u_brightness_high:new o.bf(g,t.u_brightness_high),u_saturation_factor:new o.bf(g,t.u_saturation_factor),u_contrast_factor:new o.bf(g,t.u_contrast_factor),u_spin_weights:new o.bS(g,t.u_spin_weights),u_coords_top:new o.bR(g,t.u_coords_top),u_coords_bottom:new o.bR(g,t.u_coords_bottom)}),symbolIcon:(g,t)=>({u_is_size_zoom_constant:new o.bO(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(g,t.u_is_size_feature_constant),u_size_t:new o.bf(g,t.u_size_t),u_size:new o.bf(g,t.u_size),u_camera_to_center_distance:new o.bf(g,t.u_camera_to_center_distance),u_pitch:new o.bf(g,t.u_pitch),u_rotate_symbol:new o.bO(g,t.u_rotate_symbol),u_aspect_ratio:new o.bf(g,t.u_aspect_ratio),u_fade_change:new o.bf(g,t.u_fade_change),u_label_plane_matrix:new o.bQ(g,t.u_label_plane_matrix),u_coord_matrix:new o.bQ(g,t.u_coord_matrix),u_is_text:new o.bO(g,t.u_is_text),u_pitch_with_map:new o.bO(g,t.u_pitch_with_map),u_is_along_line:new o.bO(g,t.u_is_along_line),u_is_variable_anchor:new o.bO(g,t.u_is_variable_anchor),u_texsize:new o.bT(g,t.u_texsize),u_texture:new o.bO(g,t.u_texture),u_translation:new o.bT(g,t.u_translation),u_pitched_scale:new o.bf(g,t.u_pitched_scale)}),symbolSDF:(g,t)=>({u_is_size_zoom_constant:new o.bO(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(g,t.u_is_size_feature_constant),u_size_t:new o.bf(g,t.u_size_t),u_size:new o.bf(g,t.u_size),u_camera_to_center_distance:new o.bf(g,t.u_camera_to_center_distance),u_pitch:new o.bf(g,t.u_pitch),u_rotate_symbol:new o.bO(g,t.u_rotate_symbol),u_aspect_ratio:new o.bf(g,t.u_aspect_ratio),u_fade_change:new o.bf(g,t.u_fade_change),u_label_plane_matrix:new o.bQ(g,t.u_label_plane_matrix),u_coord_matrix:new o.bQ(g,t.u_coord_matrix),u_is_text:new o.bO(g,t.u_is_text),u_pitch_with_map:new o.bO(g,t.u_pitch_with_map),u_is_along_line:new o.bO(g,t.u_is_along_line),u_is_variable_anchor:new o.bO(g,t.u_is_variable_anchor),u_texsize:new o.bT(g,t.u_texsize),u_texture:new o.bO(g,t.u_texture),u_gamma_scale:new o.bf(g,t.u_gamma_scale),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_is_halo:new o.bO(g,t.u_is_halo),u_translation:new o.bT(g,t.u_translation),u_pitched_scale:new o.bf(g,t.u_pitched_scale)}),symbolTextAndIcon:(g,t)=>({u_is_size_zoom_constant:new o.bO(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(g,t.u_is_size_feature_constant),u_size_t:new o.bf(g,t.u_size_t),u_size:new o.bf(g,t.u_size),u_camera_to_center_distance:new o.bf(g,t.u_camera_to_center_distance),u_pitch:new o.bf(g,t.u_pitch),u_rotate_symbol:new o.bO(g,t.u_rotate_symbol),u_aspect_ratio:new o.bf(g,t.u_aspect_ratio),u_fade_change:new o.bf(g,t.u_fade_change),u_label_plane_matrix:new o.bQ(g,t.u_label_plane_matrix),u_coord_matrix:new o.bQ(g,t.u_coord_matrix),u_is_text:new o.bO(g,t.u_is_text),u_pitch_with_map:new o.bO(g,t.u_pitch_with_map),u_is_along_line:new o.bO(g,t.u_is_along_line),u_is_variable_anchor:new o.bO(g,t.u_is_variable_anchor),u_texsize:new o.bT(g,t.u_texsize),u_texsize_icon:new o.bT(g,t.u_texsize_icon),u_texture:new o.bO(g,t.u_texture),u_texture_icon:new o.bO(g,t.u_texture_icon),u_gamma_scale:new o.bf(g,t.u_gamma_scale),u_device_pixel_ratio:new o.bf(g,t.u_device_pixel_ratio),u_is_halo:new o.bO(g,t.u_is_halo),u_translation:new o.bT(g,t.u_translation),u_pitched_scale:new o.bf(g,t.u_pitched_scale)}),background:(g,t)=>({u_opacity:new o.bf(g,t.u_opacity),u_color:new o.bP(g,t.u_color)}),backgroundPattern:(g,t)=>({u_opacity:new o.bf(g,t.u_opacity),u_image:new o.bO(g,t.u_image),u_pattern_tl_a:new o.bT(g,t.u_pattern_tl_a),u_pattern_br_a:new o.bT(g,t.u_pattern_br_a),u_pattern_tl_b:new o.bT(g,t.u_pattern_tl_b),u_pattern_br_b:new o.bT(g,t.u_pattern_br_b),u_texsize:new o.bT(g,t.u_texsize),u_mix:new o.bf(g,t.u_mix),u_pattern_size_a:new o.bT(g,t.u_pattern_size_a),u_pattern_size_b:new o.bT(g,t.u_pattern_size_b),u_scale_a:new o.bf(g,t.u_scale_a),u_scale_b:new o.bf(g,t.u_scale_b),u_pixel_coord_upper:new o.bT(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(g,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bf(g,t.u_tile_units_to_pixels)}),terrain:(g,t)=>({u_texture:new o.bO(g,t.u_texture),u_ele_delta:new o.bf(g,t.u_ele_delta),u_fog_matrix:new o.bQ(g,t.u_fog_matrix),u_fog_color:new o.bP(g,t.u_fog_color),u_fog_ground_blend:new o.bf(g,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bf(g,t.u_fog_ground_blend_opacity),u_horizon_color:new o.bP(g,t.u_horizon_color),u_horizon_fog_blend:new o.bf(g,t.u_horizon_fog_blend),u_is_globe_mode:new o.bf(g,t.u_is_globe_mode)}),terrainDepth:(g,t)=>({u_ele_delta:new o.bf(g,t.u_ele_delta)}),terrainCoords:(g,t)=>({u_texture:new o.bO(g,t.u_texture),u_terrain_coords_id:new o.bf(g,t.u_terrain_coords_id),u_ele_delta:new o.bf(g,t.u_ele_delta)}),projectionErrorMeasurement:(g,t)=>({u_input:new o.bf(g,t.u_input),u_output_expected:new o.bf(g,t.u_output_expected)}),atmosphere:(g,t)=>({u_sun_pos:new o.bS(g,t.u_sun_pos),u_atmosphere_blend:new o.bf(g,t.u_atmosphere_blend),u_globe_position:new o.bS(g,t.u_globe_position),u_globe_radius:new o.bf(g,t.u_globe_radius),u_inv_proj_matrix:new o.bQ(g,t.u_inv_proj_matrix)}),sky:(g,t)=>({u_sky_color:new o.bP(g,t.u_sky_color),u_horizon_color:new o.bP(g,t.u_horizon_color),u_horizon:new o.bT(g,t.u_horizon),u_horizon_normal:new o.bT(g,t.u_horizon_normal),u_sky_horizon_blend:new o.bf(g,t.u_sky_horizon_blend),u_sky_blend:new o.bf(g,t.u_sky_blend)})};class mu{constructor(t,r,c){this.context=t;const d=t.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yh{constructor(t,r,c,d){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=d,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let c=0;c<this.attributes.length;c++){const d=r.attributes[this.attributes[c].name];d!==void 0&&t.enableVertexAttribArray(d)}}setVertexAttribPointers(t,r,c){for(let d=0;d<this.attributes.length;d++){const _=this.attributes[d],b=r.attributes[_.name];b!==void 0&&t.vertexAttribPointer(b,_.components,t[gu[_.type]],!1,this.itemSize,_.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $o extends vi{getDefault(){return o.be.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vs extends vi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class vh extends vi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class xh extends vi{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bh extends vi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class _u extends vi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class wh extends vi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Cn extends vi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Mh extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class vf extends vi{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class xf extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class bf extends vi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class wf extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class yu extends vi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Mf extends vi{getDefault(){return o.be.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class vu extends vi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Zo extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class Wo extends vi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ho extends vi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Sh extends vi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class An extends vi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ha extends vi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Qn extends vi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class us extends vi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class xu extends vi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class bu extends vi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Th extends vi{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rn extends vi{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const c=this.gl;zr(c)?c.bindVertexArray(t):(r=c.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Xo extends vi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ko extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Xa extends vi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ta extends vi{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class wu extends ta{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ea extends ta{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ia extends ta{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Ph="Framebuffer is not complete";class Eh{constructor(t,r,c,d,_){this.context=t,this.width=r,this.height=c;const b=t.gl,M=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new wu(t,M),d)this.depthAttachment=_?new ia(t,M):new ea(t,M);else if(_)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error(Ph)}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class ni{constructor(t){var r,c;if(this.gl=t,this.clearColor=new $o(this),this.clearDepth=new Vs(this),this.clearStencil=new vh(this),this.colorMask=new xh(this),this.depthMask=new bh(this),this.stencilMask=new _u(this),this.stencilFunc=new wh(this),this.stencilOp=new Cn(this),this.stencilTest=new Mh(this),this.depthRange=new vf(this),this.depthTest=new xf(this),this.depthFunc=new bf(this),this.blend=new wf(this),this.blendFunc=new yu(this),this.blendColor=new Mf(this),this.blendEquation=new vu(this),this.cullFace=new Zo(this),this.cullFaceSide=new Wo(this),this.frontFace=new Ho(this),this.program=new Sh(this),this.activeTexture=new An(this),this.viewport=new Ha(this),this.bindFramebuffer=new Qn(this),this.bindRenderbuffer=new us(this),this.bindTexture=new xu(this),this.bindVertexBuffer=new bu(this),this.bindElementBuffer=new Th(this),this.bindVertexArray=new Rn(this),this.pixelStoreUnpack=new Xo(this),this.pixelStoreUnpackPremultiplyAlpha=new Ko(this),this.pixelStoreUnpackFlipY=new Xa(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),zr(t)){this.HALF_FLOAT=t.HALF_FLOAT;const d=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:d==null?void 0:d.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const d=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new mu(this,t,r)}createVertexBuffer(t,r,c){return new yh(this,t,r,c)}createRenderbuffer(t,r,c){const d=this.gl,_=d.createRenderbuffer();return this.bindRenderbuffer.set(_),d.renderbufferStorage(d.RENDERBUFFER,t,r,c),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,c,d){return new Eh(this,t,r,c,d)}clear({color:t,depth:r,stencil:c}){const d=this.gl;let _=0;t&&(_|=d.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(_|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(_|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),d.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bG(t.blendFunction,ci.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return zr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return zr(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let kn;function Mu(g,t,r,c,d){const _=g.context,b=g.transform,M=_.gl,T=g.useProgram("collisionBox"),I=[];let R=0,F=0;for(let et=0;et<c.length;et++){const st=c[et],ht=t.getTile(st).getBucket(r);if(!ht)continue;const at=d?ht.textCollisionBox:ht.iconCollisionBox,dt=ht.collisionCircleArray;dt.length>0&&(I.push({circleArray:dt,circleOffset:F,coord:st}),R+=dt.length/4,F=R),at&&T.draw(_,M.LINES,Qe.disabled,Fe.disabled,g.colorModeForRenderPass(),He.disabled,$a(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(st),b.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,g.transform.zoom,null,null,at.collisionVertexBuffer)}if(!d||!I.length)return;const L=g.useProgram("collisionCircle"),G=new o.b_;G.resize(4*R),G._trim();let Z=0;for(const et of I)for(let st=0;st<et.circleArray.length/4;st++){const ht=4*st,at=et.circleArray[ht+0],dt=et.circleArray[ht+1],pt=et.circleArray[ht+2],ot=et.circleArray[ht+3];G.emplace(Z++,at,dt,pt,ot,0),G.emplace(Z++,at,dt,pt,ot,1),G.emplace(Z++,at,dt,pt,ot,2),G.emplace(Z++,at,dt,pt,ot,3)}(!kn||kn.length<2*R)&&(kn=function(et){const st=2*et,ht=new o.c0;ht.resize(st),ht._trim();for(let at=0;at<st;at++){const dt=6*at;ht.uint16[dt+0]=4*at+0,ht.uint16[dt+1]=4*at+1,ht.uint16[dt+2]=4*at+2,ht.uint16[dt+3]=4*at+2,ht.uint16[dt+4]=4*at+3,ht.uint16[dt+5]=4*at+0}return ht}(R));const tt=_.createIndexBuffer(kn,!0),Q=_.createVertexBuffer(G,o.b$.members,!0);for(const et of I){const st=Za(g.transform);L.draw(_,M.TRIANGLES,Qe.disabled,Fe.disabled,g.colorModeForRenderPass(),He.disabled,st,g.style.map.terrain&&g.style.map.terrain.getTerrainData(et.coord),null,r.id,Q,tt,o.aL.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,g.transform.zoom,null,null,null)}Q.destroy(),tt.destroy()}const Su=o.af(new Float32Array(16));function Ka(g,t,r,c,d,_){const{horizontalAlign:b,verticalAlign:M}=o.aG(g);return new o.P((-(b-.5)*t/d+c[0])*_,(-(M-.5)*r/d+c[1])*_)}function Sf(g,t,r,c,d,_){const b=t.tileAnchorPoint.add(new o.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let M=c.mult(_);r||(M=M.rotate(-d));const T=b.add(M);return oi(T.x,T.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(r){const M=Yt(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(g),T=Math.atan(M.y/M.x)+(M.x<0?Math.PI:0);return g.add(c.rotate(T))}return g.add(c)}function Tf(g,t,r,c,d,_,b,M,T,I,R,F){const L=g.text.placedSymbolArray,G=g.text.dynamicLayoutVertexArray,Z=g.icon.dynamicLayoutVertexArray,tt={};G.clear();for(let Q=0;Q<L.length;Q++){const et=L.get(Q),st=et.hidden||!et.crossTileID||g.allowVerticalPlacement&&!et.placedOrientation?null:c[et.crossTileID];if(st){const ht=new o.P(et.anchorX,et.anchorY),at={getElevation:F,width:d.width,height:d.height,pitchedLabelPlaneMatrix:_,pitchWithMap:r,transform:d,tileAnchorPoint:ht,translation:I,unwrappedTileID:R},dt=r?Ze(ht.x,ht.y,at):Yt(ht.x,ht.y,at),pt=Ae(d.cameraToCenterDistance,dt.signedDistanceFromCamera);let ot=o.ao(g.textSizeData,M,et)*pt/o.aA;r&&(ot*=g.tilePixelRatio/b);const{width:bt,height:It,anchor:Mt,textOffset:Tt,textBoxScale:At}=st,te=Ka(Mt,bt,It,Tt,At,ot),Jt=d.getPitchedTextCorrection(ht.x+I[0],ht.y+I[1],R),Vt=Sf(dt.point,at,t,te,-d.bearingInRadians,Jt),pe=g.allowVerticalPlacement&&et.placedOrientation===o.an.vertical?Math.PI/2:0;for(let ti=0;ti<et.numGlyphs;ti++)o.au(G,Vt,pe);T&&et.associatedIconIndex>=0&&(tt[et.associatedIconIndex]={shiftedAnchor:Vt,angle:pe})}else Bs(et.numGlyphs,G)}if(T){Z.clear();const Q=g.icon.placedSymbolArray;for(let et=0;et<Q.length;et++){const st=Q.get(et);if(st.hidden)Bs(st.numGlyphs,Z);else{const ht=tt[et];if(ht)for(let at=0;at<st.numGlyphs;at++)o.au(Z,ht.shiftedAnchor,ht.angle);else Bs(st.numGlyphs,Z)}}g.icon.dynamicLayoutVertexBuffer.updateData(Z)}g.text.dynamicLayoutVertexBuffer.updateData(G)}function Tu(g,t,r){return r.iconsInText&&t?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Pu(g,t,r,c,d,_,b,M,T,I,R,F,L){const G=g.context,Z=G.gl,tt=g.transform,Q=M==="map",et=T==="map",st=M!=="viewport"&&r.layout.get("symbol-placement")!=="point",ht=Q&&!et&&!st,at=!r.layout.get("symbol-sort-key").isConstant();let dt=!1;const pt=g.getDepthModeForSublayer(0,Qe.ReadOnly),ot=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),bt=[],It=tt.getCircleRadiusCorrection();for(const Mt of c){const Tt=t.getTile(Mt),At=Tt.getBucket(r);if(!At)continue;const te=d?At.text:At.icon;if(!te||!te.segments.get().length||!te.hasVisibleVertices)continue;const Jt=te.programConfigurations.get(r.id),Vt=d||At.sdfIcons,pe=d?At.textSizeData:At.iconSizeData,ti=et||tt.pitch!==0,xi=g.useProgram(Tu(Vt,d,At),Jt),Ui=o.am(pe,tt.zoom),Ti=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Mt);let Vi,Ii,Pi,Ci,wr=[0,0],pi=null;if(d)Ii=Tt.glyphAtlasTexture,Pi=Z.LINEAR,Vi=Tt.glyphAtlasTexture.size,At.iconsInText&&(wr=Tt.imageAtlasTexture.size,pi=Tt.imageAtlasTexture,Ci=ti||g.options.rotating||g.options.zooming||pe.kind==="composite"||pe.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Ki=r.layout.get("icon-size").constantOr(0)!==1||At.iconsNeedLinear;Ii=Tt.imageAtlasTexture,Pi=Vt||g.options.rotating||g.options.zooming||Ki||ti?Z.LINEAR:Z.NEAREST,Vi=Tt.imageAtlasTexture.size}const pr=o.aB(Tt,1,g.transform.zoom),Mr=ze(Q,g.transform,pr),ln=o.L();o.ap(ln,Mr);const hn=wi(et,Q,g.transform,pr),cn=o.aC(tt,Tt,_,b),Ds=tt.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),co=ot&&At.hasTextData(),uo=r.layout.get("icon-text-fit")!=="none"&&co&&At.hasIconData();if(st){const Ki=g.style.map.terrain?(Br,or)=>g.style.map.terrain.getElevation(Mt,Br,or):null,zi=r.layout.get("text-rotation-alignment")==="map";Ji(At,g,d,Mr,ln,et,I,zi,Mt.toUnwrapped(),tt.width,tt.height,cn,Ki)}const pa=d&&ot||uo,Xr=st||pa?Su:et?Mr:g.transform.clipSpaceToPixelsMatrix,ws=Vt&&r.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let un;un=Vt?At.iconsInText?_f(pe.kind,Ui,ht,et,st,pa,g,Xr,hn,cn,Vi,wr,It):Jn(pe.kind,Ui,ht,et,st,pa,g,Xr,hn,cn,d,Vi,0,It):_h(pe.kind,Ui,ht,et,st,pa,g,Xr,hn,cn,d,Vi,It);const Ln={program:xi,buffers:te,uniformValues:un,projectionData:Ds,atlasTexture:Ii,atlasTextureIcon:pi,atlasInterpolation:Pi,atlasInterpolationIcon:Ci,isSDF:Vt,hasHalo:ws};if(at&&At.canOverlap){dt=!0;const Ki=te.segments.get();for(const zi of Ki)bt.push({segments:new o.aL([zi]),sortKey:zi.sortKey,state:Ln,terrainData:Ti})}else bt.push({segments:te.segments,sortKey:0,state:Ln,terrainData:Ti})}dt&&bt.sort((Mt,Tt)=>Mt.sortKey-Tt.sortKey);for(const Mt of bt){const Tt=Mt.state;if(G.activeTexture.set(Z.TEXTURE0),Tt.atlasTexture.bind(Tt.atlasInterpolation,Z.CLAMP_TO_EDGE),Tt.atlasTextureIcon&&(G.activeTexture.set(Z.TEXTURE1),Tt.atlasTextureIcon&&Tt.atlasTextureIcon.bind(Tt.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Tt.isSDF){const At=Tt.uniformValues;Tt.hasHalo&&(At.u_is_halo=1,Yo(Tt.buffers,Mt.segments,r,g,Tt.program,pt,R,F,At,Tt.projectionData,Mt.terrainData)),At.u_is_halo=0}Yo(Tt.buffers,Mt.segments,r,g,Tt.program,pt,R,F,Tt.uniformValues,Tt.projectionData,Mt.terrainData)}}function Yo(g,t,r,c,d,_,b,M,T,I,R){const F=c.context;d.draw(F,F.gl.TRIANGLES,_,b,M,He.backCCW,T,R,I,r.id,g.layoutVertexBuffer,g.indexBuffer,t,r.paint,c.transform.zoom,g.programConfigurations.get(r.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Jo(g,t,r,c,d){const _=g.context,b=_.gl,M=Fe.disabled,T=new ci([b.ONE,b.ONE],o.be.transparent,[!0,!0,!0,!0]),I=t.getBucket(r);if(!I)return;const R=c.key;let F=r.heatmapFbos.get(R);F||(F=Ya(_,t.tileSize,t.tileSize),r.heatmapFbos.set(R,F)),_.bindFramebuffer.set(F.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:o.be.transparent});const L=I.programConfigurations.get(r.id),G=g.useProgram("heatmap",L,!d),Z=g.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),tt=g.style.map.terrain.getTerrainData(c);G.draw(_,b.TRIANGLES,Qe.disabled,M,T,He.disabled,Wa(t,g.transform.zoom,r.paint.get("heatmap-intensity"),1),tt,Z,r.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,r.paint,g.transform.zoom,L)}function Qo(g,t,r,c,d){const _=g.context,b=_.gl,M=g.transform;_.setColorMode(g.colorModeForRenderPass());const T=tl(_,t),I=r.key,R=t.heatmapFbos.get(I);if(!R)return;_.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,R.colorAttachment.get()),_.activeTexture.set(b.TEXTURE1),T.bind(b.LINEAR,b.CLAMP_TO_EDGE);const F=M.getProjectionData({overscaledTileID:r,applyTerrainMatrix:d,applyGlobeMatrix:!c});g.useProgram("heatmapTexture").draw(_,b.TRIANGLES,Qe.disabled,Fe.disabled,g.colorModeForRenderPass(),He.disabled,lu(g,t,0,1),null,F,t.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,t.paint,M.zoom),R.destroy(),t.heatmapFbos.delete(I)}function Ya(g,t,r){var c,d;const _=g.gl,b=_.createTexture();_.bindTexture(_.TEXTURE_2D,b),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const M=(c=g.HALF_FLOAT)!==null&&c!==void 0?c:_.UNSIGNED_BYTE,T=(d=g.RGBA16F)!==null&&d!==void 0?d:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,T,t,r,0,_.RGBA,M,null);const I=g.createFramebuffer(t,r,!1,!1);return I.colorAttachment.set(b),I}function tl(g,t){return t.colorRampTexture||(t.colorRampTexture=new o.T(g,t.colorRamp,g.gl.RGBA)),t.colorRampTexture}function Ih(g,t,r,c,d){if(!r||!c||!c.imageAtlas)return;const _=c.imageAtlas.patternPositions;let b=_[r.to.toString()],M=_[r.from.toString()];if(!b&&M&&(b=M),!M&&b&&(M=b),!b||!M){const T=d.getPaintProperty(t);b=_[T],M=_[T]}b&&M&&g.setConstantPatternPositions(b,M)}function Ja(g,t,r,c,d,_,b,M){const T=g.context.gl,I="fill-pattern",R=r.paint.get(I),F=R&&R.constantOr(1),L=r.getCrossfadeParameters();let G,Z,tt,Q,et;const st=g.transform,ht=r.paint.get("fill-translate"),at=r.paint.get("fill-translate-anchor");b?(Z=F&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=T.LINES):(Z=F?"fillPattern":"fill",G=T.TRIANGLES);const dt=R.constantOr(null);for(const pt of c){const ot=t.getTile(pt);if(F&&!ot.patternsLoaded())continue;const bt=ot.getBucket(r);if(!bt)continue;const It=bt.programConfigurations.get(r.id),Mt=g.useProgram(Z,It),Tt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(pt);F&&(g.context.activeTexture.set(T.TEXTURE0),ot.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),It.updatePaintBuffers(L)),Ih(It,I,dt,ot,r);const At=st.getProjectionData({overscaledTileID:pt,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),te=o.aC(st,ot,ht,at);if(b){Q=bt.indexBuffer2,et=bt.segments2;const Vt=[T.drawingBufferWidth,T.drawingBufferHeight];tt=Z==="fillOutlinePattern"&&F?pf(g,L,ot,Vt,te):As(Vt,te)}else Q=bt.indexBuffer,et=bt.segments,tt=F?Uo(g,L,ot,te):{u_fill_translate:te};const Jt=g.stencilModeForClipping(pt);Mt.draw(g.context,G,d,Jt,_,He.backCCW,tt,Tt,At,r.id,bt.layoutVertexBuffer,Q,et,r.paint,g.transform.zoom,It)}}function ra(g,t,r,c,d,_,b,M){const T=g.context,I=T.gl,R="fill-extrusion-pattern",F=r.paint.get(R),L=F.constantOr(1),G=r.getCrossfadeParameters(),Z=r.paint.get("fill-extrusion-opacity"),tt=F.constantOr(null),Q=g.transform;for(const et of c){const st=t.getTile(et),ht=st.getBucket(r);if(!ht)continue;const at=g.style.map.terrain&&g.style.map.terrain.getTerrainData(et),dt=ht.programConfigurations.get(r.id),pt=g.useProgram(L?"fillExtrusionPattern":"fillExtrusion",dt);L&&(g.context.activeTexture.set(I.TEXTURE0),st.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),dt.updatePaintBuffers(G));const ot=Q.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!M,applyTerrainMatrix:!0});Ih(dt,R,tt,st,r);const bt=o.aC(Q,st,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),It=r.paint.get("fill-extrusion-vertical-gradient"),Mt=L?dh(g,It,Z,bt,et,G,st):qa(g,It,Z,bt);pt.draw(T,T.gl.TRIANGLES,d,_,b,He.backCCW,Mt,at,ot,r.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,r.paint,g.transform.zoom,dt,g.style.map.terrain&&ht.centroidVertexBuffer)}}function sa(g,t,r,c,d,_,b,M,T){var I;const R=g.style.projection,F=g.context,L=g.transform,G=F.gl,Z=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],tt=g.useProgram("hillshade",null,!1,Z),Q=!g.options.moving;for(const et of c){const st=t.getTile(et),ht=st.fbo;if(!ht)continue;const at=R.getMeshFromTileID(F,et.canonical,M,!0,"raster"),dt=(I=g.style.map.terrain)===null||I===void 0?void 0:I.getTerrainData(et);F.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,ht.colorAttachment.get());const pt=L.getProjectionData({overscaledTileID:et,aligned:Q,applyGlobeMatrix:!T,applyTerrainMatrix:!0});tt.draw(F,G.TRIANGLES,_,d[et.overscaledZ],b,He.backCCW,Yn(g,st,r),dt,pt,r.id,at.vertexBuffer,at.indexBuffer,at.segments)}}function Qa(g,t,r,c,d,_,b,M,T){var I;const R=g.style.projection,F=g.context,L=g.transform,G=F.gl,Z=g.useProgram("colorRelief"),tt=!g.options.moving;let Q=!0;for(const et of c){const st=t.getTile(et),ht=st.dem;if(Q){const It=G.getParameter(G.MAX_TEXTURE_SIZE),{elevationTexture:Mt,colorTexture:Tt}=r.getColorRampTextures(F,It,ht.getUnpackVector());F.activeTexture.set(G.TEXTURE1),Mt.bind(G.NEAREST,G.CLAMP_TO_EDGE),F.activeTexture.set(G.TEXTURE4),Tt.bind(G.LINEAR,G.CLAMP_TO_EDGE),Q=!1}if(!ht||!ht.data)continue;const at=ht.stride,dt=ht.getPixels();if(F.activeTexture.set(G.TEXTURE0),F.pixelStoreUnpackPremultiplyAlpha.set(!1),st.demTexture=st.demTexture||g.getTileTexture(at),st.demTexture){const It=st.demTexture;It.update(dt,{premultiply:!1}),It.bind(G.LINEAR,G.CLAMP_TO_EDGE)}else st.demTexture=new o.T(F,dt,G.RGBA,{premultiply:!1}),st.demTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const pt=R.getMeshFromTileID(F,et.canonical,M,!0,"raster"),ot=(I=g.style.map.terrain)===null||I===void 0?void 0:I.getTerrainData(et),bt=L.getProjectionData({overscaledTileID:et,aligned:tt,applyGlobeMatrix:!T,applyTerrainMatrix:!0});Z.draw(F,G.TRIANGLES,_,d[et.overscaledZ],b,He.backCCW,gf(r,st.dem),ot,bt,r.id,pt.vertexBuffer,pt.indexBuffer,pt.segments)}}const Ch=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function rn(g,t,r,c,d,_,b,M,T=!1,I=!1){const R=c[c.length-1].overscaledZ,F=g.context,L=F.gl,G=g.useProgram("raster"),Z=g.transform,tt=g.style.projection,Q=g.colorModeForRenderPass(),et=!g.options.moving;for(const st of c){const ht=g.getDepthModeForSublayer(st.overscaledZ-R,r.paint.get("raster-opacity")===1?Qe.ReadWrite:Qe.ReadOnly,L.LESS),at=t.getTile(st);at.registerFadeDuration(r.paint.get("raster-fade-duration"));const dt=t.findLoadedParent(st,0),pt=t.findLoadedSibling(st),ot=Pf(at,dt||pt||null,t,r,g.transform,g.style.map.terrain);let bt,It;const Mt=r.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;F.activeTexture.set(L.TEXTURE0),at.texture.bind(Mt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(L.TEXTURE1),dt?(dt.texture.bind(Mt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),bt=Math.pow(2,dt.tileID.overscaledZ-at.tileID.overscaledZ),It=[at.tileID.canonical.x*bt%1,at.tileID.canonical.y*bt%1]):at.texture.bind(Mt,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),at.texture.useMipmap&&F.extTextureFilterAnisotropic&&g.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const Tt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(st),At=Z.getProjectionData({overscaledTileID:st,aligned:et,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),te=In(It||[0,0],bt||1,ot,r,M),Jt=tt.getMeshFromTileID(F,st.canonical,_,b,"raster");G.draw(F,L.TRIANGLES,ht,d?d[st.overscaledZ]:Fe.disabled,Q,T?He.frontCCW:He.backCCW,te,Tt,At,r.id,Jt.vertexBuffer,Jt.indexBuffer,Jt.segments)}}function Pf(g,t,r,c,d,_){const b=c.paint.get("raster-fade-duration");if(!_&&b>0){const M=k.now(),T=(M-g.timeAdded)/b,I=t?(M-t.timeAdded)/b:-1,R=r.getSource(),F=Lt(d,{tileSize:R.tileSize,roundZoom:R.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-F)>Math.abs(g.tileID.overscaledZ-F),G=L&&g.refreshedUponExpiration?1:o.ag(L?T:1-I,0,1);return g.refreshedUponExpiration&&T>=1&&(g.refreshedUponExpiration=!1),t?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const Eu=new o.be(1,0,0,1),el=new o.be(0,1,0,1),Ah=new o.be(0,0,1,1),Iu=new o.be(1,0,1,1),Cu=new o.be(0,1,1,1);function to(g,t,r,c){rl(g,0,t+r/2,g.transform.width,r,c)}function il(g,t,r,c){rl(g,t-r/2,0,r,g.transform.height,c)}function rl(g,t,r,c,d,_){const b=g.context,M=b.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*g.pixelRatio,r*g.pixelRatio,c*g.pixelRatio,d*g.pixelRatio),b.clear({color:_}),M.disable(M.SCISSOR_TEST)}function Au(g,t,r){const c=g.context,d=c.gl,_=g.useProgram("debug"),b=Qe.disabled,M=Fe.disabled,T=g.colorModeForRenderPass(),I="$debug",R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(r);c.activeTexture.set(d.TEXTURE0);const F=t.getTileByID(r.key).latestRawTileData,L=Math.floor((F&&F.byteLength||0)/1024),G=t.getTile(r).tileSize,Z=512/Math.min(G,512)*(r.overscaledZ/g.transform.zoom)*.5;let tt=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(tt+=` => ${r.overscaledZ}`),function(et,st){et.initDebugOverlayCanvas();const ht=et.debugOverlayCanvas,at=et.context.gl,dt=et.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,ht.width,ht.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(st,5,5),dt.strokeText(st,5,5),et.debugOverlayTexture.update(ht),et.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)}(g,`${tt} ${L}kB`);const Q=g.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(c,d.TRIANGLES,b,M,ci.alphaBlended,He.disabled,ou(o.be.transparent,Z),null,Q,I,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),_.draw(c,d.LINE_STRIP,b,M,T,He.disabled,ou(o.be.red),R,Q,I,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function Zi(g,t,r,c){const{isRenderingGlobe:d}=c,_=g.context,b=_.gl,M=g.transform,T=g.colorModeForRenderPass(),I=g.getDepthModeFor3D(),R=g.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,g.width,g.height]);for(const F of r){const L=t.getTerrainMesh(F.tileID),G=g.renderToTexture.getTexture(F),Z=t.getTerrainData(F.tileID);_.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,G.texture);const tt=t.getMeshFrameDelta(M.zoom),Q=M.calculateFogMatrix(F.tileID.toUnwrapped()),et=df(tt,Q,g.style.sky,M.pitch,d),st=M.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});R.draw(_,b.TRIANGLES,I,Fe.disabled,T,He.backCCW,et,Z,st,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}function sn(g,t){if(!t.mesh){const r=new o.aK;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const c=new o.aM;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),t.mesh=new Gs(g.createVertexBuffer(r,js.members),g.createIndexBuffer(c),o.aL.simpleSegment(0,0,r.length,c.length))}return t.mesh}class ds{constructor(t,r){this.context=new ni(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Nt.maxUnderzooming+Nt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Lo}resize(t,r,c){if(this.width=Math.floor(t*c),this.height=Math.floor(r*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const t=this.context,r=new o.aK;r.emplaceBack(0,0),r.emplaceBack(o.$,0),r.emplaceBack(0,o.$),r.emplaceBack(o.$,o.$),this.tileExtentBuffer=t.createVertexBuffer(r,js.members),this.tileExtentSegments=o.aL.simpleSegment(0,0,4,2);const c=new o.aK;c.emplaceBack(0,0),c.emplaceBack(o.$,0),c.emplaceBack(0,o.$),c.emplaceBack(o.$,o.$),this.debugBuffer=t.createVertexBuffer(c,js.members),this.debugSegments=o.aL.simpleSegment(0,0,4,5);const d=new o.c5;d.emplaceBack(0,0,0,0),d.emplaceBack(o.$,0,o.$,0),d.emplaceBack(0,o.$,0,o.$),d.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=t.createVertexBuffer(d,cf.members),this.rasterBoundsSegments=o.aL.simpleSegment(0,0,4,2);const _=new o.aK;_.emplaceBack(0,0),_.emplaceBack(o.$,0),_.emplaceBack(0,o.$),_.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,js.members),this.rasterBoundsSegmentsPosOnly=o.aL.simpleSegment(0,0,4,5);const b=new o.aK;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,js.members),this.viewportSegments=o.aL.simpleSegment(0,0,4,2);const M=new o.c6;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(M);const T=new o.aM;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const I=this.context.gl;this.stencilClearMode=new Fe({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.tileExtentMesh=new Gs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=o.L();o.bX(c,0,this.width,this.height,0,0,1),o.N(c,c,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const d={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(t,r.TRIANGLES,Qe.disabled,this.stencilClearMode,ci.disabled,He.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r,c){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source,this.nextStencilID+r.length>256&&this.clearStencil();const d=this.context;d.setColorMode(ci.disabled),d.setDepthMode(Qe.disabled);const _={};for(const b of r)_[b.key]=this.nextStencilID++;this._renderTileMasks(_,r,c,!0),this._renderTileMasks(_,r,c,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,r,c,d){const _=this.context,b=_.gl,M=this.style.projection,T=this.transform,I=this.useProgram("clippingMask");for(const R of r){const F=t[R.key],L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),G=M.getMeshFromTileID(this.context,R.canonical,d,!0,"stencil"),Z=T.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!c,applyTerrainMatrix:!0});I.draw(_,b.TRIANGLES,Qe.disabled,new Fe({func:b.ALWAYS,mask:0},F,255,b.KEEP,b.KEEP,b.REPLACE),ci.disabled,c?He.disabled:He.backCCW,null,L,Z,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}_renderTilesDepthBuffer(){const t=this.context,r=t.gl,c=this.style.projection,d=this.transform,_=this.useProgram("depth"),b=this.getDepthModeFor3D(),M=Rt(d,{tileSize:d.tileSize});for(const T of M){const I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),R=c.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),F=d.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,r.TRIANGLES,b,Fe.disabled,ci.disabled,He.backCCW,null,I,F,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Fe({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new Fe({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const r=this.context.gl,c=t.sort((b,M)=>M.overscaledZ-b.overscaledZ),d=c[c.length-1].overscaledZ,_=c[0].overscaledZ-d+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const b={};for(let M=0;M<_;M++)b[M+d]=new Fe({func:r.GEQUAL,mask:255},M+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[b,c]}return[{[d]:Fe.disabled},c]}stencilConfigForOverlapTwoPass(t){const r=this.context.gl,c=t.sort((b,M)=>M.overscaledZ-b.overscaledZ),d=c[c.length-1].overscaledZ,_=c[0].overscaledZ-d+1;if(this.clearStencil(),_>1){const b={},M={};for(let T=0;T<_;T++)b[T+d]=new Fe({func:r.GREATER,mask:255},_+1+T,255,r.KEEP,r.KEEP,r.REPLACE),M[T+d]=new Fe({func:r.GREATER,mask:255},1+T,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*_+1,[b,M,c]}return this.nextStencilID=3,[{[d]:new Fe({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[d]:new Fe({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ci([t.CONSTANT_COLOR,t.ONE],new o.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ci.unblended:ci.alphaBlended}getDepthModeForSublayer(t,r,c){if(!this.opaquePassEnabledForLayer())return Qe.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Qe(c||this.context.gl.LEQUAL,r,[d,d])}getDepthModeFor3D(){return new Qe(this.context.gl.LEQUAL,Qe.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){var c,d;this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(k.now()),this.imageManager.beginFrame();const _=this.style._order,b=this.style.sourceCaches,M={},T={},I={},R={isRenderingToTexture:!1,isRenderingGlobe:((c=t.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const L in b){const G=b[L];G.used&&G.prepare(this.context),M[L]=G.getVisibleCoordinates(!1),T[L]=M[L].slice().reverse(),I[L]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<_.length;L++)if(this.style._layers[_[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of _){const G=this.style._layers[L];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const Z=T[G.source];(G.type==="custom"||Z.length)&&this.renderLayer(this,b[G.source],G,Z,R)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:L=>this.useProgram(L)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?o.be.black:o.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(L,G){const Z=L.context,tt=Z.gl,Q=((pt,ot,bt)=>{const It=Math.cos(ot.rollInRadians),Mt=Math.sin(ot.rollInRadians),Tt=H(ot),At=ot.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:pt.properties.get("sky-color"),u_horizon_color:pt.properties.get("horizon-color"),u_horizon:[(ot.width/2-Tt*Mt)*bt,(ot.height/2+Tt*It)*bt],u_horizon_normal:[-Mt,It],u_sky_horizon_blend:pt.properties.get("sky-horizon-blend")*ot.height/2*bt,u_sky_blend:At}})(G,L.style.map.transform,L.pixelRatio),et=new Qe(tt.LEQUAL,Qe.ReadWrite,[0,1]),st=Fe.disabled,ht=L.colorModeForRenderPass(),at=L.useProgram("sky"),dt=sn(Z,G);at.draw(Z,tt.TRIANGLES,et,st,ht,He.disabled,Q,null,void 0,"sky",dt.vertexBuffer,dt.indexBuffer,dt.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[_[this.currentLayer]],G=b[L.source],Z=M[L.source];this._renderTileClippingMasks(L,Z,!1),this.renderLayer(this,G,L,Z,R)}this.renderPass="translucent";let F=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const L=this.style._layers[_[this.currentLayer]],G=b[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L,R))continue;this.opaquePassEnabledForLayer()||F||(F=!0,R.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Z=(L.type==="symbol"?I:T)[L.source];this._renderTileClippingMasks(L,M[L.source],!!this.renderToTexture),this.renderLayer(this,G,L,Z,R)}if(R.isRenderingGlobe&&function(L,G,Z){const tt=L.context,Q=tt.gl,et=L.useProgram("atmosphere"),st=new Qe(Q.LEQUAL,Qe.ReadOnly,[0,1]),ht=L.transform,at=function(At,te){const Jt=At.properties.get("position"),Vt=[-Jt.x,-Jt.y,-Jt.z],pe=o.af(new Float64Array(16));return At.properties.get("anchor")==="map"&&(o.b5(pe,pe,te.rollInRadians),o.b6(pe,pe,-te.pitchInRadians),o.b5(pe,pe,te.bearingInRadians),o.b6(pe,pe,te.center.lat*Math.PI/180),o.by(pe,pe,-te.center.lng*Math.PI/180)),o.c4(Vt,Vt,pe),Vt}(Z,L.transform),dt=ht.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),pt=G.properties.get("atmosphere-blend")*dt.projectionTransition;if(pt===0)return;const ot=$n(ht.worldSize,ht.center.lat),bt=ht.inverseProjectionMatrix,It=new Float64Array(4);It[3]=1,o.av(It,It,ht.modelViewProjectionMatrix),It[0]/=It[3],It[1]/=It[3],It[2]/=It[3],It[3]=1,o.av(It,It,bt),It[0]/=It[3],It[1]/=It[3],It[2]/=It[3],It[3]=1;const Mt=((At,te,Jt,Vt,pe)=>({u_sun_pos:At,u_atmosphere_blend:te,u_globe_position:Jt,u_globe_radius:Vt,u_inv_proj_matrix:pe}))(at,pt,[It[0],It[1],It[2]],ot,bt),Tt=sn(tt,G);et.draw(tt,Q.TRIANGLES,st,Fe.disabled,ci.alphaBlended,He.disabled,Mt,null,null,"atmosphere",Tt.vertexBuffer,Tt.indexBuffer,Tt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const L=function(G,Z){let tt=null;const Q=Object.values(G._layers).flatMap(at=>at.source&&!at.isHidden(Z)?[G.sourceCaches[at.source]]:[]),et=Q.filter(at=>at.getSource().type==="vector"),st=Q.filter(at=>at.getSource().type!=="vector"),ht=at=>{(!tt||tt.getSource().maxzoom<at.getSource().maxzoom)&&(tt=at)};return et.forEach(at=>ht(at)),tt||st.forEach(at=>ht(at)),tt}(this.style,this.transform.zoom);L&&function(G,Z,tt){for(let Q=0;Q<tt.length;Q++)Au(G,Z,tt[Q])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const G=L.transform.padding;to(L,L.transform.height-(G.top||0),3,Eu),to(L,G.bottom||0,3,el),il(L,G.left||0,3,Ah),il(L,L.transform.width-(G.right||0),3,Iu);const Z=L.transform.centerPoint;(function(tt,Q,et,st){rl(tt,Q-1,et-10,2,20,st),rl(tt,Q-10,et-1,20,2,st)})(L,Z.x,L.transform.height-Z.y,Cu)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=t?!o.c7(r,c):!o.c8(r,c)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(o.c9(r,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,b){const M=_.context,T=M.gl,I=_.transform,R=ci.unblended,F=new Qe(T.LEQUAL,Qe.ReadWrite,[0,1]),L=b.sourceCache.getRenderableTiles(),G=_.useProgram("terrainDepth");M.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),M.clear({color:o.be.transparent,depth:1});for(const Z of L){const tt=b.getTerrainMesh(Z.tileID),Q=b.getTerrainData(Z.tileID),et=I.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),st={u_ele_delta:b.getMeshFrameDelta(I.zoom)};G.draw(M,T.TRIANGLES,F,Fe.disabled,R,He.backCCW,st,Q,et,"terrain",tt.vertexBuffer,tt.indexBuffer,tt.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,b){const M=_.context,T=M.gl,I=_.transform,R=ci.unblended,F=new Qe(T.LEQUAL,Qe.ReadWrite,[0,1]),L=b.getCoordsTexture(),G=b.sourceCache.getRenderableTiles(),Z=_.useProgram("terrainCoords");M.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),M.clear({color:o.be.transparent,depth:1}),b.coordsIndex=[];for(const tt of G){const Q=b.getTerrainMesh(tt.tileID),et=b.getTerrainData(tt.tileID);M.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,L.texture);const st={u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(I.zoom)},ht=I.getProjectionData({overscaledTileID:tt.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(M,T.TRIANGLES,F,Fe.disabled,R,He.backCCW,st,et,ht,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),b.coordsIndex.push(tt.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(t,r,c,d,_){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(d||[]).length)&&(this.id=c.id,o.ca(c)?function(b,M,T,I,R,F){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:L}=F,G=Fe.disabled,Z=b.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(tt,Q,et,st,ht,at,dt,pt,ot){const bt=Q.transform,It=Q.style.map.terrain,Mt=ht==="map",Tt=at==="map";for(const At of tt){const te=st.getTile(At),Jt=te.getBucket(et);if(!Jt||!Jt.text||!Jt.text.segments.get().length)continue;const Vt=o.am(Jt.textSizeData,bt.zoom),pe=o.aB(te,1,Q.transform.zoom),ti=ze(Mt,Q.transform,pe),xi=et.layout.get("icon-text-fit")!=="none"&&Jt.hasIconData();if(Vt){const Ui=Math.pow(2,bt.zoom-te.tileID.overscaledZ),Ti=It?(Vi,Ii)=>It.getElevation(At,Vi,Ii):null;Tf(Jt,Mt,Tt,ot,bt,ti,Ui,Vt,xi,o.aC(bt,te,dt,pt),At.toUnwrapped(),Ti)}}}(I,b,T,M,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),R),T.paint.get("icon-opacity").constantOr(1)!==0&&Pu(b,M,T,I,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),G,Z,L),T.paint.get("text-opacity").constantOr(1)!==0&&Pu(b,M,T,I,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),G,Z,L),M.map.showCollisionBoxes&&(Mu(b,M,T,I,!0),Mu(b,M,T,I,!1))}(t,r,c,d,this.style.placement.variableOffsets,_):o.cb(c)?function(b,M,T,I,R){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:F}=R,L=T.paint.get("circle-opacity"),G=T.paint.get("circle-stroke-width"),Z=T.paint.get("circle-stroke-opacity"),tt=!T.layout.get("circle-sort-key").isConstant();if(L.constantOr(1)===0&&(G.constantOr(1)===0||Z.constantOr(1)===0))return;const Q=b.context,et=Q.gl,st=b.transform,ht=b.getDepthModeForSublayer(0,Qe.ReadOnly),at=Fe.disabled,dt=b.colorModeForRenderPass(),pt=[],ot=st.getCircleRadiusCorrection();for(let bt=0;bt<I.length;bt++){const It=I[bt],Mt=M.getTile(It),Tt=Mt.getBucket(T);if(!Tt)continue;const At=T.paint.get("circle-translate"),te=T.paint.get("circle-translate-anchor"),Jt=o.aC(st,Mt,At,te),Vt=Tt.programConfigurations.get(T.id),pe=b.useProgram("circle",Vt),ti=Tt.layoutVertexBuffer,xi=Tt.indexBuffer,Ui=b.style.map.terrain&&b.style.map.terrain.getTerrainData(It),Ti={programConfiguration:Vt,program:pe,layoutVertexBuffer:ti,indexBuffer:xi,uniformValues:fh(b,Mt,T,Jt,ot),terrainData:Ui,projectionData:st.getProjectionData({overscaledTileID:It,applyGlobeMatrix:!F,applyTerrainMatrix:!0})};if(tt){const Vi=Tt.segments.get();for(const Ii of Vi)pt.push({segments:new o.aL([Ii]),sortKey:Ii.sortKey,state:Ti})}else pt.push({segments:Tt.segments,sortKey:0,state:Ti})}tt&&pt.sort((bt,It)=>bt.sortKey-It.sortKey);for(const bt of pt){const{programConfiguration:It,program:Mt,layoutVertexBuffer:Tt,indexBuffer:At,uniformValues:te,terrainData:Jt,projectionData:Vt}=bt.state;Mt.draw(Q,et.TRIANGLES,ht,at,dt,He.backCCW,te,Jt,Vt,T.id,Tt,At,bt.segments,T.paint,b.transform.zoom,It)}}(t,r,c,d,_):o.cc(c)?function(b,M,T,I,R){if(T.paint.get("heatmap-opacity")===0)return;const F=b.context,{isRenderingToTexture:L,isRenderingGlobe:G}=R;if(b.style.map.terrain){for(const Z of I){const tt=M.getTile(Z);M.hasRenderableParent(Z)||(b.renderPass==="offscreen"?Jo(b,tt,T,Z,G):b.renderPass==="translucent"&&Qo(b,T,Z,L,G))}F.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(Z,tt,Q,et){const st=Z.context,ht=st.gl,at=Z.transform,dt=Fe.disabled,pt=new ci([ht.ONE,ht.ONE],o.be.transparent,[!0,!0,!0,!0]);(function(ot,bt,It){const Mt=ot.gl;ot.activeTexture.set(Mt.TEXTURE1),ot.viewport.set([0,0,bt.width/4,bt.height/4]);let Tt=It.heatmapFbos.get(o.c1);Tt?(Mt.bindTexture(Mt.TEXTURE_2D,Tt.colorAttachment.get()),ot.bindFramebuffer.set(Tt.framebuffer)):(Tt=Ya(ot,bt.width/4,bt.height/4),It.heatmapFbos.set(o.c1,Tt))})(st,Z,Q),st.clear({color:o.be.transparent});for(let ot=0;ot<et.length;ot++){const bt=et[ot];if(tt.hasRenderableParent(bt))continue;const It=tt.getTile(bt),Mt=It.getBucket(Q);if(!Mt)continue;const Tt=Mt.programConfigurations.get(Q.id),At=Z.useProgram("heatmap",Tt),te=at.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Jt=at.getCircleRadiusCorrection();At.draw(st,ht.TRIANGLES,Qe.disabled,dt,pt,He.backCCW,Wa(It,at.zoom,Q.paint.get("heatmap-intensity"),Jt),null,te,Q.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,Q.paint,at.zoom,Tt)}st.viewport.set([0,0,Z.width,Z.height])}(b,M,T,I):b.renderPass==="translucent"&&function(Z,tt){const Q=Z.context,et=Q.gl;Q.setColorMode(Z.colorModeForRenderPass());const st=tt.heatmapFbos.get(o.c1);st&&(Q.activeTexture.set(et.TEXTURE0),et.bindTexture(et.TEXTURE_2D,st.colorAttachment.get()),Q.activeTexture.set(et.TEXTURE1),tl(Q,tt).bind(et.LINEAR,et.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(Q,et.TRIANGLES,Qe.disabled,Fe.disabled,Z.colorModeForRenderPass(),He.disabled,lu(Z,tt,0,1),null,null,tt.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,tt.paint,Z.transform.zoom))}(b,T)}(t,r,c,d,_):o.cd(c)?function(b,M,T,I,R){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:F}=R,L=T.paint.get("line-opacity"),G=T.paint.get("line-width");if(L.constantOr(1)===0||G.constantOr(1)===0)return;const Z=b.getDepthModeForSublayer(0,Qe.ReadOnly),tt=b.colorModeForRenderPass(),Q=T.paint.get("line-dasharray"),et=T.paint.get("line-pattern"),st=et.constantOr(1),ht=T.paint.get("line-gradient"),at=T.getCrossfadeParameters(),dt=st?"linePattern":Q?"lineSDF":ht?"lineGradient":"line",pt=b.context,ot=pt.gl,bt=b.transform;let It=!0;for(const Mt of I){const Tt=M.getTile(Mt);if(st&&!Tt.patternsLoaded())continue;const At=Tt.getBucket(T);if(!At)continue;const te=At.programConfigurations.get(T.id),Jt=b.context.program.get(),Vt=b.useProgram(dt,te),pe=It||Vt.program!==Jt,ti=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Mt),xi=et.constantOr(null);if(xi&&Tt.imageAtlas){const Pi=Tt.imageAtlas,Ci=Pi.patternPositions[xi.to.toString()],wr=Pi.patternPositions[xi.from.toString()];Ci&&wr&&te.setConstantPatternPositions(Ci,wr)}const Ui=bt.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),Ti=bt.getPixelScale(),Vi=st?cu(b,Tt,T,Ti,at):Q?uu(b,Tt,T,Ti,Q,at):ht?ph(b,Tt,T,Ti,At.lineClipsArray.length):Vo(b,Tt,T,Ti);if(st)pt.activeTexture.set(ot.TEXTURE0),Tt.imageAtlasTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE),te.updatePaintBuffers(at);else if(Q&&(pe||b.lineAtlas.dirty))pt.activeTexture.set(ot.TEXTURE0),b.lineAtlas.bind(pt);else if(ht){const Pi=At.gradients[T.id];let Ci=Pi.texture;if(T.gradientVersion!==Pi.version){let wr=256;if(T.stepInterpolant){const pi=M.getSource().maxzoom,pr=Mt.canonical.z===pi?Math.ceil(1<<b.transform.maxZoom-Mt.canonical.z):1;wr=o.ag(o.c2(At.maxLineLength/o.$*1024*pr),256,pt.maxTextureSize)}Pi.gradient=o.c3({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:wr,image:Pi.gradient||void 0,clips:At.lineClipsArray}),Pi.texture?Pi.texture.update(Pi.gradient):Pi.texture=new o.T(pt,Pi.gradient,ot.RGBA),Pi.version=T.gradientVersion,Ci=Pi.texture}pt.activeTexture.set(ot.TEXTURE0),Ci.bind(T.stepInterpolant?ot.NEAREST:ot.LINEAR,ot.CLAMP_TO_EDGE)}const Ii=b.stencilModeForClipping(Mt);Vt.draw(pt,ot.TRIANGLES,Z,Ii,tt,He.disabled,Vi,ti,Ui,T.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,T.paint,b.transform.zoom,te,At.layoutVertexBuffer2),It=!1}}(t,r,c,d,_):o.ce(c)?function(b,M,T,I,R){const F=T.paint.get("fill-color"),L=T.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const{isRenderingToTexture:G}=R,Z=b.colorModeForRenderPass(),tt=T.paint.get("fill-pattern"),Q=b.opaquePassEnabledForLayer()&&!tt.constantOr(1)&&F.constantOr(o.be.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===Q){const et=b.getDepthModeForSublayer(1,b.renderPass==="opaque"?Qe.ReadWrite:Qe.ReadOnly);Ja(b,M,T,I,et,Z,!1,G)}if(b.renderPass==="translucent"&&T.paint.get("fill-antialias")){const et=b.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Qe.ReadOnly);Ja(b,M,T,I,et,Z,!0,G)}}(t,r,c,d,_):o.cf(c)?function(b,M,T,I,R){const F=T.paint.get("fill-extrusion-opacity");if(F===0)return;const{isRenderingToTexture:L}=R;if(b.renderPass==="translucent"){const G=new Qe(b.context.gl.LEQUAL,Qe.ReadWrite,b.depthRangeFor3D);if(F!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))ra(b,M,T,I,G,Fe.disabled,ci.disabled,L),ra(b,M,T,I,G,b.stencilModeFor3D(),b.colorModeForRenderPass(),L);else{const Z=b.colorModeForRenderPass();ra(b,M,T,I,G,Fe.disabled,Z,L)}}}(t,r,c,d,_):o.cg(c)?function(b,M,T,I,R){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const{isRenderingToTexture:F}=R,L=b.context,G=b.style.projection.useSubdivision,Z=b.getDepthModeForSublayer(0,Qe.ReadOnly),tt=b.colorModeForRenderPass();if(b.renderPass==="offscreen")(function(Q,et,st,ht,at,dt,pt){const ot=Q.context,bt=ot.gl;for(const It of st){const Mt=et.getTile(It),Tt=Mt.dem;if(!Tt||!Tt.data||!Mt.needsHillshadePrepare)continue;const At=Tt.dim,te=Tt.stride,Jt=Tt.getPixels();if(ot.activeTexture.set(bt.TEXTURE1),ot.pixelStoreUnpackPremultiplyAlpha.set(!1),Mt.demTexture=Mt.demTexture||Q.getTileTexture(te),Mt.demTexture){const pe=Mt.demTexture;pe.update(Jt,{premultiply:!1}),pe.bind(bt.NEAREST,bt.CLAMP_TO_EDGE)}else Mt.demTexture=new o.T(ot,Jt,bt.RGBA,{premultiply:!1}),Mt.demTexture.bind(bt.NEAREST,bt.CLAMP_TO_EDGE);ot.activeTexture.set(bt.TEXTURE0);let Vt=Mt.fbo;if(!Vt){const pe=new o.T(ot,{width:At,height:At,data:null},bt.RGBA);pe.bind(bt.LINEAR,bt.CLAMP_TO_EDGE),Vt=Mt.fbo=ot.createFramebuffer(At,At,!0,!1),Vt.colorAttachment.set(pe.texture)}ot.bindFramebuffer.set(Vt.framebuffer),ot.viewport.set([0,0,At,At]),Q.useProgram("hillshadePrepare").draw(ot,bt.TRIANGLES,at,dt,pt,He.disabled,mf(Mt.tileID,Tt),null,null,ht.id,Q.rasterBoundsBuffer,Q.quadTriangleIndexBuffer,Q.rasterBoundsSegments),Mt.needsHillshadePrepare=!1}})(b,M,I,T,Z,Fe.disabled,tt),L.viewport.set([0,0,b.width,b.height]);else if(b.renderPass==="translucent")if(G){const[Q,et,st]=b.stencilConfigForOverlapTwoPass(I);sa(b,M,T,st,Q,Z,tt,!1,F),sa(b,M,T,st,et,Z,tt,!0,F)}else{const[Q,et]=b.getStencilConfigForOverlapAndUpdateStencilID(I);sa(b,M,T,et,Q,Z,tt,!1,F)}}(t,r,c,d,_):o.ch(c)?function(b,M,T,I,R){if(b.renderPass!=="translucent"||!I.length)return;const{isRenderingToTexture:F}=R,L=b.style.projection.useSubdivision,G=b.getDepthModeForSublayer(0,Qe.ReadOnly),Z=b.colorModeForRenderPass();if(L){const[tt,Q,et]=b.stencilConfigForOverlapTwoPass(I);Qa(b,M,T,et,tt,G,Z,!1,F),Qa(b,M,T,et,Q,G,Z,!0,F)}else{const[tt,Q]=b.getStencilConfigForOverlapAndUpdateStencilID(I);Qa(b,M,T,Q,tt,G,Z,!1,F)}}(t,r,c,d,_):o.ci(c)?function(b,M,T,I,R){if(b.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!I.length)return;const{isRenderingToTexture:F}=R,L=M.getSource(),G=b.style.projection.useSubdivision;if(L instanceof Ne)rn(b,M,T,I,null,!1,!1,L.tileCoords,L.flippedWindingOrder,F);else if(G){const[Z,tt,Q]=b.stencilConfigForOverlapTwoPass(I);rn(b,M,T,Q,Z,!1,!0,Ch,!1,F),rn(b,M,T,Q,tt,!0,!0,Ch,!1,F)}else{const[Z,tt]=b.getStencilConfigForOverlapAndUpdateStencilID(I);rn(b,M,T,tt,Z,!1,!0,Ch,!1,F)}}(t,r,c,d,_):o.cj(c)?function(b,M,T,I,R){const F=T.paint.get("background-color"),L=T.paint.get("background-opacity");if(L===0)return;const{isRenderingToTexture:G}=R,Z=b.context,tt=Z.gl,Q=b.style.projection,et=b.transform,st=et.tileSize,ht=T.paint.get("background-pattern");if(b.isPatternMissing(ht))return;const at=!ht&&F.a===1&&L===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==at)return;const dt=Fe.disabled,pt=b.getDepthModeForSublayer(0,at==="opaque"?Qe.ReadWrite:Qe.ReadOnly),ot=b.colorModeForRenderPass(),bt=b.useProgram(ht?"backgroundPattern":"background"),It=I||Rt(et,{tileSize:st,terrain:b.style.map.terrain});ht&&(Z.activeTexture.set(tt.TEXTURE0),b.imageManager.bind(b.context));const Mt=T.getCrossfadeParameters();for(const Tt of It){const At=et.getProjectionData({overscaledTileID:Tt,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),te=ht?yf(L,b,ht,{tileID:Tt,tileSize:st},Mt):qo(L,F),Jt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Tt),Vt=Q.getMeshFromTileID(Z,Tt.canonical,!1,!0,"raster");bt.draw(Z,tt.TRIANGLES,pt,dt,ot,He.backCCW,te,Jt,At,T.id,Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}}(t,0,c,d,_):o.ck(c)&&function(b,M,T,I){const{isRenderingGlobe:R}=I,F=b.context,L=T.implementation,G=b.style.projection,Z=b.transform,tt=Z.getProjectionDataForCustomLayer(R),Q={farZ:Z.farZ,nearZ:Z.nearZ,fov:Z.fov*Math.PI/180,modelViewProjectionMatrix:Z.modelViewProjectionMatrix,projectionMatrix:Z.projectionMatrix,shaderData:{variantName:G.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${G.shaderPreludeCode.vertexSource}`,define:G.shaderDefine},defaultProjectionData:tt},et=L.renderingMode?L.renderingMode:"2d";if(b.renderPass==="offscreen"){const st=L.prerender;st&&(b.setCustomLayerDefaults(),F.setColorMode(b.colorModeForRenderPass()),st.call(L,F.gl,Q),F.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),F.setColorMode(b.colorModeForRenderPass()),F.setStencilMode(Fe.disabled);const st=et==="3d"?b.getDepthModeFor3D():b.getDepthModeForSublayer(0,Qe.ReadOnly);F.setDepthMode(st),L.render(F.gl,Q),F.setDirty(),b.setBaseState(),F.bindFramebuffer.set(null)}}(t,0,c,_))}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!r||!c}useProgram(t,r,c=!1,d=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,b=this.style.projection,M=c?Is.projectionMercator:b.shaderPreludeCode,T=c?Tn:b.shaderDefine,I=t+(r?r.cacheKey:"")+`/${c?nh:b.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[I]||(this.cache[I]=new Go(this.context,Is[t],r,pu[t],this._showOverdrawInspector,_,M,T,d)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}function sl(g,t){let r,c=!1,d=null,_=null;const b=()=>{d=null,c&&(g.apply(_,r),d=setTimeout(b,t),c=!1)};return(...M)=>(c=!0,_=this,r=M,d||b(),d)}class eo{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(c=d)}),(c&&c[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const c=r.join("/");let d=c;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${c}`);let _=window.location.hash.replace(d,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let b=window.location.href.replace(/(#.+)?$/,_);b=b.replace("&&","&"),window.history.replaceState(window.history.state,null,b)},this._updateHash=sl(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const r=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,d),b=Math.round(r.lng*_)/_,M=Math.round(r.lat*_)/_,T=this._map.getBearing(),I=this._map.getPitch();let R="";if(R+=t?`/${b}/${M}/${c}`:`${c}/${M}/${b}`,(T||I)&&(R+="/"+Math.round(10*T)/10),I&&(R+=`/${Math.round(I)}`),this._hashName){const F=this._hashName;let L=!1;const G=window.location.hash.slice(1).split("&").map(Z=>{const tt=Z.split("=")[0];return tt===F?(L=!0,`${tt}=${R}`):Z}).filter(Z=>Z);return L||G.push(`${F}=${R}`),`#${G.join("&")}`}return`#${R}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new o.S(+t[2],+t[1])}catch{return!1}const r=+t[0],c=+(t[3]||0),d=+(t[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&c>=-180&&c<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const na={linearity:.3,easing:o.cl(0,0,.3,1)},aa=o.e({deceleration:2500,maxSpeed:1400},na),Rh=o.e({deceleration:20,maxSpeed:1400},na),io=o.e({deceleration:1e3,maxSpeed:360},na),kh=o.e({deceleration:1e3,maxSpeed:90},na),Ru=o.e({deceleration:1e3,maxSpeed:360},na);class ku{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:k.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=k.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,r.roll+=_.rollDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(r.pan.mag()){const _=la(r.pan.mag(),c,o.e({},aa,t||{})),b=r.pan.mult(_.amount/r.pan.mag()),M=this._map.cameraHelper.handlePanInertia(b,this._map.transform);d.center=M.easingCenter,d.offset=M.easingOffset,oa(d,_)}if(r.zoom){const _=la(r.zoom,c,Rh);d.zoom=this._map.transform.zoom+_.amount,oa(d,_)}if(r.bearing){const _=la(r.bearing,c,io);d.bearing=this._map.transform.bearing+o.ag(_.amount,-179,179),oa(d,_)}if(r.pitch){const _=la(r.pitch,c,kh);d.pitch=this._map.transform.pitch+_.amount,oa(d,_)}if(r.roll){const _=la(r.roll,c,Ru);d.roll=this._map.transform.roll+o.ag(_.amount,-179,179),oa(d,_)}if(d.zoom||d.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;d.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),o.e(d,{noMoveStart:!0})}}function oa(g,t){(!g.duration||g.duration<t.duration)&&(g.duration=t.duration,g.easing=t.easing)}function la(g,t,r){const{maxSpeed:c,linearity:d,deceleration:_}=r,b=o.ag(g*d/(t/1e3),-c,c),M=Math.abs(b)/(_*d);return{easing:r.easing,duration:1e3*M,amount:b*(M/2)}}class Hr extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c,d={}){c=c instanceof MouseEvent?c:new MouseEvent(t,c);const _=B.mousePos(r.getCanvas(),c),b=r.unproject(_);super(t,o.e({point:_,lngLat:b,originalEvent:c},d)),this._defaultPrevented=!1,this.target=r}}class xs extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c){const d=t==="touchend"?c.changedTouches:c.touches,_=B.touchPos(r.getCanvasContainer(),d),b=_.map(T=>r.unproject(T)),M=_.reduce((T,I,R,F)=>T.add(I.div(F.length)),new o.P(0,0));super(t,{points:_,point:M,lngLats:b,lngLat:r.unproject(M),originalEvent:c}),this._defaultPrevented=!1}}class Dh extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class Du{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Dh(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Hr(t.type,this._map,t))}mouseup(t){this._map.fire(new Hr(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Hr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Hr(t.type,this._map,t))}mouseover(t){this._map.fire(new Hr(t.type,this._map,t))}mouseout(t){this._map.fire(new Hr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new xs(t.type,this._map,t))}touchmove(t){this._map.fire(new xs(t.type,this._map,t))}touchend(t){this._map.fire(new xs(t.type,this._map,t))}touchcancel(t){this._map.fire(new xs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zu{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Hr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Hr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ha{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(o.P.convert(t),this._map.terrain)}}class zh{constructor(t,r){this._map=t,this._tr=new ha(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(B.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const c=r;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=c,this._box||(this._box=B.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(d.x,c.x),b=Math.max(d.x,c.x),M=Math.min(d.y,c.y),T=Math.max(d.y,c.y);B.setTransform(this._box,`translate(${_}px,${M}px)`),this._box.style.width=b-_+"px",this._box.style.height=T-M+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const c=this._startPos,d=r;if(this.reset(),B.suppressClick(),c.x!==d.x||c.y!==d.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(c,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(B.remove(this._box),this._box=null),B.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new o.l(t,{originalEvent:r}))}}function nl(g,t){if(g.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${t.length}`);const r={};for(let c=0;c<g.length;c++)r[g[c].identifier]=t[c];return r}class Lu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){const _=new o.P(0,0);for(const b of d)_._add(b);return _.div(d.length)}(r),this.touches=nl(c,r)))}touchmove(t,r,c){if(this.aborted||!this.centroid)return;const d=nl(c,r);for(const _ in this.touches){const b=d[_];(!b||b.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class al{constructor(t){this.singleTap=new Lu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,c){this.singleTap.touchstart(t,r,c)}touchmove(t,r,c){this.singleTap.touchmove(t,r,c)}touchend(t,r,c){const d=this.singleTap.touchend(t,r,c);if(d){const _=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(d)<30;if(_&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class ll{constructor(t){this._tr=new ha(t),this._zoomIn=new al({numTouches:1,numTaps:2}),this._zoomOut=new al({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,c){this._zoomIn.touchstart(t,r,c),this._zoomOut.touchstart(t,r,c)}touchmove(t,r,c){this._zoomIn.touchmove(t,r,c),this._zoomOut.touchmove(t,r,c)}touchend(t,r,c){const d=this._zoomIn.touchend(t,r,c),_=this._zoomOut.touchend(t,r,c),b=this._tr;return d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(d)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ca{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const d=Array.isArray(r)?r[0]:r;return!this._moved&&d.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(c,d))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&B.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const fs=0,bs=2,Ou={[fs]:1,[bs]:2};class Or{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=B.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(r,c){const d=Ou[c];return r.buttons===void 0||(r.buttons&d)!==d}(t,this._eventButton)}isValidEndEvent(t){return B.mouseButton(t)===this._eventButton}}class ua{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Ef{constructor(t=new Or({checkCorrectEvent:()=>!0}),r=new ua){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(t,r,c){return t instanceof MouseEvent?r(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?c(t):void 0}startMove(t){this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(t){this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(t){return this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(t){return this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(t){return this._executeRelevantHandler(t,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}const hl=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=t=>{t.preventDefault()}};class If{constructor(t,r){this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,r,c){return this._calculateTransform(t,r,c)}touchmove(t,r,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,r,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,r,c){this._calculateTransform(t,r,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,c){c.length>0&&(this._active=!0);const d=nl(c,r),_=new o.P(0,0),b=new o.P(0,0);let M=0;for(const I in d){const R=d[I],F=this._touches[I];F&&(_._add(R),b._add(R.sub(F)),M++,d[I]=R)}if(this._touches=d,this._shouldBePrevented(M)||!b.mag())return;const T=b.div(M);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(M),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,c){if(!this._firstTwoTouches)return;t.preventDefault();const[d,_]=this._firstTwoTouches,b=ro(c,r,d),M=ro(c,r,_);if(!b||!M)return;const T=this._aroundCenter?null:b.add(M).div(2);return this._move([b,M],T,t)}touchend(t,r,c){if(!this._firstTwoTouches)return;const[d,_]=this._firstTwoTouches,b=ro(c,r,d),M=ro(c,r,_);b&&M||(this._active&&B.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ro(g,t,r){for(let c=0;c<g.length;c++)if(g[c].identifier===r)return t[c]}function da(g,t){return Math.log(g/t)/Math.LN2}class Rs extends Lh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(da(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:da(this._distance,c),pinchAround:r}}}function ce(g,t){return 180*g.angleWith(t)/Math.PI}class Oh extends Lh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r,c){const d=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ce(this._vector,d),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,c=ce(t,this._startVector);return Math.abs(c)<r}}function so(g){return Math.abs(g.y)>Math.abs(g.x)}class Fh extends Lh{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,c){super.touchstart(t,r,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,so(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,_,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(d.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,c){if(this._valid!==void 0)return this._valid;const d=t.mag()>=2,_=r.mag()>=2;if(!d&&!_)return;if(!d||!_)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const b=t.y>0==r.y>0;return so(t)&&so(r)&&b}}const no={panStep:100,bearingStep:15,pitchStep:10};class fa{constructor(t){this._tr=new ha(t);const r=no;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,c=0,d=0,_=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?d=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?d=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(c=0,d=0),{cameraAnimation:M=>{const T=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Bh,zoom:r?Math.round(T.zoom)+r*(t.shiftKey?2:1):T.zoom,bearing:T.bearing+c*this._bearingStep,pitch:T.pitch+d*this._pitchStep,offset:[-_*this._panStep,-b*this._panStep],center:T.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bh(g){return g*(2-g)}const ai=4.000244140625,Nh=1/450;class Fu{constructor(t,r){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new ha(t),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Nh}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=k.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%ai==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(d*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=B.mousePos(this._map.getCanvas(),t),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(o.S.convert(c.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const M=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=M),typeof this._targetZoom=="number"&&(this._targetZoom+=M)}if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>ai?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&T!==0&&(T=1/T);const I=typeof this._targetZoom!="number"?t.scale:o.ae(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),o.aj(I*T)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,c=this._startZoom,d=this._easing;let _,b=!1;if(this._type==="wheel"&&c&&d){const M=k.now()-this._lastWheelEventTime,T=Math.min((M+5)/200,1),I=d(T);_=o.C.number(c,r,I),T<1?this._frameId||(this._frameId=!0):b=!0}else _=r,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!b,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=o.cn;if(this._prevEase){const c=this._prevEase,d=(k.now()-c.start)/c.duration,_=c.easing(d+.01)-c.easing(d),b=.27/Math.sqrt(_*_+1e-4)*.01,M=Math.sqrt(.0729-b*b);r=o.cl(b,M,.25,1)}return this._prevEase={start:k.now(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class cl{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cf{constructor(t){this._tr=new ha(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Af{constructor(){this._tap=new al({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,c){if(!this._swipePoint)if(this._tapTime){const d=r[0],_=t.timeStamp-this._tapTime<500,b=this._tapPoint.dist(d)<30;_&&b?c.length>0&&(this._swipePoint=d,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,r,c)}touchmove(t,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const d=r[0],_=d.y-this._swipePoint.y;return this._swipePoint=d,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,c)}touchend(t,r,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const d=this._tap.touchend(t,r,c);d&&(this._tapTime=t.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gh{constructor(t,r,c){this._el=t,this._mousePan=r,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ul{constructor(t,r,c,d){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=r,this._mousePitch=c,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class jh{constructor(t,r,c,d){this._el=t,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Bu{constructor(t,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=B.create("div","maplibregl-cooperative-gesture-screen",t);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=r,this._container.appendChild(d);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=c,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(B.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,r){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:t,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ao=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class Rf extends o.l{}function Uh(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class nn{constructor(t,r){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,_)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=d.type==="renderFrame"?void 0:d,M={needsRenderFrame:!1},T={},I={};for(const{handlerName:L,handler:G,allowed:Z}of this._handlers){if(!G.isEnabled())continue;let tt;if(this._blockedByActive(I,Z,L))G.reset();else if(G[_||d.type]){if(o.co(d,_||d.type)){const Q=B.mousePos(this._map.getCanvas(),d);tt=G[_||d.type](d,Q)}else if(o.cp(d,_||d.type)){const Q=this._getMapTouches(d.touches),et=B.touchPos(this._map.getCanvas(),Q);tt=G[_||d.type](d,et,Q)}else o.cq(_||d.type)||(tt=G[_||d.type](d));this.mergeHandlerResult(M,T,tt,L,b),tt&&tt.needsRenderFrame&&this._triggerRenderFrame()}(tt||G.isActive())&&(I[L]=G)}const R={};for(const L in this._previousActiveHandlers)I[L]||(R[L]=b);this._previousActiveHandlers=I,(Object.keys(R).length||Uh(M))&&(this._changes.push([M,T,R]),this._triggerRenderFrame()),(Object.keys(I).length||Uh(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=M;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ku(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,_,b]of this._listeners)B.addEventListener(d,_,d===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,r,c]of this._listeners)B.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new Du(r,t));const d=r.boxZoom=new zh(r,t);this._add("boxZoom",d),t.interactive&&t.boxZoom&&d.enable();const _=r.cooperativeGestures=new Bu(r,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const b=new ll(r),M=new Cf(r);r.doubleClickZoom=new cl(M,b),this._add("tapZoom",b),this._add("clickZoom",M),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const T=new Af;this._add("tapDragZoom",T);const I=r.touchPitch=new Fh(r);this._add("touchPitch",I),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const R=()=>r.project(r.getCenter()),F=function({enable:at,clickTolerance:dt,aroundCenter:pt=!0,minPixelCenterThreshold:ot=100,rotateDegreesPerPixelMoved:bt=.8},It){const Mt=new Or({checkCorrectEvent:Tt=>B.mouseButton(Tt)===0&&Tt.ctrlKey||B.mouseButton(Tt)===2&&!Tt.ctrlKey});return new ca({clickTolerance:dt,move:(Tt,At)=>{const te=It();if(pt&&Math.abs(te.y-Tt.y)>ot)return{bearingDelta:o.cm(new o.P(Tt.x,At.y),At,te)};let Jt=(At.x-Tt.x)*bt;return pt&&At.y<te.y&&(Jt=-Jt),{bearingDelta:Jt}},moveStateManager:Mt,enable:at,assignEvents:hl})}(t,R),L=function({enable:at,clickTolerance:dt,pitchDegreesPerPixelMoved:pt=-.5}){const ot=new Or({checkCorrectEvent:bt=>B.mouseButton(bt)===0&&bt.ctrlKey||B.mouseButton(bt)===2});return new ca({clickTolerance:dt,move:(bt,It)=>({pitchDelta:(It.y-bt.y)*pt}),moveStateManager:ot,enable:at,assignEvents:hl})}(t),G=function({enable:at,clickTolerance:dt,rollDegreesPerPixelMoved:pt=.3},ot){const bt=new Or({checkCorrectEvent:It=>B.mouseButton(It)===2&&It.ctrlKey});return new ca({clickTolerance:dt,move:(It,Mt)=>{const Tt=ot();let At=(Mt.x-It.x)*pt;return Mt.y<Tt.y&&(At=-At),{rollDelta:At}},moveStateManager:bt,enable:at,assignEvents:hl})}(t,R);r.dragRotate=new ul(t,F,L,G),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",L,["mouseRotate","mouseRoll"]),this._add("mouseRoll",G,["mousePitch"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const Z=function({enable:at,clickTolerance:dt}){const pt=new Or({checkCorrectEvent:ot=>B.mouseButton(ot)===0&&!ot.ctrlKey});return new ca({clickTolerance:dt,move:(ot,bt)=>({around:bt,panDelta:bt.sub(ot)}),activateOnStart:!0,moveStateManager:pt,enable:at,assignEvents:hl})}(t),tt=new If(t,r);r.dragPan=new Gh(c,Z,tt),this._add("mousePan",Z),this._add("touchPan",tt,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const Q=new Oh,et=new Rs;r.touchZoomRotate=new jh(c,et,Q,T),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate);const st=r.scrollZoom=new Fu(r,()=>this._triggerRenderFrame());this._add("scrollZoom",st,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const ht=r.keyboard=new fa(r);this._add("keyboard",ht),t.interactive&&t.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new zu(r))}_add(t,r,c){this._handlers.push({handlerName:t,handler:r,allowed:c}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ao(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,c){for(const d in t)if(d!==c&&(!r||r.indexOf(d)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const c of t)this._el.contains(c.target)&&r.push(c);return r}mergeHandlerResult(t,r,c,d,_){if(!c)return;o.e(t,c);const b={handlerName:d,originalEvent:c.originalEvent||_};c.zoomDelta!==void 0&&(r.zoom=b),c.panDelta!==void 0&&(r.drag=b),c.rollDelta!==void 0&&(r.roll=b),c.pitchDelta!==void 0&&(r.pitch=b),c.bearingDelta!==void 0&&(r.rotate=b)}_applyChanges(){const t={},r={},c={};for(const[d,_,b]of this._changes)d.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(d.panDelta)),d.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(t.rollDelta=(t.rollDelta||0)+d.rollDelta),d.around!==void 0&&(t.around=d.around),d.pinchAround!==void 0&&(t.pinchAround=d.pinchAround),d.noInertia&&(t.noInertia=d.noInertia),o.e(r,_),o.e(c,b);this._updateMapTransform(t,r,c),this._changes=[]}_updateMapTransform(t,r,c){const d=this._map,_=d._getTransformForUpdate(),b=d.terrain;if(!(Uh(t)||b&&this._terrainMovement))return this._fireEvents(r,c,!0);d._stop(!0);let{panDelta:M,zoomDelta:T,bearingDelta:I,pitchDelta:R,rollDelta:F,around:L,pinchAround:G}=t;G!==void 0&&(L=G),L=L||d.transform.centerPoint,b&&!_.isPointOnMapSurface(L)&&(L=_.centerPoint);const Z={panDelta:M,zoomDelta:T,rollDelta:F,pitchDelta:R,bearingDelta:I,around:L};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(L)&&(L=_.centerPoint);const tt=L.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(M?L.sub(M):L);b?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,_),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?_.setCenter(_.screenPointToLocation(_.centerPoint.sub(M))):this._map.cameraHelper.handleMapControlsPan(Z,_,tt):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Z,_,tt))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,_),this._map.cameraHelper.handleMapControlsPan(Z,_,tt)),d._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,c,!0)}_fireEvents(t,r,c){const d=ao(this._eventsInProgress),_=ao(t),b={};for(const F in t){const{originalEvent:L}=t[F];this._eventsInProgress[F]||(b[`${F}start`]=L),this._eventsInProgress[F]=t[F]}!d&&_&&this._fireEvent("movestart",_.originalEvent);for(const F in b)this._fireEvent(F,b[F]);_&&this._fireEvent("move",_.originalEvent);for(const F in t){const{originalEvent:L}=t[F];this._fireEvent(F,L)}const M={};let T;for(const F in this._eventsInProgress){const{handlerName:L,originalEvent:G}=this._eventsInProgress[F];this._handlersById[L].isActive()||(delete this._eventsInProgress[F],T=r[L]||G,M[`${F}end`]=T)}for(const F in M)this._fireEvent(F,M[F]);const I=ao(this._eventsInProgress),R=(d||_)&&!I;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const F=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&F.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(F)}if(c&&R){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!F||!F.essential&&k.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:T})),L(this._map.getBearing())&&this._map.resetNorth()):(L(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new o.l(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Rf("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Oi extends o.E{constructor(t,r,c){super(),this._renderFrameCallback=()=>{const d=Math.min((k.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,r){t.apply(this.transform),this.transform=t,this.cameraHelper=r}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,r){return this.jumpTo({elevation:t},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,r,c){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.e({offset:t},r),c)}panTo(t,r,c){return this.easeTo(o.e({center:t},r),c)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,c){return this.easeTo(o.e({zoom:t},r),c)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,r){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)).fire(new o.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,c){return this.easeTo(o.e({bearing:t},r),c)}resetNorth(t,r){return this.rotateTo(0,o.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}getRoll(){return this.transform.roll}setRoll(t,r){return this.jumpTo({roll:t},r),this}cameraForBounds(t,r){t=Me.convert(t).adjustAntiMeridian();const c=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,r)}_cameraForBoxAndBearing(t,r,c,d){const _={top:0,bottom:0,right:0,left:0};if(typeof(d=o.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const I=d.padding;d.padding={top:I,bottom:I,right:I,left:I}}const b=o.e(_,d.padding);d.padding=b;const M=this.transform,T=new Me(t,r);return this.cameraHelper.cameraForBoxAndBearing(d,b,T,c,M)}fitBounds(t,r,c){return this._fitInternal(this.cameraForBounds(t,r),r,c)}fitScreenCoordinates(t,r,c,d,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(t)),this.transform.screenPointToLocation(o.P.convert(r)),c,d),d,_)}_fitInternal(t,r,c){return t?(delete(r=o.e(t,r)).padding,r.linear?this.easeTo(r,c):this.flyTo(r,c)):this}jumpTo(t,r){this.stop();const c=this._getTransformForUpdate();let d=!1,_=!1,b=!1;const M=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,t);const T=c.zoom!==M;return"elevation"in t&&c.elevation!==+t.elevation&&c.setElevation(+t.elevation),"bearing"in t&&c.bearing!==+t.bearing&&(d=!0,c.setBearing(+t.bearing)),"pitch"in t&&c.pitch!==+t.pitch&&(_=!0,c.setPitch(+t.pitch)),"roll"in t&&c.roll!==+t.roll&&(b=!0,c.setRoll(+t.roll)),t.padding==null||c.isPaddingEqual(t.padding)||c.setPadding(t.padding),this._applyUpdatedTransform(c),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)),T&&this.fire(new o.l("zoomstart",r)).fire(new o.l("zoom",r)).fire(new o.l("zoomend",r)),d&&this.fire(new o.l("rotatestart",r)).fire(new o.l("rotate",r)).fire(new o.l("rotateend",r)),_&&this.fire(new o.l("pitchstart",r)).fire(new o.l("pitch",r)).fire(new o.l("pitchend",r)),b&&this.fire(new o.l("rollstart",r)).fire(new o.l("roll",r)).fire(new o.l("rollend",r)),this.fire(new o.l("moveend",r))}calculateCameraOptionsFromTo(t,r,c,d=0){const _=o.a0.fromLngLat(t,r),b=o.a0.fromLngLat(c,d),M=b.x-_.x,T=b.y-_.y,I=b.z-_.z,R=Math.hypot(M,T,I);if(R===0)throw new Error("Can't calculate camera options with same From and To");const F=Math.hypot(M,T),L=o.aj(this.transform.cameraToCenterDistance/R/this.transform.tileSize),G=180*Math.atan2(M,-T)/Math.PI;let Z=180*Math.acos(F/R)/Math.PI;return Z=I<0?90-Z:90+Z,{center:b.toLngLat(),elevation:d,zoom:L,pitch:Z,bearing:G}}calculateCameraOptionsFromCameraLngLatAltRotation(t,r,c,d,_){const b=this.transform.calculateCenterFromCameraLngLatAlt(t,r,c,d);return{center:b.center,elevation:b.elevation,zoom:b.zoom,bearing:c,pitch:d,roll:_}}easeTo(t,r){this._stop(!1,t.easeId),((t=o.e({offset:[0,0],duration:500,easing:o.cn},t)).animate===!1||!t.essential&&k.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),d=this.getBearing(),_=c.pitch,b=c.roll,M="bearing"in t?this._normalizeBearing(t.bearing,d):d,T="pitch"in t?+t.pitch:_,I="roll"in t?this._normalizeBearing(t.roll,b):b,R="padding"in t?t.padding:c.padding,F=o.P.convert(t.offset);let L,G;t.around&&(L=o.S.convert(t.around),G=c.locationToScreenPoint(L));const Z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},tt=this.cameraHelper.handleEaseTo(c,{bearing:M,pitch:T,roll:I,padding:R,around:L,aroundPoint:G,offsetAsPoint:F,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||d!==M,this._pitching=this._pitching||T!==_,this._rolling=this._rolling||I!==b,this._padding=!c.isPaddingEqual(R),this._zooming=this._zooming||tt.isZooming,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,Z),this.terrain&&this._prepareElevation(tt.elevationCenter),this._ease(Q=>{tt.easeFunc(Q),this.terrain&&!t.freezeElevation&&this._updateElevation(Q),this._applyUpdatedTransform(c),this._fireMoveEvents(r)},Q=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r,Q)},t),this}_prepareEase(t,r,c={}){this._moving=!0,r||c.moving||this.fire(new o.l("movestart",t)),this._zooming&&!c.zooming&&this.fire(new o.l("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new o.l("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new o.l("pitchstart",t)),this._rolling&&!c.rolling&&this.fire(new o.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(r-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const r=t.getCameraLngLat(),c=t.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(r,t.zoom):0;if(c<d){const _=this.calculateCameraOptionsFromTo(r,d,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const r=[];if(r.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&r.push(d=>this.transformCameraUpdate(d)),!r.length)return;const c=t.clone();for(const d of r){const _=c.clone(),{center:b,zoom:M,roll:T,pitch:I,bearing:R,elevation:F}=d(_);b&&_.setCenter(b),F!==void 0&&_.setElevation(F),M!==void 0&&_.setZoom(M),T!==void 0&&_.setRoll(T),I!==void 0&&_.setPitch(I),R!==void 0&&_.setBearing(R),c.apply(_)}this.transform.apply(c)}_fireMoveEvents(t){this.fire(new o.l("move",t)),this._zooming&&this.fire(new o.l("zoom",t)),this._rotating&&this.fire(new o.l("rotate",t)),this._pitching&&this.fire(new o.l("pitch",t)),this._rolling&&this.fire(new o.l("roll",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const c=this._zooming,d=this._rotating,_=this._pitching,b=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new o.l("zoomend",t)),d&&this.fire(new o.l("rotateend",t)),_&&this.fire(new o.l("pitchend",t)),b&&this.fire(new o.l("rollend",t)),this.fire(new o.l("moveend",t))}flyTo(t,r){if(!t.essential&&k.prefersReducedMotion){const At=o.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(At,r)}this.stop(),t=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cn},t);const c=this._getTransformForUpdate(),d=c.bearing,_=c.pitch,b=c.roll,M=c.padding,T="bearing"in t?this._normalizeBearing(t.bearing,d):d,I="pitch"in t?+t.pitch:_,R="roll"in t?this._normalizeBearing(t.roll,b):b,F="padding"in t?t.padding:c.padding,L=o.P.convert(t.offset);let G=c.centerPoint.add(L);const Z=c.screenPointToLocation(G),tt=this.cameraHelper.handleFlyTo(c,{bearing:T,pitch:I,roll:R,padding:F,locationAtOffset:Z,offsetAsPoint:L,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let Q=t.curve;const et=Math.max(c.width,c.height),st=et/tt.scaleOfZoom,ht=tt.pixelPathLength;typeof tt.scaleOfMinZoom=="number"&&(Q=Math.sqrt(et/tt.scaleOfMinZoom/ht*2));const at=Q*Q;function dt(At){const te=(st*st-et*et+(At?-1:1)*at*at*ht*ht)/(2*(At?st:et)*at*ht);return Math.log(Math.sqrt(te*te+1)-te)}function pt(At){return(Math.exp(At)-Math.exp(-At))/2}function ot(At){return(Math.exp(At)+Math.exp(-At))/2}const bt=dt(!1);let It=function(At){return ot(bt)/ot(bt+Q*At)},Mt=function(At){return et*((ot(bt)*(pt(te=bt+Q*At)/ot(te))-pt(bt))/at)/ht;var te},Tt=(dt(!0)-bt)/Q;if(Math.abs(ht)<2e-6||!isFinite(Tt)){if(Math.abs(et-st)<1e-6)return this.easeTo(t,r);const At=st<et?-1:1;Tt=Math.abs(Math.log(st/et))/Q,Mt=()=>0,It=te=>Math.exp(At*Q*te)}return t.duration="duration"in t?+t.duration:1e3*Tt/("screenSpeed"in t?+t.screenSpeed/Q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=d!==T,this._pitching=I!==_,this._rolling=R!==b,this._padding=!c.isPaddingEqual(F),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(tt.targetCenter),this._ease(At=>{const te=At*Tt,Jt=1/It(te),Vt=Mt(te);this._rotating&&c.setBearing(o.C.number(d,T,At)),this._pitching&&c.setPitch(o.C.number(_,I,At)),this._rolling&&c.setRoll(o.C.number(b,R,At)),this._padding&&(c.interpolatePadding(M,F,At),G=c.centerPoint.add(L)),tt.easeFunc(At,Jt,Vt,G),this.terrain&&!t.freezeElevation&&this._updateElevation(At),this._applyUpdatedTransform(c),this._fireMoveEvents(r)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,r)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,r,c){c.animate===!1||c.duration===0?(t(1),r()):(this._easeStart=k.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=o.aN(t,-180,180);const c=Math.abs(t-r);return Math.abs(t-360-r)<c&&(t-=360),Math.abs(t+360-r)<c&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(t),this.transform.tileZoom):null}}const oo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class dl{constructor(t=oo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=B.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=B.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=B.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){B.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const c=this._map._getUIString(`AttributionControl.${r}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const r=this._map.style.sourceCaches;for(const d in r){const _=r[d];if(_.used||_.usedForTerrain){const b=_.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t=t.filter(d=>String(d).trim()),t.sort((d,_)=>d.length-_.length),t=t.filter((d,_)=>{for(let b=_+1;b<t.length;b++)if(t[b].indexOf(d)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=B.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Vh{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=B.create("div","maplibregl-ctrl");const r=B.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){B.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Nu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const d of c)if(d.id===t)return void(d.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Gu=o.aI([{name:"a_pos3d",type:"Int16",components:3}]);class kf extends o.E{constructor(t){super(),this._lastTilesetChange=k.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,r){this.sourceCache.update(t,r),this._renderableTilesKeys=[];const c={};for(const d of Rt(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))c[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),o.bX(d.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[d.key]=new _i(d,this.tileSize),this._lastTilesetChange=k.now());for(const d in this._tiles)c[d]||delete this._tiles[d]}freeRtt(t){for(const r in this._tiles){const c=this._tiles[r];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,r){return r?this._getTerrainCoordsForTileRanges(t,r):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const r={};for(const c of this._renderableTilesKeys){const d=this._tiles[c].tileID,_=t.clone(),b=o.b9();if(d.canonical.equals(t.canonical))o.bX(b,0,o.$,o.$,0,0,1);else if(d.canonical.isChildOf(t.canonical)){const M=d.canonical.z-t.canonical.z,T=d.canonical.x-(d.canonical.x>>M<<M),I=d.canonical.y-(d.canonical.y>>M<<M),R=o.$>>M;o.bX(b,0,R,R,0,0,1),o.M(b,b,[-T*R,-I*R,0])}else{if(!t.canonical.isChildOf(d.canonical))continue;{const M=t.canonical.z-d.canonical.z,T=t.canonical.x-(t.canonical.x>>M<<M),I=t.canonical.y-(t.canonical.y>>M<<M),R=o.$>>M;o.bX(b,0,o.$,o.$,0,0,1),o.M(b,b,[T*R,I*R,0]),o.N(b,b,[1/2**M,1/2**M,0])}}_.terrainRttPosMatrix32f=new Float32Array(b),r[c]=_}return r}_getTerrainCoordsForTileRanges(t,r){const c={};for(const d of this._renderableTilesKeys){const _=this._tiles[d].tileID;if(!this._isWithinTileRanges(_,r))continue;const b=t.clone(),M=o.b9();if(_.canonical.z===t.canonical.z){const T=t.canonical.x-_.canonical.x,I=t.canonical.y-_.canonical.y;o.bX(M,0,o.$,o.$,0,0,1),o.M(M,M,[T*o.$,I*o.$,0])}else if(_.canonical.z>t.canonical.z){const T=_.canonical.z-t.canonical.z,I=_.canonical.x-(_.canonical.x>>T<<T),R=_.canonical.y-(_.canonical.y>>T<<T),F=t.canonical.x-(_.canonical.x>>T),L=t.canonical.y-(_.canonical.y>>T),G=o.$>>T;o.bX(M,0,G,G,0,0,1),o.M(M,M,[-I*G+F*o.$,-R*G+L*o.$,0])}else{const T=t.canonical.z-_.canonical.z,I=t.canonical.x-(t.canonical.x>>T<<T),R=t.canonical.y-(t.canonical.y>>T<<T),F=(t.canonical.x>>T)-_.canonical.x,L=(t.canonical.y>>T)-_.canonical.y,G=o.$<<T;o.bX(M,0,G,G,0,0,1),o.M(M,M,[I*o.$+F*G,R*o.$+L*G,0])}b.terrainRttPosMatrix32f=new Float32Array(M),c[d]=b}return c}getSourceTile(t,r){const c=this.sourceCache._source;let d=t.overscaledZ-this.deltaZoom;if(d>c.maxzoom&&(d=c.maxzoom),d<c.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(d).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!_||!_.dem)&&r)for(;d>=c.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(t.scaledTo(d--).key);return _}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,r){return r[t.canonical.z]&&t.canonical.x>=r[t.canonical.z].minTileX&&t.canonical.x<=r[t.canonical.z].maxTileX&&t.canonical.y>=r[t.canonical.z].minTileY&&t.canonical.y<=r[t.canonical.z].maxTileY}}class ks{constructor(t,r,c){this._meshCache={},this.painter=t,this.sourceCache=new kf(r),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,c,d=o.$){var _;if(!(r>=0&&r<d&&c>=0&&c<d))return 0;const b=this.getTerrainData(t),M=(_=b.tile)===null||_===void 0?void 0:_.dem;if(!M)return 0;const T=o.cr([],[r/d*o.$,c/d*o.$],b.u_terrain_matrix),I=[T[0]*M.dim,T[1]*M.dim],R=Math.floor(I[0]),F=Math.floor(I[1]),L=I[0]-R,G=I[1]-F;return M.get(R,F)*(1-L)*(1-G)+M.get(R+1,F)*L*(1-G)+M.get(R,F+1)*(1-L)*G+M.get(R+1,F+1)*L*G}getElevationForLngLatZoom(t,r){if(!o.cs(r,t.wrap()))return 0;const{tileID:c,mercatorX:d,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(c,d%o.$,_%o.$,o.$)}getElevation(t,r,c,d=o.$){return this.getDEMElevation(t,r,c,d)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const d=this.painter.context,_=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(d,_,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(d,new o.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.af([])}const r=this.sourceCache.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const d=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new o.T(d,r.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),r.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const c=r&&r+r.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const d=this.sourceCache.sourceCache._source.maxzoom;let _=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=d?_=t.canonical.z-d:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=t.canonical.x-(t.canonical.x>>_<<_),M=t.canonical.y-(t.canonical.y>>_<<_),T=o.ct(new Float64Array(16),[1/(o.$<<_),1/(o.$<<_),0]);o.M(T,T,[b*o.$,M*o.$,0]),this._demMatrixCache[t.key]={matrix:T,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,c=r.width/devicePixelRatio,d=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(r.context,{width:c,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(r.context,{width:c,height:d,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(c,d,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,c,d))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,b=0;_<this._coordsTextureSize;_++)for(let M=0;M<this._coordsTextureSize;M++,b+=4)r[b+0]=255&M,r[b+1]=255&_,r[b+2]=M>>8<<4|_>>8,r[b+3]=0;const c=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),d=new o.T(t,c,t.gl.RGBA,{premultiply:!1});return d.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),c=this.painter.context,d=c.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(_,M-b-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null);const T=r[0]+(r[2]>>4<<8),I=r[1]+((15&r[2])<<8),R=this.coordsIndex[255-r[3]],F=R&&this.sourceCache.getTileByID(R);if(!F)return null;const L=this._coordsTextureSize,G=(1<<F.tileID.canonical.z)*L;return new o.a0((F.tileID.canonical.x*L+T)/G+F.tileID.wrap,(F.tileID.canonical.y*L+I)/G,this.getElevation(F.tileID,T,I,L))}depthAtPoint(t){const r=new Uint8Array(4),c=this.painter.context,d=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,r),c.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(t){var r;const c=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,d=c&&t.canonical.y===0,_=c&&t.canonical.y===(1<<t.canonical.z)-1,b=`m_${d?"n":""}_${_?"s":""}`;if(this._meshCache[b])return this._meshCache[b];const M=this.painter.context,T=new o.cu,I=new o.aM,R=this.meshSize,F=o.$/R,L=R*R;for(let ot=0;ot<=R;ot++)for(let bt=0;bt<=R;bt++)T.emplaceBack(bt*F,ot*F,0);for(let ot=0;ot<L;ot+=R+1)for(let bt=0;bt<R;bt++)I.emplaceBack(bt+ot,R+bt+ot+1,R+bt+ot+2),I.emplaceBack(bt+ot,R+bt+ot+2,bt+ot+1);const G=T.length,Z=G+(R+1),tt=(R+1)*R,Q=d?o.bg:0,et=d?0:1,st=_?o.bh:o.$,ht=_?0:1;for(let ot=0;ot<=R;ot++)T.emplaceBack(ot*F,Q,et);for(let ot=0;ot<=R;ot++)T.emplaceBack(ot*F,st,ht);for(let ot=0;ot<R;ot++)I.emplaceBack(tt+ot,Z+ot,Z+ot+1),I.emplaceBack(tt+ot,Z+ot+1,tt+ot+1),I.emplaceBack(0+ot,G+ot+1,G+ot),I.emplaceBack(0+ot,0+ot+1,G+ot+1);const at=T.length,dt=at+2*(R+1);for(const ot of[0,1])for(let bt=0;bt<=R;bt++)for(const It of[0,1])T.emplaceBack(ot*o.$,bt*F,It);for(let ot=0;ot<2*R;ot+=2)I.emplaceBack(at+ot,at+ot+1,at+ot+3),I.emplaceBack(at+ot,at+ot+3,at+ot+2),I.emplaceBack(dt+ot,dt+ot+3,dt+ot+1),I.emplaceBack(dt+ot,dt+ot+2,dt+ot+3);const pt=new Gs(M.createVertexBuffer(T,Gu.members),M.createIndexBuffer(I),o.aL.simpleSegment(0,0,T.length,I.length));return this._meshCache[b]=pt,pt}getMeshFrameDelta(t){return 2*Math.PI*o.bt/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,r){var c;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(c=this.getMinMaxElevation(d).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return r&&r.dem&&(c.minElevation=r.dem.min*this.exaggeration,c.maxElevation=r.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,r){const c=o.a0.fromLngLat(t.wrap()),d=(1<<r)*o.$,_=c.x*d,b=c.y*d,M=Math.floor(_/o.$),T=Math.floor(b/o.$);return{tileID:new o.Z(r,0,r,M,T),mercatorX:_,mercatorY:b}}}class fl{constructor(t,r,c){this._context=t,this._size=r,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(c.texture),{id:t,fbo:r,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>t.id!==r),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const ge={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Re{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new fl(t.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(c=>!t._layers[c].isHidden(r)),this._coordsAscending={};for(const c in t.sourceCaches){this._coordsAscending[c]={};const d=t.sourceCaches[c].getVisibleCoordinates(),_=t.sourceCaches[c].getSource(),b=_ instanceof Ne?_.terrainTileRanges:null;for(const M of d){const T=this.terrain.sourceCache.getTerrainCoords(M,b);for(const I in T)this._coordsAscending[c][I]||(this._coordsAscending[c][I]=[]),this._coordsAscending[c][I].push(T[I])}}this._coordsAscendingStr={};for(const c of t._order){const d=t._layers[c],_=d.source;if(ge[d.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const b in this._coordsAscending[_])this._coordsAscendingStr[_][b]=this._coordsAscending[_][b].map(M=>M.key).sort().join()}}for(const c of this._renderableTiles)for(const d in this._coordsAscendingStr){const _=this._coordsAscendingStr[d][c.tileID.key];_&&_!==c.rttCoords[d]&&(c.rtt=[])}}renderLayer(t,r){if(t.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),d=t.type,_=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ge[d]&&(this._prevType&&ge[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(t.id),!b))return!0;if(ge[this._prevType]||ge[d]&&b){this._prevType=d;const M=this._stacks.length-1,T=this._stacks[M]||[];for(const I of this._renderableTiles){if(this.pool.isFull()&&(Zi(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[M]){const F=this.pool.getObjectForId(I.rtt[M].id);if(F.stamp===I.rtt[M].stamp){this.pool.useObject(F);continue}}const R=this.pool.getOrCreateFreeObject();this.pool.useObject(R),this.pool.stampObject(R),I.rtt[M]={id:R.id,stamp:R.stamp},_.context.bindFramebuffer.set(R.fbo.framebuffer),_.context.clear({color:o.be.transparent,stencil:0}),_.currentStencilSource=void 0;for(let F=0;F<T.length;F++){const L=_.style._layers[T[F]],G=L.source?this._coordsAscending[L.source][I.tileID.key]:[I.tileID];_.context.viewport.set([0,0,R.fbo.width,R.fbo.height]),_._renderTileClippingMasks(L,G,!0),_.renderLayer(_,_.style.sourceCaches[L.source],L,G,c),L.source&&(I.rttCoords[L.source]=this._coordsAscendingStr[L.source][I.tileID.key])}}return Zi(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),ge[d]}return!1}}const pl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},qh=P,lo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:oo,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Fr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ju{constructor(t,r,c=!1){this.mousedown=_=>{this.startMove(_,B.mousePos(this.element,_)),B.addEventListener(window,"mousemove",this.mousemove),B.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,B.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHanlder.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=B.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),B.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=B.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const d=new Ef;this._rotatePitchHanlder=new ca({clickTolerance:3,move:(_,b)=>{const M=r.getBoundingClientRect(),T=new o.P((M.bottom-M.top)/2,(M.right-M.left)/2);return{bearingDelta:o.cm(new o.P(_.x,b.y),b,T),pitchDelta:c?-.5*(b.y-_.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=t,B.addEventListener(r,"mousedown",this.mousedown),B.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),B.addEventListener(r,"touchcancel",this.reset)}startMove(t,r){this._rotatePitchHanlder.dragStart(t,r),B.disableDrag()}move(t,r){const c=this.map,{bearingDelta:d,pitchDelta:_}=this._rotatePitchHanlder.dragMove(t,r)||{};d&&c.setBearing(c.getBearing()+d),_&&c.setPitch(c.getPitch()+_)}off(){const t=this.element;B.removeEventListener(t,"mousedown",this.mousedown),B.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend),B.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){B.enableDrag(),B.removeEventListener(window,"mousemove",this.mousemove),B.removeEventListener(window,"mouseup",this.mouseup),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend)}}let br;function Uu(g,t,r,c=!1){if(c||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return g==null?void 0:g.wrap();const d=new o.S(g.lng,g.lat);if(g=new o.S(g.lng,g.lat),t){const _=new o.S(g.lng-360,g.lat),b=new o.S(g.lng+360,g.lat),M=r.locationToScreenPoint(g).distSqr(t);r.locationToScreenPoint(_).distSqr(t)<M?g=_:r.locationToScreenPoint(b).distSqr(t)<M&&(g=b)}for(;Math.abs(g.lng-r.center.lng)>180;){const _=r.locationToScreenPoint(g);if(_.x>=0&&_.y>=0&&_.x<=r.width&&_.y<=r.height)break;g.lng>r.center.lng?g.lng-=360:g.lng+=360}return g.lng!==d.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(g))?g:d}const Dn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ji(g,t,r){const c=g.classList;for(const d in Dn)c.remove(`maplibregl-${r}-anchor-${d}`);c.add(`maplibregl-${r}-anchor-${t}`)}class Wi extends o.E{constructor(t){if(super(),this._onKeyPress=r=>{const c=r.code,d=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=r=>{const c=r.originalEvent.target,d=this._element;this._popup&&(c===d||d.contains(c))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=Uu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),B.setTransform(this._element,`${Dn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${d}`),k.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=B.create("div");const r=B.createNS("http://www.w3.org/2000/svg","svg"),c=41,d=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${c}px`),r.setAttributeNS(null,"width",`${d}px`),r.setAttributeNS(null,"viewBox",`0 0 ${d} ${c}`);const _=B.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const b=B.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const M=B.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const et of T){const st=B.createNS("http://www.w3.org/2000/svg","ellipse");st.setAttributeNS(null,"opacity","0.04"),st.setAttributeNS(null,"cx","10.5"),st.setAttributeNS(null,"cy","5.80029008"),st.setAttributeNS(null,"rx",et.rx),st.setAttributeNS(null,"ry",et.ry),M.appendChild(st)}const I=B.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const R=B.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(R);const F=B.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const L=B.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(L);const G=B.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const Z=B.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const tt=B.createNS("http://www.w3.org/2000/svg","circle");tt.setAttributeNS(null,"fill","#000000"),tt.setAttributeNS(null,"opacity","0.25"),tt.setAttributeNS(null,"cx","5.5"),tt.setAttributeNS(null,"cy","5.5"),tt.setAttributeNS(null,"r","5.4999962");const Q=B.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),Z.appendChild(tt),Z.appendChild(Q),b.appendChild(M),b.appendChild(I),b.appendChild(F),b.appendChild(G),b.appendChild(Z),r.appendChild(b),r.setAttributeNS(null,"height",c*this._scale+"px"),r.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(r),this._offset=o.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),ji(this._element,this._anchor,"marker"),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),B.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const d=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var r,c;const d=(r=this._map)===null||r===void 0?void 0:r.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!d||_){const G=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==G&&(this._element.style.opacity=G))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,M=b.terrain.depthAtPoint(this._pos),T=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,T)-M<.006)return void(this._element.style.opacity=this._opacity);const I=-this._offset.y/b.transform.pixelsPerMeter,R=Math.sin(b.getPitch()*Math.PI/180)*I,F=b.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),L=b.transform.lngLatToCameraDepth(this._lngLat,T+R)-F>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,r){return(this._opacity===void 0||t===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Vu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let an=0,on=!1;const $h={maxWidth:100,unit:"metric"};function ml(g,t,r){const c=r&&r.maxWidth||100,d=g._container.clientHeight/2,_=g._container.clientWidth/2,b=g.unproject([_-c/2,d]),M=g.unproject([_+c/2,d]),T=Math.round(g.project(M).x-g.project(b).x),I=Math.min(c,T,g._container.clientWidth),R=b.distanceTo(M);if(r&&r.unit==="imperial"){const F=3.2808*R;F>5280?zn(t,I,F/5280,g._getUIString("ScaleControl.Miles")):zn(t,I,F,g._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?zn(t,I,R/1852,g._getUIString("ScaleControl.NauticalMiles")):R>=1e3?zn(t,I,R/1e3,g._getUIString("ScaleControl.Kilometers")):zn(t,I,R,g._getUIString("ScaleControl.Meters"))}function zn(g,t,r,c){const d=function(_){const b=Math.pow(10,`${Math.floor(_)}`.length-1);let M=_/b;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(T){const I=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*I)/I}(M),b*M}(r);g.style.width=t*(d/r)+"px",g.innerHTML=`${d}&nbsp;${c}`}const ho={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Zh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gl(g){if(g){if(typeof g=="number"){const t=Math.round(Math.abs(g)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,g),"top-left":new o.P(t,t),"top-right":new o.P(-t,t),bottom:new o.P(0,-g),"bottom-left":new o.P(t,-t),"bottom-right":new o.P(-t,-t),left:new o.P(g,0),right:new o.P(-g,0)}}if(g instanceof o.P||Array.isArray(g)){const t=o.P.convert(g);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.P.convert(g.center||[0,0]),top:o.P.convert(g.top||[0,0]),"top-left":o.P.convert(g["top-left"]||[0,0]),"top-right":o.P.convert(g["top-right"]||[0,0]),bottom:o.P.convert(g.bottom||[0,0]),"bottom-left":o.P.convert(g["bottom-left"]||[0,0]),"bottom-right":o.P.convert(g["bottom-right"]||[0,0]),left:o.P.convert(g.left||[0,0]),right:o.P.convert(g.right||[0,0])}}return gl(new o.P(0,0))}const Wh=P;m.AJAXError=o.cy,m.Event=o.l,m.Evented=o.E,m.LngLat=o.S,m.MercatorCoordinate=o.a0,m.Point=o.P,m.addProtocol=o.cz,m.config=o.a,m.removeProtocol=o.cA,m.AttributionControl=dl,m.BoxZoomHandler=zh,m.CanvasSource=Oe,m.CooperativeGesturesHandler=Bu,m.DoubleClickZoomHandler=cl,m.DragPanHandler=Gh,m.DragRotateHandler=ul,m.EdgeInsets=hs,m.FullscreenControl=class extends o.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var t;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=r==null?void 0:r.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){B.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=B.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);B.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=we,m.GeolocateControl=class extends o.E{constructor(g){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new o.S(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,d=this._map.getBearing(),_=o.e({bearing:d},this.options.fitBoundsOptions),b=Me.fromLngLat(r,c);this._map.fitBounds(b,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new o.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&on)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=B.create("button","maplibregl-ctrl-geolocate",this._container),B.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=B.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Wi({element:this._dotElement}),this._circleElement=B.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))})}},this.options=o.e({},Vu,g)}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(t=!1){if(br!==void 0&&!t)return br;if(window.navigator.permissions===void 0)return br=!!window.navigator.geolocation,br;try{br=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{br=!!window.navigator.geolocation}return br})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),B.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,an=0,on=!1}_isOutOfMapMaxBounds(g){const t=this._map.getMaxBounds(),r=g.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),t=g.getSouthEast(),r=g.getNorthEast(),c=t.distanceTo(r),d=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":an--,on=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),an++,an>1?(g={maximumAge:6e5,timeout:0},on=!0):(g=this.options.positionOptions,on=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const t=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=B.create("button","maplibregl-ctrl-globe",this._container),B.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){B.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},m.Hash=eo,m.ImageSource=Ne,m.KeyboardHandler=fa,m.LngLatBounds=Me,m.LogoControl=Vh,m.Map=class extends Oi{constructor(g){var t,r;o.cv.mark(o.cw.create);const c=Object.assign(Object.assign(Object.assign({},lo),g),{canvasContextAttributes:Object.assign(Object.assign({},lo.canvasContextAttributes),g.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new rr,_=new Bo;if(c.minZoom!==void 0&&d.setMinZoom(c.minZoom),c.maxZoom!==void 0&&d.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&d.setMinPitch(c.minPitch),c.maxPitch!==void 0&&d.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&d.setRenderWorldCopies(c.renderWorldCopies),super(d,_,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Nu,this._controls=[],this._mapId=o.a6(),this._contextLost=M=>{M.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:M}))},this._contextRestored=M=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:M}))},this._onMapScroll=M=>{if(M.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},pl),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ct.addThrottleControl(()=>this.isMoving()),this._requestManager=new zt(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let M=!1;const T=sl(I=>{this._trackResize&&!this._removed&&(this.resize(I),this.redraw())},50);this._resizeObserver=new ResizeObserver(I=>{M?T(I):M=!0}),this._resizeObserver.observe(this._container)}this.handlers=new nn(this,c),this._hash=c.hash&&new eo(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.e({},c.fitBoundsOptions,{duration:0}))));const b=typeof c.style=="string"||((r=(t=c.style)===null||t===void 0?void 0:t.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,b),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new dl(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new Vh,c.logoPosition),this.on("style.load",()=>{if(b||this._resizeTransform(),this.transform.unmodified){const M=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(M)}}),this.on("data",M=>{this._update(M.dataType==="style"),this.fire(new o.l(`${M.dataType}data`,M))}),this.on("dataloading",M=>{this.fire(new o.l(`${M.dataType}dataloading`,M))}),this.on("dataabort",M=>{this.fire(new o.l("sourcedataabort",M))})}_getMapId(){return this._mapId}setGlobalStateProperty(g,t){return this.style.setGlobalStateProperty(g,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,t){if(t===void 0&&(t=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=g.onAdd(this);this._controls.push(g);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(g);return t>-1&&this._controls.splice(t,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,t,r,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,t,r,c)}resize(g,t=!0){const[r,c]=this._containerDimensions(),d=this._getClampedPixelRatio(r,c);if(this._resizeCanvas(r,c,d),this.painter.resize(r,c,d),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const M=this._getClampedPixelRatio(r,c);this._resizeCanvas(r,c,M),this.painter.resize(r,c,M)}this._resizeTransform(t);const _=!this._moving;return _&&(this.stop(),this.fire(new o.l("movestart",g)).fire(new o.l("move",g))),this.fire(new o.l("resize",g)),_&&this.fire(new o.l("moveend",g)),this}_resizeTransform(g=!0){var t;const[r,c]=this._containerDimensions();this.transform.resize(r,c,g),(t=this._requestedCameraState)===null||t===void 0||t.resize(r,c,g)}_getClampedPixelRatio(g,t){const{0:r,1:c}=this._maxCanvasSize,d=this.getPixelRatio(),_=g*d,b=t*d;return Math.min(_>r?r/_:1,b>c?c/b:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Me.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}project(g){return this.transform.locationToScreenPoint(o.S.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(o.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,t,r){if(g==="mouseenter"||g==="mouseover"){let c=!1;return{layers:t,listener:r,delegates:{mousemove:_=>{const b=t.filter(T=>this.getLayer(T)),M=b.length!==0?this.queryRenderedFeatures(_.point,{layers:b}):[];M.length?c||(c=!0,r.call(this,new Hr(g,this,_.originalEvent,{features:M}))):c=!1},mouseout:()=>{c=!1}}}}if(g==="mouseleave"||g==="mouseout"){let c=!1;return{layers:t,listener:r,delegates:{mousemove:b=>{const M=t.filter(T=>this.getLayer(T));(M.length!==0?this.queryRenderedFeatures(b.point,{layers:M}):[]).length?c=!0:c&&(c=!1,r.call(this,new Hr(g,this,b.originalEvent)))},mouseout:b=>{c&&(c=!1,r.call(this,new Hr(g,this,b.originalEvent)))}}}}{const c=d=>{const _=t.filter(M=>this.getLayer(M)),b=_.length!==0?this.queryRenderedFeatures(d.point,{layers:_}):[];b.length&&(d.features=b,r.call(this,d),delete d.features)};return{layers:t,listener:r,delegates:{[g]:c}}}}_saveDelegatedListener(g,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(t)}_removeDelegatedListener(g,t,r){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const c=this._delegatedListeners[g];for(let d=0;d<c.length;d++){const _=c[d];if(_.listener===r&&_.layers.length===t.length&&_.layers.every(b=>t.includes(b))){for(const b in _.delegates)this.off(b,_.delegates[b]);return void c.splice(d,1)}}}on(g,t,r){if(r===void 0)return super.on(g,t);const c=typeof t=="string"?[t]:t,d=this._createDelegatedListener(g,c,r);this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(g,c,r)}}}once(g,t,r){if(r===void 0)return super.once(g,t);const c=typeof t=="string"?[t]:t,d=this._createDelegatedListener(g,c,r);for(const _ in d.delegates){const b=d.delegates[_];d.delegates[_]=(...M)=>{this._removeDelegatedListener(g,c,r),b(...M)}}this._saveDelegatedListener(g,d);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(g,t,r){return r===void 0?super.off(g,t):(this._removeDelegatedListener(g,typeof t=="string"?[t]:t,r),this)}queryRenderedFeatures(g,t){if(!this.style)return[];let r;const c=g instanceof o.P||Array.isArray(g),d=c?g:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:g)||{},d instanceof o.P||typeof d[0]=="number")r=[o.P.convert(d)];else{const _=o.P.convert(d[0]),b=o.P.convert(d[1]);r=[_,new o.P(b.x,_.y),b,new o.P(_.x,b.y),_]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(g,t){return this.style.querySourceFeatures(g,t)}setStyle(g,t){return(t=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(g,t))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const t=this._locale[g];if(t==null)throw new Error(`Missing UI string '${g}'`);return t}_updateStyle(g,t){var r,c;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,t));const d=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new uh(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,t,d):this.style.loadJSON(g,t,d),this):((c=(r=this.style)===null||r===void 0?void 0:r.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new uh(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,t){if(typeof g=="string"){const r=this._requestManager.transformRequest(g,"Style");o.j(r,new AbortController).then(c=>{this._updateDiff(c.data,t)}).catch(c=>{c&&this.fire(new o.k(c))})}else typeof g=="object"&&this._updateDiff(g,t)}_updateDiff(g,t){try{this.style.setState(g,t)&&this._update(!0)}catch(r){o.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(g,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(g,t){return this._lazyInitEmptyStyle(),this.style.addSource(g,t),this._update(!0)}isSourceLoaded(g){const t=this.style&&this.style.sourceCaches[g];if(t!==void 0)return t.loaded();this.fire(new o.k(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const t=this.style.sourceCaches[g.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&t.reload();for(const r in this.style._layers){const c=this.style._layers[r];c.type==="hillshade"&&c.source===g.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===g.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ks(this.painter,t,g),this.painter.renderToTexture=new Re(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var c;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=r.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:g})),this}getTerrain(){var g,t;return(t=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const t in g){const r=g[t]._tiles;for(const c in r){const d=r[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,t,r){if(r){const c=this.getSource(r);if(!c)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);c.calculateTileZoom=St(Math.max(1,g),Math.max(1,t))}else for(const c in this.style.sourceCaches)this.style.sourceCaches[c].getSource().calculateTileZoom=St(Math.max(1,g),Math.max(1,t));return this._update(!0),this}refreshTiles(g,t){const r=this.style.sourceCaches[g];if(!r)throw new Error(`There is no source cache with ID "${g}", cannot refresh tile`);t===void 0?r.reload(!0):r.refreshTiles(t.map(c=>new o.a3(c.z,c.x,c.y)))}addImage(g,t,r={}){const{pixelRatio:c=1,sdf:d=!1,stretchX:_,stretchY:b,content:M,textFitWidth:T,textFitHeight:I}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||o.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:F,data:L}=t,G=t;return this.style.addImage(g,{data:new o.R({width:R,height:F},new Uint8Array(L)),pixelRatio:c,stretchX:_,stretchY:b,content:M,textFitWidth:T,textFitHeight:I,sdf:d,version:0,userImage:G}),G.onAdd&&G.onAdd(this,g),this}}{const{width:R,height:F,data:L}=k.getImageData(t);this.style.addImage(g,{data:new o.R({width:R,height:F},L),pixelRatio:c,stretchX:_,stretchY:b,content:M,textFitWidth:T,textFitHeight:I,sdf:d,version:0})}}updateImage(g,t){const r=this.style.getImage(g);if(!r)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||o.b(t)?k.getImageData(t):t,{width:d,height:_,data:b}=c;if(d===void 0||_===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==r.data.width||_!==r.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(t instanceof HTMLImageElement||o.b(t));return r.data.replace(b,M),this.style.updateImage(g,r),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return Ct.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,t){return this._lazyInitEmptyStyle(),this.style.addLayer(g,t),this._update(!0)}moveLayer(g,t){return this.style.moveLayer(g,t),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,t,r){return this.style.setLayerZoomRange(g,t,r),this._update(!0)}setFilter(g,t,r={}){return this.style.setFilter(g,t,r),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,t,r,c={}){return this.style.setPaintProperty(g,t,r,c),this._update(!0)}getPaintProperty(g,t){return this.style.getPaintProperty(g,t)}setLayoutProperty(g,t,r,c={}){return this.style.setLayoutProperty(g,t,r,c),this._update(!0)}getLayoutProperty(g,t){return this.style.getLayoutProperty(g,t)}setGlyphs(g,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,t,r,c=>{c||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,t,r=>{r||this._update(!0)}),this}setLight(g,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,t){return this.style.setFeatureState(g,t),this._update()}removeFeatureState(g,t){return this.style.removeFeatureState(g,t),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,t=0;return this._container&&(g=this._container.clientWidth||400,t=this._container.clientHeight||300),[g,t]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const t=this._canvasContainer=B.create("div","maplibregl-canvas-container",g);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=B.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),c=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],c);const d=this._controlContainer=B.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=B.create("div",`maplibregl-ctrl-${b} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,t,r){this._canvas.width=Math.floor(r*g),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{t={requestedAttributes:g},c&&(t.statusMessage=c.statusMessage,t.type=c.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!r){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new ds(r,this.transform),V.testSupport(r)}migrateProjection(g,t){super.migrateProjection(g,t),this.painter.transform=g,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var t,r,c,d,_;const b=this._idleTriggered?this._fadeDuration:0,M=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,L=k.now();this.style.zoomHistory.update(F,L);const G=new o.F(F,{now:L,fadeDuration:b,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),Z=G.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(T=!0,this._crossFadingFactor=Z),this.style.update(G)}const I=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==M;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||I)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,I),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cv.mark(o.cw.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const R=this._sourcesDirty||this._styleDirty||this._placementDirty;return R||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,o.cv.mark(o.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ct.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),B.remove(this._canvasContainer),B.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cv.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,k.frame(this._frameRequest,g=>{o.cv.frame(g),this._frameRequest=null;try{this._render(g)}catch(t){if(!o.cx(t)&&!function(r){return r.message===Ph}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return qh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},m.MapMouseEvent=Hr,m.MapTouchEvent=xs,m.MapWheelEvent=Dh,m.Marker=Wi,m.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,r)=>{const c=this._map._getUIString(`NavigationControl.${r}`);t.title=c,t.setAttribute("aria-label",c)},this.options=o.e({},Fr,g),this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),B.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),B.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=B.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ju(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){B.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,t){const r=B.create("button",g,this._container);return r.type="button",r.addEventListener("click",t),r}},m.Popup=class extends o.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&B.remove(this._content),this._container&&(B.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=B.create("div","maplibregl-popup",this._map.getContainer()),this._tip=B.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Uu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const r=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const d=gl(this.options.offset);if(!c){const b=this._container.offsetWidth,M=this._container.offsetHeight;let T;T=r.y+d.bottom.y<M?["top"]:r.y>this._map.transform.height-M?["bottom"]:[],r.x<b/2?T.push("left"):r.x>this._map.transform.width-b/2&&T.push("right"),c=T.length===0?"bottom":T.join("-")}let _=r.add(d[c]);this.options.subpixelPositioning||(_=_.round()),B.setTransform(this._container,`${Dn[c]} translate(${_.x}px,${_.y}px)`),ji(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(ho),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=o.S.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const t=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=g;c=r.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=B.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=B.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Zh);g&&g.focus()}},m.RasterDEMTileSource=he,m.RasterTileSource=ee,m.ScaleControl=class{constructor(g){this._onMove=()=>{ml(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ml(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},$h),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){B.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=Fu,m.Style=uh,m.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=B.create("button","maplibregl-ctrl-terrain",this._container),B.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){B.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Fh,m.TwoFingersTouchRotateHandler=Oh,m.TwoFingersTouchZoomHandler=Rs,m.TwoFingersTouchZoomRotateHandler=jh,m.VectorTileSource=ii,m.VideoSource=Be,m.addSourceType=(g,t)=>o._(void 0,void 0,void 0,function*(){if(Ue(g))throw new Error(`A source type called "${g}" already exists.`);((r,c)=>{Ge[r]=c})(g,t)}),m.clearPrewarmedResources=function(){const g=Gt;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Wt),Gt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.createTileMesh=lh,m.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return Ye().getRTLTextPluginStatus()},m.getVersion=function(){return Wh},m.getWorkerCount=function(){return Ut.workerCount},m.getWorkerUrl=function(){return o.a.WORKER_URL},m.importScriptInWorkers=function(g){return _e().broadcast("IS",g)},m.prewarm=function(){Se().acquire(Wt)},m.setMaxParallelImageRequests=function(g){o.a.MAX_PARALLEL_IMAGE_REQUESTS=g},m.setRTLTextPlugin=function(g,t){return Ye().setRTLTextPlugin(g,t)},m.setWorkerCount=function(g){Ut.workerCount=g},m.setWorkerUrl=function(g){o.a.WORKER_URL=g}});var x=l;return x})}(Pd)),Pd.exports}var Xw=Hw();const Kw=wm(Xw);jc(["click"]);const{LngLatBounds:v4,LngLat:x4}=Kw;jc(["click","dblclick","contextmenu","mousemove","keydown"]);var Vc=Uint8Array,Ay=Uint16Array,Yw=Int32Array,Jw=new Vc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qw=new Vc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ry=function(a,i){for(var l=new Ay(31),u=0;u<31;++u)l[u]=i+=1<<a[u-1];for(var p=new Yw(l[30]),u=1;u<30;++u)for(var x=l[u];x<l[u+1];++x)p[x]=x-l[u]<<5|u;return{b:l,r:p}},ky=Ry(Jw,2),t2=ky.b,e2=ky.r;t2[28]=258,e2[258]=28;Ry(Qw,0);var i2=new Ay(32768);for(Ei=0;Ei<32768;++Ei)Bn=(Ei&43690)>>1|(Ei&21845)<<1,Bn=(Bn&52428)>>2|(Bn&13107)<<2,Bn=(Bn&61680)>>4|(Bn&3855)<<4,i2[Ei]=((Bn&65280)>>8|(Bn&255)<<8)>>1;var Bn,Ei,Qd=new Vc(288);for(Ei=0;Ei<144;++Ei)Qd[Ei]=8;var Ei;for(Ei=144;Ei<256;++Ei)Qd[Ei]=9;var Ei;for(Ei=256;Ei<280;++Ei)Qd[Ei]=7;var Ei;for(Ei=280;Ei<288;++Ei)Qd[Ei]=8;var Ei,r2=new Vc(32);for(Ei=0;Ei<32;++Ei)r2[Ei]=5;var Ei,s2=new Vc(0),n2=typeof TextDecoder<"u"&&new TextDecoder,a2=0;try{n2.decode(s2,{stream:!0}),a2=1}catch{}jc(["click"]);function o2(a,i){return a>i?1:a<i?-1:0}function Im(a,i,l){if(a[0]<=i)return 0;const u=a.length;if(i<=a[u-1])return u-1;if(typeof l=="function"){for(let p=1;p<u;++p){const x=a[p];if(x===i)return p;if(x<i)return l(i,a[p-1],x)>0?p-1:p}return u-1}if(l>0){for(let p=1;p<u;++p)if(a[p]<i)return p-1;return u-1}if(l<0){for(let p=1;p<u;++p)if(a[p]<=i)return p;return u-1}for(let p=1;p<u;++p){if(a[p]==i)return p;if(a[p]<i)return a[p-1]-i<i-a[p]?p-1:p}return u-1}function l2(a,i){const l=Array.isArray(i)?i:[i],u=l.length;for(let p=0;p<u;p++)a[a.length]=l[p]}function Dy(a,i){const l=a.length;if(l!==i.length)return!1;for(let u=0;u<l;u++)if(a[u]!==i[u])return!1;return!0}const Co=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",h2=Co.includes("safari")&&!Co.includes("chrom");h2&&(Co.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Co));Co.includes("webkit")&&Co.includes("edge");Co.includes("macintosh");const c2=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,zy=typeof Image<"u"&&Image.prototype.decode,Ly=typeof createImageBitmap=="function";(function(){let a=!1;try{const i=Object.defineProperty({},"passive",{get:function(){a=!0}});window.addEventListener("_",null,i),window.removeEventListener("_",null,i)}catch{}return a})();function Ao(a,i,l,u){let p;return l&&l.length?p=l.shift():c2?p=new OffscreenCanvas(a||300,i||300):p=document.createElement("canvas"),a&&(p.width=a),i&&(p.height=i),p.getContext("2d",u)}let Ap;function s0(){return Ap||(Ap=Ao(1,1)),Ap}function Oy(a){const i=a.canvas;i.width=1,i.height=1,a.clearRect(0,0,1,1)}function _s(a,i,l){return Math.min(Math.max(a,i),l)}function u2(a,i,l,u,p,x){const m=p-l,o=x-u;if(m!==0||o!==0){const P=((a-l)*m+(i-u)*o)/(m*m+o*o);P>1?(l=p,u=x):P>0&&(l+=m*P,u+=o*P)}return Vl(a,i,l,u)}function Vl(a,i,l,u){const p=l-a,x=u-i;return p*p+x*x}function d2(a){const i=a.length;for(let u=0;u<i;u++){let p=u,x=Math.abs(a[u][u]);for(let o=u+1;o<i;o++){const P=Math.abs(a[o][u]);P>x&&(x=P,p=o)}if(x===0)return null;const m=a[p];a[p]=a[u],a[u]=m;for(let o=u+1;o<i;o++){const P=-a[o][u]/a[u][u];for(let A=u;A<i+1;A++)u==A?a[o][A]=0:a[o][A]+=P*a[u][A]}}const l=new Array(i);for(let u=i-1;u>=0;u--){l[u]=a[u][i]/a[u][u];for(let p=u-1;p>=0;p--)a[p][i]-=a[p][u]*l[u]}return l}function n0(a){return a*180/Math.PI}function Ta(a){return a*Math.PI/180}function Pc(a,i){const l=a%i;return l*i<0?l+i:l}function f2(a,i,l){return a+l*(i-a)}function Fy(a,i){const l=Math.pow(10,i);return Math.round(a*l)/l}function _d(a,i){return Math.ceil(Fy(a,i))}function Qp(a,i,l){if(a>=i&&a<l)return a;const u=l-i;return((a-i)%u+u)%u+i}const p2=[NaN,NaN,NaN,0];let Rp;function m2(){return Rp||(Rp=Ao(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),Rp}const g2=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,_2=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,y2=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,v2=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function yd(a,i){return a.endsWith("%")?Number(a.substring(0,a.length-1))/i:Number(a)}function Ec(a){throw new Error('failed to parse "'+a+'" as color')}function By(a){if(a.toLowerCase().startsWith("rgb")){const x=a.match(_2)||a.match(g2)||a.match(y2);if(x){const m=x[4],o=100/255;return[_s(yd(x[1],o)+.5|0,0,255),_s(yd(x[2],o)+.5|0,0,255),_s(yd(x[3],o)+.5|0,0,255),m!==void 0?_s(yd(m,100),0,1):1]}Ec(a)}if(a.startsWith("#")){if(v2.test(a)){const x=a.substring(1),m=x.length<=4?1:2,o=[0,0,0,255];for(let P=0,A=x.length;P<A;P+=m){let O=parseInt(x.substring(P,P+m),16);m===1&&(O+=O<<4),o[P/m]=O}return o[3]=o[3]/255,o}Ec(a)}const i=m2();i.fillStyle="#abcdef";let l=i.fillStyle;i.fillStyle=a,i.fillStyle===l&&(i.fillStyle="#fedcba",l=i.fillStyle,i.fillStyle=a,i.fillStyle===l&&Ec(a));const u=i.fillStyle;if(u.startsWith("#")||u.startsWith("rgba"))return By(u);i.clearRect(0,0,1,1),i.fillRect(0,0,1,1);const p=Array.from(i.getImageData(0,0,1,1).data);return p[3]=Fy(p[3]/255,3),p}const x2=1024,pc={};let kp=0;function b2(a){if(a==="none")return p2;if(pc.hasOwnProperty(a))return pc[a];if(kp>=x2){let l=0;for(const u in pc)(l++&3)===0&&(delete pc[u],--kp)}const i=By(a);i.length!==4&&Ec(a);for(const l of i)isNaN(l)&&Ec(a);return pc[a]=i,++kp,i}function a0(a){return Array.isArray(a)?a:b2(a)}const jr={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function o0(a){const i=th();for(let l=0,u=a.length;l<u;++l)Ed(i,a[l]);return i}function Ny(a,i,l){let u,p;return i<a[0]?u=a[0]-i:a[2]<i?u=i-a[2]:u=0,l<a[1]?p=a[1]-l:a[3]<l?p=l-a[3]:p=0,u*u+p*p}function Gy(a,i){return jy(a,i[0],i[1])}function tm(a,i){return a[0]<=i[0]&&i[2]<=a[2]&&a[1]<=i[1]&&i[3]<=a[3]}function jy(a,i,l){return a[0]<=i&&i<=a[2]&&a[1]<=l&&l<=a[3]}function l0(a,i){const l=a[0],u=a[1],p=a[2],x=a[3],m=i[0],o=i[1];let P=jr.UNKNOWN;return m<l?P=P|jr.LEFT:m>p&&(P=P|jr.RIGHT),o<u?P=P|jr.BELOW:o>x&&(P=P|jr.ABOVE),P===jr.UNKNOWN&&(P=jr.INTERSECTING),P}function th(){return[1/0,1/0,-1/0,-1/0]}function Cm(a,i,l,u,p){return p?(p[0]=a,p[1]=i,p[2]=l,p[3]=u,p):[a,i,l,u]}function Am(a){return Cm(1/0,1/0,-1/0,-1/0,a)}function w2(a,i){const l=a[0],u=a[1];return Cm(l,u,l,u,i)}function M2(a,i,l,u,p){const x=Am(p);return Uy(x,a,i,l,u)}function S2(a,i){return a[0]==i[0]&&a[2]==i[2]&&a[1]==i[1]&&a[3]==i[3]}function T2(a,i){return i[0]<a[0]&&(a[0]=i[0]),i[2]>a[2]&&(a[2]=i[2]),i[1]<a[1]&&(a[1]=i[1]),i[3]>a[3]&&(a[3]=i[3]),a}function Ed(a,i){i[0]<a[0]&&(a[0]=i[0]),i[0]>a[2]&&(a[2]=i[0]),i[1]<a[1]&&(a[1]=i[1]),i[1]>a[3]&&(a[3]=i[1])}function Uy(a,i,l,u,p){for(;l<u;l+=p)P2(a,i[l],i[l+1]);return a}function P2(a,i,l){a[0]=Math.min(a[0],i),a[1]=Math.min(a[1],l),a[2]=Math.max(a[2],i),a[3]=Math.max(a[3],l)}function E2(a,i){let l;return l=i(Rm(a)),l||(l=i(km(a)),l)||(l=i(Dm(a)),l)||(l=i(tf(a)),l)?l:!1}function I2(a){let i=0;return qc(a)||(i=Ir(a)*ns(a)),i}function Rm(a){return[a[0],a[1]]}function km(a){return[a[2],a[1]]}function Xl(a){return[(a[0]+a[2])/2,(a[1]+a[3])/2]}function Vy(a,i,l,u,p){const[x,m,o,P,A,O,D,k]=C2(a,i,l,u);return Cm(Math.min(x,o,A,D),Math.min(m,P,O,k),Math.max(x,o,A,D),Math.max(m,P,O,k),p)}function C2(a,i,l,u){const p=i*u[0]/2,x=i*u[1]/2,m=Math.cos(l),o=Math.sin(l),P=p*m,A=p*o,O=x*m,D=x*o,k=a[0],B=a[1];return[k-P+D,B-A-O,k-P-D,B-A+O,k+P-D,B+A+O,k+P+D,B+A-O,k-P+D,B-A-O]}function ns(a){return a[3]-a[1]}function qy(a,i,l){const u=l||th();return eh(a,i)?(a[0]>i[0]?u[0]=a[0]:u[0]=i[0],a[1]>i[1]?u[1]=a[1]:u[1]=i[1],a[2]<i[2]?u[2]=a[2]:u[2]=i[2],a[3]<i[3]?u[3]=a[3]:u[3]=i[3]):Am(u),u}function tf(a){return[a[0],a[3]]}function Dm(a){return[a[2],a[3]]}function Ir(a){return a[2]-a[0]}function eh(a,i){return a[0]<=i[2]&&a[2]>=i[0]&&a[1]<=i[3]&&a[3]>=i[1]}function qc(a){return a[2]<a[0]||a[3]<a[1]}function A2(a,i){return i?(i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i):a}function R2(a,i,l){let u=!1;const p=l0(a,i),x=l0(a,l);if(p===jr.INTERSECTING||x===jr.INTERSECTING)u=!0;else{const m=a[0],o=a[1],P=a[2],A=a[3],O=i[0],D=i[1],k=l[0],B=l[1],V=(B-D)/(k-O);let K,it;x&jr.ABOVE&&!(p&jr.ABOVE)&&(K=k-(B-A)/V,u=K>=m&&K<=P),!u&&x&jr.RIGHT&&!(p&jr.RIGHT)&&(it=B-(k-P)*V,u=it>=o&&it<=A),!u&&x&jr.BELOW&&!(p&jr.BELOW)&&(K=k-(B-o)/V,u=K>=m&&K<=P),!u&&x&jr.LEFT&&!(p&jr.LEFT)&&(it=B-(k-m)*V,u=it>=o&&it<=A)}return u}function k2(...a){console.warn(...a)}function D2(a,i){return a[0]+=+i[0],a[1]+=+i[1],a}function Nd(a,i){let l=!0;for(let u=a.length-1;u>=0;--u)if(a[u]!=i[u]){l=!1;break}return l}function z2(a,i){const l=Math.cos(i),u=Math.sin(i),p=a[0]*l-a[1]*u,x=a[1]*l+a[0]*u;return a[0]=p,a[1]=x,a}const $y={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let zm=class{constructor(i){this.code_=i.code,this.units_=i.units,this.extent_=i.extent!==void 0?i.extent:null,this.worldExtent_=i.worldExtent!==void 0?i.worldExtent:null,this.axisOrientation_=i.axisOrientation!==void 0?i.axisOrientation:"enu",this.global_=i.global!==void 0?i.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=i.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=i.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||$y[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(i){this.global_=i,this.canWrapX_=!!(i&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(i){this.defaultTileGrid_=i}setExtent(i){this.extent_=i,this.canWrapX_=!!(this.global_&&i)}setWorldExtent(i){this.worldExtent_=i}setGetPointResolution(i){this.getPointResolutionFunc_=i}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const $c=6378137,Ll=Math.PI*$c,L2=[-Ll,-Ll,Ll,Ll],O2=[-180,-85,180,85],vd=$c*Math.log(Math.tan(Math.PI/2));class Rl extends zm{constructor(i){super({code:i,units:"m",extent:L2,global:!0,worldExtent:O2,getPointResolution:function(l,u){return l/Math.cosh(u[1]/$c)}})}}const h0=[new Rl("EPSG:3857"),new Rl("EPSG:102100"),new Rl("EPSG:102113"),new Rl("EPSG:900913"),new Rl("http://www.opengis.net/def/crs/EPSG/0/3857"),new Rl("http://www.opengis.net/gml/srs/epsg.xml#3857")];function F2(a,i,l,u){const p=a.length;l=l>1?l:2,u=u??l,i===void 0&&(l>2?i=a.slice():i=new Array(p));for(let x=0;x<p;x+=u){i[x]=Ll*a[x]/180;let m=$c*Math.log(Math.tan(Math.PI*(+a[x+1]+90)/360));m>vd?m=vd:m<-vd&&(m=-vd),i[x+1]=m}return i}function B2(a,i,l,u){const p=a.length;l=l>1?l:2,u=u??l,i===void 0&&(l>2?i=a.slice():i=new Array(p));for(let x=0;x<p;x+=u)i[x]=180*a[x]/Ll,i[x+1]=360*Math.atan(Math.exp(a[x+1]/$c))/Math.PI-90;return i}const N2=6378137,c0=[-180,-90,180,90],G2=Math.PI*N2/180;class Mo extends zm{constructor(i,l){super({code:i,units:"degrees",extent:c0,axisOrientation:l,global:!0,metersPerUnit:G2,worldExtent:c0})}}const u0=[new Mo("CRS:84"),new Mo("EPSG:4326","neu"),new Mo("urn:ogc:def:crs:OGC:1.3:CRS84"),new Mo("urn:ogc:def:crs:OGC:2:84"),new Mo("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Mo("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Mo("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let em={};function j2(a){return em[a]||em[a.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function U2(a,i){em[a]=i}function Zy(a){for(const i in a)delete a[i]}function V2(a){let i;for(i in a)return!1;return!i}let ql={};function Lc(a,i,l){const u=a.getCode(),p=i.getCode();u in ql||(ql[u]={}),ql[u][p]=l}function Dp(a,i){return a in ql&&i in ql[a]?ql[a][i]:null}const Gd=.9996,Ls=.00669438,ef=Ls*Ls,rf=ef*Ls,Po=Ls/(1-Ls),d0=Math.sqrt(1-Ls),Kl=(1-d0)/(1+d0),Wy=Kl*Kl,Lm=Wy*Kl,Om=Lm*Kl,Hy=Om*Kl,Xy=1-Ls/4-3*ef/64-5*rf/256,q2=3*Ls/8+3*ef/32+45*rf/1024,$2=15*ef/256+45*rf/1024,Z2=35*rf/3072,W2=3/2*Kl-27/32*Lm+269/512*Hy,H2=21/16*Wy-55/32*Om,X2=151/96*Lm-417/128*Hy,K2=1097/512*Om,jd=6378137;function Y2(a,i,l){const u=a-5e5,m=(l.north?i:i-1e7)/Gd/(jd*Xy),o=m+W2*Math.sin(2*m)+H2*Math.sin(4*m)+X2*Math.sin(6*m)+K2*Math.sin(8*m),P=Math.sin(o),A=P*P,O=Math.cos(o),D=P/O,k=D*D,B=k*k,V=1-Ls*A,K=Math.sqrt(1-Ls*A),it=jd/K,gt=(1-Ls)/V,ct=Po*O**2,Dt=ct*ct,Ct=u/(it*Gd),zt=Ct*Ct,ae=zt*Ct,ke=ae*Ct,de=ke*Ct,Le=de*Ct,Xe=o-D/gt*(zt/2-ke/24*(5+3*k+10*ct-4*Dt-9*Po))+Le/720*(61+90*k+298*ct+45*B-252*Po-3*Dt);let ne=(Ct-ae/6*(1+2*k+ct)+de/120*(5-2*ct+28*k-3*Dt+8*Po+24*B))/O;return ne=Qp(ne+Ta(Ky(l.number)),-Math.PI,Math.PI),[n0(ne),n0(Xe)]}const f0=-80,p0=84,J2=-180,Q2=180;function tM(a,i,l){a=Qp(a,J2,Q2),i<f0?i=f0:i>p0&&(i=p0);const u=Ta(i),p=Math.sin(u),x=Math.cos(u),m=p/x,o=m*m,P=o*o,A=Ta(a),O=Ky(l.number),D=Ta(O),k=jd/Math.sqrt(1-Ls*p**2),B=Po*x**2,V=x*Qp(A-D,-Math.PI,Math.PI),K=V*V,it=K*V,gt=it*V,ct=gt*V,Dt=ct*V,Ct=jd*(Xy*u-q2*Math.sin(2*u)+$2*Math.sin(4*u)-Z2*Math.sin(6*u)),zt=Gd*k*(V+it/6*(1-o+B)+ct/120*(5-18*o+P+72*B-58*Po))+5e5;let ae=Gd*(Ct+k*m*(K/2+gt/24*(5-o+9*B+4*B**2)+Dt/720*(61-58*o+P+600*B-330*Po)));return l.north||(ae+=1e7),[zt,ae]}function Ky(a){return(a-1)*6-180+3}const eM=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Yy(a){let i=0;for(const p of eM){const x=a.match(p);if(x){i=parseInt(x[1]);break}}if(!i)return null;let l=0,u=!1;return i>32700&&i<32761?l=i-32700:i>32600&&i<32661&&(u=!0,l=i-32600),l?{number:l,north:u}:null}function m0(a,i){return function(l,u,p,x){const m=l.length;p=p>1?p:2,x=x??p,u||(p>2?u=l.slice():u=new Array(m));for(let o=0;o<m;o+=x){const P=l[o],A=l[o+1],O=a(P,A,i);u[o]=O[0],u[o+1]=O[1]}return u}}function iM(a){return Yy(a)?new zm({code:a,units:"m"}):null}function rM(a){const i=Yy(a.getCode());return i?{forward:m0(tM,i),inverse:m0(Y2,i)}:null}const sM=63710088e-1;function g0(a,i,l){l=l||sM;const u=Ta(a[1]),p=Ta(i[1]),x=(p-u)/2,m=Ta(i[0]-a[0])/2,o=Math.sin(x)*Math.sin(x)+Math.sin(m)*Math.sin(m)*Math.cos(u)*Math.cos(p);return 2*l*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}const nM=[rM],aM=[iM];let im=!0;function oM(a){im=!1}function Fm(a,i){if(i!==void 0){for(let l=0,u=a.length;l<u;++l)i[l]=a[l];i=i}else i=a.slice();return i}function rm(a){U2(a.getCode(),a),Lc(a,a,Fm)}function lM(a){a.forEach(rm)}function Qs(a){if(typeof a!="string")return a;const i=j2(a);if(i)return i;for(const l of aM){const u=l(a);if(u)return u}return null}function _0(a,i,l,u){a=Qs(a);let p;const x=a.getPointResolutionFunc();if(x)p=x(i,l);else{const m=a.getUnits();if(m=="degrees"||u=="degrees")p=i;else{const o=Nm(a,Qs("EPSG:4326"));if(!o&&m!=="degrees")p=i*a.getMetersPerUnit();else{let A=[l[0]-i/2,l[1],l[0]+i/2,l[1],l[0],l[1]-i/2,l[0],l[1]+i/2];A=o(A,A,2);const O=g0(A.slice(0,2),A.slice(2,4)),D=g0(A.slice(4,6),A.slice(6,8));p=(O+D)/2}const P=a.getMetersPerUnit();P!==void 0&&(p/=P)}}return p}function y0(a){lM(a),a.forEach(function(i){a.forEach(function(l){i!==l&&Lc(i,l,Fm)})})}function hM(a,i,l,u){a.forEach(function(p){i.forEach(function(x){Lc(p,x,l),Lc(x,p,u)})})}function Bm(a,i){return a?typeof a=="string"?Qs(a):a:Qs(i)}function cM(a){return function(i,l,u,p){const x=i.length;u=u!==void 0?u:2,p=p??u,l=l!==void 0?l:new Array(x);for(let m=0;m<x;m+=p){const o=a(i.slice(m,m+u)),P=o.length;for(let A=0,O=p;A<O;++A)l[m+A]=A>=P?i[m+A]:o[A]}return l}}function v0(a,i){if(a===i)return!0;const l=a.getUnits()===i.getUnits();return(a.getCode()===i.getCode()||Nm(a,i)===Fm)&&l}function Nm(a,i){const l=a.getCode(),u=i.getCode();let p=Dp(l,u);if(p)return p;let x=null,m=null;for(const P of nM)x||(x=P(a)),m||(m=P(i));if(!x&&!m)return null;const o="EPSG:4326";if(m)if(x)p=zp(x.inverse,m.forward);else{const P=Dp(l,o);P&&(p=zp(P,m.forward))}else{const P=Dp(o,u);P&&(p=zp(x.inverse,P))}return p&&(rm(a),rm(i),Lc(a,i,p)),p}function zp(a,i){return function(l,u,p,x){return u=a(l,u,p,x),i(u,u,p,x)}}function Ud(a,i){const l=Qs(a),u=Qs(i);return Nm(l,u)}function Jy(a,i,l){const u=Ud(i,l);if(!u){const p=Qs(i).getCode(),x=Qs(l).getCode();throw new Error(`No transform available between ${p} and ${x}`)}return u(a,void 0,a.length)}function x0(a,i){return a}function xa(a,i){return im&&!Nd(a,[0,0])&&a[0]>=-180&&a[0]<=180&&a[1]>=-90&&a[1]<=90&&(im=!1,k2("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),a}function uM(a,i){return a}function Ol(a,i){return a}function dM(){y0(h0),y0(u0),hM(u0,h0,F2,B2)}dM();function Gn(a,i){if(!a)throw new Error(i)}new Array(6);function Id(){return[1,0,0,1,0,0]}function _n(a,i){const l=i[0],u=i[1];return i[0]=a[0]*l+a[2]*u+a[4],i[1]=a[1]*l+a[3]*u+a[5],i}function Vd(a,i,l,u,p,x,m,o){const P=Math.sin(x),A=Math.cos(x);return a[0]=u*A,a[1]=p*P,a[2]=-u*P,a[3]=p*A,a[4]=m*u*A-o*u*P+i,a[5]=m*p*P+o*p*A+l,a}function fM(a,i){const l=pM(i);Gn(l!==0,"Transformation matrix cannot be inverted");const u=i[0],p=i[1],x=i[2],m=i[3],o=i[4],P=i[5];return a[0]=m/l,a[1]=-p/l,a[2]=-x/l,a[3]=u/l,a[4]=(x*P-m*o)/l,a[5]=-(u*P-p*o)/l,a}function pM(a){return a[0]*a[3]-a[1]*a[2]}const mM=[1e5,1e5,1e5,1e5,2,2];function gM(a){return"matrix("+a.join(", ")+")"}function b0(a){return a.substring(7,a.length-1).split(",").map(parseFloat)}function _M(a,i){const l=b0(a),u=b0(i);for(let p=0;p<6;++p)if(Math.round((l[p]-u[p])*mM[p])!==0)return!1;return!0}class yM{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Dr(){throw new Error("Unimplemented abstract method.")}let vM=0;function xM(a){return a.ol_uid||(a.ol_uid=String(++vM))}function bM(a){return Math.pow(a,3)}function wM(a){return 1-bM(1-a)}function MM(a){return 3*a*a-2*a*a*a}const Ea={CHANGE:"change"};function sm(){}function SM(a){let i,l,u;return function(){const p=Array.prototype.slice.call(arguments);return(!l||this!==u||!Dy(p,l))&&(u=this,l=p,i=a.apply(this,arguments)),i}}function TM(a){function i(){let l;try{l=a()}catch(u){return Promise.reject(u)}return l instanceof Promise?l:Promise.resolve(l)}return i()}class sf{constructor(i){this.propagationStopped,this.defaultPrevented,this.type=i,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Qy extends yM{constructor(i){super(),this.eventTarget_=i,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(i,l){if(!i||!l)return;const u=this.listeners_||(this.listeners_={}),p=u[i]||(u[i]=[]);p.includes(l)||p.push(l)}dispatchEvent(i){const l=typeof i=="string",u=l?i:i.type,p=this.listeners_&&this.listeners_[u];if(!p)return;const x=l?new sf(i):i;x.target||(x.target=this.eventTarget_||this);const m=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});u in m||(m[u]=0,o[u]=0),++m[u];let P;for(let A=0,O=p.length;A<O;++A)if("handleEvent"in p[A]?P=p[A].handleEvent(x):P=p[A].call(this,x),P===!1||x.propagationStopped){P=!1;break}if(--m[u]===0){let A=o[u];for(delete o[u];A--;)this.removeEventListener(u,sm);delete m[u]}return P}disposeInternal(){this.listeners_&&Zy(this.listeners_)}getListeners(i){return this.listeners_&&this.listeners_[i]||void 0}hasListener(i){return this.listeners_?i?i in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(i,l){if(!this.listeners_)return;const u=this.listeners_[i];if(!u)return;const p=u.indexOf(l);p!==-1&&(this.pendingRemovals_&&i in this.pendingRemovals_?(u[p]=sm,++this.pendingRemovals_[i]):(u.splice(p,1),u.length===0&&delete this.listeners_[i]))}}const Xi={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Io(a,i,l,u,p){if(p){const m=l;l=function(o){return a.removeEventListener(i,l),m.call(u??this,o)}}else u&&u!==a&&(l=l.bind(u));const x={target:a,type:i,listener:l};return a.addEventListener(i,l),x}function w0(a,i,l,u){return Io(a,i,l,u,!0)}function $l(a){a&&a.target&&(a.target.removeEventListener(a.type,a.listener),Zy(a))}class Gm extends Qy{constructor(i,l,u,p){super(),this.extent=i,this.pixelRatio_=u,this.resolution=l,this.state=typeof p=="function"?Xi.IDLE:p,this.image_=null,this.loader=typeof p=="function"?p:null}changed(){this.dispatchEvent(Ea.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==Xi.IDLE&&this.loader){this.state=Xi.LOADING,this.changed();const i=this.getResolution(),l=Array.isArray(i)?i[0]:i;TM(()=>this.loader(this.getExtent(),l,this.getPixelRatio())).then(u=>{"image"in u&&(this.image_=u.image),"extent"in u&&(this.extent=u.extent),"resolution"in u&&(this.resolution=u.resolution),"pixelRatio"in u&&(this.pixelRatio_=u.pixelRatio),(u instanceof HTMLImageElement||Ly&&u instanceof ImageBitmap||u instanceof HTMLCanvasElement||u instanceof HTMLVideoElement)&&(this.image_=u),this.state=Xi.LOADED}).catch(u=>{this.state=Xi.ERROR,console.error(u)}).finally(()=>this.changed())}}setImage(i){this.image_=i}setResolution(i){this.resolution=i}}function PM(a,i){return new Promise((l,u)=>{function p(){m(),l(a)}function x(){m(),u(new Error("Image load error"))}function m(){a.removeEventListener("load",p),a.removeEventListener("error",x)}a.addEventListener("load",p),a.addEventListener("error",x)})}function EM(a,i){return a.src&&zy?new Promise((l,u)=>a.decode().then(()=>l(a)).catch(p=>a.complete&&a.width?l(a):u(p))):PM(a)}function t1(a,i){return i&&(a.src=i),a.src&&zy&&Ly?a.decode().then(()=>createImageBitmap(a)).catch(l=>{if(a.complete&&a.width)return a;throw l}):EM(a)}let Lp;const Ic=[];function M0(a,i,l,u,p){a.beginPath(),a.moveTo(0,0),a.lineTo(i,l),a.lineTo(u,p),a.closePath(),a.save(),a.clip(),a.fillRect(0,0,Math.max(i,u)+1,Math.max(l,p)),a.restore()}function Op(a,i){return Math.abs(a[i*4]-210)>2||Math.abs(a[i*4+3]-.75*255)>2}function IM(){if(Lp===void 0){const a=Ao(6,6,Ic);a.globalCompositeOperation="lighter",a.fillStyle="rgba(210, 0, 0, 0.75)",M0(a,4,5,4,0),M0(a,4,5,0,5);const i=a.getImageData(0,0,3,3).data;Lp=Op(i,0)||Op(i,4)||Op(i,8),Oy(a),Ic.push(a.canvas)}return Lp}function CM(a,i,l,u){const p=Jy(l,i,a);let x=_0(i,u,l);const m=i.getMetersPerUnit();m!==void 0&&(x*=m);const o=a.getMetersPerUnit();o!==void 0&&(x/=o);const P=a.getExtent();if(!P||Gy(P,p)){const A=_0(a,x,p)/x;isFinite(A)&&A>0&&(x/=A)}return x}function AM(a,i,l,u,p,x,m,o,P,A,O,D,k,B){const V=Ao(Math.round(l*a),Math.round(l*i),Ic);if(D||(V.imageSmoothingEnabled=!1),P.length===0)return V.canvas;V.scale(l,l);function K(zt){return Math.round(zt*l)/l}V.globalCompositeOperation="lighter";const it=th();P.forEach(function(zt,ae,ke){T2(it,zt.extent)});let gt;const ct=l/u,Dt=(D?1:1+Math.pow(2,-24))/ct;(P.length!==1||A!==0)&&(gt=Ao(Math.round(Ir(it)*ct),Math.round(ns(it)*ct),Ic),D||(gt.imageSmoothingEnabled=!1),P.forEach(function(zt,ae,ke){if(zt.image.width>0&&zt.image.height>0){if(zt.clipExtent){gt.save();const le=(zt.clipExtent[0]-it[0])*ct,be=-(zt.clipExtent[3]-it[3])*ct,qe=Ir(zt.clipExtent)*ct,Ce=ns(zt.clipExtent)*ct;gt.rect(D?le:Math.round(le),D?be:Math.round(be),D?qe:Math.round(le+qe)-Math.round(le),D?Ce:Math.round(be+Ce)-Math.round(be)),gt.clip()}const de=(zt.extent[0]-it[0])*ct,Le=-(zt.extent[3]-it[3])*ct,Xe=Ir(zt.extent)*ct,ne=ns(zt.extent)*ct;gt.drawImage(zt.image,A,A,zt.image.width-2*A,zt.image.height-2*A,D?de:Math.round(de),D?Le:Math.round(Le),D?Xe:Math.round(de+Xe)-Math.round(de),D?ne:Math.round(Le+ne)-Math.round(Le)),zt.clipExtent&&gt.restore()}}));const Ct=tf(m);return o.getTriangles().forEach(function(zt,ae,ke){const de=zt.source,Le=zt.target;let Xe=de[0][0],ne=de[0][1],le=de[1][0],be=de[1][1],qe=de[2][0],Ce=de[2][1];const ui=K((Le[0][0]-Ct[0])/x),yi=K(-(Le[0][1]-Ct[1])/x),Ft=K((Le[1][0]-Ct[0])/x),qt=K(-(Le[1][1]-Ct[1])/x),Wt=K((Le[2][0]-Ct[0])/x),Ut=K(-(Le[2][1]-Ct[1])/x),Et=Xe,Gt=ne;Xe=0,ne=0,le-=Et,be-=Gt,qe-=Et,Ce-=Gt;const se=[[le,be,0,0,Ft-ui],[qe,Ce,0,0,Wt-ui],[0,0,le,be,qt-yi],[0,0,qe,Ce,Ut-yi]],Se=d2(se);if(!Se)return;if(V.save(),V.beginPath(),IM()||!D){V.moveTo(Ft,qt);const _e=4,je=ui-Ft,ue=yi-qt;for(let De=0;De<_e;De++)V.lineTo(Ft+K((De+1)*je/_e),qt+K(De*ue/(_e-1))),De!=_e-1&&V.lineTo(Ft+K((De+1)*je/_e),qt+K((De+1)*ue/(_e-1)));V.lineTo(Wt,Ut)}else V.moveTo(Ft,qt),V.lineTo(ui,yi),V.lineTo(Wt,Ut);V.clip(),V.transform(Se[0],Se[2],Se[1],Se[3],ui,yi),V.translate(it[0]-Et,it[3]-Gt);let Ee;if(gt)Ee=gt.canvas,V.scale(Dt,-Dt);else{const _e=P[0],je=_e.extent;Ee=_e.image,V.scale(Ir(je)/Ee.width,-ns(je)/Ee.height)}V.drawImage(Ee,0,0),V.restore()}),gt&&(Oy(gt),Ic.push(gt.canvas)),V.canvas}const RM=10,S0=.25;class kM{constructor(i,l,u,p,x,m,o){this.sourceProj_=i,this.targetProj_=l;let P={};const A=o?cM(Dt=>_n(o,Jy(Dt,this.targetProj_,this.sourceProj_))):Ud(this.targetProj_,this.sourceProj_);this.transformInv_=function(Dt){const Ct=Dt[0]+"/"+Dt[1];return P[Ct]||(P[Ct]=A(Dt)),P[Ct]},this.maxSourceExtent_=p,this.errorThresholdSquared_=x*x,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!p&&!!this.sourceProj_.getExtent()&&Ir(p)>=Ir(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Ir(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Ir(this.targetProj_.getExtent()):null;const O=tf(u),D=Dm(u),k=km(u),B=Rm(u),V=this.transformInv_(O),K=this.transformInv_(D),it=this.transformInv_(k),gt=this.transformInv_(B),ct=RM+(m?Math.max(0,Math.ceil(Math.log2(I2(u)/(m*m*256*256)))):0);if(this.addQuad_(O,D,k,B,V,K,it,gt,ct),this.wrapsXInSource_){let Dt=1/0;this.triangles_.forEach(function(Ct,zt,ae){Dt=Math.min(Dt,Ct.source[0][0],Ct.source[1][0],Ct.source[2][0])}),this.triangles_.forEach(Ct=>{if(Math.max(Ct.source[0][0],Ct.source[1][0],Ct.source[2][0])-Dt>this.sourceWorldWidth_/2){const zt=[[Ct.source[0][0],Ct.source[0][1]],[Ct.source[1][0],Ct.source[1][1]],[Ct.source[2][0],Ct.source[2][1]]];zt[0][0]-Dt>this.sourceWorldWidth_/2&&(zt[0][0]-=this.sourceWorldWidth_),zt[1][0]-Dt>this.sourceWorldWidth_/2&&(zt[1][0]-=this.sourceWorldWidth_),zt[2][0]-Dt>this.sourceWorldWidth_/2&&(zt[2][0]-=this.sourceWorldWidth_);const ae=Math.min(zt[0][0],zt[1][0],zt[2][0]);Math.max(zt[0][0],zt[1][0],zt[2][0])-ae<this.sourceWorldWidth_/2&&(Ct.source=zt)}})}P={}}addTriangle_(i,l,u,p,x,m){this.triangles_.push({source:[p,x,m],target:[i,l,u]})}addQuad_(i,l,u,p,x,m,o,P,A){const O=o0([x,m,o,P]),D=this.sourceWorldWidth_?Ir(O)/this.sourceWorldWidth_:null,k=this.sourceWorldWidth_,B=this.sourceProj_.canWrapX()&&D>.5&&D<1;let V=!1;if(A>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const it=o0([i,l,u,p]);V=Ir(it)/this.targetWorldWidth_>S0||V}!B&&this.sourceProj_.isGlobal()&&D&&(V=D>S0||V)}if(!V&&this.maxSourceExtent_&&isFinite(O[0])&&isFinite(O[1])&&isFinite(O[2])&&isFinite(O[3])&&!eh(O,this.maxSourceExtent_))return;let K=0;if(!V&&(!isFinite(x[0])||!isFinite(x[1])||!isFinite(m[0])||!isFinite(m[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(P[0])||!isFinite(P[1]))){if(A>0)V=!0;else if(K=(!isFinite(x[0])||!isFinite(x[1])?8:0)+(!isFinite(m[0])||!isFinite(m[1])?4:0)+(!isFinite(o[0])||!isFinite(o[1])?2:0)+(!isFinite(P[0])||!isFinite(P[1])?1:0),K!=1&&K!=2&&K!=4&&K!=8)return}if(A>0){if(!V){const it=[(i[0]+u[0])/2,(i[1]+u[1])/2],gt=this.transformInv_(it);let ct;B?ct=(Pc(x[0],k)+Pc(o[0],k))/2-Pc(gt[0],k):ct=(x[0]+o[0])/2-gt[0];const Dt=(x[1]+o[1])/2-gt[1];V=ct*ct+Dt*Dt>this.errorThresholdSquared_}if(V){if(Math.abs(i[0]-u[0])<=Math.abs(i[1]-u[1])){const it=[(l[0]+u[0])/2,(l[1]+u[1])/2],gt=this.transformInv_(it),ct=[(p[0]+i[0])/2,(p[1]+i[1])/2],Dt=this.transformInv_(ct);this.addQuad_(i,l,it,ct,x,m,gt,Dt,A-1),this.addQuad_(ct,it,u,p,Dt,gt,o,P,A-1)}else{const it=[(i[0]+l[0])/2,(i[1]+l[1])/2],gt=this.transformInv_(it),ct=[(u[0]+p[0])/2,(u[1]+p[1])/2],Dt=this.transformInv_(ct);this.addQuad_(i,it,ct,p,x,gt,Dt,P,A-1),this.addQuad_(it,l,u,ct,gt,m,o,Dt,A-1)}return}}if(B){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(K&11)==0&&this.addTriangle_(i,u,p,x,o,P),(K&14)==0&&this.addTriangle_(i,u,l,x,o,m),K&&((K&13)==0&&this.addTriangle_(l,p,i,m,P,x),(K&7)==0&&this.addTriangle_(l,p,u,m,P,o))}calculateSourceExtent(){const i=th();return this.triangles_.forEach(function(l,u,p){const x=l.source;Ed(i,x[0]),Ed(i,x[1]),Ed(i,x[2])}),i}getTriangles(){return this.triangles_}}const DM=.5,Di={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class zM extends sf{constructor(i,l,u,p){super(i),this.inversePixelTransform=l,this.frameState=u,this.context=p}}const yc={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose"};class e1 extends Qy{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Ea.CHANGE)}getRevision(){return this.revision_}onInternal(i,l){if(Array.isArray(i)){const u=i.length,p=new Array(u);for(let x=0;x<u;++x)p[x]=Io(this,i[x],l);return p}return Io(this,i,l)}onceInternal(i,l){let u;if(Array.isArray(i)){const p=i.length;u=new Array(p);for(let x=0;x<p;++x)u[x]=w0(this,i[x],l)}else u=w0(this,i,l);return l.ol_key=u,u}unInternal(i,l){const u=l.ol_key;if(u)LM(u);else if(Array.isArray(i))for(let p=0,x=i.length;p<x;++p)this.removeEventListener(i[p],l);else this.removeEventListener(i,l)}}function LM(a){if(Array.isArray(a))for(let i=0,l=a.length;i<l;++i)$l(a[i]);else $l(a)}const OM=5;class FM extends e1{constructor(i){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=i,this.staleKeys_=new Array,this.maxStaleKeys=OM}getStaleKeys(){return this.staleKeys_}prependStaleKey(i){this.staleKeys_.unshift(i),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(i){return Dr()}getData(i){return null}prepareFrame(i){return Dr()}renderFrame(i,l){return Dr()}forEachFeatureAtCoordinate(i,l,u,p,x){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(i){const l=i.target;(l.getState()===Xi.LOADED||l.getState()===Xi.ERROR)&&this.renderIfReadyAndVisible()}loadImage(i){let l=i.getState();return l!=Xi.LOADED&&l!=Xi.ERROR&&i.addEventListener(Ea.CHANGE,this.boundHandleImageChange_),l==Xi.IDLE&&(i.load(),l=i.getState()),l==Xi.LOADED}renderIfReadyAndVisible(){const i=this.getLayer();i&&i.getVisible()&&i.getSourceState()==="ready"&&i.changed()}renderDeferred(i){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const BM={PROPERTYCHANGE:"propertychange"};class T0 extends sf{constructor(i,l,u){super(i),this.key=l,this.oldValue=u}}class nf extends e1{constructor(i){super(),this.on,this.once,this.un,xM(this),this.values_=null,i!==void 0&&this.setProperties(i)}get(i){let l;return this.values_&&this.values_.hasOwnProperty(i)&&(l=this.values_[i]),l}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(i,l){let u;u=`change:${i}`,this.hasListener(u)&&this.dispatchEvent(new T0(u,i,l)),u=BM.PROPERTYCHANGE,this.hasListener(u)&&this.dispatchEvent(new T0(u,i,l))}addChangeListener(i,l){this.addEventListener(`change:${i}`,l)}removeChangeListener(i,l){this.removeEventListener(`change:${i}`,l)}set(i,l,u){const p=this.values_||(this.values_={});if(u)p[i]=l;else{const x=p[i];p[i]=l,x!==l&&this.notify(i,x)}}setProperties(i,l){for(const u in i)this.set(u,i[u],l)}applyProperties(i){i.values_&&Object.assign(this.values_||(this.values_={}),i.values_)}unset(i,l){if(this.values_&&i in this.values_){const u=this.values_[i];delete this.values_[i],V2(this.values_)&&(this.values_=null),l||this.notify(i,u)}}}const yn={ANIMATING:0,INTERACTING:1},Ks={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function P0(a,i,l){return function(u,p,x,m,o){if(!u)return;if(!p&&!i)return u;const P=i?0:x[0]*p,A=i?0:x[1]*p,O=o?o[0]:0,D=o?o[1]:0;let k=a[0]+P/2+O,B=a[2]-P/2+O,V=a[1]+A/2+D,K=a[3]-A/2+D;k>B&&(k=(B+k)/2,B=k),V>K&&(V=(K+V)/2,K=V);let it=_s(u[0],k,B),gt=_s(u[1],V,K);if(m&&l&&p){const ct=30*p;it+=-ct*Math.log(1+Math.max(0,k-u[0])/ct)+ct*Math.log(1+Math.max(0,u[0]-B)/ct),gt+=-ct*Math.log(1+Math.max(0,V-u[1])/ct)+ct*Math.log(1+Math.max(0,u[1]-K)/ct)}return[it,gt]}}function NM(a){return a}function GM(a,i,l,u,p,x,m){x=x||[],m=m||2;let o=0;for(let P=i;P<l;P+=u){const A=a[P],O=a[P+1];x[o++]=p[0]*A+p[2]*O+p[4],x[o++]=p[1]*A+p[3]*O+p[5];for(let D=2;D<m;D++)x[o++]=a[P+D]}return x&&x.length!=o&&(x.length=o),x}function jM(a,i,l,u,p,x,m){m=m||[];const o=Math.cos(p),P=Math.sin(p),A=x[0],O=x[1];let D=0;for(let k=i;k<l;k+=u){const B=a[k]-A,V=a[k+1]-O;m[D++]=A+B*o-V*P,m[D++]=O+B*P+V*o;for(let K=k+2;K<k+u;++K)m[D++]=a[K]}return m&&m.length!=D&&(m.length=D),m}function UM(a,i,l,u,p,x,m,o){o=o||[];const P=m[0],A=m[1];let O=0;for(let D=i;D<l;D+=u){const k=a[D]-P,B=a[D+1]-A;o[O++]=P+p*k,o[O++]=A+x*B;for(let V=D+2;V<D+u;++V)o[O++]=a[V]}return o&&o.length!=O&&(o.length=O),o}function VM(a,i,l,u,p,x,m){m=m||[];let o=0;for(let P=i;P<l;P+=u){m[o++]=a[P]+p,m[o++]=a[P+1]+x;for(let A=P+2;A<P+u;++A)m[o++]=a[A]}return m&&m.length!=o&&(m.length=o),m}const E0=Id(),qM=[NaN,NaN];class $M extends nf{constructor(){super(),this.extent_=th(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=SM((i,l,u)=>{if(!u)return this.getSimplifiedGeometry(l);const p=this.clone();return p.applyTransform(u),p.getSimplifiedGeometry(l)})}simplifyTransformed(i,l){return this.simplifyTransformedInternal(this.getRevision(),i,l)}clone(){return Dr()}closestPointXY(i,l,u,p){return Dr()}containsXY(i,l){return this.closestPointXY(i,l,qM,Number.MIN_VALUE)===0}getClosestPoint(i,l){return l=l||[NaN,NaN],this.closestPointXY(i[0],i[1],l,1/0),l}intersectsCoordinate(i){return this.containsXY(i[0],i[1])}computeExtent(i){return Dr()}getExtent(i){if(this.extentRevision_!=this.getRevision()){const l=this.computeExtent(this.extent_);(isNaN(l[0])||isNaN(l[1]))&&Am(l),this.extentRevision_=this.getRevision()}return A2(this.extent_,i)}rotate(i,l){Dr()}scale(i,l,u){Dr()}simplify(i){return this.getSimplifiedGeometry(i*i)}getSimplifiedGeometry(i){return Dr()}getType(){return Dr()}applyTransform(i){Dr()}intersectsExtent(i){return Dr()}translate(i,l){Dr()}transform(i,l){const u=Qs(i),p=u.getUnits()=="tile-pixels"?function(x,m,o){const P=u.getExtent(),A=u.getWorldExtent(),O=ns(A)/ns(P);Vd(E0,A[0],A[3],O,-O,0,0,0);const D=GM(x,0,x.length,o,E0,m),k=Ud(u,l);return k?k(D,D,o):D}:Ud(u,l);return this.applyTransform(p),this}}class jm extends $M{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(i){return M2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i)}getCoordinates(){return Dr()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(i){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),i<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&i<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const l=this.getSimplifiedGeometryInternal(i);return l.getFlatCoordinates().length<this.flatCoordinates.length?l:(this.simplifiedGeometryMaxMinSquaredTolerance=i,this)}getSimplifiedGeometryInternal(i){return this}getStride(){return this.stride}setFlatCoordinates(i,l){this.stride=I0(i),this.layout=i,this.flatCoordinates=l}setCoordinates(i,l){Dr()}setLayout(i,l,u){let p;if(i)p=I0(i);else{for(let x=0;x<u;++x){if(l.length===0){this.layout="XY",this.stride=2;return}l=l[0]}p=l.length,i=ZM(p)}this.layout=i,this.stride=p}applyTransform(i){this.flatCoordinates&&(i(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(i,l){const u=this.getFlatCoordinates();if(u){const p=this.getStride();jM(u,0,u.length,p,i,l,u),this.changed()}}scale(i,l,u){l===void 0&&(l=i),u||(u=Xl(this.getExtent()));const p=this.getFlatCoordinates();if(p){const x=this.getStride();UM(p,0,p.length,x,i,l,u,p),this.changed()}}translate(i,l){const u=this.getFlatCoordinates();if(u){const p=this.getStride();VM(u,0,u.length,p,i,l,u),this.changed()}}}function ZM(a){let i;return a==2?i="XY":a==3?i="XYZ":a==4&&(i="XYZM"),i}function I0(a){let i;return a=="XY"?i=2:a=="XYZ"||a=="XYM"?i=3:a=="XYZM"&&(i=4),i}function i1(a,i,l,u){let p=0;const x=a[l-u],m=a[l-u+1];let o=0,P=0;for(;i<l;i+=u){const A=a[i]-x,O=a[i+1]-m;p+=P*A-o*O,o=A,P=O}return p/2}function WM(a,i,l,u){let p=0;for(let x=0,m=l.length;x<m;++x){const o=l[x];p+=i1(a,i,o,u),i=o}return p}function C0(a,i,l,u,p,x,m){const o=a[i],P=a[i+1],A=a[l]-o,O=a[l+1]-P;let D;if(A===0&&O===0)D=i;else{const k=((p-o)*A+(x-P)*O)/(A*A+O*O);if(k>1)D=l;else if(k>0){for(let B=0;B<u;++B)m[B]=f2(a[i+B],a[l+B],k);m.length=u;return}else D=i}for(let k=0;k<u;++k)m[k]=a[D+k];m.length=u}function r1(a,i,l,u,p){let x=a[i],m=a[i+1];for(i+=u;i<l;i+=u){const o=a[i],P=a[i+1],A=Vl(x,m,o,P);A>p&&(p=A),x=o,m=P}return p}function HM(a,i,l,u,p){for(let x=0,m=l.length;x<m;++x){const o=l[x];p=r1(a,i,o,u,p),i=o}return p}function s1(a,i,l,u,p,x,m,o,P,A,O){if(i==l)return A;let D,k;if(p===0){if(k=Vl(m,o,a[i],a[i+1]),k<A){for(D=0;D<u;++D)P[D]=a[i+D];return P.length=u,k}return A}O=O||[NaN,NaN];let B=i+u;for(;B<l;)if(C0(a,B-u,B,u,m,o,O),k=Vl(m,o,O[0],O[1]),k<A){for(A=k,D=0;D<u;++D)P[D]=O[D];P.length=u,B+=u}else B+=u*Math.max((Math.sqrt(k)-Math.sqrt(A))/p|0,1);if(C0(a,l-u,i,u,m,o,O),k=Vl(m,o,O[0],O[1]),k<A){for(A=k,D=0;D<u;++D)P[D]=O[D];P.length=u}return A}function XM(a,i,l,u,p,x,m,o,P,A,O){O=O||[NaN,NaN];for(let D=0,k=l.length;D<k;++D){const B=l[D];A=s1(a,i,B,u,p,x,m,o,P,A,O),i=B}return A}function KM(a,i,l,u){for(let p=0,x=l.length;p<x;++p)a[i++]=l[p];return i}function n1(a,i,l,u){for(let p=0,x=l.length;p<x;++p){const m=l[p];for(let o=0;o<u;++o)a[i++]=m[o]}return i}function YM(a,i,l,u,p){p=p||[];let x=0;for(let m=0,o=l.length;m<o;++m){const P=n1(a,i,l[m],u);p[x++]=P,i=P}return p.length=x,p}function a1(a,i,l,u,p){p=p!==void 0?p:[];let x=0;for(let m=i;m<l;m+=u)p[x++]=a.slice(m,m+u);return p.length=x,p}function JM(a,i,l,u,p){p=p!==void 0?p:[];let x=0;for(let m=0,o=l.length;m<o;++m){const P=l[m];p[x++]=a1(a,i,P,u,p[x]),i=P}return p.length=x,p}function QM(a,i,l,u,p,x,m){const o=(l-i)/u;if(o<3){for(;i<l;i+=u)x[m++]=a[i],x[m++]=a[i+1];return m}const P=new Array(o);P[0]=1,P[o-1]=1;const A=[i,l-u];let O=0;for(;A.length>0;){const D=A.pop(),k=A.pop();let B=0;const V=a[k],K=a[k+1],it=a[D],gt=a[D+1];for(let ct=k+u;ct<D;ct+=u){const Dt=a[ct],Ct=a[ct+1],zt=u2(Dt,Ct,V,K,it,gt);zt>B&&(O=ct,B=zt)}B>p&&(P[(O-i)/u]=1,k+u<O&&A.push(k,O),O+u<D&&A.push(O,D))}for(let D=0;D<o;++D)P[D]&&(x[m++]=a[i+D*u],x[m++]=a[i+D*u+1]);return m}function kl(a,i){return i*Math.round(a/i)}function tS(a,i,l,u,p,x,m){if(i==l)return m;let o=kl(a[i],p),P=kl(a[i+1],p);i+=u,x[m++]=o,x[m++]=P;let A,O;do if(A=kl(a[i],p),O=kl(a[i+1],p),i+=u,i==l)return x[m++]=A,x[m++]=O,m;while(A==o&&O==P);for(;i<l;){const D=kl(a[i],p),k=kl(a[i+1],p);if(i+=u,D==A&&k==O)continue;const B=A-o,V=O-P,K=D-o,it=k-P;if(B*it==V*K&&(B<0&&K<B||B==K||B>0&&K>B)&&(V<0&&it<V||V==it||V>0&&it>V)){A=D,O=k;continue}x[m++]=A,x[m++]=O,o=A,P=O,A=D,O=k}return x[m++]=A,x[m++]=O,m}function eS(a,i,l,u,p,x,m,o){for(let P=0,A=l.length;P<A;++P){const O=l[P];m=tS(a,i,O,u,p,x,m),o.push(m),i=O}return m}class Oc extends jm{constructor(i,l){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,l!==void 0&&!Array.isArray(i[0])?this.setFlatCoordinates(l,i):this.setCoordinates(i,l)}clone(){return new Oc(this.flatCoordinates.slice(),this.layout)}closestPointXY(i,l,u,p){return p<Ny(this.getExtent(),i,l)?p:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(r1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),s1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,i,l,u,p))}getArea(){return i1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return a1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(i){const l=[];return l.length=QM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i,l,0),new Oc(l,"XY")}getType(){return"LinearRing"}intersectsExtent(i){return!1}setCoordinates(i,l){this.setLayout(l,i,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=n1(this.flatCoordinates,0,i,this.stride),this.changed()}}let iS=class o1 extends jm{constructor(i,l){super(),this.setCoordinates(i,l)}clone(){const i=new o1(this.flatCoordinates.slice(),this.layout);return i.applyProperties(this),i}closestPointXY(i,l,u,p){const x=this.flatCoordinates,m=Vl(i,l,x[0],x[1]);if(m<p){const o=this.stride;for(let P=0;P<o;++P)u[P]=x[P];return u.length=o,m}return p}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(i){return w2(this.flatCoordinates,i)}getType(){return"Point"}intersectsExtent(i){return jy(i,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(i,l){this.setLayout(l,i,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=KM(this.flatCoordinates,0,i,this.stride),this.changed()}};function rS(a,i,l,u,p){return!E2(p,function(m){return!Eo(a,i,l,u,m[0],m[1])})}function Eo(a,i,l,u,p,x){let m=0,o=a[l-u],P=a[l-u+1];for(;i<l;i+=u){const A=a[i],O=a[i+1];P<=x?O>x&&(A-o)*(x-P)-(p-o)*(O-P)>0&&m++:O<=x&&(A-o)*(x-P)-(p-o)*(O-P)<0&&m--,o=A,P=O}return m!==0}function l1(a,i,l,u,p,x){if(l.length===0||!Eo(a,i,l[0],u,p,x))return!1;for(let m=1,o=l.length;m<o;++m)if(Eo(a,l[m-1],l[m],u,p,x))return!1;return!0}function sS(a,i,l,u,p,x,m){let o,P,A,O,D,k,B;const V=p[x+1],K=[];for(let ct=0,Dt=l.length;ct<Dt;++ct){const Ct=l[ct];for(O=a[Ct-u],k=a[Ct-u+1],o=i;o<Ct;o+=u)D=a[o],B=a[o+1],(V<=k&&B<=V||k<=V&&V<=B)&&(A=(V-k)/(B-k)*(D-O)+O,K.push(A)),O=D,k=B}let it=NaN,gt=-1/0;for(K.sort(o2),O=K[0],o=1,P=K.length;o<P;++o){D=K[o];const ct=Math.abs(D-O);ct>gt&&(A=(O+D)/2,l1(a,i,l,u,A,V)&&(it=A,gt=ct)),O=D}return isNaN(it)&&(it=p[x]),[it,V,gt]}function nS(a,i,l,u,p){let x;for(i+=u;i<l;i+=u)if(x=p(a.slice(i-u,i),a.slice(i,i+u)),x)return x;return!1}function h1(a,i,l,u,p,x){return x=x??Uy(th(),a,i,l,u),eh(p,x)?x[0]>=p[0]&&x[2]<=p[2]||x[1]>=p[1]&&x[3]<=p[3]?!0:nS(a,i,l,u,function(m,o){return R2(p,m,o)}):!1}function aS(a,i,l,u,p){return!!(h1(a,i,l,u,p)||Eo(a,i,l,u,p[0],p[1])||Eo(a,i,l,u,p[0],p[3])||Eo(a,i,l,u,p[2],p[1])||Eo(a,i,l,u,p[2],p[3]))}function oS(a,i,l,u,p){if(!aS(a,i,l[0],u,p))return!1;if(l.length===1)return!0;for(let x=1,m=l.length;x<m;++x)if(rS(a,l[x-1],l[x],u,p)&&!h1(a,l[x-1],l[x],u,p))return!1;return!0}function lS(a,i,l,u){for(;i<l-u;){for(let p=0;p<u;++p){const x=a[i+p];a[i+p]=a[l-u+p],a[l-u+p]=x}i+=u,l-=u}}function c1(a,i,l,u){let p=0,x=a[l-u],m=a[l-u+1];for(;i<l;i+=u){const o=a[i],P=a[i+1];p+=(o-x)*(P+m),x=o,m=P}return p===0?void 0:p>0}function hS(a,i,l,u,p){p=p!==void 0?p:!1;for(let x=0,m=l.length;x<m;++x){const o=l[x],P=c1(a,i,o,u);if(x===0){if(p&&P||!p&&!P)return!1}else if(p&&!P||!p&&P)return!1;i=o}return!0}function A0(a,i,l,u,p){p=p!==void 0?p:!1;for(let x=0,m=l.length;x<m;++x){const o=l[x],P=c1(a,i,o,u);(x===0?p&&P||!p&&!P:p&&!P||!p&&P)&&lS(a,i,o,u),i=o}return i}class qd extends jm{constructor(i,l,u){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,l!==void 0&&u?(this.setFlatCoordinates(l,i),this.ends_=u):this.setCoordinates(i,l)}appendLinearRing(i){this.flatCoordinates?l2(this.flatCoordinates,i.getFlatCoordinates()):this.flatCoordinates=i.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const i=new qd(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return i.applyProperties(this),i}closestPointXY(i,l,u,p){return p<Ny(this.getExtent(),i,l)?p:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(HM(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),XM(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,i,l,u,p))}containsXY(i,l){return l1(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,i,l)}getArea(){return WM(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(i){let l;return i!==void 0?(l=this.getOrientedFlatCoordinates().slice(),A0(l,0,this.ends_,this.stride,i)):l=this.flatCoordinates,JM(l,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const i=Xl(this.getExtent());this.flatInteriorPoint_=sS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,i,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new iS(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(i){return i<0||this.ends_.length<=i?null:new Oc(this.flatCoordinates.slice(i===0?0:this.ends_[i-1],this.ends_[i]),this.layout)}getLinearRings(){const i=this.layout,l=this.flatCoordinates,u=this.ends_,p=[];let x=0;for(let m=0,o=u.length;m<o;++m){const P=u[m],A=new Oc(l.slice(x,P),i);p.push(A),x=P}return p}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const i=this.flatCoordinates;hS(i,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=i:(this.orientedFlatCoordinates_=i.slice(),this.orientedFlatCoordinates_.length=A0(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(i){const l=[],u=[];return l.length=eS(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(i),l,0,u),new qd(l,"XY",u)}getType(){return"Polygon"}intersectsExtent(i){return oS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,i)}setCoordinates(i,l){this.setLayout(l,i,2),this.flatCoordinates||(this.flatCoordinates=[]);const u=YM(this.flatCoordinates,0,i,this.stride,this.ends_);this.flatCoordinates.length=u.length===0?0:u[u.length-1],this.changed()}}function R0(a){if(qc(a))throw new Error("Cannot create polygon from empty extent");const i=a[0],l=a[1],u=a[2],p=a[3],x=[i,l,i,p,u,p,u,l,i,l];return new qd(x,"XY",[x.length])}function Um(a,i,l,u){const p=Ir(i)/l[0],x=ns(i)/l[1];return u?Math.min(a,Math.max(p,x)):Math.min(a,Math.min(p,x))}function Vm(a,i,l){let u=Math.min(a,i);const p=50;return u*=Math.log(1+p*Math.max(0,a/i-1))/p+1,l&&(u=Math.max(u,l),u/=Math.log(1+p*Math.max(0,l/a-1))/p+1),_s(u,l/2,i*2)}function cS(a,i,l,u){return i=i!==void 0?i:!0,function(p,x,m,o){if(p!==void 0){const P=a[0],A=a[a.length-1],O=l?Um(P,l,m,u):P;if(o)return i?Vm(p,O,A):_s(p,A,O);const D=Math.min(O,p),k=Math.floor(Im(a,D,x));return a[k]>O&&k<a.length-1?a[k+1]:a[k]}}}function uS(a,i,l,u,p,x){return u=u!==void 0?u:!0,l=l!==void 0?l:0,function(m,o,P,A){if(m!==void 0){const O=p?Um(i,p,P,x):i;if(A)return u?Vm(m,O,l):_s(m,l,O);const D=1e-9,k=Math.ceil(Math.log(i/O)/Math.log(a)-D),B=-o*(.5-D)+.5,V=Math.min(O,m),K=Math.floor(Math.log(i/V)/Math.log(a)+B),it=Math.max(k,K),gt=i/Math.pow(a,it);return _s(gt,l,O)}}}function k0(a,i,l,u,p){return l=l!==void 0?l:!0,function(x,m,o,P){if(x!==void 0){const A=u?Um(a,u,o,p):a;return!l||!P?_s(x,i,A):Vm(x,A,i)}}}function dS(a){if(a!==void 0)return 0}function D0(a){if(a!==void 0)return a}function fS(a){const i=2*Math.PI/a;return function(l,u){if(u)return l;if(l!==void 0)return l=Math.floor(l/i+.5)*i,l}}function pS(a){const i=Ta(5);return function(l,u){return u||l===void 0?l:Math.abs(l)<=i?0:l}}const mS=256,Fp=0;class z0 extends nf{constructor(i){super(),this.on,this.once,this.un,i=Object.assign({},i),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Bm(i.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,i.projection&&oM(),i.center&&(i.center=xa(i.center,this.projection_)),i.extent&&(i.extent=Ol(i.extent,this.projection_)),this.applyOptions_(i)}applyOptions_(i){const l=Object.assign({},i);for(const o in Ks)delete l[o];this.setProperties(l,!0);const u=_S(i);this.maxResolution_=u.maxResolution,this.minResolution_=u.minResolution,this.zoomFactor_=u.zoomFactor,this.resolutions_=i.resolutions,this.padding_=i.padding,this.minZoom_=u.minZoom;const p=gS(i),x=u.constraint,m=yS(i);this.constraints_={center:p,resolution:x,rotation:m},this.setRotation(i.rotation!==void 0?i.rotation:0),this.setCenterInternal(i.center!==void 0?i.center:null),i.resolution!==void 0?this.setResolution(i.resolution):i.zoom!==void 0&&this.setZoom(i.zoom)}get padding(){return this.padding_}set padding(i){let l=this.padding_;this.padding_=i;const u=this.getCenterInternal();if(u){const p=i||[0,0,0,0];l=l||[0,0,0,0];const x=this.getResolution(),m=x/2*(p[3]-l[3]+l[1]-p[1]),o=x/2*(p[0]-l[0]+l[2]-p[2]);this.setCenterInternal([u[0]+m,u[1]-o])}}getUpdatedOptions_(i){const l=this.getProperties();return l.resolution!==void 0?l.resolution=this.getResolution():l.zoom=this.getZoom(),l.center=this.getCenterInternal(),l.rotation=this.getRotation(),Object.assign({},l,i)}animate(i){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const l=new Array(arguments.length);for(let u=0;u<l.length;++u){let p=arguments[u];p.center&&(p=Object.assign({},p),p.center=xa(p.center,this.getProjection())),p.anchor&&(p=Object.assign({},p),p.anchor=xa(p.anchor,this.getProjection())),l[u]=p}this.animateInternal.apply(this,l)}animateInternal(i){let l=arguments.length,u;l>1&&typeof arguments[l-1]=="function"&&(u=arguments[l-1],--l);let p=0;for(;p<l&&!this.isDef();++p){const O=arguments[p];O.center&&this.setCenterInternal(O.center),O.zoom!==void 0?this.setZoom(O.zoom):O.resolution&&this.setResolution(O.resolution),O.rotation!==void 0&&this.setRotation(O.rotation)}if(p===l){u&&xd(u,!0);return}let x=Date.now(),m=this.targetCenter_.slice(),o=this.targetResolution_,P=this.targetRotation_;const A=[];for(;p<l;++p){const O=arguments[p],D={start:x,complete:!1,anchor:O.anchor,duration:O.duration!==void 0?O.duration:1e3,easing:O.easing||MM,callback:u};if(O.center&&(D.sourceCenter=m,D.targetCenter=O.center.slice(),m=D.targetCenter),O.zoom!==void 0?(D.sourceResolution=o,D.targetResolution=this.getResolutionForZoom(O.zoom),o=D.targetResolution):O.resolution&&(D.sourceResolution=o,D.targetResolution=O.resolution,o=D.targetResolution),O.rotation!==void 0){D.sourceRotation=P;const k=Pc(O.rotation-P+Math.PI,2*Math.PI)-Math.PI;D.targetRotation=P+k,P=D.targetRotation}vS(D)?D.complete=!0:x+=D.duration,A.push(D)}this.animations_.push(A),this.setHint(yn.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[yn.ANIMATING]>0}getInteracting(){return this.hints_[yn.INTERACTING]>0}cancelAnimations(){this.setHint(yn.ANIMATING,-this.hints_[yn.ANIMATING]);let i;for(let l=0,u=this.animations_.length;l<u;++l){const p=this.animations_[l];if(p[0].callback&&xd(p[0].callback,!1),!i)for(let x=0,m=p.length;x<m;++x){const o=p[x];if(!o.complete){i=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=i,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const i=Date.now();let l=!1;for(let u=this.animations_.length-1;u>=0;--u){const p=this.animations_[u];let x=!0;for(let m=0,o=p.length;m<o;++m){const P=p[m];if(P.complete)continue;const A=i-P.start;let O=P.duration>0?A/P.duration:1;O>=1?(P.complete=!0,O=1):x=!1;const D=P.easing(O);if(P.sourceCenter){const k=P.sourceCenter[0],B=P.sourceCenter[1],V=P.targetCenter[0],K=P.targetCenter[1];this.nextCenter_=P.targetCenter;const it=k+D*(V-k),gt=B+D*(K-B);this.targetCenter_=[it,gt]}if(P.sourceResolution&&P.targetResolution){const k=D===1?P.targetResolution:P.sourceResolution+D*(P.targetResolution-P.sourceResolution);if(P.anchor){const B=this.getViewportSize_(this.getRotation()),V=this.constraints_.resolution(k,0,B,!0);this.targetCenter_=this.calculateCenterZoom(V,P.anchor)}this.nextResolution_=P.targetResolution,this.targetResolution_=k,this.applyTargetState_(!0)}if(P.sourceRotation!==void 0&&P.targetRotation!==void 0){const k=D===1?Pc(P.targetRotation+Math.PI,2*Math.PI)-Math.PI:P.sourceRotation+D*(P.targetRotation-P.sourceRotation);if(P.anchor){const B=this.constraints_.rotation(k,!0);this.targetCenter_=this.calculateCenterRotate(B,P.anchor)}this.nextRotation_=P.targetRotation,this.targetRotation_=k}if(this.applyTargetState_(!0),l=!0,!P.complete)break}if(x){this.animations_[u]=null,this.setHint(yn.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const m=p[0].callback;m&&xd(m,!0)}}this.animations_=this.animations_.filter(Boolean),l&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(i,l){let u;const p=this.getCenterInternal();return p!==void 0&&(u=[p[0]-l[0],p[1]-l[1]],z2(u,i-this.getRotation()),D2(u,l)),u}calculateCenterZoom(i,l){let u;const p=this.getCenterInternal(),x=this.getResolution();if(p!==void 0&&x!==void 0){const m=l[0]-i*(l[0]-p[0])/x,o=l[1]-i*(l[1]-p[1])/x;u=[m,o]}return u}getViewportSize_(i){const l=this.viewportSize_;if(i){const u=l[0],p=l[1];return[Math.abs(u*Math.cos(i))+Math.abs(p*Math.sin(i)),Math.abs(u*Math.sin(i))+Math.abs(p*Math.cos(i))]}return l}setViewportSize(i){this.viewportSize_=Array.isArray(i)?i.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const i=this.getCenterInternal();return i&&x0(i,this.getProjection())}getCenterInternal(){return this.get(Ks.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(i){return i!==void 0?(i[0]=this.hints_[0],i[1]=this.hints_[1],i):this.hints_.slice()}calculateExtent(i){const l=this.calculateExtentInternal(i);return uM(l,this.getProjection())}calculateExtentInternal(i){i=i||this.getViewportSizeMinusPadding_();const l=this.getCenterInternal();Gn(l,"The view center is not defined");const u=this.getResolution();Gn(u!==void 0,"The view resolution is not defined");const p=this.getRotation();return Gn(p!==void 0,"The view rotation is not defined"),Vy(l,u,p,i)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(i){this.applyOptions_(this.getUpdatedOptions_({maxZoom:i}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(i){this.applyOptions_(this.getUpdatedOptions_({minZoom:i}))}setConstrainResolution(i){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:i}))}getProjection(){return this.projection_}getResolution(){return this.get(Ks.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(i,l){return this.getResolutionForExtentInternal(Ol(i,this.getProjection()),l)}getResolutionForExtentInternal(i,l){l=l||this.getViewportSizeMinusPadding_();const u=Ir(i)/l[0],p=ns(i)/l[1];return Math.max(u,p)}getResolutionForValueFunction(i){i=i||2;const l=this.getConstrainedResolution(this.maxResolution_),u=this.minResolution_,p=Math.log(l/u)/Math.log(i);return function(x){return l/Math.pow(i,x*p)}}getRotation(){return this.get(Ks.ROTATION)}getValueForResolutionFunction(i){const l=Math.log(i||2),u=this.getConstrainedResolution(this.maxResolution_),p=this.minResolution_,x=Math.log(u/p)/l;return function(m){return Math.log(u/m)/l/x}}getViewportSizeMinusPadding_(i){let l=this.getViewportSize_(i);const u=this.padding_;return u&&(l=[l[0]-u[1]-u[3],l[1]-u[0]-u[2]]),l}getState(){const i=this.getProjection(),l=this.getResolution(),u=this.getRotation();let p=this.getCenterInternal();const x=this.padding_;if(x){const m=this.getViewportSizeMinusPadding_();p=Bp(p,this.getViewportSize_(),[m[0]/2+x[3],m[1]/2+x[0]],l,u)}return{center:p.slice(0),projection:i!==void 0?i:null,resolution:l,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:u,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let i;const l=this.getResolution();return l!==void 0&&(i=this.getZoomForResolution(l)),i}getZoomForResolution(i){let l=this.minZoom_||0,u,p;if(this.resolutions_){const x=Im(this.resolutions_,i,1);l=x,u=this.resolutions_[x],x==this.resolutions_.length-1?p=2:p=u/this.resolutions_[x+1]}else u=this.maxResolution_,p=this.zoomFactor_;return l+Math.log(u/i)/Math.log(p)}getResolutionForZoom(i){var l;if((l=this.resolutions_)!=null&&l.length){if(this.resolutions_.length===1)return this.resolutions_[0];const u=_s(Math.floor(i),0,this.resolutions_.length-2),p=this.resolutions_[u]/this.resolutions_[u+1];return this.resolutions_[u]/Math.pow(p,_s(i-u,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,i-this.minZoom_)}fit(i,l){let u;if(Gn(Array.isArray(i)||typeof i.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(i)){Gn(!qc(i),"Cannot fit empty extent provided as `geometry`");const p=Ol(i,this.getProjection());u=R0(p)}else if(i.getType()==="Circle"){const p=Ol(i.getExtent(),this.getProjection());u=R0(p),u.rotate(this.getRotation(),Xl(p))}else u=i;this.fitInternal(u,l)}rotatedExtentForGeometry(i){const l=this.getRotation(),u=Math.cos(l),p=Math.sin(-l),x=i.getFlatCoordinates(),m=i.getStride();let o=1/0,P=1/0,A=-1/0,O=-1/0;for(let D=0,k=x.length;D<k;D+=m){const B=x[D]*u-x[D+1]*p,V=x[D]*p+x[D+1]*u;o=Math.min(o,B),P=Math.min(P,V),A=Math.max(A,B),O=Math.max(O,V)}return[o,P,A,O]}fitInternal(i,l){l=l||{};let u=l.size;u||(u=this.getViewportSizeMinusPadding_());const p=l.padding!==void 0?l.padding:[0,0,0,0],x=l.nearest!==void 0?l.nearest:!1;let m;l.minResolution!==void 0?m=l.minResolution:l.maxZoom!==void 0?m=this.getResolutionForZoom(l.maxZoom):m=0;const o=this.rotatedExtentForGeometry(i);let P=this.getResolutionForExtentInternal(o,[u[0]-p[1]-p[3],u[1]-p[0]-p[2]]);P=isNaN(P)?m:Math.max(P,m),P=this.getConstrainedResolution(P,x?0:1);const A=this.getRotation(),O=Math.sin(A),D=Math.cos(A),k=Xl(o);k[0]+=(p[1]-p[3])/2*P,k[1]+=(p[0]-p[2])/2*P;const B=k[0]*D-k[1]*O,V=k[1]*D+k[0]*O,K=this.getConstrainedCenter([B,V],P),it=l.callback?l.callback:sm;l.duration!==void 0?this.animateInternal({resolution:P,center:K,duration:l.duration,easing:l.easing},it):(this.targetResolution_=P,this.targetCenter_=K,this.applyTargetState_(!1,!0),xd(it,!0))}centerOn(i,l,u){this.centerOnInternal(xa(i,this.getProjection()),l,u)}centerOnInternal(i,l,u){this.setCenterInternal(Bp(i,l,u,this.getResolution(),this.getRotation()))}calculateCenterShift(i,l,u,p){let x;const m=this.padding_;if(m&&i){const o=this.getViewportSizeMinusPadding_(-u),P=Bp(i,p,[o[0]/2+m[3],o[1]/2+m[0]],l,u);x=[i[0]-P[0],i[1]-P[1]]}return x}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(i){const l=x0(this.targetCenter_,this.getProjection());this.setCenter([l[0]+i[0],l[1]+i[1]])}adjustCenterInternal(i){const l=this.targetCenter_;this.setCenterInternal([l[0]+i[0],l[1]+i[1]])}adjustResolution(i,l){l=l&&xa(l,this.getProjection()),this.adjustResolutionInternal(i,l)}adjustResolutionInternal(i,l){const u=this.getAnimating()||this.getInteracting(),p=this.getViewportSize_(this.getRotation()),x=this.constraints_.resolution(this.targetResolution_*i,0,p,u);l&&(this.targetCenter_=this.calculateCenterZoom(x,l)),this.targetResolution_*=i,this.applyTargetState_()}adjustZoom(i,l){this.adjustResolution(Math.pow(this.zoomFactor_,-i),l)}adjustRotation(i,l){l&&(l=xa(l,this.getProjection())),this.adjustRotationInternal(i,l)}adjustRotationInternal(i,l){const u=this.getAnimating()||this.getInteracting(),p=this.constraints_.rotation(this.targetRotation_+i,u);l&&(this.targetCenter_=this.calculateCenterRotate(p,l)),this.targetRotation_+=i,this.applyTargetState_()}setCenter(i){this.setCenterInternal(i&&xa(i,this.getProjection()))}setCenterInternal(i){this.targetCenter_=i,this.applyTargetState_()}setHint(i,l){return this.hints_[i]+=l,this.changed(),this.hints_[i]}setResolution(i){this.targetResolution_=i,this.applyTargetState_()}setRotation(i){this.targetRotation_=i,this.applyTargetState_()}setZoom(i){this.setResolution(this.getResolutionForZoom(i))}applyTargetState_(i,l){const u=this.getAnimating()||this.getInteracting()||l,p=this.constraints_.rotation(this.targetRotation_,u),x=this.getViewportSize_(p),m=this.constraints_.resolution(this.targetResolution_,0,x,u),o=this.constraints_.center(this.targetCenter_,m,x,u,this.calculateCenterShift(this.targetCenter_,m,p,x));this.get(Ks.ROTATION)!==p&&this.set(Ks.ROTATION,p),this.get(Ks.RESOLUTION)!==m&&(this.set(Ks.RESOLUTION,m),this.set("zoom",this.getZoom(),!0)),(!o||!this.get(Ks.CENTER)||!Nd(this.get(Ks.CENTER),o))&&this.set(Ks.CENTER,o),this.getAnimating()&&!i&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(i,l,u){i=i!==void 0?i:200;const p=l||0,x=this.constraints_.rotation(this.targetRotation_),m=this.getViewportSize_(x),o=this.constraints_.resolution(this.targetResolution_,p,m),P=this.constraints_.center(this.targetCenter_,o,m,!1,this.calculateCenterShift(this.targetCenter_,o,x,m));if(i===0&&!this.cancelAnchor_){this.targetResolution_=o,this.targetRotation_=x,this.targetCenter_=P,this.applyTargetState_();return}u=u||(i===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==o||this.getRotation()!==x||!this.getCenterInternal()||!Nd(this.getCenterInternal(),P))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:x,center:P,resolution:o,duration:i,easing:wM,anchor:u}))}beginInteraction(){this.resolveConstraints(0),this.setHint(yn.INTERACTING,1)}endInteraction(i,l,u){u=u&&xa(u,this.getProjection()),this.endInteractionInternal(i,l,u)}endInteractionInternal(i,l,u){this.getInteracting()&&(this.setHint(yn.INTERACTING,-1),this.resolveConstraints(i,l,u))}getConstrainedCenter(i,l){const u=this.getViewportSize_(this.getRotation());return this.constraints_.center(i,l||this.getResolution(),u)}getConstrainedZoom(i,l){const u=this.getResolutionForZoom(i);return this.getZoomForResolution(this.getConstrainedResolution(u,l))}getConstrainedResolution(i,l){l=l||0;const u=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(i,l,u)}}function xd(a,i){setTimeout(function(){a(i)},0)}function gS(a){if(a.extent!==void 0){const l=a.smoothExtentConstraint!==void 0?a.smoothExtentConstraint:!0;return P0(a.extent,a.constrainOnlyCenter,l)}const i=Bm(a.projection,"EPSG:3857");if(a.multiWorld!==!0&&i.isGlobal()){const l=i.getExtent().slice();return l[0]=-1/0,l[2]=1/0,P0(l,!1,!1)}return NM}function _S(a){let i,l,u,m=a.minZoom!==void 0?a.minZoom:Fp,o=a.maxZoom!==void 0?a.maxZoom:28;const P=a.zoomFactor!==void 0?a.zoomFactor:2,A=a.multiWorld!==void 0?a.multiWorld:!1,O=a.smoothResolutionConstraint!==void 0?a.smoothResolutionConstraint:!0,D=a.showFullExtent!==void 0?a.showFullExtent:!1,k=Bm(a.projection,"EPSG:3857"),B=k.getExtent();let V=a.constrainOnlyCenter,K=a.extent;if(!A&&!K&&k.isGlobal()&&(V=!1,K=B),a.resolutions!==void 0){const it=a.resolutions;l=it[m],u=it[o]!==void 0?it[o]:it[it.length-1],a.constrainResolution?i=cS(it,O,!V&&K,D):i=k0(l,u,O,!V&&K,D)}else{const gt=(B?Math.max(Ir(B),ns(B)):360*$y.degrees/k.getMetersPerUnit())/mS/Math.pow(2,Fp),ct=gt/Math.pow(2,28-Fp);l=a.maxResolution,l!==void 0?m=0:l=gt/Math.pow(P,m),u=a.minResolution,u===void 0&&(a.maxZoom!==void 0?a.maxResolution!==void 0?u=l/Math.pow(P,o):u=gt/Math.pow(P,o):u=ct),o=m+Math.floor(Math.log(l/u)/Math.log(P)),u=l/Math.pow(P,o-m),a.constrainResolution?i=uS(P,l,u,O,!V&&K,D):i=k0(l,u,O,!V&&K,D)}return{constraint:i,maxResolution:l,minResolution:u,minZoom:m,zoomFactor:P}}function yS(a){if(a.enableRotation!==void 0?a.enableRotation:!0){const l=a.constrainRotation;return l===void 0||l===!0?pS():l===!1?D0:typeof l=="number"?fS(l):D0}return dS}function vS(a){return!(a.sourceCenter&&a.targetCenter&&!Nd(a.sourceCenter,a.targetCenter)||a.sourceResolution!==a.targetResolution||a.sourceRotation!==a.targetRotation)}function Bp(a,i,l,u,p){const x=Math.cos(-p);let m=Math.sin(-p),o=a[0]*x-a[1]*m,P=a[1]*x+a[0]*m;o+=(i[0]/2-l[0])*u,P+=(l[1]-i[1]/2)*u,m=-m;const A=o*x-P*m,O=P*x+o*m;return[A,O]}class xS extends nf{constructor(i){super(),this.on,this.once,this.un,this.background_=i.background;const l=Object.assign({},i);typeof i.properties=="object"&&(delete l.properties,Object.assign(l,i.properties)),l[Di.OPACITY]=i.opacity!==void 0?i.opacity:1,Gn(typeof l[Di.OPACITY]=="number","Layer opacity must be a number"),l[Di.VISIBLE]=i.visible!==void 0?i.visible:!0,l[Di.Z_INDEX]=i.zIndex,l[Di.MAX_RESOLUTION]=i.maxResolution!==void 0?i.maxResolution:1/0,l[Di.MIN_RESOLUTION]=i.minResolution!==void 0?i.minResolution:0,l[Di.MIN_ZOOM]=i.minZoom!==void 0?i.minZoom:-1/0,l[Di.MAX_ZOOM]=i.maxZoom!==void 0?i.maxZoom:1/0,this.className_=l.className!==void 0?l.className:"ol-layer",delete l.className,this.setProperties(l),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(i){const l=this.state_||{layer:this,managed:i===void 0?!0:i},u=this.getZIndex();return l.opacity=_s(Math.round(this.getOpacity()*100)/100,0,1),l.visible=this.getVisible(),l.extent=this.getExtent(),l.zIndex=u===void 0&&!l.managed?1/0:u,l.maxResolution=this.getMaxResolution(),l.minResolution=Math.max(this.getMinResolution(),0),l.minZoom=this.getMinZoom(),l.maxZoom=this.getMaxZoom(),this.state_=l,l}getLayersArray(i){return Dr()}getLayerStatesArray(i){return Dr()}getExtent(){return this.get(Di.EXTENT)}getMaxResolution(){return this.get(Di.MAX_RESOLUTION)}getMinResolution(){return this.get(Di.MIN_RESOLUTION)}getMinZoom(){return this.get(Di.MIN_ZOOM)}getMaxZoom(){return this.get(Di.MAX_ZOOM)}getOpacity(){return this.get(Di.OPACITY)}getSourceState(){return Dr()}getVisible(){return this.get(Di.VISIBLE)}getZIndex(){return this.get(Di.Z_INDEX)}setBackground(i){this.background_=i,this.changed()}setExtent(i){this.set(Di.EXTENT,i)}setMaxResolution(i){this.set(Di.MAX_RESOLUTION,i)}setMinResolution(i){this.set(Di.MIN_RESOLUTION,i)}setMaxZoom(i){this.set(Di.MAX_ZOOM,i)}setMinZoom(i){this.set(Di.MIN_ZOOM,i)}setOpacity(i){Gn(typeof i=="number","Layer opacity must be a number"),this.set(Di.OPACITY,i)}setVisible(i){this.set(Di.VISIBLE,i)}setZIndex(i){this.set(Di.Z_INDEX,i)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class bS extends xS{constructor(i){const l=Object.assign({},i);delete l.source,super(l),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,i.render&&(this.render=i.render),i.map&&this.setMap(i.map),this.addChangeListener(Di.SOURCE,this.handleSourcePropertyChange_);const u=i.source?i.source:null;this.setSource(u)}getLayersArray(i){return i=i||[],i.push(this),i}getLayerStatesArray(i){return i=i||[],i.push(this.getLayerState()),i}getSource(){return this.get(Di.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const i=this.getSource();return i?i.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&($l(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const i=this.getSource();i&&(this.sourceChangeKey_=Io(i,Ea.CHANGE,this.handleSourceChange_,this),i.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(i){return this.renderer_?this.renderer_.getFeatures(i):Promise.resolve([])}getData(i){return!this.renderer_||!this.rendered?null:this.renderer_.getData(i)}isVisible(i){let l;const u=this.getMapInternal();!i&&u&&(i=u.getView()),i instanceof z0?l={viewState:i.getState(),extent:i.calculateExtent()}:l=i,!l.layerStatesArray&&u&&(l.layerStatesArray=u.getLayerGroup().getLayerStatesArray());let p;if(l.layerStatesArray){if(p=l.layerStatesArray.find(m=>m.layer===this),!p)return!1}else p=this.getLayerState();const x=this.getExtent();return wS(p,l.viewState)&&(!x||eh(x,l.extent))}getAttributions(i){var x;if(!this.isVisible(i))return[];const l=(x=this.getSource())==null?void 0:x.getAttributions();if(!l)return[];const u=i instanceof z0?i.getViewStateAndExtent():i;let p=l(u);return Array.isArray(p)||(p=[p]),p}render(i,l){const u=this.getRenderer();return u.prepareFrame(i)?(this.rendered=!0,u.renderFrame(i,l)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(i,l){}renderDeferred(i){const l=this.getRenderer();l&&l.renderDeferred(i)}setMapInternal(i){i||this.unrender(),this.set(Di.MAP,i)}getMapInternal(){return this.get(Di.MAP)}setMap(i){this.mapPrecomposeKey_&&($l(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),i||this.changed(),this.mapRenderKey_&&($l(this.mapRenderKey_),this.mapRenderKey_=null),i&&(this.mapPrecomposeKey_=Io(i,yc.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=Io(this,Ea.CHANGE,i.render,i),this.changed())}handlePrecompose_(i){const l=i.frameState.layerStatesArray,u=this.getLayerState(!1);Gn(!l.some(p=>p.layer===u.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),l.push(u)}setSource(i){this.set(Di.SOURCE,i)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function wS(a,i){if(!a.visible)return!1;const l=i.resolution;if(l<a.minResolution||l>=a.maxResolution)return!1;const u=i.zoom;return u>a.minZoom&&u<=a.maxZoom}class MS extends nf{constructor(i){super(),this.projection=Qs(i.projection),this.attributions_=L0(i.attributions),this.attributionsCollapsible_=i.attributionsCollapsible??!0,this.loading=!1,this.state_=i.state!==void 0?i.state:"ready",this.wrapX_=i.wrapX!==void 0?i.wrapX:!1,this.interpolate_=!!i.interpolate,this.viewResolver=null,this.viewRejector=null;const l=this;this.viewPromise_=new Promise(function(u,p){l.viewResolver=u,l.viewRejector=p})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(i){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(i){this.attributions_=L0(i),this.changed()}setState(i){this.state_=i,this.changed()}}function L0(a){return a?typeof a=="function"?a:(Array.isArray(a)||(a=[a]),i=>a):null}class SS{constructor(){N_(this,"pushMethodArgs_",(...i)=>(this.push_(i),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(s0(),{get:(i,l)=>{if(typeof s0()[l]=="function")return this.push_(l),this.pushMethodArgs_},set:(i,l,u)=>(this.push_(l,u),!0)})}push_(...i){const l=this.instructions_,u=this.zIndex+this.offset_;l[u]||(l[u]=[]),l[u].push(...i)}pushFunction(i){this.push_(i)}getContext(){return this.context_}draw(i){this.instructions_.forEach(l=>{for(let u=0,p=l.length;u<p;++u){const x=l[u];if(typeof x=="function"){x(i);continue}const m=l[++u];if(typeof i[x]=="function")i[x](...m);else{if(typeof m=="function"){i[x]=m(i);continue}i[x]=m}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}let Dl=null;function TS(){Dl=Ao(1,1,void 0,{willReadFrequently:!0})}class PS extends FM{constructor(i){super(i),this.container=null,this.renderedResolution,this.tempTransform=Id(),this.pixelTransform=Id(),this.inversePixelTransform=Id(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(i,l,u){Dl||TS(),Dl.clearRect(0,0,1,1);let p;try{Dl.drawImage(i,l,u,1,1,0,0,1,1),p=Dl.getImageData(0,0,1,1).data}catch{return Dl=null,null}return p}getBackground(i){let u=this.getLayer().getBackground();return typeof u=="function"&&(u=u(i.viewState.resolution)),u||void 0}useContainer(i,l,u){const p=this.getLayer().getClassName();let x,m;if(i&&i.className===p&&(!u||i&&i.style.backgroundColor&&Dy(a0(i.style.backgroundColor),a0(u)))){const o=i.firstElementChild;o instanceof HTMLCanvasElement&&(m=o.getContext("2d"))}if(m&&_M(m.canvas.style.transform,l)?(this.container=i,this.context=m,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){x=document.createElement("div"),x.className=p;let o=x.style;o.position="absolute",o.width="100%",o.height="100%",m=Ao();const P=m.canvas;x.appendChild(P),o=P.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=x,this.context=m}!this.containerReused&&u&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=u)}clipUnrotated(i,l,u){const p=tf(u),x=Dm(u),m=km(u),o=Rm(u);_n(l.coordinateToPixelTransform,p),_n(l.coordinateToPixelTransform,x),_n(l.coordinateToPixelTransform,m),_n(l.coordinateToPixelTransform,o);const P=this.inversePixelTransform;_n(P,p),_n(P,x),_n(P,m),_n(P,o),i.save(),i.beginPath(),i.moveTo(Math.round(p[0]),Math.round(p[1])),i.lineTo(Math.round(x[0]),Math.round(x[1])),i.lineTo(Math.round(m[0]),Math.round(m[1])),i.lineTo(Math.round(o[0]),Math.round(o[1])),i.clip()}prepareContainer(i,l){const u=i.extent,p=i.viewState.resolution,x=i.viewState.rotation,m=i.pixelRatio,o=Math.round(Ir(u)/p*m),P=Math.round(ns(u)/p*m);Vd(this.pixelTransform,i.size[0]/2,i.size[1]/2,1/m,1/m,x,-o/2,-P/2),fM(this.inversePixelTransform,this.pixelTransform);const A=gM(this.pixelTransform);if(this.useContainer(l,A,this.getBackground(i)),!this.containerReused){const O=this.context.canvas;O.width!=o||O.height!=P?(O.width=o,O.height=P):this.context.clearRect(0,0,o,P),A!==O.style.transform&&(O.style.transform=A)}}dispatchRenderEvent_(i,l,u){const p=this.getLayer();if(p.hasListener(i)){const x=new zM(i,this.inversePixelTransform,u,l);p.dispatchEvent(x)}}preRender(i,l){this.frameState=l,!l.declutter&&this.dispatchRenderEvent_(yc.PRERENDER,i,l)}postRender(i,l){l.declutter||this.dispatchRenderEvent_(yc.POSTRENDER,i,l)}renderDeferredInternal(i){}getRenderContext(i){return i.declutter&&!this.deferredContext_&&(this.deferredContext_=new SS),i.declutter?this.deferredContext_.getContext():this.context}renderDeferred(i){i.declutter&&(this.dispatchRenderEvent_(yc.PRERENDER,this.context,i),i.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(i),this.dispatchRenderEvent_(yc.POSTRENDER,this.context,i))}getRenderTransform(i,l,u,p,x,m,o){const P=x/2,A=m/2,O=p/l,D=-O,k=-i[0]+o,B=-i[1];return Vd(this.tempTransform,P,A,O,D,-u,k,B)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class ES extends PS{constructor(i){super(i),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(i){const l=i.layerStatesArray[i.layerIndex],u=i.pixelRatio,p=i.viewState,x=p.resolution,m=this.getLayer().getSource(),o=i.viewHints;let P=i.extent;if(l.extent!==void 0&&(P=qy(P,Ol(l.extent,p.projection))),!o[yn.ANIMATING]&&!o[yn.INTERACTING]&&!qc(P))if(m){const A=p.projection,O=m.getImage(P,x,u,A);O&&(this.loadImage(O)?this.image=O:O.getState()===Xi.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(i){const l=this.frameState;if(!l)return null;const u=this.getLayer(),p=_n(l.pixelToCoordinateTransform,i.slice()),x=u.getExtent();if(x&&!Gy(x,p))return null;const m=this.image.getExtent(),o=this.image.getImage(),P=Ir(m),A=Math.floor(o.width*((p[0]-m[0])/P));if(A<0||A>=o.width)return null;const O=ns(m),D=Math.floor(o.height*((m[3]-p[1])/O));return D<0||D>=o.height?null:this.getImageData(o,A,D)}renderFrame(i,l){const u=this.image,p=u.getExtent(),x=u.getResolution(),[m,o]=Array.isArray(x)?x:[x,x],P=u.getPixelRatio(),A=i.layerStatesArray[i.layerIndex],O=i.pixelRatio,D=i.viewState,k=D.center,B=D.resolution,V=O*m/(B*P),K=O*o/(B*P);this.prepareContainer(i,l);const it=this.context.canvas.width,gt=this.context.canvas.height,ct=this.getRenderContext(i);let Dt=!1,Ct=!0;if(A.extent){const Le=Ol(A.extent,D.projection);Ct=eh(Le,i.extent),Dt=Ct&&!tm(Le,i.extent),Dt&&this.clipUnrotated(ct,i,Le)}const zt=u.getImage(),ae=Vd(this.tempTransform,it/2,gt/2,V,K,0,P*(p[0]-k[0])/m,P*(k[1]-p[3])/o);this.renderedResolution=o*O/P;const ke=zt.width*ae[0],de=zt.height*ae[3];if(this.getLayer().getSource().getInterpolate()||(ct.imageSmoothingEnabled=!1),this.preRender(ct,i),Ct&&ke>=.5&&de>=.5){const Le=ae[4],Xe=ae[5],ne=A.opacity;ne!==1&&(ct.save(),ct.globalAlpha=ne),ct.drawImage(zt,0,0,+zt.width,+zt.height,Le,Xe,ke,de),ne!==1&&ct.restore()}return this.postRender(this.context,i),Dt&&ct.restore(),ct.imageSmoothingEnabled=!0,this.container}}class IS extends bS{constructor(i){i=i||{},super(i)}}class CS extends IS{constructor(i){super(i)}createRenderer(){return new ES(this)}getData(i){return super.getData(i)}}function nm(a){return Array.isArray(a)?Math.min(...a):a}class AS extends Gm{constructor(i,l,u,p,x,m,o){let P=i.getExtent();P&&i.canWrapX()&&(P=P.slice(),P[0]=-1/0,P[2]=1/0);let A=l.getExtent();A&&l.canWrapX()&&(A=A.slice(),A[0]=-1/0,A[2]=1/0);const O=A?qy(u,A):u,D=Xl(O),k=CM(i,l,D,p),B=DM,V=new kM(i,l,O,P,k*B,p),K=V.calculateSourceExtent(),it=qc(K)?null:m(K,k,x),gt=it?Xi.IDLE:Xi.EMPTY,ct=it?it.getPixelRatio():1;super(u,p,ct,gt),this.targetProj_=l,this.maxSourceExtent_=P,this.triangulation_=V,this.targetResolution_=p,this.targetExtent_=u,this.sourceImage_=it,this.sourcePixelRatio_=ct,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==Xi.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const i=this.sourceImage_.getState();if(i==Xi.LOADED){const l=Ir(this.targetExtent_)/this.targetResolution_,u=ns(this.targetExtent_)/this.targetResolution_;this.canvas_=AM(l,u,this.sourcePixelRatio_,nm(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=i,this.changed()}load(){if(this.state==Xi.IDLE){this.state=Xi.LOADING,this.changed();const i=this.sourceImage_.getState();i==Xi.LOADED||i==Xi.ERROR?this.reproject_():(this.sourceListenerKey_=Io(this.sourceImage_,Ea.CHANGE,l=>{const u=this.sourceImage_.getState();(u==Xi.LOADED||u==Xi.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){$l(this.sourceListenerKey_),this.sourceListenerKey_=null}}const bd=4,Np={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class RS extends sf{constructor(i,l){super(i),this.image=l}}class kS extends MS{constructor(i){super({attributions:i.attributions,projection:i.projection,state:i.state,interpolate:i.interpolate!==void 0?i.interpolate:!0}),this.on,this.once,this.un,this.loader=i.loader||null,this.resolutions_=i.resolutions!==void 0?i.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=i.loader?i.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(i){this.resolutions_=i}findNearestResolution(i){const l=this.getResolutions();if(l){const u=Im(l,i,0);i=l[u]}return i}getImage(i,l,u,p){const x=this.getProjection();if(!x||!p||v0(x,p))return x&&(p=x),this.getImageInternal(i,l,u,p);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&v0(this.reprojectedImage_.getProjection(),p)&&this.reprojectedImage_.getResolution()==l&&S2(this.reprojectedImage_.getExtent(),i))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new AS(x,p,i,l,u,(m,o,P)=>this.getImageInternal(m,o,P,x),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(i,l,u,p){if(this.loader){const x=zS(i,l,u,1),m=this.findNearestResolution(l);if(this.image&&(this.static_||this.wantedProjection_===p&&(this.wantedExtent_&&tm(this.wantedExtent_,x)||tm(this.image.getExtent(),x))&&(this.wantedResolution_&&nm(this.wantedResolution_)===m||nm(this.image.getResolution())===m)))return this.image;this.wantedProjection_=p,this.wantedExtent_=x,this.wantedResolution_=m,this.image=new Gm(x,m,u,this.loader),this.image.addEventListener(Ea.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(i){const l=i.target;let u;switch(l.getState()){case Xi.LOADING:this.loading=!0,u=Np.IMAGELOADSTART;break;case Xi.LOADED:this.loading=!1,u=Np.IMAGELOADEND;break;case Xi.ERROR:this.loading=!1,u=Np.IMAGELOADERROR;break;default:return}this.hasListener(u)&&this.dispatchEvent(new RS(u,l))}}function DS(a,i){a.getImage().src=i}function zS(a,i,l,u){const p=i/l,x=Xl(a),m=_d(Ir(a)/p,bd),o=_d(ns(a)/p,bd),P=_d((u-1)*m/2,bd),A=m+2*P,O=_d((u-1)*o/2,bd),D=o+2*O;return Vy(x,p,0,[A,D])}function LS(a){const i=a.load||t1,l=a.imageExtent,u=a.crossOrigin??null;return()=>{const p=new Image;return p.crossOrigin=u,i(p,a.url).then(x=>{const m=Ir(l)/x.width,o=ns(l)/x.height;return{image:x,extent:l,resolution:m!==o?[m,o]:o,pixelRatio:1}})}}class OS extends kS{constructor(i){const l=i.crossOrigin!==void 0?i.crossOrigin:null,u=i.imageLoadFunction!==void 0?i.imageLoadFunction:DS;super({attributions:i.attributions,interpolate:i.interpolate,projection:Qs(i.projection)}),this.url_=i.url,this.imageExtent_=i.imageExtent,this.image=null,this.image=new Gm(this.imageExtent_,void 0,1,LS({url:i.url,imageExtent:i.imageExtent,crossOrigin:l,load:(p,x)=>(this.image.setImage(p),u(this.image,x),t1(p))})),this.image.addEventListener(Ea.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(i,l,u,p){return eh(i,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}var FS=ar('<div class="map-container svelte-11srq4e"></div>');function BS(a,i){mm(i,!0);let l,u;const p="oCUBI8DjgzTP5J8VptrnOAxYVeZc0cZ2",x="https://api.os.uk/maps/vector/v1/vts";Jx(async()=>{proj4.defs("EPSG:27700","+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs"),ol.proj.proj4.register(proj4);const P=await fetch(`${x}?key=${p}`).then(it=>it.json()),A=[P.fullExtent.xmin,P.fullExtent.ymin,P.fullExtent.xmax,P.fullExtent.ymax],O=[P.tileInfo.origin.x,P.tileInfo.origin.y],D=P.tileInfo.lods.map(it=>it.resolution).slice(0,16),k=P.tileInfo.rows,B=P.tiles[0],V=new ol.tilegrid.TileGrid({extent:A,origin:O,resolutions:D,tileSize:k}),K=new ol.layer.VectorTile({declutter:!0});await olms.applyStyle(K,`${x}/${P.defaultStyles}?key=${p}`,"",{resolutions:D}),await K.setSource(new ol.source.VectorTile({format:new ol.format.MVT,url:B,projection:"EPSG:27700",tileGrid:V})),u=new ol.Map({target:l,layers:[K],view:new ol.View({projection:"EPSG:27700",extent:[-238375,0,9e5,1376256],resolutions:D,minZoom:2,maxZoom:15,center:[377297,353995],zoom:2})})});let m;Td(()=>{i.dataURL&&i.bbox&&(m=new CS({source:new OS({url:i.dataURL,imageExtent:i.bbox,projection:"EPSG:27700"}),opacity:.75}),u&&(console.log(u.getLayerGroup().getLayers()),u.removeLayer(u.getLayers().array_[1]),console.log(u.getLayerGroup().getLayers()),u.addLayer(m)))});var o=FS();Xx(o,P=>l=P,()=>l),$i(a,o),gm()}function NS(a){a("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),a("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),a("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var i=1;i<=60;++i)a("EPSG:"+(32600+i),"+proj=utm +zone="+i+" +datum=WGS84 +units=m"),a("EPSG:"+(32700+i),"+proj=utm +zone="+i+" +south +datum=WGS84 +units=m");a.WGS84=a["EPSG:4326"],a["EPSG:3785"]=a["EPSG:3857"],a.GOOGLE=a["EPSG:3857"],a["EPSG:900913"]=a["EPSG:3857"],a["EPSG:102113"]=a["EPSG:3857"]}var Ro=1,ko=2,Zl=3,GS=4,am=5,O0=6378137,jS=6356752314e-3,F0=.0066943799901413165,Cc=484813681109536e-20,Qt=Math.PI/2,US=.16666666666666666,VS=.04722222222222222,qS=.022156084656084655,fe=1e-10,Fi=.017453292519943295,xn=57.29577951308232,Ai=Math.PI/4,Fc=Math.PI*2,Ur=3.14159265359,ys={};ys.greenwich=0;ys.lisbon=-9.131906111111;ys.paris=2.337229166667;ys.bogota=-74.080916666667;ys.madrid=-3.687938888889;ys.rome=12.452333333333;ys.bern=7.439583333333;ys.jakarta=106.807719444444;ys.ferro=-17.666666666667;ys.brussels=4.367975;ys.stockholm=18.058277777778;ys.athens=23.7163375;ys.oslo=10.722916666667;const $S={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var B0=/[\s_\-\/\(\)]/g;function Ia(a,i){if(a[i])return a[i];for(var l=Object.keys(a),u=i.toLowerCase().replace(B0,""),p=-1,x,m;++p<l.length;)if(x=l[p],m=x.toLowerCase().replace(B0,""),m===u)return a[x]}function om(a){var i={},l=a.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,P){var A=P.split("=");return A.push(!0),o[A[0].toLowerCase()]=A[1],o},{}),u,p,x,m={proj:"projName",datum:"datumCode",rf:function(o){i.rf=parseFloat(o)},lat_0:function(o){i.lat0=o*Fi},lat_1:function(o){i.lat1=o*Fi},lat_2:function(o){i.lat2=o*Fi},lat_ts:function(o){i.lat_ts=o*Fi},lon_0:function(o){i.long0=o*Fi},lon_1:function(o){i.long1=o*Fi},lon_2:function(o){i.long2=o*Fi},alpha:function(o){i.alpha=parseFloat(o)*Fi},gamma:function(o){i.rectified_grid_angle=parseFloat(o)*Fi},lonc:function(o){i.longc=o*Fi},x_0:function(o){i.x0=parseFloat(o)},y_0:function(o){i.y0=parseFloat(o)},k_0:function(o){i.k0=parseFloat(o)},k:function(o){i.k0=parseFloat(o)},a:function(o){i.a=parseFloat(o)},b:function(o){i.b=parseFloat(o)},r:function(o){i.a=i.b=parseFloat(o)},r_a:function(){i.R_A=!0},zone:function(o){i.zone=parseInt(o,10)},south:function(){i.utmSouth=!0},towgs84:function(o){i.datum_params=o.split(",").map(function(P){return parseFloat(P)})},to_meter:function(o){i.to_meter=parseFloat(o)},units:function(o){i.units=o;var P=Ia($S,o);P&&(i.to_meter=P.to_meter)},from_greenwich:function(o){i.from_greenwich=o*Fi},pm:function(o){var P=Ia(ys,o);i.from_greenwich=(P||parseFloat(o))*Fi},nadgrids:function(o){o==="@null"?i.datumCode="none":i.nadgrids=o},axis:function(o){var P="ewnsud";o.length===3&&P.indexOf(o.substr(0,1))!==-1&&P.indexOf(o.substr(1,1))!==-1&&P.indexOf(o.substr(2,1))!==-1&&(i.axis=o)},approx:function(){i.approx=!0}};for(u in l)p=l[u],u in m?(x=m[u],typeof x=="function"?x(p):i[x]=p):i[u]=p;return typeof i.datumCode=="string"&&i.datumCode!=="WGS84"&&(i.datumCode=i.datumCode.toLowerCase()),i}class u1{static getId(i){const l=i.find(u=>Array.isArray(u)&&u[0]==="ID");return l&&l.length>=3?{authority:l[1],code:parseInt(l[2],10)}:null}static convertUnit(i,l="unit"){if(!i||i.length<3)return{type:l,name:"unknown",conversion_factor:null};const u=i[1],p=parseFloat(i[2])||null,x=i.find(o=>Array.isArray(o)&&o[0]==="ID"),m=x?{authority:x[1],code:parseInt(x[2],10)}:null;return{type:l,name:u,conversion_factor:p,id:m}}static convertAxis(i){const l=i[1]||"Unknown";let u;const p=l.match(/^\((.)\)$/);if(p){const A=p[1].toUpperCase();if(A==="E")u="east";else if(A==="N")u="north";else if(A==="U")u="up";else throw new Error(`Unknown axis abbreviation: ${A}`)}else u=i[2]?i[2].toLowerCase():"unknown";const x=i.find(A=>Array.isArray(A)&&A[0]==="ORDER"),m=x?parseInt(x[1],10):null,o=i.find(A=>Array.isArray(A)&&(A[0]==="LENGTHUNIT"||A[0]==="ANGLEUNIT"||A[0]==="SCALEUNIT")),P=this.convertUnit(o);return{name:l,direction:u,unit:P,order:m}}static extractAxes(i){return i.filter(l=>Array.isArray(l)&&l[0]==="AXIS").map(l=>this.convertAxis(l)).sort((l,u)=>(l.order||0)-(u.order||0))}static convert(i,l={}){switch(i[0]){case"PROJCRS":l.type="ProjectedCRS",l.name=i[1],l.base_crs=i.find(k=>Array.isArray(k)&&k[0]==="BASEGEOGCRS")?this.convert(i.find(k=>Array.isArray(k)&&k[0]==="BASEGEOGCRS")):null,l.conversion=i.find(k=>Array.isArray(k)&&k[0]==="CONVERSION")?this.convert(i.find(k=>Array.isArray(k)&&k[0]==="CONVERSION")):null;const u=i.find(k=>Array.isArray(k)&&k[0]==="CS");u&&(l.coordinate_system={type:u[1],axis:this.extractAxes(i)});const p=i.find(k=>Array.isArray(k)&&k[0]==="LENGTHUNIT");if(p){const k=this.convertUnit(p);l.coordinate_system.unit=k}l.id=this.getId(i);break;case"BASEGEOGCRS":case"GEOGCRS":l.type="GeographicCRS",l.name=i[1];const x=i.find(k=>Array.isArray(k)&&(k[0]==="DATUM"||k[0]==="ENSEMBLE"));if(x){const k=this.convert(x);x[0]==="ENSEMBLE"?l.datum_ensemble=k:l.datum=k;const B=i.find(V=>Array.isArray(V)&&V[0]==="PRIMEM");B&&B[1]!=="Greenwich"&&(k.prime_meridian={name:B[1],longitude:parseFloat(B[2])})}l.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(i)},l.id=this.getId(i);break;case"DATUM":l.type="GeodeticReferenceFrame",l.name=i[1],l.ellipsoid=i.find(k=>Array.isArray(k)&&k[0]==="ELLIPSOID")?this.convert(i.find(k=>Array.isArray(k)&&k[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":l.type="DatumEnsemble",l.name=i[1],l.members=i.filter(k=>Array.isArray(k)&&k[0]==="MEMBER").map(k=>({type:"DatumEnsembleMember",name:k[1],id:this.getId(k)}));const m=i.find(k=>Array.isArray(k)&&k[0]==="ENSEMBLEACCURACY");m&&(l.accuracy=parseFloat(m[1]));const o=i.find(k=>Array.isArray(k)&&k[0]==="ELLIPSOID");o&&(l.ellipsoid=this.convert(o)),l.id=this.getId(i);break;case"ELLIPSOID":l.type="Ellipsoid",l.name=i[1],l.semi_major_axis=parseFloat(i[2]),l.inverse_flattening=parseFloat(i[3]),i.find(k=>Array.isArray(k)&&k[0]==="LENGTHUNIT")&&this.convert(i.find(k=>Array.isArray(k)&&k[0]==="LENGTHUNIT"),l);break;case"CONVERSION":l.type="Conversion",l.name=i[1],l.method=i.find(k=>Array.isArray(k)&&k[0]==="METHOD")?this.convert(i.find(k=>Array.isArray(k)&&k[0]==="METHOD")):null,l.parameters=i.filter(k=>Array.isArray(k)&&k[0]==="PARAMETER").map(k=>this.convert(k));break;case"METHOD":l.type="Method",l.name=i[1],l.id=this.getId(i);break;case"PARAMETER":l.type="Parameter",l.name=i[1],l.value=parseFloat(i[2]),l.unit=this.convertUnit(i.find(k=>Array.isArray(k)&&(k[0]==="LENGTHUNIT"||k[0]==="ANGLEUNIT"||k[0]==="SCALEUNIT"))),l.id=this.getId(i);break;case"BOUNDCRS":l.type="BoundCRS";const P=i.find(k=>Array.isArray(k)&&k[0]==="SOURCECRS");if(P){const k=P.find(B=>Array.isArray(B));l.source_crs=k?this.convert(k):null}const A=i.find(k=>Array.isArray(k)&&k[0]==="TARGETCRS");if(A){const k=A.find(B=>Array.isArray(B));l.target_crs=k?this.convert(k):null}const O=i.find(k=>Array.isArray(k)&&k[0]==="ABRIDGEDTRANSFORMATION");O?l.transformation=this.convert(O):l.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(l.type="Transformation",l.name=i[1],l.method=i.find(k=>Array.isArray(k)&&k[0]==="METHOD")?this.convert(i.find(k=>Array.isArray(k)&&k[0]==="METHOD")):null,l.parameters=i.filter(k=>Array.isArray(k)&&(k[0]==="PARAMETER"||k[0]==="PARAMETERFILE")).map(k=>{if(k[0]==="PARAMETER")return this.convert(k);if(k[0]==="PARAMETERFILE")return{name:k[1],value:k[2],id:{authority:"EPSG",code:8656}}}),l.parameters.length===7){const k=l.parameters[6];k.name==="Scale difference"&&(k.value=Math.round((k.value-1)*1e12)/1e6)}l.id=this.getId(i);break;case"AXIS":l.coordinate_system||(l.coordinate_system={type:"unspecified",axis:[]}),l.coordinate_system.axis.push(this.convertAxis(i));break;case"LENGTHUNIT":const D=this.convertUnit(i,"LinearUnit");l.coordinate_system&&l.coordinate_system.axis&&l.coordinate_system.axis.forEach(k=>{k.unit||(k.unit=D)}),D.conversion_factor&&D.conversion_factor!==1&&l.semi_major_axis&&(l.semi_major_axis={value:l.semi_major_axis,unit:D});break;default:l.keyword=i[0];break}return l}}class ZS extends u1{static convert(i,l={}){return super.convert(i,l),l.coordinate_system&&l.coordinate_system.subtype==="Cartesian"&&delete l.coordinate_system,l.usage&&delete l.usage,l}}class WS extends u1{static convert(i,l={}){super.convert(i,l);const u=i.find(x=>Array.isArray(x)&&x[0]==="CS");u&&(l.coordinate_system={subtype:u[1],axis:this.extractAxes(i)});const p=i.find(x=>Array.isArray(x)&&x[0]==="USAGE");if(p){const x=p.find(P=>Array.isArray(P)&&P[0]==="SCOPE"),m=p.find(P=>Array.isArray(P)&&P[0]==="AREA"),o=p.find(P=>Array.isArray(P)&&P[0]==="BBOX");l.usage={},x&&(l.usage.scope=x[1]),m&&(l.usage.area=m[1]),o&&(l.usage.bbox=o.slice(1))}return l}}function HS(a){return a.find(i=>Array.isArray(i)&&i[0]==="USAGE")?"2019":(a.find(i=>Array.isArray(i)&&i[0]==="CS")||a[0]==="BOUNDCRS"||a[0]==="PROJCRS"||a[0]==="GEOGCRS","2015")}function XS(a){return(HS(a)==="2019"?WS:ZS).convert(a)}function KS(a){const i=a.toUpperCase();return i.includes("PROJCRS")||i.includes("GEOGCRS")||i.includes("BOUNDCRS")||i.includes("VERTCRS")||i.includes("LENGTHUNIT")||i.includes("ANGLEUNIT")||i.includes("SCALEUNIT")?"WKT2":(i.includes("PROJCS")||i.includes("GEOGCS")||i.includes("LOCAL_CS")||i.includes("VERT_CS")||i.includes("UNIT"),"WKT1")}var Bc=1,d1=2,f1=3,$d=4,p1=5,qm=-1,YS=/\s/,JS=/[A-Za-z]/,QS=/[A-Za-z84_]/,af=/[,\]]/,m1=/[\d\.E\-\+]/;function jn(a){if(typeof a!="string")throw new Error("not a string");this.text=a.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Bc}jn.prototype.readCharicter=function(){var a=this.text[this.place++];if(this.state!==$d)for(;YS.test(a);){if(this.place>=this.text.length)return;a=this.text[this.place++]}switch(this.state){case Bc:return this.neutral(a);case d1:return this.keyword(a);case $d:return this.quoted(a);case p1:return this.afterquote(a);case f1:return this.number(a);case qm:return}};jn.prototype.afterquote=function(a){if(a==='"'){this.word+='"',this.state=$d;return}if(af.test(a)){this.word=this.word.trim(),this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in afterquote yet, index '+this.place)};jn.prototype.afterItem=function(a){if(a===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Bc;return}if(a==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Bc,this.currentObject=this.stack.pop(),this.currentObject||(this.state=qm);return}};jn.prototype.number=function(a){if(m1.test(a)){this.word+=a;return}if(af.test(a)){this.word=parseFloat(this.word),this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in number yet, index '+this.place)};jn.prototype.quoted=function(a){if(a==='"'){this.state=p1;return}this.word+=a};jn.prototype.keyword=function(a){if(QS.test(a)){this.word+=a;return}if(a==="["){var i=[];i.push(this.word),this.level++,this.root===null?this.root=i:this.currentObject.push(i),this.stack.push(this.currentObject),this.currentObject=i,this.state=Bc;return}if(af.test(a)){this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in keyword yet, index '+this.place)};jn.prototype.neutral=function(a){if(JS.test(a)){this.word=a,this.state=d1;return}if(a==='"'){this.word="",this.state=$d;return}if(m1.test(a)){this.word=a,this.state=f1;return}if(af.test(a)){this.afterItem(a);return}throw new Error(`havn't handled "`+a+'" in neutral yet, index '+this.place)};jn.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===qm)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function tT(a){var i=new jn(a);return i.output()}function Gp(a,i,l){Array.isArray(i)&&(l.unshift(i),i=null);var u=i?{}:a,p=l.reduce(function(x,m){return Fl(m,x),x},u);i&&(a[i]=p)}function Fl(a,i){if(!Array.isArray(a)){i[a]=!0;return}var l=a.shift();if(l==="PARAMETER"&&(l=a.shift()),a.length===1){if(Array.isArray(a[0])){i[l]={},Fl(a[0],i[l]);return}i[l]=a[0];return}if(!a.length){i[l]=!0;return}if(l==="TOWGS84"){i[l]=a;return}if(l==="AXIS"){l in i||(i[l]=[]),i[l].push(a);return}Array.isArray(l)||(i[l]={});var u;switch(l){case"UNIT":case"PRIMEM":case"VERT_DATUM":i[l]={name:a[0].toLowerCase(),convert:a[1]},a.length===3&&Fl(a[2],i[l]);return;case"SPHEROID":case"ELLIPSOID":i[l]={name:a[0],a:a[1],rf:a[2]},a.length===4&&Fl(a[3],i[l]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":a[0]=["name",a[0]],Gp(i,l,a);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":a[0]=["name",a[0]],Gp(i,l,a),i[l].type=l;return;default:for(u=-1;++u<a.length;)if(!Array.isArray(a[u]))return Fl(a,i[l]);return Gp(i,l,a)}}var eT=.017453292519943295;function Ys(a){return a*eT}function g1(a){const i=(a.projName||"").toLowerCase().replace(/_/g," ");!a.long0&&a.longc&&(i==="albers conic equal area"||i==="lambert azimuthal equal area")&&(a.long0=a.longc),!a.lat_ts&&a.lat1&&(i==="stereographic south pole"||i==="polar stereographic (variant b)")?(a.lat0=Ys(a.lat1>0?90:-90),a.lat_ts=a.lat1,delete a.lat1):!a.lat_ts&&a.lat0&&(i==="polar stereographic"||i==="polar stereographic (variant a)")&&(a.lat_ts=a.lat0,a.lat0=Ys(a.lat0>0?90:-90),delete a.lat1)}function N0(a){let i={units:null,to_meter:void 0};return typeof a=="string"?(i.units=a.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.units==="meter"&&(i.to_meter=1)):a&&a.name&&(i.units=a.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.to_meter=a.conversion_factor),i}function G0(a){return typeof a=="object"?a.value*a.unit.conversion_factor:a}function j0(a,i){a.ellipsoid.radius?(i.a=a.ellipsoid.radius,i.rf=0):(i.a=G0(a.ellipsoid.semi_major_axis),a.ellipsoid.inverse_flattening!==void 0?i.rf=a.ellipsoid.inverse_flattening:a.ellipsoid.semi_major_axis!==void 0&&a.ellipsoid.semi_minor_axis!==void 0&&(i.rf=i.a/(i.a-G0(a.ellipsoid.semi_minor_axis))))}function Zd(a,i={}){return!a||typeof a!="object"?a:a.type==="BoundCRS"?(Zd(a.source_crs,i),a.transformation&&(a.transformation.method&&a.transformation.method.name==="NTv2"?i.nadgrids=a.transformation.parameters[0].value:i.datum_params=a.transformation.parameters.map(l=>l.value)),i):(Object.keys(a).forEach(l=>{const u=a[l];if(u!==null)switch(l){case"name":if(i.srsCode)break;i.name=u,i.srsCode=u;break;case"type":u==="GeographicCRS"?i.projName="longlat":u==="ProjectedCRS"&&a.conversion&&a.conversion.method&&(i.projName=a.conversion.method.name);break;case"datum":case"datum_ensemble":u.ellipsoid&&(i.ellps=u.ellipsoid.name,j0(u,i)),u.prime_meridian&&(i.from_greenwich=u.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":i.ellps=u.name,j0(u,i);break;case"prime_meridian":i.long0=(u.longitude||0)*Math.PI/180;break;case"coordinate_system":if(u.axis){if(i.axis=u.axis.map(p=>{const x=p.direction;if(x==="east")return"e";if(x==="north")return"n";if(x==="west")return"w";if(x==="south")return"s";throw new Error(`Unknown axis direction: ${x}`)}).join("")+"u",u.unit){const{units:p,to_meter:x}=N0(u.unit);i.units=p,i.to_meter=x}else if(u.axis[0]&&u.axis[0].unit){const{units:p,to_meter:x}=N0(u.axis[0].unit);i.units=p,i.to_meter=x}}break;case"id":u.authority&&u.code&&(i.title=u.authority+":"+u.code);break;case"conversion":u.method&&u.method.name&&(i.projName=u.method.name),u.parameters&&u.parameters.forEach(p=>{const x=p.name.toLowerCase().replace(/\s+/g,"_"),m=p.value;p.unit&&p.unit.conversion_factor?i[x]=m*p.unit.conversion_factor:p.unit==="degree"?i[x]=m*Math.PI/180:i[x]=m});break;case"unit":u.name&&(i.units=u.name.toLowerCase(),i.units==="metre"&&(i.units="meter")),u.conversion_factor&&(i.to_meter=u.conversion_factor);break;case"base_crs":Zd(u,i),i.datumCode=u.id?u.id.authority+"_"+u.id.code:u.name;break}}),i.latitude_of_false_origin!==void 0&&(i.lat0=i.latitude_of_false_origin),i.longitude_of_false_origin!==void 0&&(i.long0=i.longitude_of_false_origin),i.latitude_of_standard_parallel!==void 0&&(i.lat0=i.latitude_of_standard_parallel,i.lat1=i.latitude_of_standard_parallel),i.latitude_of_1st_standard_parallel!==void 0&&(i.lat1=i.latitude_of_1st_standard_parallel),i.latitude_of_2nd_standard_parallel!==void 0&&(i.lat2=i.latitude_of_2nd_standard_parallel),i.latitude_of_projection_centre!==void 0&&(i.lat0=i.latitude_of_projection_centre),i.longitude_of_projection_centre!==void 0&&(i.longc=i.longitude_of_projection_centre),i.easting_at_false_origin!==void 0&&(i.x0=i.easting_at_false_origin),i.northing_at_false_origin!==void 0&&(i.y0=i.northing_at_false_origin),i.latitude_of_natural_origin!==void 0&&(i.lat0=i.latitude_of_natural_origin),i.longitude_of_natural_origin!==void 0&&(i.long0=i.longitude_of_natural_origin),i.longitude_of_origin!==void 0&&(i.long0=i.longitude_of_origin),i.false_easting!==void 0&&(i.x0=i.false_easting),i.easting_at_projection_centre&&(i.x0=i.easting_at_projection_centre),i.false_northing!==void 0&&(i.y0=i.false_northing),i.northing_at_projection_centre&&(i.y0=i.northing_at_projection_centre),i.standard_parallel_1!==void 0&&(i.lat1=i.standard_parallel_1),i.standard_parallel_2!==void 0&&(i.lat2=i.standard_parallel_2),i.scale_factor_at_natural_origin!==void 0&&(i.k0=i.scale_factor_at_natural_origin),i.scale_factor_at_projection_centre!==void 0&&(i.k0=i.scale_factor_at_projection_centre),i.scale_factor_on_pseudo_standard_parallel!==void 0&&(i.k0=i.scale_factor_on_pseudo_standard_parallel),i.azimuth!==void 0&&(i.alpha=i.azimuth),i.azimuth_at_projection_centre!==void 0&&(i.alpha=i.azimuth_at_projection_centre),i.angle_from_rectified_to_skew_grid&&(i.rectified_grid_angle=i.angle_from_rectified_to_skew_grid),g1(i),i)}var iT=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function rT(a,i){var l=i[0],u=i[1];!(l in a)&&u in a&&(a[l]=a[u],i.length===3&&(a[l]=i[2](a[l])))}function _1(a){for(var i=Object.keys(a),l=0,u=i.length;l<u;++l){var p=i[l];iT.indexOf(p)!==-1&&sT(a[p]),typeof a[p]=="object"&&_1(a[p])}}function sT(a){if(a.AUTHORITY){var i=Object.keys(a.AUTHORITY)[0];i&&i in a.AUTHORITY&&(a.title=i+":"+a.AUTHORITY[i])}if(a.type==="GEOGCS"?a.projName="longlat":a.type==="LOCAL_CS"?(a.projName="identity",a.local=!0):typeof a.PROJECTION=="object"?a.projName=Object.keys(a.PROJECTION)[0]:a.projName=a.PROJECTION,a.AXIS){for(var l="",u=0,p=a.AXIS.length;u<p;++u){var x=[a.AXIS[u][0].toLowerCase(),a.AXIS[u][1].toLowerCase()];x[0].indexOf("north")!==-1||(x[0]==="y"||x[0]==="lat")&&x[1]==="north"?l+="n":x[0].indexOf("south")!==-1||(x[0]==="y"||x[0]==="lat")&&x[1]==="south"?l+="s":x[0].indexOf("east")!==-1||(x[0]==="x"||x[0]==="lon")&&x[1]==="east"?l+="e":(x[0].indexOf("west")!==-1||(x[0]==="x"||x[0]==="lon")&&x[1]==="west")&&(l+="w")}l.length===2&&(l+="u"),l.length===3&&(a.axis=l)}a.UNIT&&(a.units=a.UNIT.name.toLowerCase(),a.units==="metre"&&(a.units="meter"),a.UNIT.convert&&(a.type==="GEOGCS"?a.DATUM&&a.DATUM.SPHEROID&&(a.to_meter=a.UNIT.convert*a.DATUM.SPHEROID.a):a.to_meter=a.UNIT.convert));var m=a.GEOGCS;a.type==="GEOGCS"&&(m=a),m&&(m.DATUM?a.datumCode=m.DATUM.name.toLowerCase():a.datumCode=m.name.toLowerCase(),a.datumCode.slice(0,2)==="d_"&&(a.datumCode=a.datumCode.slice(2)),a.datumCode==="new_zealand_1949"&&(a.datumCode="nzgd49"),(a.datumCode==="wgs_1984"||a.datumCode==="world_geodetic_system_1984")&&(a.PROJECTION==="Mercator_Auxiliary_Sphere"&&(a.sphere=!0),a.datumCode="wgs84"),a.datumCode==="belge_1972"&&(a.datumCode="rnb72"),m.DATUM&&m.DATUM.SPHEROID&&(a.ellps=m.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),a.ellps.toLowerCase().slice(0,13)==="international"&&(a.ellps="intl"),a.a=m.DATUM.SPHEROID.a,a.rf=parseFloat(m.DATUM.SPHEROID.rf,10)),m.DATUM&&m.DATUM.TOWGS84&&(a.datum_params=m.DATUM.TOWGS84),~a.datumCode.indexOf("osgb_1936")&&(a.datumCode="osgb36"),~a.datumCode.indexOf("osni_1952")&&(a.datumCode="osni52"),(~a.datumCode.indexOf("tm65")||~a.datumCode.indexOf("geodetic_datum_of_1965"))&&(a.datumCode="ire65"),a.datumCode==="ch1903+"&&(a.datumCode="ch1903"),~a.datumCode.indexOf("israel")&&(a.datumCode="isr93")),a.b&&!isFinite(a.b)&&(a.b=a.a),a.rectified_grid_angle&&(a.rectified_grid_angle=Ys(a.rectified_grid_angle));function o(O){var D=a.to_meter||1;return O*D}var P=function(O){return rT(a,O)},A=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Ys],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Ys],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Ys],["lat0","latitude_of_origin",Ys],["lat0","standard_parallel_1",Ys],["lat1","standard_parallel_1",Ys],["lat2","standard_parallel_2",Ys],["azimuth","Azimuth"],["alpha","azimuth",Ys],["srsCode","name"]];A.forEach(P),g1(a)}function lm(a){if(typeof a=="object")return Zd(a);const i=KS(a);var l=tT(a);if(i==="WKT2"){const x=XS(l);return Zd(x)}var u=l[0],p={};return Fl(l,p),_1(p),p[u]}function rs(a){var i=this;if(arguments.length===2){var l=arguments[1];typeof l=="string"?l.charAt(0)==="+"?rs[a]=om(arguments[1]):rs[a]=lm(arguments[1]):rs[a]=l}else if(arguments.length===1){if(Array.isArray(a))return a.map(function(u){Array.isArray(u)?rs.apply(i,u):rs(u)});if(typeof a=="string"){if(a in rs)return rs[a]}else"EPSG"in a?rs["EPSG:"+a.EPSG]=a:"ESRI"in a?rs["ESRI:"+a.ESRI]=a:"IAU2000"in a?rs["IAU2000:"+a.IAU2000]=a:console.log(a);return}}NS(rs);function nT(a){return typeof a=="string"}function aT(a){return a in rs}function oT(a){return a.indexOf("+")!==0&&a.indexOf("[")!==-1||typeof a=="object"&&!("srsCode"in a)}var lT=["3857","900913","3785","102113"];function hT(a){var i=Ia(a,"authority");if(i){var l=Ia(i,"epsg");return l&&lT.indexOf(l)>-1}}function cT(a){var i=Ia(a,"extension");if(i)return Ia(i,"proj4")}function uT(a){return a[0]==="+"}function dT(a){if(nT(a)){if(aT(a))return rs[a];if(oT(a)){var i=lm(a);if(hT(i))return rs["EPSG:3857"];var l=cT(i);return l?om(l):i}if(uT(a))return om(a)}else return a.projName?a:lm(a)}function U0(a,i){a=a||{};var l,u;if(!i)return a;for(u in i)l=i[u],l!==void 0&&(a[u]=l);return a}function wn(a,i,l){var u=a*i;return l/Math.sqrt(1-u*u)}function Zc(a){return a<0?-1:1}function ye(a){return Math.abs(a)<=Ur?a:a-Zc(a)*Fc}function Js(a,i,l){var u=a*l,p=.5*a;return u=Math.pow((1-u)/(1+u),p),Math.tan(.5*(Qt-i))/u}function Nc(a,i){for(var l=.5*a,u,p,x=Qt-2*Math.atan(i),m=0;m<=15;m++)if(u=a*Math.sin(x),p=Qt-2*Math.atan(i*Math.pow((1-u)/(1+u),l))-x,x+=p,Math.abs(p)<=1e-10)return x;return-9999}function fT(){var a=this.b/this.a;this.es=1-a*a,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=wn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function pT(a){var i=a.x,l=a.y;if(l*xn>90&&l*xn<-90&&i*xn>180&&i*xn<-180)return null;var u,p;if(Math.abs(Math.abs(l)-Qt)<=fe)return null;if(this.sphere)u=this.x0+this.a*this.k0*ye(i-this.long0),p=this.y0+this.a*this.k0*Math.log(Math.tan(Ai+.5*l));else{var x=Math.sin(l),m=Js(this.e,l,x);u=this.x0+this.a*this.k0*ye(i-this.long0),p=this.y0-this.a*this.k0*Math.log(m)}return a.x=u,a.y=p,a}function mT(a){var i=a.x-this.x0,l=a.y-this.y0,u,p;if(this.sphere)p=Qt-2*Math.atan(Math.exp(-l/(this.a*this.k0)));else{var x=Math.exp(-l/(this.a*this.k0));if(p=Nc(this.e,x),p===-9999)return null}return u=ye(this.long0+i/(this.a*this.k0)),a.x=u,a.y=p,a}var gT=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const _T={init:fT,forward:pT,inverse:mT,names:gT};function yT(){}function V0(a){return a}var vT=["longlat","identity"];const xT={init:yT,forward:V0,inverse:V0,names:vT};var bT=[_T,xT],So={},Bl=[];function y1(a,i){var l=Bl.length;return a.names?(Bl[l]=a,a.names.forEach(function(u){So[u.toLowerCase()]=l}),this):(console.log(i),!0)}function v1(a){return a.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function wT(a){if(!a)return!1;var i=a.toLowerCase();if(typeof So[i]<"u"&&Bl[So[i]]||(i=v1(i),i in So&&Bl[So[i]]))return Bl[So[i]]}function MT(){bT.forEach(y1)}const ST={start:MT,add:y1,get:wT};var x1={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const TT=x1.WGS84;function PT(a,i,l,u){var p=a*a,x=i*i,m=(p-x)/p,o=0;u?(a*=1-m*(US+m*(VS+m*qS)),p=a*a,m=0):o=Math.sqrt(m);var P=(p-x)/x;return{es:m,e:o,ep2:P}}function ET(a,i,l,u,p){if(!a){var x=Ia(x1,u);x||(x=TT),a=x.a,i=x.b,l=x.rf}return l&&!i&&(i=(1-1/l)*a),(l===0||Math.abs(a-i)<fe)&&(p=!0,i=a),{a,b:i,rf:l,sphere:p}}var Cd={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var IT in Cd){var jp=Cd[IT];jp.datumName&&(Cd[jp.datumName]=jp)}function CT(a,i,l,u,p,x,m){var o={};return a===void 0||a==="none"?o.datum_type=am:o.datum_type=GS,i&&(o.datum_params=i.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=Ro),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=ko,o.datum_params[3]*=Cc,o.datum_params[4]*=Cc,o.datum_params[5]*=Cc,o.datum_params[6]=o.datum_params[6]/1e6+1)),m&&(o.datum_type=Zl,o.grids=m),o.a=l,o.b=u,o.es=p,o.ep2=x,o}var $m={};function AT(a,i,l){return i instanceof ArrayBuffer?RT(a,i,l):{ready:kT(a,i)}}function RT(a,i,l){var u=!0;l!==void 0&&l.includeErrorFields===!1&&(u=!1);var p=new DataView(i),x=LT(p),m=OT(p,x),o=FT(p,m,x,u),P={header:m,subgrids:o};return $m[a]=P,P}async function kT(a,i){for(var l=[],u=await i.getImageCount(),p=u-1;p>=0;p--){var x=await i.getImage(p),m=await x.readRasters(),o=m,P=[x.getWidth(),x.getHeight()],A=x.getBoundingBox().map(q0),O=[x.fileDirectory.ModelPixelScale[0],x.fileDirectory.ModelPixelScale[1]].map(q0),D=A[0]+(P[0]-1)*O[0],k=A[3]-(P[1]-1)*O[1],B=o[0],V=o[1],K=[];for(let ct=P[1]-1;ct>=0;ct--)for(let Dt=P[0]-1;Dt>=0;Dt--){var it=ct*P[0]+Dt;K.push([-Sa(V[it]),Sa(B[it])])}l.push({del:O,lim:P,ll:[-D,k],cvs:K})}var gt={header:{nSubgrids:u},subgrids:l};return $m[a]=gt,gt}function DT(a){if(a===void 0)return null;var i=a.split(",");return i.map(zT)}function zT(a){if(a.length===0)return null;var i=a[0]==="@";return i&&(a=a.slice(1)),a==="null"?{name:"null",mandatory:!i,grid:null,isNull:!0}:{name:a,mandatory:!i,grid:$m[a]||null,isNull:!1}}function q0(a){return a*Math.PI/180}function Sa(a){return a/3600*Math.PI/180}function LT(a){var i=a.getInt32(8,!1);return i===11?!1:(i=a.getInt32(8,!0),i!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function OT(a,i){return{nFields:a.getInt32(8,i),nSubgridFields:a.getInt32(24,i),nSubgrids:a.getInt32(40,i),shiftType:hm(a,56,64).trim(),fromSemiMajorAxis:a.getFloat64(120,i),fromSemiMinorAxis:a.getFloat64(136,i),toSemiMajorAxis:a.getFloat64(152,i),toSemiMinorAxis:a.getFloat64(168,i)}}function hm(a,i,l){return String.fromCharCode.apply(null,new Uint8Array(a.buffer.slice(i,l)))}function FT(a,i,l,u){for(var p=176,x=[],m=0;m<i.nSubgrids;m++){var o=NT(a,p,l),P=GT(a,p,o,l,u),A=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),O=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);x.push({ll:[Sa(o.lowerLongitude),Sa(o.lowerLatitude)],del:[Sa(o.longitudeInterval),Sa(o.latitudeInterval)],lim:[A,O],count:o.gridNodeCount,cvs:BT(P)});var D=16;u===!1&&(D=8),p+=176+o.gridNodeCount*D}return x}function BT(a){return a.map(function(i){return[Sa(i.longitudeShift),Sa(i.latitudeShift)]})}function NT(a,i,l){return{name:hm(a,i+8,i+16).trim(),parent:hm(a,i+24,i+24+8).trim(),lowerLatitude:a.getFloat64(i+72,l),upperLatitude:a.getFloat64(i+88,l),lowerLongitude:a.getFloat64(i+104,l),upperLongitude:a.getFloat64(i+120,l),latitudeInterval:a.getFloat64(i+136,l),longitudeInterval:a.getFloat64(i+152,l),gridNodeCount:a.getInt32(i+168,l)}}function GT(a,i,l,u,p){var x=i+176,m=16;p===!1&&(m=8);for(var o=[],P=0;P<l.gridNodeCount;P++){var A={latitudeShift:a.getFloat32(x+P*m,u),longitudeShift:a.getFloat32(x+P*m+4,u)};p!==!1&&(A.latitudeAccuracy=a.getFloat32(x+P*m+8,u),A.longitudeAccuracy=a.getFloat32(x+P*m+12,u)),o.push(A)}return o}function bn(a,i){if(!(this instanceof bn))return new bn(a);i=i||function(A){if(A)throw A};var l=dT(a);if(typeof l!="object"){i("Could not parse to valid json: "+a);return}var u=bn.projections.get(l.projName);if(!u){i("Could not get projection name from: "+a);return}if(l.datumCode&&l.datumCode!=="none"){var p=Ia(Cd,l.datumCode);p&&(l.datum_params=l.datum_params||(p.towgs84?p.towgs84.split(","):null),l.ellps=p.ellipse,l.datumName=p.datumName?p.datumName:l.datumCode)}l.k0=l.k0||1,l.axis=l.axis||"enu",l.ellps=l.ellps||"wgs84",l.lat1=l.lat1||l.lat0;var x=ET(l.a,l.b,l.rf,l.ellps,l.sphere),m=PT(x.a,x.b,x.rf,l.R_A),o=DT(l.nadgrids),P=l.datum||CT(l.datumCode,l.datum_params,x.a,x.b,m.es,m.ep2,o);U0(this,l),U0(this,u),this.a=x.a,this.b=x.b,this.rf=x.rf,this.sphere=x.sphere,this.es=m.es,this.e=m.e,this.ep2=m.ep2,this.datum=P,this.init(),i(null,this)}bn.projections=ST;bn.projections.start();function jT(a,i){return a.datum_type!==i.datum_type||a.a!==i.a||Math.abs(a.es-i.es)>5e-11?!1:a.datum_type===Ro?a.datum_params[0]===i.datum_params[0]&&a.datum_params[1]===i.datum_params[1]&&a.datum_params[2]===i.datum_params[2]:a.datum_type===ko?a.datum_params[0]===i.datum_params[0]&&a.datum_params[1]===i.datum_params[1]&&a.datum_params[2]===i.datum_params[2]&&a.datum_params[3]===i.datum_params[3]&&a.datum_params[4]===i.datum_params[4]&&a.datum_params[5]===i.datum_params[5]&&a.datum_params[6]===i.datum_params[6]:!0}function b1(a,i,l){var u=a.x,p=a.y,x=a.z?a.z:0,m,o,P,A;if(p<-Qt&&p>-1.001*Qt)p=-Qt;else if(p>Qt&&p<1.001*Qt)p=Qt;else{if(p<-Qt)return{x:-1/0,y:-1/0,z:a.z};if(p>Qt)return{x:1/0,y:1/0,z:a.z}}return u>Math.PI&&(u-=2*Math.PI),o=Math.sin(p),A=Math.cos(p),P=o*o,m=l/Math.sqrt(1-i*P),{x:(m+x)*A*Math.cos(u),y:(m+x)*A*Math.sin(u),z:(m*(1-i)+x)*o}}function w1(a,i,l,u){var p=1e-12,x=p*p,m=30,o,P,A,O,D,k,B,V,K,it,gt,ct,Dt,Ct=a.x,zt=a.y,ae=a.z?a.z:0,ke,de,Le;if(o=Math.sqrt(Ct*Ct+zt*zt),P=Math.sqrt(Ct*Ct+zt*zt+ae*ae),o/l<p){if(ke=0,P/l<p)return de=Qt,Le=-u,{x:a.x,y:a.y,z:a.z}}else ke=Math.atan2(zt,Ct);A=ae/P,O=o/P,D=1/Math.sqrt(1-i*(2-i)*O*O),V=O*(1-i)*D,K=A*D,Dt=0;do Dt++,B=l/Math.sqrt(1-i*K*K),Le=o*V+ae*K-B*(1-i*K*K),k=i*B/(B+Le),D=1/Math.sqrt(1-k*(2-k)*O*O),it=O*(1-k)*D,gt=A*D,ct=gt*V-it*K,V=it,K=gt;while(ct*ct>x&&Dt<m);return de=Math.atan(gt/Math.abs(it)),{x:ke,y:de,z:Le}}function UT(a,i,l){if(i===Ro)return{x:a.x+l[0],y:a.y+l[1],z:a.z+l[2]};if(i===ko){var u=l[0],p=l[1],x=l[2],m=l[3],o=l[4],P=l[5],A=l[6];return{x:A*(a.x-P*a.y+o*a.z)+u,y:A*(P*a.x+a.y-m*a.z)+p,z:A*(-o*a.x+m*a.y+a.z)+x}}}function VT(a,i,l){if(i===Ro)return{x:a.x-l[0],y:a.y-l[1],z:a.z-l[2]};if(i===ko){var u=l[0],p=l[1],x=l[2],m=l[3],o=l[4],P=l[5],A=l[6],O=(a.x-u)/A,D=(a.y-p)/A,k=(a.z-x)/A;return{x:O+P*D-o*k,y:-P*O+D+m*k,z:o*O-m*D+k}}}function wd(a){return a===Ro||a===ko}function qT(a,i,l){if(jT(a,i)||a.datum_type===am||i.datum_type===am)return l;var u=a.a,p=a.es;if(a.datum_type===Zl){var x=$0(a,!1,l);if(x!==0)return;u=O0,p=F0}var m=i.a,o=i.b,P=i.es;if(i.datum_type===Zl&&(m=O0,o=jS,P=F0),p===P&&u===m&&!wd(a.datum_type)&&!wd(i.datum_type))return l;if(l=b1(l,p,u),wd(a.datum_type)&&(l=UT(l,a.datum_type,a.datum_params)),wd(i.datum_type)&&(l=VT(l,i.datum_type,i.datum_params)),l=w1(l,P,m,o),i.datum_type===Zl){var A=$0(i,!0,l);if(A!==0)return}return l}function $0(a,i,l){if(a.grids===null||a.grids.length===0)return console.log("Grid shift grids not found"),-1;var u={x:-l.x,y:l.y},p={x:Number.NaN,y:Number.NaN},x=[];t:for(var m=0;m<a.grids.length;m++){var o=a.grids[m];if(x.push(o.name),o.isNull){p=u;break}if(o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var P=o.grid.subgrids,A=0,O=P.length;A<O;A++){var D=P[A],k=(Math.abs(D.del[1])+Math.abs(D.del[0]))/1e4,B=D.ll[0]-k,V=D.ll[1]-k,K=D.ll[0]+(D.lim[0]-1)*D.del[0]+k,it=D.ll[1]+(D.lim[1]-1)*D.del[1]+k;if(!(V>u.y||B>u.x||it<u.y||K<u.x)&&(p=$T(u,i,D),!isNaN(p.x)))break t}}return isNaN(p.x)?(console.log("Failed to find a grid shift table for location '"+-u.x*xn+" "+u.y*xn+" tried: '"+x+"'"),-1):(l.x=-p.x,l.y=p.y,0)}function $T(a,i,l){var u={x:Number.NaN,y:Number.NaN};if(isNaN(a.x))return u;var p={x:a.x,y:a.y};p.x-=l.ll[0],p.y-=l.ll[1],p.x=ye(p.x-Math.PI)+Math.PI;var x=Z0(p,l);if(i){if(isNaN(x.x))return u;x.x=p.x-x.x,x.y=p.y-x.y;var m=9,o=1e-12,P,A;do{if(A=Z0(x,l),isNaN(A.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}P={x:p.x-(A.x+x.x),y:p.y-(A.y+x.y)},x.x+=P.x,x.y+=P.y}while(m--&&Math.abs(P.x)>o&&Math.abs(P.y)>o);if(m<0)return console.log("Inverse grid shift iterator failed to converge."),u;u.x=ye(x.x+l.ll[0]),u.y=x.y+l.ll[1]}else isNaN(x.x)||(u.x=a.x+x.x,u.y=a.y+x.y);return u}function Z0(a,i){var l={x:a.x/i.del[0],y:a.y/i.del[1]},u={x:Math.floor(l.x),y:Math.floor(l.y)},p={x:l.x-1*u.x,y:l.y-1*u.y},x={x:Number.NaN,y:Number.NaN},m;if(u.x<0||u.x>=i.lim[0]||u.y<0||u.y>=i.lim[1])return x;m=u.y*i.lim[0]+u.x;var o={x:i.cvs[m][0],y:i.cvs[m][1]};m++;var P={x:i.cvs[m][0],y:i.cvs[m][1]};m+=i.lim[0];var A={x:i.cvs[m][0],y:i.cvs[m][1]};m--;var O={x:i.cvs[m][0],y:i.cvs[m][1]},D=p.x*p.y,k=p.x*(1-p.y),B=(1-p.x)*(1-p.y),V=(1-p.x)*p.y;return x.x=B*o.x+k*P.x+V*O.x+D*A.x,x.y=B*o.y+k*P.y+V*O.y+D*A.y,x}function W0(a,i,l){var u=l.x,p=l.y,x=l.z||0,m,o,P,A={};for(P=0;P<3;P++)if(!(i&&P===2&&l.z===void 0))switch(P===0?(m=u,"ew".indexOf(a.axis[P])!==-1?o="x":o="y"):P===1?(m=p,"ns".indexOf(a.axis[P])!==-1?o="y":o="x"):(m=x,o="z"),a.axis[P]){case"e":A[o]=m;break;case"w":A[o]=-m;break;case"n":A[o]=m;break;case"s":A[o]=-m;break;case"u":l[o]!==void 0&&(A.z=m);break;case"d":l[o]!==void 0&&(A.z=-m);break;default:return null}return A}function M1(a){var i={x:a[0],y:a[1]};return a.length>2&&(i.z=a[2]),a.length>3&&(i.m=a[3]),i}function ZT(a){H0(a.x),H0(a.y)}function H0(a){if(typeof Number.isFinite=="function"){if(Number.isFinite(a))return;throw new TypeError("coordinates must be finite numbers")}if(typeof a!="number"||a!==a||!isFinite(a))throw new TypeError("coordinates must be finite numbers")}function WT(a,i){return(a.datum.datum_type===Ro||a.datum.datum_type===ko||a.datum.datum_type===Zl)&&i.datumCode!=="WGS84"||(i.datum.datum_type===Ro||i.datum.datum_type===ko||i.datum.datum_type===Zl)&&a.datumCode!=="WGS84"}function Wd(a,i,l,u){var p;Array.isArray(l)?l=M1(l):l={x:l.x,y:l.y,z:l.z,m:l.m};var x=l.z!==void 0;if(ZT(l),a.datum&&i.datum&&WT(a,i)&&(p=new bn("WGS84"),l=Wd(a,p,l,u),a=p),u&&a.axis!=="enu"&&(l=W0(a,!1,l)),a.projName==="longlat")l={x:l.x*Fi,y:l.y*Fi,z:l.z||0};else if(a.to_meter&&(l={x:l.x*a.to_meter,y:l.y*a.to_meter,z:l.z||0}),l=a.inverse(l),!l)return;if(a.from_greenwich&&(l.x+=a.from_greenwich),l=qT(a.datum,i.datum,l),!!l)return i.from_greenwich&&(l={x:l.x-i.from_greenwich,y:l.y,z:l.z||0}),i.projName==="longlat"?l={x:l.x*xn,y:l.y*xn,z:l.z||0}:(l=i.forward(l),i.to_meter&&(l={x:l.x/i.to_meter,y:l.y/i.to_meter,z:l.z||0})),u&&i.axis!=="enu"?W0(i,!0,l):(l&&!x&&delete l.z,l)}var X0=bn("WGS84");function Up(a,i,l,u){var p,x,m;return Array.isArray(l)?(p=Wd(a,i,l,u)||{x:NaN,y:NaN},l.length>2?typeof a.name<"u"&&a.name==="geocent"||typeof i.name<"u"&&i.name==="geocent"?typeof p.z=="number"?[p.x,p.y,p.z].concat(l.slice(3)):[p.x,p.y,l[2]].concat(l.slice(3)):[p.x,p.y].concat(l.slice(2)):[p.x,p.y]):(x=Wd(a,i,l,u),m=Object.keys(l),m.length===2||m.forEach(function(o){if(typeof a.name<"u"&&a.name==="geocent"||typeof i.name<"u"&&i.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;x[o]=l[o]}),x)}function K0(a){return a instanceof bn?a:a.oProj?a.oProj:bn(a)}function Os(a,i,l){a=K0(a);var u=!1,p;return typeof i>"u"?(i=a,a=X0,u=!0):(typeof i.x<"u"||Array.isArray(i))&&(l=i,i=a,a=X0,u=!0),i=K0(i),l?Up(a,i,l):(p={forward:function(x,m){return Up(a,i,x,m)},inverse:function(x,m){return Up(i,a,x,m)}},u&&(p.oProj=i),p)}var Y0=6,S1="AJSAJS",T1="AFAFAF",Nl=65,ps=73,zs=79,vc=86,xc=90;const HT={forward:P1,inverse:XT,toPoint:E1};function P1(a,i){return i=i||5,JT(KT({lat:a[1],lon:a[0]}),i)}function XT(a){var i=Zm(C1(a.toUpperCase()));return i.lat&&i.lon?[i.lon,i.lat,i.lon,i.lat]:[i.left,i.bottom,i.right,i.top]}function E1(a){var i=Zm(C1(a.toUpperCase()));return i.lat&&i.lon?[i.lon,i.lat]:[(i.left+i.right)/2,(i.top+i.bottom)/2]}function Vp(a){return a*(Math.PI/180)}function J0(a){return 180*(a/Math.PI)}function KT(a){var i=a.lat,l=a.lon,u=6378137,p=.00669438,x=.9996,m,o,P,A,O,D,k,B=Vp(i),V=Vp(l),K,it;it=Math.floor((l+180)/6)+1,l===180&&(it=60),i>=56&&i<64&&l>=3&&l<12&&(it=32),i>=72&&i<84&&(l>=0&&l<9?it=31:l>=9&&l<21?it=33:l>=21&&l<33?it=35:l>=33&&l<42&&(it=37)),m=(it-1)*6-180+3,K=Vp(m),o=p/(1-p),P=u/Math.sqrt(1-p*Math.sin(B)*Math.sin(B)),A=Math.tan(B)*Math.tan(B),O=o*Math.cos(B)*Math.cos(B),D=Math.cos(B)*(V-K),k=u*((1-p/4-3*p*p/64-5*p*p*p/256)*B-(3*p/8+3*p*p/32+45*p*p*p/1024)*Math.sin(2*B)+(15*p*p/256+45*p*p*p/1024)*Math.sin(4*B)-35*p*p*p/3072*Math.sin(6*B));var gt=x*P*(D+(1-A+O)*D*D*D/6+(5-18*A+A*A+72*O-58*o)*D*D*D*D*D/120)+5e5,ct=x*(k+P*Math.tan(B)*(D*D/2+(5-A+9*O+4*O*O)*D*D*D*D/24+(61-58*A+A*A+600*O-330*o)*D*D*D*D*D*D/720));return i<0&&(ct+=1e7),{northing:Math.round(ct),easting:Math.round(gt),zoneNumber:it,zoneLetter:YT(i)}}function Zm(a){var i=a.northing,l=a.easting,u=a.zoneLetter,p=a.zoneNumber;if(p<0||p>60)return null;var x=.9996,m=6378137,o=.00669438,P,A=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),O,D,k,B,V,K,it,gt,ct,Dt=l-5e5,Ct=i;u<"N"&&(Ct-=1e7),it=(p-1)*6-180+3,P=o/(1-o),K=Ct/x,gt=K/(m*(1-o/4-3*o*o/64-5*o*o*o/256)),ct=gt+(3*A/2-27*A*A*A/32)*Math.sin(2*gt)+(21*A*A/16-55*A*A*A*A/32)*Math.sin(4*gt)+151*A*A*A/96*Math.sin(6*gt),O=m/Math.sqrt(1-o*Math.sin(ct)*Math.sin(ct)),D=Math.tan(ct)*Math.tan(ct),k=P*Math.cos(ct)*Math.cos(ct),B=m*(1-o)/Math.pow(1-o*Math.sin(ct)*Math.sin(ct),1.5),V=Dt/(O*x);var zt=ct-O*Math.tan(ct)/B*(V*V/2-(5+3*D+10*k-4*k*k-9*P)*V*V*V*V/24+(61+90*D+298*k+45*D*D-252*P-3*k*k)*V*V*V*V*V*V/720);zt=J0(zt);var ae=(V-(1+2*D+k)*V*V*V/6+(5-2*k+28*D-3*k*k+8*P+24*D*D)*V*V*V*V*V/120)/Math.cos(ct);ae=it+J0(ae);var ke;if(a.accuracy){var de=Zm({northing:a.northing+a.accuracy,easting:a.easting+a.accuracy,zoneLetter:a.zoneLetter,zoneNumber:a.zoneNumber});ke={top:de.lat,right:de.lon,bottom:zt,left:ae}}else ke={lat:zt,lon:ae};return ke}function YT(a){var i="Z";return 84>=a&&a>=72?i="X":72>a&&a>=64?i="W":64>a&&a>=56?i="V":56>a&&a>=48?i="U":48>a&&a>=40?i="T":40>a&&a>=32?i="S":32>a&&a>=24?i="R":24>a&&a>=16?i="Q":16>a&&a>=8?i="P":8>a&&a>=0?i="N":0>a&&a>=-8?i="M":-8>a&&a>=-16?i="L":-16>a&&a>=-24?i="K":-24>a&&a>=-32?i="J":-32>a&&a>=-40?i="H":-40>a&&a>=-48?i="G":-48>a&&a>=-56?i="F":-56>a&&a>=-64?i="E":-64>a&&a>=-72?i="D":-72>a&&a>=-80&&(i="C"),i}function JT(a,i){var l="00000"+a.easting,u="00000"+a.northing;return a.zoneNumber+a.zoneLetter+QT(a.easting,a.northing,a.zoneNumber)+l.substr(l.length-5,i)+u.substr(u.length-5,i)}function QT(a,i,l){var u=I1(l),p=Math.floor(a/1e5),x=Math.floor(i/1e5)%20;return tP(p,x,u)}function I1(a){var i=a%Y0;return i===0&&(i=Y0),i}function tP(a,i,l){var u=l-1,p=S1.charCodeAt(u),x=T1.charCodeAt(u),m=p+a-1,o=x+i,P=!1;m>xc&&(m=m-xc+Nl-1,P=!0),(m===ps||p<ps&&m>ps||(m>ps||p<ps)&&P)&&m++,(m===zs||p<zs&&m>zs||(m>zs||p<zs)&&P)&&(m++,m===ps&&m++),m>xc&&(m=m-xc+Nl-1),o>vc?(o=o-vc+Nl-1,P=!0):P=!1,(o===ps||x<ps&&o>ps||(o>ps||x<ps)&&P)&&o++,(o===zs||x<zs&&o>zs||(o>zs||x<zs)&&P)&&(o++,o===ps&&o++),o>vc&&(o=o-vc+Nl-1);var A=String.fromCharCode(m)+String.fromCharCode(o);return A}function C1(a){if(a&&a.length===0)throw"MGRSPoint coverting from nothing";for(var i=a.length,l=null,u="",p,x=0;!/[A-Z]/.test(p=a.charAt(x));){if(x>=2)throw"MGRSPoint bad conversion from: "+a;u+=p,x++}var m=parseInt(u,10);if(x===0||x+3>i)throw"MGRSPoint bad conversion from: "+a;var o=a.charAt(x++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+a;l=a.substring(x,x+=2);for(var P=I1(m),A=eP(l.charAt(0),P),O=iP(l.charAt(1),P);O<rP(o);)O+=2e6;var D=i-x;if(D%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+a;var k=D/2,B=0,V=0,K,it,gt,ct,Dt;return k>0&&(K=1e5/Math.pow(10,k),it=a.substring(x,x+k),B=parseFloat(it)*K,gt=a.substring(x+k),V=parseFloat(gt)*K),ct=B+A,Dt=V+O,{easting:ct,northing:Dt,zoneLetter:o,zoneNumber:m,accuracy:K}}function eP(a,i){for(var l=S1.charCodeAt(i-1),u=1e5,p=!1;l!==a.charCodeAt(0);){if(l++,l===ps&&l++,l===zs&&l++,l>xc){if(p)throw"Bad character: "+a;l=Nl,p=!0}u+=1e5}return u}function iP(a,i){if(a>"V")throw"MGRSPoint given invalid Northing "+a;for(var l=T1.charCodeAt(i-1),u=0,p=!1;l!==a.charCodeAt(0);){if(l++,l===ps&&l++,l===zs&&l++,l>vc){if(p)throw"Bad character: "+a;l=Nl,p=!0}u+=1e5}return u}function rP(a){var i;switch(a){case"C":i=11e5;break;case"D":i=2e6;break;case"E":i=28e5;break;case"F":i=37e5;break;case"G":i=46e5;break;case"H":i=55e5;break;case"J":i=64e5;break;case"K":i=73e5;break;case"L":i=82e5;break;case"M":i=91e5;break;case"N":i=0;break;case"P":i=8e5;break;case"Q":i=17e5;break;case"R":i=26e5;break;case"S":i=35e5;break;case"T":i=44e5;break;case"U":i=53e5;break;case"V":i=62e5;break;case"W":i=7e6;break;case"X":i=79e5;break;default:i=-1}if(i>=0)return i;throw"Invalid zone letter: "+a}function Yl(a,i,l){if(!(this instanceof Yl))return new Yl(a,i,l);if(Array.isArray(a))this.x=a[0],this.y=a[1],this.z=a[2]||0;else if(typeof a=="object")this.x=a.x,this.y=a.y,this.z=a.z||0;else if(typeof a=="string"&&typeof i>"u"){var u=a.split(",");this.x=parseFloat(u[0],10),this.y=parseFloat(u[1],10),this.z=parseFloat(u[2],10)||0}else this.x=a,this.y=i,this.z=l||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Yl.fromMGRS=function(a){return new Yl(E1(a))};Yl.prototype.toMGRS=function(a){return P1([this.x,this.y],a)};var sP=1,nP=.25,Q0=.046875,ty=.01953125,ey=.01068115234375,aP=.75,oP=.46875,lP=.013020833333333334,hP=.007120768229166667,cP=.3645833333333333,uP=.005696614583333333,dP=.3076171875;function Wm(a){var i=[];i[0]=sP-a*(nP+a*(Q0+a*(ty+a*ey))),i[1]=a*(aP-a*(Q0+a*(ty+a*ey)));var l=a*a;return i[2]=l*(oP-a*(lP+a*hP)),l*=a,i[3]=l*(cP-a*uP),i[4]=l*a*dP,i}function ih(a,i,l,u){return l*=i,i*=i,u[0]*a-l*(u[1]+i*(u[2]+i*(u[3]+i*u[4])))}var fP=20;function Hm(a,i,l){for(var u=1/(1-i),p=a,x=fP;x;--x){var m=Math.sin(p),o=1-i*m*m;if(o=(ih(p,m,Math.cos(p),l)-a)*(o*Math.sqrt(o))*u,p-=o,Math.abs(o)<fe)return p}return p}function pP(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Wm(this.es),this.ml0=ih(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function mP(a){var i=a.x,l=a.y,u=ye(i-this.long0),p,x,m,o=Math.sin(l),P=Math.cos(l);if(this.es){var O=P*u,D=Math.pow(O,2),k=this.ep2*Math.pow(P,2),B=Math.pow(k,2),V=Math.abs(P)>fe?Math.tan(l):0,K=Math.pow(V,2),it=Math.pow(K,2);p=1-this.es*Math.pow(o,2),O=O/Math.sqrt(p);var gt=ih(l,o,P,this.en);x=this.a*(this.k0*O*(1+D/6*(1-K+k+D/20*(5-18*K+it+14*k-58*K*k+D/42*(61+179*it-it*K-479*K)))))+this.x0,m=this.a*(this.k0*(gt-this.ml0+o*u*O/2*(1+D/12*(5-K+9*k+4*B+D/30*(61+it-58*K+270*k-330*K*k+D/56*(1385+543*it-it*K-3111*K))))))+this.y0}else{var A=P*Math.sin(u);if(Math.abs(Math.abs(A)-1)<fe)return 93;if(x=.5*this.a*this.k0*Math.log((1+A)/(1-A))+this.x0,m=P*Math.cos(u)/Math.sqrt(1-Math.pow(A,2)),A=Math.abs(m),A>=1){if(A-1>fe)return 93;m=0}else m=Math.acos(m);l<0&&(m=-m),m=this.a*this.k0*(m-this.lat0)+this.y0}return a.x=x,a.y=m,a}function gP(a){var i,l,u,p,x=(a.x-this.x0)*(1/this.a),m=(a.y-this.y0)*(1/this.a);if(this.es)if(i=this.ml0+m/this.k0,l=Hm(i,this.es,this.en),Math.abs(l)<Qt){var D=Math.sin(l),k=Math.cos(l),B=Math.abs(k)>fe?Math.tan(l):0,V=this.ep2*Math.pow(k,2),K=Math.pow(V,2),it=Math.pow(B,2),gt=Math.pow(it,2);i=1-this.es*Math.pow(D,2);var ct=x*Math.sqrt(i)/this.k0,Dt=Math.pow(ct,2);i=i*B,u=l-i*Dt/(1-this.es)*.5*(1-Dt/12*(5+3*it-9*V*it+V-4*K-Dt/30*(61+90*it-252*V*it+45*gt+46*V-Dt/56*(1385+3633*it+4095*gt+1574*gt*it)))),p=ye(this.long0+ct*(1-Dt/6*(1+2*it+V-Dt/20*(5+28*it+24*gt+8*V*it+6*V-Dt/42*(61+662*it+1320*gt+720*gt*it))))/k)}else u=Qt*Zc(m),p=0;else{var o=Math.exp(x/this.k0),P=.5*(o-1/o),A=this.lat0+m/this.k0,O=Math.cos(A);i=Math.sqrt((1-Math.pow(O,2))/(1+Math.pow(P,2))),u=Math.asin(i),m<0&&(u=-u),P===0&&O===0?p=0:p=ye(Math.atan2(P,O)+this.long0)}return a.x=p,a.y=u,a}var _P=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const Ad={init:pP,forward:mP,inverse:gP,names:_P};function A1(a){var i=Math.exp(a);return i=(i-1/i)/2,i}function gs(a,i){a=Math.abs(a),i=Math.abs(i);var l=Math.max(a,i),u=Math.min(a,i)/(l||1);return l*Math.sqrt(1+Math.pow(u,2))}function yP(a){var i=1+a,l=i-1;return l===0?a:a*Math.log(i)/l}function vP(a){var i=Math.abs(a);return i=yP(i*(1+i/(gs(1,i)+1))),a<0?-i:i}function Xm(a,i){for(var l=2*Math.cos(2*i),u=a.length-1,p=a[u],x=0,m;--u>=0;)m=-x+l*p+a[u],x=p,p=m;return i+m*Math.sin(2*i)}function xP(a,i){for(var l=2*Math.cos(i),u=a.length-1,p=a[u],x=0,m;--u>=0;)m=-x+l*p+a[u],x=p,p=m;return Math.sin(i)*m}function bP(a){var i=Math.exp(a);return i=(i+1/i)/2,i}function R1(a,i,l){for(var u=Math.sin(i),p=Math.cos(i),x=A1(l),m=bP(l),o=2*p*m,P=-2*u*x,A=a.length-1,O=a[A],D=0,k=0,B=0,V,K;--A>=0;)V=k,K=D,k=O,D=B,O=-V+o*k-P*D+a[A],B=-K+P*k+o*D;return o=u*m,P=p*x,[o*O-P*B,o*B+P*O]}function wP(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ad.init.apply(this),this.forward=Ad.forward,this.inverse=Ad.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var a=this.es/(1+Math.sqrt(1-this.es)),i=a/(2-a),l=i;this.cgb[0]=i*(2+i*(-2/3+i*(-2+i*(116/45+i*(26/45+i*(-2854/675)))))),this.cbg[0]=i*(-2+i*(2/3+i*(4/3+i*(-82/45+i*(32/45+i*(4642/4725)))))),l=l*i,this.cgb[1]=l*(7/3+i*(-8/5+i*(-227/45+i*(2704/315+i*(2323/945))))),this.cbg[1]=l*(5/3+i*(-16/15+i*(-13/9+i*(904/315+i*(-1522/945))))),l=l*i,this.cgb[2]=l*(56/15+i*(-136/35+i*(-1262/105+i*(73814/2835)))),this.cbg[2]=l*(-26/15+i*(34/21+i*(8/5+i*(-12686/2835)))),l=l*i,this.cgb[3]=l*(4279/630+i*(-332/35+i*(-399572/14175))),this.cbg[3]=l*(1237/630+i*(-12/5+i*(-24832/14175))),l=l*i,this.cgb[4]=l*(4174/315+i*(-144838/6237)),this.cbg[4]=l*(-734/315+i*(109598/31185)),l=l*i,this.cgb[5]=l*(601676/22275),this.cbg[5]=l*(444337/155925),l=Math.pow(i,2),this.Qn=this.k0/(1+i)*(1+l*(1/4+l*(1/64+l/256))),this.utg[0]=i*(-.5+i*(2/3+i*(-37/96+i*(1/360+i*(81/512+i*(-96199/604800)))))),this.gtu[0]=i*(.5+i*(-2/3+i*(5/16+i*(41/180+i*(-127/288+i*(7891/37800)))))),this.utg[1]=l*(-1/48+i*(-1/15+i*(437/1440+i*(-46/105+i*(1118711/3870720))))),this.gtu[1]=l*(13/48+i*(-3/5+i*(557/1440+i*(281/630+i*(-1983433/1935360))))),l=l*i,this.utg[2]=l*(-17/480+i*(37/840+i*(209/4480+i*(-5569/90720)))),this.gtu[2]=l*(61/240+i*(-103/140+i*(15061/26880+i*(167603/181440)))),l=l*i,this.utg[3]=l*(-4397/161280+i*(11/504+i*(830251/7257600))),this.gtu[3]=l*(49561/161280+i*(-179/168+i*(6601661/7257600))),l=l*i,this.utg[4]=l*(-4583/161280+i*(108847/3991680)),this.gtu[4]=l*(34729/80640+i*(-3418889/1995840)),l=l*i,this.utg[5]=l*(-20648693/638668800),this.gtu[5]=l*(212378941/319334400);var u=Xm(this.cbg,this.lat0);this.Zb=-this.Qn*(u+xP(this.gtu,2*u))}function MP(a){var i=ye(a.x-this.long0),l=a.y;l=Xm(this.cbg,l);var u=Math.sin(l),p=Math.cos(l),x=Math.sin(i),m=Math.cos(i);l=Math.atan2(u,m*p),i=Math.atan2(x*p,gs(u,p*m)),i=vP(Math.tan(i));var o=R1(this.gtu,2*l,2*i);l=l+o[0],i=i+o[1];var P,A;return Math.abs(i)<=2.623395162778?(P=this.a*(this.Qn*i)+this.x0,A=this.a*(this.Qn*l+this.Zb)+this.y0):(P=1/0,A=1/0),a.x=P,a.y=A,a}function SP(a){var i=(a.x-this.x0)*(1/this.a),l=(a.y-this.y0)*(1/this.a);l=(l-this.Zb)/this.Qn,i=i/this.Qn;var u,p;if(Math.abs(i)<=2.623395162778){var x=R1(this.utg,2*l,2*i);l=l+x[0],i=i+x[1],i=Math.atan(A1(i));var m=Math.sin(l),o=Math.cos(l),P=Math.sin(i),A=Math.cos(i);l=Math.atan2(m*A,gs(P,A*o)),i=Math.atan2(P,A*o),u=ye(i+this.long0),p=Xm(this.cgb,l)}else u=1/0,p=1/0;return a.x=u,a.y=p,a}var TP=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const Rd={init:wP,forward:MP,inverse:SP,names:TP};function PP(a,i){if(a===void 0){if(a=Math.floor((ye(i)+Math.PI)*30/Math.PI)+1,a<0)return 0;if(a>60)return 60}return a}var EP="etmerc";function IP(){var a=PP(this.zone,this.long0);if(a===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(a)-183)*Fi,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Rd.init.apply(this),this.forward=Rd.forward,this.inverse=Rd.inverse}var CP=["Universal Transverse Mercator System","utm"];const AP={init:IP,names:CP,dependsOn:EP};function Km(a,i){return Math.pow((1-a)/(1+a),i)}var RP=20;function kP(){var a=Math.sin(this.lat0),i=Math.cos(this.lat0);i*=i,this.rc=Math.sqrt(1-this.es)/(1-this.es*a*a),this.C=Math.sqrt(1+this.es*i*i/(1-this.es)),this.phic0=Math.asin(a/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Ai)/(Math.pow(Math.tan(.5*this.lat0+Ai),this.C)*Km(this.e*a,this.ratexp))}function DP(a){var i=a.x,l=a.y;return a.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*l+Ai),this.C)*Km(this.e*Math.sin(l),this.ratexp))-Qt,a.x=this.C*i,a}function zP(a){for(var i=1e-14,l=a.x/this.C,u=a.y,p=Math.pow(Math.tan(.5*u+Ai)/this.K,1/this.C),x=RP;x>0&&(u=2*Math.atan(p*Km(this.e*Math.sin(a.y),-.5*this.e))-Qt,!(Math.abs(u-a.y)<i));--x)a.y=u;return x?(a.x=l,a.y=u,a):null}const Ym={init:kP,forward:DP,inverse:zP};function LP(){Ym.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function OP(a){var i,l,u,p;return a.x=ye(a.x-this.long0),Ym.forward.apply(this,[a]),i=Math.sin(a.y),l=Math.cos(a.y),u=Math.cos(a.x),p=this.k0*this.R2/(1+this.sinc0*i+this.cosc0*l*u),a.x=p*l*Math.sin(a.x),a.y=p*(this.cosc0*i-this.sinc0*l*u),a.x=this.a*a.x+this.x0,a.y=this.a*a.y+this.y0,a}function FP(a){var i,l,u,p,x;if(a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,x=gs(a.x,a.y)){var m=2*Math.atan2(x,this.R2);i=Math.sin(m),l=Math.cos(m),p=Math.asin(l*this.sinc0+a.y*i*this.cosc0/x),u=Math.atan2(a.x*i,x*this.cosc0*l-a.y*this.sinc0*i)}else p=this.phic0,u=0;return a.x=u,a.y=p,Ym.inverse.apply(this,[a]),a.x=ye(a.x+this.long0),a}var BP=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const NP={init:LP,forward:OP,inverse:FP,names:BP};function GP(a,i,l){return i*=l,Math.tan(.5*(Qt+a))*Math.pow((1-i)/(1+i),.5*l)}function jP(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=fe&&(this.k0=.5*(1+Zc(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=fe&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=fe&&Math.abs(Math.cos(this.lat_ts))>fe&&(this.k0=.5*this.cons*wn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Js(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=wn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Qt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function UP(a){var i=a.x,l=a.y,u=Math.sin(l),p=Math.cos(l),x,m,o,P,A,O,D=ye(i-this.long0);return Math.abs(Math.abs(i-this.long0)-Math.PI)<=fe&&Math.abs(l+this.lat0)<=fe?(a.x=NaN,a.y=NaN,a):this.sphere?(x=2*this.k0/(1+this.sinlat0*u+this.coslat0*p*Math.cos(D)),a.x=this.a*x*p*Math.sin(D)+this.x0,a.y=this.a*x*(this.coslat0*u-this.sinlat0*p*Math.cos(D))+this.y0,a):(m=2*Math.atan(this.ssfn_(l,u,this.e))-Qt,P=Math.cos(m),o=Math.sin(m),Math.abs(this.coslat0)<=fe?(A=Js(this.e,l*this.con,this.con*u),O=2*this.a*this.k0*A/this.cons,a.x=this.x0+O*Math.sin(i-this.long0),a.y=this.y0-this.con*O*Math.cos(i-this.long0),a):(Math.abs(this.sinlat0)<fe?(x=2*this.a*this.k0/(1+P*Math.cos(D)),a.y=x*o):(x=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*P*Math.cos(D))),a.y=x*(this.cosX0*o-this.sinX0*P*Math.cos(D))+this.y0),a.x=x*P*Math.sin(D)+this.x0,a))}function VP(a){a.x-=this.x0,a.y-=this.y0;var i,l,u,p,x,m=Math.sqrt(a.x*a.x+a.y*a.y);if(this.sphere){var o=2*Math.atan(m/(2*this.a*this.k0));return i=this.long0,l=this.lat0,m<=fe?(a.x=i,a.y=l,a):(l=Math.asin(Math.cos(o)*this.sinlat0+a.y*Math.sin(o)*this.coslat0/m),Math.abs(this.coslat0)<fe?this.lat0>0?i=ye(this.long0+Math.atan2(a.x,-1*a.y)):i=ye(this.long0+Math.atan2(a.x,a.y)):i=ye(this.long0+Math.atan2(a.x*Math.sin(o),m*this.coslat0*Math.cos(o)-a.y*this.sinlat0*Math.sin(o))),a.x=i,a.y=l,a)}else if(Math.abs(this.coslat0)<=fe){if(m<=fe)return l=this.lat0,i=this.long0,a.x=i,a.y=l,a;a.x*=this.con,a.y*=this.con,u=m*this.cons/(2*this.a*this.k0),l=this.con*Nc(this.e,u),i=this.con*ye(this.con*this.long0+Math.atan2(a.x,-1*a.y))}else p=2*Math.atan(m*this.cosX0/(2*this.a*this.k0*this.ms1)),i=this.long0,m<=fe?x=this.X0:(x=Math.asin(Math.cos(p)*this.sinX0+a.y*Math.sin(p)*this.cosX0/m),i=ye(this.long0+Math.atan2(a.x*Math.sin(p),m*this.cosX0*Math.cos(p)-a.y*this.sinX0*Math.sin(p)))),l=-1*Nc(this.e,Math.tan(.5*(Qt+x)));return a.x=i,a.y=l,a}var qP=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const $P={init:jP,forward:UP,inverse:VP,names:qP,ssfn_:GP};function ZP(){var a=this.lat0;this.lambda0=this.long0;var i=Math.sin(a),l=this.a,u=this.rf,p=1/u,x=2*p-Math.pow(p,2),m=this.e=Math.sqrt(x);this.R=this.k0*l*Math.sqrt(1-x)/(1-x*Math.pow(i,2)),this.alpha=Math.sqrt(1+x/(1-x)*Math.pow(Math.cos(a),4)),this.b0=Math.asin(i/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),P=Math.log(Math.tan(Math.PI/4+a/2)),A=Math.log((1+m*i)/(1-m*i));this.K=o-this.alpha*P+this.alpha*m/2*A}function WP(a){var i=Math.log(Math.tan(Math.PI/4-a.y/2)),l=this.e/2*Math.log((1+this.e*Math.sin(a.y))/(1-this.e*Math.sin(a.y))),u=-this.alpha*(i+l)+this.K,p=2*(Math.atan(Math.exp(u))-Math.PI/4),x=this.alpha*(a.x-this.lambda0),m=Math.atan(Math.sin(x)/(Math.sin(this.b0)*Math.tan(p)+Math.cos(this.b0)*Math.cos(x))),o=Math.asin(Math.cos(this.b0)*Math.sin(p)-Math.sin(this.b0)*Math.cos(p)*Math.cos(x));return a.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,a.x=this.R*m+this.x0,a}function HP(a){for(var i=a.x-this.x0,l=a.y-this.y0,u=i/this.R,p=2*(Math.atan(Math.exp(l/this.R))-Math.PI/4),x=Math.asin(Math.cos(this.b0)*Math.sin(p)+Math.sin(this.b0)*Math.cos(p)*Math.cos(u)),m=Math.atan(Math.sin(u)/(Math.cos(this.b0)*Math.cos(u)-Math.sin(this.b0)*Math.tan(p))),o=this.lambda0+m/this.alpha,P=0,A=x,O=-1e3,D=0;Math.abs(A-O)>1e-7;){if(++D>20)return;P=1/this.alpha*(Math.log(Math.tan(Math.PI/4+x/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(A))/2)),O=A,A=2*Math.atan(Math.exp(P))-Math.PI/2}return a.x=o,a.y=A,a}var XP=["somerc"];const KP={init:ZP,forward:WP,inverse:HP,names:XP};var zl=1e-7;function YP(a){var i=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],l=typeof a.projName=="object"?Object.keys(a.projName)[0]:a.projName;return"no_uoff"in a||"no_off"in a||i.indexOf(l)!==-1||i.indexOf(v1(l))!==-1}function JP(){var a,i,l,u,p,x,m,o,P,A,O=0,D,k=0,B=0,V=0,K=0,it=0,gt=0;this.no_off=YP(this),this.no_rot="no_rot"in this;var ct=!1;"alpha"in this&&(ct=!0);var Dt=!1;if("rectified_grid_angle"in this&&(Dt=!0),ct&&(gt=this.alpha),Dt&&(O=this.rectified_grid_angle),ct||Dt)k=this.longc;else if(B=this.long1,K=this.lat1,V=this.long2,it=this.lat2,Math.abs(K-it)<=zl||(a=Math.abs(K))<=zl||Math.abs(a-Qt)<=zl||Math.abs(Math.abs(this.lat0)-Qt)<=zl||Math.abs(Math.abs(it)-Qt)<=zl)throw new Error;var Ct=1-this.es;i=Math.sqrt(Ct),Math.abs(this.lat0)>fe?(o=Math.sin(this.lat0),l=Math.cos(this.lat0),a=1-this.es*o*o,this.B=l*l,this.B=Math.sqrt(1+this.es*this.B*this.B/Ct),this.A=this.B*this.k0*i/a,u=this.B*i/(l*Math.sqrt(a)),p=u*u-1,p<=0?p=0:(p=Math.sqrt(p),this.lat0<0&&(p=-p)),this.E=p+=u,this.E*=Math.pow(Js(this.e,this.lat0,o),this.B)):(this.B=1/i,this.A=this.k0,this.E=u=p=1),ct||Dt?(ct?(D=Math.asin(Math.sin(gt)/u),Dt||(O=gt)):(D=O,gt=Math.asin(u*Math.sin(D))),this.lam0=k-Math.asin(.5*(p-1/p)*Math.tan(D))/this.B):(x=Math.pow(Js(this.e,K,Math.sin(K)),this.B),m=Math.pow(Js(this.e,it,Math.sin(it)),this.B),p=this.E/x,P=(m-x)/(m+x),A=this.E*this.E,A=(A-m*x)/(A+m*x),a=B-V,a<-Math.pi?V-=Fc:a>Math.pi&&(V+=Fc),this.lam0=ye(.5*(B+V)-Math.atan(A*Math.tan(.5*this.B*(B-V))/P)/this.B),D=Math.atan(2*Math.sin(this.B*ye(B-this.lam0))/(p-1/p)),O=gt=Math.asin(u*Math.sin(D))),this.singam=Math.sin(D),this.cosgam=Math.cos(D),this.sinrot=Math.sin(O),this.cosrot=Math.cos(O),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(u*u-1)/Math.cos(gt))),this.lat0<0&&(this.u_0=-this.u_0)),p=.5*D,this.v_pole_n=this.ArB*Math.log(Math.tan(Ai-p)),this.v_pole_s=this.ArB*Math.log(Math.tan(Ai+p))}function QP(a){var i={},l,u,p,x,m,o,P,A;if(a.x=a.x-this.lam0,Math.abs(Math.abs(a.y)-Qt)>fe){if(m=this.E/Math.pow(Js(this.e,a.y,Math.sin(a.y)),this.B),o=1/m,l=.5*(m-o),u=.5*(m+o),x=Math.sin(this.B*a.x),p=(l*this.singam-x*this.cosgam)/u,Math.abs(Math.abs(p)-1)<fe)throw new Error;A=.5*this.ArB*Math.log((1-p)/(1+p)),o=Math.cos(this.B*a.x),Math.abs(o)<zl?P=this.A*a.x:P=this.ArB*Math.atan2(l*this.cosgam+x*this.singam,o)}else A=a.y>0?this.v_pole_n:this.v_pole_s,P=this.ArB*a.y;return this.no_rot?(i.x=P,i.y=A):(P-=this.u_0,i.x=A*this.cosrot+P*this.sinrot,i.y=P*this.cosrot-A*this.sinrot),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function tE(a){var i,l,u,p,x,m,o,P={};if(a.x=(a.x-this.x0)*(1/this.a),a.y=(a.y-this.y0)*(1/this.a),this.no_rot?(l=a.y,i=a.x):(l=a.x*this.cosrot-a.y*this.sinrot,i=a.y*this.cosrot+a.x*this.sinrot+this.u_0),u=Math.exp(-this.BrA*l),p=.5*(u-1/u),x=.5*(u+1/u),m=Math.sin(this.BrA*i),o=(m*this.cosgam+p*this.singam)/x,Math.abs(Math.abs(o)-1)<fe)P.x=0,P.y=o<0?-Qt:Qt;else{if(P.y=this.E/Math.sqrt((1+o)/(1-o)),P.y=Nc(this.e,Math.pow(P.y,1/this.B)),P.y===1/0)throw new Error;P.x=-this.rB*Math.atan2(p*this.cosgam-m*this.singam,Math.cos(this.BrA*i))}return P.x+=this.lam0,P}var eE=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const iE={init:JP,forward:QP,inverse:tE,names:eE};function rE(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<fe)){var a=this.b/this.a;this.e=Math.sqrt(1-a*a);var i=Math.sin(this.lat1),l=Math.cos(this.lat1),u=wn(this.e,i,l),p=Js(this.e,this.lat1,i),x=Math.sin(this.lat2),m=Math.cos(this.lat2),o=wn(this.e,x,m),P=Js(this.e,this.lat2,x),A=Math.abs(Math.abs(this.lat0)-Qt)<fe?0:Js(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>fe?this.ns=Math.log(u/o)/Math.log(p/P):this.ns=i,isNaN(this.ns)&&(this.ns=i),this.f0=u/(this.ns*Math.pow(p,this.ns)),this.rh=this.a*this.f0*Math.pow(A,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function sE(a){var i=a.x,l=a.y;Math.abs(2*Math.abs(l)-Math.PI)<=fe&&(l=Zc(l)*(Qt-2*fe));var u=Math.abs(Math.abs(l)-Qt),p,x;if(u>fe)p=Js(this.e,l,Math.sin(l)),x=this.a*this.f0*Math.pow(p,this.ns);else{if(u=l*this.ns,u<=0)return null;x=0}var m=this.ns*ye(i-this.long0);return a.x=this.k0*(x*Math.sin(m))+this.x0,a.y=this.k0*(this.rh-x*Math.cos(m))+this.y0,a}function nE(a){var i,l,u,p,x,m=(a.x-this.x0)/this.k0,o=this.rh-(a.y-this.y0)/this.k0;this.ns>0?(i=Math.sqrt(m*m+o*o),l=1):(i=-Math.sqrt(m*m+o*o),l=-1);var P=0;if(i!==0&&(P=Math.atan2(l*m,l*o)),i!==0||this.ns>0){if(l=1/this.ns,u=Math.pow(i/(this.a*this.f0),l),p=Nc(this.e,u),p===-9999)return null}else p=-Qt;return x=ye(P/this.ns+this.long0),a.x=x,a.y=p,a}var aE=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const oE={init:rE,forward:sE,inverse:nE,names:aE};function lE(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function hE(a){var i,l,u,p,x,m,o,P=a.x,A=a.y,O=ye(P-this.long0);return i=Math.pow((1+this.e*Math.sin(A))/(1-this.e*Math.sin(A)),this.alfa*this.e/2),l=2*(Math.atan(this.k*Math.pow(Math.tan(A/2+this.s45),this.alfa)/i)-this.s45),u=-O*this.alfa,p=Math.asin(Math.cos(this.ad)*Math.sin(l)+Math.sin(this.ad)*Math.cos(l)*Math.cos(u)),x=Math.asin(Math.cos(l)*Math.sin(u)/Math.cos(p)),m=this.n*x,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(p/2+this.s45),this.n),a.y=o*Math.cos(m)/1,a.x=o*Math.sin(m)/1,this.czech||(a.y*=-1,a.x*=-1),a}function cE(a){var i,l,u,p,x,m,o,P,A=a.x;a.x=a.y,a.y=A,this.czech||(a.y*=-1,a.x*=-1),m=Math.sqrt(a.x*a.x+a.y*a.y),x=Math.atan2(a.y,a.x),p=x/Math.sin(this.s0),u=2*(Math.atan(Math.pow(this.ro0/m,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),i=Math.asin(Math.cos(this.ad)*Math.sin(u)-Math.sin(this.ad)*Math.cos(u)*Math.cos(p)),l=Math.asin(Math.cos(u)*Math.sin(p)/Math.cos(i)),a.x=this.long0-l/this.alfa,o=i,P=0;var O=0;do a.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(i/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-a.y)<1e-10&&(P=1),o=a.y,O+=1;while(P===0&&O<15);return O>=15?null:a}var uE=["Krovak","krovak"];const dE={init:lE,forward:hE,inverse:cE,names:uE};function as(a,i,l,u,p){return a*p-i*Math.sin(2*p)+l*Math.sin(4*p)-u*Math.sin(6*p)}function Wc(a){return 1-.25*a*(1+a/16*(3+1.25*a))}function Hc(a){return .375*a*(1+.25*a*(1+.46875*a))}function Xc(a){return .05859375*a*a*(1+.75*a)}function Kc(a){return a*a*a*(35/3072)}function Jm(a,i,l){var u=i*l;return a/Math.sqrt(1-u*u)}function Ra(a){return Math.abs(a)<Qt?a:a-Zc(a)*Math.PI}function Hd(a,i,l,u,p){var x,m;x=a/i;for(var o=0;o<15;o++)if(m=(a-(i*x-l*Math.sin(2*x)+u*Math.sin(4*x)-p*Math.sin(6*x)))/(i-2*l*Math.cos(2*x)+4*u*Math.cos(4*x)-6*p*Math.cos(6*x)),x+=m,Math.abs(m)<=1e-10)return x;return NaN}function fE(){this.sphere||(this.e0=Wc(this.es),this.e1=Hc(this.es),this.e2=Xc(this.es),this.e3=Kc(this.es),this.ml0=this.a*as(this.e0,this.e1,this.e2,this.e3,this.lat0))}function pE(a){var i,l,u=a.x,p=a.y;if(u=ye(u-this.long0),this.sphere)i=this.a*Math.asin(Math.cos(p)*Math.sin(u)),l=this.a*(Math.atan2(Math.tan(p),Math.cos(u))-this.lat0);else{var x=Math.sin(p),m=Math.cos(p),o=Jm(this.a,this.e,x),P=Math.tan(p)*Math.tan(p),A=u*Math.cos(p),O=A*A,D=this.es*m*m/(1-this.es),k=this.a*as(this.e0,this.e1,this.e2,this.e3,p);i=o*A*(1-O*P*(1/6-(8-P+8*D)*O/120)),l=k-this.ml0+o*x/m*O*(.5+(5-P+6*D)*O/24)}return a.x=i+this.x0,a.y=l+this.y0,a}function mE(a){a.x-=this.x0,a.y-=this.y0;var i=a.x/this.a,l=a.y/this.a,u,p;if(this.sphere){var x=l+this.lat0;u=Math.asin(Math.sin(x)*Math.cos(i)),p=Math.atan2(Math.tan(i),Math.cos(x))}else{var m=this.ml0/this.a+l,o=Hd(m,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-Qt)<=fe)return a.x=this.long0,a.y=Qt,l<0&&(a.y*=-1),a;var P=Jm(this.a,this.e,Math.sin(o)),A=P*P*P/this.a/this.a*(1-this.es),O=Math.pow(Math.tan(o),2),D=i*this.a/P,k=D*D;u=o-P*Math.tan(o)/A*D*D*(.5-(1+3*O)*D*D/24),p=D*(1-k*(O/3+(1+3*O)*O*k/15))/Math.cos(o)}return a.x=ye(p+this.long0),a.y=Ra(u),a}var gE=["Cassini","Cassini_Soldner","cass"];const _E={init:fE,forward:pE,inverse:mE,names:gE};function Pa(a,i){var l;return a>1e-7?(l=a*i,(1-a*a)*(i/(1-l*l)-.5/a*Math.log((1-l)/(1+l)))):2*i}var yE=1,vE=2,xE=3,bE=4;function wE(){var a=Math.abs(this.lat0);if(Math.abs(a-Qt)<fe?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(a)<fe?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var i;switch(this.qp=Pa(this.e,1),this.mmf=.5/(1-this.es),this.apa=RE(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),i=Math.sin(this.lat0),this.sinb1=Pa(this.e,i)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*i*i)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function ME(a){var i,l,u,p,x,m,o,P,A,O,D=a.x,k=a.y;if(D=ye(D-this.long0),this.sphere){if(x=Math.sin(k),O=Math.cos(k),u=Math.cos(D),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l=this.mode===this.EQUIT?1+O*u:1+this.sinph0*x+this.cosph0*O*u,l<=fe)return null;l=Math.sqrt(2/l),i=l*O*Math.sin(D),l*=this.mode===this.EQUIT?x:this.cosph0*x-this.sinph0*O*u}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(u=-u),Math.abs(k+this.lat0)<fe)return null;l=Ai-k*.5,l=2*(this.mode===this.S_POLE?Math.cos(l):Math.sin(l)),i=l*Math.sin(D),l*=u}}else{switch(o=0,P=0,A=0,u=Math.cos(D),p=Math.sin(D),x=Math.sin(k),m=Pa(this.e,x),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=m/this.qp,P=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:A=1+this.sinb1*o+this.cosb1*P*u;break;case this.EQUIT:A=1+P*u;break;case this.N_POLE:A=Qt+k,m=this.qp-m;break;case this.S_POLE:A=k-Qt,m=this.qp+m;break}if(Math.abs(A)<fe)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:A=Math.sqrt(2/A),this.mode===this.OBLIQ?l=this.ymf*A*(this.cosb1*o-this.sinb1*P*u):l=(A=Math.sqrt(2/(1+P*u)))*o*this.ymf,i=this.xmf*A*P*p;break;case this.N_POLE:case this.S_POLE:m>=0?(i=(A=Math.sqrt(m))*p,l=u*(this.mode===this.S_POLE?A:-A)):i=l=0;break}}return a.x=this.a*i+this.x0,a.y=this.a*l+this.y0,a}function SE(a){a.x-=this.x0,a.y-=this.y0;var i=a.x/this.a,l=a.y/this.a,u,p,x,m,o,P,A;if(this.sphere){var O=0,D,k=0;if(D=Math.sqrt(i*i+l*l),p=D*.5,p>1)return null;switch(p=2*Math.asin(p),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(k=Math.sin(p),O=Math.cos(p)),this.mode){case this.EQUIT:p=Math.abs(D)<=fe?0:Math.asin(l*k/D),i*=k,l=O*D;break;case this.OBLIQ:p=Math.abs(D)<=fe?this.lat0:Math.asin(O*this.sinph0+l*k*this.cosph0/D),i*=k*this.cosph0,l=(O-Math.sin(p)*this.sinph0)*D;break;case this.N_POLE:l=-l,p=Qt-p;break;case this.S_POLE:p-=Qt;break}u=l===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(i,l)}else{if(A=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i/=this.dd,l*=this.dd,P=Math.sqrt(i*i+l*l),P<fe)return a.x=this.long0,a.y=this.lat0,a;m=2*Math.asin(.5*P/this.rq),x=Math.cos(m),i*=m=Math.sin(m),this.mode===this.OBLIQ?(A=x*this.sinb1+l*m*this.cosb1/P,o=this.qp*A,l=P*this.cosb1*x-l*this.sinb1*m):(A=l*m/P,o=this.qp*A,l=P*x)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(l=-l),o=i*i+l*l,!o)return a.x=this.long0,a.y=this.lat0,a;A=1-o/this.qp,this.mode===this.S_POLE&&(A=-A)}u=Math.atan2(i,l),p=kE(Math.asin(A),this.apa)}return a.x=ye(this.long0+u),a.y=p,a}var TE=.3333333333333333,PE=.17222222222222222,EE=.10257936507936508,IE=.06388888888888888,CE=.0664021164021164,AE=.016415012942191543;function RE(a){var i,l=[];return l[0]=a*TE,i=a*a,l[0]+=i*PE,l[1]=i*IE,i*=a,l[0]+=i*EE,l[1]+=i*CE,l[2]=i*AE,l}function kE(a,i){var l=a+a;return a+i[0]*Math.sin(l)+i[1]*Math.sin(l+l)+i[2]*Math.sin(l+l+l)}var DE=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const zE={init:wE,forward:ME,inverse:SE,names:DE,S_POLE:yE,N_POLE:vE,EQUIT:xE,OBLIQ:bE};function Ca(a){return Math.abs(a)>1&&(a=a>1?1:-1),Math.asin(a)}function LE(){Math.abs(this.lat1+this.lat2)<fe||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=wn(this.e3,this.sin_po,this.cos_po),this.qs1=Pa(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=wn(this.e3,this.sin_po,this.cos_po),this.qs2=Pa(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Pa(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>fe?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function OE(a){var i=a.x,l=a.y;this.sin_phi=Math.sin(l),this.cos_phi=Math.cos(l);var u=Pa(this.e3,this.sin_phi),p=this.a*Math.sqrt(this.c-this.ns0*u)/this.ns0,x=this.ns0*ye(i-this.long0),m=p*Math.sin(x)+this.x0,o=this.rh-p*Math.cos(x)+this.y0;return a.x=m,a.y=o,a}function FE(a){var i,l,u,p,x,m;return a.x-=this.x0,a.y=this.rh-a.y+this.y0,this.ns0>=0?(i=Math.sqrt(a.x*a.x+a.y*a.y),u=1):(i=-Math.sqrt(a.x*a.x+a.y*a.y),u=-1),p=0,i!==0&&(p=Math.atan2(u*a.x,u*a.y)),u=i*this.ns0/this.a,this.sphere?m=Math.asin((this.c-u*u)/(2*this.ns0)):(l=(this.c-u*u)/this.ns0,m=this.phi1z(this.e3,l)),x=ye(p/this.ns0+this.long0),a.x=x,a.y=m,a}function BE(a,i){var l,u,p,x,m,o=Ca(.5*i);if(a<fe)return o;for(var P=a*a,A=1;A<=25;A++)if(l=Math.sin(o),u=Math.cos(o),p=a*l,x=1-p*p,m=.5*x*x/u*(i/(1-P)-l/x+.5/a*Math.log((1-p)/(1+p))),o=o+m,Math.abs(m)<=1e-7)return o;return null}var NE=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const GE={init:LE,forward:OE,inverse:FE,names:NE,phi1z:BE};function jE(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function UE(a){var i,l,u,p,x,m,o,P,A=a.x,O=a.y;return u=ye(A-this.long0),i=Math.sin(O),l=Math.cos(O),p=Math.cos(u),m=this.sin_p14*i+this.cos_p14*l*p,x=1,m>0||Math.abs(m)<=fe?(o=this.x0+this.a*x*l*Math.sin(u)/m,P=this.y0+this.a*x*(this.cos_p14*i-this.sin_p14*l*p)/m):(o=this.x0+this.infinity_dist*l*Math.sin(u),P=this.y0+this.infinity_dist*(this.cos_p14*i-this.sin_p14*l*p)),a.x=o,a.y=P,a}function VE(a){var i,l,u,p,x,m;return a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,(i=Math.sqrt(a.x*a.x+a.y*a.y))?(p=Math.atan2(i,this.rc),l=Math.sin(p),u=Math.cos(p),m=Ca(u*this.sin_p14+a.y*l*this.cos_p14/i),x=Math.atan2(a.x*l,i*this.cos_p14*u-a.y*this.sin_p14*l),x=ye(this.long0+x)):(m=this.phic0,x=0),a.x=x,a.y=m,a}var qE=["gnom"];const $E={init:jE,forward:UE,inverse:VE,names:qE};function ZE(a,i){var l=1-(1-a*a)/(2*a)*Math.log((1-a)/(1+a));if(Math.abs(Math.abs(i)-l)<1e-6)return i<0?-1*Qt:Qt;for(var u=Math.asin(.5*i),p,x,m,o,P=0;P<30;P++)if(x=Math.sin(u),m=Math.cos(u),o=a*x,p=Math.pow(1-o*o,2)/(2*m)*(i/(1-a*a)-x/(1-o*o)+.5/a*Math.log((1-o)/(1+o))),u+=p,Math.abs(p)<=1e-10)return u;return NaN}function WE(){this.sphere||(this.k0=wn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function HE(a){var i=a.x,l=a.y,u,p,x=ye(i-this.long0);if(this.sphere)u=this.x0+this.a*x*Math.cos(this.lat_ts),p=this.y0+this.a*Math.sin(l)/Math.cos(this.lat_ts);else{var m=Pa(this.e,Math.sin(l));u=this.x0+this.a*this.k0*x,p=this.y0+this.a*m*.5/this.k0}return a.x=u,a.y=p,a}function XE(a){a.x-=this.x0,a.y-=this.y0;var i,l;return this.sphere?(i=ye(this.long0+a.x/this.a/Math.cos(this.lat_ts)),l=Math.asin(a.y/this.a*Math.cos(this.lat_ts))):(l=ZE(this.e,2*a.y*this.k0/this.a),i=ye(this.long0+a.x/(this.a*this.k0))),a.x=i,a.y=l,a}var KE=["cea"];const YE={init:WE,forward:HE,inverse:XE,names:KE};function JE(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function QE(a){var i=a.x,l=a.y,u=ye(i-this.long0),p=Ra(l-this.lat0);return a.x=this.x0+this.a*u*this.rc,a.y=this.y0+this.a*p,a}function tI(a){var i=a.x,l=a.y;return a.x=ye(this.long0+(i-this.x0)/(this.a*this.rc)),a.y=Ra(this.lat0+(l-this.y0)/this.a),a}var eI=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const iI={init:JE,forward:QE,inverse:tI,names:eI};var iy=20;function rI(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Wc(this.es),this.e1=Hc(this.es),this.e2=Xc(this.es),this.e3=Kc(this.es),this.ml0=this.a*as(this.e0,this.e1,this.e2,this.e3,this.lat0)}function sI(a){var i=a.x,l=a.y,u,p,x,m=ye(i-this.long0);if(x=m*Math.sin(l),this.sphere)Math.abs(l)<=fe?(u=this.a*m,p=-1*this.a*this.lat0):(u=this.a*Math.sin(x)/Math.tan(l),p=this.a*(Ra(l-this.lat0)+(1-Math.cos(x))/Math.tan(l)));else if(Math.abs(l)<=fe)u=this.a*m,p=-1*this.ml0;else{var o=Jm(this.a,this.e,Math.sin(l))/Math.tan(l);u=o*Math.sin(x),p=this.a*as(this.e0,this.e1,this.e2,this.e3,l)-this.ml0+o*(1-Math.cos(x))}return a.x=u+this.x0,a.y=p+this.y0,a}function nI(a){var i,l,u,p,x,m,o,P,A;if(u=a.x-this.x0,p=a.y-this.y0,this.sphere)if(Math.abs(p+this.a*this.lat0)<=fe)i=ye(u/this.a+this.long0),l=0;else{m=this.lat0+p/this.a,o=u*u/this.a/this.a+m*m,P=m;var O;for(x=iy;x;--x)if(O=Math.tan(P),A=-1*(m*(P*O+1)-P-.5*(P*P+o)*O)/((P-m)/O-1),P+=A,Math.abs(A)<=fe){l=P;break}i=ye(this.long0+Math.asin(u*Math.tan(P)/this.a)/Math.sin(l))}else if(Math.abs(p+this.ml0)<=fe)l=0,i=ye(this.long0+u/this.a);else{m=(this.ml0+p)/this.a,o=u*u/this.a/this.a+m*m,P=m;var D,k,B,V,K;for(x=iy;x;--x)if(K=this.e*Math.sin(P),D=Math.sqrt(1-K*K)*Math.tan(P),k=this.a*as(this.e0,this.e1,this.e2,this.e3,P),B=this.e0-2*this.e1*Math.cos(2*P)+4*this.e2*Math.cos(4*P)-6*this.e3*Math.cos(6*P),V=k/this.a,A=(m*(D*V+1)-V-.5*D*(V*V+o))/(this.es*Math.sin(2*P)*(V*V+o-2*m*V)/(4*D)+(m-V)*(D*B-2/Math.sin(2*P))-B),P-=A,Math.abs(A)<=fe){l=P;break}D=Math.sqrt(1-this.es*Math.pow(Math.sin(l),2))*Math.tan(l),i=ye(this.long0+Math.asin(u*D/this.a)/Math.sin(l))}return a.x=i,a.y=l,a}var aI=["Polyconic","American_Polyconic","poly"];const oI={init:rI,forward:sI,inverse:nI,names:aI};function lI(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function hI(a){var i,l=a.x,u=a.y,p=u-this.lat0,x=l-this.long0,m=p/Cc*1e-5,o=x,P=1,A=0;for(i=1;i<=10;i++)P=P*m,A=A+this.A[i]*P;var O=A,D=o,k=1,B=0,V,K,it=0,gt=0;for(i=1;i<=6;i++)V=k*O-B*D,K=B*O+k*D,k=V,B=K,it=it+this.B_re[i]*k-this.B_im[i]*B,gt=gt+this.B_im[i]*k+this.B_re[i]*B;return a.x=gt*this.a+this.x0,a.y=it*this.a+this.y0,a}function cI(a){var i,l=a.x,u=a.y,p=l-this.x0,x=u-this.y0,m=x/this.a,o=p/this.a,P=1,A=0,O,D,k=0,B=0;for(i=1;i<=6;i++)O=P*m-A*o,D=A*m+P*o,P=O,A=D,k=k+this.C_re[i]*P-this.C_im[i]*A,B=B+this.C_im[i]*P+this.C_re[i]*A;for(var V=0;V<this.iterations;V++){var K=k,it=B,gt,ct,Dt=m,Ct=o;for(i=2;i<=6;i++)gt=K*k-it*B,ct=it*k+K*B,K=gt,it=ct,Dt=Dt+(i-1)*(this.B_re[i]*K-this.B_im[i]*it),Ct=Ct+(i-1)*(this.B_im[i]*K+this.B_re[i]*it);K=1,it=0;var zt=this.B_re[1],ae=this.B_im[1];for(i=2;i<=6;i++)gt=K*k-it*B,ct=it*k+K*B,K=gt,it=ct,zt=zt+i*(this.B_re[i]*K-this.B_im[i]*it),ae=ae+i*(this.B_im[i]*K+this.B_re[i]*it);var ke=zt*zt+ae*ae;k=(Dt*zt+Ct*ae)/ke,B=(Ct*zt-Dt*ae)/ke}var de=k,Le=B,Xe=1,ne=0;for(i=1;i<=9;i++)Xe=Xe*de,ne=ne+this.D[i]*Xe;var le=this.lat0+ne*Cc*1e5,be=this.long0+Le;return a.x=be,a.y=le,a}var uI=["New_Zealand_Map_Grid","nzmg"];const dI={init:lI,forward:hI,inverse:cI,names:uI};function fI(){}function pI(a){var i=a.x,l=a.y,u=ye(i-this.long0),p=this.x0+this.a*u,x=this.y0+this.a*Math.log(Math.tan(Math.PI/4+l/2.5))*1.25;return a.x=p,a.y=x,a}function mI(a){a.x-=this.x0,a.y-=this.y0;var i=ye(this.long0+a.x/this.a),l=2.5*(Math.atan(Math.exp(.8*a.y/this.a))-Math.PI/4);return a.x=i,a.y=l,a}var gI=["Miller_Cylindrical","mill"];const _I={init:fI,forward:pI,inverse:mI,names:gI};var yI=20;function vI(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Wm(this.es)}function xI(a){var i,l,u=a.x,p=a.y;if(u=ye(u-this.long0),this.sphere){if(!this.m)p=this.n!==1?Math.asin(this.n*Math.sin(p)):p;else for(var x=this.n*Math.sin(p),m=yI;m;--m){var o=(this.m*p+Math.sin(p)-x)/(this.m+Math.cos(p));if(p-=o,Math.abs(o)<fe)break}i=this.a*this.C_x*u*(this.m+Math.cos(p)),l=this.a*this.C_y*p}else{var P=Math.sin(p),A=Math.cos(p);l=this.a*ih(p,P,A,this.en),i=this.a*u*A/Math.sqrt(1-this.es*P*P)}return a.x=i,a.y=l,a}function bI(a){var i,l,u,p;return a.x-=this.x0,u=a.x/this.a,a.y-=this.y0,i=a.y/this.a,this.sphere?(i/=this.C_y,u=u/(this.C_x*(this.m+Math.cos(i))),this.m?i=Ca((this.m*i+Math.sin(i))/this.n):this.n!==1&&(i=Ca(Math.sin(i)/this.n)),u=ye(u+this.long0),i=Ra(i)):(i=Hm(a.y/this.a,this.es,this.en),p=Math.abs(i),p<Qt?(p=Math.sin(i),l=this.long0+a.x*Math.sqrt(1-this.es*p*p)/(this.a*Math.cos(i)),u=ye(l)):p-fe<Qt&&(u=this.long0)),a.x=u,a.y=i,a}var wI=["Sinusoidal","sinu"];const MI={init:vI,forward:xI,inverse:bI,names:wI};function SI(){}function TI(a){for(var i=a.x,l=a.y,u=ye(i-this.long0),p=l,x=Math.PI*Math.sin(l);;){var m=-(p+Math.sin(p)-x)/(1+Math.cos(p));if(p+=m,Math.abs(m)<fe)break}p/=2,Math.PI/2-Math.abs(l)<fe&&(u=0);var o=.900316316158*this.a*u*Math.cos(p)+this.x0,P=1.4142135623731*this.a*Math.sin(p)+this.y0;return a.x=o,a.y=P,a}function PI(a){var i,l;a.x-=this.x0,a.y-=this.y0,l=a.y/(1.4142135623731*this.a),Math.abs(l)>.999999999999&&(l=.999999999999),i=Math.asin(l);var u=ye(this.long0+a.x/(.900316316158*this.a*Math.cos(i)));u<-Math.PI&&(u=-Math.PI),u>Math.PI&&(u=Math.PI),l=(2*i+Math.sin(2*i))/Math.PI,Math.abs(l)>1&&(l=1);var p=Math.asin(l);return a.x=u,a.y=p,a}var EI=["Mollweide","moll"];const II={init:SI,forward:TI,inverse:PI,names:EI};function CI(){Math.abs(this.lat1+this.lat2)<fe||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Wc(this.es),this.e1=Hc(this.es),this.e2=Xc(this.es),this.e3=Kc(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=wn(this.e,this.sinphi,this.cosphi),this.ml1=as(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<fe?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=wn(this.e,this.sinphi,this.cosphi),this.ml2=as(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=as(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function AI(a){var i=a.x,l=a.y,u;if(this.sphere)u=this.a*(this.g-l);else{var p=as(this.e0,this.e1,this.e2,this.e3,l);u=this.a*(this.g-p)}var x=this.ns*ye(i-this.long0),m=this.x0+u*Math.sin(x),o=this.y0+this.rh-u*Math.cos(x);return a.x=m,a.y=o,a}function RI(a){a.x-=this.x0,a.y=this.rh-a.y+this.y0;var i,l,u,p;this.ns>=0?(l=Math.sqrt(a.x*a.x+a.y*a.y),i=1):(l=-Math.sqrt(a.x*a.x+a.y*a.y),i=-1);var x=0;if(l!==0&&(x=Math.atan2(i*a.x,i*a.y)),this.sphere)return p=ye(this.long0+x/this.ns),u=Ra(this.g-l/this.a),a.x=p,a.y=u,a;var m=this.g-l/this.a;return u=Hd(m,this.e0,this.e1,this.e2,this.e3),p=ye(this.long0+x/this.ns),a.x=p,a.y=u,a}var kI=["Equidistant_Conic","eqdc"];const DI={init:CI,forward:AI,inverse:RI,names:kI};function zI(){this.R=this.a}function LI(a){var i=a.x,l=a.y,u=ye(i-this.long0),p,x;Math.abs(l)<=fe&&(p=this.x0+this.R*u,x=this.y0);var m=Ca(2*Math.abs(l/Math.PI));(Math.abs(u)<=fe||Math.abs(Math.abs(l)-Qt)<=fe)&&(p=this.x0,l>=0?x=this.y0+Math.PI*this.R*Math.tan(.5*m):x=this.y0+Math.PI*this.R*-Math.tan(.5*m));var o=.5*Math.abs(Math.PI/u-u/Math.PI),P=o*o,A=Math.sin(m),O=Math.cos(m),D=O/(A+O-1),k=D*D,B=D*(2/A-1),V=B*B,K=Math.PI*this.R*(o*(D-V)+Math.sqrt(P*(D-V)*(D-V)-(V+P)*(k-V)))/(V+P);u<0&&(K=-K),p=this.x0+K;var it=P+D;return K=Math.PI*this.R*(B*it-o*Math.sqrt((V+P)*(P+1)-it*it))/(V+P),l>=0?x=this.y0+K:x=this.y0-K,a.x=p,a.y=x,a}function OI(a){var i,l,u,p,x,m,o,P,A,O,D,k,B;return a.x-=this.x0,a.y-=this.y0,D=Math.PI*this.R,u=a.x/D,p=a.y/D,x=u*u+p*p,m=-Math.abs(p)*(1+x),o=m-2*p*p+u*u,P=-2*m+1+2*p*p+x*x,B=p*p/P+(2*o*o*o/P/P/P-9*m*o/P/P)/27,A=(m-o*o/3/P)/P,O=2*Math.sqrt(-A/3),D=3*B/A/O,Math.abs(D)>1&&(D>=0?D=1:D=-1),k=Math.acos(D)/3,a.y>=0?l=(-O*Math.cos(k+Math.PI/3)-o/3/P)*Math.PI:l=-(-O*Math.cos(k+Math.PI/3)-o/3/P)*Math.PI,Math.abs(u)<fe?i=this.long0:i=ye(this.long0+Math.PI*(x-1+Math.sqrt(1+2*(u*u-p*p)+x*x))/2/u),a.x=i,a.y=l,a}var FI=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const BI={init:zI,forward:LI,inverse:OI,names:FI};var qp={exports:{}},ry;function NI(){return ry||(ry=1,function(a){(function(i){var l={};l.Constants={},l.Math={},l.Accumulator={},function(u){u.WGS84={a:6378137,f:1/298.257223563},u.version={major:2,minor:1,patch:1},u.version_string="2.1.1"}(l.Constants),function(u){u.digits=53,u.epsilon=Math.pow(.5,u.digits-1),u.degree=Math.PI/180,u.sq=function(p){return p*p},u.hypot=function(p,x){return Math.sqrt(p*p+x*x)},u.cbrt=Math.cbrt||function(p){var x=Math.pow(Math.abs(p),.3333333333333333);return p>0?x:p<0?-x:p},u.log1p=Math.log1p||function(p){var x=1+p,m=x-1;return m===0?p:p*Math.log(x)/m},u.atanh=Math.atanh||function(p){var x=Math.abs(p);return x=u.log1p(2*x/(1-x))/2,p>0?x:p<0?-x:p},u.copysign=function(p,x){return Math.abs(p)*(x<0||x===0&&1/x<0?-1:1)},u.sum=function(p,x){var m=p+x,o=m-x,P=m-o,A;return o-=p,P-=x,A=m&&0-(o+P),{s:m,t:A}},u.polyval=function(p,x,m,o){for(var P=p<0?0:x[m++];--p>=0;)P=P*o+x[m++];return P},u.AngRound=function(p){var x=.0625,m=Math.abs(p);return m=m<x?x-(x-m):m,u.copysign(m,p)},u.remainder=function(p,x){return p%=x,p<-x/2?p+x:p<x/2?p:p-x},u.AngNormalize=function(p){var x=u.remainder(p,360);return Math.abs(x)===180?u.copysign(180,p):x},u.LatFix=function(p){return Math.abs(p)>90?NaN:p},u.AngDiff=function(p,x){var m=u.sum(u.remainder(-p,360),u.remainder(x,360)),o,P;return m=u.sum(u.remainder(m.s,360),m.t),o=m.s,P=m.t,(o===0||Math.abs(o)===180)&&(o=u.copysign(o,P===0?x-p:-P)),{d:o,e:P}},u.sincosd=function(p){var x,m,o,P,A,O,D;switch(x=p%360,o=Math.round(x/90),x-=90*o,m=x*this.degree,P=Math.sin(m),A=Math.cos(m),Math.abs(x)===45?(A=Math.sqrt(.5),P=u.copysign(A,m)):Math.abs(x)===30&&(A=Math.sqrt(.75),P=u.copysign(.5,m)),o&3){case 0:O=P,D=A;break;case 1:O=A,D=-P;break;case 2:O=-P,D=-A;break;default:O=-A,D=P;break}return D+=0,O===0&&(O=u.copysign(O,p)),{s:O,c:D}},u.sincosde=function(p,x){var m,o,P,A,O,D,k;switch(m=p%360,P=Math.round(m/90),m=u.AngRound(m-90*P+x),o=m*this.degree,A=Math.sin(o),O=Math.cos(o),Math.abs(m)===45?(O=Math.sqrt(.5),A=u.copysign(O,o)):Math.abs(m)===30&&(O=Math.sqrt(.75),A=u.copysign(.5,o)),P&3){case 0:D=A,k=O;break;case 1:D=O,k=-A;break;case 2:D=-A,k=-O;break;default:D=-O,k=A;break}return k+=0,D===0&&(D=u.copysign(D,p+x)),{s:D,c:k}},u.atan2d=function(p,x){var m=0,o;switch(Math.abs(p)>Math.abs(x)&&([p,x]=[x,p],m=2),u.copysign(1,x)<0&&(x=-x,++m),o=Math.atan2(p,x)/this.degree,m){case 1:o=u.copysign(180,p)-o;break;case 2:o=90-o;break;case 3:o=-90+o;break}return o}}(l.Math),function(u,p){u.Accumulator=function(x){this.Set(x)},u.Accumulator.prototype.Set=function(x){x||(x=0),x.constructor===u.Accumulator?(this._s=x._s,this._t=x._t):(this._s=x,this._t=0)},u.Accumulator.prototype.Add=function(x){var m=p.sum(x,this._t),o=p.sum(m.s,this._s);m=m.t,this._s=o.s,this._t=o.t,this._s===0?this._s=m:this._t+=m},u.Accumulator.prototype.Sum=function(x){var m;return x?(m=new u.Accumulator(this),m.Add(x),m._s):this._s},u.Accumulator.prototype.Negate=function(){this._s*=-1,this._t*=-1},u.Accumulator.prototype.Remainder=function(x){this._s=p.remainder(this._s,x),this.Add(0)}}(l.Accumulator,l.Math),l.Geodesic={},l.GeodesicLine={},l.PolygonArea={},function(u,p,x,m,o){var P=6,A=P,O=P,D=P,k=D,B,V,K=20,it=K+m.digits+10,gt=m.epsilon,ct=200*gt,Dt=Math.sqrt(gt),Ct=gt,zt=1e3*Dt,ae=0,ke=31,de=32640,Le,Xe,ne,le,be,qe,Ce,ui,yi;u.tiny_=Math.sqrt(Number.MIN_VALUE/Number.EPSILON),u.nC1_=P,u.nC1p_=P,u.nC2_=P,u.nC3_=P,u.nC4_=P,B=u.nC3_*(u.nC3_-1)/2,V=u.nC4_*(u.nC4_+1)/2,u.CAP_C1=1,u.CAP_C1p=2,u.CAP_C2=4,u.CAP_C3=8,u.CAP_C4=16,u.NONE=0,u.ARC=64,u.LATITUDE=128|ae,u.LONGITUDE=256|u.CAP_C3,u.AZIMUTH=512|ae,u.DISTANCE=1024|u.CAP_C1,u.STANDARD=u.LATITUDE|u.LONGITUDE|u.AZIMUTH|u.DISTANCE,u.DISTANCE_IN=2048|u.CAP_C1|u.CAP_C1p,u.REDUCEDLENGTH=4096|u.CAP_C1|u.CAP_C2,u.GEODESICSCALE=8192|u.CAP_C1|u.CAP_C2,u.AREA=16384|u.CAP_C4,u.ALL=de|ke,u.LONG_UNROLL=32768,u.OUT_MASK=de|u.LONG_UNROLL,u.SinCosSeries=function(Ft,qt,Wt,Ut){var Et=Ut.length,Gt=Et-(Ft?1:0),se=2*(Wt-qt)*(Wt+qt),Se=Gt&1?Ut[--Et]:0,Ee=0;for(Gt=Math.floor(Gt/2);Gt--;)Ee=se*Se-Ee+Ut[--Et],Se=se*Ee-Se+Ut[--Et];return Ft?2*qt*Wt*Se:Wt*(Se-Ee)},Le=function(Ft,qt){var Wt,Ut=m.sq(Ft),Et=m.sq(qt),Gt=(Ut+Et-1)/6,se,Se,Ee,_e,je,ue,De,Ve,ie,Me,Ke;return Et===0&&Gt<=0?Wt=0:(se=Ut*Et/4,Se=m.sq(Gt),Ee=Gt*Se,_e=se*(se+2*Ee),je=Gt,_e>=0?(ue=se+Ee,ue+=ue<0?-Math.sqrt(_e):Math.sqrt(_e),De=m.cbrt(ue),je+=De+(De!==0?Se/De:0)):(Ve=Math.atan2(Math.sqrt(-_e),-(se+Ee)),je+=2*Gt*Math.cos(Ve/3)),ie=Math.sqrt(m.sq(je)+Et),Me=je<0?Et/(ie-je):je+ie,Ke=(Me-Et)/(2*ie),Wt=Me/(Math.sqrt(Me+m.sq(Ke))+Ke)),Wt},Xe=[1,4,64,0,256],u.A1m1f=function(Ft){var qt=Math.floor(A/2),Wt=m.polyval(qt,Xe,0,m.sq(Ft))/Xe[qt+1];return(Wt+Ft)/(1-Ft)},ne=[-1,6,-16,32,-9,64,-128,2048,9,-16,768,3,-5,512,-7,1280,-7,2048],u.C1f=function(Ft,qt){var Wt=m.sq(Ft),Ut=Ft,Et=0,Gt,se;for(Gt=1;Gt<=u.nC1_;++Gt)se=Math.floor((u.nC1_-Gt)/2),qt[Gt]=Ut*m.polyval(se,ne,Et,Wt)/ne[Et+se+1],Et+=se+2,Ut*=Ft},le=[205,-432,768,1536,4005,-4736,3840,12288,-225,116,384,-7173,2695,7680,3467,7680,38081,61440],u.C1pf=function(Ft,qt){var Wt=m.sq(Ft),Ut=Ft,Et=0,Gt,se;for(Gt=1;Gt<=u.nC1p_;++Gt)se=Math.floor((u.nC1p_-Gt)/2),qt[Gt]=Ut*m.polyval(se,le,Et,Wt)/le[Et+se+1],Et+=se+2,Ut*=Ft},be=[-11,-28,-192,0,256],u.A2m1f=function(Ft){var qt=Math.floor(O/2),Wt=m.polyval(qt,be,0,m.sq(Ft))/be[qt+1];return(Wt-Ft)/(1+Ft)},qe=[1,2,16,32,35,64,384,2048,15,80,768,7,35,512,63,1280,77,2048],u.C2f=function(Ft,qt){var Wt=m.sq(Ft),Ut=Ft,Et=0,Gt,se;for(Gt=1;Gt<=u.nC2_;++Gt)se=Math.floor((u.nC2_-Gt)/2),qt[Gt]=Ut*m.polyval(se,qe,Et,Wt)/qe[Et+se+1],Et+=se+2,Ut*=Ft},u.Geodesic=function(Ft,qt){if(this.a=Ft,this.f=qt,this._f1=1-this.f,this._e2=this.f*(2-this.f),this._ep2=this._e2/m.sq(this._f1),this._n=this.f/(2-this.f),this._b=this.a*this._f1,this._c2=(m.sq(this.a)+m.sq(this._b)*(this._e2===0?1:(this._e2>0?m.atanh(Math.sqrt(this._e2)):Math.atan(Math.sqrt(-this._e2)))/Math.sqrt(Math.abs(this._e2))))/2,this._etol2=.1*Dt/Math.sqrt(Math.max(.001,Math.abs(this.f))*Math.min(1,1-this.f/2)/2),!(isFinite(this.a)&&this.a>0))throw new Error("Equatorial radius is not positive");if(!(isFinite(this._b)&&this._b>0))throw new Error("Polar semi-axis is not positive");this._A3x=new Array(k),this._C3x=new Array(B),this._C4x=new Array(V),this.A3coeff(),this.C3coeff(),this.C4coeff()},Ce=[-3,128,-2,-3,64,-1,-3,-1,16,3,-1,-2,8,1,-1,2,1,1],u.Geodesic.prototype.A3coeff=function(){var Ft=0,qt=0,Wt,Ut;for(Wt=D-1;Wt>=0;--Wt)Ut=Math.min(D-Wt-1,Wt),this._A3x[qt++]=m.polyval(Ut,Ce,Ft,this._n)/Ce[Ft+Ut+1],Ft+=Ut+2},ui=[3,128,2,5,128,-1,3,3,64,-1,0,1,8,-1,1,4,5,256,1,3,128,-3,-2,3,64,1,-3,2,32,7,512,-10,9,384,5,-9,5,192,7,512,-14,7,512,21,2560],u.Geodesic.prototype.C3coeff=function(){var Ft=0,qt=0,Wt,Ut,Et;for(Wt=1;Wt<u.nC3_;++Wt)for(Ut=u.nC3_-1;Ut>=Wt;--Ut)Et=Math.min(u.nC3_-Ut-1,Ut),this._C3x[qt++]=m.polyval(Et,ui,Ft,this._n)/ui[Ft+Et+1],Ft+=Et+2},yi=[97,15015,1088,156,45045,-224,-4784,1573,45045,-10656,14144,-4576,-858,45045,64,624,-4576,6864,-3003,15015,100,208,572,3432,-12012,30030,45045,1,9009,-2944,468,135135,5792,1040,-1287,135135,5952,-11648,9152,-2574,135135,-64,-624,4576,-6864,3003,135135,8,10725,1856,-936,225225,-8448,4992,-1144,225225,-1440,4160,-4576,1716,225225,-136,63063,1024,-208,105105,3584,-3328,1144,315315,-128,135135,-2560,832,405405,128,99099],u.Geodesic.prototype.C4coeff=function(){var Ft=0,qt=0,Wt,Ut,Et;for(Wt=0;Wt<u.nC4_;++Wt)for(Ut=u.nC4_-1;Ut>=Wt;--Ut)Et=u.nC4_-Ut-1,this._C4x[qt++]=m.polyval(Et,yi,Ft,this._n)/yi[Ft+Et+1],Ft+=Et+2},u.Geodesic.prototype.A3f=function(Ft){return m.polyval(k-1,this._A3x,0,Ft)},u.Geodesic.prototype.C3f=function(Ft,qt){var Wt=1,Ut=0,Et,Gt;for(Et=1;Et<u.nC3_;++Et)Gt=u.nC3_-Et-1,Wt*=Ft,qt[Et]=Wt*m.polyval(Gt,this._C3x,Ut,Ft),Ut+=Gt+1},u.Geodesic.prototype.C4f=function(Ft,qt){var Wt=1,Ut=0,Et,Gt;for(Et=0;Et<u.nC4_;++Et)Gt=u.nC4_-Et-1,qt[Et]=Wt*m.polyval(Gt,this._C4x,Ut,Ft),Ut+=Gt+1,Wt*=Ft},u.Geodesic.prototype.Lengths=function(Ft,qt,Wt,Ut,Et,Gt,se,Se,Ee,_e,je,ue,De){je&=u.OUT_MASK;var Ve={},ie=0,Me=0,Ke=0,ii=0,ee,he,we,Ne,Be;if(je&(u.DISTANCE|u.REDUCEDLENGTH|u.GEODESICSCALE)&&(Ke=u.A1m1f(Ft),u.C1f(Ft,ue),je&(u.REDUCEDLENGTH|u.GEODESICSCALE)&&(ii=u.A2m1f(Ft),u.C2f(Ft,De),ie=Ke-ii,ii=1+ii),Ke=1+Ke),je&u.DISTANCE)ee=u.SinCosSeries(!0,Gt,se,ue)-u.SinCosSeries(!0,Wt,Ut,ue),Ve.s12b=Ke*(qt+ee),je&(u.REDUCEDLENGTH|u.GEODESICSCALE)&&(he=u.SinCosSeries(!0,Gt,se,De)-u.SinCosSeries(!0,Wt,Ut,De),Me=ie*qt+(Ke*ee-ii*he));else if(je&(u.REDUCEDLENGTH|u.GEODESICSCALE)){for(we=1;we<=u.nC2_;++we)De[we]=Ke*ue[we]-ii*De[we];Me=ie*qt+(u.SinCosSeries(!0,Gt,se,De)-u.SinCosSeries(!0,Wt,Ut,De))}return je&u.REDUCEDLENGTH&&(Ve.m0=ie,Ve.m12b=Se*(Ut*Gt)-Et*(Wt*se)-Ut*se*Me),je&u.GEODESICSCALE&&(Ne=Ut*se+Wt*Gt,Be=this._ep2*(Ee-_e)*(Ee+_e)/(Et+Se),Ve.M12=Ne+(Be*Gt-se*Me)*Wt/Et,Ve.M21=Ne-(Be*Wt-Ut*Me)*Gt/Se),Ve},u.Geodesic.prototype.InverseStart=function(Ft,qt,Wt,Ut,Et,Gt,se,Se,Ee,_e,je){var ue={},De=Ut*qt-Et*Ft,Ve=Et*qt+Ut*Ft,ie,Me,Ke,ii,ee,he,we,Ne,Be,Oe,Ge,Ue,di,gi,Bi,Ye,_i,Si,Je,fi,_t,$,H;return ue.sig12=-1,ie=Ut*qt,ie+=Et*Ft,Me=Ve>=0&&De<.5&&Et*se<.5,Me?(ii=m.sq(Ft+Ut),ii/=ii+m.sq(qt+Et),ue.dnm=Math.sqrt(1+this._ep2*ii),Ke=se/(this._f1*ue.dnm),ee=Math.sin(Ke),he=Math.cos(Ke)):(ee=Se,he=Ee),ue.salp1=Et*ee,ue.calp1=he>=0?De+Et*Ft*m.sq(ee)/(1+he):ie-Et*Ft*m.sq(ee)/(1-he),Ne=m.hypot(ue.salp1,ue.calp1),Be=Ft*Ut+qt*Et*he,Me&&Ne<this._etol2?(ue.salp2=qt*ee,ue.calp2=De-qt*Ut*(he>=0?m.sq(ee)/(1+he):1-he),we=m.hypot(ue.salp2,ue.calp2),ue.salp2/=we,ue.calp2/=we,ue.sig12=Math.atan2(Ne,Be)):Math.abs(this._n)>.1||Be>=0||Ne>=6*Math.abs(this._n)*Math.PI*m.sq(qt)||(H=Math.atan2(-Se,-Ee),this.f>=0?(gi=m.sq(Ft)*this._ep2,Bi=gi/(2*(1+Math.sqrt(1+gi))+gi),Ue=this.f*qt*this.A3f(Bi)*Math.PI,di=Ue*qt,Oe=H/Ue,Ge=ie/di):(Ye=Et*qt-Ut*Ft,_i=Math.atan2(ie,Ye),fi=this.Lengths(this._n,Math.PI+_i,Ft,-qt,Wt,Ut,Et,Gt,qt,Et,u.REDUCEDLENGTH,_e,je),Si=fi.m12b,Je=fi.m0,Oe=-1+Si/(qt*Et*Je*Math.PI),di=Oe<-.01?ie/Oe:-this.f*m.sq(qt)*Math.PI,Ue=di/qt,Ge=se/Ue),Ge>-ct&&Oe>-1-zt?this.f>=0?(ue.salp1=Math.min(1,-Oe),ue.calp1=-Math.sqrt(1-m.sq(ue.salp1))):(ue.calp1=Math.max(Oe>-ct?0:-1,Oe),ue.salp1=Math.sqrt(1-m.sq(ue.calp1))):(_t=Le(Oe,Ge),$=Ue*(this.f>=0?-Oe*_t/(1+_t):-Ge*(1+_t)/_t),ee=Math.sin($),he=-Math.cos($),ue.salp1=Et*ee,ue.calp1=ie-Et*Ft*m.sq(ee)/(1-he))),ue.salp1<=0?(ue.salp1=1,ue.calp1=0):(we=m.hypot(ue.salp1,ue.calp1),ue.salp1/=we,ue.calp1/=we),ue},u.Geodesic.prototype.Lambda12=function(Ft,qt,Wt,Ut,Et,Gt,se,Se,Ee,_e,je,ue,De,Ve){var ie={},Me,Ke,ii,ee,he,we,Ne,Be,Oe,Ge,Ue,di,gi;return Ft===0&&Se===0&&(Se=-u.tiny_),Ke=se*qt,ii=m.hypot(Se,se*Ft),ie.ssig1=Ft,ee=Ke*Ft,ie.csig1=he=Se*qt,Me=m.hypot(ie.ssig1,ie.csig1),ie.ssig1/=Me,ie.csig1/=Me,ie.salp2=Et!==qt?Ke/Et:se,ie.calp2=Et!==qt||Math.abs(Ut)!==-Ft?Math.sqrt(m.sq(Se*qt)+(qt<-Ft?(Et-qt)*(qt+Et):(Ft-Ut)*(Ft+Ut)))/Et:Math.abs(Se),ie.ssig2=Ut,we=Ke*Ut,ie.csig2=Ne=ie.calp2*Et,Me=m.hypot(ie.ssig2,ie.csig2),ie.ssig2/=Me,ie.csig2/=Me,ie.sig12=Math.atan2(Math.max(0,ie.csig1*ie.ssig2-ie.ssig1*ie.csig2),ie.csig1*ie.csig2+ie.ssig1*ie.ssig2),Be=Math.max(0,he*we-ee*Ne),Oe=he*Ne+ee*we,Ue=Math.atan2(Be*_e-Oe*Ee,Oe*_e+Be*Ee),di=m.sq(ii)*this._ep2,ie.eps=di/(2*(1+Math.sqrt(1+di))+di),this.C3f(ie.eps,Ve),Ge=u.SinCosSeries(!0,ie.ssig2,ie.csig2,Ve)-u.SinCosSeries(!0,ie.ssig1,ie.csig1,Ve),ie.domg12=-this.f*this.A3f(ie.eps)*Ke*(ie.sig12+Ge),ie.lam12=Ue+ie.domg12,je&&(ie.calp2===0?ie.dlam12=-2*this._f1*Wt/Ft:(gi=this.Lengths(ie.eps,ie.sig12,ie.ssig1,ie.csig1,Wt,ie.ssig2,ie.csig2,Gt,qt,Et,u.REDUCEDLENGTH,ue,De),ie.dlam12=gi.m12b,ie.dlam12*=this._f1/(ie.calp2*Et))),ie},u.Geodesic.prototype.Inverse=function(Ft,qt,Wt,Ut,Et){var Gt,se;return Et||(Et=u.STANDARD),Et===u.LONG_UNROLL&&(Et|=u.STANDARD),Et&=u.OUT_MASK,Gt=this.InverseInt(Ft,qt,Wt,Ut,Et),se=Gt.vals,Et&u.AZIMUTH&&(se.azi1=m.atan2d(Gt.salp1,Gt.calp1),se.azi2=m.atan2d(Gt.salp2,Gt.calp2)),se},u.Geodesic.prototype.InverseInt=function(Ft,qt,Wt,Ut,Et){var Gt={},se,Se,Ee,_e,je,ue,De,Ve,ie,Me,Ke,ii,ee,he,we,Ne,Be,Oe,Ge,Ue,di,gi,Bi,Ye,_i,Si,Je,fi,_t,$,H,Y,nt,mt,vt,St,xt,Lt,Rt,wt,Nt,ft,re,Pe,oe,xe,ze,wi,mi,oi,Ae,ei,Ji,Xt,ir,ki,qr,ls,Yt,$e,Ze,ur,Fs,$r,We;if(Gt.lat1=Ft=m.LatFix(Ft),Gt.lat2=Wt=m.LatFix(Wt),Ft=m.AngRound(Ft),Wt=m.AngRound(Wt),se=m.AngDiff(qt,Ut),Se=se.e,se=se.d,Et&u.LONG_UNROLL?(Gt.lon1=qt,Gt.lon2=qt+se+Se):(Gt.lon1=m.AngNormalize(qt),Gt.lon2=m.AngNormalize(Ut)),Ee=m.copysign(1,se),se*=Ee,Se*=Ee,we=se*m.degree,_e=m.sincosde(se,Se),Ne=_e.s,Be=_e.c,Se=180-se-Se,je=Math.abs(Ft)<Math.abs(Wt)||isNaN(Wt)?-1:1,je<0&&(Ee*=-1,[Wt,Ft]=[Ft,Wt]),ue=m.copysign(1,-Ft),Ft*=ue,Wt*=ue,_e=m.sincosd(Ft),De=this._f1*_e.s,Ve=_e.c,_e=m.hypot(De,Ve),De/=_e,Ve/=_e,Ve=Math.max(u.tiny_,Ve),_e=m.sincosd(Wt),ie=this._f1*_e.s,Me=_e.c,_e=m.hypot(ie,Me),ie/=_e,Me/=_e,Me=Math.max(u.tiny_,Me),Ve<-De?Me===Ve&&(ie=m.copysign(De,ie)):Math.abs(ie)===-De&&(Me=Ve),ee=Math.sqrt(1+this._ep2*m.sq(De)),he=Math.sqrt(1+this._ep2*m.sq(ie)),Bi=new Array(u.nC1_+1),Ye=new Array(u.nC2_+1),_i=new Array(u.nC3_),Si=Ft===-90||Ne===0,Si&&(Ge=Be,Ue=Ne,di=1,gi=0,fi=De,_t=Ge*Ve,$=ie,H=di*Me,Oe=Math.atan2(Math.max(0,_t*$-fi*H),_t*H+fi*$),Je=this.Lengths(this._n,Oe,fi,_t,ee,$,H,he,Ve,Me,Et|u.DISTANCE|u.REDUCEDLENGTH,Bi,Ye),Ke=Je.s12b,ii=Je.m12b,Et&u.GEODESICSCALE&&(Gt.M12=Je.M12,Gt.M21=Je.M21),Oe<1||ii>=0?((Oe<3*u.tiny_||Oe<gt&&(Ke<0||ii<0))&&(Oe=ii=Ke=0),ii*=this._b,Ke*=this._b,Gt.a12=Oe/m.degree):Si=!1),qr=2,!Si&&De===0&&(this.f<=0||Se>=this.f*180))Ge=di=0,Ue=gi=1,Ke=this.a*we,Oe=nt=we/this._f1,ii=this._b*Math.sin(Oe),Et&u.GEODESICSCALE&&(Gt.M12=Gt.M21=Math.cos(Oe)),Gt.a12=se/this._f1;else if(!Si)if(Je=this.InverseStart(De,Ve,ee,ie,Me,he,we,Ne,Be,Bi,Ye),Oe=Je.sig12,Ue=Je.salp1,Ge=Je.calp1,Oe>=0)gi=Je.salp2,di=Je.calp2,mt=Je.dnm,Ke=Oe*this._b*mt,ii=m.sq(mt)*this._b*Math.sin(Oe/mt),Et&u.GEODESICSCALE&&(Gt.M12=Gt.M21=Math.cos(Oe/mt)),Gt.a12=Oe/m.degree,nt=we/(this._f1*mt);else{for(vt=0,St=u.tiny_,xt=1,Lt=u.tiny_,Rt=-1,wt=!1,Nt=!1;Je=this.Lambda12(De,Ve,ee,ie,Me,he,Ue,Ge,Ne,Be,vt<K,Bi,Ye,_i),ft=Je.lam12,gi=Je.salp2,di=Je.calp2,Oe=Je.sig12,fi=Je.ssig1,_t=Je.csig1,$=Je.ssig2,H=Je.csig2,Y=Je.eps,Yt=Je.domg12,re=Je.dlam12,!(Nt||!(Math.abs(ft)>=(wt?8:1)*gt)||vt==it);++vt){if(ft>0&&(vt<K||Ge/Ue>Rt/Lt)?(Lt=Ue,Rt=Ge):ft<0&&(vt<K||Ge/Ue<xt/St)&&(St=Ue,xt=Ge),vt<K&&re>0&&(Pe=-ft/re,Math.abs(Pe)<Math.PI&&(oe=Math.sin(Pe),xe=Math.cos(Pe),ze=Ue*xe+Ge*oe,ze>0))){Ge=Ge*xe-Ue*oe,Ue=ze,_e=m.hypot(Ue,Ge),Ue/=_e,Ge/=_e,wt=Math.abs(ft)<=16*gt;continue}Ue=(St+Lt)/2,Ge=(xt+Rt)/2,_e=m.hypot(Ue,Ge),Ue/=_e,Ge/=_e,wt=!1,Nt=Math.abs(St-Ue)+(xt-Ge)<Ct||Math.abs(Ue-Lt)+(Ge-Rt)<Ct}wi=Et|(Et&(u.REDUCEDLENGTH|u.GEODESICSCALE)?u.DISTANCE:u.NONE),Je=this.Lengths(Y,Oe,fi,_t,ee,$,H,he,Ve,Me,wi,Bi,Ye),Ke=Je.s12b,ii=Je.m12b,Et&u.GEODESICSCALE&&(Gt.M12=Je.M12,Gt.M21=Je.M21),ii*=this._b,Ke*=this._b,Gt.a12=Oe/m.degree,Et&u.AREA&&($r=Math.sin(Yt),We=Math.cos(Yt),qr=Ne*We-Be*$r,ls=Be*We+Ne*$r)}return Et&u.DISTANCE&&(Gt.s12=0+Ke),Et&u.REDUCEDLENGTH&&(Gt.m12=0+ii),Et&u.AREA&&(mi=Ue*Ve,oi=m.hypot(Ge,Ue*De),oi!==0&&mi!==0?(fi=De,_t=Ge*Ve,$=ie,H=di*Me,ei=m.sq(oi)*this._ep2,Y=ei/(2*(1+Math.sqrt(1+ei))+ei),Ji=m.sq(this.a)*oi*mi*this._e2,_e=m.hypot(fi,_t),fi/=_e,_t/=_e,_e=m.hypot($,H),$/=_e,H/=_e,Xt=new Array(u.nC4_),this.C4f(Y,Xt),ir=u.SinCosSeries(!1,fi,_t,Xt),ki=u.SinCosSeries(!1,$,H,Xt),Gt.S12=Ji*(ki-ir)):Gt.S12=0,!Si&&qr==2&&(qr=Math.sin(nt),ls=Math.cos(nt)),!Si&&ls>-.7071&&ie-De<1.75?(Yt=1+ls,$e=1+Ve,Ze=1+Me,Ae=2*Math.atan2(qr*(De*Ze+ie*$e),Yt*(De*ie+$e*Ze))):(ur=gi*Ge-di*Ue,Fs=di*Ge+gi*Ue,ur===0&&Fs<0&&(ur=u.tiny_*Ge,Fs=-1),Ae=Math.atan2(ur,Fs)),Gt.S12+=this._c2*Ae,Gt.S12*=je*Ee*ue,Gt.S12+=0),je<0&&([gi,Ue]=[Ue,gi],[di,Ge]=[Ge,di],Et&u.GEODESICSCALE&&([Gt.M21,Gt.M12]=[Gt.M12,Gt.M21])),Ue*=je*Ee,Ge*=je*ue,gi*=je*Ee,di*=je*ue,{vals:Gt,salp1:Ue,calp1:Ge,salp2:gi,calp2:di}},u.Geodesic.prototype.GenDirect=function(Ft,qt,Wt,Ut,Et,Gt){var se;return Gt?Gt===u.LONG_UNROLL&&(Gt|=u.STANDARD):Gt=u.STANDARD,Ut||(Gt|=u.DISTANCE_IN),se=new p.GeodesicLine(this,Ft,qt,Wt,Gt),se.GenPosition(Ut,Et,Gt)},u.Geodesic.prototype.Direct=function(Ft,qt,Wt,Ut,Et){return this.GenDirect(Ft,qt,Wt,!1,Ut,Et)},u.Geodesic.prototype.ArcDirect=function(Ft,qt,Wt,Ut,Et){return this.GenDirect(Ft,qt,Wt,!0,Ut,Et)},u.Geodesic.prototype.Line=function(Ft,qt,Wt,Ut){return new p.GeodesicLine(this,Ft,qt,Wt,Ut)},u.Geodesic.prototype.DirectLine=function(Ft,qt,Wt,Ut,Et){return this.GenDirectLine(Ft,qt,Wt,!1,Ut,Et)},u.Geodesic.prototype.ArcDirectLine=function(Ft,qt,Wt,Ut,Et){return this.GenDirectLine(Ft,qt,Wt,!0,Ut,Et)},u.Geodesic.prototype.GenDirectLine=function(Ft,qt,Wt,Ut,Et,Gt){var se;return Gt||(Gt=u.STANDARD|u.DISTANCE_IN),Ut||(Gt|=u.DISTANCE_IN),se=new p.GeodesicLine(this,Ft,qt,Wt,Gt),se.GenSetDistance(Ut,Et),se},u.Geodesic.prototype.InverseLine=function(Ft,qt,Wt,Ut,Et){var Gt,se,Se;return Et||(Et=u.STANDARD|u.DISTANCE_IN),Gt=this.InverseInt(Ft,qt,Wt,Ut,u.ARC),Se=m.atan2d(Gt.salp1,Gt.calp1),Et&(u.OUT_MASK&u.DISTANCE_IN)&&(Et|=u.DISTANCE),se=new p.GeodesicLine(this,Ft,qt,Se,Et,Gt.salp1,Gt.calp1),se.SetArc(Gt.vals.a12),se},u.Geodesic.prototype.Polygon=function(Ft){return new x.PolygonArea(this,Ft)},u.WGS84=new u.Geodesic(o.WGS84.a,o.WGS84.f)}(l.Geodesic,l.GeodesicLine,l.PolygonArea,l.Math,l.Constants),function(u,p,x){p.GeodesicLine=function(m,o,P,A,O,D,k){var B,V,K,it,gt,ct;O||(O=u.STANDARD|u.DISTANCE_IN),this.a=m.a,this.f=m.f,this._b=m._b,this._c2=m._c2,this._f1=m._f1,this.caps=O|u.LATITUDE|u.AZIMUTH|u.LONG_UNROLL,this.lat1=x.LatFix(o),this.lon1=P,typeof D>"u"||typeof k>"u"?(this.azi1=x.AngNormalize(A),B=x.sincosd(x.AngRound(this.azi1)),this.salp1=B.s,this.calp1=B.c):(this.azi1=A,this.salp1=D,this.calp1=k),B=x.sincosd(x.AngRound(this.lat1)),K=this._f1*B.s,V=B.c,B=x.hypot(K,V),K/=B,V/=B,V=Math.max(u.tiny_,V),this._dn1=Math.sqrt(1+m._ep2*x.sq(K)),this._salp0=this.salp1*V,this._calp0=x.hypot(this.calp1,this.salp1*K),this._ssig1=K,this._somg1=this._salp0*K,this._csig1=this._comg1=K!==0||this.calp1!==0?V*this.calp1:1,B=x.hypot(this._ssig1,this._csig1),this._ssig1/=B,this._csig1/=B,this._k2=x.sq(this._calp0)*m._ep2,it=this._k2/(2*(1+Math.sqrt(1+this._k2))+this._k2),this.caps&u.CAP_C1&&(this._A1m1=u.A1m1f(it),this._C1a=new Array(u.nC1_+1),u.C1f(it,this._C1a),this._B11=u.SinCosSeries(!0,this._ssig1,this._csig1,this._C1a),gt=Math.sin(this._B11),ct=Math.cos(this._B11),this._stau1=this._ssig1*ct+this._csig1*gt,this._ctau1=this._csig1*ct-this._ssig1*gt),this.caps&u.CAP_C1p&&(this._C1pa=new Array(u.nC1p_+1),u.C1pf(it,this._C1pa)),this.caps&u.CAP_C2&&(this._A2m1=u.A2m1f(it),this._C2a=new Array(u.nC2_+1),u.C2f(it,this._C2a),this._B21=u.SinCosSeries(!0,this._ssig1,this._csig1,this._C2a)),this.caps&u.CAP_C3&&(this._C3a=new Array(u.nC3_),m.C3f(it,this._C3a),this._A3c=-this.f*this._salp0*m.A3f(it),this._B31=u.SinCosSeries(!0,this._ssig1,this._csig1,this._C3a)),this.caps&u.CAP_C4&&(this._C4a=new Array(u.nC4_),m.C4f(it,this._C4a),this._A4=x.sq(this.a)*this._calp0*this._salp0*m._e2,this._B41=u.SinCosSeries(!1,this._ssig1,this._csig1,this._C4a)),this.a13=this.s13=NaN},p.GeodesicLine.prototype.GenPosition=function(m,o,P){var A={},O,D,k,B,V,K,it,gt,ct,Dt,Ct,zt,ae,ke,de,Le,Xe,ne,le,be,qe,Ce,ui,yi,Ft,qt,Wt,Ut,Et;return P?P===u.LONG_UNROLL&&(P|=u.STANDARD):P=u.STANDARD,P&=this.caps&u.OUT_MASK,A.lat1=this.lat1,A.azi1=this.azi1,A.lon1=P&u.LONG_UNROLL?this.lon1:x.AngNormalize(this.lon1),m?A.a12=o:A.s12=o,m||this.caps&u.DISTANCE_IN&u.OUT_MASK?(B=0,V=0,m?(O=o*x.degree,qt=x.sincosd(o),D=qt.s,k=qt.c):(gt=o/(this._b*(1+this._A1m1)),ct=Math.sin(gt),Dt=Math.cos(gt),B=-u.SinCosSeries(!0,this._stau1*Dt+this._ctau1*ct,this._ctau1*Dt-this._stau1*ct,this._C1pa),O=gt-(B-this._B11),D=Math.sin(O),k=Math.cos(O),Math.abs(this.f)>.01&&(K=this._ssig1*k+this._csig1*D,it=this._csig1*k-this._ssig1*D,B=u.SinCosSeries(!0,K,it,this._C1a),Ct=(1+this._A1m1)*(O+(B-this._B11))-o/this._b,O=O-Ct/Math.sqrt(1+this._k2*x.sq(K)),D=Math.sin(O),k=Math.cos(O))),K=this._ssig1*k+this._csig1*D,it=this._csig1*k-this._ssig1*D,Ce=Math.sqrt(1+this._k2*x.sq(K)),P&(u.DISTANCE|u.REDUCEDLENGTH|u.GEODESICSCALE)&&((m||Math.abs(this.f)>.01)&&(B=u.SinCosSeries(!0,K,it,this._C1a)),V=(1+this._A1m1)*(B-this._B11)),Le=this._calp0*K,Xe=x.hypot(this._salp0,this._calp0*it),Xe===0&&(Xe=it=u.tiny_),be=this._salp0,qe=this._calp0*it,m&&P&u.DISTANCE&&(A.s12=this._b*((1+this._A1m1)*O+V)),P&u.LONGITUDE&&(ne=this._salp0*K,le=it,de=x.copysign(1,this._salp0),zt=P&u.LONG_UNROLL?de*(O-(Math.atan2(K,it)-Math.atan2(this._ssig1,this._csig1))+(Math.atan2(de*ne,le)-Math.atan2(de*this._somg1,this._comg1))):Math.atan2(ne*this._comg1-le*this._somg1,le*this._comg1+ne*this._somg1),ae=zt+this._A3c*(O+(u.SinCosSeries(!0,K,it,this._C3a)-this._B31)),ke=ae/x.degree,A.lon2=P&u.LONG_UNROLL?this.lon1+ke:x.AngNormalize(x.AngNormalize(this.lon1)+x.AngNormalize(ke))),P&u.LATITUDE&&(A.lat2=x.atan2d(Le,this._f1*Xe)),P&u.AZIMUTH&&(A.azi2=x.atan2d(be,qe)),P&(u.REDUCEDLENGTH|u.GEODESICSCALE)&&(ui=u.SinCosSeries(!0,K,it,this._C2a),yi=(1+this._A2m1)*(ui-this._B21),Ft=(this._A1m1-this._A2m1)*O+(V-yi),P&u.REDUCEDLENGTH&&(A.m12=this._b*(Ce*(this._csig1*K)-this._dn1*(this._ssig1*it)-this._csig1*it*Ft)),P&u.GEODESICSCALE&&(qt=this._k2*(K-this._ssig1)*(K+this._ssig1)/(this._dn1+Ce),A.M12=k+(qt*K-it*Ft)*this._ssig1/this._dn1,A.M21=k-(qt*this._ssig1-this._csig1*Ft)*K/Ce)),P&u.AREA&&(Wt=u.SinCosSeries(!1,K,it,this._C4a),this._calp0===0||this._salp0===0?(Ut=be*this.calp1-qe*this.salp1,Et=qe*this.calp1+be*this.salp1):(Ut=this._calp0*this._salp0*(k<=0?this._csig1*(1-k)+D*this._ssig1:D*(this._csig1*D/(1+k)+this._ssig1)),Et=x.sq(this._salp0)+x.sq(this._calp0)*this._csig1*it),A.S12=this._c2*Math.atan2(Ut,Et)+this._A4*(Wt-this._B41)),m||(A.a12=O/x.degree),A):(A.a12=NaN,A)},p.GeodesicLine.prototype.Position=function(m,o){return this.GenPosition(!1,m,o)},p.GeodesicLine.prototype.ArcPosition=function(m,o){return this.GenPosition(!0,m,o)},p.GeodesicLine.prototype.GenSetDistance=function(m,o){m?this.SetArc(o):this.SetDistance(o)},p.GeodesicLine.prototype.SetDistance=function(m){var o;this.s13=m,o=this.GenPosition(!1,this.s13,u.ARC),this.a13=0+o.a12},p.GeodesicLine.prototype.SetArc=function(m){var o;this.a13=m,o=this.GenPosition(!0,this.a13,u.DISTANCE),this.s13=0+o.s12}}(l.Geodesic,l.GeodesicLine,l.Math),function(u,p,x,m){var o,P,A,O;o=function(D,k){var B=x.AngDiff(D,k).d;return D=x.AngNormalize(D),k=x.AngNormalize(k),B>0&&(D<0&&k>=0||D>0&&k===0)?1:B<0&&D>=0&&k<0?-1:0},P=function(D,k){return D=D%720,k=k%720,(0<=k&&k<360||k<-360?0:1)-(0<=D&&D<360||D<-360?0:1)},A=function(D,k,B,V,K){return D.Remainder(k),B&1&&D.Add((D.Sum()<0?1:-1)*k/2),V||D.Negate(),K?D.Sum()>k/2?D.Add(-k):D.Sum()<=-k/2&&D.Add(+k):D.Sum()>=k?D.Add(-k):D.Sum()<0&&D.Add(+k),0+D.Sum()},O=function(D,k,B,V,K){return D=x.remainder(D,k),B&1&&(D+=(D<0?1:-1)*k/2),V||(D*=-1),K?D>k/2?D-=k:D<=-k/2&&(D+=k):D>=k?D-=k:D<0&&(D+=k),0+D},u.PolygonArea=function(D,k){this._geod=D,this.a=this._geod.a,this.f=this._geod.f,this._area0=4*Math.PI*D._c2,this.polyline=k||!1,this._mask=p.LATITUDE|p.LONGITUDE|p.DISTANCE|(this.polyline?p.NONE:p.AREA|p.LONG_UNROLL),this.polyline||(this._areasum=new m.Accumulator(0)),this._perimetersum=new m.Accumulator(0),this.Clear()},u.PolygonArea.prototype.Clear=function(){this.num=0,this._crossings=0,this.polyline||this._areasum.Set(0),this._perimetersum.Set(0),this._lat0=this._lon0=this.lat=this.lon=NaN},u.PolygonArea.prototype.AddPoint=function(D,k){var B;this.num===0?(this._lat0=this.lat=D,this._lon0=this.lon=k):(B=this._geod.Inverse(this.lat,this.lon,D,k,this._mask),this._perimetersum.Add(B.s12),this.polyline||(this._areasum.Add(B.S12),this._crossings+=o(this.lon,k)),this.lat=D,this.lon=k),++this.num},u.PolygonArea.prototype.AddEdge=function(D,k){var B;this.num&&(B=this._geod.Direct(this.lat,this.lon,D,k,this._mask),this._perimetersum.Add(k),this.polyline||(this._areasum.Add(B.S12),this._crossings+=P(this.lon,B.lon2)),this.lat=B.lat2,this.lon=B.lon2),++this.num},u.PolygonArea.prototype.Compute=function(D,k){var B={number:this.num},V,K;return this.num<2?(B.perimeter=0,this.polyline||(B.area=0),B):this.polyline?(B.perimeter=this._perimetersum.Sum(),B):(V=this._geod.Inverse(this.lat,this.lon,this._lat0,this._lon0,this._mask),B.perimeter=this._perimetersum.Sum(V.s12),K=new m.Accumulator(this._areasum),K.Add(V.S12),B.area=A(K,this._area0,this._crossings+o(this.lon,this._lon0),D,k),B)},u.PolygonArea.prototype.TestPoint=function(D,k,B,V){var K={number:this.num+1},it,gt,ct,Dt;if(this.num===0)return K.perimeter=0,this.polyline||(K.area=0),K;for(K.perimeter=this._perimetersum.Sum(),gt=this.polyline?0:this._areasum.Sum(),ct=this._crossings,Dt=0;Dt<(this.polyline?1:2);++Dt)it=this._geod.Inverse(Dt===0?this.lat:D,Dt===0?this.lon:k,Dt!==0?this._lat0:D,Dt!==0?this._lon0:k,this._mask),K.perimeter+=it.s12,this.polyline||(gt+=it.S12,ct+=o(Dt===0?this.lon:k,Dt!==0?this._lon0:k));return this.polyline||(K.area=O(gt,this._area0,ct,B,V)),K},u.PolygonArea.prototype.TestEdge=function(D,k,B,V){var K={number:this.num?this.num+1:0},it,gt,ct;return this.num===0||(K.perimeter=this._perimetersum.Sum()+k,this.polyline)||(gt=this._areasum.Sum(),ct=this._crossings,it=this._geod.Direct(this.lat,this.lon,D,k,this._mask),gt+=it.S12,ct+=P(this.lon,it.lon2),ct+=o(it.lon2,this._lon0),it=this._geod.Inverse(it.lat2,it.lon2,this._lat0,this._lon0,this._mask),K.perimeter+=it.s12,gt+=it.S12,K.area=O(gt,this._area0,ct,B,V)),K}}(l.PolygonArea,l.Geodesic,l.Math,l.Accumulator),i(l)})(function(i){a.exports?a.exports=i:window.geodesic=i})}(qp)),qp.exports}var GI=NI();function jI(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.g=new GI.Geodesic.Geodesic(this.a,this.es/(1+Math.sqrt(1-this.es)))}function UI(a){var i=a.x,l=a.y,u=Math.sin(a.y),p=Math.cos(a.y),x=ye(i-this.long0),m,o,P,A,O,D,k,B,V,K,it,gt,ct,Dt,Ct;return this.sphere?Math.abs(this.sin_p12-1)<=fe?(a.x=this.x0+this.a*(Qt-l)*Math.sin(x),a.y=this.y0-this.a*(Qt-l)*Math.cos(x),a):Math.abs(this.sin_p12+1)<=fe?(a.x=this.x0+this.a*(Qt+l)*Math.sin(x),a.y=this.y0+this.a*(Qt+l)*Math.cos(x),a):(V=this.sin_p12*u+this.cos_p12*p*Math.cos(x),k=Math.acos(V),B=k?k/Math.sin(k):1,a.x=this.x0+this.a*B*p*Math.sin(x),a.y=this.y0+this.a*B*(this.cos_p12*u-this.sin_p12*p*Math.cos(x)),a):(m=Wc(this.es),o=Hc(this.es),P=Xc(this.es),A=Kc(this.es),Math.abs(this.sin_p12-1)<=fe?(O=this.a*as(m,o,P,A,Qt),D=this.a*as(m,o,P,A,l),a.x=this.x0+(O-D)*Math.sin(x),a.y=this.y0-(O-D)*Math.cos(x),a):Math.abs(this.sin_p12+1)<=fe?(O=this.a*as(m,o,P,A,Qt),D=this.a*as(m,o,P,A,l),a.x=this.x0+(O+D)*Math.sin(x),a.y=this.y0+(O+D)*Math.cos(x),a):Math.abs(i)<fe&&Math.abs(l-this.lat0)<fe?(a.x=a.y=0,a):(K=this.lat0/Fi,it=this.long0/Fi,gt=l/Fi,ct=i/Fi,Dt=this.g.Inverse(K,it,gt,ct,this.g.AZIMUTH),Ct=Dt.azi1*Fi,a.x=Dt.s12*Math.sin(Ct),a.y=Dt.s12*Math.cos(Ct),a))}function VI(a){a.x-=this.x0,a.y-=this.y0;var i,l,u,p,x,m,o,P,A,O,D,k,B,V,K,it,gt,ct;return this.sphere?(i=Math.sqrt(a.x*a.x+a.y*a.y),i>2*Qt*this.a?void 0:(l=i/this.a,u=Math.sin(l),p=Math.cos(l),x=this.long0,Math.abs(i)<=fe?m=this.lat0:(m=Ca(p*this.sin_p12+a.y*u*this.cos_p12/i),o=Math.abs(this.lat0)-Qt,Math.abs(o)<=fe?this.lat0>=0?x=ye(this.long0+Math.atan2(a.x,-a.y)):x=ye(this.long0-Math.atan2(-a.x,a.y)):x=ye(this.long0+Math.atan2(a.x*u,i*this.cos_p12*p-a.y*this.sin_p12*u))),a.x=x,a.y=m,a)):(P=Wc(this.es),A=Hc(this.es),O=Xc(this.es),D=Kc(this.es),Math.abs(this.sin_p12-1)<=fe?(k=this.a*as(P,A,O,D,Qt),i=Math.sqrt(a.x*a.x+a.y*a.y),B=k-i,m=Hd(B/this.a,P,A,O,D),x=ye(this.long0+Math.atan2(a.x,-1*a.y)),a.x=x,a.y=m,a):Math.abs(this.sin_p12+1)<=fe?(k=this.a*as(P,A,O,D,Qt),i=Math.sqrt(a.x*a.x+a.y*a.y),B=i-k,m=Hd(B/this.a,P,A,O,D),x=ye(this.long0+Math.atan2(a.x,a.y)),a.x=x,a.y=m,a):(V=this.lat0/Fi,K=this.long0/Fi,it=Math.atan2(a.x,a.y)/Fi,gt=Math.sqrt(a.x*a.x+a.y*a.y),ct=this.g.Direct(V,K,it,gt,this.g.STANDARD),a.x=ct.lon2*Fi,a.y=ct.lat2*Fi,a))}var qI=["Azimuthal_Equidistant","aeqd"];const $I={init:jI,forward:UI,inverse:VI,names:qI};function ZI(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function WI(a){var i,l,u,p,x,m,o,P,A=a.x,O=a.y;return u=ye(A-this.long0),i=Math.sin(O),l=Math.cos(O),p=Math.cos(u),m=this.sin_p14*i+this.cos_p14*l*p,x=1,(m>0||Math.abs(m)<=fe)&&(o=this.a*x*l*Math.sin(u),P=this.y0+this.a*x*(this.cos_p14*i-this.sin_p14*l*p)),a.x=o,a.y=P,a}function HI(a){var i,l,u,p,x,m,o;return a.x-=this.x0,a.y-=this.y0,i=Math.sqrt(a.x*a.x+a.y*a.y),l=Ca(i/this.a),u=Math.sin(l),p=Math.cos(l),m=this.long0,Math.abs(i)<=fe?(o=this.lat0,a.x=m,a.y=o,a):(o=Ca(p*this.sin_p14+a.y*u*this.cos_p14/i),x=Math.abs(this.lat0)-Qt,Math.abs(x)<=fe?(this.lat0>=0?m=ye(this.long0+Math.atan2(a.x,-a.y)):m=ye(this.long0-Math.atan2(-a.x,a.y)),a.x=m,a.y=o,a):(m=ye(this.long0+Math.atan2(a.x*u,i*this.cos_p14*p-a.y*this.sin_p14*u)),a.x=m,a.y=o,a))}var XI=["ortho"];const KI={init:ZI,forward:WI,inverse:HI,names:XI};var er={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Ri={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function YI(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Qt-Ai/2?this.face=er.TOP:this.lat0<=-(Qt-Ai/2)?this.face=er.BOTTOM:Math.abs(this.long0)<=Ai?this.face=er.FRONT:Math.abs(this.long0)<=Qt+Ai?this.face=this.long0>0?er.RIGHT:er.LEFT:this.face=er.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function JI(a){var i={x:0,y:0},l,u,p,x,m,o,P={value:0};if(a.x-=this.long0,this.es!==0?l=Math.atan(this.one_minus_f_squared*Math.tan(a.y)):l=a.y,u=a.x,this.face===er.TOP)x=Qt-l,u>=Ai&&u<=Qt+Ai?(P.value=Ri.AREA_0,p=u-Qt):u>Qt+Ai||u<=-(Qt+Ai)?(P.value=Ri.AREA_1,p=u>0?u-Ur:u+Ur):u>-(Qt+Ai)&&u<=-Ai?(P.value=Ri.AREA_2,p=u+Qt):(P.value=Ri.AREA_3,p=u);else if(this.face===er.BOTTOM)x=Qt+l,u>=Ai&&u<=Qt+Ai?(P.value=Ri.AREA_0,p=-u+Qt):u<Ai&&u>=-Ai?(P.value=Ri.AREA_1,p=-u):u<-Ai&&u>=-(Qt+Ai)?(P.value=Ri.AREA_2,p=-u-Qt):(P.value=Ri.AREA_3,p=u>0?-u+Ur:-u-Ur);else{var A,O,D,k,B,V,K;this.face===er.RIGHT?u=Wl(u,+Qt):this.face===er.BACK?u=Wl(u,3.14159265359):this.face===er.LEFT&&(u=Wl(u,-Qt)),k=Math.sin(l),B=Math.cos(l),V=Math.sin(u),K=Math.cos(u),A=B*K,O=B*V,D=k,this.face===er.FRONT?(x=Math.acos(A),p=Md(x,D,O,P)):this.face===er.RIGHT?(x=Math.acos(O),p=Md(x,D,-A,P)):this.face===er.BACK?(x=Math.acos(-A),p=Md(x,D,-O,P)):this.face===er.LEFT?(x=Math.acos(-O),p=Md(x,D,A,P)):(x=p=0,P.value=Ri.AREA_0)}return o=Math.atan(12/Ur*(p+Math.acos(Math.sin(p)*Math.cos(Ai))-Qt)),m=Math.sqrt((1-Math.cos(x))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(p))))),P.value===Ri.AREA_1?o+=Qt:P.value===Ri.AREA_2?o+=Ur:P.value===Ri.AREA_3&&(o+=1.5*Ur),i.x=m*Math.cos(o),i.y=m*Math.sin(o),i.x=i.x*this.a+this.x0,i.y=i.y*this.a+this.y0,a.x=i.x,a.y=i.y,a}function QI(a){var i={lam:0,phi:0},l,u,p,x,m,o,P,A,O,D={value:0};if(a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,u=Math.atan(Math.sqrt(a.x*a.x+a.y*a.y)),l=Math.atan2(a.y,a.x),a.x>=0&&a.x>=Math.abs(a.y)?D.value=Ri.AREA_0:a.y>=0&&a.y>=Math.abs(a.x)?(D.value=Ri.AREA_1,l-=Qt):a.x<0&&-a.x>=Math.abs(a.y)?(D.value=Ri.AREA_2,l=l<0?l+Ur:l-Ur):(D.value=Ri.AREA_3,l+=Qt),O=Ur/12*Math.tan(l),m=Math.sin(O)/(Math.cos(O)-1/Math.sqrt(2)),o=Math.atan(m),p=Math.cos(l),x=Math.tan(u),P=1-p*p*x*x*(1-Math.cos(Math.atan(1/Math.cos(o)))),P<-1?P=-1:P>1&&(P=1),this.face===er.TOP)A=Math.acos(P),i.phi=Qt-A,D.value===Ri.AREA_0?i.lam=o+Qt:D.value===Ri.AREA_1?i.lam=o<0?o+Ur:o-Ur:D.value===Ri.AREA_2?i.lam=o-Qt:i.lam=o;else if(this.face===er.BOTTOM)A=Math.acos(P),i.phi=A-Qt,D.value===Ri.AREA_0?i.lam=-o+Qt:D.value===Ri.AREA_1?i.lam=-o:D.value===Ri.AREA_2?i.lam=-o-Qt:i.lam=o<0?-o-Ur:-o+Ur;else{var k,B,V;k=P,O=k*k,O>=1?V=0:V=Math.sqrt(1-O)*Math.sin(o),O+=V*V,O>=1?B=0:B=Math.sqrt(1-O),D.value===Ri.AREA_1?(O=B,B=-V,V=O):D.value===Ri.AREA_2?(B=-B,V=-V):D.value===Ri.AREA_3&&(O=B,B=V,V=-O),this.face===er.RIGHT?(O=k,k=-B,B=O):this.face===er.BACK?(k=-k,B=-B):this.face===er.LEFT&&(O=k,k=B,B=-O),i.phi=Math.acos(-V)-Qt,i.lam=Math.atan2(B,k),this.face===er.RIGHT?i.lam=Wl(i.lam,-Qt):this.face===er.BACK?i.lam=Wl(i.lam,-3.14159265359):this.face===er.LEFT&&(i.lam=Wl(i.lam,+Qt))}if(this.es!==0){var K,it,gt;K=i.phi<0?1:0,it=Math.tan(i.phi),gt=this.b/Math.sqrt(it*it+this.one_minus_f_squared),i.phi=Math.atan(Math.sqrt(this.a*this.a-gt*gt)/(this.one_minus_f*gt)),K&&(i.phi=-i.phi)}return i.lam+=this.long0,a.x=i.lam,a.y=i.phi,a}function Md(a,i,l,u){var p;return a<fe?(u.value=Ri.AREA_0,p=0):(p=Math.atan2(i,l),Math.abs(p)<=Ai?u.value=Ri.AREA_0:p>Ai&&p<=Qt+Ai?(u.value=Ri.AREA_1,p-=Qt):p>Qt+Ai||p<=-(Qt+Ai)?(u.value=Ri.AREA_2,p=p>=0?p-Ur:p+Ur):(u.value=Ri.AREA_3,p+=Qt)),p}function Wl(a,i){var l=a+i;return l<-3.14159265359?l+=Fc:l>3.14159265359&&(l-=Fc),l}var tC=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const eC={init:YI,forward:JI,inverse:QI,names:tC};var cm=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],bc=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],k1=.8487,D1=1.3523,z1=xn/5,iC=1/z1,Gl=18,Xd=function(a,i){return a[0]+i*(a[1]+i*(a[2]+i*a[3]))},rC=function(a,i){return a[1]+i*(2*a[2]+i*3*a[3])};function sC(a,i,l,u){for(var p=i;u;--u){var x=a(p);if(p-=x,Math.abs(x)<l)break}return p}function nC(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function aC(a){var i=ye(a.x-this.long0),l=Math.abs(a.y),u=Math.floor(l*z1);u<0?u=0:u>=Gl&&(u=Gl-1),l=xn*(l-iC*u);var p={x:Xd(cm[u],l)*i,y:Xd(bc[u],l)};return a.y<0&&(p.y=-p.y),p.x=p.x*this.a*k1+this.x0,p.y=p.y*this.a*D1+this.y0,p}function oC(a){var i={x:(a.x-this.x0)/(this.a*k1),y:Math.abs(a.y-this.y0)/(this.a*D1)};if(i.y>=1)i.x/=cm[Gl][0],i.y=a.y<0?-Qt:Qt;else{var l=Math.floor(i.y*Gl);for(l<0?l=0:l>=Gl&&(l=Gl-1);;)if(bc[l][0]>i.y)--l;else if(bc[l+1][0]<=i.y)++l;else break;var u=bc[l],p=5*(i.y-u[0])/(bc[l+1][0]-u[0]);p=sC(function(x){return(Xd(u,x)-i.y)/rC(u,x)},p,fe,100),i.x/=Xd(cm[l],p),i.y=(5*l+p)*Fi,a.y<0&&(i.y=-i.y)}return i.x=ye(i.x+this.long0),i}var lC=["Robinson","robin"];const hC={init:nC,forward:aC,inverse:oC,names:lC};function cC(){this.name="geocent"}function uC(a){var i=b1(a,this.es,this.a);return i}function dC(a){var i=w1(a,this.es,this.a,this.b);return i}var fC=["Geocentric","geocentric","geocent","Geocent"];const pC={init:cC,forward:uC,inverse:dC,names:fC};var Yr={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},mc={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function mC(){if(Object.keys(mc).forEach((function(l){if(typeof this[l]>"u")this[l]=mc[l].def;else{if(mc[l].num&&isNaN(this[l]))throw new Error("Invalid parameter value, must be numeric "+l+" = "+this[l]);mc[l].num&&(this[l]=parseFloat(this[l]))}mc[l].degrees&&(this[l]=this[l]*Fi)}).bind(this)),Math.abs(Math.abs(this.lat0)-Qt)<fe?this.mode=this.lat0<0?Yr.S_POLE:Yr.N_POLE:Math.abs(this.lat0)<fe?this.mode=Yr.EQUIT:(this.mode=Yr.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var a=this.tilt,i=this.azi;this.cg=Math.cos(i),this.sg=Math.sin(i),this.cw=Math.cos(a),this.sw=Math.sin(a)}function gC(a){a.x-=this.long0;var i=Math.sin(a.y),l=Math.cos(a.y),u=Math.cos(a.x),p,x;switch(this.mode){case Yr.OBLIQ:x=this.sinph0*i+this.cosph0*l*u;break;case Yr.EQUIT:x=l*u;break;case Yr.S_POLE:x=-i;break;case Yr.N_POLE:x=i;break}switch(x=this.pn1/(this.p-x),p=x*l*Math.sin(a.x),this.mode){case Yr.OBLIQ:x*=this.cosph0*i-this.sinph0*l*u;break;case Yr.EQUIT:x*=i;break;case Yr.N_POLE:x*=-(l*u);break;case Yr.S_POLE:x*=l*u;break}var m,o;return m=x*this.cg+p*this.sg,o=1/(m*this.sw*this.h1+this.cw),p=(p*this.cg-x*this.sg)*this.cw*o,x=m*o,a.x=p*this.a,a.y=x*this.a,a}function _C(a){a.x/=this.a,a.y/=this.a;var i={x:a.x,y:a.y},l,u,p;p=1/(this.pn1-a.y*this.sw),l=this.pn1*a.x*p,u=this.pn1*a.y*this.cw*p,a.x=l*this.cg+u*this.sg,a.y=u*this.cg-l*this.sg;var x=gs(a.x,a.y);if(Math.abs(x)<fe)i.x=0,i.y=a.y;else{var m,o;switch(o=1-x*x*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/x+x/this.pn1),m=Math.sqrt(1-o*o),this.mode){case Yr.OBLIQ:i.y=Math.asin(m*this.sinph0+a.y*o*this.cosph0/x),a.y=(m-this.sinph0*Math.sin(i.y))*x,a.x*=o*this.cosph0;break;case Yr.EQUIT:i.y=Math.asin(a.y*o/x),a.y=m*x,a.x*=o;break;case Yr.N_POLE:i.y=Math.asin(m),a.y=-a.y;break;case Yr.S_POLE:i.y=-Math.asin(m);break}i.x=Math.atan2(a.x,a.y)}return a.x=i.x+this.long0,a.y=i.y,a}var yC=["Tilted_Perspective","tpers"];const vC={init:mC,forward:gC,inverse:_C,names:yC};function xC(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var a=1-this.es,i=1/a;this.radius_p=Math.sqrt(a),this.radius_p2=a,this.radius_p_inv2=i,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function bC(a){var i=a.x,l=a.y,u,p,x,m;if(i=i-this.long0,this.shape==="ellipse"){l=Math.atan(this.radius_p2*Math.tan(l));var o=this.radius_p/gs(this.radius_p*Math.cos(l),Math.sin(l));if(p=o*Math.cos(i)*Math.cos(l),x=o*Math.sin(i)*Math.cos(l),m=o*Math.sin(l),(this.radius_g-p)*p-x*x-m*m*this.radius_p_inv2<0)return a.x=Number.NaN,a.y=Number.NaN,a;u=this.radius_g-p,this.flip_axis?(a.x=this.radius_g_1*Math.atan(x/gs(m,u)),a.y=this.radius_g_1*Math.atan(m/u)):(a.x=this.radius_g_1*Math.atan(x/u),a.y=this.radius_g_1*Math.atan(m/gs(x,u)))}else this.shape==="sphere"&&(u=Math.cos(l),p=Math.cos(i)*u,x=Math.sin(i)*u,m=Math.sin(l),u=this.radius_g-p,this.flip_axis?(a.x=this.radius_g_1*Math.atan(x/gs(m,u)),a.y=this.radius_g_1*Math.atan(m/u)):(a.x=this.radius_g_1*Math.atan(x/u),a.y=this.radius_g_1*Math.atan(m/gs(x,u))));return a.x=a.x*this.a,a.y=a.y*this.a,a}function wC(a){var i=-1,l=0,u=0,p,x,m,o;if(a.x=a.x/this.a,a.y=a.y/this.a,this.shape==="ellipse"){this.flip_axis?(u=Math.tan(a.y/this.radius_g_1),l=Math.tan(a.x/this.radius_g_1)*gs(1,u)):(l=Math.tan(a.x/this.radius_g_1),u=Math.tan(a.y/this.radius_g_1)*gs(1,l));var P=u/this.radius_p;if(p=l*l+P*P+i*i,x=2*this.radius_g*i,m=x*x-4*p*this.C,m<0)return a.x=Number.NaN,a.y=Number.NaN,a;o=(-x-Math.sqrt(m))/(2*p),i=this.radius_g+o*i,l*=o,u*=o,a.x=Math.atan2(l,i),a.y=Math.atan(u*Math.cos(a.x)/i),a.y=Math.atan(this.radius_p_inv2*Math.tan(a.y))}else if(this.shape==="sphere"){if(this.flip_axis?(u=Math.tan(a.y/this.radius_g_1),l=Math.tan(a.x/this.radius_g_1)*Math.sqrt(1+u*u)):(l=Math.tan(a.x/this.radius_g_1),u=Math.tan(a.y/this.radius_g_1)*Math.sqrt(1+l*l)),p=l*l+u*u+i*i,x=2*this.radius_g*i,m=x*x-4*p*this.C,m<0)return a.x=Number.NaN,a.y=Number.NaN,a;o=(-x-Math.sqrt(m))/(2*p),i=this.radius_g+o*i,l*=o,u*=o,a.x=Math.atan2(l,i),a.y=Math.atan(u*Math.cos(a.x)/i)}return a.x=a.x+this.long0,a}var MC=["Geostationary Satellite View","Geostationary_Satellite","geos"];const SC={init:xC,forward:bC,inverse:wC,names:MC};var Ac=1.340264,Rc=-.081106,kc=893e-6,Dc=.003796,Kd=Math.sqrt(3)/2;function TC(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function PC(a){var i=ye(a.x-this.long0),l=a.y,u=Math.asin(Kd*Math.sin(l)),p=u*u,x=p*p*p;return a.x=i*Math.cos(u)/(Kd*(Ac+3*Rc*p+x*(7*kc+9*Dc*p))),a.y=u*(Ac+Rc*p+x*(kc+Dc*p)),a.x=this.a*a.x+this.x0,a.y=this.a*a.y+this.y0,a}function EC(a){a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a;var i=1e-9,l=12,u=a.y,p,x,m,o,P,A;for(A=0;A<l&&(p=u*u,x=p*p*p,m=u*(Ac+Rc*p+x*(kc+Dc*p))-a.y,o=Ac+3*Rc*p+x*(7*kc+9*Dc*p),u-=P=m/o,!(Math.abs(P)<i));++A);return p=u*u,x=p*p*p,a.x=Kd*a.x*(Ac+3*Rc*p+x*(7*kc+9*Dc*p))/Math.cos(u),a.y=Math.asin(Math.sin(u)/Kd),a.x=ye(a.x+this.long0),a}var IC=["eqearth","Equal Earth","Equal_Earth"];const CC={init:TC,forward:PC,inverse:EC,names:IC};var Gc=1e-10;function AC(){var a;if(this.phi1=this.lat1,Math.abs(this.phi1)<Gc)throw new Error;this.es?(this.en=Wm(this.es),this.m1=ih(this.phi1,this.am1=Math.sin(this.phi1),a=Math.cos(this.phi1),this.en),this.am1=a/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=kC,this.forward=RC):(Math.abs(this.phi1)+Gc>=Qt?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=zC,this.forward=DC)}function RC(a){var i=ye(a.x-(this.long0||0)),l=a.y,u,p,x;return u=this.am1+this.m1-ih(l,p=Math.sin(l),x=Math.cos(l),this.en),p=x*i/(u*Math.sqrt(1-this.es*p*p)),a.x=u*Math.sin(p),a.y=this.am1-u*Math.cos(p),a.x=this.a*a.x+(this.x0||0),a.y=this.a*a.y+(this.y0||0),a}function kC(a){a.x=(a.x-(this.x0||0))/this.a,a.y=(a.y-(this.y0||0))/this.a;var i,l,u,p;if(l=gs(a.x,a.y=this.am1-a.y),p=Hm(this.am1+this.m1-l,this.es,this.en),(i=Math.abs(p))<Qt)i=Math.sin(p),u=l*Math.atan2(a.x,a.y)*Math.sqrt(1-this.es*i*i)/Math.cos(p);else if(Math.abs(i-Qt)<=Gc)u=0;else throw new Error;return a.x=ye(u+(this.long0||0)),a.y=Ra(p),a}function DC(a){var i=ye(a.x-(this.long0||0)),l=a.y,u,p;return p=this.cphi1+this.phi1-l,Math.abs(p)>Gc?(a.x=p*Math.sin(u=i*Math.cos(l)/p),a.y=this.cphi1-p*Math.cos(u)):a.x=a.y=0,a.x=this.a*a.x+(this.x0||0),a.y=this.a*a.y+(this.y0||0),a}function zC(a){a.x=(a.x-(this.x0||0))/this.a,a.y=(a.y-(this.y0||0))/this.a;var i,l,u=gs(a.x,a.y=this.cphi1-a.y);if(l=this.cphi1+this.phi1-u,Math.abs(l)>Qt)throw new Error;return Math.abs(Math.abs(l)-Qt)<=Gc?i=0:i=u*Math.atan2(a.x,a.y)/Math.cos(l),a.x=ye(i+(this.long0||0)),a.y=Ra(l),a}var LC=["bonne","Bonne (Werner lat_1=90)"];const OC={init:AC,names:LC};function FC(a){a.Proj.projections.add(Ad),a.Proj.projections.add(Rd),a.Proj.projections.add(AP),a.Proj.projections.add(NP),a.Proj.projections.add($P),a.Proj.projections.add(KP),a.Proj.projections.add(iE),a.Proj.projections.add(oE),a.Proj.projections.add(dE),a.Proj.projections.add(_E),a.Proj.projections.add(zE),a.Proj.projections.add(GE),a.Proj.projections.add($E),a.Proj.projections.add(YE),a.Proj.projections.add(iI),a.Proj.projections.add(oI),a.Proj.projections.add(dI),a.Proj.projections.add(_I),a.Proj.projections.add(MI),a.Proj.projections.add(II),a.Proj.projections.add(DI),a.Proj.projections.add(BI),a.Proj.projections.add($I),a.Proj.projections.add(KI),a.Proj.projections.add(eC),a.Proj.projections.add(hC),a.Proj.projections.add(pC),a.Proj.projections.add(vC),a.Proj.projections.add(SC),a.Proj.projections.add(CC),a.Proj.projections.add(OC)}Os.defaultDatum="WGS84";Os.Proj=bn;Os.WGS84=new Os.Proj("WGS84");Os.Point=Yl;Os.toPoint=M1;Os.defs=rs;Os.nadgrid=AT;Os.transform=Wd;Os.mgrs=HT;Os.version="__VERSION__";FC(Os);var BC=ar('<a href="#" role="button" draggable="false" class="govuk-button govuk-button--start" data-module="govuk-button"> <svg class="govuk-button__start-icon" xmlns="http://www.w3.org/2000/svg" width="17.5" height="19" viewBox="0 0 33 40" aria-hidden="true" focusable="false"><path fill="currentColor" d="M0 0h13l20 20-20 20H0l20-20z"></path></svg></a>'),NC=ar('<button type="submit" disabled aria-disabled="true" class="govuk-button svelte-1tl3uni" data-module="govuk-button"> </button>'),GC=ar('<button type="button" class="text-header svelte-1tl3uni"> <svg width="22" height="22" focusable="false" aria-hidden="true" role="img" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.1875 9.5L10.9609 3.95703L13.7344 9.5H8.1875Z" fill="currentColor"></path><path d="M13.7344 12.0781L10.9609 17.6211L8.1875 12.0781H13.7344Z" fill="currentColor"></path></svg></button>'),jC=ar('<button type="submit" data-module="govuk-button"> </button>'),UC=ar('<div class="p-4"><!></div>');function VC(a,i){let l=Ma(i,"textContent",3,void 0);Ma(i,"componentNameProp",3,void 0);let u=Ma(i,"onClickFunction",3,void 0),p=gc(()=>i.buttonType==="default"?"govuk-button":i.buttonType==="secondary"?"govuk-button govuk-button--secondary":i.buttonType==="warning"?"govuk-button govuk-button--warning":i.buttonType==="dark background"?"govuk-button govuk-button--inverse":void 0);var x=UC(),m=Mi(x);{var o=A=>{var O=BC();O.__click=function(...k){var B;(B=u())==null||B.apply(this,k)};var D=Mi(O);Bd(),bi(O),ss(()=>ms(D,`${l()??""} `)),$i(A,O)},P=(A,O)=>{{var D=B=>{var V=NC();V.__click=function(...it){var gt;(gt=u())==null||gt.apply(this,it)};var K=Mi(V,!0);bi(V),ss(()=>ms(K,l())),$i(B,V)},k=(B,V)=>{{var K=gt=>{var ct=GC();ct.__click=function(...Ct){var zt;(zt=u())==null||zt.apply(this,Ct)};var Dt=Mi(ct);Bd(),bi(ct),ss(()=>ms(Dt,`${l()??""} `)),$i(gt,ct)},it=gt=>{var ct=jC();ct.__click=function(...Ct){var zt;(zt=u())==null||zt.apply(this,Ct)};var Dt=Mi(ct,!0);bi(ct),ss(()=>{fy(ct,1,ob(Zt(p)),"svelte-1tl3uni"),ms(Dt,l())}),$i(gt,ct)};vn(B,gt=>{i.buttonType==="table header"?gt(K):gt(it,!1)},V)}};vn(A,B=>{i.buttonType==="disabled"?B(D):B(k,!1)},O)}};vn(m,A=>{i.buttonType==="start"?A(o):A(P,!1)})}bi(x),$i(a,x)}jc(["click"]);var qC=ar('<div class="color-keys svelte-1ggjqve"> </div>'),$C=ar('<div class="legend svelte-1ggjqve"><div>Colour key:</div> <!></div>'),ZC=ar('<th scope="col"><div class="header"><!></div></th>'),WC=ar('<td class="govuk-table__cell govuk-table__cell--numeric"> </td>'),HC=ar('<td class="govuk-table__cell govuk-table__cell--numeric"> </td>'),XC=ar('<td class="govuk-table__cell"> </td>'),KC=ar('<tr class="govuk-table__row"></tr>'),YC=ar('<div class="p-4"><!> <div class="table-container svelte-1ggjqve"><div id="table-caption" class="sticky-caption svelte-1ggjqve"> </div> <table class="govuk-table" data-module="moj-sortable-table"><thead class="govuk-table__head"><tr class="govuk-table__row"></tr></thead><tbody class="govuk-table__body"></tbody></table></div></div>');function JC(a,i){mm(i,!0);let l=Ma(i,"data",3,void 0),u=Ma(i,"metaData",3,void 0),p=Ma(i,"caption",3,void 0),x=Ma(i,"colourScale",3,void 0),m=Ma(i,"sortState",31,()=>ba({column:"sortedColumn",order:"ascending"})),o=xr(ba([...l()]));function P(ne,le){const be=new Set;for(const qe of ne){if(be.has(qe[le]))return!1;be.add(qe[le])}return!0}let A=[];for(const ne in Zt(o)[0]){const le=P(Zt(o),ne),be=typeof Zt(o)[0][ne],qe={key:ne,isUnique:le,dataType:be};A.push(qe)}const O=A.filter(ne=>ne.dataType==="number").map(ne=>ne.key);function D(ne,le){m(m().column=ne,!0),m(m().order=le,!0)}function k(){typeof Zt(o)[0][m().column]=="number"&&(m().order==="ascending"?Zt(o).sort((ne,le)=>ne[m().column]-le[m().column]):Zt(o).sort((ne,le)=>le[m().column]-ne[m().column])),typeof Zt(o)[0][m().column]=="string"&&(m().order==="ascending"?Zt(o).sort((ne,le)=>ne[m().column].localeCompare(le[m().column])):Zt(o).sort((ne,le)=>le[m().column].localeCompare(ne[m().column])))}m().column!=="sortedColumn"&&k();const B={};for(const ne of O){const le=Zt(o).map(Ce=>Ce[ne]),be=Math.min(...le),qe=Math.max(...le);B[ne]={min:be,max:qe}}Yi(o,Zt(o).map(ne=>{const le={...ne};for(const be of O){const{min:qe,max:Ce}=B[be],yi=(ne[be]-qe)/(Ce-qe);le[`${be}__normalised`]=yi}return le}),!0);function V(ne){return`hsl(${120*ne}, 100%, 80%)`}function K(ne){return`hsl(${120*(1-ne)}, 100%, 80%)`}const it=Object.entries({Good:1,Ok:.5,Bad:0});var gt=YC(),ct=Mi(gt);{var Dt=ne=>{var le=$C(),be=Gr(Mi(le),2);_c(be,17,()=>it,hd,(qe,Ce)=>{var ui=qC(),yi=Mi(ui,!0);bi(ui),ss(Ft=>{$_(ui,`background-color: ${Ft??""}`),ms(yi,Zt(Ce)[0])},[()=>V(Zt(Ce)[1])]),$i(qe,ui)}),bi(le),$i(ne,le)};vn(ct,ne=>{x()==="On"&&ne(Dt)})}var Ct=Gr(ct,2),zt=Mi(Ct),ae=Mi(zt,!0);bi(zt);var ke=Gr(zt,2),de=Mi(ke),Le=Mi(de);_c(Le,21,()=>A,hd,(ne,le)=>{var be=ZC(),qe=Mi(be),Ce=Mi(qe);VC(Ce,{get textContent(){return u()[Zt(le).key].shortLabel},buttonType:"table header",onClickFunction:()=>{const ui=m().column===Zt(le).key&&m().order==="ascending"?"descending":"ascending";D(Zt(le).key,ui),k()}}),bi(qe),bi(be),ss(()=>{fy(be,1,`govuk-table__header ${Zt(le).dataType==="number"?"govuk-table__header--numeric":""}`,"svelte-1ggjqve"),Xp(be,"title",u()[Zt(le).key].explainer)}),$i(ne,be)}),bi(Le),bi(de);var Xe=Gr(de);_c(Xe,21,()=>Zt(o),hd,(ne,le)=>{var be=KC();_c(be,21,()=>A,hd,(qe,Ce)=>{var ui=kd(),yi=Nn(ui);{var Ft=Wt=>{var Ut=kd(),Et=Nn(Ut);{var Gt=Se=>{var Ee=WC(),_e=Mi(Ee,!0);bi(Ee),ss(je=>{$_(Ee,`background-color: ${je??""}`),ms(_e,Zt(le)[Zt(Ce).key])},[()=>u()[Zt(Ce).key].direction==="Higher is better"?V(Zt(le)[Zt(Ce).key+"__normalised"]):K(Zt(le)[Zt(Ce).key+"__normalised"])]),$i(Se,Ee)},se=Se=>{var Ee=HC(),_e=Mi(Ee);bi(Ee),ss(je=>ms(_e,`${je??""} ha`),[()=>Zt(le)[Zt(Ce).key].toLocaleString()]),$i(Se,Ee)};vn(Et,Se=>{x()==="On"?Se(Gt):Se(se,!1)})}$i(Wt,Ut)},qt=Wt=>{var Ut=XC(),Et=Mi(Ut,!0);bi(Ut),ss(()=>ms(Et,Zt(le)[Zt(Ce).key])),$i(Wt,Ut)};vn(yi,Wt=>{Zt(Ce).dataType==="number"?Wt(Ft):Wt(qt,!1)})}$i(qe,ui)}),bi(be),$i(ne,be)}),bi(Xe),bi(ke),bi(Ct),bi(gt),ss(()=>ms(ae,p())),$i(a,gt),gm()}var QC=wx(ar('<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@10.5.0/ol.css"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/OrdnanceSurvey/os-api-branding@0.3.1/os-api-branding.css"/> <script src="https://cdn.jsdelivr.net/npm/proj4@2.15.0/dist/proj4.js"><\/script> <script src="https://cdn.jsdelivr.net/npm/ol/dist/ol.js"><\/script> <script src="https://unpkg.com/ol-mapbox-style@12.3.5/dist/olms.js"><\/script> <script src="https://cdn.jsdelivr.net/gh/OrdnanceSurvey/os-api-branding@0.3.1/os-api-branding.js"><\/script>',1)),t4=(a,i,l)=>(Zt(i).length=0,l(),Yi(i,Zt(i),!0)),e4=(a,i)=>i(),i4=ar('<div><input name="checkbox" type="checkbox"/> <label for="checkbox"> </label></div>'),r4=ar('<p> </p> <progress max="100"></progress>',1),s4=ar("<p><b> </b></p>"),n4=ar("<p> </p> <fieldset><legend>Layers to turn on/off:</legend> <button>all off</button> <button>all on</button> <!></fieldset> <!>",1),a4=ar(' <div class="os-map-container svelte-1wbsboe"><!></div>',1),o4=ar(" <p>Generating the map...</p>",1),l4=ar('<h2> </h2> <div class="container svelte-1wbsboe"><div class="output svelte-1wbsboe"><div><details><summary>Upload a file (optional)</summary> <br/> <label for="file-upload">Upload a geotiff file:</label> <input accept="image/tiff" id="file-upload" type="file"/></details></div> <!></div> <div><!></div> <div class="table svelte-1wbsboe"><!></div></div>',1);function w4(a,i){mm(i,!0);const[l,u]=Kx(),p=()=>Yx(ke,"$blendingProgress",l),x=[];let m=xr(void 0),o=xr(void 0),P=xr(0),A=xr(0),O=xr(ba([])),D=xr(void 0),k=xr(void 0),B=xr(void 0),V=xr(void 0),K=xr(ba([])),it=xr(ba([])),gt,ct=xr(ba([])),Dt=xr(ba([])),Ct=xr(0),zt,ae=xr(void 0);const ke=Qx(0);let de=xr(void 0),Le=gc(()=>{var ee;return((ee=Zt(de))==null?void 0:ee.length)>0?Zt(de)[0]:`${tb}/data/output.tif`}),Xe=xr(void 0),ne=xr(void 0),le,be;le=new Worker(new URL(""+new URL("../workers/bitUnpackerWorker-CglVGQwC.js",import.meta.url).href,import.meta.url),{type:"module"}),be=new Worker(new URL(""+new URL("../workers/blendworker-EbZ3v63o.js",import.meta.url).href,import.meta.url),{type:"module"}),le.onmessage=ee=>{var Ne;const{bitLayers:he,rasterLayers:we}=ee.data;if(!Array.isArray(he)||!Array.isArray(we)){console.error("Worker returned unexpected data:",ee.data);return}Yi(it,he,!0),Yi(K,we,!0),Zt(K).forEach((Be,Oe)=>{Be.data=Zt(it)[Oe]}),gt=(Ne=Zt(K).find(Be=>Be.filename==="ENGLAND_100M.tif"))==null?void 0:Ne.data,Yi(ct,Zt(K).map(Be=>Be.filename).filter(Be=>Be!="ENGLAND_100M.tif"),!0),zt=Zt(K).map(Be=>Be.filename).filter(Be=>Be!="ENGLAND_100M.tif"),Ce()},le.onerror=ee=>{console.log("ERROR",ee)},be.onmessage=ee=>{ee.data.progress!==void 0?ke.set(ee.data.progress):ee.data.type==="done"&&(Yi(Ct,ee.data.activeCount,!0),Yi(Dt,ee.data.result,!0),ke.set(100))};function qe(ee){const he={};for(let we=0;we<ee.length;we++){const Ne=ee[we];he[Ne]===void 0?he[Ne]=1:he[Ne]++}return he}function Ce(){if(!gt)return;const ee=Zt(K).filter(we=>Zt(ct).includes(we.filename));console.log("active",ee);const he=ee.map(we=>we.data);ke.set(0),console.log("bitarrays",he),be.postMessage({bitArrays:he,englandMask:gt}),ui(he)}function ui(ee,he){if(ee.length){const we=ee,Ne=4,Be=we[0].length,Oe=we,Ge=Math.ceil(Be/Ne),Ue=new Uint8Array(Be),di=[];for(let gi=0;gi<Ne;gi++){const Bi=new Worker(new URL(""+new URL("../workers/onesWorker-CoObRTvv.js",import.meta.url).href,import.meta.url),{type:"module"}),Ye=gi*Ge,_i=Math.min(Ye+Ge,Be),Si=Oe.map(fi=>fi.slice(Ye,_i)),Je=new Promise((fi,_t)=>{Bi.onmessage=function($){if($.data.error){console.error(`Worker ${gi} reported error:`,$.data.error),_t(new Error($.data.error));return}Ue.set(new Uint8Array($.data.result),Ye),fi()},Bi.onerror=function($){console.error(`Worker ${gi} failed:`,$.message),_t($)},Bi.postMessage({arrays:Si,start:Ye,end:_i},Si.map($=>$.buffer))});di.push(Je)}return Promise.all(di).then(()=>{Yi(o,qe(Ue),!0),console.log("✅ All workers done. Final array ready.",Zt(o))})}}Td(async()=>{var he;Yi(ne,((he=Zt(de))==null?void 0:he.length)>0?await Zw(Zt(Le)):await $w(Zt(Le)),!0),Yi(B,await Zt(ne).getImage(),!0),Yi(P,Zt(B).getWidth(),!0),Yi(A,Zt(B).getHeight(),!0),Yi(O,Zt(B).getBoundingBox(),!0),console.log(Zt(B),Zt(P),Zt(A),Zt(O)[0]);const ee=await fetch("./bitpacking_metadata.csv");Yi(Xe,await ee.text(),!0),Zt(Xe)&&le.postMessage({url:Zt(Le),metadataCsv:Zt(Xe)}),Yi(D,document.createElement("canvas"),!0),Zt(D).width=Zt(P),Zt(D).height=Zt(A),Yi(k,Zt(D).getContext("2d"),!0),Yi(V,Zt(k).createImageData(Zt(P),Zt(A)),!0)}),Td(()=>{console.log(Zt(Ct),Zt(Dt).length);for(let ee=0;ee<Zt(Dt).length;ee++){const he=Zt(Dt)[ee];Zt(V).data[ee*4+0]=0,Zt(V).data[ee*4+1]=0,Zt(V).data[ee*4+2]=0,Zt(V).data[ee*4+3]=he!==0?255:0}Zt(D)&&(Zt(k).putImageData(Zt(V),0,0),Yi(m,Zt(D).toDataURL(),!0)),Zt(K).length&&Yi(ae,Zt(K).filter(ee=>ee.filename!=="ENGLAND_100M.tif").map(ee=>{var he;return{label:`${ee.filename.replace(".tif","").replaceAll("_"," ")}: ${((he=ee.area)==null?void 0:he.toLocaleString())??0} ha`,value:ee.filename}}),!0)});let yi=gc(()=>Zt(ct).length);Td(()=>{Yi(yi,Zt(ct).length,!0),Ce()});let Ft=gc(()=>{var ee;return(ee=Zt(K).find(he=>he.filename==="ENGLAND_100M.tif"))==null?void 0:ee.area}),qt=gc(()=>Zt(ct).map((ee,he)=>({name:ee.replace(".tif","").replaceAll("_"," "),area:Zt(K).find(we=>we.filename==ee).area,unique:Zt(o)?Zt(o)[he]:0}))),Wt={name:{explainer:"About name",label:"Name",shortLabel:"Name"},area:{explainer:"about area",label:"Area",shortLabel:"Area"},unique:{explainer:"hectares where this is the only barrier to development",label:"Uniquely this",shortLabel:"Uniquely this"}},Ut=xr(ba({column:"sortedColumn",order:"descending"}));var Et=l4();Hx(ee=>{var he=QC();Bd(10),$i(ee,he)});var Gt=Nn(Et),se=Mi(Gt);bi(Gt);var Se=Gr(Gt,2),Ee=Mi(Se),_e=Mi(Ee),je=Mi(_e),ue=Gr(Mi(je),6);bi(je),bi(_e);var De=Gr(_e,2);{var Ve=ee=>{var he=n4(),we=Nn(he),Ne=Mi(we);bi(we);var Be=Gr(we,2),Oe=Gr(Mi(Be),2);Oe.__click=[t4,ct,Ce];var Ge=Gr(Oe,2);Ge.__click=()=>(Zt(ct).length=0,zt.forEach(Ye=>Zt(ct).push(Ye)),Ce(),Yi(ct,Zt(ct),!0));var Ue=Gr(Ge,2);_c(Ue,17,()=>Zt(K),Ye=>Ye.filename,(Ye,_i)=>{var Si=kd(),Je=Nn(Si);{var fi=_t=>{var $=i4(),H=Mi($);db(H);var Y;H.__change=[e4,Ce];var nt=Gr(H,2),mt=Mi(nt,!0);bi(nt),bi($),ss(vt=>{Y!==(Y=Zt(_i).filename)&&(H.value=(H.__value=Zt(_i).filename)??""),ms(mt,vt)},[()=>Zt(_i).filename.replace(".tif","").replaceAll("_"," ")]),mb(x,[],H,()=>(Zt(_i).filename,Zt(ct)),vt=>Yi(ct,vt)),$i(_t,$)};vn(Je,_t=>{Zt(_i).filename!=="ENGLAND_100M.tif"&&_t(fi)})}$i(Ye,Si)}),bi(Be);var di=Gr(Be,2);{var gi=Ye=>{var _i=r4(),Si=Nn(_i),Je=Mi(Si);bi(Si);var fi=Gr(Si,2);ss(_t=>{ms(Je,`Blending... ${_t??""}%`),fb(fi,p())},[()=>p().toFixed(1)]),$i(Ye,_i)},Bi=Ye=>{var _i=s4(),Si=Mi(_i),Je=Mi(Si);bi(Si),bi(_i),ss(fi=>ms(Je,`English land outside selected categories:
            ${fi??""} ha`),[()=>{var fi;return(((fi=Zt(K).find(_t=>_t.filename==="ENGLAND_100M.tif"))==null?void 0:fi.area)-Zt(Ct)).toLocaleString()}]),$i(Ye,_i)};vn(di,Ye=>{p()<100?Ye(gi):Ye(Bi,!1)})}ss(Ye=>ms(Ne,`England total: ${Ye??""} ha`),[()=>{var Ye;return(Ye=Zt(K).find(_i=>_i.filename==="ENGLAND_100M.tif"))==null?void 0:Ye.area.toLocaleString()}]),$i(ee,he)};vn(De,ee=>{Zt(K).length&&ee(Ve)})}bi(Ee);var ie=Gr(Ee,2),Me=Mi(ie);ib(Me,()=>Zt(B),ee=>{var he=o4(),we=Nn(he);we.nodeValue=`${console.log("waiting")??""} `,Bd(),$i(ee,he)},(ee,he)=>{var we=a4(),Ne=Nn(we);Ne.nodeValue=`${console.log("done waiting")??""}  `;var Be=Gr(Ne),Oe=Mi(Be);V_(Oe,()=>Zt(Le),Ge=>{BS(Ge,{get dataURL(){return Zt(m)},get bbox(){return Zt(O)},get tiffLocation(){return Zt(Le)}})}),bi(Be),$i(ee,we)}),bi(ie);var Ke=Gr(ie,2),ii=Mi(Ke);V_(ii,()=>Zt(qt),ee=>{var he=kd(),we=Nn(he);{var Ne=Be=>{JC(Be,{caption:"",get data(){return Zt(qt)},metaData:Wt,colourScale:"Off",sortedColumn:"unique",get sortState(){return Zt(Ut)},set sortState(Oe){Yi(Ut,Oe,!0)}})};vn(we,Be=>{Zt(qt)&&Be(Ne)})}$i(ee,he)}),bi(Ke),bi(Se),ss((ee,he)=>ms(se,`The total area of land in England is ${ee??""} ha. Removing areas with the selected restrictions there are ${he??""} ha left over.`),[()=>Zt(Ft)?Zt(Ft).toLocaleString():"...",()=>Zt(Ft)?(Zt(Ft)-Zt(Ct)).toLocaleString():"..."]),gb(ue,()=>Zt(de),ee=>Yi(de,ee)),$i(a,Et),gm(),u()}jc(["click","change"]);export{_4 as L,w4 as _,y4 as a,wm as g};
